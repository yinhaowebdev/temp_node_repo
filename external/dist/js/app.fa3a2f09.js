!function(e){function t(t){for(var i,o,l=t[0],s=t[1],c=t[2],d=0,p=[];d<l.length;d++)o=l[d],Object.prototype.hasOwnProperty.call(n,o)&&n[o]&&p.push(n[o][0]),n[o]=0;for(i in s)Object.prototype.hasOwnProperty.call(s,i)&&(e[i]=s[i]);for(u&&u(t);p.length;)p.shift()();return r.push.apply(r,c||[]),a()}function a(){for(var e,t=0;t<r.length;t++){for(var a=r[t],i=!0,l=1;l<a.length;l++){var s=a[l];0!==n[s]&&(i=!1)}i&&(r.splice(t--,1),e=o(o.s=a[0]))}return e}var i={},n={app:0},r=[];function o(t){if(i[t])return i[t].exports;var a=i[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,o),a.l=!0,a.exports}o.m=e,o.c=i,o.d=function(e,t,a){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(o.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)o.d(a,i,function(t){return e[t]}.bind(null,i));return a},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/";var l=window.webpackJsonp=window.webpackJsonp||[],s=l.push.bind(l);l.push=t,l=l.slice();for(var c=0;c<l.length;c++)t(l[c]);var u=s;r.push([0,"chunk-vendors"]),a()}({0:function(e,t,a){a("56d7"),a("db4d"),e.exports=a("ecad")},"0155":function(e,t,a){"use strict";a("ddac")},"0163":function(e,t,a){},"020a":function(e,t,a){"use strict";a.r(t);var i=(a("8615"),a("7514"),a("ac6a"),a("7f7f"),a("75fc")),n=(a("c5f6"),a("36f0")),r=a("b19c"),o={name:"ScriptLinkEditor",alias:"脚本",command:"script-link",mixins:[n.a],props:{title:{type:String,default:function(){return"脚本关联配置"}},visible:{type:String,default:function(){return!1}},showInput:{type:String,default:function(){return!0}},iconClass:{type:String,default:function(){return"el-icon-edit"}},data:{type:Object,default:function(){return{alias:"",type:"",default:"",value:"",primitiveLabels:""}}},placeholder:{type:String,default:""},autoSetValue:{type:Boolean,default:!0},linkType:{type:Number,default:function(){return 1}},handleRulesResult:{type:Function,default:function(){}},handleChangeResult:{type:Function,default:function(){}}},data:function(){return{showVal:"",editVal:{accessType:"script",linkType:this.linkType,content:""},codeOptions:{language:"text/javascript"},dialogVisible:this.visible,fullscreen:!1,codeDefaultHeight:300,codeHeight:300}},computed:{currentPage:function(){var e=this.$store.getters.pageEditor;return e.pagesKV[e.pagesActiveName]},activeComponent:function(){var e,t,a=null===(e=this.currentPage)||void 0===e?void 0:e.activeComponentFid;return null===(t=this.currentPage)||void 0===t?void 0:t.componentKV[a]},payloadNames:function(){var e=this.getIterationVars(null,!0),t=this.getCurrentItemVars(),a=[].concat(Object(i.a)(e),Object(i.a)(t));return a&&a.length?a.map((function(e){return e.label||e.name})).join(", "):""}},watch:{"data.value":function(){this.initData()},visible:function(e){this.dialogVisible=e,e&&this.initData()}},created:function(){this.initData()},methods:{getCurrentItemVars:function(){var e,t,a,i=this;if(!this.activeComponent)return[];if("Grid"===this.activeComponent.name){var n,r,o,l=null===(n=this.activeComponent)||void 0===n||null===(r=n.attributes)||void 0===r||null===(o=r.cols)||void 0===o?void 0:o.attributes,s=!1,c=null;if((l||[]).forEach((function(e){var t,a,n,r;if(null!=e&&null!==(t=e.iterationMode)&&void 0!==t&&t.hasOwnProperty("value")?null==e||null===(a=e.iterationMode)||void 0===a?void 0:a.value:null==e||null===(n=e.iterationMode)||void 0===n?void 0:n.default){var o=Object.values(e).find((function(e){return e===i.data})),l=((null==e||null===(r=e.blockToolbar)||void 0===r?void 0:r.attributes)||[]).find((function(e){return e.blockToolbarName===i.data}));(o||l)&&(s=!0,c=e)}})),s){var u,d,p,h,f,m,v,b,g=null===(u=c)||void 0===u||null===(d=u.iterationNodeAttr)||void 0===d?void 0:d.value,y=null!==(p=c)&&void 0!==p&&null!==(h=p.span)&&void 0!==h&&h.hasOwnProperty("value")?null===(f=c)||void 0===f||null===(m=f.span)||void 0===m?void 0:m.value:null===(v=c)||void 0===v||null===(b=v.span)||void 0===b?void 0:b.default;return this.getItemVariables(this.activeComponent,g,y)}return[]}var _=null===(e=this.activeComponent)||void 0===e||null===(t=e.attributes)||void 0===t||null===(a=t.foreachItemAttr)||void 0===a?void 0:a.value;return _?this.getItemVariables(this.activeComponent,_):[]},getIterationVars:function(e){var t,a,i,n,r,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=this.currentPage;if(!e){var s=l.activeComponentFid;e=l.componentKV[s]}if(null!==(t=e)&&void 0!==t&&null!==(a=t.attributes)&&void 0!==a&&null!==(i=a.iterate)&&void 0!==i&&i.value&&!o){var c={value:"item",label:"item",type:"item",alias:"迭代变量"},u={value:"itemIndex",label:"itemIndex",type:"itemIndex",alias:"迭代索引"};return[c,u]}var d=null===(n=e)||void 0===n?void 0:n.parentFid;if(!d)return[];var p=l.componentKV[d];if("block"===(null==p?void 0:p.name)){var h,f,m,v,b,g=l.componentKV[p.parentFid],y=null==g||null===(h=g.attributes)||void 0===h||null===(f=h.cols)||void 0===f?void 0:f.attributes;if(!y||!y.length)return this.getIterationVars(p);var _=null==y?void 0:y.find((function(e){return e.colId.value===p.colId&&e.rowId.value===p.rowId}));if(!_)return this.getIterationVars(p);var C=null!=_&&null!==(m=_.iterationMode)&&void 0!==m&&m.hasOwnProperty("value")?null==_||null===(v=_.iterationMode)||void 0===v?void 0:v.value:null==_||null===(b=_.iterationMode)||void 0===b?void 0:b.default;if(C){var O,T,V,w,P=l.componentKV[p.parentFid],x=null==_||null===(O=_.iterationNodeAttr)||void 0===O?void 0:O.value,S=null!=_&&null!==(T=_.span)&&void 0!==T&&T.hasOwnProperty("value")?null==_||null===(V=_.span)||void 0===V?void 0:V.value:null==_||null===(w=_.span)||void 0===w?void 0:w.default;return this.getItemVariables(P,x,S)}return this.getIterationVars(p)}var j=null==p||null===(r=p.attributes)||void 0===r?void 0:r.foreachItemAttr,E=j.hasOwnProperty("value")?null==j?void 0:j.value:null==j?void 0:j.default;return E?this.getItemVariables(p,E):this.getIterationVars(p)},getItemVariables:function(e,t,a){var i,n,r=null==e||null===(i=e.attributes)||void 0===i||null===(n=i.componentName)||void 0===n?void 0:n.value,o=a?r+"/Col-"+a:r,l={value:"item",label:"item",type:"item",alias:"来自".concat(o,"的迭代变量")},s={value:"itemIndex",label:"itemIndex",type:"itemIndex",alias:"来自".concat(o,"的迭代索引")},c=[];return(t||[]).forEach((function(e){c.push({value:e,label:e,type:"itemAttr",alias:"迭代属性"})})),c.length&&(l.children=c),[l,s]},initData:function(){var e=this.data.linkConfig;if(e&&"script"===e.accessType){for(var t in e)this.editVal[t]=e[t];this.showVal=this.getCommonShowVal("script",this.editVal)}},resetData:function(){this.showVal="",this.editVal={accessType:"script",content:""},this.commonResetData()},focusCodeEditor:function(){this.$refs.codeEditor&&this.$refs.codeEditor.setMethod("focus")},handleIconClick:function(){this.open()},open:function(){this.$setAttr(this.data,"editorDialogVisible",!0),this.dialogVisible=!0},close:function(){this.closeHandler("script")},clear:function(){this.clearByType("script")},cancel:function(){this.close()},handleCurrentChange:function(e){this.currentRow=e,this.editVal.url=e.id},codeEditorBlur:function(e){this.editVal.content=e},getShowVal:function(){var e=this.editVal.content;return"script: "+(e.length>20?e.substr(0,20)+"...":e)},clickSure:function(){this.commonSureHandler("script")},getHandlerEditVal:function(){return Object(r.e)(this.editVal)},validate:function(){var e,t,a;return"function"!=typeof(null===(e=this.$refs)||void 0===e||null===(t=e.codeEditorJSON)||void 0===t?void 0:t.validate)||null!==(a=this.$refs)&&void 0!==a&&a.codeEditorJSON.validate()?""!==this.editVal.content||"请填写脚本":"请填写正确脚本"},fullScreenHandler:function(){this.fullscreen=!this.fullscreen,this.fullscreen?this.codeHeight=window.innerHeight-235:this.codeHeight=this.codeDefaultHeight}}},l=(a("319d"),a("2877")),s=Object(l.a)(o,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"script-link-editor"},[e.showInput?t("el-input",{staticClass:"editor-input",attrs:{placeholder:e.placeholder,value:e.showVal,readonly:"",size:"mini",clearable:""},nativeOn:{click:function(t){return e.handleIconClick.apply(null,arguments)}}},[t("i",{staticClass:"el-input__icon array-editor-icon",class:e.iconClass,attrs:{slot:"suffix"},slot:"suffix"})]):e._e(),t("el-dialog",{staticClass:"script-link-editor-dialog",attrs:{visible:e.dialogVisible,"close-on-click-modal":!1,fullscreen:e.fullscreen,width:"56%","append-to-body":!0},on:{close:e.close}},[t("div",{staticClass:"IVA-dialog-header",attrs:{slot:"title"},slot:"title"},[t("div",{staticClass:"el-dialog-title dialog-title"},[e._v("\n        "+e._s(e.title)+"\n      ")]),t("div",{staticClass:"el-dialog-header-menu"},[e.fullscreen?e._e():t("i",{staticClass:"el-dialog__close icon-maximize-alt",attrs:{title:"全屏"},on:{click:e.fullScreenHandler}}),e.fullscreen?t("i",{staticClass:"el-dialog__close icon-minimize-alt",attrs:{title:"退出全屏"},on:{click:e.fullScreenHandler}}):e._e()])]),t("div",{staticClass:"hc-attr-editor-content"},[t("div",{staticClass:"hc-attr-editor-content-fun-start"},[e._v("function ("+e._s(e.payloadNames)+") {")]),e.dialogVisible?t("base-code-editor",{ref:"codeEditorJSON",attrs:{params:e.codeOptions,value:e.editVal.content,height:e.codeHeight},on:{blur:e.codeEditorBlur}}):e._e(),t("div",{staticClass:"hc-attr-editor-content-fun-end"},[e._v("}")])],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"danger"},on:{click:e.clear}},[e._v("清 空")]),t("el-button",{on:{click:e.cancel}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.clickSure}},[e._v("确 定")])],1)])],1)}),[],!1,null,null,null);t.default=s.exports},"028d":function(e,t,a){},"0329":function(e,t,a){},"032c":function(e,t,a){},"0338":function(e,t,a){"use strict";var i=(a("8e6e"),a("456d"),a("ac6a"),a("28a5"),a("75fc")),n=(a("7f7f"),a("bd86")),r=a("2f62"),o=a("b19c"),l=a("c276");function s(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function c(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?s(Object(a),!0).forEach((function(t){Object(n.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):s(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var u=function(e){var t={};for(var a in e){var i=e[a];"name"===a?t.name=Object(l.pb)(i.value,i.default):"alias"===a?t.alias=Object(l.pb)(i.value,i.default):"description"===a?t.description=Object(l.pb)(i.value,i.default):"editor"===a&&(t.editor=Object(l.pb)(i.value,i.default))}return t},d={name:"FilterSetting",props:{editVal:{type:Object,default:function(){return{}}}},data:function(){return{rules:[],valueFilterOperators:[{label:"等于",value:"eq"},{label:"大于",value:"gt"},{label:"大于等于",value:"gte"},{label:"小于",value:"lt"},{label:"小于等于",value:"lte"}],compoundItem:[{label:"变量选择",value:"variable",formItem:"variable-Panel"},{label:"手动输入",value:"static",formItem:"select"}],valueFilterCompoundItem:[{label:"变量选择",value:"variable",formItem:"variable-Panel"},{label:"手动输入",value:"static",formItem:"input"}]}},computed:c(c({},Object(r.a)(["measureOptions"])),{},{measureIndicatorDimensionDictOptions:function(){return this.measureOptions.measureIndicatorDimensionDictOptions.map((function(e){return c(c({},e),{},{label:e.name})}))},newArgs:function(){if(this.args&&this.args.length)return Object(i.a)(this.args);var e=this.getPayloads(this.parent&&this.parent.attributes);return e.length>0?e:(e=this.getPayloads(this.parentParent&&this.parentParent.attributes)).length>0?e:[]}}),methods:{variableOnChange:function(e){this.emitChange()},emitChange:function(){this.$emit("input",this.payloads),this.$emit("change",this.payloads)},handleValueFilterOptChange:function(){var e,t,a;void 0===(null==this||null===(e=this.editVal)||void 0===e||null===(t=e.requestPayload)||void 0===t?void 0:t.valueFilter)&&(this.editVal.requestPayload.valueFilter="");var i=(null==this||null===(a=this.editVal)||void 0===a?void 0:a.assistAttr)||{},n=i.valueFilterOperator,r=i.valueFilter;this.editVal.requestPayload.valueFilter=n&&r?"realValue ".concat(n," ").concat(r):""},handleValueFilterChange:function(e){this.changeAssistVariable(e,"valueFilter"),this.handleValueFilterOptChange(e)},onAssistChange:function(){},changeAssistVariable:function(e,t,a,i){var n,r;this.editVal.assistAttr[t]=e,null!=i&&null!==(n=i.value)&&void 0!==n&&n.pathName&&(this.editVal.requestPayload.itemPathName=null==i||null===(r=i.value)||void 0===r?void 0:r.pathName)},getEditValue:function(e){var t,a=/\$\{(.*?)\}/g.exec(e);return(null==a?void 0:a[0])===e?{static:"",type:"variable",variable:null===(t=a[1])||void 0===t?void 0:t.split(".")}:{static:e,type:"static",variable:[]}},getPayloads:function(e){var t=[];if("array"===Object(o.g)(e))e.forEach((function(e){if(!t.length){var a="payload"===e.name?e.attributes:e.payload?e.payload.attributes:null;a&&a.forEach((function(e){var a=u(e);t.push(a)}))}}));else if("object"===Object(o.g)(e))for(var a in e)if("payload"===a){e[a].attributes.forEach((function(e){var a=u(e);t.push(a)}))}return t}}},p=(a("be66"),a("cab9"),a("2877")),h=Object(p.a)(d,(function(){var e=this,t=e._self._c;return t("div",[t("el-form-item",{attrs:{label:"时间维度",prop:"assistAttr.extraFilter"}},[t("variable-editor-components",{staticClass:"filters-item-input",attrs:{options:e.measureIndicatorDimensionDictOptions,title:"设置参数值",placeholder:"请设置参数值",data:e.editVal.variableEditData.timeDimensionData,compoundItem:e.compoundItem},on:{change:function(t){return e.changeAssistVariable(t,"timeDimensionFilter","timeDimensionData")}}})],1),t("el-form-item",{staticClass:"filter-item-start",attrs:{label:"组织机构",prop:"assistAttr.extraFilter"}},[t("variable-editor-components",{staticClass:"filters-item-input",attrs:{options:e.measureOptions.measureIndicatorParentIdDictOptions,title:"设置参数值",placeholder:"请设置参数值",data:e.editVal.variableEditData.parentIdData},on:{change:function(t){return e.changeAssistVariable(t,"parentIdFilter","parentIdData")}}})],1),t("el-form-item",{staticClass:"filter-item-end",attrs:{prop:"assistAttr.parentIdFlag"}},[t("el-checkbox",{model:{value:e.editVal.requestPayload.parentIdFlag,callback:function(t){e.$set(e.editVal.requestPayload,"parentIdFlag",t)},expression:"editVal.requestPayload.parentIdFlag"}},[e._v("向下查找")])],1),t("el-form-item",{staticClass:"filter-item-start",attrs:{label:"项目/主题",prop:"assistAttr.extraFilter"}},[t("variable-editor-components",{staticClass:"filters-item-input",attrs:{options:e.measureOptions.measureIndicatorProjectDictOptions,title:"设置参数值",placeholder:"请设置参数值",data:e.editVal.variableEditData.projectData},on:{change:function(t,a){return e.changeAssistVariable(t,"projectFilter","projectData",a)}}})],1),t("el-form-item",{staticClass:"filter-item-end",attrs:{prop:"assistAttr.itemFlag"}},[t("el-checkbox",{model:{value:e.editVal.requestPayload.itemFlag,callback:function(t){e.$set(e.editVal.requestPayload,"itemFlag",t)},expression:"editVal.requestPayload.itemFlag"}},[e._v("向下查找")])],1),t("el-form-item",{attrs:{label:"值筛选",prop:"requestPayload.valueFilter"}},[t("el-select",{staticClass:"value-filter-operator",attrs:{clearable:""},on:{change:e.handleValueFilterOptChange},model:{value:e.editVal.assistAttr.valueFilterOperator,callback:function(t){e.$set(e.editVal.assistAttr,"valueFilterOperator",t)},expression:"editVal.assistAttr.valueFilterOperator"}},e._l(e.valueFilterOperators,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),t("variable-editor-components",{staticClass:"value-filter-text",attrs:{compoundItem:e.valueFilterCompoundItem,disableExpression:!0,title:"设置值",placeholder:"请设置值",args:e.newArgs,data:e.editVal.variableEditData.valueData},on:{change:e.handleValueFilterChange}})],1),t("el-form-item",{attrs:{label:"额外筛选",prop:"assistAttr.extraFilter"}},[t("el-input",{attrs:{clearable:""},on:{change:this.refreshEditValPayload},model:{value:e.editVal.assistAttr.extraFilter,callback:function(t){e.$set(e.editVal.assistAttr,"extraFilter",t)},expression:"editVal.assistAttr.extraFilter"}})],1),t("el-form-item",{attrs:{label:"子筛选",prop:"assistAttr.subFilter"}},[t("el-input",{attrs:{clearable:""},on:{change:this.refreshEditValPayload},model:{value:e.editVal.assistAttr.subFilter,callback:function(t){e.$set(e.editVal.assistAttr,"subFilter",t)},expression:"editVal.assistAttr.subFilter"}})],1)],1)}),[],!1,null,"5dd765e2",null);t.a=h.exports},"03ee":function(e,t,a){"use strict";a("b68b")},"0456":function(e,t,a){"use strict";a.r(t);var i=(a("8e6e"),a("75fc")),n=(a("456d"),a("7f7f"),a("ac6a"),a("28a5"),a("bd86")),r=(a("c5f6"),a("36f0")),o=a("ae83"),l=a("b19c");function s(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function c(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?s(Object(a),!0).forEach((function(t){Object(n.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):s(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var u={name:"SelectIndicatorId",props:{value:{type:Object,default:function(){return{}}},disabled:{type:Boolean,default:function(){return!1}},showInput:{type:Boolean,default:function(){return!0}},placeholder:{type:String,default:""},iconClass:{type:String,default:function(){return"el-icon-edit"}}},data:function(){return{treeData:[],selectedTreeId:"-1",tableData:[],totalDimensions:[],treeProps:{children:"children",label:"label"},searchName:"",searchCode:"",page:1,total:0,dimensionDisc:{},dialogVisible:!1,currentRow:{}}},created:function(){this.refreshTree(),this.refreshTable()},methods:{handleTreeNodeClick:function(e){var t;this.selectedTreeId=(null===(t=e.value)||void 0===t?void 0:t.id)||e.id,this.refreshTable()},close:function(){this.dialogVisible=!1},refreshTree:function(){var e=this;this.$util.request({url:"/api/model/instances?objectType=HR_COMPANY,HR_DEPARTMENT,SYS_ASSET,SYS_EQUIPMENT&queryMode=simple&pagination=0&lazyLoad=0&$orderBy=createTime desc"}).then((function(t){var a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"id",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"parentId",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"children",n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:-1;i=i||"children";var r=[],o={};return e&&e.length>0&&(e.forEach((function(e){o[e[t]]=e})),e.forEach((function(e){var t={label:e.name,value:e},l=o[e[a]];if(!l)return null!=n&&""!==n?String(e[a])===String(n)?void r.push(t):void 0:void r.push(t);l[i]||(l[i]=[]),l[i].push(t)}))),r}(t,"id","parentId","children","-1"),i=function e(t){return t.map((function(t){var a;return c(c({},t),{},{children:null!==(a=t.value)&&void 0!==a&&a.children?e(t.value.children):null,value:c(c({},t.value),{},{children:null})})}))}(Object(l.e)(a));e.treeData=[{id:"-1",parentId:"-1",label:"/",children:i}]}))},refreshTable:function(){var e=this,t="/api/model/instances?objectType=MEAS_ANALOG,MEAS_DISCRETE,MEAS_ACCUMULATOR,MEAS_STRINGMEASUREMENT\n&$filter=name like ".concat(this.searchName,",identifier like ").concat(this.searchCode,"&parentId=").concat(this.selectedTreeId,"&queryMode=simple&$page=").concat(this.page,"&$pageSize=10&$orderBy=createTime desc");this.$util.request({url:t}).then((function(t){e.tableData=t.result,e.page=t.pageInfo.page,e.total=t.pageInfo.total}))},handleCurrentChange:function(e){this.currentRow=e},handlePageChange:function(e){this.refreshTable()},getRowKey:function(e){return e.id},cancel:function(){this.dialogVisible=!1},clickSure:function(){var e;null!==(e=this.currentRow)&&void 0!==e&&e.id?(this.$emit("change",this.currentRow),this.dialogVisible=!1):this.$message({type:"error",message:"请选择"})}}},d=(a("7493"),a("2877")),p=Object(d.a)(u,(function(){var e=this,t=e._self._c;return t("el-dialog",{staticClass:"indicator-link-editor-dialog",attrs:{visible:e.dialogVisible,"close-on-click-modal":!1,title:"选择量测",width:"56%","append-to-body":!0},on:{close:e.close}},[t("el-row",{staticStyle:{height:"560px",position:"relative"}},[t("el-col",{staticStyle:{height:"100%",position:"relative"},attrs:{span:"8"}},[t("el-tree",{staticStyle:{height:"100%","overflow-y":"auto"},attrs:{"default-expand-all":"",data:e.treeData,props:e.treeProps},on:{"node-click":e.handleTreeNodeClick}})],1),t("el-col",{attrs:{span:"16"}},[t("div",{staticClass:"filters"},[t("div",{staticClass:"filter-item"},[t("div",{staticClass:"filter-label"},[e._v("标识")]),t("div",{staticClass:"filter-value"},[t("el-input",{model:{value:e.searchCode,callback:function(t){e.searchCode=t},expression:"searchCode"}})],1)]),t("div",{staticClass:"filter-item"},[t("div",{staticClass:"filter-label"},[e._v("名称")]),t("div",{staticClass:"filter-value"},[t("el-input",{model:{value:e.searchName,callback:function(t){e.searchName=t},expression:"searchName"}})],1)]),t("div",{staticClass:"filter-item"},[t("el-button",{attrs:{type:"primary"},on:{click:e.refreshTable}},[e._v("搜索")])],1)]),t("div",[t("el-table",{ref:"multipleTable",staticStyle:{width:"100%","overflow-y":"auto"},attrs:{data:e.tableData,"tooltip-effect":"dark",height:"450","highlight-current-row":!0,"row-key":e.getRowKey},on:{"current-change":e.handleCurrentChange}},[t("el-table-column",{attrs:{prop:"identifier",label:"标识"}}),t("el-table-column",{attrs:{prop:"name",label:"名称"}}),t("el-table-column",{attrs:{prop:"updateTime",label:"修改时间"}}),t("el-table-column",{attrs:{prop:"updateUser",width:"120",label:"修改人"}})],1),t("el-pagination",{attrs:{"current-page":e.page,"page-size":10,layout:"total, prev, pager, next",total:e.total},on:{"current-change":e.handlePageChange,"update:currentPage":function(t){e.page=t},"update:current-page":function(t){e.page=t}}})],1)])],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-row",[t("el-col",{attrs:{span:24}},[t("el-button",{on:{click:e.cancel}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.clickSure}},[e._v("确 定")])],1)],1)],1)],1)}),[],!1,null,"392a677a",null).exports,h=a("8e8a"),f=a("2f62");function m(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function v(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?m(Object(a),!0).forEach((function(t){Object(n.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):m(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var b={name:"RtdataLinkEditor",components:{ApiFiltersSelect:h.a,SelectIndicatorId:p,controlCommonAlert:o.a},alias:"实时数据",command:"rtdata-link",mixins:[r.a],props:{visible:{type:String,default:function(){return!1}},showInput:{type:String,default:function(){return!0}},iconClass:{type:String,default:function(){return"el-icon-edit"}},data:{type:Object,default:function(){return{alias:"",type:"",default:"",value:"",primitiveLabels:""}}},placeholder:{type:String,default:""},autoSetValue:{type:Boolean,default:!0},linkType:{type:Number,default:function(){return 1}},handleRulesResult:{type:Function,default:function(){}},handleChangeResult:{type:Function,default:function(){}}},data:function(){return{showCloseTips:JSON.parse(localStorage.getItem("link-tips-rtdata")),requestPayloadBak:{collectTime:"",beginTime:"",endTime:""},variableEditDataBak:{instanceIdData:{name:"instanceId",value:"",editValue:null},collectTimeData:{name:"collectTime",value:"",editValue:null},beginTimeData:{name:"beginTime",value:"",editValue:null},endTimeData:{name:"endTime",value:"",editValue:null}},compoundItem:[{label:"变量选择",value:"variable",formItem:"variable-Panel"},{label:"手动输入",value:"static",formItem:"date-picker"}],rtDataTypes:[{label:"实时数据",value:1},{label:"历史数据",value:2}],queryDirections:[{label:"小于等于采集/归档时间",value:1},{label:"大于等于采集/归档时间",value:2},{label:"小于采集/归档时间",value:3},{label:"大于采集/归档时间",value:4}],queryTypes:[{label:"采集时间",value:1},{label:"归档时间",value:2},{label:"时间区间",value:4}],recordTypes:[{label:"历史记录",value:1},{label:"按天归档的数据",value:2},{label:"按小时归档的数据",value:3},{label:"按分钟归档的数据",value:4}],viewMode:1,showVal:"",collectTime:"",editVal:{accessType:"rtdata",linkType:this.linkType,url:"/api/realtimedata/multi-snapshot",method:"post",contentType:"application/json",objectType:"",rtDataType:1,requestPayload:{instanceId:"",queryDirection:1,querySize:10,$orderBy:"collectTime asc",collectTime:"",queryMode:1,$filter:"",objectType:"",queryType:1,beginTime:"",endTime:"",recordType:1},variableEditData:{instanceIdData:{name:"instanceId",value:"",editValue:null},collectTimeData:{name:"collectTime",value:"",editValue:null},beginTimeData:{name:"beginTime",value:"",editValue:null},endTimeData:{name:"endTime",value:"",editValue:null}},responseSchema:{},exceptionStrategy:"throw",showIdTable:!0,filterItems:[{name:"",value:"",filter:"",editValue:""}],tableData:[]},jsonValue:"{}",codeValue:"{}",responseSchema:"{}",codeOptions:{},codeJSONOptions:{},dialogVisible:this.visible,fetchOption:{url:"/api/model/instances"},fetchProps:{value:"id",label:"name"},fetchOptionForTree:{url:"/api/model/instances?objectType=HR_COMPANY,HR_DEPARTMENT,SYS_ASSET,SYS_EQUIPMENT&queryMode=simple&pagination=0&lazyLoad=0&$orderBy=createTime desc"}}},computed:v(v({},Object(f.a)(["getLinkTipsOf"])),{},{rtdataTipsLoaded:function(){return this.getLinkTipsOf("rtdata-link")},instanceColumns:function(){return[{prop:"objectType",label:"量测量分类",filterOnly:!0,filter:{isParam:!0,type:"select",keep:!0,options:[{label:"全部",value:"MEAS_ANALOG,MEAS_DISCRETE,MEAS_ACCUMULATOR,MEAS_STRINGMEASUREMENT"},{label:"模拟量",value:"MEAS_ANALOG"},{label:"离散量",value:"MEAS_DISCRETE"},{label:"累积量",value:"MEAS_ACCUMULATOR"},{label:"字符串量",value:"MEAS_STRINGMEASUREMENT"}],defaultValue:"MEAS_ANALOG,MEAS_DISCRETE,MEAS_ACCUMULATOR,MEAS_STRINGMEASUREMENT"}},{prop:"identifier",label:"实例标识",show:!0,width:"200",filter:{type:"input",operator:"like"}},{prop:"name",label:"实例名称",show:!0,filter:{type:"input",operator:"like"}},{prop:"createTime",label:"创建时间",show:!0},{prop:"updateTime",label:"更新时间",show:!0}]},fetchInfoOption:function(){return{url:"/api/model/instances/".concat(this.editVal.requestPayload.instanceId)}},rules:function(){var e=this,t=function(t,a,i){4!==e.editVal.requestPayload.queryType||a?i():i(new Error("时间必填!"))};return{"requestPayload.instanceId":[{required:!0,message:"请选择",trigger:"change"}],"requestPayload.collectTimeBegin":[{required:!0,message:"请选择",trigger:"change"}],"requestPayload.collectTimeEnd":[{required:!0,message:"请选择",trigger:"change"}],"requestPayload.beginTime":[{validator:t,trigger:"change"}],"requestPayload.endTime":[{validator:t,trigger:"change"}]}},orders:function(){return 1===this.editVal.requestPayload.recordType?[{label:"升序",value:"collectTime asc"},{label:"降序",value:"collectTime desc"}]:[{label:"升序",value:"archiveDate asc"},{label:"降序",value:"archiveDate desc"}]}}),watch:{"data.value":function(){this.initData()},visible:function(e){this.dialogVisible=e,e&&this.initData()},showCloseTips:function(e){localStorage.setItem("link-tips-rtdata",e)}},created:function(){this.initData()},methods:{handleTypeChange:function(e){2===e&&(this.editVal.requestPayload=v(v({},this.editVal.requestPayload),this.requestPayloadBak),this.editVal.variableEditData=v(v({},this.editVal.variableEditData),this.variableEditDataBak),this.changeRecordType(this.editVal.requestPayload.recordType))},onQuerySizeBlur:function(e){var t,a=null==e||null===(t=e.target)||void 0===t?void 0:t.value;""!==a&&null!=a&&void 0!==a||(this.editVal.requestPayload.querySize=10)},changeRecordType:function(e){var t=this.editVal.requestPayload.$orderBy.split(" ");t.length&&(t[0]=1===e?"collectTime":"archiveDate",this.editVal.requestPayload.$orderBy=t.join(" "))},refreshData:function(){var e=this.editVal,t=e.showIdTable,a=e.rtDataType;t?(this.editVal.requestPayload.objectType="",this.editVal.filterItems=[{name:"",value:"",filter:"",editValue:""}]):this.editVal.tableData=[],this.editVal.requestPayload.instanceId=this.getInstanceIds(),this.editVal.requestPayload.instanceIds=this.getInstanceIds().split(","),this.editVal.requestPayload.$filter=this.getFilterUrl(),1===a&&(this.requestPayloadBak=Object(l.e)({collectTime:this.editVal.requestPayload.collectTime,beginTime:this.editVal.requestPayload.beginTime,endTime:this.editVal.requestPayload.endTime,recordType:this.editVal.requestPayload.recordType}),this.variableEditDataBak=Object(l.e)(this.editVal.variableEditData),this.editVal.requestPayload.collectTime="",this.editVal.requestPayload.beginTime="",this.editVal.requestPayload.endTime="",this.editVal.requestPayload.recordType="",this.editVal.variableEditData={instanceIdData:{name:"instanceId",value:"",editValue:null},collectTimeData:{name:"collectTime",value:"",editValue:null},beginTimeData:{name:"beginTime",value:"",editValue:null},endTimeData:{name:"endTime",value:"",editValue:null}})},deleteRow:function(e,t){var a=this;this.$confirm("确定要删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){a.editVal.tableData.splice(t,1)})).catch((function(){}))},changeIndicator:function(e){this.editVal.tableData.push(e)},getInstanceIds:function(){return this.editVal.tableData.map((function(e){return e.id})).join(",")},getFilterUrl:function(){var e=this.editVal.filterItems,t="";return e.forEach((function(e,a){e.name&&(t+="".concat(a?", ":"").concat(e.name," ").concat(e.logicExp," ").concat(e.value))})),t},handleInsertId:function(){this.dialogInfo={edit:!1,index:0},this.$refs.selectIndicatorId.dialogVisible=!0},onInstanceIdChange:function(e,t){this.editVal.objectType=e?t.objectType:""},handleSelectorTableBeforeClose:function(){this.$refs.selectorTable&&this.$refs.selectorTable.$refs.filter&&this.$refs.selectorTable.$refs.filter.handleFilterReset()},changeVariable:function(e,t){var a,i="collectTime"===t?this.editVal.variableEditData[t+"Data"]:null,n="static"===(null==i||null===(a=i.editValue)||void 0===a?void 0:a.type)?+new Date(e):e;this.editVal.requestPayload[t]=isNaN(n)?e:n},handleSwitchViewMode:function(e){this.viewMode=e,2===e&&(this.jsonValue=Object(l.b)(this.editVal))},codeEditorBlur:function(e){this.codeValue=e,this.editVal.requestPayload=Object(l.j)(e)},codeEditorJSONBlur:function(e){this.editVal=Object(l.j)(e),this.codeValue=Object(l.b)(this.editVal.requestPayload)},handleSelectorFocus:function(e){this.$refs[e]&&this.$refs[e].onPopoverHide&&this.$refs[e].onPopoverHide()},initData:function(){this.$store.dispatch("getTimeDimensionDicts"),this.commonInitData("rtdata"),this.$store.dispatch("setLinkEditorTips","rtdata")},resetData:function(){this.showVal="",this.editVal={rtDataType:1,accessType:"rtdata",linkType:this.linkType,url:"/api/realtimedata/multi-snapshot",method:"post",contentType:"application/json",fields:"",dataType:"Complex[*]",requestPayload:{instanceId:"",instanceIds:"",queryDirection:1,querySize:10,$orderBy:"collectTime asc",collectTime:"",queryMode:1,$filter:"",objectType:"",queryType:1,beginTime:"",endTime:"",recordType:1},variableEditData:{instanceIdData:{name:"instanceId",value:"",editValue:null},collectTimeData:{name:"collectTime",value:"",editValue:null},beginTimeData:{name:"beginTime",value:"",editValue:null},endTimeData:{name:"endTime",value:"",editValue:null}},responseSchema:{},exceptionStrategy:"throw"},this.codeValue="{}",this.jsonValue="{}",this.commonResetData()},focusCodeEditor:function(){this.$refs.codeEditor&&this.$refs.codeEditor.setMethod("focus")},handleIconClick:function(){this.open()},open:function(){this.$setAttr(this.data,"editorDialogVisible",!0),this.dialogVisible=!0},close:function(){this.closeHandler("rtdata")},clear:function(){this.clearByType("rtdata")},cancel:function(){this.close()},handleCurrentChange:function(e){this.currentRow=e,this.editVal.url=e.id},getShowVal:function(){return Object(l.b)(this.editVal)},clickSure:function(){var e=this;this.$refs.form.validate((function(t){if(t){var a=e.editVal,i=a.rtDataType,n=a.requestPayload;if(!e.editVal.tableData.length)return void e.$message({type:"error",message:"请选择量测点"});if(2===i&&4===n.queryType){if(!e.editVal.requestPayload.beginTime)return void e.$message({type:"error",message:"请填写开始时间"});if(!e.editVal.requestPayload.endTime)return void e.$message({type:"error",message:"请填写结束时间"});if("number"==typeof e.editVal.requestPayload.endTime&&"number"==typeof e.editVal.requestPayload.beginTime&&e.editVal.requestPayload.endTime<e.editVal.requestPayload.beginTime)return void e.$message({type:"error",message:"开始时间需要早于结束时间"})}e.refreshData(),e.commonSureHandler("rtdata")}}))},getHandlerEditVal:function(){var e=Object(l.e)(this.editVal);e.responseSchema||(e.responseSchema={});var t=e.requestPayload;t.queryMode=1,1===e.rtDataType?(e.url="/api/realtimedata/multi-snapshot",e.method="post"):(e.url="/api/realtimedata/records?",e.method="get");var a=Object.keys(t),i=a.length;return"get"===e.method&&a.forEach((function(a,n){e.url+=n!==i-1?"".concat(a,"=").concat(t[a],"&"):"".concat(a,"=").concat(t[a])})),e.variables=this.getVariables(e),e},getVariables:function(e){var t=this.getVariableNames(e.url),a=this.getVariableNames(e.requestPayload),n=this.getVariableNames(e.responseSchema);return this.formatVariables([].concat(Object(i.a)(t),Object(i.a)(a),Object(i.a)(n)))},validate:function(){return!0}}},g=(a("9831"),Object(d.a)(b,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"rtdata-link-editor"},[e.showInput?t("el-input",{staticClass:"editor-input",attrs:{placeholder:e.placeholder,value:e.showVal,readonly:"",size:"mini",clearable:""},nativeOn:{click:function(t){return e.handleIconClick.apply(null,arguments)}}},[t("i",{staticClass:"el-input__icon array-editor-icon",class:e.iconClass,attrs:{slot:"suffix"},slot:"suffix"})]):e._e(),t("el-dialog",{staticClass:"rtdata-link-editor-dialog",attrs:{visible:e.dialogVisible,"close-on-click-modal":!1,width:"800px","append-to-body":!0},on:{close:e.close}},[t("span",{attrs:{slot:"title"},slot:"title"},[e._v("\n      实时数据关联配置\n      "),t("a",{directives:[{name:"show",rawName:"v-show",value:e.rtdataTipsLoaded&&e.rtdataTipsLoaded.description,expression:"rtdataTipsLoaded && rtdataTipsLoaded.description"}],attrs:{href:e.rtdataTipsLoaded&&e.rtdataTipsLoaded.description,target:"_blank"}},[t("i",{staticClass:"el-icon-question"})])]),t("control-common-alert",{attrs:{show:!e.showCloseTips},on:{showCloseTips:function(t){e.showCloseTips=!0}}},[t("div",{domProps:{innerHTML:e._s(e.rtdataTipsLoaded&&e.rtdataTipsLoaded.value)}})]),t("div",{staticClass:"hc-view-switch-content"},[t("el-form",{ref:"form",attrs:{"label-width":"210px",model:e.editVal,rules:e.rules}},[t("el-form-item",{attrs:{label:"数据类型："}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},on:{change:e.handleTypeChange},model:{value:e.editVal.rtDataType,callback:function(t){e.$set(e.editVal,"rtDataType",t)},expression:"editVal.rtDataType"}},e._l(e.rtDataTypes,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),2===e.editVal.rtDataType?t("el-form-item",{attrs:{label:"查询类型："}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.editVal.requestPayload.queryType,callback:function(t){e.$set(e.editVal.requestPayload,"queryType",t)},expression:"editVal.requestPayload.queryType"}},e._l(e.queryTypes,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1):e._e(),2===e.editVal.rtDataType?t("el-form-item",{attrs:{label:"记录类型："}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},on:{change:e.changeRecordType},model:{value:e.editVal.requestPayload.recordType,callback:function(t){e.$set(e.editVal.requestPayload,"recordType",t)},expression:"editVal.requestPayload.recordType"}},e._l(e.recordTypes,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1):e._e(),2===e.editVal.rtDataType&&4!==e.editVal.requestPayload.queryType?t("div",[t("el-form-item",{attrs:{label:"查询范围："}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.editVal.requestPayload.queryDirection,callback:function(t){e.$set(e.editVal.requestPayload,"queryDirection",t)},expression:"editVal.requestPayload.queryDirection"}},e._l(e.queryDirections,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"查询条数："}},[t("el-input-number",{attrs:{size:"mini",min:1,max:1e3,step:1,"step-strictly":""},on:{blur:e.onQuerySizeBlur},model:{value:e.editVal.requestPayload.querySize,callback:function(t){e.$set(e.editVal.requestPayload,"querySize",t)},expression:"editVal.requestPayload.querySize"}})],1),t("el-form-item",{attrs:{label:"排序："}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.editVal.requestPayload.$orderBy,callback:function(t){e.$set(e.editVal.requestPayload,"$orderBy",t)},expression:"editVal.requestPayload.$orderBy"}},e._l(e.orders,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1):e._e(),2===e.editVal.rtDataType&&4!=e.editVal.requestPayload.queryType?t("div",[t("el-form-item",{attrs:{label:"".concat(1==e.editVal.requestPayload.queryType?"采集":"归档","时间："),prop:"requestPayload.collectTime"}},[t("variable-editor-components",{key:"collectTime",attrs:{compoundItem:e.compoundItem,"value-format":"timestamp",data:e.editVal.variableEditData.collectTimeData},on:{change:function(t){return e.changeVariable(t,"collectTime")}}})],1)],1):e._e(),2===e.editVal.rtDataType&&4==e.editVal.requestPayload.queryType?t("div",[t("el-form-item",{attrs:{label:"开始时间：",prop:"requestPayload.beginTime"}},[t("variable-editor-components",{key:"beginTime",attrs:{compoundItem:e.compoundItem,"value-format":"timestamp",data:e.editVal.variableEditData.beginTimeData},on:{change:function(t){return e.changeVariable(t,"beginTime")}}})],1),t("el-form-item",{attrs:{label:"结束时间：",prop:"requestPayload.endTime"}},[t("variable-editor-components",{key:"endTime",attrs:{compoundItem:e.compoundItem,"value-format":"timestamp",data:e.editVal.variableEditData.endTimeData},on:{change:function(t){return e.changeVariable(t,"endTime")}}})],1)],1):e._e(),e.editVal.showIdTable?t("div",[t("el-form-item",{attrs:{label:"量测点："}},[t("el-button",{staticStyle:{float:"right"},attrs:{type:"primary"},on:{click:e.handleInsertId}},[e._v("添加量测点")]),t("el-table",{ref:"multipleTable",staticStyle:{width:"100%","max-height":"300px","overflow-y":"auto"},attrs:{data:e.editVal.tableData,"tooltip-effect":"dark","highlight-current-row":!0}},[t("el-table-column",{attrs:{prop:"identifier",label:"标识",width:"120"}}),t("el-table-column",{attrs:{prop:"name",label:"名称"}}),t("el-table-column",{attrs:{label:"操作",width:"100"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){return e.deleteRow(a.row,a.$index)}}},[e._v("删除")])]}}],null,!1,4076837784)})],1)],1)],1):t("div",[t("el-form-item",{attrs:{label:"objectType："}},[t("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.editVal.requestPayload.objectType,callback:function(t){e.$set(e.editVal.requestPayload,"objectType",t)},expression:"editVal.requestPayload.objectType"}})],1),t("el-form-item",{attrs:{label:"筛选项："}},[t("api-filters-select",{model:{value:e.editVal.filterItems,callback:function(t){e.$set(e.editVal,"filterItems",t)},expression:"editVal.filterItems"}})],1)],1),t("exception-strategy",{model:{value:e.editVal.exceptionStrategy,callback:function(t){e.$set(e.editVal,"exceptionStrategy",t)},expression:"editVal.exceptionStrategy"}}),t("response-schema",{attrs:{visible:e.dialogVisible,value:e.responseSchema},on:{blur:e.responseSchemaBlur}}),t("common-link-set",{attrs:{config:e.commonLinkSet,data:e.data,defaultLoad:e.defaultLoad,hiddenConfig:{pagination:!0}}})],1),2===e.viewMode?t("div",{staticClass:"hc-view-switch-json"},[e.dialogVisible?t("base-code-editor",{ref:"codeEditorJSON",attrs:{params:e.codeJSONOptions,value:e.jsonValue,height:420},on:{blur:e.codeEditorJSONBlur}}):e._e()],1):e._e()],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"danger"},on:{click:e.clear}},[e._v("清 空")]),t("el-button",{on:{click:e.cancel}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.clickSure}},[e._v("确 定")])],1)],1),t("select-indicator-id",{ref:"selectIndicatorId",on:{change:e.changeIndicator}})],1)}),[],!1,null,null,null));t.default=g.exports},"04c8":function(e,t,a){"use strict";var i=(a("3b2b"),a("768b")),n=(a("8615"),a("7514"),a("4f7f"),a("5df3"),a("1c4c"),a("7f7f"),a("ac6a"),a("75fc")),r=(a("6762"),a("2fdb"),a("b19c")),o=a("c276"),l={name:"VariablePanel",model:{props:"value",event:"change"},inject:["isSDC"],data:function(){return{duplicateParam:[],showDuplicateParamTips:!1,duplicateParamTips:""}},props:{data:{type:Object,default:function(){return{alias:"",type:"",default:"",value:"",primitiveLabels:""}}},value:{type:String,default:""},editVal:{type:Object,default:function(){return{}}},settings:{type:Object,default:function(){return{checkStrictly:!0}}},args:{type:Array,default:function(){return[]}},showIframes:{type:Boolean,default:!0},vertical:{type:Boolean,default:!1},target:{type:Object,default:function(){return{}}},variableType:{type:String,default:""}},computed:{pageEditor:function(){return this.$store.getters.pageEditor},currentPage:function(){var e=this.pageEditor;return null==e?void 0:e.pagesKV[null==e?void 0:e.pagesActiveName]},activeComponent:function(){var e,t,a=null===(e=this.currentPage)||void 0===e?void 0:e.activeComponentFid;return null===(t=this.currentPage)||void 0===t?void 0:t.componentKV[a]},variables:function(){return this.getVariables()},isCurrentAttrFromImports:function(){var e;return(null===(e=this.target)||void 0===e?void 0:e.componentFid)&&this.target.componentFid!==this.activeComponent.fid}},watch:{"editVal.useOnlyName":function(e){var t=this.editVal.variable;(this.variables=this.getVariables(),e&&t&&t.length)&&(this.variables.filter((function(e){return!["customVariable","scopedVariable"].includes(e.type)&&e.value===t[0]})).length&&(this.editVal.variable=[]))}},methods:{handlerDuplicateTips:function(){var e=this.duplicateParam;e&&e.length?(this.showDuplicateParamTips=!0,this.duplicateParamTips="自定义变量名与其它参数或变量名相同导致[".concat(e.join(","),"]不可用，如需使用，请更改自定义变量名")):this.showDuplicateParamTips=!1},getVariables:function(){var e,t,a=this;this.isCurrentAttrFromImports&&(e=this.currentPage.componentKV[null===(t=this.target)||void 0===t?void 0:t.componentFid]);var i=this.getCurContainerCompVariable();if("container"===this.variableType)return i;var r=[],l=[],s=this.args;if("all"===this.variableType&&(r=[].concat(Object(n.a)(r),Object(n.a)(this.getAllContainerCompVariable()))),"includeContainer"===this.variableType&&(r=[].concat(Object(n.a)(r),Object(n.a)(this.getCurContainerCompVariable()))),s&&s.length>0){var c=[];s.forEach((function(e){var t={value:e.value||e.name,label:e.label||e.name,type:e.type||"Arguments",alias:e.alias||"事件参数",disabled:a.editVal.useOnlyName};l.push(t.value),e.children&&(t.children=e.children),c.push(t)})),r=[].concat(Object(n.a)(r),c)}var u=this.getRecursiveDataContainerVars(this.activeComponent);if(u&&(r=[].concat(Object(n.a)(r),Object(n.a)(u))),this.isSDC){var d=this.getRecursiveContainerSDCVars(this.activeComponent);d&&(r=[].concat(Object(n.a)(r),Object(n.a)(d)))}var p=this.getCurrentItemVars(e);p&&(p.forEach((function(e){var t=a.data.name;l.push(e.value),["foreachItemAttr","foreachData"].includes(t)&&(e.disabled=!0,e.children&&e.children.length&&e.children.forEach((function(e){e.disabled=!0})))})),r=[].concat(Object(n.a)(r),Object(n.a)(p)));var h=this.getSelfIterationVars(e);h&&(r=[].concat(Object(n.a)(r),Object(n.a)(h)));var f=this.getIterationVars(e,p.length?"$parent_":"");f&&(r=[].concat(Object(n.a)(r),Object(n.a)(f)));var m=this.getColIterateItemVars(e);if(m&&(r=[].concat(Object(n.a)(r),Object(n.a)(m))),this.currentPage){!function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",s=t.page,c=s.attributes,u=c.componentName.value,d=a.getAttrs(c,u);if(d.forEach((function(e){e.label=i+e.label,e.value=i+e.value,l.push(e.value),"pageVariable"===e.type&&(e.disabled=a.editVal.useOnlyName,e.children&&e.children.length&&e.children.forEach((function(e){e.disabled=a.editVal.useOnlyName})))})),r=[].concat(Object(n.a)(r),Object(n.a)(d)),a.showIframes){var p=Object(o.gb)(t.fid);for(var h in p)e(p[h],h+":")}}(this.currentPage)}var v=this.duplicateParam=this.duplicates(l),b=Array.from(new Set(r));return b.forEach((function(e){v.includes(e.value)&&(e.disabled=!0,e.children&&e.children.length&&e.children.forEach((function(e){e.disabled=!0})))})),this.handlerDuplicateTips(),b},duplicates:function(e){var t=[];return e.forEach((function(a){e.indexOf(a)!==e.lastIndexOf(a)&&-1===t.indexOf(a)&&t.push(a)})),t},getCurrentItemVars:function(e){var t,a,i,n,r,o,l=this;if(!(e=e||this.activeComponent))return[];if("Grid"===e.name){var s,c,u,d=null===(s=e)||void 0===s||null===(c=s.attributes)||void 0===c||null===(u=c.cols)||void 0===u?void 0:u.attributes,p=!1,h=null;if((d||[]).forEach((function(e){var t,a,i,n;if(null!=e&&null!==(t=e.iterationMode)&&void 0!==t&&t.hasOwnProperty("value")?null==e||null===(a=e.iterationMode)||void 0===a?void 0:a.value:null==e||null===(i=e.iterationMode)||void 0===i?void 0:i.default){var r=Object.values(e).find((function(e){return e===l.data})),o=((null==e||null===(n=e.blockToolbar)||void 0===n?void 0:n.attributes)||[]).find((function(e){return e.blockToolbarName===l.data}));(r||o)&&(p=!0,h=e)}})),p){var f,m,v,b,g,y,_,C,O=null===(f=h)||void 0===f||null===(m=f.iterationNodeAttr)||void 0===m?void 0:m.value,T=null!==(v=h)&&void 0!==v&&null!==(b=v.span)&&void 0!==b&&b.hasOwnProperty("value")?null===(g=h)||void 0===g||null===(y=g.span)||void 0===y?void 0:y.value:null===(_=h)||void 0===_||null===(C=_.span)||void 0===C?void 0:C.default;return this.getItemVariables(e,O,T)}return[]}var V=null===(t=e)||void 0===t||null===(a=t.attributes)||void 0===a||null===(i=a.foreachItemAttr)||void 0===i?void 0:i.value;return(null===(n=e)||void 0===n||null===(r=n.attributes)||void 0===r||null===(o=r.foreachData)||void 0===o?void 0:o.value)?this.getItemVariables(e,V):[]},getColIterateItemVars:function(e){var t,a,i,n,r=this.currentPage;if(!e){var o=r.activeComponentFid;e=r.componentKV[o]}if("Grid"===e.name&&null!==(t=e)&&void 0!==t&&null!==(a=t.attributes)&&void 0!==a&&null!==(i=a.foreachData)&&void 0!==i&&null!==(n=i.value)&&void 0!==n&&n.length){var l,s,c,u,d,p,h,f,m,v=null===(l=e)||void 0===l||null===(s=l.attributes)||void 0===s||null===(c=s.componentName)||void 0===c?void 0:c.value;this.isCurrentAttrFromImports&&(v="".concat((null===(h=this.activeComponent)||void 0===h||null===(f=h.attributes)||void 0===f||null===(m=f.componentName)||void 0===m?void 0:m.value)||"二开组件","内部"));var b=null===(u=e)||void 0===u||null===(d=u.attributes)||void 0===d||null===(p=d.foreachItemAttr)||void 0===p?void 0:p.value,g={value:"item",label:"item",type:"item",alias:"来自".concat(v,"的迭代变量")},y={value:"itemIndex",label:"itemIndex",type:"itemIndex",alias:"来自".concat(v,"的迭代索引")},_=[];return(b||[]).forEach((function(e){_.push({value:e,label:e,type:"itemAttr",alias:"迭代属性"})})),_.length&&(g.children=_),[g,y]}return[]},getRecursiveDataContainerVars:function(e,t){var a,i=this.currentPage;if(!e){var r=i.activeComponentFid;e=i.componentKV[r]}"string"==typeof e&&(e=i.componentKV[e]);var o=[],l=i.componentKV[null===(a=e)||void 0===a?void 0:a.parentFid];return l&&(o=this.getRecursiveDataContainerVars(l,t)),["dataContainer"].includes(e.groupName)&&(o=[].concat(Object(n.a)(this.getScopedVars(e,t)||[]),Object(n.a)(o))),o},getRecursiveContainerSDCVars:function(e,t){var a,i=this.currentPage;if(!e){var r=i.activeComponentFid;e=i.componentKV[r]}"string"==typeof e&&(e=i.componentKV[e]);var o=[],l=i.componentKV[null===(a=e)||void 0===a?void 0:a.parentFid];return l&&(o=this.getRecursiveContainerSDCVars(l,t)),["ContainerSDC"].includes(e.name)&&(o=[].concat(Object(n.a)(this.getScopedVars(e,t)||[]),Object(n.a)(o))),o},getScopedVars:function(e,t){var a,i,r,o,l,s=null==e?void 0:e.attributes;if(!s)return[];var c=null==s||null===(a=s.componentName)||void 0===a?void 0:a.value,u=this.getAttrs(s,c),d=(t||"")+c,p=null===(i=s.value)||void 0===i||null===(r=i.linkConfig)||void 0===r?void 0:r.pagination,h=null===(o=s.value)||void 0===o||null===(l=o.linkConfig)||void 0===l?void 0:l.requestPayload,f=(null==h?void 0:h.rowField)&&(null==h?void 0:h.rowValue)&&(null==h?void 0:h.functionIdentifier);return u.forEach((function(t){var a=d+(t.label&&"default"!==t.label?"_"+t.label:"");t.label=a,t.value=a,"ContainerArray"===e.name&&(t.children=[].concat(Object(n.a)(p?[{alias:"分页信息",label:"pageInfo",type:"scopedVariable",value:"pageInfo"}]:[]),[{alias:"数据集合",label:"result",type:"scopedVariable",value:"result"}],Object(n.a)(t.children||[]),Object(n.a)(f?[{alias:"动态字段",label:"dynamicFields",type:"scopedVariable",value:"dynamicFields"}]:[])))})),u||[]},getIterationVars:function(e,t){var a,i,n=this.currentPage;if(!e){var r=n.activeComponentFid;e=n.componentKV[r]}var o=null===(a=e)||void 0===a?void 0:a.parentFid;if(!o)return[];var l=n.componentKV[o];if("block"===(null==l?void 0:l.name)){var s,c,u,d,p,h=n.componentKV[l.parentFid],f=null==h||null===(s=h.attributes)||void 0===s||null===(c=s.cols)||void 0===c?void 0:c.attributes;if(!f||!f.length)return this.getIterationVars(l,t);var m=null==f?void 0:f.find((function(e){return e.colId.value===l.colId&&e.rowId.value===l.rowId}));if(!m)return this.getIterationVars(l,t);if(null!=m&&null!==(u=m.iterationMode)&&void 0!==u&&u.hasOwnProperty("value")?null==m||null===(d=m.iterationMode)||void 0===d?void 0:d.value:null==m||null===(p=m.iterationMode)||void 0===p?void 0:p.default){var v,b,g,y,_=n.componentKV[l.parentFid],C=null==m||null===(v=m.iterationNodeAttr)||void 0===v?void 0:v.value,O=null!=m&&null!==(b=m.span)&&void 0!==b&&b.hasOwnProperty("value")?null==m||null===(g=m.span)||void 0===g?void 0:g.value:null==m||null===(y=m.span)||void 0===y?void 0:y.default;return this.getItemVariables(_,C,O,t)}return this.getIterationVars(l,t)}var T=null==l||null===(i=l.attributes)||void 0===i?void 0:i.foreachItemAttr,V=T.hasOwnProperty("value")?null==T?void 0:T.value:null==T?void 0:T.default;return V?this.getItemVariables(l,V,null,t):this.getIterationVars(l,t)},getItemVariables:function(e,t,a,i){var n,r,o,l,s,c=null==e||null===(n=e.attributes)||void 0===n||null===(r=n.componentName)||void 0===r?void 0:r.value,u=a?c+"/Col-"+a:c;this.isCurrentAttrFromImports&&(u="".concat((null===(o=this.activeComponent)||void 0===o||null===(l=o.attributes)||void 0===l||null===(s=l.componentName)||void 0===s?void 0:s.value)||"二开组件","内部"));var d=(i=i||"")+"item",p=i+"itemIndex",h={value:d,label:d,type:"item",alias:"来自".concat(u,"的迭代变量")},f={value:p,label:p,type:"itemIndex",alias:"来自".concat(u,"的迭代索引")},m=[];return Array.isArray(t)&&t.forEach((function(e){m.push({value:e,label:e,type:"itemAttr",alias:"迭代属性"})})),m.length&&(h.children=m),[h,f]},getSelfIterationVars:function(e){var t=this,a=this.currentPage,i=a.activeComponentFid,n=e||a.componentKV[i],r=[];return function e(i){var n,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=a.componentKV[i.fid],s=null==l?void 0:l.attributes,c=null==s||null===(n=s.iterate)||void 0===n?void 0:n.value,u=["tabName","tabVisible"],d=u.includes(t.data.name);if(!c){var p=null==i?void 0:i.parentFid;if(!p)return null;var h=a.componentKV[p];return e(h)}var f,m,v,b,g,y,_=null==s||null===(f=s.iterateKeys)||void 0===f?void 0:f.value,C=null==l||null===(m=l.attributes)||void 0===m||null===(v=m.componentName)||void 0===v?void 0:v.value;t.isCurrentAttrFromImports&&(C="".concat((null===(b=t.activeComponent)||void 0===b||null===(g=b.attributes)||void 0===g||null===(y=g.componentName)||void 0===y?void 0:y.value)||"二开组件","内部"));var O={value:"item",label:"item",type:"item",alias:"来自".concat(C,"的迭代变量")},T={value:"itemIndex",label:"itemIndex",type:"itemIndex",alias:"来自".concat(C,"的迭代索引")},V=[];o&&!d||(_&&_.length&&_.forEach((function(e){V.push({value:e,label:e,type:"itemAttr",alias:"迭代属性"})})),O.children=V,r.push(O),r.push(T))}(n,!0),r},handleChange:function(e){this.$emit("change",e)},getSubAttrs:function(e,t){var a=this,i=[];return"array"===Object(r.g)(e)&&e.forEach((function(e){var n=e.name,r=Object(o.pb)(n.value,n.default);if(r){var l=e.alias,s=Object(o.pb)(l.value,l.default),c={value:r,label:r,type:t,alias:s||("customVariable"===t?"自定义变量":"预设变量")},u=[];if(e.hasOwnProperty("isObject")){var d=e.isObject;if(Object(o.pb)(d.value,d.default)&&e.hasOwnProperty("objectAttr")){var p=e.objectAttr;u=a.getSubAttrs(p.attributes,t)}}u.length>0&&(c.children=u),i.push(c)}})),i},getAttrs:function(e){var t={};for(var a in e){var i=e[a];if("variable"===i.groupName){var r=i.name,o=i.attributes;o&&(t[r]=this.getSubAttrs(o,r,1))}}return[].concat(Object(n.a)(t.customVariable||[]),Object(n.a)(t.pageVariable||[]),Object(n.a)(t.scopedVariable||[]))},getCurContainerCompVariable:function(){var e,t;this.getAllContainerCompVariable();var a=null===(e=this.target)||void 0===e||null===(t=e.editValue)||void 0===t?void 0:t.fn;if(a){var n,r,l=Object(i.a)(a,2),s=l[0],c=l[1];if(new RegExp(o.d).test(c)){var u=c.lastIndexOf("_");s=(c=c.slice(0,u)).slice(u+1,c.length)}var d=null===(n=this.currentPage)||void 0===n||null===(r=n.componentKV)||void 0===r?void 0:r[s];return this.getScopedVars(d)}return[]},getAllContainerCompVariable:function(){var e,t=null===(e=this.currentPage)||void 0===e?void 0:e.componentKV,a=[];if(t)for(var i in t){var r=t[i];"dataContainer"===r.groupName&&a.push.apply(a,Object(n.a)(this.getScopedVars(r)))}return a}}},s=(a("1cc1"),a("2877")),c=Object(s.a)(l,(function(){var e=this,t=e._self._c;return t("div",{class:{"vertical-panel":e.vertical}},[t("el-cascader-panel",{ref:"myCascaderPanel",attrs:{props:e.settings,options:e.variables,value:e.value},on:{change:e.handleChange,"expand-change":function(t){return e.$emit("expand-change")}},scopedSlots:e._u([{key:"default",fn:function(a){a.node;var i=a.data;return[t("span",[e._v(e._s(i.label))]),i.alias?t("span",{staticStyle:{color:"#999","font-size":"80%"}},[e._v(e._s(" ( ".concat(i.alias," )")))]):e._e()]}}])}),t("el-row",[e.showDuplicateParamTips?t("p",{staticStyle:{color:"red","text-align":"left","margin-top":"15px"}},[e._v(e._s(e.duplicateParamTips))]):e._e()])],1)}),[],!1,null,null,null);t.a=c.exports},"0501":function(e,t,a){"use strict";a("d4a8")},"0552":function(e,t,a){"use strict";a("c74f")},"05b5":function(e,t,a){},"05bd":function(e,t,a){"use strict";var i=(a("8e6e"),a("ac6a"),a("456d"),a("bd86")),n=a("a599"),r=a("2f62");function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){Object(i.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var s={name:"AttrBox",props:{parsedType:{type:Object,default:function(){}},data:{type:Object,default:function(){}}},data:function(){return{itemStyle:"",headerStyle:"width:100%;",labelWidth:104,isEquality:!1}},beforeDestroy:function(){n.a.$off("asideWidth",this.asideWidthEvent)},created:function(){var e=this;n.a.$on("asideWidth",this.asideWidthEvent),this.data.type&&(~this.data.type.indexOf("Boolean")||~this.data.type.indexOf("Complex"))||this.data.isEquality?(this.isEquality=!0,this.handleWidthMin()):this.$nextTick((function(){var t,a;e.handleWidth(null===(t=e.$refs)||void 0===t||null===(a=t.attrItem)||void 0===a?void 0:a.offsetWidth)})),this.data.tips||(this.data.tips=this.data.alias)},computed:l(l({},Object(r.a)(["attrTips"])),{},{show:function(){return this.data.alias&&("Complex"!==this.parsedType.getBaseType()||!this.data.attributes)}}),methods:{asideWidthEvent:function(e){if(e===this.asideWidth||this.isEquality)return!1;this.handleWidth(e)},handleWidthMin:function(){this.itemStyle="display:flex;align-items: center;",this.data.hasOwnProperty("innerWidth")?this.labelWidth=this.data.innerWidth:this.labelWidth=98,this.headerStyle="width:".concat(this.labelWidth,"px;margin-right:4px;")},handleWidthMax:function(){this.itemStyle="",this.labelWidth=!1,this.headerStyle="width:100%;"},handleWidth:function(e){e>300?this.handleWidthMin():this.handleWidthMax()}}},c=(a("9e84"),a("2877")),u=Object(c.a)(s,(function(){var e=this,t=e._self._c;return t("div",{ref:"attrItem",staticClass:"attr-item",style:e.itemStyle},[e.show?t("el-row",{staticClass:"attr-item-header",style:e.headerStyle},[t("el-col",{staticStyle:{display:"flex","align-items":"center"},attrs:{span:24}},[t("span",{staticClass:"attr-item-header-label",style:{width:e.labelWidth?e.labelWidth+"px":"auto"}},[t("span",{attrs:{title:e.data.alias}},[e._v("\n          "+e._s(e.data.alias)+"\n        ")]),t("el-tooltip",{directives:[{name:"show",rawName:"v-show",value:e.attrTips(e.data)&&e.attrTips(e.data).status,expression:"attrTips(data) && attrTips(data).status"}],attrs:{placement:"top","open-delay":1e3}},[t("i",{staticClass:"el-icon-question",on:{mouseenter:function(t){return e.$store.dispatch("getCurrentTips",e.data)}}}),t("div",{attrs:{slot:"content"},domProps:{innerHTML:e._s(e.attrTips(e.data)&&e.attrTips(e.data).value)},slot:"content"})])],1)])],1):e._e(),e._t("default")],2)}),[],!1,null,null,null);t.a=u.exports},"072f":function(e,t,a){},"0791":function(e,t,a){},"08db":function(e,t,a){"use strict";a("0329")},"0a31":function(e,t,a){},"0d14":function(e,t,a){},"0d35":function(e,t,a){"use strict";var i=(a("8e6e"),a("456d"),a("bd86")),n=(a("7f7f"),a("ac6a"),a("c276")),r=a("a223"),o=a("a542"),l=a("b19c"),s=a("2f62");function c(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function u(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?c(Object(a),!0).forEach((function(t){Object(i.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):c(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function d(){var e={};return r.a.eventContent.forEach((function(t){e[t.name]=Object(l.e)(t)})),e}var p={name:"CallbackContent",model:{props:"value",event:"change"},props:{value:{type:Array,default:function(){return[]}},args:{type:Array,default:function(){return[]}}},data:function(){return{changed:!0,parsedType:null}},computed:u(u({},Object(s.a)(["currentPage"])),{},{themeStyles:function(){return{target:"th,td",style:{"border-width":Object(n.nb)("borderWidth"),"border-style":Object(n.nb)("borderStyle"),"border-color":Object(n.nb)("borderColor"),padding:"0 5px"}}},theadStyles:function(){return{"background-color":Object(n.nb)("middleBackgroundColor")}}}),created:function(){this.init()},methods:{init:function(){this.value&&"array"===Object(l.g)(this.value)&&this.value.length||this.$emit("change",[d()])},getEventTypes:function(e){var t=new o.a(e),a=Object(l.e)(t.getAttach());return t.destroy(),a},getComponentName:function(e){return(e.editor||"method")+"-editor"},handleEventTypeChange:function(e,t){var a=this;this.changed=!1,this.$nextTick((function(){a.changed=!0,e.executionContent.editor=t}))},handleEventContent:function(e,t){var a=this,i=this.value.length;if("add"===e)return i>n.a.MAX_LENGTH_ADD?void this.$message({message:"最多添加"+n.a.MAX_LENGTH_ADD+"项！",type:"warning"}):void this.value.push(d());if("del"!==e)if("top"!==e){if("bottom"===e){if(t===i-1)return;var r=this.value.splice(t,1);this.value.splice(t+1,0,r[0])}if("copy"===e){var o,l={id:null==this||null===(o=this.currentPage)||void 0===o?void 0:o.pageId,data:this.value[t]},s="";try{s=JSON.stringify(l)}catch(e){this.$message.error("复制失败！")}if(!s)return;Object(n.t)(s)}if("paste"===e){var c,u=null==this||null===(c=this.currentPage)||void 0===c?void 0:c.pageId;Object(n.u)().then((function(e){var i,n,r,o=[];try{o=JSON.parse(e)}catch(e){a.$message.error("粘贴失败")}null!==(i=o)&&void 0!==i&&i.id&&null!==(n=o)&&void 0!==n&&null!==(r=n.data)&&void 0!==r&&r.executionType?u===o.id?(a.value.splice(t,1,o.data),a.$message.success("粘贴成功")):a.$message.warning("暂不支持跨页面复制"):a.$message.error("粘贴失败")}))}}else{if(0===t)return;var p=this.value.splice(t,1);this.value.splice(t-1,0,p[0])}else this.$confirm("确定要删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){a.value.splice(t,1)})).catch((function(){}))}}},h=(a("ebea"),a("2877")),f=Object(h.a)(p,(function(){var e=this,t=e._self._c;return t("table",{directives:[{name:"theme",rawName:"v-theme",value:e.themeStyles,expression:"themeStyles"}],staticClass:"hc-editor-payload-table"},[t("thead",{staticClass:"hc-editor-payload-table-thead",style:e.theadStyles},[e._m(0)]),t("tbody",{staticClass:"hc-editor-payload-table-tbody"},e._l(e.value,(function(a,i){return t("tr",{key:i},[t("td",[t("el-select",{staticStyle:{width:"100%"},attrs:{size:"mini",placeholder:"请选择"},on:{change:function(t){return e.handleEventTypeChange(a,t)}},model:{value:a.executionType.value,callback:function(t){e.$set(a.executionType,"value",t)},expression:"param.executionType.value"}},e._l(e.getEventTypes(a.executionType.type),(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("td",[e.changed?t(e.getComponentName(a.executionContent),{tag:"component",attrs:{data:a.executionContent,args:e.args}}):e._e()],1),t("td",[t("el-input",{model:{value:a.executionDescription,callback:function(t){e.$set(a,"executionDescription",t)},expression:"param.executionDescription"}})],1),t("td",{staticClass:"hc-payload-operation",attrs:{align:"center"}},[t("CommonTableMoveOprate",{attrs:{data:e.value,index:i,plain:!0,layout:"top,bottom,add,del,copy,paste"},on:{click:e.handleEventContent}})],1)])})),0)])}),[function(){var e=this,t=e._self._c;return t("tr",[t("th",{attrs:{width:"20%"}},[e._v("执行类型")]),t("th",[e._v("执行内容")]),t("th",[e._v("备注")]),t("th",{attrs:{width:"220px"}},[e._v("操作")])])}],!1,null,null,null);t.a=f.exports},"0d49":function(e,t,a){},"0e93":function(e,t,a){},"0eea":function(e,t,a){},"0f34":function(e,t,a){},"0f95":function(e,t,a){},"10b2":function(e,t,a){},1253:function(e,t,a){"use strict";a("557a")},1371:function(e,t,a){},1516:function(e,t,a){},1583:function(e,t,a){"use strict";a("e011")},1711:function(e,t,a){},"171e":function(e,t,a){"use strict";a("e418")},"178d":function(e,t,a){},"17fe":function(e,t,a){"use strict";a("1825")},1825:function(e,t,a){},19911:function(e,t,a){"use strict";a.r(t);var i=(a("8e6e"),a("6762"),a("f559"),a("75fc")),n=(a("456d"),a("ac6a"),a("7f7f"),a("bd86")),r=(a("c5f6"),a("b19c")),o={name:"APIAlert",props:{title:{type:String,default:""},ellipsis:{type:Boolean,default:!1}},data:function(){return{show:!0}},computed:{contentStyle:function(){return this.ellipsis?{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}:{}}},methods:{handleClose:function(){this.show=!1,this.$emit("close")}}},l=(a("bd89"),a("2877")),s=Object(l.a)(o,(function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"show",rawName:"v-show",value:e.show,expression:"show"}],staticClass:"api-alert t-color-primary-light-9__bg"},[t("div",{staticClass:"api-alert-content t-text-regular",style:e.contentStyle},[e._v(e._s(e.title))]),t("div",{staticClass:"api-alert-opt"},[t("i",{staticClass:"el-icon-close t-text-secondary",on:{click:e.handleClose}})])])}),[],!1,null,"66679703",null).exports,c=a("2f62"),u=(a("28a5"),a("2fdb"),a("7514"),a("c276")),d={name:"",attr:{groupName:"",name:""},status:1},p={name:"AttrsImportTable",props:{value:{type:Array,default:function(){return[Object(r.e)(d)]}},attributes:{type:Array,default:function(){return[]}},status:{type:Boolean,default:!1}},created:function(){this.payloads=this.value,this.payloads.length||this.payloads.push(Object(r.e)(d))},watch:{value:function(e,t){this.payloads=this.value,this.payloads.length||this.payloads.push(Object(r.e)(d))},status:{immediate:!0,handler:function(e){e&&this.createOptions()}}},data:function(){return{changed:!0,dialogVisible:!1,payloads:[],attrGroups:[],currentGroupName:""}},methods:{handleAttrChange:function(e,t){var a;t.attr=null===(a=this.attrs(t.attr))||void 0===a?void 0:a.find((function(t){return(t.rename||t.name)===e}))},checkGroupVisible:function(e){var t,a,i=this.pageEditor.attrGroups[null===(t=this.attributes)||void 0===t||null===(a=t.componentName)||void 0===a?void 0:a.componentType].find((function(t){return t.name===e.groupName}));return i&&!1!==i.visible&&"imports"!==e.groupName},createOptions:function(){var e=this;this.attrGroups=[];var t={};Object.keys(this.attributes||{}).forEach((function(a){var i=Object(r.e)(e.attributes[a]);i.rename=a,["customMethods","scopedVariable"].includes(a)||["general"].includes(i.groupName)||["keepValue"].includes(a)&&u.c.includes(i.componentType)||!e.checkGroupVisible(i)||!1===i.visible||(t[i.groupName]||(t[i.groupName]={label:i.groupAlias,value:i.groupName,children:[]},e.attrGroups.push(t[i.groupName])),t[i.groupName].children.push(i))}))},handleEvents:function(e,t){var a=this,i=this.payloads.length;if("add"===e)return i>u.a.MAX_LENGTH_ADD?void this.$message({message:"最多添加"+u.a.MAX_LENGTH_ADD+"项！",type:"warning"}):(this.payloads.push(Object(r.e)(d)),void this.emitChange());if("del"!==e){if("top"===e){if(0===t)return;var n=this.payloads.splice(t,1);return this.payloads.splice(t-1,0,n[0]),void this.emitChange()}if("bottom"===e){if(t===i-1)return;var o=this.payloads.splice(t,1);this.payloads.splice(t+1,0,o[0]),this.emitChange()}}else this.$confirm("确定要删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){a.payloads.splice(t,1),a.emitChange()})).catch((function(){}))},getEditValueVariable:function(e){if(!e)return[];var t=[];return e.split(".").forEach((function(e){t.push(e)})),t},variableOnChange:function(e){this.emitChange()},onNameChange:function(){this.emitChange()},onFilterChanged:function(){this.emitChange()},emitChange:function(){this.$emit("input",this.payloads),this.$emit("change",this.payloads)}},computed:{themeStyles:function(){return{target:"th,td",style:{"border-width":Object(u.nb)("borderWidth"),"border-style":Object(u.nb)("borderStyle"),"border-color":Object(u.nb)("borderColor"),padding:"0 5px"}}},theadStyles:function(){return{"background-color":Object(u.nb)("middleBackgroundColor")}},pageEditor:function(){return this.$store.getters.pageEditor},pageInfo:function(){return this.pageEditor.pagesKV[this.pageEditor.pagesActiveName]},attrs:function(){var e=this;return function(t){var a;return(null===(a=e.attrGroups.find((function(e){return e.value===t.groupName})))||void 0===a?void 0:a.children)||[]}}}};function h(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function f(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?h(Object(a),!0).forEach((function(t){Object(n.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):h(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var m={name:"ImportAttrsEditor",components:{ApiAlert:s,AttrsImportTable:(a("0155"),Object(l.a)(p,(function(){var e=this,t=e._self._c;return t("div",[t("table",{directives:[{name:"theme",rawName:"v-theme",value:e.themeStyles,expression:"themeStyles"}],staticClass:"hc-editor-payload-table"},[t("thead",{staticClass:"hc-editor-payload-table-thead",style:e.theadStyles},[e._m(0)]),t("tbody",{staticClass:"hc-editor-payload-table-tbody"},e._l(e.payloads,(function(a,i){return t("tr",{key:i},[t("td",[t("el-input",{attrs:{size:"mini",placeholder:"请输入名称，建议5个字符以内",clearable:""},on:{blur:e.onNameChange},model:{value:a.name,callback:function(t){e.$set(a,"name",t)},expression:"param.name"}})],1),t("td",[t("div",{staticClass:"tr-content"},[t("el-select",{staticClass:"td-select-group",attrs:{size:"small",value:a.attr.groupName,placeholder:"请选择分组"},on:{change:function(e){return a.attr={groupName:e}}}},e._l(e.attrGroups,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),t("el-select",{staticClass:"td-select-attr",attrs:{size:"small",value:a.attr.rename||a.attr.name,placeholder:"请选择属性"},on:{change:function(t){return e.handleAttrChange(t,a)}}},e._l(e.attrs(a.attr),(function(e){return t("el-option",{key:e.rename||e.name,attrs:{label:e.alias,value:e.rename||e.name}})})),1)],1)]),t("td",{staticClass:"hc-payload-operation",attrs:{align:"center"}},[t("el-button",{attrs:{title:"删除",disabled:e.payloads.length<=1,size:"mini",type:"text"},on:{click:function(t){return e.handleEvents("del",i)}}},[e._v("删除")])],1)])})),0)]),t("div",{staticClass:"params-add-btn"},[t("el-button",{attrs:{title:"新增",icon:"el-icon-plus",plain:""},on:{click:function(t){return e.handleEvents("add")}}},[e._v("添加引用属性")])],1)])}),[function(){var e=this,t=e._self._c;return t("tr",[t("th",{attrs:{width:"30%"}},[e._v("引用属性名称")]),t("th",[e._v("基础属性")]),t("th",{attrs:{width:"10%"}},[e._v("操作")])])}],!1,null,"f147204a",null)).exports},alias:"API",command:"api-link",props:{visible:{type:String,default:function(){return!1}},showInput:{type:String,default:function(){return!0}},iconClass:{type:String,default:function(){return"el-icon-edit"}},data:{type:Object,default:function(){return{alias:"",type:"",default:"",value:"",primitiveLabels:""}}},placeholder:{type:String,default:""},linkType:{type:Number,default:function(){return 1}},handleRulesResult:{type:Function,default:function(){}},handleChangeResult:{type:Function,default:function(){}},params:{type:Object,default:function(){return{}}}},data:function(){return{compUid:"",dialogVisible:!1,componentsAttributes:[],collapseActiveName:""}},computed:f(f({},Object(c.a)(["themeConstColor"])),{},{currentPage:function(){var e,t=null===(e=this.$store.getters)||void 0===e?void 0:e.pageEditor;return t.pagesKV[t.pagesActiveName]},SDCComponents:function(){return this.currentPage.component.length&&this.currentPage.component[0].children||[]},themeColor:function(){return this.themeConstColor.primary},btnName:function(){var e;return(null===(e=this.params)||void 0===e?void 0:e.name)||"属性管理"}}),watch:{"data.value":function(){this.initData()},visible:function(e){this.dialogVisible=e},dialogVisible:function(e){e&&this.initData(!0)}},created:function(){this.initData(!0)},methods:{getInUsedCount:function(e){return(e||[]).filter((function(e){var t;return null===(t=e.attr)||void 0===t?void 0:t.name})).length},getAttr:function(e,t,a){var i=this,n={};return a||(a=t),Object.keys(e).forEach((function(o){var l;o===t.fid?Object.keys(e[t.fid]).forEach((function(i){n[t.fid]||(n[t.fid]={});var o="$I_"+t.fid+"_"+i,l=a.attributes[o];if(l){var s=Object(r.e)(l);s.rename=o,n[t.fid][i]={value:e[t.fid][i],attr:s}}})):null!==(l=t.children)&&void 0!==l&&l.length&&t.children.forEach((function(t){n=f(f({},n),i.getAttr(e,t,a))}))})),n},getComponentsAttributes:function(e){var t=this,a=[],n=this.data.value;return(null==e?void 0:e.length)&&e.forEach((function(e){var r;if("block"!==e.name){var o,l,s,c,u=[],d=n?Object.keys(n[e.fid]||{}):[];null!=d&&d.length&&d.forEach((function(t){u.push({name:n[e.fid][t],attr:e.attributes[t],status:1})}));var p={label:"【".concat((null===(o=e.attributes)||void 0===o||null===(l=o.componentType)||void 0===l?void 0:l.value)||e.alias,"】 ").concat(null===(s=e.attributes)||void 0===s||null===(c=s.componentName)||void 0===c?void 0:c.value),id:e.fid,originAttrs:e.attributes,attrsConfig:u};!t.collapseActiveName&&t.getInUsedCount(null==p?void 0:p.attrsConfig)&&(t.collapseActiveName=e.id),a.push(p)}"ContainerSDC"!==e.name&&null!==(r=e.children)&&void 0!==r&&r.length&&(a=[].concat(Object(i.a)(a),Object(i.a)(t.getComponentsAttributes(e.children)||[])))})),a},initData:function(){this.compUid=this._uid,this.componentsAttributes=this.getComponentsAttributes(this.SDCComponents)},clearData:function(){var e=this;this.$removeAttr(this.data,"lastValue"),this.$removeAttr(this.data,"value");var t=this.currentPage.componentKV[this.currentPage.activeComponentFid];Object.keys(t.attributes).forEach((function(a){a.startsWith("$I_")&&e.$delete(t.attributes,a)}))},resetPanel:function(){this.componentsAttributes.splice(0,this.componentsAttributes.length)},handleIconClick:function(){this.open()},open:function(){this.dialogVisible=!0},close:function(){this.resetPanel(),this.dialogVisible=!1,this.$emit("onClose")},clear:function(){this.clearByType("importAttrs")},clearByType:function(e){var t=this;this.data.value?this.$confirm("确定要清空关联配置吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.clearData(),t.dialogVisible=!1})).catch((function(){})).finally((function(){t.$emit("onClear")})):this.clearData()},cancel:function(){this.close()},clickSure:function(){var e=this,t=this.currentPage.componentKV[this.currentPage.activeComponentFid],a=4e3,i=[],n={};(this.componentsAttributes||[]).forEach((function(r){e.getInUsedCount(r.attrsConfig)&&r.attrsConfig.forEach((function(o){if(o.attr.name){var l=o.attr.componentFid||r.id;n.hasOwnProperty(l)||(n[l]={}),n[l][o.attr.name]=o.name;var s="$I_"+l+"_"+o.attr.name;i.push(s);var c=a;a++;var u=r.originAttrs[o.attr.rename||o.attr.name],d=new Proxy(u,{get:function(e,t,a){return"alias"===t?o.name:"groupAlias"===t?"引用":"groupName"===t?"imports":"originGroupAlias"===t?e.groupAlias:"originGroupName"===t?e.groupName:"name"===t?e[t]:"sort"===t?c:e[t]}});e.$set(t.attributes,s,d)}}))})),Object.keys(t.attributes).forEach((function(a){a.startsWith("$I_")&&!i.includes(a)&&e.$delete(t.attributes,a)})),this.data.value=n,this.close()},getHandlerEditVal:function(){var e=Object(r.e)(this.editVal);return e.responseSchema||(e.responseSchema={}),e.requestPayload||(e.requestPayload={}),(e=Object.assign(e,this.baseEditVal)).variables=this.getVariables(e),e},validate:function(){return"string"==typeof this.editVal||Array.isArray(this.editVal)?"请输入正确的API-JSON配置！":this.editVal.url?this.editVal.method?""===this.editVal.requestPayload||"string"!=typeof this.editVal.requestPayload||"请配置正确的请求参数（requestPayload）":"请配置请求类型method":"请配置请求地址url"}}},v=(a("783a"),Object(l.a)(m,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"import-attrs-editor"},[e.showInput?t("el-button",{staticClass:"import-attrs-editor-btn",attrs:{type:"primary",size:"mini"},on:{click:e.handleIconClick}},[e._v(e._s(e.btnName))]):e._e(),t("el-drawer",{ref:"editorDrawer",attrs:{"custom-class":"import-attrs-editor-drawer",size:"1000px",visible:e.dialogVisible,direction:"rtl",wrapperClosable:!1,"append-to-body":!0,"show-close":!1},on:{"update:visible":function(t){e.dialogVisible=t},close:e.close}},[t("div",{staticClass:"editor-drawer-title",attrs:{slot:"title"},slot:"title"},[t("div",{staticClass:"title-text"},[t("iconfont",{attrs:{type:"icon-close"},on:{click:e.close}}),e._v("\n        引用属性管理\n      ")],1),t("div",{staticClass:"title-btn"},[t("el-button",{attrs:{size:"small"},on:{click:e.clear}},[e._v("\n          清空\n        ")]),t("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.clickSure}},[e._v("\n          提交\n        ")])],1)]),t("div",{staticClass:"import-attrs-editor-container",attrs:{"comp-uid":e.compUid}},[t("api-alert",{staticClass:"api-link-alert",attrs:{title:"引用属性管理是指将当前二开组件中所包含组件的属性引用至二开组件，此面板添加的所有属性将出现在二开组件自身属性栏中，使用该二开组件的页面或嵌套二开组件可以访问这些内部属性。"}}),t("div",{staticClass:"import-attrs-editor-content"},[t("el-collapse",{staticClass:"import-attrs-editor-content-collapse",attrs:{value:"body",accordion:""},model:{value:e.collapseActiveName,callback:function(t){e.collapseActiveName=t},expression:"collapseActiveName"}},e._l(e.componentsAttributes,(function(a){return t("el-collapse-item",{key:a.id,attrs:{name:a.id}},[t("template",{slot:"title"},[t("div",{staticClass:"import-attrs-editor-content-collapse-title"},[t("div",[t("span",[e._v("\n                    "+e._s(a.label)+"\n                  ")]),a.tips?t("basic-tips",{attrs:{type:"popover",title:"配置说明",width:600,placement:"bottom-start",iconStyle:{color:"#C9D0D4"},content:""}},[t("ul",e._l(a.tips,(function(a){return t("li",{key:a},[e._v(e._s(a))])})),0)]):e._e()],1),t("div",[e._v("\n                  已配置\n                  "),t("span",{style:{color:e.themeColor}},[e._v(e._s(e.getInUsedCount(a.attrsConfig)))]),e._v("\n                  项\n                ")])])]),t("attrs-import-table",{attrs:{status:e.collapseActiveName===a.id,attributes:a.originAttrs},on:{change:e.attrsChange},model:{value:a.attrsConfig,callback:function(t){e.$set(a,"attrsConfig",t)},expression:"item.attrsConfig"}})],2)})),1)],1)],1)])],1)}),[],!1,null,null,null));t.default=v.exports},"19e5":function(e,t,a){"use strict";a("840d")},"1a80":function(e,t,a){"use strict";a("ac4d"),a("8a81"),a("5df3"),a("1c4c"),a("6b54"),a("8e6e"),a("c5f6"),a("a481"),a("8615");var i=a("7618"),n=(a("3b2b"),a("c698"),a("75fc")),r=(a("4917"),a("20d6"),a("7514"),a("f559"),a("6762"),a("2fdb"),a("456d"),a("28a5"),a("96cf"),a("3b8d")),o=(a("55dd"),a("7f7f"),a("ac6a"),a("bd86")),l=a("967e"),s=a.n(l),c=a("c276"),u=a("b19c"),d=a("a542");function p(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return h(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?h(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,l=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return o=e.done,e},e:function(e){l=!0,r=e},f:function(){try{o||null==a.return||a.return()}finally{if(l)throw r}}}}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=new Array(t);a<t;a++)i[a]=e[a];return i}function f(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function m(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?f(Object(a),!0).forEach((function(t){Object(o.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):f(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function v(e){this.isTemp=e.isTemp,this.data=null,this.vueContext=window.$VUE_ROOT,this.fid=Object(c.ob)(),this.pageId=e.pageId+"_"+this.fid,this.pagePath=e.pagePath+"_"+this.fid,this.pageInfo=e.pageInfo,this.parentFid=e.parentFid,this.pageVariables=Object(u.e)(e.pageVariables),this.queryParams=m(m({pageId:e.pageId},e.queries),e.pageVariables),this.dialog=e.dialog,this.drawer=e.drawer,this.fromPageId=e.fromPageId,this.pageStatus=e.pageStatus||"published",this.pageView=e.pageView,this.onbeforeload=e.onbeforeload,this.onload=e.onload,this.foreachAttrCallback=e.foreachAttrCallback||function(){},this.variableLinkIds=[],this.otherLinkIds=[],this.linkIdAttrs={},this.variableLinkIdVariableNames=[],this.variableScriptVariableNames=[],this.variableAttrsCustomVariable={},this.variableAttrs={},this.variableUseExpressionAttrs=[],this.themeColorAttrs={},this.scriptAttrsCustomVariable=[],this.scriptAttrs=[],this.customGroupNames={},this.unfinishedChangeHandlers={},this.noRefreshComponents=["Viewarea","ComponentBox"],this.copyComponentAllFids={},this.copyComponentFids={},this.copyComponentOrigin={},this.copyItemScripts={},this.copyItemVariables={},this.copyItemLinkIds={},this.foreachKeyDatas={},this.foreachItemKeys={},this.foreachItemDatas={},this.__init()}v.prototype={constructor:v,__init:function(){var e=this;this.isTemp||this.__clearTempPage(),this.__register(),this.__getComponents((function(t){e.__initPage(t)}))},__clearTempPage:function(){try{var e=Object(c.mb)(this.queryParams.pageId)||{};e.pageId&&Object(c.G)(e.pageId)}catch(e){}},__register:function(){this.vueContext.$store.commit("SET_PAGE_PARSER_INSTANCE_BY_PAGE_ID",{pageId:this.pageId,instance:this}),this.pagePath&&this.vueContext.$store.commit("SET_PAGE_PARSER_INSTANCE_BY_PAGE_ID",{pageId:this.pagePath,instance:this})},__getComponents:function(e){var t,a=this,i=this.vueContext.$store.getters.pageViewStore,n={url:"/api/component/components",params:{pagination:0},method:"get"},r=[],o=[],l=sessionStorage.getItem("storagedComponentJSON");if(l)try{var s=JSON.parse(l);t=new Promise((function(e,t){e(s)}))}catch(e){t=this.vueContext.$util.request(n)}else t=this.vueContext.$util.request(n);t.then((function(e){a.pageView.isLeave||(sessionStorage.setItem("storagedComponentJSON",JSON.stringify(e)),a.vueContext.$store.getters.innerComponents.concat(e||[]).forEach((function(e){if(0!==e.status){var t=window.Vue.options.components[e.name];t&&o.push(t.options.attrs||{})}else r.push(e.name)})))})).finally((function(){a.isLeave||(o=(o=Object(c.l)(o,a.vueContext.$store.getters.pageViewStore)).sort((function(e,t){return e.order-t.order})),a.vueContext.$store.commit("SET_COMPONENTS_VIEW",o),a.vueContext.$store.commit("SET_DISABLE_COMPONENTS_VIEW",r),e(i.componentsKV))}))},__initPage:function(e){var t=this;return Object(r.a)(s.a.mark((function a(){var i,n,r,o,l,d,p,h,f,b,g,y,_,C,O,T,V,w,P,x,S,j,E,k,I,A;return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(d=t.pageInfo,p=t.fid,h=Object(c.ob)(),f={fid:p,name:d.name,id:d.id,pageId:t.pageId,title:d.title,path:d.path,parentId:d.parentId,pageType:d.pageType,component:[],componentKV:{},page:{fid:h,name:"Page",attributes:{}}},b=Object(u.j)(d&&d.pageData)||{},f.version=b.version,g={},t.fromPageId)for(C in _=null===(y=t.vueContext)||void 0===y?void 0:y.$store.getters.getComponentInstanceByPageId(t.fromPageId))/([^-]+-[^-]+){4}/.test(C)&&(P=_[C],x=null===(O=P.data.attributes)||void 0===O||null===(T=O.componentName)||void 0===T?void 0:T.componentType,S=null===(V=P.data.attributes)||void 0===V||null===(w=V.customEvents)||void 0===w?void 0:w.value,j=t.pageId.split("_")[0],"Iframe"===x&&P.pageInfo.id===j&&Object.keys(S||{}).length&&(g=m(m({},g),S)));E={},k={},f.component=Object(c.W)(b.component,(function(a,i){var n,r,o=("block"===(null==i?void 0:i.name)||["dataContainer"].includes(null==i?void 0:i.groupName)?null==i?void 0:i.componentType:null==i?void 0:i.name)||(null==i?void 0:i.componentType),l=a.name,s="ContainerSDC"===l,u=e[l];if(!u)return a.pageId=t.pageId,a.pageVersion=f.version,a.parentFid=null==i?void 0:i.fid,a;["dataContainer"].includes(u.groupName)&&(u.componentType=o);var d,p,h,v,b=Object(c.Q)(u,null,null,a);return b.converted=Object(c.A)(b.converted,o),b.converted.pageId=t.pageId,b.converted.pageVersion=f.version,b.converted.parentFid=null==i?void 0:i.fid,s?(d=Object(c.xb)(b.converted,m(m({},a),{},{attributes:a.attributes.filter((function(e){return!e.name.startsWith("$V_")}))})),b.converted=Object(c.y)(b.converted),null!==(p=(d=Object(c.xb)(b.converted,m(m({},a),{},{attributes:a.attributes.filter((function(e){return e.name.startsWith("$V_")}))}))).attributes.sourceId)&&void 0!==p&&p.value&&(E[d.attributes.sourceId.value]||(E[d.attributes.sourceId.value]=[]),E[d.attributes.sourceId.value].push({compFid:d.fid,sourceVersion:d.attributes.sourceVersion.value}))):d=Object(c.xb)(b.converted,a),s&&null!==(n=d.attributes)&&void 0!==n&&null!==(r=n.importsManager)&&void 0!==r&&r.value&&(k[d.fid]=null===(h=d.attributes)||void 0===h||null===(v=h.importsManager)||void 0===v?void 0:v.value),g.hasOwnProperty(d.fid)&&Object(c.w)(g[d.fid],d),d})),I=Object(c.U)(b.page),b.page&&(h=b.page.fid,f.page.fid=h,f.page.pageId=t.pageId),f.page.attributes=I.converted,g.hasOwnProperty(f.page.fid)&&Object(c.w)(g[f.page.fid],f.page),f.page.attributes.pageName.value=f.name,(b.customMethods||[]).forEach((function(e){var a={};e.payload.forEach((function(e){e.name&&(a[e.name]=e.default)}));var i=Object.keys(a),n=i.join(","),r="const { ".concat(n," } = Arguments; \n"),o=(i.length?r:"")+e.content;try{var l,s=new Function("Arguments",o);s._paramKeys=i,window.Vue.prototype["$_".concat(e.functionName,"_").concat(t.pageId)]=s;var c=(null===(l=window.Vue.prototype["$_".concat(e.functionName)])||void 0===l?void 0:l.__count)||0;t["$_".concat(e.functionName)]=window.Vue.prototype["$_".concat(e.functionName)]=function(){var t=arguments,a=this instanceof v,i=(a?this:this.$getPageParser()).pageId,n=window.Vue.prototype["$_".concat(e.functionName,"_").concat(i)];if(i&&"function"==typeof n){var r={};return(n._paramKeys||[]).forEach((function(e,a){r[e]=t[a]})),n.call(a&&(this.pageView||this.vueContext)||this,r)}},window.Vue.prototype["$_".concat(e.functionName)].__count=c+1}catch(e){}})),t.disableComponents=null===(i=t.vueContext)||void 0===i||null===(n=i.$store)||void 0===n||null===(r=n.getters)||void 0===r||null===(o=r.pageViewStore)||void 0===o?void 0:o.disableComponents,f.componentKV=Object(c.T)(f.component,t.disableComponents),f.componentKV[t.pageId]=f.page,(null===(l=t.vueContext)||void 0===l?void 0:l.$store)&&t.vueContext.$store.commit("SET_RUNTIME_PAGE_KV_LOADED",p),t.data=f,A=t.data.component||[],t.setValues(A.concat(t.data.page),t.disableComponents),t.handleScriptAttrs(t.scriptAttrsCustomVariable),t.setPageVariables(),t.handleLinkVariableCustomVariable(),t.unwatchThemeColor=t.watchThemeColor(),t.onbeforeload.call(t.pageView,f),t.initLinkData((function(){t.handleScriptAttrs(t.scriptAttrs),t.handleVariableUseExpressionAttrs(),t.onload(f)}));case 31:case"end":return a.stop()}}),a)})))()},fireSDCOnLoadEvent:function(){var e=this;setTimeout((function(){!function t(a){a.forEach((function(a){var i;if(null!==(i=a.children)&&void 0!==i&&i.length&&t(a.children),"ContainerSDC"===a.name){var n=e.getComponent(a.fid);"function"==typeof(null==n?void 0:n.eventOnload)&&n.eventOnload()}}))}(e.data.component)}))},setTitle:function(e,t){if(!this.fromPageId){var a=this.vueContext.$store.getters.portalInfo,i=this.getPageTitle(e,t);i&&(document.title=i+"-"+((null==a?void 0:a.name)||""))}},getPageTitle:function(e,t){var a,i=null==e||null===(a=e.page)||void 0===a?void 0:a.attributes,n="array"===Object(u.g)(i)?i.find((function(e){return"pageTitle"===e.name})):null;return(null==n?void 0:n.value)||t||""},getPageView:function(){return this.pageView},setValues:function(e,t){var a=this;t="array"!==Object(u.g)(t)?[]:t,e.forEach((function(e){var i,n;if(!t.find((function(t){return t===e.name}))){e.children&&e.children.length&&a.setValues(e.children);var r={};Object(c.K)(e.attributes,(function(e){var t;null==e||e.alias,e.customGroupName&&Object(c.Db)(e.customGroupName,e,r),a.foreachAttrCallback(e);var i=e.linkId;if(i){if(a.setLinkIdAttrs(i,e),e.hasOwnProperty("defaultLoad")&&!1===e.defaultLoad)return;var n;"isCustomVariable"===e.customGroupName?(a.setVariableLinkIds(i),a.setVariableLinkIdVariableNames(null==e||null===(n=e.reserved)||void 0===n?void 0:n.objectName)):a.setOtherLinkIds(i)}else{var o=e.linkConfig;if(o)if("variable"!==o.accessType){var l,s;"script"===o.accessType&&("isCustomVariable"===e.customGroupName?(a.setScriptAttrsCustomVariable(e),a.setVariableScriptVariableNames(null==e||null===(l=e.reserved)||void 0===l?void 0:l.objectName)):a.setScriptAttrs(e)),"themeColor"===(null==e||null===(t=e.editValue)||void 0===t?void 0:t.type)&&a.setThemeColorAttrs(null==e||null===(s=e.editValue)||void 0===s?void 0:s.sign,e)}else{var u,d;"isCustomVariable"===e.customGroupName&&a.setVariableAttrsCustomVariable(o,e),a.setVariableAttrs(o,e),"themeColor"===(null==e||null===(u=e.editValue)||void 0===u?void 0:u.type)&&a.setThemeColorAttrs(null==e||null===(d=e.editValue)||void 0===d?void 0:d.sign,e)}}})),a.setCustomGroupName(e.fid,r,null==e||null===(i=e.attributes)||void 0===i||null===(n=i.componentName)||void 0===n?void 0:n.value)}}))},setCustomGroupName:function(e,t,a){this.customGroupNames[e]=t,a&&(this.customGroupNames[a]=t)},getCustomGroupNameAttrs:function(e,t){var a="object"===Object(u.g)(e)?e.fid:e;return a?t?this.customGroupNames[a]&&this.customGroupNames[a][t]:this.customGroupNames[a]:this.customGroupNames},setLinkIdAttrs:function(e,t){this.linkIdAttrs[e]=t},setVariableLinkIds:function(e){-1===this.variableLinkIds.findIndex((function(t){return t===e}))&&this.variableLinkIds.push(e)},setVariableLinkIdVariableNames:function(e){this.variableLinkIdVariableNames.push(e)},setVariableScriptVariableNames:function(e){this.variableScriptVariableNames.push(e)},setOtherLinkIds:function(e){-1===this.otherLinkIds.findIndex((function(t){return t===e}))&&this.otherLinkIds.push(e)},setVariableAttrsCustomVariable:function(e,t){if(t){var a="";if("static"===e.type)a=null==e?void 0:e.static;else{var i=null==e?void 0:e.variable;if("array"===Object(u.g)(i))a=this.compatible(i).join(".")}if(a)this.variableAttrsCustomVariable[a]?this.variableAttrsCustomVariable[a].push(t):this.variableAttrsCustomVariable[a]=[t]}},setThemeColorAttrs:function(e,t){this.themeColorAttrs[e]?this.themeColorAttrs[e].push(t):this.themeColorAttrs[e]=[t]},setVariableAttrs:function(e,t){var a=this;if(t){var i,n=e.type,r="";if("color"===t.editorDefined&&(null===(i=(null==e?void 0:e.static)||"")||void 0===i?void 0:i.replaceAll)&&this.setAttr(t,"editValue",{type:"themeColor",sign:((null==e?void 0:e.static)||"").replaceAll(".","_"),themeKey:null==e?void 0:e.static}),"static"!==n){var o=null==e?void 0:e.variable;if("array"===Object(u.g)(o))r=this.compatible(o).join(".");if(r)this.variableAttrs[r]?this.variableAttrs[r].push(t):this.variableAttrs[r]=[t]}else{if(!(r=null==e?void 0:e.static))return;var l=r.match(/\$\{(.*?)\}/g);if(!l||!l.length)return void((null==e?void 0:e.useExpression)?this.variableUseExpressionAttrs.push(t):t.value=r);l.forEach((function(e){var i=a.getVariableKeyByStr(e);i&&(a.variableAttrs[i]?a.variableAttrs[i].push(t):a.variableAttrs[i]=[t])}))}}},watchThemeColor:function(){var e=this;return this.themeColorValueFormat(),this.vueContext.$watch("$store.getters.themeConstColor.primary",(function(){return e.themeColorValueFormat()}))},themeColorValueFormat:function(){var e=this;Object.keys(this.themeColorAttrs||{}).forEach((function(t){(e.themeColorAttrs[t]||[]).forEach((function(t){var a;e.vueContext.$set(t,"value",Object(c.cb)(null==t||null===(a=t.editValue)||void 0===a?void 0:a.themeKey,e.vueContext.$store.getters||{},(function(e,t){return t?e[t]:Object(c.p)(e[t])||e[t]})))}))})),this.setValueByLinkVariable("theme");var t=this.__getPageVariables(),a=(null==t?void 0:t.theme)||{};Object.keys(a).forEach((function(t){return e.setValueByLinkVariable("theme.".concat(t))}))},compatible:function(e){if("string"===Object(u.g)(e))return e;var t=[],a=["Page","Arguments","pageVariable","customVariable","Response","Request",this.getPageFid()];return e.forEach((function(e){a.find((function(t){return t===e}))||t.push(e)})),t},setScriptAttrs:function(e){e&&this.scriptAttrs.push(e)},setScriptAttrsCustomVariable:function(e){e&&this.scriptAttrsCustomVariable.push(e)},getGeneralArgs:function(e){var t={},a=this.data.componentKV;return function e(i){var n=null==i?void 0:i.parentFid;if(n){var r=a[n];if(r){var o="block"===(null==r?void 0:r.name)?r.parentFid:n,l=a[o];if(null==l?void 0:l.iterationMode){var s=null==l?void 0:l.iterationNode;t.item=s||{}}else e(l)}}}(a[null==e?void 0:e.componentFid]),t},handleScriptAttrs:function(e){var t=this;return Object(r.a)(s.a.mark((function a(){var i,n,r,o,l,u,d,h,f,m,v,b;return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(e&&e.length){a.next=2;break}return a.abrupt("return");case 2:e=e||t.scriptAttrs,i=p(e),a.prev=4,i.s();case 6:if((n=i.n()).done){a.next=20;break}if(r=n.value,o=r.linkConfig){a.next=11;break}return a.abrupt("continue",18);case 11:if("script"===o.accessType){a.next=14;break}return a.abrupt("continue",18);case 14:if(l=o.content){a.next=17;break}return a.abrupt("continue",18);case 17:try{u=t.getGeneralArgs(r),void 0!==(d=t.parseScript(l,u,t.pageView))&&(t.setAttr(r,"value",d),f=(null==r||null===(h=r.reserved)||void 0===h?void 0:h.objectName)||"","isCustomVariable"===r.customGroupName&&f&&(v=(null==r||null===(m=r.reserved)||void 0===m?void 0:m.objectAttrName)||"",b=f+(v?"."+v:v),t.handleLinkVariable(b,d)))}catch(e){t.sendLog({logData:{message:e.message,info:Object(c.yb)({pageId:t.pageId,componentName:r.componentName,componentFid:r.componentFid,attrName:r.name,attrFid:r.fid})},logTitle:"关联脚本执行出错"})}case 18:a.next=6;break;case 20:a.next=25;break;case 22:a.prev=22,a.t0=a.catch(4),i.e(a.t0);case 25:return a.prev=25,i.f(),a.finish(25);case 28:case"end":return a.stop()}}),a,null,[[4,22,25,28]])})))()},handleVariableUseExpressionAttrs:function(){var e=this;this.variableUseExpressionAttrs.forEach((function(t){var a=e.compileStaticVariable(t);e.setAttr(t,"value",a)}))},handleLinkVariableCustomVariable:function(){var e=this;for(var t in[].concat(Object(n.a)(this.variableScriptVariableNames),Object(n.a)(this.variableLinkIdVariableNames)).forEach((function(t){delete e.variableAttrsCustomVariable[t]})),this.variableAttrsCustomVariable)this.setValueByLinkVariable(t)},handleLinkVariable:function(e,t){if(e){if("object"===Object(u.g)(t))for(var a in t){var i=t[a],n=e+"."+a;"object"===Object(u.g)(i)&&this.handleLinkVariable(n,i),this.setValueByLinkVariable(n,i)}this.setValueByLinkVariable(e,t)}else for(var r in this.variableAttrs)this.variableAttrsCustomVariable[r]||this.setValueByLinkVariable(r,t)},setValueByLinkVariable:function(e,t){var a=this,i=this.variableAttrs[e];i&&i.length&&i.forEach((function(t){var i,n,r,o;o="static"===(null==t||null===(i=t.linkConfig)||void 0===i?void 0:i.type)?a.compileStaticVariable(t):a.getVariable(e);var l=null==t||null===(n=t.reserved)||void 0===n?void 0:n.objectName,s=null==t||null===(r=t.reserved)||void 0===r?void 0:r.objectAttrName;if("value"===(null==t?void 0:t.name)&&l&&!s){var c,u,d,p,h=null===(c=a.data)||void 0===c||null===(u=c.page)||void 0===u||null===(d=u.attributes)||void 0===d||null===(p=d.customVariable)||void 0===p?void 0:p.attributes,f=null;if(h.forEach((function(e){var t,a;(null==e||null===(t=e.name)||void 0===t?void 0:t.value)===l&&null!=e&&null!==(a=e.isObject)&&void 0!==a&&a.value&&(f=e)})),f)return void a.setVariable(l,o)}if(t.value!==o&&(a.setAttr(t,"value",o),"value"===(null==t?void 0:t.name))){var m=l?s?l+"."+s:l:"";m&&a.setValueByLinkVariable(m,o,t)}}))},initLinkData:function(e){this.variableLinkIds.length?this.handleVariableLinkIds(e):(this.handleLinkVariable(),this.handleOthersLinkIds(),e())},setPageVariables:function(){if(this.pageVariables)for(var e in this.pageVariables){var t=this.pageVariables[e];this.setVariable(e,t)}},handleVariableLinkIds:function(e){var t=this;this.variableLinkIds.length?this.requestLinkData(this.variableLinkIds,null,(function(){t.getVariableLinkValues()}),null,(function(a){t.handleLinkVariable(),t.handleOthersLinkIds(),e()})):e()},getVariableLinkValues:function(e){var t=this.data.page.attributes.customVariable.attributes.filter((function(e){var t;return null===(t=e.value)||void 0===t?void 0:t.linkId}));e&&(t=t.filter((function(t){var a;return e.includes(null===(a=t.value)||void 0===a?void 0:a.linkId)})));var a=t.map((function(e){return{name:e.name.value,value:e.value.value}}));if(this.pageView.$eventContentParse){var i=this.data.page.attributes,n=i&&i.afterRefreshAsyncVariables,r=n&&n.attributes,o=r&&r.content;(o.attributes||[]).find((function(e){var t;return!(null==e||null===(t=e.executionType)||void 0===t||!t.value)}))&&this.pageView.$eventContentParse(o,{value:a})}},checkLinkOfComponentByLinkFid:function(e,t){var a=this.getParentComponent(e,!0);return a&&((null==a?void 0:a.fid)===t||a.parentFid&&this.checkLinkOfComponentByLinkFid(a.fid,t))},handleOthersLinkIds:function(e){var t=this;if(this.otherLinkIds.length){var a=this.otherLinkIds;if(e){var i=this.getForeachItemKey(e);i.indexOf("_")>-1&&73===i.length&&(i=Reflect.ownKeys(this.data.componentKV||{}).find((function(e){var a=t.data.componentKV[e];return(null==a?void 0:a.rowId)+"_"+(null==a?void 0:a.colId)===i}))),a=this.otherLinkIds.filter((function(e){var a=t.linkIdAttrs[e];return a&&t.checkLinkOfComponentByLinkFid(a.componentFid,i)&&"foreachData"!==a.name}))}this.requestLinkData(a,null,(function(){t.getVariableLinkValues()}),null,null,e)}},getValidateLinks:function(e,t){var a=this,i=this.vueContext.$store.getters.portalInfo,n=Object(u.h)(window.location.href,"projectIdentifier")||!i.isManagement&&i.nameEn;return e=e.filter((function(e){var i,r,o,l,s=a.getAttrByLinkId(e);return t&&(s=a.getCopyLinkAttrByCopyFidAndAttr(t,s)||s),!(null!==(i=s)&&void 0!==i&&null!==(r=i.linkConfig)&&void 0!==r&&r.projectIdentifier)||(null===(o=s)||void 0===o||null===(l=o.linkConfig)||void 0===l?void 0:l.projectIdentifier)===n}))},requestLinkData:function(e,t,a,i,n,o){var l=this;return Object(r.a)(s.a.mark((function r(){var d,p,h,f,m,v,b;return s.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(("array"!==Object(u.g)(e)||e.length)&&e){r.next=2;break}return r.abrupt("return");case 2:if(e=l.getValidateLinks(e,o),null==(d=Object(c.db)(e.map((function(e){return l.linkIdAttrs[e]}))))||!d.length){r.next=8;break}return p=function(){return d.every((function(e){return Object(c.q)(e,l.pageId)}),l)},r.next=8,Object(c.Eb)(p,null,1e4);case 8:h=l.getVariablesByLinkId(e,o),f=Object(c.M)(Object.assign(h||{},t||{})),m=l.vueContext.$store.getters.portalInfo,(v=Object(u.h)(window.location.href,"projectIdentifier")||(m.isManagement?"":m.nameEn))&&(f.projectIdentifier=v),b={url:"/api/compdata/datalinks",method:"post",data:{linkIds:"string"===Object(u.g)(e)?[e]:e,params:f},meta:{validate:!0}},l.vueContext.$util.request(b).then((function(e){l.handleLinkData(e,o),"function"===Object(u.g)(a)&&a(e)})).catch((function(t){l.handleLinkDataError(e,t,o),"function"===Object(u.g)(i)&&i(t)})).finally((function(e){"function"===Object(u.g)(n)&&n(e)}));case 15:case"end":return r.stop()}}),r)})))()},getVariablesByLinkId:function(e,t){var a=this;if(("array"!==Object(u.g)(e)||e.length)&&e){var i=m({},this.__getCustomVariables()),n={},r=!1;return e.forEach((function(e){var o=a.linkIdAttrs[e],l=null==o?void 0:o.linkConfig;if(l&&!l.hasOwnProperty("variables")&&(r=!0),!r){var s=null==l?void 0:l.variables;if(s){var d=t&&a.findForeachItemAndIndex(t),p=m(m({},i),d||{});if("string"==typeof(null==o?void 0:o.defaultArgs)){var h=Object(u.j)(null==o?void 0:o.defaultArgs);i=m(m({},h),i),p=m(m({},h),p)}s.forEach((function(e){var t=a.getVariable(e);if(t)n[e]=t;else{if(e.indexOf(":")>-1){var r=e.slice(0,e.indexOf(":")),o=Object(c.q)(r,a.pageId),l=a.__getCustomVariables.apply(o);for(var s in l)i["".concat(r,":").concat(s)]=l[s],p["".concat(r,":").concat(s)]=l[s]}if(-1!==e.indexOf(".")){var u=e.split("."),d=null;return u.forEach((function(e,t){d=0===t?p&&p[e]:d&&d[e]})),void(n[e]=d)}n[e]=i[e]}}))}}})),r?i:n}},getComponentNameByLinkAttr:function(e){if(e){var t=this.getAttrByLinkId(e);if(t)return t.componentType}},getCopyChildByParentFidAndModelName:function(e,t){var a,i,n,r=this.getComponent(e),o=function(e,t){return new RegExp("^".concat(e,"-copy-\\d+")).test(t||"")};if(o(t,null===(a=r.data.attributes)||void 0===a||null===(i=a.componentName)||void 0===i?void 0:i.value))return r.data;return function e(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(null!=a&&a.length){var i,n=p(a);try{for(n.s();!(i=n.n()).done;){var r,l,s=i.value;if(o(t,null===(r=s.attributes)||void 0===r||null===(l=r.componentName)||void 0===l?void 0:l.value))return s;var c=e(s.children);if(c)return c}}catch(e){n.e(e)}finally{n.f()}}}(null==r||null===(n=r.data)||void 0===n?void 0:n.children)},getCopyLinkAttrByCopyFidAndAttr:function(e,t){var a;if(e){var n=this.getCopyChildByParentFidAndModelName(e,null==t?void 0:t.componentName)||{};a="object"===Object(i.a)(n.attributes)&&n.attributes[null==t?void 0:t.name]||m(m({},t),{},{componentFid:n.fid||t.componentFid})}else a=t;return a},dataLinkMountedHandler:function(e,t,a){var i=t.dataLinkMountedHandler;if(i){var n=t.componentFid,r=this.getComponentMethod(n,i);"function"===Object(u.g)(r)&&r(e,t,a)}},handleLinkDataError:function(e,t,a){var i=this,n={};e.forEach((function(e){var r=t,o=i.getAttrByLinkId(e);a&&(o=i.getCopyLinkAttrByCopyFidAndAttr(a,o)||o),n[o.componentFid]||(n[o.componentFid]=[]),n[o.componentFid].push(e),i.dataLinkMountedHandler(!1,o,r)})),this.componentDataLinkMountedHandler(n)},updateDataContainerChildren:function(e){for(var t in this.variableAttrs)t.startsWith(e)&&this.setValueByLinkVariable(t)},transformDataContainerValue:function(e,t){if("ContainerArray"===e.componentType)return Object(c.v)(t,e.linkConfig);if("ContainerObject"===e.componentType){var a=Object(c.v)(t,e.linkConfig);return a.result.length&&a.result[0]}return t},componentDataLinkMountedHandler:function(e){var t=this;Object.keys(e||{}).forEach((function(a){var i=t.getComponent(a),n=null==i?void 0:i.allDataLinkMountedHandler;"function"==typeof n&&n(e[a])}))},handleLinkData:function(e,t){var a=this;if(e&&e.length){var i={};e.forEach((function(e){var n=e.error,r=null==e?void 0:e.linkId,o=a.getAttrByLinkId(r);if(t&&(o=a.getCopyLinkAttrByCopyFidAndAttr(t,o)||o),i[o.componentFid]||(i[o.componentFid]=[]),i[o.componentFid].push(r),n)return a.dataLinkMountedHandler(!1,o,n),void a.errorLinkHandler(e,n);var l=e.data;l?o&&(c.c.includes(o.componentType)&&"value"===o.name&&(l=a.transformDataContainerValue(o,l)),a.setAttr(o,"value",l),a.dataLinkMountedHandler(!0,o,l)):a.dataLinkMountedHandler(!1,o,l)})),this.componentDataLinkMountedHandler(i)}},errorLinkHandler:function(e,t){var a=t||{message:"操作失败"},i=a.errorCode,n=(a.message,a.moreInfo,["81020007","81020008","81020009","81010026"]);try{n.includes(i)?this.vueContext.$store&&this.vueContext.$store.commit("CLEAR_ALL_DATA"):["8101001a"].includes(i)||["8110001c"].includes(i)}catch(e){}},setComponentAttr:function(e,t,a,i){var n=this;i&&"object"===Object(u.g)(i)&&Object(c.K)(i.attributes,(function(i){if(i.name===e)return n.setAttr(i,t,a),!1}))},setComponentAttrByFid:function(e,t,a,i){var n=this;i&&"object"===Object(u.g)(i)&&Object(c.K)(i.attributes,(function(i){if(i.fid===e)return n.setAttr(i,t,a),!1}))},setVariable:function(e,t,a){if(e){var i=Object(u.g)(e),n=Object(c.qb)(t,a),r=this.data.page.attributes.customVariable.attributes,o=d.a.formatValue(r,e,n);if("string"!==i){var l=e.linkConfig;if(l)if("static"!==l.type){var s=l.variable;s&&this.setVariableValue(s,o,e)}else{var p=l.static;if(!p)return;var h=p.match(/\$\{(.*?)\}/g);if(!h||!h.length)return;if(h.length>1||h[0]!==p)return;var f=this.getVariableKeyByStr(p);if(!f)return;this.setVariableValue(f,o,e)}}else this.setVariableValue(e,o,e)}},setVariableValue:function(e,t,a){var i=this.compatible(e),n="array"===Object(u.g)(i)?i.join("."):i;"string"==typeof n&&n.indexOf(":")>-1&&(n=n.slice(n.lastIndexOf(":")+1));if(["item","itemIndex"].includes(n)||-1!==n.indexOf("item."))this.handleSetForeachItemValue(n,t,a);else{this.handleSetVariable(t,n,""),this.handleLinkVariable(n,t)}},findForeachItemAndIndex:function(e){var t,a,i;if(!e)return{item:null,itemIndex:-1};var n=this.getForeachItemData(e);if(n)return{item:n,itemIndex:this.getForeachItemIndex(e)};var r=this.getParentComponent(e),o="Page"===(null==r||null===(t=r.page)||void 0===t||null===(a=t.attributes)||void 0===a||null===(i=a.componentName)||void 0===i?void 0:i.value);return r&&"Page"!==r.name&&!o?this.findForeachItemAndIndex(r.fid):{item:null,itemIndex:-1}},handleSetForeachItemValue:function(e,t,a){var i=this,n=this.findForeachItemAndIndex(null==a?void 0:a.componentFid);if(n){var r=n.item;if(r){var o=e.split(".").filter((function(e,t){return t>0})),l=o.length,s=r;o.forEach((function(e,a){if(s.hasOwnProperty(e)){if(a+1===l)return void i.setAttr(s,e,t);s=s[e]}}))}}},handleSetScopedVariable:function(e,t,a,i){var n=(t||"").split("."),r=(n[0]||"").split("_")[0],o=this.data.componentKV||{},l=Object.values(o).find((function(e){var t,a;return(null===(t=e.attributes)||void 0===t||null===(a=t.componentName)||void 0===a?void 0:a.value)===r}));if(c.c.includes(null==l?void 0:l.name)){var s,u=null==l||null===(s=l.attributes)||void 0===s?void 0:s.value;n.length<=1?u.value=e:n.forEach((function(t,a){0===a?u=u.value:a===n.length-1?u[t]=e:u=u[t]}))}else i(l.attributes.scopedVariable.attributes,r,"_")},handleSetVariable:function(e,t,a){var i=this,n=function a(n,r){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".";n.forEach((function(n){var l=n.name.value,s=r?r+o+l:l;if(s!==t){var u=i.getObjectAttrs(n);u&&a(u,s)}else{var d=i.getObjectAttrs(n),p=Object(c.x)(e);if(d)return i.handleSetSubAttr(d,p),void i.removeAttr(n.value,"value");n.value.value!==e&&i.setAttr(n.value,"value",e)}}))},r=((t||"").split(".")[0]||"").split("_")[0],o=this.data.componentKV||{},l=Object.values(o).find((function(e){var t,a;return(null===(t=e.attributes)||void 0===t||null===(a=t.componentName)||void 0===a?void 0:a.value)===r}));c.b.includes(null==l?void 0:l.name)?this.handleSetScopedVariable(e,t,a,n):n(this.data.page.attributes.customVariable.attributes,a)},handleSetSubAttr:function(e,t){var a=this;e.forEach((function(e){var i=e.name.value,n=t?t[i]:t,r=a.getObjectAttrs(e);if(r)return a.handleSetSubAttr(r,n),void a.removeAttr(e.value,"value");e.value.value!==n&&a.setAttr(e.value,"value",n)}))},clearVariable:function(e){this.setVariable(e,void 0)},getObjectAttrs:function(e){var t=!1;e.isObject&&(t=Object(c.pb)(e.isObject.value,e.isObject.default));var a=null;return t&&e.objectAttr&&(a=e.objectAttr.attributes),a},setAttr:function(e,t,a){if("value"===t&&(this.handleAttrChange(e,a),this.vueContext.$setAttr(e,"lastValue",a)),this.vueContext.$setAttr(e,t,a),"value"===t){var i=c.b.includes(e.componentType)&&("value"===e.name||new RegExp(c.j).test(e.name));"value"===t&&i&&this.updateDataContainerChildren(e.componentName)}},removeAttr:function(e,t){"value"===t&&this.handleAttrChange(e,void 0),this.vueContext.$removeAttr(e,t)},sendLog:function(e){e&&this.vueContext.$sendLog(e)},handleAttrChange:function(e,t,a){var i=e.changeHandler;if(i){var n=e.componentFid,r=this.getComponent(n);if(!r){var o={value:t,oldVal:Object(u.e)(e.lastValue),target:e};return this.unfinishedChangeHandlers[n]?this.unfinishedChangeHandlers[n].push(o):this.unfinishedChangeHandlers[n]=[o],void this.sendLog({logData:{message:"组件实例未初始化",info:Object(c.yb)({pageId:this.pageId,componentName:e.componentName,componentFid:e.componentFid,attrName:e.name,attrFid:e.fid})},logTitle:"属性设置执行changeHandler"})}var l=r[i];"function"===Object(u.g)(l)&&l.call(r,t,a||Object(c.pb)(e.value,e.default),this.customGroupNames[n],void 0,e)}},doneChangeHandlers:function(e){var t=this,a=this.unfinishedChangeHandlers[e];a&&a.length&&(a.forEach((function(e){t.handleAttrChange(e.target,e.value,e.oldVal)})),delete this.unfinishedChangeHandlers[e])},__getScopedVariables:function(e,t,a){if(!a)return{};var i={};if(c.c.includes(a.name)){var n,r,l,s,u=Object(c.pb)(null==a||null===(n=a.attributes)||void 0===n||null===(r=n.value)||void 0===r?void 0:r.value,null==a||null===(l=a.attributes)||void 0===l||null===(s=l.value)||void 0===s?void 0:s.default);i=Object(o.a)({},t,u)}else{var d=this.__getCustomVariables(a.attributes.scopedVariable);Object.keys(d).forEach((function(t){i[t.startsWith(e)?t:"".concat(e,"_").concat(t)]=d[t]}))}return i},getVariable:function(e){var t=this.__getPageVariables(),a=this.__getCustomVariables(),i=[],n=(e||"").split(".")[0],r=(n||"").split("_")[0],o=this.data.componentKV||{},l=Object.values(o).find((function(e){var t,a;return(null===(t=e.attributes)||void 0===t||null===(a=t.componentName)||void 0===a?void 0:a.value)===r}));"string"==typeof e&&c.b.includes(null==l?void 0:l.name)&&(i=this.__getScopedVariables(r,n,l));var s=m(m(m({},t),a),i||{});return e?Object(c.qb)(s,e):s},getPageData:function(){return this.data},getLinkIdAttrs:function(){return this.linkIdAttrs},getAttrByLinkId:function(e){return this.linkIdAttrs[e]},closeDialog:function(){this.dialog&&this.dialog.close()},closeDrawer:function(){this.drawer&&this.drawer.close&&this.drawer.close()},getFromPage:function(){if(this.fromPageId)return this.vueContext.$store.getters.getPageParserInstanceByPageId(this.fromPageId)},getComponents:function(){return this.vueContext.$store.getters.getComponentInstanceByPageId(this.pageId)},getComponent:function(e){var t=this.getComponents();if(t&&e)return t[e]},getComponentMethod:function(e,t){var a=this.getComponent(e);if(a)return a[t]},getPageStatus:function(){return this.pageStatus},getPageFid:function(){var e,t;return null===(e=this.data)||void 0===e||null===(t=e.page)||void 0===t?void 0:t.fid},parseScript:function(e,t,a){if(!e)return e;var i=this.getPageStatus();e="preview"===i||window.__debug?e:Object(c.H)(e);var n=Object.assign({},window.console,{__pageStatus:i}),r=m(m({},t||{}),{},{console:n}),o=Object.keys(r).join(",");return new Function("Arguments","const { ".concat(o," } = Arguments; \n")+e).call(a||this,r)},validation:function(e){var t=this,a=[],i=[];!function e(n){var r;if(n)if("string"===Object(u.g)(n)){var o=t.getComponent(n);r=o&&o.data.children}else r=n;else r=t.data.component;r&&r.length?r.forEach((function(n){var r,o,l,s,d=null==n||null===(r=n.attributes)||void 0===r?void 0:r.display;if(d&&!1===Object(c.pb)(d.value,d.default))a.push(!0);else{var p=null==n||null===(o=n.attributes)||void 0===o?void 0:o.visibility;if(p&&"inherit"!==Object(c.pb)(p.value,p.default))a.push(!0);else if(n.children&&n.children.length)e(n.children);else if(n.children&&n.children.length)e(n.children);else if("form"===n.groupName||"Table"===n.name){var h=null==n||null===(l=n.attributes)||void 0===l||null===(s=l.componentName)||void 0===s?void 0:s.value,f=t.getComponent(n.fid),m=f&&f.validate;if(!m)return void a.push(!0);try{a.push(!("function"===Object(u.g)(m)&&!m.call(f))),"function"!==Object(u.g)(m)||m.call(f)||i.push(f.$el)}catch(e){t.sendLog({logData:{message:"执行组件校验方法错误",info:Object(c.yb)({pageId:t.pageId,componentName:h,componentFid:n.fid,functionName:"validate"})},logTitle:"执行组件校验方法错误"})}}else a.push(!0)}})):a.push(!0)}(e);var n=a.every((function(e){return e}));return n||setTimeout((function(){if(!(i.length<1))if("iframe-table"===i[0]._prevClass){var e=i[0].querySelectorAll(".item_error"),t=i[0].querySelector(".el-table__body-wrapper"),a=i[0].querySelector(".el-table__body").getBoundingClientRect().top;e.length>0&&(t.scrollTop=e[0].getBoundingClientRect().top-a)}else i[0].scrollIntoView({block:"center",behavior:"smooth"})})),n},clearValidate:function(e){var t=this;!function e(a){var i;if(a)if("string"===Object(u.g)(a)){var n=t.getComponent(a);i=n&&n.data.children}else i=a;else i=t.data.component;if(i&&i.length){var r,o=p(i);try{for(o.s();!(r=o.n()).done;){var l,s,d,h,f=r.value,m=null==f||null===(l=f.attributes)||void 0===l?void 0:l.display;if(!m||!1!==Object(c.pb)(m.value,m.default)){var v=null==f||null===(s=f.attributes)||void 0===s?void 0:s.visibility;if(!v||"inherit"===Object(c.pb)(v.value,v.default))if(f.children&&f.children.length)e(f.children);else if("form"===f.groupName||"Table"===f.name){var b=null==f||null===(d=f.attributes)||void 0===d||null===(h=d.componentName)||void 0===h?void 0:h.value,g=t.getComponent(f.fid),y=g&&g.clearValidate;if(g&&(y||g.hasOwnProperty("validateResult")))try{y&&"function"===Object(u.g)(y)?y.call(g):(g.validateResult=!0,g.validateMsg="",g.borderColor="",g.borderRed="")}catch(e){t.sendLog({logData:{message:"组件清除校验错误",info:Object(c.yb)({pageId:t.pageId,componentName:b,componentFid:f.fid})},logTitle:"组件清除校验错误"})}}}}}catch(e){o.e(e)}finally{o.f()}}}(e)},locateComponentsInTabs:function(e){var t=this.collectTabIndexes(e);this.setTabsActives(t)},collectTabIndexes:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments.length>2?arguments[2]:void 0,i=this.getComponentByFid(e);if(!i)return t;var n=null==i?void 0:i.parentFid,r=null==i?void 0:i.tabIndex;return void 0!==a&&t.push({fid:i.fid,childTabIndex:a,name:i.name}),n?this.collectTabIndexes(n,t,r):t},setTabsActives:function(e){var t=this;e.forEach((function(e){var a=t.getComponent(e.fid);a.setActiveIndex&&a.setActiveIndex({tabIndex:e.childTabIndex})}))},refresh:function(){var e=this;this.requestLinkData([].concat(Object(n.a)(this.variableLinkIds),Object(n.a)(this.otherLinkIds)),null,(function(){e.getVariableLinkValues()}))},parseStatic:function(e){var t=this.getVariableKeyByStr(e);return t?this.getVariable(t):e},getUseExpressionResult:function(e,t,a,i){var n=this;if(!e)return e;var r={};if(t){var o={};t.forEach((function(t){var l=n.getVariableKeyByStr(t,!0);if(l){var s=o[l]=o[l]||"$var_".concat(Object(c.jb)());r[s]=n.parseStaticByForeach(t,a,i),e=e.replace(t,s)}}))}try{return this.parseScript("return ".concat(e),r,this.pageView)}catch(t){return e}return e},compileStaticVariable:function(e){var t,a,i=this,n=null==e||null===(t=e.linkConfig)||void 0===t?void 0:t.static,r=null==e||null===(a=e.linkConfig)||void 0===a?void 0:a.useExpression,o=null==e?void 0:e.foreachItemKey,l=o?this.getForeachItemData(o):null;if(n){var s=n.match(/\$\{(.*?)\}/g);if(!s||!s.length)return r?this.getUseExpressionResult(n):n;if(r)return this.getUseExpressionResult(n,s,l,o);var c=n;return s.forEach((function(e){c=c.replace(e,i.parseStaticByForeach(e,l,o))})),c}},getDialog:function(){return this.dialog},getDrawer:function(){return this.drawer},getDialogHeight:function(){if(this.dialog){var e=this.dialog.height;return this.dialog.hasOwnProperty("height")?(e=Number(e.replace("px","")),isNaN(e)?"auto":e||"auto"):"auto"}},setComponentKV:function(e){this.data.componentKV[e.fid]=e.data},getComponentByFid:function(e){return this.data.componentKV[e]},removeComponentKV:function(e){var t=this;e&&(e="string"===Object(u.g)(e)?[e]:e,"array"===Object(u.g)(e)&&e.forEach((function(e){delete t.data.componentKV[e]})))},setForeachKeyData:function(e,t){this.foreachKeyDatas[e]=t},getForeachKeyData:function(e){return this.foreachKeyDatas[e]},setForeachItemKey:function(e,t){this.foreachItemKeys[e]=t},getForeachItemKey:function(e){return this.foreachItemKeys[e]},setForeachItemData:function(e,t){this.foreachItemDatas[e]=t},getForeachItemData:function(e){return this.foreachItemDatas[e]},getCopyComponentFids:function(e,t){return e?t?this.copyComponentAllFids[e]:this.copyComponentFids[e]:t?this.copyComponentAllFids:this.copyComponentFids},addCopyComponentFids:function(e,t,a){if(e&&t)return a?this.copyComponentAllFids[e]?void this.copyComponentAllFids[e].push(t):void(this.copyComponentAllFids[e]=[t]):void(this.copyComponentFids[e]?this.copyComponentFids[e].push(t):this.copyComponentFids[e]=[t])},removeCopyComponentFids:function(e,t){if(e){if(t){var a=this.copyComponentAllFids[e];return this.removeComponentKV(a),void this.removeCopyItems(a)}var i=this.copyComponentFids[e];this.removeComponentKV(i)}},removeCopyItems:function(e){var t=this;e&&(e="string"===Object(u.g)(e)?[e]:e,"array"===Object(u.g)(e)&&e.forEach((function(e){delete t.copyItemVariables[e],delete t.copyItemScripts[e],delete t.copyItemLinkIds[e]})))},isItemVariableAttr:function(e){var t=null==e?void 0:e.linkConfig;if("static"===(null==t?void 0:t.type)){var a=t.static;return!!a&&0===a.indexOf("item")}var i=t.variable;return!(!i||!i.length)&&0===i[0].indexOf("item")},addCopyItemVariables:function(e,t){t.foreachItemKey=e,this.copyItemVariables.hasOwnProperty(e)||(this.copyItemVariables[e]=[]),this.copyItemVariables[e].push(t),this.isItemVariableAttr(t)||this.setVariableAttrs(t.linkConfig,t)},addCopyItemScripts:function(e,t){this.copyItemScripts.hasOwnProperty(e)||(this.copyItemScripts[e]=[]),this.copyItemScripts[e].push(t)},addCopyItemLinkIds:function(e,t){this.copyItemLinkIds.hasOwnProperty(e)||(this.copyItemLinkIds[e]=[]),this.copyItemLinkIds[e].push(t)},setCopyComponentOrigin:function(e,t){this.copyComponentOrigin[e]=t},getCopyComponentOrigin:function(e){return this.copyComponentOrigin[e]},getCopyComponent:function(e,t,a){var i=this;this.setCopyComponentOrigin(a,e);var n=Object(c.P)(e,(function(e,t){if(!t)return e;var n=(i.getCopyComponentFids(a)||[]).length,r=t.indexOf("-copy-");return(-1===r?t+"-copy-":t.substring(0,r+6))+n}),(function(e,n){if(n)return i.setComponentKV({fid:e,data:n}),void("block"!==n.name&&i.addCopyComponentFids(a,e,!0));var r=(n=e).linkConfig;r&&("variable"!==r.accessType?"script"!==r.accessType?i.addCopyItemLinkIds(t,n):i.addCopyItemScripts(t,n):i.addCopyItemVariables(t,n))}),t);return this.addCopyComponentFids(a,t),this.addCopyComponentFids(a,t,!0),n},setCopyItemLinkData:function(e,t){this.setCopyItemVariables(e,t),this.setCopyItemScripts(e,t),this.handleOthersLinkIds(t)},setCopyItemVariables:function(e,t){var a=this,i=this.copyItemVariables[t];i&&"array"===Object(u.g)(i)&&i.forEach((function(i){var n=i.foreachItemKey===i.componentFid,r=null==i?void 0:i.linkConfig;if("static"===(null==r?void 0:r.type)){var o=r.static;if(!o)return;var l=o.match(/\$\{(.*?)\}/g);if(!l||!l.length){if(null!=r&&r.useExpression){var s=a.getUseExpressionResult(o);a.setAttr(i,"value",s)}return}if(l.join("")===o){var u=a.parseStaticByForeach(o,e,t);return void a.setAttr(i,"value",u)}if(null!=r&&r.useExpression){var d=a.getUseExpressionResult(o,l,e,t);return void a.setAttr(i,"value",d)}var p=o;return l.forEach((function(i){p=p.replace(i,a.parseStaticByForeach(i,e,t))})),void a.setAttr(i,"value",p)}var h=r.variable;if(h&&h.length){var f=h[0];if(!f.startsWith("$parent_")||!n){if(-1!==f.indexOf("itemIndex")){var m=a.getForeachItemIndex(t);return a.setAttr(i,"value",m)}if(-1!==f.indexOf("itemId"))return a.setAttr(i,"value",t);if(-1===f.indexOf("item")){var v=h.join(".");i.value=a.getVariable(v)}else{var b=h.filter((function(e,t){return 0!==t})).join("."),g=Object(c.qb)(e,b);a.setAttr(i,"value",g)}}}}))},getVariableKeyByStr:function(e,t){if(!e)return e;var a=/^\${(.+)}$/g.exec(e);if(!a)return"";var i=(a[1]||"").trim();return!0===t?i.replaceAll(".","__"):i},parseStaticByForeach:function(e,t,a){var i=this.getVariableKeyByStr(e);if(!i)return e;if(-1!==i.indexOf("itemIndex"))return this.getForeachItemIndex(a);if(-1!==i.indexOf("itemId"))return a;if(-1!==i.indexOf("item")){var n=i.split(".");if(1===n.length)return t;var r=n.filter((function(e,t){return 0!==t})).join(".");return Object(c.qb)(t,r)}return this.getVariable(i)},setCopyItemScripts:function(e,t){var a=this,i=this.copyItemScripts[t];i&&"array"===Object(u.g)(i)&&i.forEach((function(i){var n={item:e,itemIndex:a.getForeachItemIndex(t)},r=i.linkConfig.content;if(r){var o=a.parseScript(r,n,a.pageView);void 0!==o&&(i.value=o)}}))},getForeachItemIndex:function(e){var t=this.getForeachItemData(e);if(!t)return-1;var a=this.getForeachItemKey(e),i=this.getForeachKeyData(a);return i?i.findIndex((function(e){return e===t})):-1},getParentComponent:function(e,t){if(e){var a=this.data.componentKV,i=a[e],n=null==i?void 0:i.parentFid;if(!n)return this.data||void 0;var r=a[n];if(r)return"block"!==r.name||t||(r=a[r.parentFid]),r}},setCopyItemLinkIds:function(e,t){},__getPageVariables:function(){return Object(c.hb)(this.data.page.attributes.pageVariable,this)},__getCustomVariables:function(e){return Object(c.ab)(e||this.data.page.attributes.customVariable)},destroy:function(){var e=this;"function"==typeof this.unwatchThemeColor&&this.unwatchThemeColor(),this.unwatchThemeColor=null,Object.keys(this).forEach((function(t){var a,i;"string"==typeof t&&t.startsWith("$_")&&window.Vue.prototype["".concat(t,"_").concat(e.pageId)]&&(window.Vue.prototype["".concat(t,"_").concat(e.pageId)]=null,delete window.Vue.prototype["".concat(t,"_").concat(e.pageId)],"number"==typeof(null===(a=window.Vue.prototype["".concat(t)])||void 0===a?void 0:a.__count)&&window.Vue.prototype["".concat(t)].__count--,(null===(i=window.Vue.prototype["".concat(t)])||void 0===i?void 0:i.__count)<=0&&(window.Vue.prototype["".concat(t)]=null,delete window.Vue.prototype["".concat(t)])),setTimeout((function(){delete e[t]}),0)})),window.$VUE_ROOT.$store.commit("DELETE_PAGE_PARSER_INSTANCE_BY_PAGE_ID",this.pageId)}},t.a=v},"1a85":function(e,t,a){"use strict";a("178d")},"1ac1":function(e){e.exports=JSON.parse('{"name":"ContainerSDC","alias":"二开组件","version":"1.0.0","author":"10026318","groupAlias":"容器","groupName":"container","type":"vue","description":"","order":4001,"visible":false,"attributes":[{"name":"general","alias":"通用","sort":100,"attributes":[{"name":"componentName","alias":"组件名称","type":"String","readonly":true,"default":"","value":"$T-SDC"},{"name":"dataType","alias":"组件数据类型","type":"String","default":"Object","linkable":false,"visible":false},{"name":"uuid","alias":"组件唯一标识","type":"String","default":"T","linkable":false,"visible":false},{"name":"sourceId","alias":"资源标识","type":"String","default":"","linkable":false,"visible":false},{"name":"sourceVersion","alias":"资源版本","type":"String","default":"","linkable":false,"visible":false},{"name":"sourceName","alias":"资源名称","type":"String","default":"","linkable":false,"visible":false},{"name":"sourcePath","alias":"资源路径","type":"String","default":"","linkable":false,"visible":false}]},{"name":"appearance","alias":"外观","sort":200,"visible":false},{"name":"layout","alias":"布局","sort":300,"attributes":[{"name":"lg","alias":"栅格数量","type":"Number","default":24,"min":1,"max":24,"precision":0,"tips":"屏幕分辨率中，宽度≥1200px 响应式栅格数，栅格布局将一行分为24列，栅格数量则为栅格占据的列数","sort":3001},{"name":"span","alias":"栅格数量md","type":"Number","default":24,"min":1,"max":24,"precision":0,"tips":"屏幕分辨率中，992px≤宽度<1200px 响应式栅格数，栅格布局将一行分为24列，栅格数量则为栅格占据的列数","sort":3002},{"name":"sm","alias":"栅格数量sm","type":"Number","default":24,"min":1,"max":24,"precision":0,"tips":"屏幕分辨率中，768px≤宽度<992px 响应式栅格数，栅格布局将一行分为24列，栅格数量则为栅格占据的列数","sort":3003},{"name":"xs","alias":"栅格数量xs","type":"Number","default":24,"min":1,"max":24,"precision":0,"tips":"屏幕分辨率中,宽度<768px 响应式栅格数，栅格布局将一行分为24列，栅格数量则为栅格占据的列数","sort":3004},{"name":"height","alias":"高度","type":"String","default":"auto","tips":"允许四种值：1.自动:auto；2.数字+px:300px；3.百分比:50%；4.表达式:calc(100% - 140px)","sort":3203,"customGroupName":"filledHeight","rules":[{"pattern":"/^(__quote:percentage__|([1-9]?[0-9]{0,3}px)|(auto)|(calc\\\\(.*\\\\)))$/","message":"请输入auto、百分比、数字+px、表达式中的一种"}]},{"name":"borderVisible","alias":"边框显示","type":"Boolean","default":false,"sort":3500,"changeHandler":"basicChangeHandler","visible":false}]},{"name":"imports","alias":"引用","sort":490,"attributes":[{"name":"importsManager","type":"Complex","editor":"import-attrs","editorParams":{"name":"属性管理"},"sort":9999,"linkable":false,"visible":false}]},{"name":"variable","alias":"变量","sort":500,"attributes":[{"name":"scopedVariable","alias":"自定义变量","type":"Complex[*]","inputVisible":false,"attributes":"smartAttrs.customVariable"}]},{"name":"customs","alias":"自定义属性","sort":600,"attributes":[]},{"name":"methods","alias":"方法","sort":700,"attributes":[{"name":"clearTimer","alias":"清除定时器","type":"Complex","readonly":true,"attributes":[{"name":"functionName","alias":"方法名称","type":"String","default":"clearTimer"},{"name":"description","alias":"方法描述","type":"String","default":"根据定时器名称清除定时器"},{"name":"payload","alias":"参数","type":"Complex[1]","inputVisible":false,"attributes":"smartAttrs.payload","default":[{"name":"names","alias":"定时器名称"}]}]},{"name":"customMethods","alias":"自定义方法","type":"Complex[*]","showField":true,"inputVisible":false,"attributes":[{"name":"name","alias":"方法名称","type":"String","titleVisible":true,"visible":false,"inputVisible":false,"default":""},{"name":"customMethodsSetting","alias":"配置","type":"String","editor":"custom-method","attributes":"smartAttrs.customMethod","linkable":false,"default":{"functionName":"","description":"","payload":[{"name":"","alias":"","default":""}],"content":""}}]}]},{"name":"events","alias":"事件","sort":800,"attributes":[{"name":"onload","alias":"组件加载完成","type":"Complex","attributes":[{"name":"content","alias":"事件执行内容","type":"Complex[*]","inputVisible":false,"attributes":"smartAttrs.eventContent"},{"name":"description","alias":"事件描述","type":"String","default":"组件加载完成事件","readonly":true}]},{"name":"timer","alias":"定时器","type":"Complex","attributes":[{"name":"content","alias":"事件执行内容","type":"Complex[*]","inputVisible":false,"attributes":"smartAttrs.timerEventContent"},{"name":"description","alias":"事件描述","type":"String","default":"定时器事件","readonly":true}]}]}]}')},"1ad7":function(e,t,a){},"1b99":function(e,t,a){"use strict";a("340f")},"1bd7":function(e,t,a){"use strict";a("2f25")},"1cc1":function(e,t,a){"use strict";a("bd66")},"1ce5":function(e,t,a){"use strict";a("c986")},"1d73":function(e,t,a){"use strict";a("bd9c")},"1f4a":function(e,t,a){},"20b1":function(e,t,a){},"213b":function(e,t,a){},"21c7":function(e,t,a){},"21eb":function(e,t,a){"use strict";a("20b1")},2385:function(e,t,a){},2396:function(e,t,a){"use strict";a.r(t),a("7f7f");var i=(a("7514"),a("04c8")),n=a("c276"),r=a("b19c"),o={name:"PageEditor",components:{VariablePanel:i.a},props:{iconClass:{type:String,default:function(){return"el-icon-edit"}},mode:{type:String,default:function(){return"readonly"}},parent:{type:Object,default:function(){return{}}},params:{type:Object,default:function(){return{}}},settings:{type:Object,default:function(){return{title:"配置页面",width:"70%",className:"page-editor-dialog",showInput:!0}}},data:{type:Object,default:function(){return{alias:"",type:"",default:"",value:"",primitiveLabels:""}}},args:{type:Array,default:function(){return[]}},placeholder:{type:String,default:""},handleRulesResult:{type:Function,default:function(){}},handleChangeResult:{type:Function,default:function(){}}},data:function(){return{modeType:"full",showVal:"",editorVal:{type:"page",source:1,webUrl:"",variable:[],useExpression:!1,page:{id:"",name:"",path:"",groupName:""},group:{id:"",name:"",path:"",groupName:""}},dialogVisible:!1}},created:function(){this.initData()},methods:{showSource:function(e){var t,a=null===(t=this.params)||void 0===t?void 0:t.hideSource;return!a||!a.length||!a.find((function(t){return t===e}))},initData:function(){this.resetData();var e=this.data.editValue;if(e){for(var t in e)this.editorVal[t]=e[t];this.editorVal.source||(this.editorVal.source=1)}},handleIconClick:function(){this.open()},handleChange:function(e){this.setEditorVal(e.page,e.group)},setEditorVal:function(e,t){e&&(this.editorVal.page.id=e.id||"",this.editorVal.page.name=e.name||"",this.editorVal.page.path=e.path||"",this.editorVal.page.groupName=e.parentPageName||""),t&&(this.editorVal.group.id=t.id||"",this.editorVal.group.name=t.name||"",this.editorVal.group.path=t.path||"",this.editorVal.group.groupName=t.parentPageName||"")},open:function(e){this.modeType=e,this.dialogVisible=!0,this.initData()},close:function(){this.dialogVisible=!1},cancel:function(){this.dialogVisible=!1,this.initData()},resetData:function(){this.editorVal={type:"page",source:1,webUrl:"",variable:[],useExpression:!1,page:{id:"",name:"",path:"",groupName:""},group:{id:"",name:"",path:"",groupName:""}}},clear:function(){var e=this;this.$confirm("确定要清空相关设置吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.resetData(),e.$removeAttr(e.data,"value"),e.$removeAttr(e.data,"lastValue"),e.$removeAttr(e.data,"editValue"),e.$emit("change",""),e.close()})).catch((function(){}))},getShowVal:function(){var e=this.editorVal.source;if(2===e)return this.editorVal.webUrl;if(3===e)return this.editorVal.variable&&this.editorVal.variable.length?"${"+this.editorVal.variable.join(".")+"}":"";var t=this.editorVal.page;return t.path?t.path:t.groupName?t.groupName+("/"!==t.groupName?"/":"")+t.name:t.id},clickSure:function(){var e=this.editorVal.source;if(2===e){var t=this.editorVal.webUrl;if(!t)return void this.$message.warning("请手动输入");if(t.length>n.a.PAYLOAD_NAME_MAX_LENGTH)return void this.$message.warning("字符的长度不能超过"+n.a.PAYLOAD_NAME_MAX_LENGTH)}else if(3===e){var a=this.editorVal.variable;if(!a||!a.length)return void this.$message.warning("请选择变量")}else{if(!this.editorVal.page.id)return void this.$message.warning("请选择页面")}this.resetDataByType(e);var i=this.getShowVal();!1!==this.handleChangeResult(i,this.data)?(this.$setAttr(this.data,"value",i),this.$setAttr(this.data,"lastValue",i),this.$setAttr(this.data,"editValue",Object(r.e)(this.editorVal)),this.dialogVisible=!1):this.$setAttr(this.data,"lastValue",this.data.lastValue)},resetDataByType:function(e){switch(e){case 1:this.editorVal.webUrl="",this.editorVal.useExpression=!1,this.editorVal.variable=[];break;case 2:this.editorVal.page=this.editorVal.group={id:"",name:"",path:"",groupName:""},this.editorVal.variable=[];break;case 3:this.editorVal.webUrl="",this.editorVal.useExpression=!1,this.editorVal.page=this.editorVal.group={id:"",name:"",path:"",groupName:""}}},handleCopyPath:function(){var e,t,a,i,n,r=this,o=null===(e=window)||void 0===e||null===(t=e.Vue)||void 0===t||null===(a=t.prototype)||void 0===a?void 0:a.$copyText;o&&"function"==typeof o&&o(null===(i=this.editorVal)||void 0===i||null===(n=i.page)||void 0===n?void 0:n.path).then((function(){r.$message.success("复制路径成功")})).catch((function(e){r.$message.error("复制路径失败")}))}}},l=(a("8190"),a("2877")),s=Object(l.a)(o,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"page-editor"},[e.settings.showInput?t("el-input",{staticClass:"editor-input",attrs:{title:e.data.value||e.data.alias||e.data.name,placeholder:e.placeholder,value:e.data.value,readonly:"",size:"mini",clearable:""},nativeOn:{click:function(t){return e.handleIconClick.apply(null,arguments)}}},[t("i",{staticClass:"el-input__icon array-editor-icon",class:e.iconClass,attrs:{slot:"suffix"},slot:"suffix"})]):e._e(),e.dialogVisible?t("el-dialog",{directives:[{name:"elDragDialog",rawName:"v-elDragDialog",value:!0,expression:"true"}],staticClass:"page-editor-dialog",attrs:{draggable:!0,visible:e.dialogVisible,"close-on-click-modal":!1,title:e.settings.title||"设置"+(e.data.alias||e.data.name),width:"76%","append-to-body":!0,"modal-append-to-body":!0,top:"4vh"},on:{close:e.close}},[e.dialogVisible?t("el-form",{staticClass:"hc-url-source",attrs:{model:e.editorVal,inline:!0}},[t("el-form-item",{attrs:{label:"来源："}},[t("el-radio-group",{model:{value:e.editorVal.source,callback:function(t){e.$set(e.editorVal,"source",t)},expression:"editorVal.source"}},[e.showSource(1)?t("el-radio",{attrs:{label:1}},[e._v("页面选择")]):e._e(),e.showSource(3)?t("el-radio",{attrs:{label:3}},[e._v("变量选择")]):e._e(),e.showSource(2)?t("el-radio",{attrs:{label:2}},[e._v("手动输入")]):e._e()],1)],1)],1):e._e(),e.dialogVisible&&1===e.editorVal.source&&e.showSource(1)?t("component-page-manage",{ref:"pageManage",attrs:{groupId:e.editorVal.group.id,pageId:e.editorVal.page.id,mode:e.modeType},on:{"current-change":e.handleChange}}):e.dialogVisible&3===e.editorVal.source&&e.showSource(3)?t("variable-panel",{attrs:{args:this.args},model:{value:e.editorVal.variable,callback:function(t){e.$set(e.editorVal,"variable",t)},expression:"editorVal.variable"}}):t("div",{staticClass:"hc-web-url"},[e.dialogVisible?t("el-input",{attrs:{placeholder:"请输入",clearable:""},model:{value:e.editorVal.webUrl,callback:function(t){e.$set(e.editorVal,"webUrl",t)},expression:"editorVal.webUrl"}}):e._e(),t("el-checkbox",{staticStyle:{"margin-top":"10px"},model:{value:e.editorVal.useExpression,callback:function(t){e.$set(e.editorVal,"useExpression",t)},expression:"editorVal.useExpression"}},[e._v("使用表达式")]),t("el-alert",{staticStyle:{"margin-top":"10px"},attrs:{title:"支持js表达式语法，支持混合使用变量，${...}是对变量的引用，其中...为变量名",type:"info","show-icon":"",closable:!1}})],1),e.dialogVisible?t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-row",[t("el-col",{staticClass:"dialog-footer-tips",attrs:{span:16}},[1===e.editorVal.source&&e.showSource(1)?[e.editorVal.page.path?[e._v("\n              当前已选页面："+e._s(e.editorVal.page.path)+"\n              "),t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"点击复制",placement:"top","open-delay":"200"}},[t("el-button",{attrs:{type:"text"},on:{click:e.handleCopyPath}},[t("i",{staticClass:"el-icon-document-copy"})])],1)]:[e._v("\n              请点击表格行以选择页面\n            ")]]:e._e()],2),t("el-col",{staticClass:"dialog-footer-buttons",attrs:{span:8}},[t("el-button",{attrs:{type:"danger"},on:{click:e.clear}},[e._v("清 空")]),t("el-button",{on:{click:e.cancel}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.clickSure}},[e._v("确 定")])],1)],1)],1):e._e()],1):e._e()],1)}),[],!1,null,null,null);t.default=s.exports},"23c2":function(e,t,a){"use strict";a("6b54");var i=a("7618");function n(e,t){var a,i;if(0===t.length)return e;for(a=0,i=t.length;a<i;a++)e=(e<<5)-e+t.charCodeAt(a),e|=0;return e<0?-2*e:e}function r(e,t,a){return Object.keys(t).sort().reduce((function(e,i){return o(e,t[i],i,a)}),e)}function o(e,t,a,o){var l=n(n(n(e,a),function(e){return Object.prototype.toString.call(e)}(t)),Object(i.a)(t));return null===t?n(l,"null"):void 0===t?n(l,"undefined"):"object"===Object(i.a)(t)?-1!==o.indexOf(t)?n(l,"[Circular]"+a):(o.push(t),r(l,t,o)):n(l,t.toString())}a("ac6a"),a("456d"),a("55dd"),t.a=function(e){return function(e,t){for(;e.length<t;)e="0"+e;return e}(o(0,e,"",[]).toString(16),8)}},2401:function(e,t,a){"use strict";a.d(t,"b",(function(){return l})),a.d(t,"a",(function(){return s})),a.d(t,"c",(function(){return c})),a("8e6e"),a("ffc1");var i=a("bd86"),n=(a("456d"),a("7f7f"),a("9253"),a("ac6a"),a("c276"));function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){Object(i.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e){var t=this,a={};return Array.isArray(e)&&e.forEach((function(e){var i,n=t.propertyTypeMap[e.propertyType];a.hasOwnProperty(n)&&Array.isArray(a[n])||Reflect.set(a,n,[]),a[n].push({id:e.id,businessId:null!==(i=e.indicatorId)&&void 0!==i?i:e.id,name:e.name,updateTime:e.updateTime,value:e.value,identifier:e.identifier,indicatorId:e.indicatorId,propertyType:e.propertyType})})),a}function s(e){var t=[];return Object(n.tb)(e)&&Object.keys(e).forEach((function(a){Array.isArray(e[a])&&e[a].forEach((function(e){t.push(o(o({},e),{},{type:a}))}))})),t}function c(e){if(Object(n.tb)(e)){var t={};return Object.entries(e).forEach((function(e){void 0!==e[1]&&Reflect.set(t,"".concat(e[1]),e[0])})),t}return e}},"268c":function(e,t,a){},"278e":function(e,t,a){},"27d0":function(e,t,a){"use strict";a("4981")},"27d8":function(e,t,a){"use strict";a("ed60")},2806:function(e,t,a){"use strict";a("bcdb")},2945:function(e,t,a){"use strict";a("0a31")},"2c9f":function(e,t,a){},"2caf":function(e,t,a){},"2cdc":function(e,t,a){"use strict";a.r(t),t.default=a.p+"img/no-permission.60d33c55.png"},"2cf4":function(e,t,a){},"2dba":function(e,t,a){"use strict";a.r(t);var i=(a("ac6a"),a("c276")),n=a("b19c"),r={name:"ColEditor",props:{title:{type:String,default:function(){return"列设置"}},showInput:{type:String,default:function(){return!0}},iconClass:{type:String,default:function(){return"el-icon-edit"}},parentParent:{type:Object,default:function(){return{}}},parent:{type:Object,default:function(){return{}}},data:{type:Object,default:function(){return{}}},placeholder:{type:String,default:""},handleRulesResult:{type:Function,default:function(){}},handleChangeResult:{type:Function,default:function(){}}},watch:{"data.value":function(){this.initData()},dialogVisible:function(e){e&&this.initData()}},data:function(){return{showVal:"",copayEditVal:{type:"col",count:1,col:[{id:Object(i.ob)(),md:0,sm:0,xs:24,isBorder:!1}],gutter:0},editVal:{type:"col",count:1,col:[{id:Object(i.ob)(),md:0,sm:0,xs:24,isBorder:!1}],gutter:0},dialogVisible:!1}},computed:{themeStyles:function(){return{target:"th,td",style:{"border-width":Object(i.nb)("borderWidth"),"border-style":Object(i.nb)("borderStyle"),"border-color":Object(i.nb)("borderColor"),padding:"0 5px"}}},theadStyles:function(){return{"background-color":Object(i.nb)("middleBackgroundColor")}},pageInfo:function(){var e=this.$store.getters.pageEditor;return e.pagesKV[e.pagesActiveName]}},created:function(){this.initData()},methods:{initData:function(){var e=Object(i.pb)(this.data.editValue,this.data.default);e&&"col"===e.type&&(this.editVal=Object(n.e)(e),this.copayEditVal=Object(n.e)(this.data.default),this.showVal=this.getShowVal())},handleIconClick:function(){this.open()},handleChangeCount:function(e){var t=this,a=this.editVal.col,n=a.length;if(e>=24)return this.$message({message:"最多添加24项！",type:"warning"}),void this.$nextTick((function(){t.editVal.count=n}));if(e!==n)if(e<n)this.$confirm("确定要删减已有设置吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){a.splice(e,n-e),t.editVal.count=a.length,t.handleMd(a,"del")})).catch((function(){t.editVal.count=n}));else for(var r=0;r<e-n;){var o=this.handleMd(a,"add"),l=this.getSm(a);a.splice(n,0,{id:Object(i.ob)(),md:o,sm:l,xs:24,isBorder:!1}),r++}},handleEvents:function(e,t){var a=this,n=this.editVal.col,r=n.length;if("add"===e){if(r>=24)return void this.$message({message:"最多添加24项！",type:"warning"});var o=this.handleMd(n,"add");return n.push({id:Object(i.ob)(),md:o,sm:o,xs:24,isBorder:!1}),void(this.editVal.count=n.length)}if("del"!==e)if("top"!==e){if("bottom"===e){if(t===r-1)return;var l=n.splice(t,1);n.splice(t+1,0,l[0])}}else{if(0===t)return;var s=n.splice(t,1);n.splice(t-1,0,s[0])}else this.$confirm("如果该列有子组件将一并删除，确定要删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){n.splice(t,1),a.editVal.count=n.length,a.handleMd(n,"del")})).catch((function(){}))},handleMd:function(e,t){var a=this.getMd(e,t);return e.forEach((function(i,n){if("del"===t&&n===e.length-1)return i.md=a.most+a.mod,void(i.sm=a.most+a.mod);i.md=a.most,i.sm=a.most})),a.last},getMd:function(e,t){var a="add"===t?1:0,i=e.length,n=24%(i+a),r=Math.floor(24/(i+a)),o=0===n?r:n>=i?r+1:r;return{most:o,last:0===n?r:24-o*i,mod:n}},handleSm:function(e,t){var a=this.getSm(e,t);return e.forEach((function(i,n){"del"!==t||n!==e.length-1?i.sm=a.most:i.sm=a.most+a.mod})),a.last},getSm:function(e,t){var a="add"===t?1:0,i=e.length,n=24%(i+a),r=Math.floor(24/(i+a)),o=0===n?r:n>=i?r+1:r;return{most:o,last:0===n?r:24-o*i,mod:n}},open:function(){this.dialogVisible=!0},close:function(){this.dialogVisible=!1},cancel:function(){this.close()},clear:function(){var e=this;this.$confirm("确定要清空相关设置吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.showVal="",e.editVal=Object(n.e)(e.copayEditVal),e.$removeAttr(e.data,"value"),e.$removeAttr(e.data,"lastValue"),e.$removeAttr(e.data,"editValue"),e.close()})).catch((function(){}))},getShowVal:function(){return this.editVal.count||1},clickSure:function(){var e=this.validate();!0===e?(this.showVal=this.getShowVal(),!1!==this.handleChangeResult(this.showVal,this.data)?(this.$setAttr(this.data,"value",this.showVal),this.$setAttr(this.data,"lastValue",this.showVal),this.$setAttr(this.data,"editValue",this.getEditValue()),this.$emit("onSure",this.showVal,this.getEditValue(),this.data),this.dialogVisible=!1):this.$setAttr(this.data,"lastValue",this.data.lastValue)):this.$message.warning(e)},getEditValue:function(){return Object(n.e)(this.editVal)},validate:function(){var e=this.editVal.col,t=0;return e.forEach((function(e){t+=e.md})),!(t>24)||"所有列的栅格数量相加不能大于24!"}}},o=(a("7e9f"),a("2877")),l=Object(o.a)(r,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"hc-attr-editor hc-attr-editor-col"},[e.showInput?t("el-input",{staticClass:"hc-attr-editor-input",attrs:{placeholder:e.placeholder,value:e.showVal,readonly:"",size:"mini",clearable:""},nativeOn:{click:function(t){return e.handleIconClick.apply(null,arguments)}}},[t("i",{staticClass:"el-input__icon hc-attr-editor-icon",class:e.iconClass,attrs:{slot:"suffix"},slot:"suffix"})]):e._e(),t("el-dialog",{staticClass:"hc-attr-editor-dialog hc-attr-editor-dialog-col",attrs:{draggable:!0,visible:e.dialogVisible,"close-on-click-modal":!1,title:e.title,width:"60%","append-to-body":!0},on:{close:e.close}},[t("div",{staticClass:"hc-attr-editor-content"},[t("el-form",{staticClass:"hc-attr-editor-form",attrs:{"label-width":"110px"},model:{value:e.editVal,callback:function(t){e.editVal=t},expression:"editVal"}},[t("el-form-item",{attrs:{label:"列数"}},[t("el-input-number",{staticStyle:{width:"200px"},attrs:{size:"mini","controls-position":"right",min:1,max:24},on:{change:e.handleChangeCount},model:{value:e.editVal.count,callback:function(t){e.$set(e.editVal,"count",t)},expression:"editVal.count"}})],1),t("el-form-item",{attrs:{label:"间隔"}},[t("el-input-number",{staticStyle:{width:"200px"},attrs:{size:"mini","controls-position":"right",min:0,max:23},model:{value:e.editVal.gutter,callback:function(t){e.$set(e.editVal,"gutter",t)},expression:"editVal.gutter"}})],1),t("el-form-item",{attrs:{label:"列属性"}},[t("table",{directives:[{name:"theme",rawName:"v-theme",value:e.themeStyles,expression:"themeStyles"}],staticClass:"hc-editor-payload-table"},[t("thead",{staticClass:"hc-editor-payload-table-thead",style:e.theadStyles},[t("tr",[t("th",{attrs:{width:"20%"}},[e._v("行名称")]),t("th",[e._v("栅格数量")]),t("th",[e._v("栅格数量(sm)")]),t("th",[e._v("栅格数量(xs)")]),t("th",[e._v("是否有边框")]),t("th",{attrs:{width:"18%"}},[e._v("操作")])])]),t("tbody",{staticClass:"hc-editor-payload-table-tbody"},e._l(e.editVal.col,(function(a,i){return t("tr",{key:i},[t("td",{attrs:{align:"center"}},[e._v("第"+e._s(i+1)+"列")]),t("td",[t("el-input-number",{attrs:{size:"mini","controls-position":"right",min:1,max:24},model:{value:a.md,callback:function(t){e.$set(a,"md",t)},expression:"col.md"}})],1),t("td",[t("el-input-number",{attrs:{size:"mini","controls-position":"right",min:1,max:24},model:{value:a.sm,callback:function(t){e.$set(a,"sm",t)},expression:"col.sm"}})],1),t("td",[t("el-input-number",{attrs:{size:"mini","controls-position":"right",min:1,max:24},model:{value:a.xs,callback:function(t){e.$set(a,"xs",t)},expression:"col.xs"}})],1),t("td",[t("el-switch",{model:{value:a.isBorder,callback:function(t){e.$set(a,"isBorder",t)},expression:"col.isBorder"}})],1),t("td",{staticClass:"hc-payload-operation",attrs:{align:"center"}},[t("el-button",{attrs:{title:"上移",disabled:0===i,size:"mini",icon:"el-icon-top",plain:""},on:{click:function(t){return e.handleEvents("top",i)}}}),t("el-button",{attrs:{title:"下移",disabled:i===e.editVal.col.length-1,size:"mini",icon:"el-icon-bottom",plain:""},on:{click:function(t){return e.handleEvents("bottom",i)}}}),t("el-button",0===i?{attrs:{title:"新增",size:"mini",icon:"el-icon-plus",plain:""},on:{click:function(t){return e.handleEvents("add",i)}}}:{attrs:{title:"删除",size:"mini",type:"danger",plain:"",icon:"el-icon-minus"},on:{click:function(t){return e.handleEvents("del",i)}}})],1)])})),0)]),t("el-alert",{staticStyle:{"margin-top":"10px"},attrs:{title:"所有列的栅格数量相加等于24，则充满一行，如果大于24，则会自动换行。",type:"warning",closable:!1,"show-icon":""}})],1)],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"danger"},on:{click:e.clear}},[e._v("清 空")]),t("el-button",{on:{click:e.cancel}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.clickSure}},[e._v("确 定")])],1)])],1)}),[],!1,null,null,null);t.default=l.exports},"2f0d":function(e,t,a){"use strict";t.a={chartAppearance:[{name:"line-height",alias:"字体行高",visible:!1},{name:"font-size",alias:"文字大小",visible:!1},{name:"color",alias:"字体颜色",visible:!1},{name:"font-weight",alias:"字体粗细",visible:!1},{name:"font-style",alias:"字体风格",visible:!1},{name:"text-align",alias:"水平对齐",visible:!1},{name:"text-decoration",alias:"文本修饰",visible:!1},{name:"letter-spacing",alias:"文字间距",visible:!1},{name:"background-image",alias:"背景图片",visible:!1},{name:"background-repeat",alias:"背景图像重复",visible:!1},{name:"background-size",alias:"背景图片尺寸",visible:!1},{name:"background-position",alias:"背景图片定位",visible:!1}],chartLayout:[{name:"width",alias:"宽度",type:"String",default:"100%"},{name:"height",alias:"高度",type:"String",default:"100%"}],chartTitle:[{name:"title",alias:"标题",type:"Complex",attributes:[{name:"title.show",alias:"主标题.标题显示",type:"Boolean",default:!0},{name:"title.text",alias:"主标题.标题文本",type:"String",default:"标题",maxlength:50},{name:"title.textStyle.fontSize",alias:"主标题.字号",type:"Number",default:18,min:8,max:100},{name:"title.textStyle.color",alias:"主标题.颜色",type:"String",default:"#333",editor:"color"},{name:"title.left",alias:"主标题.左边距",type:"String",default:"auto",maxlength:"7",tips:"请输入正整数或百分比或字符串left|center|right|auto",rules:[{pattern:"/^(__quote:percentage__|(^\\d+$)|(left)|(center)|(right)|(auto))$/",message:"请输入正整数或百分比或字符串left|center|right|auto"}]},{name:"title.top",alias:"主标题.上边距",type:"String",default:"auto",maxlength:"7",tips:"请输入正整数或百分比或字符串top|middle|bottom|auto",rules:[{pattern:"/^(__quote:percentage__|(^\\d+$)|(top)|(middle)|(bottom)|(auto))$/",message:"请输入正整数或百分比或字符串top|middle|bottom|auto"}]}]}],chartLegend:[{name:"legend",alias:"图例",type:"Complex",attributes:[{name:"legend.show",alias:"图例.显示",type:"Boolean",default:!0},{name:"legend.type",alias:"图例.类型",type:'Enum("plain:普通图例","scroll:可滚动翻页的图例")',default:"plain"},{name:"legend.icon",alias:"图例.图标",type:'Enum("circle:圆形","rect:矩形","roundRect:圆角矩形","triangle:三角形","diamond:菱形","emptyCircle:空心圆","none:无")',default:"roundRect"},{name:"legend.orient",alias:"图例.布局朝向",type:'Enum("horizontal:水平布局","vertical:垂直布局")',default:"horizontal"},{name:"legend.width",alias:"图例.宽度",type:"String",default:"auto",tips:"允许三种值：1.自动:auto；2.正整数:300；3.百分比:50%",rules:[{pattern:"/^(__quote:percentage__|(^\\d+$)|(auto))$/",message:"请输入正整数或百分比或字符串"}]},{name:"legend.height",alias:"图例.高度",type:"String",default:"auto",tips:"允许三种值：1.自动:auto；2.正整数:300；3.百分比:50%",rules:[{pattern:"/^(__quote:percentage__|(^\\d+$)|(auto))$/",message:"请输入正整数或百分比或字符串"}]},{name:"legend.align",alias:"图例.标记和文本对齐方式",type:"Enum('auto:自动','left:居左','right:居右')",default:"auto"},{name:"legend.itemGap",alias:"图例.每项之间的间隔",type:"Number",default:10,min:0},{name:"legend.itemWidth",alias:"图例.标记图形.宽度",type:"Number",default:25,min:0},{name:"legend.itemHeight",alias:"图例.标记图形.高度",type:"Number",default:14,min:0},{name:"legend.inactiveColor",alias:"图例.关闭时的颜色",type:"String",default:"#ccc",editor:"color"},{name:"legend.left",alias:"图例.左边距",type:"String",default:"center",maxlength:"7",tips:"请输入正整数或百分比或字符串left|center|right|auto",rules:[{pattern:"/^(__quote:percentage__|(^\\d+$)|(left)|(center)|(right)|(auto))$/",message:"请输入正整数或百分比或字符串left|center|right|auto"}]},{name:"legend.top",alias:"图例.上边距",type:"String",default:"auto",maxlength:"7",tips:"请输入正整数或百分比或字符串top|middle|bottom|auto",rules:[{pattern:"/^(__quote:percentage__|(^\\d+$)|(top)|(middle)|(bottom)|(auto))$/",message:"请输入正整数或百分比或字符串top|middle|bottom|auto"}]},{name:"legend.right",alias:"图例.右边距",type:"String",default:"auto",maxlength:"7",tips:"请输入正整数或百分比或字符串auto",rules:[{pattern:"/^(__quote:percentage__|(^\\d+$)|(auto))$/",message:"请输入正整数或百分比或字符串auto"}]},{name:"legend.bottom",alias:"图例.下边距",type:"String",default:"auto",maxlength:"7",tips:"请输入正整数或百分比或字符串auto",rules:[{pattern:"/^(__quote:percentage__|(^\\d+$)|(auto))$/",message:"请输入正整数或百分比或字符串auto"}]},{name:"legend.textStyle.color",alias:"图例.文字颜色",type:"String",editor:"color",default:"#333"},{name:"legend.textStyle.fontSize",alias:"图例.文字大小",type:"Number",default:12,min:8},{name:"legend.textStyle.fontWeight",alias:"图例.文字粗细",type:"Enum('normal:常规','bold:粗体','lighter:浅色')",default:"normal"},{name:"legend.textStyle.fontStyle",alias:"图例.文字风格",type:"Enum('normal:常规', 'italic:斜体')",default:"normal"},{name:"legend.textStyle.backgroundColor",alias:"图例.文字背景色",type:"String",default:null,editor:"color"},{name:"legend.borderWidth",alias:"图例.边框.宽度",type:"Number",default:0,min:0},{name:"legend.borderColor",alias:"图例.边框.颜色",type:"String",default:"#ccc",editor:"color"},{name:"legend.borderRadius",alias:"图例.边框.圆角",type:"Number",default:0,min:0}]}],chartTooltip:[{name:"tooltip",alias:"提示框",type:"Complex",attributes:[{name:"tooltip.show",alias:"提示框.是否显示",type:"Boolean",default:!0},{name:"tooltip.trigger",alias:"提示框.触发类型",type:'Enum("item:数据项图形触发","none:什么都不触发")',default:"item"},{name:"tooltip.showContent",alias:"提示框.浮层显示",type:"Boolean",default:!0,visible:!1},{name:"tooltip.triggerOn",alias:"提示框.触发条件",type:'Enum("mousemove:鼠标悬浮时触发","click:鼠标点击时触发","mousemove|click:鼠标悬浮或点击时均可触发")',default:"mousemove"},{name:"tooltip.textStyle.color",alias:"提示框.文字颜色",type:"String",editor:"color",default:"#333"}]}],chartDataZoom:[{name:"inside",alias:"内置型",type:"Complex[*]",inputVisible:!1,attributes:[{name:"inside.type",alias:"内置型.内置",type:"String",default:"inside",visible:!1},{name:"inside.use",alias:"内置型.启用缩放",type:"Boolean",default:!0},{name:"inside.axisType",alias:"内置型.缩放轴",type:'Enum("xAxis:x轴","yAxis:y轴","radiusAxis:径向轴","angleAxis:角度轴")',default:"xAxis"},{name:"inside.xAxisIndex",alias:"内置型.关联x轴",type:"Number[*]",default:[0],visible:!1},{name:"inside.yAxisIndex",alias:"内置型.关联y轴",type:"Number[*]",default:[0],visible:!1},{name:"inside.radiusAxisIndex",alias:"内置型.关联径向轴",type:"Number[*]",default:[0],visible:!1},{name:"inside.angleAxisIndex",alias:"内置型.关联角度轴",type:"Number[*]",default:[0],visible:!1},{name:"inside.orient",alias:"内置型.布局方式",type:'Enum("horizontal:水平布局","vertical:垂直布局")',default:"horizontal",visible:!1},{name:"inside.start",alias:"内置型.开始范围",type:"Number",default:0,min:0,max:100},{name:"inside.end",alias:"内置型.结束范围",type:"Number",default:100,min:0,max:100}]},{name:"slider",alias:"滑动条型",type:"Complex[*]",inputVisible:!1,attributes:[{name:"slider.type",alias:"滑动条型.滑动条",type:"String",default:"slider",visible:!1},{name:"slider.show",alias:"滑动条型.显示",type:"Boolean",default:!1},{name:"slider.axisType",alias:"滑动条型.缩放轴",type:'Enum("xAxis:x轴","yAxis:y轴","radiusAxis:径向轴","angleAxis:角度轴")',default:"xAxis"},{name:"slider.xAxisIndex",alias:"滑动条型.关联x轴",type:"Number[*]",default:[0],visible:!1},{name:"slider.yAxisIndex",alias:"滑动条型.关联y轴",type:"Number[*]",default:[0],visible:!1},{name:"slider.radiusAxisIndex",alias:"滑动条型.关联径向轴",type:"Number[*]",default:[0],visible:!1},{name:"slider.angleAxisIndex",alias:"滑动条型.关联角度轴",type:"Number[*]",default:[0],visible:!1},{name:"slider.orient",alias:"滑动条型.布局方式",type:'Enum("horizontal:水平布局","vertical:垂直布局")',default:"horizontal"},{name:"slider.start",alias:"滑动条型.开始范围",type:"Number",default:0,min:0,max:100},{name:"slider.end",alias:"滑动条型.结束范围",type:"Number",default:100,min:0,max:100},{name:"slider.top",alias:"滑动条型.上边距",type:"String",default:"auto",maxlength:"7",tips:"请输入正整数或百分比或top, middle, bottom, auto",rules:[{pattern:"/^(__quote:percentage__|(^\\d+$)|(top)|(middle)|(bottom)|(auto))$/",message:"请输入正整数或百分比或字符串top|middle|bottom|auto"}]},{name:"slider.bottom",alias:"滑动条型.下边距",type:"String",default:"auto",maxlength:"7",tips:"请输入正整数或百分比或auto",rules:[{pattern:"/^(__quote:percentage__|(^\\d+$)|(auto))$/",message:"请输入正整数或百分比或auto"}]},{name:"slider.left",alias:"滑动条型.左边距",type:"String",default:"center",maxlength:"7",tips:"请输入正整数或百分比或left, center, right, auto",rules:[{pattern:"/^(__quote:percentage__|(^\\d+$)|(left)|(center)|(right)|(auto))$/",message:"请输入正整数或百分比或字符串left、center, right, auto"}]},{name:"slider.right",alias:"滑动条型.右边距",type:"String",default:"auto",maxlength:"7",tips:"请输入正整数或百分比或auto",rules:[{pattern:"/^(__quote:percentage__|(^\\d+$)|(auto))$/",message:"请输入正整数或百分比或auto"}]},{name:"slider.width",alias:"滑动条型.宽度",type:"Number",min:0,default:null,visible:!1},{name:"slider.height",alias:"滑动条型.高度",type:"Number",min:0,max:100,default:30}]}],chartCoordinateCartesian:[{name:"grid",alias:"网格",type:"Complex",attributes:[{name:"grid.show",alias:"网格.显示",type:"Boolean",default:!1},{name:"grid.left",alias:"网格.左边距",type:"String",default:"10%",maxlength:"7",tips:"请输入正整数或百分比或left|center|right|auto",rules:[{pattern:"/^(__quote:percentage__|(^\\d+$)|(left)|(center)|(right)|(auto))$/",message:"请输入正整数或百分比或字符串left|center|right|auto"}]},{name:"grid.top",alias:"网格.上边距",type:"String",default:"60",maxlength:"7",tips:"请输入正整数或百分比或top|middle|bottom|auto",rules:[{pattern:"/^(__quote:percentage__|(^\\d+$)|(top)|(middle)|(bottom)|(auto))$/",message:"请输入正整数或百分比或字符串top|middle|bottom|auto"}]},{name:"grid.right",alias:"网格.右边距",type:"String",default:"10%",maxlength:"7",tips:"请输入正整数或百分比",rules:[{pattern:"/^(__quote:percentage__|(^\\d+$))$/",message:"请输入正整数或百分比"}]},{name:"grid.bottom",alias:"网格.下边距",type:"String",default:"60",maxlength:"7",tips:"请输入正整数或百分比",rules:[{pattern:"/^(__quote:percentage__|(^\\d+$))$/",message:"请输入正整数或百分比"}]},{name:"grid.width",alias:"网格.宽度",type:"String",default:"auto",maxlength:"7",tips:"请输入正整数或百分比或auto",rules:[{pattern:"/^(__quote:percentage__|(^\\d+$)|(auto))$/",message:"请输入正整数或百分比或auto"}]},{name:"grid.height",alias:"网格.高度",type:"String",default:"auto",maxlength:"7",tips:"请输入正整数或百分比或auto",rules:[{pattern:"/^(__quote:percentage__|(^\\d+$)|(auto))$/",message:"请输入正整数或百分比或auto"}]},{name:"grid.containLabel",alias:"网格.是否包含刻度标签",type:"Boolean",default:!1},{name:"grid.backgroundColor",alias:"网格.背景色",type:"String",default:"",editor:"color"}]},{name:"xAxis",alias:"横坐标轴",type:"Complex[*]",inputVisible:!1,attributes:[{name:"xAxis.show",alias:"横坐标轴.显示",type:"Boolean",default:!0},{name:"xAxis.position",alias:"横坐标轴.位置",type:'Enum("top:顶端","bottom:底端")',default:"bottom"},{name:"xAxis.offset",alias:"横坐标轴.偏移量",type:"Number",default:0},{name:"xAxis.type",alias:"横坐标轴.类型",type:'Enum("value:数值轴","category:类目轴","time:时间轴","log:对数轴")',default:"category"},{name:"xAxis.name",alias:"横坐标轴.名称",type:"String",maxlength:10,default:""},{name:"xAxis.nameLocation",alias:"横坐标轴.名称位置",type:'Enum("start:开端","center:中间","end:末端")',default:"center"},{name:"xAxis.nameGap",alias:"横坐标轴.名称与轴线距离",type:"Number",default:15},{name:"xAxis.nameRotate",alias:"横坐标轴.名称旋转角度",type:"Number",default:0,min:-360,max:360},{name:"xAxis.inverse",alias:"横坐标轴.反向坐标",type:"Boolean",default:!1},{name:"xAxis.boundaryGap",alias:"横坐标轴.两边是否留白",type:"Boolean",default:!0,primitiveLabels:["前侧","后侧"]},{name:"xAxis.min",alias:"横坐标轴.刻度最小值",type:"String",default:null,rules:[{pattern:"/(^$)|(^(-?\\d+$)|(^dataMin))$/",message:"请输入整数或字符串dataMin"}]},{name:"xAxis.max",alias:"横坐标轴.刻度最大值",type:"String",default:null,rules:[{pattern:"/(^$)|(^(-?\\d+$)|(^dataMax))$/",message:"请输入整数或字符串dataMax"}]},{name:"xAxis.axisLine.show",alias:"横坐标轴.轴线显示",type:"Boolean",default:!0},{name:"xAxis.axisLine.onZero",alias:"横坐标轴.锁定0轴",type:"Boolean",default:!0},{name:"xAxis.axisLine.symbol",alias:"横坐标轴.轴线箭头",type:"Enum('none:无', 'arrow:箭头')[2]",primitiveLabels:["开端","末端"],default:["none","none"]},{name:"xAxis.axisLine.symbolSize",alias:"横坐标轴.箭头尺寸",type:"Number[2]",primitiveLabels:["宽度","高度"],default:[10,15]},{name:"xAxis.axisLine.lineStyle.color",alias:"横坐标轴.轴线颜色",type:"String",editor:"color",default:"#333"},{name:"xAxis.axisLine.lineStyle.width",alias:"横坐标轴.轴线宽度",type:"Number",default:1,min:0},{name:"xAxis.axisLine.lineStyle.type",alias:"横坐标轴.轴线样式",type:'Enum("solid:实线","dashed:虚线","dotted:点线")',default:"solid"},{name:"xAxis.axisLine.lineStyle.opacity",alias:"横坐标轴.轴线透明度",type:"Number",default:1,min:0,max:1,precision:2,step:.01},{name:"xAxis.axisTick.show",alias:"横坐标轴.显示刻度",type:"Boolean",default:!0},{name:"xAxis.axisTick.alignWithLabel",alias:"横坐标轴.标签对齐",type:"Boolean",default:!1},{name:"xAxis.axisTick.length",alias:"横坐标轴.刻度线长",type:"Number",default:5,min:0},{name:"xAxis.axisTick.lineStyle.width",alias:"横坐标轴.刻度线宽",type:"Number",default:1,min:0},{name:"xAxis.axisTick.lineStyle.type",alias:"横坐标轴.刻度样式",type:'Enum("solid:实线","dashed:虚线","dotted:点线")',default:"solid"},{name:"xAxis.axisTick.lineStyle.opacity",alias:"横坐标轴.刻度透明度",type:"Number",default:1,min:0,max:1,precision:2,step:.01},{name:"xAxis.splitLine.show",alias:"横坐标轴.显示隔线",type:"Boolean",default:!0},{name:"xAxis.splitLine.lineStyle.width",alias:"横坐标轴.隔线宽度",type:"Number",default:1,min:0},{name:"xAxis.splitLine.lineStyle.type",alias:"横坐标轴.隔线样式",type:'Enum("solid:实线","dashed:虚线","dotted:点线")',default:"solid"},{name:"xAxis.splitLine.lineStyle.opacity",alias:"横坐标轴.隔线透明度",type:"Number",default:1,min:0,max:1,precision:2,step:.01},{name:"xAxis.splitArea.show",alias:"横坐标轴.分隔区域显示",type:"Boolean",default:!1},{name:"xAxis.splitArea.areaStyle.opacity",alias:"横坐标轴.分隔区域透明度",type:"Number",default:1,min:0,max:1,precision:2,step:.01},{name:"xAxis.axisPointer.show",alias:"横坐标轴.指示器显示",type:"Boolean",default:!1},{name:"xAxis.axisPointer.type",alias:"横坐标轴.指示器类型",type:'Enum("line:直线","shadow:阴影","none:无")',default:"line"},{name:"xAxis.data",alias:"横坐标轴.数据",type:"Complex[*]",linkable:!0,customGroupName:"linkable",editor:"code"},{name:"xAxis.dataField",alias:"横坐标轴.数据字段名",type:"String",visible:!1,default:""}]},{name:"yAxis",alias:"纵坐标轴",type:"Complex[*]",inputVisible:!1,attributes:[{name:"yAxis.show",alias:"纵坐标轴.显示",type:"Boolean",default:!0},{name:"yAxis.position",alias:"纵坐标轴.位置",type:'Enum("left:左侧","right:右侧")',default:"left"},{name:"yAxis.offset",alias:"纵坐标轴.偏移量",type:"Number",default:0},{name:"yAxis.type",alias:"纵坐标轴.类型",type:'Enum("value:数值轴","category:类目轴","time:时间轴","log:对数轴")',default:"value"},{name:"yAxis.name",alias:"纵坐标轴.名称",type:"String",minlength:0,maxlength:10,default:""},{name:"yAxis.nameLocation",alias:"纵坐标轴.名称位置",type:'Enum("start:开端","center:中间","end:末端")',default:"end"},{name:"yAxis.nameGap",alias:"纵坐标轴.名称与轴线距离",type:"Number",default:15},{name:"yAxis.nameRotate",alias:"纵坐标轴.名称旋转角度",type:"Number",default:0,min:-360,max:360},{name:"yAxis.inverse",alias:"纵坐标轴.反向坐标",type:"Boolean",default:!1},{name:"yAxis.boundaryGap",alias:"纵坐标轴.两边是否留白",type:"String[2]",default:[0,0],primitiveLabels:["前侧","后侧"],rules:[{pattern:"/^((\\d+$)|((\\d|[1-9]\\d|100)(\\.\\d{1,2})?%))$/",message:"请输入非负整数或百分比"}]},{name:"yAxis.min",alias:"纵坐标轴.刻度最小值",type:"String",default:null,rules:[{pattern:"/(^$)|(^(-?\\d+$)|(^dataMin))$/",message:"请输入整数或字符串dataMin"}]},{name:"yAxis.max",alias:"纵坐标轴.刻度最大值",type:"String",default:null,rules:[{pattern:"/(^$)|(^(-?\\d+$)|(^dataMax))$/",message:"请输入整数或字符串dataMax"}]},{name:"yAxis.axisLine.show",alias:"纵坐标轴.轴线显示",type:"Boolean",default:!0},{name:"yAxis.axisLine.onZero",alias:"纵坐标轴.锁定0轴",type:"Boolean",default:!0},{name:"yAxis.axisLine.symbol",alias:"纵坐标轴.轴线箭头",type:"Enum('none:无', 'arrow:箭头')[2]",primitiveLabels:["开端","末端"],default:["none","none"]},{name:"yAxis.axisLine.symbolSize",alias:"纵坐标轴.箭头尺寸",type:"Number[2]",primitiveLabels:["宽度","高度"],default:[10,15]},{name:"yAxis.axisLine.lineStyle.color",alias:"纵坐标轴.轴线颜色",type:"String",editor:"color",default:"#333"},{name:"yAxis.axisLine.lineStyle.width",alias:"纵坐标轴.轴线宽度",type:"Number",default:1,min:0},{name:"yAxis.axisLine.lineStyle.type",alias:"纵坐标轴.轴线样式",type:'Enum("solid:实线","dashed:虚线","dotted:点线")',default:"solid"},{name:"yAxis.axisLine.lineStyle.opacity",alias:"纵坐标轴.轴线透明度",type:"Number",default:1,min:0,max:1,precision:2,step:.01},{name:"yAxis.axisTick.show",alias:"纵坐标轴.显示刻度",type:"Boolean",default:!0},{name:"yAxis.axisTick.alignWithLabel",alias:"纵坐标轴.标签对齐",type:"Boolean",default:!0},{name:"yAxis.axisTick.length",alias:"纵坐标轴.刻度线长",type:"Number",default:5,min:0},{name:"yAxis.axisTick.lineStyle.width",alias:"纵坐标轴.刻度线宽",type:"Number",default:1,min:0},{name:"yAxis.axisTick.lineStyle.type",alias:"纵坐标轴.刻度样式",type:'Enum("solid:实线","dashed:虚线","dotted:点线")',default:"solid"},{name:"yAxis.axisTick.lineStyle.opacity",alias:"纵坐标轴.刻度透明度",type:"Number",default:1,min:0,max:1,precision:2,step:.01},{name:"yAxis.splitLine.show",alias:"纵坐标轴.显示隔线",type:"Boolean",default:!0},{name:"yAxis.splitLine.lineStyle.width",alias:"纵坐标轴.隔线宽度",type:"Number",default:1,min:0},{name:"yAxis.splitLine.lineStyle.type",alias:"纵坐标轴.隔线样式",type:'Enum("solid:实线","dashed:虚线","dotted:点线")',default:"solid"},{name:"yAxis.splitLine.lineStyle.opacity",alias:"纵坐标轴.隔线透明度",type:"Number",default:1,min:0,max:1,precision:2,step:.01},{name:"yAxis.splitArea.show",alias:"纵坐标轴.分隔区域显示",type:"Boolean",default:!1},{name:"yAxis.splitArea.areaStyle.opacity",alias:"纵坐标轴.分隔区域透明度",type:"Number",default:1,min:0,max:1,precision:2,step:.01},{name:"yAxis.axisPointer.show",alias:"纵坐标轴.指示器显示",type:"Boolean",default:!1},{name:"yAxis.axisPointer.type",alias:"纵坐标轴.指示器类型",type:'Enum("line:直线","shadow:阴影","none:无")',default:"line"},{name:"yAxis.data",alias:"纵坐标轴.数据",type:"Complex[*]",linkable:!0,customGroupName:"linkable",default:null,editor:"code"},{name:"yAxis.dataField",alias:"纵坐标轴.数据字段名",type:"String",visible:!1,default:""}]}],chartCoordinatePolar:[{name:"polar",alias:"极坐标",type:"Complex",attributes:[{name:"polar.center",alias:"中心坐标",type:"String[2]",default:["50%","50%"],maxlength:"7",primitiveLabels:["横坐标","纵坐标"],rules:[{pattern:"/^(__quote:percentage__|(^\\d+$))$/",message:"请输入非负整数或百分比"}]},{name:"polar.radius",alias:"坐标半径",type:"String[2]",default:["0%","80%"],maxlength:"7",primitiveLabels:["内半径","外半径"],rules:[{pattern:"/^(__quote:percentage__|(^\\d+$))$/",message:"请输入非负整数或百分比"}]}]},{name:"radiusAxis",alias:"径向轴",type:"Complex",attributes:[{name:"radiusAxis.show",alias:"径向轴.显示",type:"Boolean",default:!1},{name:"radiusAxis.type",alias:"径向轴.类型",type:'Enum("value:数值轴","category:类目轴","time:时间轴","log:对数轴")',default:"category"},{name:"radiusAxis.name",alias:"径向轴.名称",type:"String",minlength:0,maxlength:10,default:""},{name:"radiusAxis.nameLocation",alias:"径向轴.名称位置",type:'Enum("start:开端","center:中间","end:末端")',default:"end"},{name:"radiusAxis.nameGap",alias:"径向轴.名称与轴线距离",type:"Number",default:15},{name:"radiusAxis.nameRotate",alias:"径向轴.名称旋转角度",type:"Number",default:0,min:-360,max:360},{name:"radiusAxis.inverse",alias:"径向轴.反向坐标",type:"Boolean",default:!1},{name:"radiusAxis.boundaryGap",alias:"径向轴.两边是否留白",type:"Boolean",default:!0,primitiveLabels:["前侧","后侧"]},{name:"radiusAxis.min",alias:"径向轴.刻度最小值",type:"String",default:null,rules:[{pattern:"/(^$)|(^(-?\\d+$)|(^dataMin))$/",message:"请输入整数或字符串dataMin"}]},{name:"radiusAxis.max",alias:"径向轴.刻度最大值",type:"String",default:null,rules:[{pattern:"/(^$)|(^(-?\\d+$)|(^dataMax))$/",message:"请输入整数或字符串dataMax"}]},{name:"radiusAxis.axisLine.show",alias:"径向轴.轴线显示",type:"Boolean",default:!0},{name:"radiusAxis.axisLine.symbol",alias:"径向轴.轴线箭头",type:"Enum('none:无', 'arrow:箭头')[2]",primitiveLabels:["开端","末端"],default:["none","none"]},{name:"radiusAxis.axisLine.symbolSize",alias:"径向轴.箭头尺寸",type:"Number[2]",primitiveLabels:["宽度","高度"],default:[10,15]},{name:"radiusAxis.axisLine.lineStyle.color",alias:"径向轴.轴线颜色",type:"String",editor:"color",default:"#333"},{name:"radiusAxis.axisLine.lineStyle.width",alias:"径向轴.轴线宽度",type:"Number",default:1,min:0},{name:"radiusAxis.axisLine.lineStyle.type",alias:"径向轴.轴线样式",type:'Enum("solid:实线","dashed:虚线","dotted:点线")',default:"solid"},{name:"radiusAxis.axisLine.lineStyle.opacity",alias:"径向轴.轴线透明度",type:"Number",default:1,min:0,max:1,precision:2,step:.01},{name:"radiusAxis.axisTick.show",alias:"径向轴.显示刻度",type:"Boolean",default:!0},{name:"radiusAxis.axisTick.alignWithLabel",alias:"径向轴.标签对齐",type:"Boolean",default:!1},{name:"radiusAxis.axisTick.lineStyle.width",alias:"径向轴.刻度线宽",type:"Number",default:1,min:0},{name:"radiusAxis.axisTick.lineStyle.type",alias:"径向轴.刻度样式",type:'Enum("solid:实线","dashed:虚线","dotted:点线")',default:"solid"},{name:"radiusAxis.axisTick.lineStyle.opacity",alias:"径向轴.刻度透明度",type:"Number",default:1,min:0,max:1,precision:2,step:.01},{name:"radiusAxis.axisLabel.show",alias:"径向轴.显示标签",type:"Boolean",default:!0},{name:"radiusAxis.axisLabel.formatter",alias:"径向轴.标签格式",type:"String",default:null},{name:"radiusAxis.splitLine.show",alias:"径向轴.显示隔线",type:"Boolean",default:!0},{name:"radiusAxis.splitLine.lineStyle.width",alias:"径向轴.隔线宽度",type:"Number",default:1,min:0},{name:"radiusAxis.splitLine.lineStyle.type",alias:"径向轴.隔线样式",type:'Enum("solid:实线","dashed:虚线","dotted:点线")',default:"solid"},{name:"radiusAxis.splitLine.lineStyle.opacity",alias:"径向轴.隔线透明度",type:"Number",default:1,min:0,max:1,precision:2,step:.01},{name:"radiusAxis.splitArea.show",alias:"径向轴.分隔区域显示",type:"Boolean",default:!1},{name:"radiusAxis.splitArea.areaStyle.opacity",alias:"径向轴.分隔区域透明度",type:"Number",default:1,min:0,max:1,precision:2,step:.01},{name:"radiusAxis.axisPointer.show",alias:"径向轴.指示器显示",type:"Boolean",default:!1},{name:"radiusAxis.axisPointer.type",alias:"径向轴.指示器类型",type:'Enum("line:直线","shadow:阴影","none:无")',default:"line"},{name:"radiusAxis.axisPointer.snap",alias:"径向轴.指示器.自动吸附",type:"Boolean",default:null},{name:"radiusAxis.data",alias:"径向轴.数据",type:"Complex[*]",linkable:!0,editor:"code",customGroupName:"linkable"},{name:"radiusAxis.dataField",alias:"径向轴.数据字段名",type:"String",visible:!1,default:""}]},{name:"angleAxis",alias:"角度轴",type:"Complex",inputVisible:!1,attributes:[{name:"angleAxis.show",alias:"角度轴.显示",type:"Boolean",default:!1},{name:"angleAxis.type",alias:"角度轴.类型",type:'Enum("value:数值轴","category:类目轴","time:时间轴","log:对数轴")',default:"value"},{name:"angleAxis.boundaryGap",alias:"角度轴.两边是否留白",type:"String[2]",default:null,primitiveLabels:["前侧","后侧"],rules:[{pattern:"/^((\\d+$)|((\\d|[1-9]\\d|100)(\\.\\d{1,2})?%))$/",message:"请输入非负整数或百分比"}]},{name:"angleAxis.min",alias:"角度轴.刻度最小值",type:"String",default:null,rules:[{pattern:"/(^$)|(^(-?\\d+$)|(^dataMin))$/",message:"请输入整数或字符串dataMin"}]},{name:"angleAxis.max",alias:"角度轴.刻度最大值",type:"String",default:null,rules:[{pattern:"/(^$)|(^(-?\\d+$)|(^dataMax))$/",message:"请输入整数或字符串dataMax"}]},{name:"angleAxis.axisLine.show",alias:"角度轴.轴线显示",type:"Boolean",default:!0},{name:"angleAxis.axisLine.symbolSize",alias:"角度轴.箭头尺寸",type:"Number[2]",primitiveLabels:["宽度","高度"],default:[10,15],customGroupName:"isHideSymbolSize"},{name:"angleAxis.axisLine.lineStyle.color",alias:"角度轴.轴线颜色",type:"String",editor:"color",default:"#333"},{name:"angleAxis.axisLine.lineStyle.width",alias:"角度轴.轴线宽度",type:"Number",default:1,min:0},{name:"angleAxis.axisLine.lineStyle.type",alias:"角度轴.轴线样式",type:'Enum("solid:实线","dashed:虚线","dotted:点线")',default:"solid"},{name:"angleAxis.axisLine.lineStyle.opacity",alias:"角度轴.轴线透明度",type:"Number",default:1,min:0,max:1,precision:2,step:.01},{name:"angleAxis.axisTick.show",alias:"角度轴.显示刻度",type:"Boolean",default:!0},{name:"angleAxis.axisTick.alignWithLabel",alias:"角度轴.标签对齐",type:"Boolean",default:!1},{name:"angleAxis.axisTick.lineStyle.width",alias:"角度轴.刻度线宽",type:"Number",default:1,min:0},{name:"angleAxis.axisTick.lineStyle.type",alias:"角度轴.刻度样式",type:'Enum("solid:实线","dashed:虚线","dotted:点线")',default:"solid"},{name:"angleAxis.axisTick.lineStyle.opacity",alias:"角度轴.刻度透明度",type:"Number",default:1,min:0,max:1,precision:2,step:.01},{name:"angleAxis.axisLabel.show",alias:"角度轴.显示标签",type:"Boolean",default:!0},{name:"angleAxis.axisLabel.formatter",alias:"角度轴.标签格式",type:"String",default:null},{name:"angleAxis.splitLine.show",alias:"角度轴.显示隔线",type:"Boolean",default:!0},{name:"angleAxis.splitLine.lineStyle.width",alias:"角度轴.隔线宽度",type:"Number",default:1,min:0},{name:"angleAxis.splitLine.lineStyle.type",alias:"角度轴.隔线样式",type:'Enum("solid:实线","dashed:虚线","dotted:点线")',default:"solid"},{name:"angleAxis.splitLine.lineStyle.opacity",alias:"角度轴.隔线透明度",type:"Number",default:1,min:0,max:1,precision:2,step:.01},{name:"angleAxis.splitArea.show",alias:"角度轴.分隔区域显示",type:"Boolean",default:!1},{name:"angleAxis.splitArea.areaStyle.opacity",alias:"角度轴.分隔区域透明度",type:"Number",default:1,min:0,max:1,precision:2,step:.01},{name:"angleAxis.axisPointer.show",alias:"角度轴.指示器显示",type:"Boolean",default:!1},{name:"angleAxis.axisPointer.type",alias:"角度轴.指示器类型",type:'Enum("line:直线","shadow:阴影","none:无")',default:"line"},{name:"angleAxis.axisPointer.snap",alias:"角度轴.指示器.自动吸附",type:"Boolean",default:null},{name:"angleAxis.data",alias:"角度轴.数据",type:"Complex[*]",default:null,linkable:!0,editor:"code",customGroupName:"linkable"},{name:"angleAxis.dataField",alias:"角度轴.数据字段名",visible:!1,type:"String",default:""}]}],chartMethods:[{name:"setOption",alias:"设置图表配置项",type:"Complex",readonly:!0,attributes:[{name:"functionName",alias:"方法名称",type:"String",default:"setOption"},{name:"description",alias:"方法描述",type:"String",default:"设置图表配置项"},{name:"payload",alias:"参数",type:"Complex[1]",inputVisible:!1,attributes:"smartAttrs.payload",default:[{name:"option",alias:"配置项",editor:"variable"},{name:"notMerge",alias:"不合并配置",editor:"variable",type:"Boolean",default:!1,tips:["是否不跟之前设置的 `option` 进行合并","默认为 `false`, 即表示合并","如果为 `true`，表示所有组件都会被删除，然后根据新 `option` 创建所有新组件"]},{name:"replaceMerge",alias:"组件配置",editor:"variable",visible:{notMerge:!1},tips:['用户可以在这里指定一个或多个组件，如：`xAxis`, `series`，多个属性用`,(英文逗号)`隔开，这些指定的组件会进行 "replaceMerge"','如果用户想删除部分组件，也可使用 "replaceMerge"']},{name:"lazyUpdate",alias:"不同步更新",editor:"variable",type:"Boolean",tips:["在设置完 `option` 后是否不立即更新图表","默认为 `false`，即同步立即更新","如果为 `true`，则会在下一个 animation frame 中，才更新图表"]},{name:"silent",alias:"阻止抛出事件",editor:"variable",type:"Boolean",tips:["阻止调用 `setOption` 时抛出事件，默认为 `false`，即抛出事件"]}]}]},{name:"refresh",alias:"刷新数据",type:"Complex",attributes:[{name:"functionName",alias:"方法名称",type:"String",readonly:!0,default:"refresh"},{name:"description",alias:"方法描述",type:"String",readonly:!0,default:"此方法用于刷新图表关联数据"}]}],chartEvents:[{name:"click",alias:"点击",type:"Complex",attributes:[{name:"content",alias:"事件执行内容",type:"Complex[*]",inputVisible:!1,attributes:"smartAttrs.eventContent"},{name:"description",alias:"事件描述",type:"String",default:"点击图表触发的动作",readonly:!0},{name:"payload",alias:"参数",type:"Complex[1]",readonly:!0,inputVisible:!1,attributes:"smartAttrs.payload",default:[{name:"params",alias:"图表点击事件参数"}]}]}],chartGrid3D:[{name:"grid3D",alias:"三维笛卡尔坐标系",type:"Complex",attributes:[{name:"grid3D.show",alias:"坐标系.显示",type:"Boolean",default:!0},{name:"grid3D.boxWidth",alias:"坐标系.宽度",type:"Number",default:85,min:0},{name:"grid3D.boxHeight",alias:"坐标系.高度",type:"Number",default:85,min:0},{name:"grid3D.boxDepth",alias:"坐标系.深度",type:"Number",default:85,min:0},{name:"grid3D.viewControl.projection",alias:"坐标系.视角.投影方式",type:"Enum('perspective:透视投影','orthographic:正交投影')",default:"perspective"},{name:"grid3D.viewControl.autoRotate",alias:"坐标系.视角.自动旋转",type:"Boolean",default:!1},{name:"grid3D.viewControl.autoRotateDirection",alias:"坐标系.视角.自转方向",type:"Enum('cw:顺时针方向','ccw:逆时针方向')",default:"cw"},{name:"grid3D.viewControl.autoRotateSpeed",alias:"坐标系.视角.自转速度",type:"Number",default:10,precision:1,min:0},{name:"grid3D.viewControl.autoRotateAfterStill",alias:"坐标系.视角.恢复自转时间间隔",type:"Number",default:3,min:1,max:999999},{name:"grid3D.viewControl.distance",alias:"坐标系.视角.距离主体的距离",type:"Number",default:200,precision:1,min:0},{name:"grid3D.viewControl.minDistance",alias:"坐标系.视角.鼠标控制缩放的最小值",type:"Number",default:20,precision:1,min:0},{name:"grid3D.viewControl.maxDistance",alias:"坐标系.视角.鼠标控制缩放的最大值",type:"Number",default:400,precision:1,min:0},{name:"grid3D.viewControl.orthographicSize",alias:"坐标系.视角.正交投影的大小",type:"Number",default:200,precision:1,min:0},{name:"grid3D.viewControl.minOrthographicSize",alias:"坐标系.视角.正交投影缩放的最小值",type:"Number",default:20,precision:1,min:0},{name:"grid3D.viewControl.maxOrthographicSize",alias:"坐标系.视角.正交投影缩放的最大值",type:"Number",default:400,precision:1,min:0},{name:"grid3D.left",alias:"坐标系.左边距",type:"String",default:"auto",tips:"允许六种值：1.自动:auto；2.靠左:left；3.靠右:right；4.居中:center；5.正整数:300；6.百分比:50%",rules:[{pattern:"/^(__quote:percentage__||(^\\d+$)|(left)|(right)|(center)|(auto))$/",message:"请输入正整数或百分比或字符串"}]},{name:"grid3D.top",alias:"坐标系.上边距",type:"String",default:"auto",tips:"允许六种值：1.自动:auto；2.靠上:top；3.靠下:bottom；4.居中:middle；5.正整数:300；6.百分比:50%",rules:[{pattern:"/^(__quote:percentage__||(^\\d+$)|(top)|(middle)|(bottom)|(auto))$/",message:"请输入正整数或百分比或字符串"}]},{name:"grid3D.width",alias:"坐标系.视图宽度",type:"String",default:"auto",tips:"允许三种值：1.自动:auto；2.正整数:300；3.百分比:50%",rules:[{pattern:"/^(__quote:percentage__||(^\\d+$)|(auto))$/",message:"请输入正整数或百分比或字符串"}]},{name:"grid3D.height",alias:"坐标系.视图高度",type:"String",default:"auto",tips:"允许三种值：1.自动:auto；2.正整数:300；3.百分比:50%",rules:[{pattern:"/^(__quote:percentage__||(^\\d+$)|(auto))$/",message:"请输入正整数或百分比或字符串"}]}]}],chartXAxis3D:[{name:"xAxis3D",alias:"X轴",type:"Complex",attributes:[{name:"xAxis3D.type",alias:"坐标轴.类型",type:"Enum('value:值', 'category:类目轴', 'time:时间轴', 'log:对数轴')",default:"value"},{name:"xAxis3D.data",alias:"坐标轴.数据",type:"Complex[*]",default:null,editor:"code",linkable:!0,customGroupName:"linkable",tips:"类目数据，在类目轴中有效。"},{name:"xAxis3D.dataField",alias:"系列.关联数据字段名",type:"String",default:"",visible:!1},{name:"xAxis3D.name",alias:"坐标轴.名称",type:"String",maxlength:10,default:"X"},{name:"xAxis3D.nameTextStyle.color",alias:"坐标轴.名称.颜色",type:"String",default:null,editor:"color"},{name:"xAxis3D.nameTextStyle.fontSize",alias:"坐标轴.名称.字体大小",type:"Number",default:16,min:8},{name:"xAxis3D.nameGap",alias:"名称与轴线间的距离",type:"Number",default:20},{name:"xAxis3D.min",alias:"坐标轴.刻度最小值",type:"String",default:null,tips:"允许两种值：1.自动:dataMin；2.整数",rules:[{pattern:"/(^$)|(^(-?\\d+$)|(^dataMin))$/",message:"请输入数字或指定字符串"}]},{name:"xAxis3D.max",alias:"坐标轴.刻度最大值",type:"String",default:null,tips:"允许两种值：1.自动:dataMax；2.整数",rules:[{pattern:"/(^$)|(^(-?\\d+$)|(^dataMax))$/",message:"请输入数字或指定字符串"}]},{name:"xAxis3D.splitNumber",alias:"坐标轴.分割段数",type:"Number",default:5,min:0,tips:"分割段数只是个预估值，最后实际显示的段数会在这个基础上根据分割后坐标轴刻度显示的易读程度作调整"},{name:"xAxis3D.axisLine.lineStyle.color",alias:"坐标轴.轴线.颜色",type:"String",default:"#333",editor:"color"},{name:"xAxis3D.axisLine.lineStyle.opacity",alias:"坐标轴.轴线.透明度",type:"Number",default:1,min:0,max:1,precision:2,step:.1},{name:"xAxis3D.axisLine.lineStyle.width",alias:"坐标轴.轴线.宽度",type:"Number",default:2,min:0},{name:"xAxis3D.axisLabel.show",alias:"坐标轴.刻度标签.显示",type:"Boolean",default:!0},{name:"xAxis3D.axisLabel.margin",alias:"坐标轴.刻度标签.与轴线的距离",type:"Number",default:8},{name:"xAxis3D.axisLabel.textStyle.color",alias:"坐标轴.刻度标签.文字颜色",type:"String",default:null,editor:"color"},{name:"xAxis3D.axisLabel.textStyle.fontSize",alias:"坐标轴.刻度标签.字体大小",type:"Number",default:12,min:8},{name:"xAxis3D.axisLabel.textStyle.fontWeight",alias:"坐标轴.刻度标签.字体粗细",type:"Enum('normal:常规','bolder:加粗')",default:"normal"},{name:"xAxis3D.axisTick.show",alias:"显示刻度线",type:"Boolean",default:!0},{name:"xAxis3D.axisTick.length",alias:"刻度线的长度",type:"Number",default:5,min:0},{name:"xAxis3D.axisTick.lineStyle.color",alias:"刻度线的颜色",type:"String",default:null,editor:"color"},{name:"xAxis3D.axisTick.lineStyle.opacity",alias:"刻度线的透明度",type:"Number",default:1,min:0,max:1,precision:2,step:.1},{name:"xAxis3D.axisTick.lineStyle.width",alias:"刻度线的宽度",type:"Number",default:1,min:0},{name:"xAxis3D.splitLine.show",alias:"显示轴线",type:"Boolean",default:!0},{name:"xAxis3D.splitLine.lineStyle.color",alias:"轴线颜色",type:"String",default:null,editor:"color"},{name:"xAxis3D.splitLine.lineStyle.opacity",alias:"轴线透明度",type:"Number",default:1,min:0,max:1,precision:2,step:.1},{name:"xAxis3D.splitLine.lineStyle.width",alias:"轴线宽度",type:"Number",default:1,min:0},{name:"xAxis3D.splitArea.show",alias:"显示分隔区域",type:"Boolean",default:!1},{name:"xAxis3D.splitArea.areaStyle.color",alias:"分隔区域颜色",type:"String[2]",default:["rgba(250,250,250,0.3)","rgba(200,200,200,0.3)"],editor:"color"},{name:"xAxis3D.axisPointer.show",alias:"显示坐标轴指示线",type:"Boolean",default:!0},{name:"xAxis3D.axisPointer.lineStyle.color",alias:"指示线线条颜色",type:"String",default:"#333",editor:"color"},{name:"xAxis3D.axisPointer.lineStyle.opacity",alias:"指示线线条透明度",type:"Number",default:1,min:0,max:1,precision:2,step:.1},{name:"xAxis3D.axisPointer.lineStyle.width",alias:"指示线线条宽度",type:"Number",default:1,min:0},{name:"xAxis3D.axisPointer.label.show",alias:"显示指示线标签",type:"Boolean",default:!0}]}],chartYAxis3D:[{name:"yAxis3D",alias:"Y轴",type:"Complex",attributes:[{name:"yAxis3D.type",alias:"坐标轴.类型",type:"Enum('value:值', 'category:类目轴', 'time:时间轴', 'log:对数轴')",default:"value"},{name:"yAxis3D.data",alias:"坐标轴.数据",type:"Complex[*]",default:null,editor:"code",linkable:!0,customGroupName:"linkable",tips:"类目数据，在类目轴中有效。"},{name:"yAxis3D.dataField",alias:"系列.关联数据字段名",type:"String",default:"",visible:!1},{name:"yAxis3D.name",alias:"坐标轴.名称",type:"String",maxlength:10,default:"Y"},{name:"yAxis3D.nameTextStyle.color",alias:"坐标轴.名称.颜色",type:"String",default:null,editor:"color"},{name:"yAxis3D.nameTextStyle.fontSize",alias:"坐标轴.名称.字体大小",type:"Number",default:16,min:8},{name:"yAxis3D.nameGap",alias:"名称与轴线间的距离",type:"Number",default:20},{name:"yAxis3D.min",alias:"坐标轴.刻度最小值",type:"String",default:null,tips:"允许两种值：1.自动:dataMin；2.整数",rules:[{pattern:"/(^$)|(^(-?\\d+$)|(^dataMin))$/",message:"请输入数字或指定字符串"}]},{name:"yAxis3D.max",alias:"坐标轴.刻度最大值",type:"String",default:null,tips:"允许两种值：1.自动:dataMax；2.整数",rules:[{pattern:"/(^$)|(^(-?\\d+$)|(^dataMax))$/",message:"请输入数字或指定字符串"}]},{name:"yAxis3D.splitNumber",alias:"坐标轴.分割段数",type:"Number",default:5,min:0,tips:"分割段数只是个预估值，最后实际显示的段数会在这个基础上根据分割后坐标轴刻度显示的易读程度作调整"},{name:"yAxis3D.axisLine.lineStyle.color",alias:"坐标轴.轴线.颜色",type:"String",default:"#333",editor:"color"},{name:"yAxis3D.axisLine.lineStyle.opacity",alias:"坐标轴.轴线.透明度",type:"Number",default:1,min:0,max:1,precision:2,step:.1},{name:"yAxis3D.axisLine.lineStyle.width",alias:"坐标轴.轴线.宽度",type:"Number",default:2,min:0},{name:"yAxis3D.axisLabel.show",alias:"坐标轴.刻度标签.显示",type:"Boolean",default:!0},{name:"yAxis3D.axisLabel.margin",alias:"坐标轴.刻度标签.与轴线的距离",type:"Number",default:8},{name:"yAxis3D.axisLabel.textStyle.color",alias:"坐标轴.刻度标签.文字颜色",type:"String",default:null,editor:"color"},{name:"yAxis3D.axisLabel.textStyle.fontSize",alias:"坐标轴.刻度标签.字体大小",type:"Number",default:12,min:8},{name:"yAxis3D.axisLabel.textStyle.fontWeight",alias:"坐标轴.刻度标签.字体粗细",type:"Enum('normal:常规','bolder:加粗')",default:"normal"},{name:"yAxis3D.axisTick.show",alias:"显示刻度线",type:"Boolean",default:!0},{name:"yAxis3D.axisTick.length",alias:"刻度线的长度",type:"Number",default:5,min:0},{name:"yAxis3D.axisTick.lineStyle.color",alias:"刻度线的颜色",type:"String",default:null,editor:"color"},{name:"yAxis3D.axisTick.lineStyle.opacity",alias:"刻度线的透明度",type:"Number",default:1,min:0,max:1,precision:2,step:.1},{name:"yAxis3D.axisTick.lineStyle.width",alias:"刻度线的宽度",type:"Number",default:1,min:0},{name:"yAxis3D.splitLine.show",alias:"显示轴线",type:"Boolean",default:!0},{name:"yAxis3D.splitLine.lineStyle.color",alias:"轴线颜色",type:"String",default:null,editor:"color"},{name:"yAxis3D.splitLine.lineStyle.opacity",alias:"轴线透明度",type:"Number",default:1,min:0,max:1,precision:2,step:.1},{name:"yAxis3D.splitLine.lineStyle.width",alias:"轴线宽度",type:"Number",default:1,min:0},{name:"yAxis3D.splitArea.show",alias:"显示分隔区域",type:"Boolean",default:!1},{name:"yAxis3D.splitArea.areaStyle.color",alias:"分隔区域颜色",type:"String[2]",default:["rgba(250,250,250,0.3)","rgba(200,200,200,0.3)"],editor:"color"},{name:"yAxis3D.axisPointer.show",alias:"显示坐标轴指示线",type:"Boolean",default:!0},{name:"yAxis3D.axisPointer.lineStyle.color",alias:"指示线线条颜色",type:"String",default:"#333",editor:"color"},{name:"yAxis3D.axisPointer.lineStyle.opacity",alias:"指示线线条透明度",type:"Number",default:1,min:0,max:1,precision:2,step:.1},{name:"yAxis3D.axisPointer.lineStyle.width",alias:"指示线线条宽度",type:"Number",default:1,min:0},{name:"yAxis3D.axisPointer.label.show",alias:"显示指示线标签",type:"Boolean",default:!0}]}],chartZAxis3D:[{name:"zAxis3D",alias:"Z轴",type:"Complex",attributes:[{name:"zAxis3D.type",alias:"坐标轴.类型",type:"Enum('value:值', 'category:类目轴', 'time:时间轴', 'log:对数轴')",default:"value"},{name:"zAxis3D.data",alias:"坐标轴.数据",type:"Complex[*]",default:null,editor:"code",linkable:!0,customGroupName:"linkable",tips:"类目数据，在类目轴中有效。"},{name:"zAxis3D.dataField",alias:"系列.关联数据字段名",type:"String",default:"",visible:!1},{name:"zAxis3D.name",alias:"坐标轴.名称",type:"String",maxlength:10,default:"Z"},{name:"zAxis3D.nameTextStyle.color",alias:"坐标轴.名称.颜色",type:"String",default:null,editor:"color"},{name:"zAxis3D.nameTextStyle.fontSize",alias:"坐标轴.名称.字体大小",type:"Number",default:16,min:8},{name:"zAxis3D.nameGap",alias:"名称与轴线间的距离",type:"Number",default:20},{name:"zAxis3D.min",alias:"坐标轴.刻度最小值",type:"String",default:null,tips:"允许两种值：1.自动:dataMin；2.整数",rules:[{pattern:"/(^$)|(^(-?\\d+$)|(^dataMin))$/",message:"请输入数字或指定字符串"}]},{name:"zAxis3D.max",alias:"坐标轴.刻度最大值",type:"String",default:null,tips:"允许两种值：1.自动:dataMax；2.整数",rules:[{pattern:"/(^$)|(^(-?\\d+$)|(^dataMax))$/",message:"请输入数字或指定字符串"}]},{name:"zAxis3D.splitNumber",alias:"坐标轴.分割段数",type:"Number",default:5,min:0,tips:"分割段数只是个预估值，最后实际显示的段数会在这个基础上根据分割后坐标轴刻度显示的易读程度作调整"},{name:"zAxis3D.axisLine.lineStyle.color",alias:"坐标轴.轴线.颜色",type:"String",default:"#333",editor:"color"},{name:"zAxis3D.axisLine.lineStyle.opacity",alias:"坐标轴.轴线.透明度",type:"Number",default:1,min:0,max:1,precision:2,step:.1},{name:"zAxis3D.axisLine.lineStyle.width",alias:"坐标轴.轴线.宽度",type:"Number",default:2,min:0},{name:"zAxis3D.axisLabel.show",alias:"坐标轴.刻度标签.显示",type:"Boolean",default:!0},{name:"zAxis3D.axisLabel.margin",alias:"坐标轴.刻度标签.与轴线的距离",type:"Number",default:8},{name:"zAxis3D.axisLabel.textStyle.color",alias:"坐标轴.刻度标签.文字颜色",type:"String",default:null,editor:"color"},{name:"zAxis3D.axisLabel.textStyle.fontSize",alias:"坐标轴.刻度标签.字体大小",type:"Number",default:12,min:8},{name:"zAxis3D.axisLabel.textStyle.fontWeight",alias:"坐标轴.刻度标签.字体粗细",type:"Enum('normal:常规','bolder:加粗')",default:"normal"},{name:"zAxis3D.axisTick.show",alias:"显示刻度线",type:"Boolean",default:!0},{name:"zAxis3D.axisTick.length",alias:"刻度线的长度",type:"Number",default:5,min:0},{name:"zAxis3D.axisTick.lineStyle.color",alias:"刻度线的颜色",type:"String",default:null,editor:"color"},{name:"zAxis3D.axisTick.lineStyle.opacity",alias:"刻度线的透明度",type:"Number",default:1,min:0,max:1,precision:2,step:.1},{name:"zAxis3D.axisTick.lineStyle.width",alias:"刻度线的宽度",type:"Number",default:1,min:0},{name:"zAxis3D.splitLine.show",alias:"显示轴线",type:"Boolean",default:!0},{name:"zAxis3D.splitLine.lineStyle.color",alias:"轴线颜色",type:"String",default:null,editor:"color"},{name:"zAxis3D.splitLine.lineStyle.opacity",alias:"轴线透明度",type:"Number",default:1,min:0,max:1,precision:2,step:.1},{name:"zAxis3D.splitLine.lineStyle.width",alias:"轴线宽度",type:"Number",default:1,min:0},{name:"zAxis3D.splitArea.show",alias:"显示分隔区域",type:"Boolean",default:!1},{name:"zAxis3D.splitArea.areaStyle.color",alias:"分隔区域颜色",type:"String[2]",default:["rgba(250,250,250,0.3)","rgba(200,200,200,0.3)"],editor:"color"},{name:"zAxis3D.axisPointer.show",alias:"显示坐标轴指示线",type:"Boolean",default:!0},{name:"zAxis3D.axisPointer.lineStyle.color",alias:"指示线线条颜色",type:"String",default:"#333",editor:"color"},{name:"zAxis3D.axisPointer.lineStyle.opacity",alias:"指示线线条透明度",type:"Number",default:1,min:0,max:1,precision:2,step:.1},{name:"zAxis3D.axisPointer.lineStyle.width",alias:"指示线线条宽度",type:"Number",default:1,min:0},{name:"zAxis3D.axisPointer.label.show",alias:"显示指示线标签",type:"Boolean",default:!0}]}],chartVisualMap:[{name:"visualMap",alias:"视觉映射组件",type:"Complex[*]",inputVisible:!1,attributes:[{name:"visualMap.show",alias:"显示",type:"Boolean",default:!1},{name:"visualMap.type",alias:"类型",type:'Enum("continuous:连续型","piecewise:分段型")',default:"continuous"},{name:"visualMap.seriesIndex",alias:"指定取哪个系列的数据",type:"String",default:"0",tips:"默认取所有。允许两种值：1.自动:auto；2.其他数值",rules:[{pattern:"/^(([0-9]+\\.?[0-9]*|-[0-9]+\\.?[0-9]*)|(auto)|())$/",message:"请输入数字或指定字符串"}]},{name:"visualMap.min",alias:"最小值",type:"Number",default:0,min:-99999},{name:"visualMap.max",alias:"最大值",type:"Number",default:20,min:-99999},{name:"visualMap.calculable",alias:"显示拖拽手柄",type:"Boolean",default:!1},{name:"visualMap.realtime",alias:"实时更新",type:"Boolean",default:!0},{name:"visualMap.inverse",alias:"是否反转",type:"Boolean",default:!1},{name:"visualMap.precision",alias:"数据展示小数精度",type:"Number",default:0,min:0},{name:"visualMap.itemWidth",alias:"图形宽度",type:"Number",default:20,min:0},{name:"visualMap.itemHeight",alias:"图形高度",type:"Number",default:140,min:0},{name:"visualMap.text",alias:"两端的文本",type:"String[2]",default:"",maxlength:50,primitiveLabels:["top","bottom"]},{name:"visualMap.dimension",alias:"维度",type:"Enum('0:X轴','1:Y轴','2:Z轴')",default:null},{name:"visualMap.hoverLink",alias:"图形元素高亮",type:"Boolean",default:!0},{name:"visualMap.inRange.color",alias:"图元的颜色",type:"String[*]",default:["#f6efa6","#d88273","#bf444c"],editor:"color"},{name:"visualMap.inRange.opacity",alias:"图元以及其附属物的透明度",type:"Number",default:1,min:0,max:1,precision:2,step:.1},{name:"visualMap.left",alias:"离容器左侧的距离",type:"String",default:"auto",tips:"允许六种值：1.自动:auto；2.靠左:left；3.靠右:right；4.居中:center；5.正整数:300；6.百分比:50%",rules:[{pattern:"/^(__quote:percentage__||(^\\d+$)|(left)|(right)|(center)|(auto))$/",message:"请输入正整数或百分比或字符串"}]},{name:"visualMap.right",alias:"离容器右侧的距离",type:"String",default:"auto",tips:"允许三种值：1.自动:auto；2.正整数:300；3.百分比:50%",rules:[{pattern:"/^(__quote:percentage__||(^\\d+$)|(auto))$/",message:"请输入正整数或百分比或字符串"}]},{name:"visualMap.top",alias:"离容器顶部的距离",type:"String",default:"auto",tips:"允许六种值：1.自动:auto；2.靠上:top；3.靠下:bottom；4.居中:middle；5.正整数:300；6.百分比:50%",rules:[{pattern:"/^(__quote:percentage__||(^\\d+$)|(top)|(middle)|(bottom)|(auto))$/",message:"请输入正整数或百分比或字符串"}]},{name:"visualMap.bottom",alias:"离容器底部的距离",type:"String",default:"auto",tips:"允许三种值：1.自动:auto；2.正整数:300；3.百分比:50%",rules:[{pattern:"/^(__quote:percentage__||(^\\d+$)|(auto))$/",message:"请输入正整数或百分比或字符串"}]},{name:"visualMap.orient",alias:"放置方式",type:'Enum("horizontal:水平","vertical:竖直")',default:"vertical"},{name:"visualMap.textStyle.color",alias:"文字颜色",type:"String",editor:"color",default:"#333"},{name:"visualMap.textStyle.fontStyle",alias:"文字字体风格",type:'Enum("normal:正常", "italic:斜体")',default:"normal"},{name:"visualMap.textStyle.fontWeight",alias:"文字字体粗细",type:"Enum('normal:常规', 'bolder:加粗')",default:"normal"},{name:"visualMap.textStyle.fontSize",alias:"文字字体大小",type:"Number",default:12,min:8}]}],chartCommonLinkData:[{name:"commonLinkData",alias:"关联数据",type:"Complex[*]",default:null,linkable:!0,editor:"code"}]}},"2f15":function(e,t,a){},"2f25":function(e,t,a){},3019:function(e,t,a){},"314f":function(e,t,a){"use strict";var i={name:"AssetsCollapse",data:function(){return{title:"标题"}}},n=(a("975a"),a("2877")),r=Object(n.a)(i,(function(){var e=this,t=e._self._c;return t("el-collapse",{staticClass:"assets-collapse"},[t("el-collapse-item",{staticClass:"assets-collapse-item"},[e._t("title",(function(){return[e._v("\n      "+e._s(e.title)+"\n    ")]}),{slot:"title"}),e._t("default")],2)],1)}),[],!1,null,null,null);t.a=r.exports},"319d":function(e,t,a){"use strict";a("4de0")},"31cd":function(e,t,a){"use strict";a.r(t);var i=a("75fc"),n=(a("456d"),a("7f7f"),a("ac6a"),a("c5f6"),a("36f0")),r=a("b19c");a("8e6e"),a("28a5"),a("bd86");var o={name:"SelectIndicatorId",props:{dialogVisible:{type:Boolean,default:function(){return!1}},value:{type:Object,default:function(){return{}}},disabled:{type:Boolean,default:function(){return!1}},showInput:{type:Boolean,default:function(){return!0}},placeholder:{type:String,default:""},iconClass:{type:String,default:function(){return"el-icon-edit"}}},data:function(){return{treeData:[],selectedTreeId:"-1",tableData:[],totalDimensions:[],treeProps:{children:"children",label:"label"},searchName:"",searchCode:"",page:1,total:0,dimensionDisc:{},dialogVisible:!1,productId:"",productObj:{},currentRow:{}}},created:function(){this.productId=this.getQueryVariable("productId"),this.refreshTree(),this.refreshTable()},methods:{handleTreeNodeClick:function(e){var t;this.selectedTreeId=(null===(t=e.value)||void 0===t?void 0:t.id)||e.id,this.refreshTable()},close:function(){this.dialogVisible=!1},refreshTree:function(){var e=this,t="/api/model/instances/".concat(this.productId,"?accessMethod=foreign_key");this.$util.request({url:t}).then((function(t){e.productObj=t,e.refreshTable()}))},refreshTable:function(){var e=this,t="/api/thing-model/variables?$filter=subTemplate eq ".concat(this.productObj["subTemplate.id"],",name like ").concat(this.searchName,"&$orderBy=updateTime desc&$page=").concat(this.page,"&$pageSize=10");this.$util.request({url:t}).then((function(t){e.tableData=t.result,e.page=t.pageInfo.page,e.total=t.pageInfo.total}))},handleCurrentChange:function(e){this.currentRow=e},handlePageChange:function(e){this.refreshTable()},getRowKey:function(e){return e.id},cancel:function(){this.dialogVisible=!1},clickSure:function(){var e;null!==(e=this.currentRow)&&void 0!==e&&e.id?(this.$emit("change",this.currentRow),this.dialogVisible=!1):this.$message({type:"error",message:"请选择"})},getQueryVariable:function(e){for(var t=window.location.href,a=t.substring(t.indexOf("?")+1).split("&"),i=0;i<a.length;i++){var n=a[i].split("=");if(n[0]==e)return n[1]}return!1}}},l=(a("7cd7"),a("2877")),s=Object(l.a)(o,(function(){var e=this,t=e._self._c;return t("el-dialog",{staticClass:"indicator-link-editor-dialog",attrs:{visible:e.dialogVisible,"close-on-click-modal":!1,title:"选择模板变量",width:"56%","append-to-body":!0},on:{close:e.close}},[t("el-descriptions",{attrs:{title:"产品型号信息"}},[t("el-descriptions-item",{attrs:{label:"名称"}},[e._v(e._s(e.productObj.name))]),t("el-descriptions-item",{attrs:{label:"子连接"}},[e._v(e._s(e.productObj["subTemplate.name"]))])],1),t("el-row",{staticStyle:{height:"560px",position:"relative"}},[t("el-col",{attrs:{span:"24"}}),t("el-col",{attrs:{span:"24"}},[t("div",{staticClass:"filters"},[t("div",{staticClass:"filter-item"},[t("div",{staticClass:"filter-label"},[e._v("名称")]),t("div",{staticClass:"filter-value"},[t("el-input",{model:{value:e.searchName,callback:function(t){e.searchName=t},expression:"searchName"}})],1)]),t("div",{staticClass:"filter-item"},[t("el-button",{attrs:{type:"primary"},on:{click:e.refreshTable}},[e._v("搜索")])],1)]),t("div",[t("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.tableData,height:"450","tooltip-effect":"dark","highlight-current-row":!0,"row-key":e.getRowKey},on:{"current-change":e.handleCurrentChange}},[t("el-table-column",{attrs:{prop:"identifier",label:"标识"}}),t("el-table-column",{attrs:{prop:"name",label:"名称"}}),t("el-table-column",{attrs:{prop:"updateTime",label:"修改时间"}}),t("el-table-column",{attrs:{prop:"updateUser",width:"120",label:"修改人"}})],1),t("el-pagination",{staticStyle:{float:"right"},attrs:{"current-page":e.page,"page-size":10,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"current-change":e.handlePageChange,"update:currentPage":function(t){e.page=t},"update:current-page":function(t){e.page=t}}})],1)])],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-row",[t("el-col",{attrs:{span:24}},[t("el-button",{on:{click:e.cancel}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.clickSure}},[e._v("确 定")])],1)],1)],1)],1)}),[],!1,null,"17d2445a",null).exports,c={name:"TempVariableLinkEditor",components:{ApiFiltersSelect:a("8e8a").a,SelectIndicatorId:s},alias:"IoT变量",command:"temp-variable-link",mixins:[n.a],props:{visible:{type:String,default:function(){return!1}},showInput:{type:String,default:function(){return!0}},iconClass:{type:String,default:function(){return"el-icon-edit"}},data:{type:Object,default:function(){return{alias:"",type:"",default:"",value:"",primitiveLabels:""}}},placeholder:{type:String,default:""},autoSetValue:{type:Boolean,default:!0},linkType:{type:Number,default:function(){return 2}},handleRulesResult:{type:Function,default:function(){}},handleChangeResult:{type:Function,default:function(){}}},data:function(){return{rtDataTypes:[{label:"实时数据",value:1},{label:"历史数据",value:2}],queryDirections:[{label:"小于等于采集时间",value:1},{label:"大于等于采集时间",value:2},{label:"小于采集时间",value:3},{label:"大于采集时间",value:4}],queryTypes:[{label:"采集时间",value:1},{label:"归档时间",value:2},{label:"时间区间",value:4}],recordTypes:[{label:"历史记录",value:1},{label:"按天归档的数据",value:2},{label:"按小时归档的数据",value:3},{label:"按分钟归档的数据",value:4}],orders:[{label:"升序",value:"collectTime asc"},{label:"降序",value:"collectTime desc"}],viewMode:1,showVal:"",collectTime:"",editVal:{accessType:"tempVariable",tempVariable:{}},jsonValue:"{}",codeValue:"{}",responseSchema:"{}",codeOptions:{},codeJSONOptions:{},dialogVisible:this.visible,fetchOption:{url:"/api/model/instances"},fetchProps:{value:"id",label:"name"},fetchOptionForTree:{url:"/api/model/instances?objectType=HR_COMPANY,HR_DEPARTMENT,SYS_ASSET,SYS_EQUIPMENT&queryMode=simple&pagination=0&lazyLoad=0&$orderBy=createTime desc"}}},computed:{instanceColumns:function(){return[{prop:"objectType",label:"量测量分类",filterOnly:!0,filter:{isParam:!0,type:"select",keep:!0,options:[{label:"全部",value:"MEAS_ANALOG,MEAS_DISCRETE,MEAS_ACCUMULATOR,MEAS_STRINGMEASUREMENT"},{label:"模拟量",value:"MEAS_ANALOG"},{label:"离散量",value:"MEAS_DISCRETE"},{label:"累积量",value:"MEAS_ACCUMULATOR"},{label:"字符串量",value:"MEAS_STRINGMEASUREMENT"}],defaultValue:"MEAS_ANALOG,MEAS_DISCRETE,MEAS_ACCUMULATOR,MEAS_STRINGMEASUREMENT"}},{prop:"identifier",label:"实例标识",show:!0,width:"200",filter:{type:"input",operator:"like"}},{prop:"name",label:"实例名称",show:!0,filter:{type:"input",operator:"like"}},{prop:"createTime",label:"创建时间",show:!0},{prop:"updateTime",label:"更新时间",show:!0}]},fetchInfoOption:function(){return{url:"/api/model/instances/".concat(this.editVal.requestPayload.instanceId)}},rules:function(){return{"requestPayload.instanceId":[{required:!0,message:"请选择",trigger:"change"}],"requestPayload.collectTimeBegin":[{required:!0,message:"请选择",trigger:"change"}],"requestPayload.collectTimeEnd":[{required:!0,message:"请选择",trigger:"change"}]}}},watch:{"data.value":function(){this.initData()},visible:function(e){this.dialogVisible=e,e&&this.initData()}},created:function(){this.initData()},methods:{refreshData:function(){var e=this.editVal,t=e.requestPayload,a=e.showIdTable,i=e.rtDataType;t.queryTypes,t.objectType,a?(this.editVal.requestPayload.objectType="",this.editVal.filterItems=[{name:"",value:"",filter:"",editValue:""}]):this.editVal.tableData=[],this.editVal.requestPayload.instanceId=this.getInstanceIds(),this.editVal.requestPayload.iinstanceIds=this.getInstanceIds(),this.editVal.requestPayload.$filter=this.getFilterUrl(),1===i&&(this.editVal.requestPayload.collectTime="",this.editVal.requestPayload.beginTime="",this.editVal.requestPayload.endTime="",this.editVal.requestPayload.objectType="",this.editVal.requestPayload.recordType="",this.editVal.variableEditData={instanceIdData:{name:"instanceId",value:"",editValue:null},collectTimeData:{name:"collectTime",value:"",editValue:null},beginTimeData:{name:"beginTime",value:"",editValue:null},endTimeData:{name:"endTime",value:"",editValue:null}})},deleteRow:function(e,t){var a=this;this.$confirm("确定要删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){a.editVal.tableData.splice(t,1)})).catch((function(){}))},changeIndicator:function(e){this.editVal.tempVariable=e,this.cancel()},getInstanceIds:function(){return this.editVal.tableData.map((function(e){return e.id})).join(",")},getFilterUrl:function(){var e=this.editVal.filterItems,t="";return e.forEach((function(e,a){e.name&&(t+="".concat(a?", ":"").concat(e.name," ").concat(e.logicExp," ").concat(e.value))})),t},handleInsertId:function(){this.dialogInfo={edit:!1,index:0},this.$refs.selectIndicatorId.dialogVisible=!0},onInstanceIdChange:function(e,t){this.editVal.objectType=e?t.objectType:""},handleSelectorTableBeforeClose:function(){this.$refs.selectorTable&&this.$refs.selectorTable.$refs.filter&&this.$refs.selectorTable.$refs.filter.handleFilterReset()},changeVariable:function(e,t){var a,i="collectTime"===t?this.editVal.variableEditData[t+"Data"]:null,n="static"===(null==i||null===(a=i.editValue)||void 0===a?void 0:a.type)?+new Date(e):e;this.editVal.requestPayload[t]=isNaN(n)?e:n},handleSwitchViewMode:function(e){this.viewMode=e,2===e&&(this.jsonValue=Object(r.b)(this.editVal))},codeEditorBlur:function(e){this.codeValue=e,this.editVal.requestPayload=Object(r.j)(e)},codeEditorJSONBlur:function(e){this.editVal=Object(r.j)(e),this.codeValue=Object(r.b)(this.editVal.requestPayload)},handleSelectorFocus:function(e){this.$refs[e]&&this.$refs[e].onPopoverHide&&this.$refs[e].onPopoverHide()},initData:function(){this.commonInitData("rtdata")},resetData:function(){this.showVal="",this.editVal={accessType:"tempVariable",tempVariable:{}},this.codeValue="{}",this.jsonValue="{}",this.commonResetData()},focusCodeEditor:function(){this.$refs.codeEditor&&this.$refs.codeEditor.setMethod("focus")},handleIconClick:function(){this.open()},open:function(){this.$setAttr(this.data,"editorDialogVisible",!0),this.dialogVisible=!0},close:function(){this.closeTemp("tempVariable")},clear:function(){this.clearByType("tempVariable")},cancel:function(){this.close()},handleCurrentChange:function(e){this.currentRow=e,this.editVal.url=e.id},getShowVal:function(){return Object(r.b)(this.editVal)},clickSure:function(){var e=this;this.$refs.form.validate((function(t){t&&(e.refreshData(),e.commonSureHandler("rtdata"))}))},getHandlerEditVal:function(){var e=Object(r.e)(this.editVal);e.responseSchema||(e.responseSchema={});var t=e.requestPayload;t.queryMode=1,1===e.rtDataType?e.url="/api/realtimedata/multi-snapshot?":e.url="/api/realtimedata/records?";var a=Object.keys(t),i=a.length;return a.forEach((function(a,n){e.url+=n!==i-1?"".concat(a,"=").concat(t[a],"&"):"".concat(a,"=").concat(t[a])})),e.variables=this.getVariables(e),e},getVariables:function(e){var t=this.getVariableNames(e.url),a=this.getVariableNames(e.requestPayload),n=this.getVariableNames(e.responseSchema);return this.formatVariables([].concat(Object(i.a)(t),Object(i.a)(a),Object(i.a)(n)))},validate:function(){return!0}}},u=(a("973a"),Object(l.a)(c,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"temp-variable-link-editor"},[e.showInput?t("el-input",{staticClass:"editor-input",attrs:{placeholder:e.placeholder,value:e.showVal,readonly:"",size:"mini",clearable:""},nativeOn:{click:function(t){return e.handleIconClick.apply(null,arguments)}}},[t("i",{staticClass:"el-input__icon array-editor-icon",class:e.iconClass,attrs:{slot:"suffix"},slot:"suffix"})]):e._e(),t("select-indicator-id",{ref:"selectIndicatorId",attrs:{dialogVisible:e.dialogVisible},on:{change:e.changeIndicator}})],1)}),[],!1,null,null,null));t.default=u.exports},3237:function(e,t,a){"use strict";a("e457")},3380:function(e,t,a){"use strict";a("bc20")},"33a0":function(e,t,a){},"340f":function(e,t,a){},3416:function(e,t,a){"use strict";a("78bc")},"344c":function(e,t,a){"use strict";a("ee40")},3454:function(e,t,a){"use strict";a("b93f")},"351d":function(e,t,a){},"36ad":function(e,t,a){"use strict";a.r(t);var i=(a("8e6e"),a("28a5"),a("7f7f"),a("75fc")),n=(a("4f7f"),a("5df3"),a("1c4c"),a("f559"),a("456d"),a("ac6a"),a("bd86")),r=(a("c5f6"),a("36f0")),o=a("88da"),l=(a("6762"),a("2fdb"),function(){var e=this,t=e._self._c;return t("div",{staticClass:"indicator-table-box"},[t("table",{staticClass:"indicator-table"},[t("thead",{staticClass:"table-thead",style:e.theadStyles},[e._m(0)]),t("tbody",{staticClass:"table-tbody"},[e._l(e.list,(function(a,i){return[t("tr",{key:i,staticClass:"table-tr",style:e.trStyle(a)},[t("td",[t("indicator-selector-tree",{ref:"selectorTree"+i,refInFor:!0,attrs:{fetchOption:e.fetchOption,"root-node":e.rootNode,props:e.indicatorProps,placeholder:"请选择",clearable:!1},on:{"select-change":function(t){return e.handleIndicatorChange(t,i)}},model:{value:a.rowInfo.name,callback:function(t){e.$set(a.rowInfo,"name",t)},expression:"item.rowInfo.name"}})],1),t("td",[t("el-switch",{model:{value:a.isDynamic,callback:function(t){e.$set(a,"isDynamic",t)},expression:"item.isDynamic"}})],1),t("td",[t("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",placeholder:"请选择",disabled:!a.isDynamic},on:{change:function(t){return e.handleSelectedChange(t,a,i)}},model:{value:a.selected,callback:function(t){e.$set(a,"selected",t)},expression:"item.selected"}},e._l(e.dynamicMap[a.id]||[],(function(e){return t("el-option",{key:e.name,attrs:{label:e.display,value:e.name}})})),1)],1),t("td",[t("el-button",{staticClass:"indicator-btn",attrs:{type:"text",disabled:!a.rowInfo.name},on:{click:function(t){return e.handleIndicatorSetting(a,i)}}},[e._v("\n              配置\n            ")]),t("el-button",{staticClass:"indicator-btn",attrs:{type:"text",disabled:e.list.length<=1},on:{click:function(t){return e.handleIndicatorDel(i)}}},[e._v("\n              删除\n            ")]),t("el-button",{staticClass:"indicator-btn indicator-opt",attrs:{icon:e.collapseIcon(a.id),type:"text"},on:{click:function(t){return t.stopPropagation(),function(){return e.handleCollapse(a.id)}.apply(null,arguments)}}})],1)]),t("tr",{key:"".concat(a.id,"_desc"),style:e.trStyle(a)},[t("td",{attrs:{colspan:"4"}},[t("el-collapse",{staticClass:"desc-collapse",attrs:{value:e.desc}},[t("el-collapse-item",{directives:[{name:"theme",rawName:"v-theme",value:e.collapseStyle(a),expression:"collapseStyle(item)"}],attrs:{name:a.id}},[a.selected.length?t("el-form",{ref:"form",refInFor:!0,attrs:{"label-width":"120px",model:a.selected}},e._l(e.dynamicMap[a.id]||[],(function(n){return t("el-form-item",{directives:[{name:"show",rawName:"v-show",value:a.selected.includes(n.name),expression:"item.selected.includes(dynamic.name)"}],key:n.name,attrs:{label:n.display}},[t("variable-editor-components",{staticClass:"filters-item-input",attrs:{compoundItem:"treeselect"===n.type?e.compoundItemTreeselect:e.compoundItem,options:n.options,title:"设置参数值",placeholder:"请设置参数值",data:n.dataValue,disabled:!a.isDynamic},on:{change:function(t){return e.changeVariable(t,n,i)}}})],1)})),1):t("div",{staticClass:"desc-collapse-empty t-text-secondary"},[e._v("暂无动态维度")])],1)],1)],1)])]}))],2)]),e.measIndicatorDefineVisible?t("meas-indicator-define",{attrs:{defaultIndicator:e.currentIndicator,updateStore:""},on:{close:e.onMeasIndicatorDefineClose}}):e._e()],1)}),s=(a("7514"),a("96cf"),a("3b8d")),c=a("967e"),u=a.n(c),d=a("c276"),p=a("2f62");function h(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function f(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?h(Object(a),!0).forEach((function(t){Object(n.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):h(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var m={name:"SelectorAsync",props:{rootNode:{type:Object,default:function(){return{id:"0",label:"/",name:"/"}}},data:{type:Array,default:function(){return[]}},props:{type:Object,default:function(){return{}}},nodeKey:{type:String,default:"id"},multiple:{type:Boolean,default:!1},defaultExpandAll:{type:Boolean,default:!1},expandOnClickNode:{type:Boolean,default:!1},fetchOption:{type:Object,default:function(){return{}}},checkStrictly:{type:Boolean,default:!0},currentNodeKey:{type:String,default:""},defaultCheckedKeys:{type:Array,default:function(){return[]}},defaultExpandedKeys:{type:Array,default:function(){return[]}},checkOnClickNode:{type:Boolean,default:!0},disabled:{type:Function,default:function(){return!1}},showIcon:{type:Boolean,default:!1},colorfulIcon:{type:Boolean,default:!1},highlightCurrent:{type:Boolean,default:!1}},data:function(){return{list:[],searchName:"",expandedKeys:[],currentNode:{},loading:!0,wait:!0,filterData:[],defaultIcon:this.colorfulIcon?"icon-file":"el-icon-document"}},computed:f(f({},Object(p.a)(["themeConstColor"])),{},{treeProps:function(){var e=f({label:"label",children:"",isLeaf:!1},this.props);return delete e.disabled,e},defCheckedKeys:function(){return this.multiple?this.defaultCheckedKeys:[]},isFetch:function(){return this.fetchOption.url},isShow:function(){return!this.isFetch||!this.wait},data$:function(){return[this.rootNode].concat(Object(i.a)(this.isFetch?this.list:this.data))},hasHandlers:function(){return this.props.handler&&this.$util.isObject(this.props.handler)}}),created:function(){var e=this;return Object(s.a)(u.a.mark((function t(){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.isFetch){t.next=5;break}return t.next=3,e.init();case 3:t.next=6;break;case 5:e.filterData=e.data;case 6:e.setDefaultExpandedKeys();case 7:case"end":return t.stop()}}),t)})))()},methods:{getTreeContext:function(){return this.$refs.tree},handleCommand:function(e,t){var a=this.props.handler[e].event;a&&"function"==typeof a&&a(t)},iconClass:function(e){var t=e.data,a="function"==typeof this.disabled&&this.disabled(t);return["t-font-size",{"t-text-placeholder":a,"t-text-secondary":!a}]},classNames:function(e){var t=e.data,a="function"==typeof this.disabled&&this.disabled(t);return["hc-selector-tree-item",{"hc-selector-tree-item-disabled":a,"t-text-placeholder":a}]},setDefaultExpandedKeys:function(){var e=this;if(this.multiple){var t=[];this.defaultExpandedKeys.forEach((function(a){t=[].concat(Object(i.a)(t),Object(i.a)(e.getParentIds(e.defaultExpandedKeys)))})),this.expandedKeys=[this.rootNode.id].concat(Object(i.a)(t))}else this.expandedKeys=[this.rootNode.id].concat(Object(i.a)(this.getParentIds(this.defaultExpandedKeys)))},setAllExpand:function(e){var t=this.$refs.tree.store.nodesMap;Object.keys(t).forEach((function(a){t[a].expanded=e}))},filter:function(e){var t=this;return Object(s.a)(u.a.mark((function a(){var n,r;return u.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(t.searchName=e,t.setAllExpand(!1),e){a.next=8;break}return t.expandedKeys=[t.rootNode.id],t.filterData=t.data$,t.refreshNodeBy(t.rootNode.id),t.setAllExpand(!1),a.abrupt("return");case 8:n=t.data$.filter((function(a){return-1!==a[t.treeProps.label].indexOf(e)})).map((function(e){return e.id})),r=[t.rootNode.id],n.forEach((function(e){r=[].concat(Object(i.a)(r),Object(i.a)(t.getParentIds(e)))})),t.expandedKeys=Object(i.a)(new Set(r)),t.filterData=t.data$.filter((function(e){return[].concat(Object(i.a)(n),Object(i.a)(r)).includes(e.id)})),t.refreshNodeBy(t.rootNode.id);case 14:case"end":return a.stop()}}),a)})))()},refreshNodeBy:function(e){var t=this.$refs.tree.getNode(e);t.loaded=!1,t.expand()},getParentIds:function(e){var t=this,a=[];return function e(i){t.data$.forEach((function(t){t.id===i&&t.parentId&&"0"!==t.parentId&&(a.push(t.parentId),e(t.parentId))}))}(e),a},selectedStyle:function(e){return this.multiple?this.defaultCheckedKeys.includes(e.data.id)?{color:this.themeConstColor.auto}:{}:this.defaultExpandedKeys===e.data.id?{color:this.themeConstColor.auto}:{}},setChecked:function(e,t,a){this.$refs.tree.setChecked(e,t,a)},setCurrentKey:function(e){this.$refs.tree.setCurrentKey(e)},init:function(){var e=this;return Object(s.a)(u.a.mark((function t(){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getData();case 2:case"end":return t.stop()}}),t)})))()},getData:function(){var e=this,t=this.fetchOption,a=t.url,i=t.params,n=void 0===i?{}:i,r=t.method,o=void 0===r?"get":r,l=t.payload,c=void 0===l?{}:l;if(!a)throw new Error("[url]参数缺失");this.handleLoadingChange(!0);var d=this.$util,p=d.payloadHandler;return(0,d.request)({url:(0,p.payloadStringify)(a,f({filters:this.filters},c)),params:n,method:o}).then((function(t){e.list=t||[],e.filterData=e.data$})).catch((function(e){return e})).finally(Object(s.a)(u.a.mark((function t(){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.handleLoadingChange(!1),!e.checkListeners("done")){t.next=6;break}return e.wait=!1,t.next=5,e.$nextTick();case 5:e.$emit("done",e.list);case 6:case"end":return t.stop()}}),t)}))))},loadNode:function(e,t){var a=this,i=e.level,n=e.data;if(0===i)return t([f(f({},this.rootNode),{},{disabled:"function"==typeof this.disabled&&this.disabled(this.rootNode)})]);t(this.getChildren(n.id).map((function(e){return f(f({},e),{},{disabled:"function"==typeof a.disabled&&a.disabled(e)})})))},getChildren:function(e){return this.filterData.filter((function(t){return t.parentId===e}))},getIconClass:function(e){return this.props.icon&&"function"==typeof this.props.icon?this.props.icon(e):this.defaultIcon},getItemLabel:function(e,t){var a=this.searchName;switch(t){case"prepend":return e.label.substring(0,e.label.indexOf(a));case"search":return e.label.substring(e.label.indexOf(a),e.label.indexOf(a)+a.length);case"append":return e.label.substring(e.label.indexOf(a)+a.length,e.label.length);default:return e.label}},handleCheckedChange:function(e,t){this.checkListeners("checked-change")&&this.$emit("checked-change",e,t)},handleTreeNodeClick:function(){this.checkListeners("node-click")&&this.$emit.apply(this,["node-click"].concat(Array.prototype.slice.call(arguments)))},handleCurrentChange:function(e){this.multiple||("function"==typeof this.disabled&&this.disabled(e)||this.checkListeners("current-change")&&this.$emit("current-change",e))},handleLoadingChange:function(e){this.loading=!!e},checkListeners:function(e){return this.$listeners.hasOwnProperty(e)&&"function"==typeof this.$listeners[e]}}},v=(a("fb42"),a("f85b"),a("2877"));function b(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function g(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?b(Object(a),!0).forEach((function(t){Object(n.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):b(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var y={name:"IndicatorSelectorTree",components:{IndicatorSelectorAsync:Object(v.a)(m,(function(){var e=this,t=e._self._c;return e.isShow?t("el-tree",{ref:"tree",staticClass:"hc-selector-tree-content",attrs:{load:e.loadNode,lazy:!0,props:e.treeProps,"node-key":e.nodeKey,"show-checkbox":e.multiple,"current-node-key":e.currentNodeKey,"default-expanded-keys":e.expandedKeys,draggable:!1,"expand-on-click-node":e.expandOnClickNode,"check-strictly":e.checkStrictly,"default-checked-keys":e.defCheckedKeys,"check-on-click-node":e.checkOnClickNode,"highlight-current":e.highlightCurrent,"default-expand-all":e.defaultExpandAll},on:{"current-change":e.handleCurrentChange,"check-change":e.handleCheckedChange,"node-click":e.handleTreeNodeClick},scopedSlots:e._u([{key:"default",fn:function(a){var i=a.node;return t("div",{class:e.classNames(i),style:e.selectedStyle(i),attrs:{title:i.label}},[e.showIcon?t("iconfont",{class:e.iconClass(i),attrs:{right:5,colorful:e.colorfulIcon,type:e.getIconClass(i)}}):e._e(),i.label.indexOf(e.searchName)>-1?t("div",{staticClass:"hc-selector-tree-item"},[t("span",[e._v(e._s(e.getItemLabel(i,"prepend")))]),t("span",{staticClass:"hc-selector-tree-item-search"},[e._v(e._s(e.getItemLabel(i,"search")))]),t("span",[e._v(e._s(e.getItemLabel(i,"append")))])]):t("div",{staticClass:"hc-selector-tree-item"},[e._v(e._s(i.label))]),e.hasHandlers?t("div",{staticClass:"hc-selector-tree-handle"},["grid"===e.props.handler.showType?t("div",{staticClass:"hc-selector-tree-handle-grid"},[e._l(Object.keys(e.props.handler),(function(a){return[e.props.handler[a].icon?t("iconfont",{key:a,attrs:{title:e.props.handler[a].label,type:e.props.handler[a].icon},on:{click:function(t){return t.stopPropagation(),e.handleCommand(a,i.data)}}}):e._e(),"showType"===a||e.props.handler[a].icon?e._e():t("el-link",{key:a,attrs:{title:e.props.handler[a].label,type:"primary"},on:{click:function(t){return t.stopPropagation(),e.handleCommand(a,i.data)}}},[e._v(e._s(e.props.handler[a].label))])]}))],2):t("el-dropdown",{on:{command:function(t){return e.handleCommand(t,i.data)}}},[t("span",{staticClass:"el-dropdown-link"},[t("i",{staticClass:"el-icon-more"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e._l(Object.keys(e.props.handler),(function(a){return["showType"!==a?t("el-dropdown-item",{key:a,attrs:{command:a}},[e._v("\n              "+e._s(e.props.handler[a].label)+"\n            ")]):e._e()]}))],2)],1)],1):e._e()],1)}}],null,!1,3565720872)}):e._e()}),[],!1,null,"6fe0e48d",null).exports},model:{prop:"value",event:"change"},props:{value:{type:[String,Array],default:void 0},placeholder:{type:String,default:"请选择"},collapseTags:{type:Boolean,default:!1},showRoot:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},props:{type:Object,default:function(){return{}}},checkStrictly:{type:Boolean,default:!0},nodeKey:{type:String,default:"id"},rootNode:{type:Object,default:function(){return{id:"0",label:"/",name:"/"}}},expandOnClickNode:{type:Boolean,default:!1},fetchOption:{type:Object,default:function(){return{}}},disabled:{type:Function,default:function(){return!1}},showIcon:{type:Boolean,default:!1},colorfulIcon:{type:Boolean,default:!1},multiple:{type:Boolean,default:!1},parsePath:{type:Boolean,default:!1},showPrevRootPath:{type:Boolean,default:!1}},data:function(){return{defaultProps:{children:"children",label:"name"},tableData:[],selectedTreeId:"-1",popperVisible:!1,popperWidth:200,selectContent:{},popperContent:{},selectData:[],loading:!1,filters:[],list:[],wait:!0,searchName:"",handleClose:null,uid:null}},created:function(){this.uid=this.$util.uuid(),this.init(),this.getSelectWidth(),this.refreshTable()},mounted:function(){var e=this;return Object(s.a)(u.a.mark((function t(){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$nextTick();case 2:e.handleClose||(e.handleClose=e.$refs.selectContent.handleClose);case 3:case"end":return t.stop()}}),t)})))()},computed:{treeProps:function(){var e=g({value:this.nodeKey,label:"name",children:"",isLeaf:!1},this.props);return delete e.disabled,e},menuTree:function(){var e=[];return this.listToTree(this.list,e,this.rootNode.id),[g(g({},this.rootNode),{},{children:e})]}},methods:{handleTreeNodeClick:function(e){var t;this.selectedTreeId=(null===(t=e.value)||void 0===t?void 0:t.id)||e.id,this.refreshTable()},refreshTable:function(){var e=this,t="/api/model/instances?objectType=MEAS_INDICATOR&parentId=".concat(this.selectedTreeId,"&queryMode=simple&pagination=0&$orderBy=createTime desc");return this.$util.request({url:t}).then((function(t){e.tableData=t}))},handleTreeChange:function(){this.refreshTable()},listToPath:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=[],i="id",n="name",r="/",o=function o(l,s,c){return l.forEach((function(l){var u={};[t].includes(l[i])||(u[i]=l[i],u[n]=void 0===s&&void 0===c?l[n]:"".concat(e.showPrevRootPath||c!==(e.rootNode.name||e.rootNode.label)?c:"").concat(r).concat(l[n]),a.push(g(g({},l),u)),l.children&&o(l.children,u[i],u[n]))})),a};return o(this.menuTree)},listToTree:function(e,t,a){var i=this;e.forEach((function(n){if(n.parentId===a){var r=g(g({},n),{},{label:n.key||n.name,children:[]});i.listToTree(e,r.children,n.id),r.children.length<=0&&delete r.children,t.push(r)}}))},onSelectFocus:function(e){this.checkListeners("focus")&&this.$emit("focus",e)},onPopoverShow:function(){this.selectContent.handleClose=this.selectContent.handleFocus},onPopoverHide:function(){this.handleClose&&(this.selectContent.handleClose=this.handleClose,this.selectContent.handleClose())},init:function(){var e=this;return Object(s.a)(u.a.mark((function t(){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getData();case 2:e.wait=!1;case 3:case"end":return t.stop()}}),t)})))()},checkListeners:function(e){return this.$listeners.hasOwnProperty(e)&&"function"==typeof this.$listeners[e]},getData:function(){var e=this,t=this.fetchOption,a=t.url,n=t.params,r=void 0===n?{}:n,o=t.method,l=void 0===o?"get":o,s=t.payload,c=void 0===s?{}:s,u=t.meta,d=void 0===u?{}:u;if(!a)throw new Error("[url]参数缺失");this.handleLoadingChange(!0);var p=this.$util.payloadHandler.payloadStringify;return this.$util.request({url:p(a,g({filters:this.filters},c)),params:r,method:l,meta:d}).then((function(t){e.list=[e.rootNode].concat(Object(i.a)(t||[]));var a=e.list.filter((function(t){return e.multiple?(e.value||[]).includes(t[e.treeProps.value]):e.value===t[e.treeProps.value]}));e.setSelectData(a)})).catch((function(e){return e})).finally((function(){e.handleLoadingChange(!1),e.checkListeners("done")&&e.$emit("done",e.list)}))},setSelectData:function(e){var t=this;if(this.parsePath){var a=e.map((function(e){return e[t.treeProps.value]}));this.selectData=(this.listToPath()||[]).filter((function(e){return a.includes(e[t.treeProps.value])}))}else this.selectData=e},handleLoadingChange:function(e){this.loading=!!e},handleCurrentChange:function(e){this.setSelectData([e]),this.onValueChange(e[this.treeProps.value]),this.$emit("select-change",e),this.doClose()},handleCheckedChange:function(e,t){var a=this;t?this.setSelectData([].concat(Object(i.a)(this.selectData),[e])):this.setSelectData(this.selectData.filter((function(t){return t[a.treeProps.value]!==e[a.treeProps.value]}))),this.onValueChange(Object(i.a)(new Set(this.selectData.map((function(e){return e[a.treeProps.value]})))))},onTagRemove:function(e){var t=this;this.setSelectData(this.selectData.filter((function(a){return a[t.treeProps.value]!==e}))),this.onValueChange(this.selectData.map((function(e){return e[t.treeProps.value]}))),this.$refs.popperTree&&this.$refs.popperTree.setChecked(e,!1)},onValueClear:function(){this.onValueChange(void 0),this.$emit("clear")},doClose:function(){(this.popperContent.showPopper||this.popperVisible)&&(this.popperContent.showPopper=!1)},handleSelectFilter:function(e){return this.$refs.popperTree&&this.$refs.popperTree.filter(e),!1},onValueChange:function(e){this.$emit("change",e)},handleVisibleChange:function(e){var t=this;setTimeout((function(){t.popperVisible=e,e||(t.handleSelectFilter(""),t.doClose())}),e?0:200)},getSelectWidth:function(){var e=this;return Object(s.a)(u.a.mark((function t(){var a,i,n,r;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$nextTick();case 2:a=e.$refs.selectContent,i=e.$refs.popperContent,e.selectContent=a,e.popperContent=i,n=a.$vnode||{},r=n.elm,e.popperWidth=r.offsetWidth;case 8:case"end":return t.stop()}}),t)})))()}}};function _(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function C(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?_(Object(a),!0).forEach((function(t){Object(n.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):_(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var O={name:"IndicatorTable",components:{IndicatorSelectorTree:(a("f14d"),Object(v.a)(y,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"hc-basic-tree-select"},[t("el-popover",{directives:[{name:"theme",rawName:"v-theme",value:{target:".el-tag",style:{maxWidth:"".concat(e.popperWidth-10,"px")}},expression:"{ target: '.el-tag', style: { maxWidth: `${ popperWidth - 10 }px` } }"}],ref:"popperContent",attrs:{placement:"bottom-start",width:"486px",trigger:"click","popper-class":"indicator-popover"},on:{show:e.onPopoverShow,hide:e.onPopoverHide}},[t("el-select",{ref:"selectContent",staticClass:"hc-basic-tree-select-content",attrs:{slot:"reference","popper-class":"hc-basic-tree-select-popper",filterable:"",multiple:e.multiple,clearable:e.clearable,placeholder:e.placeholder,"collapse-tags":e.collapseTags,"filter-method":e.handleSelectFilter,"check-strictly":e.checkStrictly},on:{focus:e.onSelectFocus,"visible-change":e.handleVisibleChange,"remove-tag":e.onTagRemove,clear:e.onValueClear},slot:"reference",model:{value:e.value,callback:function(t){e.value=t},expression:"value"}},e._l(e.selectData,(function(a){return t("el-option",{key:a[e.treeProps.value],attrs:{label:a[e.treeProps.label],value:a[e.treeProps.value]}})})),1),t("div",{staticClass:"indicator-popover-content"},[!e.wait&&e.popperVisible?t("indicator-selector-async",{ref:"popperTree",staticClass:"indicator-tree",attrs:{data:e.list,props:e.treeProps,nodeKey:e.nodeKey,multiple:e.multiple,rootNode:e.rootNode,defaultExpandedKeys:e.value,expandOnClickNode:e.expandOnClickNode,"default-checked-keys":e.value,checkOnClickNode:e.multiple,"show-icon":e.showIcon,"colorful-icon":e.colorfulIcon},on:{"checked-change":e.handleCheckedChange,"node-click":e.handleTreeNodeClick}}):e._e(),t("el-tree",{staticClass:"indicator-list",attrs:{data:e.tableData,props:e.defaultProps},on:{"current-change":e.handleCurrentChange}})],1)],1)],1)}),[],!1,null,null,null)).exports,MeasIndicatorDefine:a("4702").a},props:{list:{type:Array,default:function(){return[]}}},data:function(){return{desc:[],options:[],indicatorProps:{label:"name",children:"children"},rules:[],extraObjectTypes:[],dynamicMap:{},rootNode:{id:"-1",label:"/",name:"/"},compoundItem:[{label:"变量选择",value:"variable",formItem:"variable-Panel"},{label:"手动输入",value:"static",formItem:"select"}],compoundItemTreeselect:[{label:"变量选择",value:"variable",formItem:"variable-Panel"},{label:"手动输入",value:"static",formItem:"treeselect"}],measIndicatorDefineVisible:!1,currentIndicator:{}}},computed:C(C({},Object(p.a)(["measureOptions","themeConstColor"])),{},{theadStyles:function(){return{"background-color":Object(d.nb)("middleBackgroundColor")}},fetchOption:function(){var e=this.extraObjectTypes.filter((function(e){return e.checked})).map((function(e){return e.name})).join(",");return{url:"/api/model/instances",params:{objectType:"HR_COMPANY,HR_DEPARTMENT,SYS_ASSET,SYS_EQUIPMENT".concat(e?",".concat(e):""),queryMode:"simple",pagination:0,lazyLoad:0,$orderBy:"createTime desc"}}}}),created:function(){this.initDynamicMap()},methods:{collapseStyle:function(e){return{target:".el-collapse-item__wrap",style:this.trStyle(e)}},trStyle:function(e){var t=e.id;return{backgroundColor:this.desc.includes(t)?this.themeConstColor.headerColor:"",transition:"all .3s"}},handleSelectedChange:function(e,t,a){var i=t.id;this.list[a].selected=e,this.handleCollapse(null==t?void 0:t.id,!0),e.length?this.desc.includes(i)||this.desc.push(i):this.desc.includes(i)&&(this.desc=this.desc.filter((function(e){return e!==i})))},updateListItem:function(e){var t=this;this.list.forEach((function(a,i){var n;if((null==a||null===(n=a.rowInfo)||void 0===n?void 0:n.id)===(null==e?void 0:e.id)){var r=Object.assign(a.rowInfo,e);Object.keys(r||{}).forEach((function(e){!e.startsWith("expands.")||"COM_NULL"!==r[e]&&r[e]||delete r[e]})),t.handleIndicatorChange(r,i)}}))},onMeasIndicatorDefineClose:function(e,t){var a=this;return Object(s.a)(u.a.mark((function i(){var n,r;return u.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(a.measIndicatorDefineVisible=!1,!e){i.next=8;break}if(!(n=a.$refs["selectorTree"+a.currentIndicatorIndex])){i.next=8;break}return r=n[0]||n,i.next=7,r.refreshTable();case 7:t&&a.updateListItem(t);case 8:case"end":return i.stop()}}),i)})))()},handleIndicatorSetting:function(e,t){this.currentIndicator=e.rowInfo,this.currentIndicatorIndex=t,this.measIndicatorDefineVisible=!0},initDynamicMap:function(){var e=this;this.list.forEach((function(t){var a=e.changeIndicator(t.rowInfo);e.$set(e.dynamicMap,null==t?void 0:t.id,a)}))},handleIndicatorDel:function(e){var t=this;this.$confirm("确定要删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){1===t.list.length?t.list.splice(e,1,{id:t.$util.uuid(),rowInfo:{},isDynamic:!1,selected:[]}):t.list.splice(e,1),t.$emit("indicatorChange")})).catch((function(){}))},handleDynamicDel:function(){},changeVariable:function(e,t,a){this.list[a].rowInfo[t.name]=e},getEditValue:function(e){var t,a=/\$\{(.*?)\}/g.exec(e);return(null==a?void 0:a[0])===e?{static:"",type:"variable",variable:null===(t=a[1])||void 0===t?void 0:t.split(".")}:{static:e,type:"static",variable:[]}},changeIndicator:function(e){var t=this,a=[],i=function(i){var n={};if(i.includes(".")){var r=t.measureOptions.measureIndicatorExpandsDicts.find((function(e){return e.displayName===i}));r&&(n={name:i,display:r.dictKeyName,options:r.options.map((function(e){return{label:e.name,value:e.value}})),type:"select",selected:!1,paramType:"dynamic",value:e[i],dataValue:{editValue:t.getEditValue(e[i])}},a.push(n))}};for(var n in e)i(n);return a},indicatorChange:function(){this.$emit("indicatorChange")},handleIndicatorChange:function(e,t){var a;this.list[t].rowInfo=e;var i=this.changeIndicator(null!=e?e:{});this.$set(this.dynamicMap,null===(a=this.list[t])||void 0===a?void 0:a.id,i),this.list[t].selected=[],this.$emit("indicatorChange")},collapseIcon:function(e){return this.desc.includes(e)?"el-icon-arrow-up":"el-icon-arrow-down"},handleCollapse:function(e,t){if(this.desc.includes(e)){if(t)return;this.desc=this.desc.filter((function(t){return t!==e}))}else this.desc.push(e)}}},T=(a("2945"),a("a80d"),Object(v.a)(O,l,[function(){var e=this,t=e._self._c;return t("tr",[t("th",{attrs:{width:"30%"}},[e._v("指标")]),t("th",{attrs:{width:"10%"}},[e._v("动态指标")]),t("th",[e._v("动态维度")]),t("th",{attrs:{width:"18%"}},[e._v("操作")])])}],!1,null,"52bc7342",null)).exports,V=a("65d4"),w=a("0338"),P=a("b19c");function x(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function S(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?x(Object(a),!0).forEach((function(t){Object(n.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):x(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var j={name:"IndicatorLinkEditor",components:{controlCommonAlert:a("ae83").a,FilterSetting:w.a,ParamSetting:V.a,IndicatorTable:T,EditorCollapse:o.a},alias:"指标数据",command:"indicator-link",mixins:[r.a],props:{visible:{type:String,default:function(){return!1}},showInput:{type:String,default:function(){return!0}},iconClass:{type:String,default:function(){return"el-icon-edit"}},data:{type:Object,default:function(){return{alias:"",type:"",default:"",value:"",primitiveLabels:""}}},placeholder:{type:String,default:""},autoSetValue:{type:Boolean,default:!0},linkType:{type:Number,default:function(){return 1}},handleRulesResult:{type:Function,default:function(){}},handleChangeResult:{type:Function,default:function(){}}},data:function(){return{baseUrl:"/api/indicator/values/aggregation",dialogVisible:this.visible,showVal:"",showCloseTips:JSON.parse(localStorage.getItem("link-tips-indicator")),tableData:[],responseFields:[],editVal:{accessType:"indicator",linkType:this.linkType,url:"/api/indicator/values/aggregation",method:"post",contentType:"application/json",fields:"",dataType:"",requestPayload:{indicatorIds:"",queryLatest:1,timeRangeType:"fixed",queryType:"",updateTimeBegin:"",updateTimeEnd:"",relativeTime:"",dimensionTime:"",aggOperation:"",sortOperation:"",cmpOperation:"",precision:"",filters:"",subFilter:"",valueFilter:"",parentIdFlag:!1,itemFlag:!1},variableEditData:{indicatorIdsData:{name:"indicatorIds",value:"",editValue:null},updateTimeBeginData:{name:"updateTimeBegin",value:"",editValue:null},updateTimeEndData:{name:"updateTimeEnd",value:"",editValue:null},dimensionTimeData:{name:"dimensionTime",value:"",editValue:null},compareTimeData:{name:" compareTime",value:"",editValue:null},parentIdData:{name:" parentId",value:"",editValue:null},timeDimensionData:{name:" timeDimension",value:"",editValue:null},projectData:{name:"project",value:"",editValue:null},valueData:{name:"value",value:"",editValue:null}},assistAttr:{relativeType:"current",relativeNumber:1,timeDimension:"",orderNumber:1,orderType:"asc",compareType:"M2M",compareNumber:1,isNow:!1,compareTime:"",tableData:[{id:this.$util.uuid(),rowInfo:{},isDynamic:!1,selected:[]}],extraFilter:"",subFilter:"",timeDimensionFilter:"",parentIdFilter:"",projectFilter:"",dimensionTimeFilter:"",valueFilterOperator:"",valueFilter:""},responseSchema:{},exceptionStrategy:"throw"}}},computed:S(S({},Object(p.a)(["measureOptionsLoaded","getLinkTipsOf"])),{},{measureIndicatorExpandsDictsLoaded:function(){return this.measureOptionsLoaded.measureIndicatorExpandsDicts},indicatorTipsLoaded:function(){return this.getLinkTipsOf("indicator-link")},hiddenConfig:function(){return{pagination:!0}}}),watch:{"data.value":function(){this.initData()},visible:function(e){this.dialogVisible=e,e&&this.initData()},showCloseTips:function(e){localStorage.setItem("link-tips-indicator",e)}},created:function(){this.initData(),this.onIndicatorChange()},methods:{clearValidate:function(e){null!=e&&e.length?this.$refs.form.clearValidate(e):this.$refs.form.clearValidate()},onIndicatorChange:function(){var e,t,a=(null===(e=this.editVal)||void 0===e||null===(t=e.assistAttr)||void 0===t?void 0:t.tableData)||[],i=[];a.forEach((function(e){Object.keys((null==e?void 0:e.rowInfo)||{}).forEach((function(e){e.startsWith("expands.")||i.push(e)}))}));var n=i.length?["value"].concat(i):i;this.responseFields=Array.from(new Set(n))},handleIndicatorClick:function(){this.open()},open:function(){this.$setAttr(this.data,"editorDialogVisible",!0),this.dialogVisible=!0},handleClear:function(){this.clearByType("indicator")},resetData:function(){this.showVal="",this.editVal={accessType:"indicator",linkType:this.linkType,url:"/api/indicator/values/aggregation",method:"post",contentType:"application/json",requestPayload:{indicatorIds:"",queryLatest:1,timeRangeType:"fixed",queryType:"",updateTimeBegin:"",updateTimeEnd:"",relativeTime:"",dimensionTime:"",aggOperation:"",sortOperation:"",cmpOperation:"",precision:"",filters:"",subFilter:"",valueFilter:"",parentIdFlag:!1,itemFlag:!1},variableEditData:{indicatorIdsData:{name:"indicatorIds",value:"",editValue:null},updateTimeBeginData:{name:"updateTimeBegin",value:"",editValue:null},updateTimeEndData:{name:"updateTimeEnd",value:"",editValue:null},dimensionTimeData:{name:"dimensionTime",value:"",editValue:null},compareTimeData:{name:" compareTime",value:"",editValue:null},parentIdData:{name:" parentId",value:"",editValue:null},timeDimensionData:{name:" timeDimension",value:"",editValue:null},projectData:{name:"project",value:"",editValue:null},valueData:{name:"value",value:"",editValue:null}},assistAttr:{relativeType:"current",relativeNumber:1,timeDimension:"",orderNumber:1,orderType:"asc",compareType:"M2M",compareNumber:1,isNow:!1,compareTime:"",tableData:[],timeDimensionFilter:"",parentIdFilter:"",projectFilter:"",dimensionTimeFilter:"",valueFilterOperator:"",valueFilter:""},responseSchema:{},exceptionStrategy:"throw"},this.commonResetData()},handleIndicatorAdd:function(){this.editVal.assistAttr.tableData.push({id:this.$util.uuid(),rowInfo:{},isDynamic:!1,selected:[]})},handleSubmit:function(){var e=this;if(this.syncTableToProps(),this.refreshEditValPayload(),this.additionalFilter(),this.staticParamFilter(),this.cleanData(),this.editVal.requestPayload.updateTimeEnd&&this.editVal.requestPayload.updateTimeBegin){var t=this.getTimeStamp(this.editVal.requestPayload.updateTimeEnd),a=this.getTimeStamp(this.editVal.requestPayload.updateTimeBegin);if("number"==typeof t&&"number"==typeof a&&!window.isNaN(t)&&!window.isNaN(a)&&a>t)return void this.$message({type:"error",message:"开始时间需要早于结束时间"})}(this.editVal.assistAttr.tableData||[]).some((function(e){var t;return null==e||null===(t=e.rowInfo)||void 0===t?void 0:t.id}))?this.editVal.requestPayload.queryType?this.$refs.form.validate((function(t){t&&e.commonSureHandler("indicator")})):this.$message({type:"error",message:"请设置“查询配置”"}):this.$message({type:"error",message:"请设置“指标配置”"})},getTimeStamp:function(e){return new Date(e).valueOf()},validate:function(){return!0},getHandlerEditVal:function(){var e=Object(P.e)(this.editVal);return e.responseSchema||(e.responseSchema={}),e.url=this.baseUrl,e.responseSchema||(e.responseSchema={}),e.requestPayload||(e.requestPayload={}),e.variables=this.getVariables(e),e},getVariables:function(e){var t=this.getVariableNames(e.url),a=this.getVariableNames(e.requestPayload),n=this.getVariableNames(e.responseSchema);return this.formatVariables([].concat(Object(i.a)(t),Object(i.a)(a),Object(i.a)(n)))},syncTableToProps:function(){var e=this.tableData||[],t=[],a=[],i={};for(var n in e.forEach((function(e){e.isDynamic?((null==e?void 0:e.selected)||[]).forEach((function(t){i[t]?i[t].push(e.rowInfo[t]):i[t]=[e.rowInfo[t]]})):t.push(e.rowInfo.id)})),i){var r=i[n].join("::");a.push("".concat(n," eq ").concat(r))}var o=t.join(","),l=a.length?"$filter="+a.join(","):"";this.editVal.requestPayload.indicatorIds=o,this.editVal.requestPayload.filters=l,this.editVal.assistAttr.tableData=this.tableData},refreshEditValPayload:function(){var e,t;"current"===this.editVal.assistAttr.relativeType&&(this.editVal.assistAttr.relativeNumber=1);var a=this.editVal.assistAttr,i=a.relativeType,n=a.relativeNumber,r=a.timeDimension,o=a.orderNumber,l=a.orderType,s=a.compareType,c=a.compareNumber,u=a.isNow,d=a.compareTime,p=a.dimensionTimeFilter,h=i?"".concat(i,":").concat(n,":").concat(r):"";this.editVal.requestPayload.relativeTime=h;var f=o?"".concat(o,":").concat(l):"";this.editVal.requestPayload.sortOperation=f;var m=u?"now":d,v=s?"".concat(s,":").concat(c,":").concat(m):"";this.editVal.requestPayload.cmpOperation=v;var b=this.editVal.variableEditData,g=b.updateTimeBeginData,y=b.updateTimeEndData;this.editVal.requestPayload.dimensionTime=p,this.editVal.requestPayload.updateTimeBegin=null!==(e=g.value)&&void 0!==e?e:"",this.editVal.requestPayload.updateTimeEnd=null!==(t=y.value)&&void 0!==t?t:""},additionalFilter:function(){var e=this.editVal.assistAttr,t=e.extraFilter,a=e.subFilter;this.editVal.requestPayload.subFilter=a||"",t&&(this.editVal.requestPayload.filters?this.editVal.requestPayload.filters=this.editVal.requestPayload.filters+","+t:this.editVal.requestPayload.filters="$filter=".concat(t))},staticParamFilter:function(){var e=this,t=this.editVal.assistAttr;[{name:"parentId",value:t.parentIdFilter},{name:"timeDimension",value:t.timeDimensionFilter},{name:"indicatorItemId",value:t.projectFilter}].forEach((function(t){t&&null!=t&&t.value&&(e.editVal.requestPayload.filters?e.editVal.requestPayload.filters=e.editVal.requestPayload.filters+","+"".concat(t.name," eq ").concat(t.value):e.editVal.requestPayload.filters="$filter=".concat(t.name," eq ").concat(t.value))}))},cleanData:function(){var e=this.editVal.requestPayload,t=e.queryType,a=e.timeRangeType;switch(t){case"1":this.editVal.requestPayload.aggOperation="",this.editVal.requestPayload.sortOperation="",this.editVal.requestPayload.cmpOperation="",this.editVal.requestPayload.updateTimeBegin="",this.editVal.requestPayload.updateTimeEnd="","fixed"===a?this.editVal.requestPayload.relativeTime="":"relative"===a&&(this.editVal.requestPayload.dimensionTime="");break;case"2":this.editVal.requestPayload.aggOperation="",this.editVal.requestPayload.sortOperation="",this.editVal.requestPayload.cmpOperation="",this.editVal.requestPayload.dimensionTime="","fixed"===a?this.editVal.requestPayload.relativeTime="":"relative"===a&&(this.editVal.requestPayload.updateTimeBegin="",this.editVal.requestPayload.updateTimeEnd="");break;case"3":this.editVal.requestPayload.sortOperation="",this.editVal.requestPayload.cmpOperation="",this.editVal.requestPayload.dimensionTime="","fixed"===a?this.editVal.requestPayload.relativeTime="":"relative"===a&&(this.editVal.requestPayload.updateTimeBegin="",this.editVal.requestPayload.updateTimeEnd="");break;case"4":this.editVal.requestPayload.aggOperation="",this.editVal.requestPayload.cmpOperation="",this.editVal.requestPayload.dimensionTime="","fixed"===a?this.editVal.requestPayload.relativeTime="":"relative"===a&&(this.editVal.requestPayload.updateTimeBegin="",this.editVal.requestPayload.updateTimeEnd="");break;case"5":this.editVal.requestPayload.aggOperation="",this.editVal.requestPayload.sortOperation="",this.editVal.requestPayload.dimensionTime="",this.editVal.requestPayload.updateTimeBegin="",this.editVal.requestPayload.updateTimeEnd=""}},initData:function(){this.$store.dispatch("initMeasDicts"),this.commonInitData("indicator"),this.initTips(),this.syncPropsToData(),this.syncPropsToFilter()},initTips:function(){this.$store.dispatch("setLinkEditorTips","indicator")},syncPropsToFilter:function(){this.editVal.assistAttr.dimensionTimeFilter&&(this.editVal.variableEditData.dimensionTimeData={editValue:this.getEditValue(this.editVal.assistAttr.dimensionTimeFilter)}),this.editVal.assistAttr.timeDimensionFilter&&(this.editVal.variableEditData.timeDimensionData={editValue:this.getEditValue(this.editVal.assistAttr.timeDimensionFilter)}),this.editVal.assistAttr.parentIdFilter&&(this.editVal.variableEditData.parentIdData={editValue:this.getEditValue(this.editVal.assistAttr.parentIdFilter)}),this.editVal.assistAttr.projectFilter&&(this.editVal.variableEditData.projectData={editValue:this.getEditValue(this.editVal.assistAttr.projectFilter)}),this.editVal.assistAttr.valueFilter&&(this.editVal.variableEditData.valueData={editValue:this.getEditValue(this.editVal.assistAttr.valueFilter)}),this.editVal.assistAttr.compareTime&&(this.editVal.variableEditData.compareTimeData={editValue:this.getEditValue(this.editVal.assistAttr.compareTime)})},getEditValue:function(e){var t,a=/\$\{(.*?)\}/g.exec(e);return(null==a?void 0:a[0])===e?{static:"",type:"variable",variable:null===(t=a[1])||void 0===t?void 0:t.split(".")}:{static:e,type:"static",variable:[]}},syncPropsToData:function(){this.tableData=this.editVal.assistAttr.tableData},onClose:function(){this.closeHandler("indicator")},getShowVal:function(){return Object(P.b)(this.editVal)}}},E=(a("48d2"),a("6375"),Object(v.a)(j,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"indicator-link-editor"},[t("el-input",{staticClass:"editor-input",attrs:{value:e.showVal,readonly:"",size:"mini",clearable:""},nativeOn:{click:function(t){return e.handleIndicatorClick.apply(null,arguments)}}}),t("el-drawer",{attrs:{"custom-class":"editor-drawer indicator-link-editor-drawer",size:"1000px",visible:e.dialogVisible,direction:"rtl",wrapperClosable:!1,"append-to-body":!0,"show-close":!1},on:{"update:visible":function(t){e.dialogVisible=t},close:e.onClose}},[t("div",{staticClass:"editor-drawer-title",attrs:{slot:"title"},slot:"title"},[t("div",{staticClass:"title-text"},[t("iconfont",{attrs:{type:"icon-close"},on:{click:e.onClose}}),e._v("\n        指标关联配置\n        "),t("a",{directives:[{name:"show",rawName:"v-show",value:e.indicatorTipsLoaded&&e.indicatorTipsLoaded.description,expression:"indicatorTipsLoaded && indicatorTipsLoaded.description"}],attrs:{href:e.indicatorTipsLoaded&&e.indicatorTipsLoaded.description,target:"_blank"}},[t("i",{staticClass:"el-icon-question"})])],1),t("div",{staticClass:"title-btn"},[t("el-button",{attrs:{size:"small"},on:{click:e.handleClear}},[e._v("\n          清空\n        ")]),t("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.handleSubmit}},[e._v("\n          提交\n        ")])],1)]),t("control-common-alert",{staticClass:"indicator-link-alert",attrs:{show:!e.showCloseTips},on:{showCloseTips:function(t){e.showCloseTips=!0}}},[t("div",{domProps:{innerHTML:e._s(e.indicatorTipsLoaded&&e.indicatorTipsLoaded.value)}})]),t("el-form",{ref:"form",attrs:{"label-width":"150px",model:e.editVal}},[t("editor-collapse",{staticClass:"link-editor-collapse",attrs:{title:"指标配置"}},[e.measureIndicatorExpandsDictsLoaded?t("indicator-table",{attrs:{list:e.editVal.assistAttr.tableData||[]},on:{indicatorChange:e.onIndicatorChange}}):e._e(),t("div",{staticClass:"link-editor-plus"},[t("el-button",{attrs:{size:"small",plain:"",icon:"el-icon-plus"},on:{click:e.handleIndicatorAdd}},[e._v("\n            添加指标项\n          ")])],1)],1),t("editor-collapse",{staticClass:"link-editor-collapse",attrs:{title:"查询配置"}},[t("param-setting",{attrs:{editVal:e.editVal},on:{clearValidate:e.clearValidate}})],1),t("editor-collapse",{staticClass:"link-editor-collapse",attrs:{title:"筛选项"}},[t("filter-setting",{attrs:{editVal:e.editVal}})],1),t("editor-collapse",{staticClass:"link-editor-collapse",attrs:{title:"其它"}},[e.responseFields.length?t("el-form-item",{staticClass:"link-editor-response-fields",attrs:{label:"响应数据提示"}},[t("div",{staticClass:"t-text-secondary"},[e._v("响应数据字段可使用函数过滤，例timeFormat(updateTime::year::1)，字段列表如下：")]),e._l(e.responseFields,(function(a){return t("el-tag",{key:a,attrs:{effect:"plain"}},[e._v(e._s(a))])}))],2):e._e(),t("common-link-set",{attrs:{config:e.commonLinkSet,data:e.data,defaultLoad:e.defaultLoad,hiddenConfig:e.hiddenConfig}})],1)],1)],1)],1)}),[],!1,null,"612605a4",null));t.default=E.exports},"36f0":function(e,t,a){"use strict";a("8e6e"),a("456d"),a("f559"),a("28a5"),a("6762"),a("20d6"),a("a481"),a("ac6a"),a("4f7f"),a("5df3"),a("1c4c");var i=a("75fc"),n=(a("4917"),a("bd86")),r=(a("7f7f"),a("b19c")),o={name:"ResponseSchema",data:function(){return{}},props:{visible:{type:Boolean,default:!0},value:{type:String,default:""}},methods:{blur:function(e){this.$emit("blur",e)}}},l=a("2877"),s=Object(l.a)(o,(function(){return this._self._c,this._e()}),[],!1,null,"3f7304f7",null).exports,c={name:"ExceptionStrategy",model:{prop:"value",event:"change"},data:function(){return{exceptionStrategyTypes:[{value:"throw"},{value:"adapt"}]}},props:{value:{type:String,default:""}},methods:{onValueChange:function(e){this.$emit("change",e)}}},u=Object(l.a)(c,(function(){var e=this,t=e._self._c;return t("el-form-item",{staticStyle:{display:"none"},attrs:{label:"异常处理策略："}},[t("label",{attrs:{slot:"label"},slot:"label"},[t("span",[e._v("异常处理策略：")]),t("basic-tips",{attrs:{type:"popover",title:"",width:500,placement:"bottom-start",content:""}},[t("div",[e._v("\n        按响应数据(responseSchema) 的格式要求进行适配（adapt） 或 按标准格式构造异常（throw）响应两种\n      ")])])],1),t("el-select",{staticStyle:{width:"100%"},attrs:{value:e.value,placeholder:"请选择"},on:{change:e.onValueChange}},e._l(e.exceptionStrategyTypes,(function(e){return t("el-option",{key:e.value,attrs:{label:e.value,value:e.value}})})),1)],1)}),[],!1,null,"20c39e91",null).exports,d=(a("2fdb"),function(){var e=this,t=e._self._c;return t("div",[e.data.type.toLowerCase().indexOf("complex[")>-1&&!e.ownHiddenConfig.pagination&&e.showFields?t("el-form-item",{attrs:{label:"分页配置"}},[t("label",{attrs:{slot:"label"},slot:"label"},[t("span",[e._v("分页配置")]),t("basic-tips",{attrs:{type:"popover",title:"配置说明",width:600,placement:"bottom-start",content:""}},[t("ul",{staticClass:"common-link-set-description basic-tip-content-ul"},[t("li",[e._v("选中代表返回的二维数组包括分页信息")]),t("li",[e._v("不选中代表不返回分页信息")]),t("li",[e._v("如果使用表格分页，建议使用变量，而非固定值")])])])],1),t("el-switch",{attrs:{"active-value":1,"inactive-value":0},on:{change:function(t){return e.onValueChange(t,"pagination")}},model:{value:e.config.pagination,callback:function(t){e.$set(e.config,"pagination",t)},expression:"config.pagination"}}),e._t("pagination")],2):e._e(),!e.ownHiddenConfig.fields&&e.showFields?t("el-form-item",{attrs:{label:"响应字段",prop:"responseSchema"}},[t("label",{attrs:{slot:"label"},slot:"label"},[t("span",[e._v("响应字段")]),t("basic-tips",{attrs:{type:"popover",title:"配置说明",width:600,placement:"bottom-start",content:""}},[t("ul",{staticClass:"basic-tip-content-ul"},[e.fieldsIsSelect?t("li",[e._v("指定需要返回包括的字段，可选择多个字段")]):t("li",[e._v("指定需要返回包括的字段，如需返回多个字段，则以','分隔字段名")]),t("li",[e._v("该项为空，则代表默认返回所有字段")])])])],1),e.fieldsIsSelect?t("el-select",{staticClass:"fields-select",attrs:{multiple:"",placeholder:"响应数据字段",clearable:""},on:{change:function(t){return e.onValueChange(t,"fieldsArr")}},model:{value:e.fieldsArr,callback:function(t){e.fieldsArr=t},expression:"fieldsArr"}},e._l(e.config.totalFields,(function(e){return t("el-option",{key:e,attrs:{value:e}})})),1):t("el-input",{attrs:{placeholder:"响应数据字段",clearable:""},on:{change:function(t){return e.onValueChange(t,"fieldsArr")}},model:{value:e.config.fields,callback:function(t){e.$set(e.config,"fields",t)},expression:"config.fields"}})],1):e._e(),e.data.type.toLowerCase().indexOf("complex[")>-1&&!e.ownHiddenConfig.containsKey&&e.showFields?t("el-form-item",{attrs:{label:"返回字段"}},[t("label",{attrs:{slot:"label"},slot:"label"},[t("span",[e._v("返回字段")]),t("basic-tips",{attrs:{type:"popover",title:"配置说明",width:600,placement:"bottom-start",content:""}},[t("ul",{staticClass:"basic-tip-content-ul"},[t("li",[e._v("选中代表返回的二维数组包括响应数据字段")]),t("li",[e._v("不选中代表不返回响应数据字段")])])])],1),t("el-switch",{attrs:{"active-value":1,"inactive-value":0},on:{change:function(t){return e.onValueChange(t,"containsKey")}},model:{value:e.config.containsKey,callback:function(t){e.$set(e.config,"containsKey",t)},expression:"config.containsKey"}})],1):e._e(),t("el-form-item",{attrs:{label:"默认加载"}},[t("el-switch",{on:{change:function(t){return e.onValueChange(t,"defaultLoad")}},model:{value:e.data.defaultLoad,callback:function(t){e.$set(e.data,"defaultLoad",t)},expression:"data.defaultLoad"}})],1),e.emitChangeFiled.includes("commonFlag")&&e.projectIdentifier?t("el-form-item",{attrs:{label:"包含公共数据"}},[t("el-switch",{on:{change:function(t){return e.onValueChange(t,"commonFlag")}},model:{value:e.config.commonFlag,callback:function(t){e.$set(e.config,"commonFlag",t)},expression:"config.commonFlag"}})],1):e._e()],1)});function p(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}var h={name:"CommonLinkSet",data:function(){return{showFields:!0,fieldsArr:[]}},model:{prop:"data",event:"change"},props:{config:{type:Object,default:function(){return{fields:"",containsKey:0,pagination:0,totalFields:[]}}},data:{type:Object,default:function(){}},defaultLoad:{type:Boolean,default:!0},hiddenConfig:{type:Object,default:function(){return{}}},emitChangeFiled:{type:Array,default:function(){return["fieldsArr"]}}},computed:{fieldsIsSelect:function(){var e,t;return null===(e=this.config)||void 0===e||null===(t=e.totalFields)||void 0===t?void 0:t.length},ownHiddenConfig:function(){return function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?p(Object(a),!0).forEach((function(t){Object(n.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):p(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({fields:!1,containsKey:!1,pagination:!1},this.hiddenConfig)},projectIdentifier:function(){var e=this.$store.getters.portalInfo;return Object(r.h)(window.location.href,"projectIdentifier")||(e.isManagement?"":e.nameEn)}},watch:{"config.fields":{handler:function(e){var t=(e||"").replaceAll("，",",").replaceAll(" ","");this.fieldsArr=t?t.split(","):[]},immediate:!0}},created:function(){this.showFields="isCustomVariable"!==this.data.customGroupName},methods:{onValueChange:function(e,t){this.fieldsIsSelect&&(this.config.fields=this.fieldsArr.join(",")),this.emitChangeFiled.includes(t)&&this.$emit("change",e)}}},f=(a("5686"),Object(l.a)(h,d,[],!1,null,"b8bdad58",null)).exports;function m(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function v(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?m(Object(a),!0).forEach((function(t){Object(n.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):m(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}t.a={components:{ResponseSchema:s,ExceptionStrategy:u,CommonLinkSet:f},data:function(){return{defaultLoad:!0,commonLinkSet:{fields:"",containsKey:0,pagination:0,commonFlag:!0}}},computed:{projectIdentifierByUrl:function(){return Object(r.h)(window.location.href,"projectIdentifier")}},created:function(){this.clearInvalidateLink()},methods:{clearInvalidateLink:function(){var e=this.data.linkConfig;null!=e&&e.projectIdentifier&&(null==e?void 0:e.projectIdentifier)!==this.projectIdentifierByUrl&&this.resetData()},clearByType:function(e){var t=this;this.data.linkConfig?this.$confirm("确定要清空关联配置吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.resetData(),t.dialogVisible=!1})).catch((function(){})).finally((function(){t.$emit("onClear")})):this.resetData()},closeTemp:function(e){var t,a,i;this.$setAttr(this.data,"editorDialogVisible",!1),this.dialogVisible=!1,this.showVal=null==this||null===(t=this.editVal)||void 0===t||null===(a=t.tempVariable)||void 0===a?void 0:a.name,this.$set(this.data,"value",this.showVal),this.$set(this.data,"tempVariableConfig",null==this||null===(i=this.editVal)||void 0===i?void 0:i.tempVariable),this.$emit("onClose")},commonInitData:function(e){var t=this.data.linkConfig;if(t&&t.accessType===e||"device"===e){for(var a in t)"requestPayload"===a&&(this.codeValue=Object(r.b)(t[a])),this.editVal[a]=Object(r.e)(t[a]);this.showVal=this.getCommonShowVal(e,this.editVal)}"isCustomVariable"!==this.data.customGroupName&&this.initCommonLinkSet(this.editVal),this.data.hasOwnProperty("defaultLoad")||this.$set(this.data,"defaultLoad",!0)},initCommonLinkSet:function(e){this.commonLinkSet.fields=e.fields||"",this.commonLinkSet.containsKey=e.hasOwnProperty("containsKey")?e.containsKey:1,this.commonLinkSet.pagination=e.pagination||0,this.commonLinkSet.totalFields=e.totalFields||[],this.commonLinkSet.commonFlag=e.commonFlag||!0},commonResetData:function(){this.$removeAttr(this.data,"value"),this.$removeAttr(this.data,"lastValue"),this.$removeAttr(this.data,"linkConfig"),this.$removeAttr(this.data,"editor"),this.data.editorDefined&&this.$setAttr(this.data,"editor",this.data.editorDefined),this.$setAttr(this.data,"defaultLoad",!0)},closeHandler:function(e){this.$setAttr(this.data,"editorDialogVisible",!1),this.closeResetEditor(e),this.dialogVisible=!1,this.$emit("onClose")},sureTemp:function(e){if(this.$setAttr(this.data,"editorDialogVisible",!1),this.dialogVisible=!1,this.showVal=this.editVal[e].name,this.$set(this.data,"value",this.showVal),this.$setAttr(this.data,"editValue",this.editVal),e){var t="deviceVariable"===e?"device-variable-link":"temp-variable-link";this.$setAttr(this.data,"editor",t)}},closeResetEditor:function(e){if(this.data.hasOwnProperty("linkConfig")){var t=this.data.linkConfig,a=t&&t.accessType;"device"===e?this.$setAttr(this.data,"editor","device-link"):a&&a!==e&&this.$setAttr(this.data,"editor",a+"-link")}else this.data.editorDefined?this.$setAttr(this.data,"editor",this.data.editorDefined):this.$removeAttr(this.data,"editor")},commonSureHandler:function(e){var t=this.validate();if(!0===t){var a=this.getHandlerEditVal();this.commonLinkSet.fields=this.commonLinkSet.fields.replaceAll("，",","),this.commonLinkSet.fields=this.commonLinkSet.fields.replaceAll(" ",""),a=v(v({},a),this.commonLinkSet),"isCustomVariable"!==this.data.customGroupName&&(this.data.type.indexOf("Enum")>-1?a.dataType="String":a.dataType=this.data.type),this.showVal=this.getCommonShowVal(e,a),!1!==this.handleChangeResult(this.showVal,this.data)?(this.$setAttr(this.data,"value",this.showVal),this.$setAttr(this.data,"lastValue",this.showVal),a.projectIdentifier=this.projectIdentifierByUrl||"",this.$setAttr(this.data,"linkConfig",a),this.$setAttr(this.data,"editorDialogVisible",!1),this.dialogVisible=!1,this.closeResetEditor(e),this.dialogVisible=!1,this.$store.commit("SET_UN_SAVED",!0),this.$emit("onSure",a,this.showVal)):this.$setAttr(this.data,"lastValue",this.data.lastValue)}else this.$message.warning(t)},getVariableShowVal:function(){return"static"===this.editVal.type?this.editVal.static:"${"+this.editVal.variable.join(".")+"}"},getCommonShowVal:function(e,t){var a;if(null!=t&&t.origin&&(e=(null==t||null===(a=t.origin)||void 0===a?void 0:a.accessType)||e),"api"===e)return this.substringStr("".concat(e,": ").concat(t.url));if("sql"===e)return this.substringStr("".concat(e,": ").concat(t.id));if("indicator"===e)return this.substringStr("".concat(e,": ").concat(t.url));if("rtdata"===e)return this.substringStr("".concat(e,": ").concat(t.url));if("device"===e)return this.substringStr("".concat(e,": ").concat(t.url));if("templates"===e)return this.substringStr("".concat(e,": ").concat(t.url));if("assets"===e)return this.substringStr("".concat(e,": ").concat(t.url));if("script"===e)return this.substringStr("".concat(e,": ").concat(t.content));if("variable"===e)return this.getVariableShowVal();if("object"===e)try{var i,n,o=JSON.parse(t.metaData),l="list"===o.configType?null===(i=o.objectType)||void 0===i?void 0:i.value:null===(n=o.objectIdEditVal)||void 0===n?void 0:n.value;return this.substringStr("".concat(e,": ").concat(l))}catch(e){}return"alarm"===e?this.substringStr("".concat(e,": ").concat(t.url)):"".concat(e,": ")+Object(r.b)(t)},substringStr:function(e){return e.length>20?e.substr(0,20)+"...":e},getVariableNames:function(e){if(!e)return[];var t=Object(r.g)(e),a=[];if("string"===t){var n=e.match(/\$\{(.*?)\}/g)||[];a=[].concat(Object(i.a)(a),Object(i.a)(n))}else if("object"===t)for(var o in e){var l=e[o],s=this.getVariableNames(l);a=[].concat(Object(i.a)(a),Object(i.a)(s))}return a},formatVariables:function(e){return Array.from(new Set(e)).map((function(e){var t=/^\${(.+)}$/g.exec(e);if(!t)return e;var a=t[1];return a?a.replace(/(^\s*)|(\s*$)/g,""):e}))},validateArr:function(e){for(var t=arguments.length,a=new Array(t>1?t-1:0),i=1;i<t;i++)a[i-1]=arguments[i];if(!Array.isArray(e))return!0;if(a.length>1){var n=e.some((function(e){var t=null;return a.some((function(a){var i=!!e[a];if(0===e[a]&&(i=!i),null!==t)return t!==i;t=i}))}));return!n}return!0},getComplexFilter:function(e){for(var t=[],a=e.filter((function(e){return e.name||"group"===e.filterType})),i=a.length,n=a.findIndex((function(e){return"group"!==e.filterType})),r=i-1,o=i;o--;)if("group"!==a[o].filterType){r=o;break}return a.forEach((function(e,i){if("group"===e.filterType){var o=a[i-1]||{},l=a[i+1]||{},s=e.divierCode;if("begin"===s){if("end"===l.divierCode)return;i>n&&i<r&&"group"!==l.filterType&&t.push(" ".concat(e.divierType," ")),t.push("(")}if("end"===s){if("begin"===o.divierCode)return;t.push(")"),"group"!==l.filterType&&i>n&&i<r&&t.push(" ".concat(e.divierType," "))}}else if(0===i){var c;t.push("".concat(e.name," ").concat(e.logicExp," '").concat(null!==(c=e.value)&&void 0!==c?c:"","'"))}else{var u,d=a[i-1].filterType;"group"!==d&&t.push(" ".concat(d," ")),t.push("".concat(e.name," ").concat(e.logicExp," '").concat(null!==(u=e.value)&&void 0!==u?u:"","'"))}})),t.join("")},complexFilterStrToArr:function(e){for(var t,a=[],n={filterType:"group",divierCode:"begin",divierName:"分组线开始"},r={filterType:"group",divierCode:"end",divierName:"分组线结束"},o=e.length,l=0,s=[],c=0;c<o;c++){var u=e[c];if("("===u)t=Date.now()+"",a.push(v(v({},n),{},{divierType:b(c),divierSign:t}));else if(")"===u)s.push(v(v({},r),{},{divierType:b(c,"right"),divierSign:t}));else if("o"===u){if(" or "===e.substring(c-1,c+3)){var d=g(l,c);if(d){var p=this.getFiledByFilterStr(d);p.filterType="or",a.push(p)}l=c+=2,s.length&&(a.push.apply(a,Object(i.a)(s)),s=[])}}else if("a"===u){if(" and "===e.substring(c-1,c+4)){var h=g(l,c);if(h){var f=this.getFiledByFilterStr(h);f.filterType="and",a.push(f)}l=c+=3,s.length&&(a.push.apply(a,Object(i.a)(s)),s=[])}}}var m=this.getFiledByFilterStr(g(l,o+1));return m.filterType="and",a.push(m),s.length&&(a.push.apply(a,Object(i.a)(s)),s=[]),a;function b(t){var a,i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"left";"left"===n?(a=e.substring(t-3,t-1),i=e.substring(t-4,t-1)):(a=e.substring(t+2,t+4),i=e.substring(t+2,t+5));var r=["or","and"];return r.includes(a)?a:r.includes(i)?i:"and"}function g(t,a){var i=e.substring(t,a-1).replace(/\(|\)/g,"").trim();return i.length<6?"":i}},getFiledByFilterStr:function(e){var t,a,i,n=e.trim().split(" ");if(n.length&&(t=n[0]),2===n.length&&(a=n[1],i=""),n.length>=3){if(a=n[1],i=n[2],n[3])for(var r=3;r<n.length;r++)i+=" "+n[r];i.startsWith("'")&&(i=i.substring(1,i.length-1))}return{editValue:this.getEditValue(i),filter:"",lastValue:i,name:t,value:i,logicExp:a}}}}},"37b7":function(e,t,a){"use strict";a("d8eb")},"37f8":function(e,t,a){"use strict";a("1371")},3909:function(e,t,a){},3958:function(e,t,a){},"3a46":function(e,t,a){},"3c0c":function(e,t,a){"use strict";a.r(t);var i=(a("8e6e"),a("4917"),a("55dd"),a("a481"),a("7514"),a("7618")),n=(a("6762"),a("2fdb"),a("28a5"),a("96cf"),a("3b8d")),r=a("75fc"),o=(a("ac6a"),a("456d"),a("7f7f"),a("bd86")),l=(a("c5f6"),a("967e")),s=a.n(l),c=a("36f0"),u=a("c276"),d=a("b19c"),p=(a("386d"),function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"object-type-tree"},[t("el-input",{attrs:{clearable:"",placeholder:"请输入名称或者标识"},on:{clear:e.search},nativeOn:{keyup:[function(t){return e.search.apply(null,arguments)},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search.apply(null,arguments)}]},model:{value:e.searchWord,callback:function(t){e.searchWord=t},expression:"searchWord"}}),t("div",{staticClass:"hc-editor-tree tree-wrap"},[t("el-tree",{ref:"treeRef",attrs:{data:e.treeData,"node-key":"identifier",props:e.defaultProps,"default-expanded-keys":e.defaultExpandKey,"expand-on-click-node":!1,"filter-node-method":e.filterNode},on:{"node-click":e.handleNodeClick},scopedSlots:e._u([{key:"default",fn:function(a){a.node;var i=a.data;return t("span",{staticClass:"custom-tree-node",attrs:{id:i.id}},[t("i",{class:e.getIcon(i),staticStyle:{"margin-right":"5px"}}),t("el-tooltip",{attrs:{effect:"dark",content:e.getShowName(i),placement:"top","open-delay":1e3}},[t("span",[e._v(e._s(e.getShowName(i)))])])],1)}}])})],1)],1)}),h={name:"ObjectTypeTree",props:{value:{type:String,default:""}},data:function(){return{loading:!1,searchWord:"",treeData:[],defaultExpandKey:[""],defaultProps:{children:"children",label:"localName"},timer:void 0}},watch:{value:{handler:function(e,t){this.setSelectByKey(e)},immediate:!0}},created:function(){this.getTreeList()},methods:{getShowName:function(e){return e.identifier?(e.localName||"")+"（"+(e.identifier||"")+"）":e.localName||""},getIcon:function(e){return e.children&&e.children.length?"el-icon-folder":"el-icon-document"},getTreeList:function(){var e=this;return Object(n.a)(s.a.mark((function t(){var a;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.loading=!0,t.next=3,e.getTreeDataFn();case 3:a=t.sent,e.loading=!1,a.push({id:"1",name:"/",localName:"/",identifier:""}),e.treeData=e.$util.listToTree(a,"id","parentId"),e.defaultExpandKey.push(e.value),e.setSelectByKey(e.value),e.jumpToById(e.value);case 10:case"end":return t.stop()}}),t)})))()},setSelectByKey:function(e){var t=this;this.$nextTick((function(){t.$refs.treeRef.setCurrentKey(e)}))},jumpToById:function(e){},getTreeDataFn:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return new Promise(function(){var a=Object(n.a)(s.a.mark((function a(i,n){var r,o,l,c,u;return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(r=e.$store.getters.portalInfo,!(o=Object(d.h)(window.location.href,"projectIdentifier")||(r.isManagement?"":r.nameEn))){a.next=9;break}return c={url:"/api/thing-model/thing-models/query-model-tree-info",method:"post",data:{projectIdentifier:o}},a.next=6,e.$util.request(c).then((function(e){u=e.modelTreeIdentifier}));case 6:l={url:"/api/thing-model/thing-models/query-model-profile",method:"post",data:{orderBy:"createTime desc",filter:"modelTreeIdentifier eq COMMON::IOT::".concat(u)}},a.next=10;break;case 9:l={url:"/api/model/profiles",params:{pagination:0,lazyLoad:0,parentId:t,$orderBy:"createTime desc",fields:"id,parentId,Identifier,name"}};case 10:e.$util.request(l).then((function(e){i(e)})).catch((function(t){e.loading=!1,n(t)}));case 11:case"end":return a.stop()}}),a)})));return function(e,t){return a.apply(this,arguments)}}())},search:function(){var e=this;this.timer&&clearTimeout(this.timer),this.timer=setTimeout((function(){e.$refs.treeRef.filter(e.searchWord),e.timer=null}),300)},filterNode:function(e,t){return!e||-1!==t.localName.indexOf(e)||-1!==t.identifier.indexOf(e)},handleNodeClick:function(e){this.$emit("input",e.identifier),this.$emit("change",e)}}},f=(a("caeb"),a("2877")),m=Object(f.a)(h,p,[],!1,null,null,null).exports,v=a("ae83"),b={name:"ObjectLinkCommonSet",props:{value:{type:Object,default:function(){}},pagination:{type:Number,default:0},configType:{type:String,default:"list"}},data:function(){var e=this;return{config:{},baseFieldSchema:[{label:"条件类型",key:"filterType",type:"String",tag:"radio",defaultValue:"and",tip:["$filter 条件类型","complex类型: $filter 为and、or和()自由组合条件"],props:{},options:[{label:"and",value:"and"},{label:"or",value:"or"},{label:"complex",value:"complex"}],group:["list"]},{label:"父节点Id",key:"parentId",type:"String",tag:"variable",defaultValue:"-1",tip:["树状节点的父 id","开启分页（pagination 为 1） 时无效（组织范围开启时有效，且仅支持一个parentId）","关闭分页有效（pagination 为 0），多个 parentId 可通过逗号分隔"],visible:function(t){var a=e.pagination,i=t.orgScope;return 0===a||0===i||1===i},group:["list"]},{label:"懒加载",key:"lazyLoad",type:"Number",tag:"switch",defaultValue:1,tip:["当分页参数关闭（pagination 为 0）时参数生效，懒加载暂时只支持从根节点进行查询"],visible:function(t){return 0===e.pagination},group:["list"]},{label:"查询子节点",key:"queryChild",type:"Number",tag:"switch",defaultValue:0,tip:["当分页参数关闭（pagination 为 0）时该参数有效"],visible:function(t){return 0===e.pagination},group:["list"]},{label:"返回结果类型",key:"resultIsObject",type:"Number",tag:"radio",defaultValue:0,options:[{label:"数组",value:0},{label:"对象",value:1}],tip:["当 分页参数关闭（pagination 为 0） 并且返回结果只包含一条记录生效时返回数据类型"],visible:function(t){return 0===e.pagination},group:["list"]},{label:"访问方法",key:"accessMethod",type:"String",tag:"radio",defaultValue:"direct",options:[{label:"direct",value:"direct"},{label:"foreign_key",value:"foreign_key"}],tip:["有效值包括 direct 和 foreign_key，默认值为 direct","当值为 foreign_key 时，如果查询对应的属性类型为 Object 类型，则会自动进行关联查询并返回 relationProperties 中指定的关联对象属性值"],group:["list","object"]},{label:"关联属性",key:"relationProperties",type:"String",tag:"variable",defaultValue:"id,identifier,name,localName",tip:["当 访问方法（accessMethod） 值为 foreign_key，并且存在查询对应的属性类型为 Object 类型时，该参数生效","多个属性名称可通过逗号分割，如果存在多个外键关联的属性，可取对应的并集"],group:["list","object"]},{label:"实时数据",key:"queryRealtimeData",type:"Boolean",tag:"switch",defaultValue:!1,tip:["是否查询实时数据"],group:["list","object"]},{label:"响应字段",key:"realtimeDateKeyNames",type:"String",tag:"variable",defaultValue:"",tip:["查询实时数据生效，当存在多个值时可以逗号分隔，每部分为对应的测点的 name ,值为空时表示查询所有关联的测点数据"],visible:function(e){return e.queryRealtimeData},group:["list","object"]},{label:"辅助索引",key:"useIndex",type:"String",tag:"radio",defaultValue:"2",options:[{label:"启用elemMatch方式",value:"2"},{label:"不启用",value:"0"},{label:"启用match方式",value:"1"}],tip:["是否启用辅助索引","当使用自定义字段做过滤条件时建议启用"],group:["list"]},{label:"组织范围",key:"orgScope",type:"Number",tag:"radio",defaultValue:null,options:[{label:"不启用",value:null},{label:"直接子级",value:0},{label:"全子级",value:1}],tip:["此处用于简化基于组织机构查询子级对象时使用","直接子级（不含父实例），即仅查询parentId下的记录","全子级（不含父实例）, 仅在 分页参数开启（pagination 为 1） 时该参数有效"],group:["list"]},{label:"大表查询",key:"bigTable",type:"Number",tag:"radio",defaultValue:0,options:[{label:"不启用",value:0},{label:"启用，倒序向后查询",value:10},{label:"启用，升序向前查询",value:11}],tip:["仅在 分页参数开启（pagination 为 1） 时该参数有效","启用此查询后，将省去全量count动作以节省查询时间，且返回信息中将不包含分页信息"],visible:function(t){return 1===e.pagination},group:["list"]},{label:"临界Id",key:"criticalId",type:"String",tag:"input",defaultValue:"",tip:["临界id，启用大表查询时候生效"],visible:function(e){return 0!==e.bigTable},group:["list"]},{label:"大小写敏感",key:"insensitive",type:"String",tag:"radio",defaultValue:"1",options:[{label:"不敏感",value:"1"},{label:"敏感",value:"0"}],tip:["模糊查询是否大小写敏感"],group:["list"]},{label:"hasChild",key:"queryHasChild",type:"Boolean",tag:"switch",defaultValue:!1,tip:["不分页且懒加载时有效","树状节点查询场景时返回 hasChild 字段"],visible:function(t){return 1===t.lazyLoad&&0===e.pagination},group:["list"]},{label:"内置字段",key:"returnFields",type:"String",tag:"variable",defaultValue:"",tip:["需要返回的内置字段信息，多个以英文逗号分隔"],group:["object"]},{label:"多态查询",key:"querySubObjectType",type:"Boolean",tag:"switch",defaultValue:!1,tip:["是否开启多态查询，即根据传入的objectType查询子类型的实例。默认false"],group:["list"]},{label:"递归深度",key:"querySubObjectTypeLevel",type:"Number",tag:"variable",defaultValue:1,tip:["多态查询递归深度。默认值1，即只查询当前类型和直接子类型的实例"],visible:function(e){return!0===e.querySubObjectType},group:["list"]},{label:"实例转换",key:"convertParentIdByPathName",type:"Boolean",tag:"switch",defaultValue:!1,tip:["是否将parentId按照pathName查询并替换成多个实例id，即所有子孙级实例（含本身）","默认值 false 则不进行处理。场景为按父机构查询所有子机构的指标数据"],group:["list"]},{label:"分组",key:"$groupBy",type:"String",tag:"variable",defaultValue:"",tip:["传入属性名，多个之间用 ,(英文逗号) 分隔","例如: prop1,prop2。","字典枚举类型属性不支持分组"],group:["list"]},{label:"分组属性",key:"$fields",type:"String",tag:"variable",defaultValue:"",tip:["格式：$fields=op(field):name,op(field):name","示例格式: $count:totalNum,$sum(price):totalPrice ","操作符支持: $avg,$max,$min,$sum,$count","括号()中间field是聚合操作的属性名，冒号:后面name是返回字段名","支持int、double类型属性","$groupBy没有值，会把$fields当成属性"],group:["list"]}],compoundItem:[{label:"变量选择",value:"variable",formItem:"variable-Panel"},{label:"手动输入",value:"static",formItem:"input",placeholder:"支持字符、${...}、字符与${...}混合三种形式的输入，${...}是对变量的引用，其中...为变量名",tips:"支持字符、${...}、字符与${...}混合三种形式的输入，${...}是对变量的引用，其中...为变量名"}]}},computed:{fieldSchema:function(){var e=this;return this.baseFieldSchema.filter((function(t){return void 0===t.group||("string"==typeof t.group?t.group.split(",").includes(e.configType):!!Array.isArray(t.group)&&t.group.includes(e.configType))}))}},watch:{value:{handler:function(){this.setValue()},deep:!0},pagination:function(){this.handleChange()},configType:function(){this.initData()}},beforeCreated:function(){},created:function(){this.initData()},methods:{handleVisible:function(e){return"function"==typeof e.visible?e.visible(this.config):!1!==e.visible},initData:function(){var e=this;this.fieldSchema.forEach((function(t){t.tip=t.tip||[],t.hasOwnProperty("defaultValue")&&e.$set(e.config,t.key,t.defaultValue)})),this.setValue(),this.handleChange()},setValue:function(){for(var e in this.value)this.config[e]=this.value[e]},variableChange:function(e,t){this.handleChange()},handleChange:function(){var e=this,t={},a=[];this.fieldSchema.forEach((function(i){e.handleVisible(i)&&(a.push(i.key),t[i.key]=e.config[i.key])})),this.$emit("input",t),this.$emit("change",t),this.$emit("validKeys",a)},getEditValue:function(e,t){var a;if("string"==typeof e){var i,n,r=/\$\{(.*?)\}/g.exec(e);(null==r?void 0:r[0])===e?a={static:"",type:"variable",variable:null===(i=r[1])||void 0===i?void 0:i.split(".")}:(n={},Object(o.a)(n,t.type||"static",e),Object(o.a)(n,"type","static"),Object(o.a)(n,"variable",[]),a=n)}else{var l,s=e;[void 0].includes(s)&&(s=t.defaultValue),l={},Object(o.a)(l,t.type||"static",s),Object(o.a)(l,"type","static"),Object(o.a)(l,"variable",[]),a=l}return{editValue:a}}}},g=(a("f96a"),Object(f.a)(b,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"object-link-common-set"},[t("el-form",{attrs:{"label-width":"120px",model:e.config}},[e._t("pre",null,{data:e.config}),e._l(e.fieldSchema,(function(a){return t("div",{key:a.key},[e._t(a.key+"_pre",null,{data:e.config}),t("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.handleVisible(a)&&"filterType"!==a.key,expression:"handleVisible(item) && item.key !== 'filterType'"}],attrs:{label:a.label}},[t("label",{attrs:{slot:"label"},slot:"label"},[t("span",[e._v(e._s(a.label))]),Array.isArray(a.tip)&&a.tip.length?t("basic-tips",{attrs:{type:"popover",title:"配置说明",width:600,placement:"bottom-start",content:"",iconStyle:{color:"#C9D0D4"}}},[t("ul",{staticClass:"common-link-set-description basic-tip-content-ul"},e._l(a.tip,(function(i,n){return t("li",{key:a.key+n},[e._v(e._s(i))])})),0)]):e._e()],1),"radio"===a.tag?t("el-radio-group",{on:{change:e.handleChange},model:{value:e.config[a.key],callback:function(t){e.$set(e.config,a.key,t)},expression:"config[item.key]"}},e._l(a.options,(function(i){return t("el-radio",{key:a.key+i.value,attrs:{label:i.value}},[e._v(e._s(i.label))])})),1):e._e(),"input"===a.tag?t("el-input",{attrs:{placeholder:a.label},on:{change:e.handleChange},model:{value:e.config[a.key],callback:function(t){e.$set(e.config,a.key,t)},expression:"config[item.key]"}}):e._e(),"switch"===a.tag?t("el-switch",{attrs:{"active-value":"Number"!==a.type||1,"inactive-value":"Number"===a.type&&0},on:{change:e.handleChange},model:{value:e.config[a.key],callback:function(t){e.$set(e.config,a.key,t)},expression:"config[item.key]"}}):e._e(),"variable"===a.tag?t("variable-editor-components",{attrs:{compoundItem:e.compoundItem,staticType:a.type,data:e.getEditValue(e.config[a.key],a)},on:{change:function(t){return e.variableChange(t,a)}},model:{value:e.config[a.key],callback:function(t){e.$set(e.config,a.key,t)},expression:"config[item.key]"}}):e._e()],1),e._t(a.key+"_suf",null,{data:e.config})],2)})),e._t("suf",null,{data:e.config})],2)],1)}),[],!1,null,"e2f826f0",null)).exports,y={name:"ParamsSelect",props:{value:{type:Array,default:function(){return[{field:"",filter:""}]}},maxCount:{type:Number,default:5}},created:function(){this.payloads=this.value},watch:{value:{handler:function(){this.payloads=this.value},immediate:!0}},data:function(){return{payloads:[]}},methods:{handleEvents:function(e,t){var a=this,i=this.payloads.length;if("add"===e)return this.payloads.push({field:"id",filter:""}),void this.emitChange();if("del"!==e){if("top"===e){if(0===t)return;var n=this.payloads.splice(t,1);return this.payloads.splice(t-1,0,n[0]),void this.emitChange()}if("bottom"===e){if(t===i-1)return;var r=this.payloads.splice(t,1);this.payloads.splice(t+1,0,r[0]),this.emitChange()}"clear"===e&&this.emitChange()}else this.$confirm("确定要删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){a.payloads.splice(t,1),a.emitChange()})).catch((function(){}))},onNameChange:function(){this.emitChange()},emitChange:function(){this.$emit("input",this.payloads),this.$emit("change",this.payloads)}},computed:{themeStyles:function(){return{target:"th,td",style:{"border-width":Object(u.nb)("borderWidth"),"border-style":Object(u.nb)("borderStyle"),"border-color":Object(u.nb)("borderColor"),padding:"0 5px"}}},theadStyles:function(){return{"background-color":Object(u.nb)("middleBackgroundColor")}}}},_=(a("3454"),Object(f.a)(y,(function(){var e=this,t=e._self._c;return t("div",[t("table",{directives:[{name:"theme",rawName:"v-theme",value:e.themeStyles,expression:"themeStyles"}],staticClass:"hc-editor-payload-table"},[t("thead",{staticClass:"hc-editor-payload-table-thead",style:e.theadStyles},[t("tr",[t("th",{attrs:{width:"40%"}},[e._v("查询条件")]),t("th",{attrs:{width:"35%"}},[e._v("\n          结果属性\n          "),t("basic-tips",{attrs:{type:"popover",title:"配置说明",width:600,placement:"bottom-start",iconStyle:{color:"#C9D0D4"},content:""}},[t("ul",{staticClass:"basic-tip-content-ul"},[t("li",[e._v("子查询的查询结果属性，默认为Id")])])])],1),t("th",{attrs:{width:"25%"}},[e._v("操作")])])]),t("tbody",{staticClass:"hc-editor-payload-table-tbody"},e._l(e.payloads,(function(a,i){return t("tr",{key:i},[t("td",[t("div",{staticStyle:{display:"flex","align-items":"center"}},[t("span",[e._v(e._s("$subFilter".concat(i+1)))]),t("el-input",{attrs:{size:"mini",type:"textarea",rows:1,placeholder:"请输入查询条件",clearable:""},on:{blur:e.onNameChange},model:{value:a.filter,callback:function(t){e.$set(a,"filter",t)},expression:"param.filter"}})],1)]),t("td",[t("div",{staticStyle:{display:"flex"}},[t("span",[e._v(e._s("$subFilterField".concat(i+1)))]),t("el-input",{attrs:{size:"mini",placeholder:"请输入结果属性",clearable:""},on:{blur:e.onNameChange},model:{value:a.field,callback:function(t){e.$set(a,"field",t)},expression:"param.field"}})],1)]),t("td",{staticClass:"hc-payload-operation",attrs:{align:"center"}},[t("CommonTableMoveOprate",{attrs:{data:e.payloads,index:i,icon:!1,text:!0,defaultValue:{field:"id"}},on:{click:e.handleEvents}})],1)])})),0)]),t("div",{staticClass:"params-add-btn"},[t("el-button",{attrs:{title:"新增",disabled:!!e.maxCount&&e.payloads.length>=e.maxCount,icon:"el-icon-plus",plain:""},on:{click:function(t){return e.handleEvents("add")}}},[e._v("添加参数")])],1)])}),[],!1,null,"0cb69958",null)).exports,C=a("8e8a"),O=a("91ff"),T=a("bc2d"),V=a("d8fe"),w=a("2f62");function P(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function x(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?P(Object(a),!0).forEach((function(t){Object(o.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):P(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var S=function(e){var t={};for(var a in e){var i=e[a];"name"===a?t.name=Object(u.pb)(i.value,i.default):"alias"===a?t.alias=Object(u.pb)(i.value,i.default):"description"===a?t.description=Object(u.pb)(i.value,i.default):"editor"===a&&(t.editor=Object(u.pb)(i.value,i.default))}return t},j={name:"ObjectLinkEditor",command:"object-link",alias:"对象类型",mixins:[c.a],components:{controlCommonAlert:v.a,CommonSet:g,SubFilter:_,ApiFiltersSelect:C.a,OrderbySetting:O.a,PaginationSetting:T.a,ApiTestPanel:V.a,objectTypeTree:m},props:{visible:{type:String,default:function(){return!1}},showInput:{type:String,default:function(){return!0}},iconClass:{type:String,default:function(){return"el-icon-edit"}},data:{type:Object,default:function(){return{alias:"",type:"",default:"",value:"",primitiveLabels:""}}},placeholder:{type:String,default:""},linkType:{type:Number,default:function(){return 1}},handleRulesResult:{type:Function,default:function(){}},handleChangeResult:{type:Function,default:function(){}}},data:function(){var e="object";return{isShowDeleteConfirm:!0,collapseValue:"filter",compUid:"",ownSign:e,actionTipTitle:"对象类型是指通过指定对象类型并从该实例返回的内容获取数据，可为请求配置BODY请求体内容、对象标识、筛选项、数据排序等参数配置，可进行请求测试，验证请求有效性和响应字段管理。",configType:"",configApi:"",configTypes:[{label:"列表",value:"list",api:"/api/model/instances"},{label:"对象",value:"object",api:"/api/model/instances/{id}"}],metaDataKeys:{configType:"list",objectType:{type:"static",static:"",value:"",variable:[],useExpression:""},commonSetParams:{},filterArr:[{name:"",value:"",filter:"",editValue:"",logicExp:"eq"}],subFilterArr:[{filter:"",field:"id"}],orderByArr:[{attr:"",sort:"asc"}],pagination:{page:"",pageSize:"",enabled:!0},commonLinkSet:{fields:"",containsKey:1,pagination:0,commonFlag:!0},objectIdEditVal:{}},editVal:{url:"",method:"get",exceptionStrategy:"throw",fields:"",containsKey:1,pagination:0,commonFlag:!0,dataType:"",defaultLoad:!0,requestPayload:{},responseSchema:{},variables:[],quickSelect:{},historySelect:[],isQuickSelect:!1,totalFields:[],metaData:"{}"},baseEditVal:{accessType:e,linkType:this.linkType,contentType:"application/json",exceptionStrategy:"throw"},jsonValue:"{}",codeJSONOptions:{},showVal:"",dialogVisible:this.visible,showTest:!1,viewMode:1,tempJsonValue:"",paramsArr:[],commonSetParams:{},commonParamsKeys:[],filterArr:[{name:"",value:"",filter:"",editValue:"",logicExp:"eq"}],subFilterArr:[{filter:"",field:"id"}],orderByArr:[{attr:"",sort:"asc"}],pagination:{page:"",pageSize:"",enabled:!0},objectType:{},configToTest:{},compoundItem:[{label:"变量选择",value:"variable",formItem:"variable-Panel"},{label:"手动输入",value:"static",formItem:"input",placeholder:"支持字符、${...}、字符与${...}混合三种形式的输入，${...}是对变量的引用，其中...为变量名",tips:"支持字符、${...}、字符与${...}混合三种形式的输入，${...}是对变量的引用，其中...为变量名"}],objectIdEditVal:{},showCloseTips:!1,projectIdentifier:"",intanceList:[],filterString:""}},computed:x(x({},Object(w.a)(["themeConstColor","getLinkTipsOf"])),{},{themeColor:function(){return this.themeConstColor.primary},objectTipsLoaded:function(){return this.getLinkTipsOf("object-link")},paramsSettingItems:function(){return[{label:"筛选项",id:"filter",tips:["限制接口返回与指定字段、过滤类型匹配的数据","联合查询中(complex)，提高查询的优先级请添加分组，分组本质就是添加一对小括号"],count:(this.filterArr.filter((function(e){return e.name&&e.value}))||[]).length,visible:"list"===this.configType},{label:"排序",id:"sort",tips:["按照配置顺序以指定字段进行排序，支持升序和降序"],count:(this.orderByArr.filter((function(e){return e.attr}))||[]).length,visible:"list"===this.configType},{label:"通用参数配置",id:"param",tips:["高级查询相关配置"],count:Object.keys(this.commonSetParams).length},{label:"子查询",id:"subFilter",tips:["filter在筛选项里配置","子查询的条件，遵循 filter 语法特性，支持 objectType、parentId 以及其他属性使用filter语法特性，","支持objectType、parentId以及其他属性使用filter 语法，与 in 关键字配合使用"],count:(this.subFilterArr.filter((function(e){return e.filter&&e.field}))||[]).length,visible:"list"===this.configType}]},newArgs:function(){if(this.args&&this.args.length)return Object(r.a)(this.args);var e=this.getPayloads(this.parent&&this.parent.attributes);return e.length>0?e:(e=this.getPayloads(this.parentParent&&this.parentParent.attributes)).length>0?e:[]},isList:function(){return"list"===this.configType},objectTypeSelect:function(){return[{label:"对象类型树选择",value:"static"},{label:"变量选择",value:"variable"}]}}),watch:{"data.value":function(){this.initData()},visible:function(e){this.dialogVisible=e,e&&this.initData()}},created:function(){this.initData()},methods:{getPayloads:function(e){var t=[];if("array"===Object(d.g)(e))e.forEach((function(e){if(!t.length){var a="payload"===e.name?e.attributes:e.payload?e.payload.attributes:null;a&&a.forEach((function(e){var a=S(e);t.push(a)}))}}));else if("object"===Object(d.g)(e))for(var a in e)if("payload"===a){e[a].attributes.forEach((function(e){var a=S(e);t.push(a)}))}return t},initData:function(){this.compUid=this._uid,this.showVal="",this.commonInitData(this.ownSign),this.jsonValueHandler(),this.setMetaData(),this.handleConfigTypeChange(!0),this.initTips(),this.projectIdentifier=Object(d.h)(window.location.href,"projectIdentifier"),this.getIntanceList()},initTips:function(){this.$store.dispatch("setLinkEditorTips","object")},clickSure:function(){this.isCorrectJsonValue()||(this.showTest=!1,this.viewMode=2);var e={};for(var t in this.metaDataKeys)e[t]=this[t];this.editVal.metaData=JSON.stringify(e),this.commonSureHandler(this.ownSign)},setMetaData:function(){try{var e=JSON.parse(this.editVal.metaData);for(var t in this.metaDataKeys)this.$set(this,t,e[t]||Object(d.e)(this.metaDataKeys[t]))}catch(e){}},objectSelectTypeChange:function(){this.objectType.value="",this.getIntanceList(),this.recoverDefaultKey("objectIdEditVal")},objectTypeTreeChange:function(e){this.objectType.editValue&&delete this.objectType.editValue,this.isList||this.getIntanceList(),this.refreshUrl()},getIntanceList:function(){var e=this;return Object(n.a)(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.isList){t.next=2;break}return t.abrupt("return");case 2:if(!e.objectType.value){t.next=8;break}return t.next=5,e.getIntanceListFn(e.objectType.value);case 5:e.intanceList=t.sent,t.next=9;break;case 8:e.intanceList=[];case 9:e.$refs.variableEditor&&e.$refs.variableEditor.setOptions(e.intanceList);case 10:case"end":return t.stop()}}),t)})))()},getIntanceListFn:function(e){var t=this;return new Promise((function(a,i){var n={url:"/api/model/instances",params:{objectType:e,pagination:0,lazyLoad:0,$orderBy:"createTime desc",$fields:"id,parentId,name",projectIdentifier:t.projectIdentifier}};t.$util.request(n).then((function(e){a(e)})).catch((function(e){t.$message.error(e.message||"获取实例列表失败"),a([])}))}))},recoverDefaultKey:function(e){for(var t in"string"==typeof e&&(e=e.split(",")),this.metaDataKeys)Array.isArray(e)&&e.length?e.includes(t)&&this.$set(this,t,Object(d.e)(this.metaDataKeys[t])):this.$set(this,t,Object(d.e)(this.metaDataKeys[t]))},jsonValueHandler:function(){var e=this,t=Object(d.e)(this.editVal);delete(t=x(x(x(x(x(x({objectType:this.objectType.value},t),this.pagination),this.getAllQueryData()),this.commonLinkSet),this.commonSetParams),{},{defaultLoad:this.data.defaultLoad})).url,delete t.method,delete t.metaData,delete t.requestPayload,delete t.accessType,delete t.contentType,delete t.exceptionStrategy,delete t.responseSchema,delete t.dataType,delete t.variables,delete t.quickSelect,delete t.historySelect,delete t.isQuickSelect,delete t.requestParams,delete t.totalFields,delete t.enabled,this.isList||(t.id=this.objectIdEditVal.value||"",delete t.page,delete t.pageSize,delete t.$orderBy,delete t.$filter),this.jsonValue=Object(d.b)(t),this.tempJsonValue="",this.$nextTick((function(){e.$refs.codeEditorJSON&&e.$refs.codeEditorJSON.initData()}))},codeEditorJSONBlur:function(e){if(this.tempJsonValue=e,this.isCorrectJsonValue(!1)){var t=Object(d.j)(e);this.data.defaultLoad=t.defaultLoad;var a=x({},this.commonSetParams);this.commonParamsKeys.forEach((function(e){a[e]=t[e]})),this.commonSetParams=a,this.initCommonLinkSet(t);var i=t.objectType;if(this.objectType.value!==i){var n=this.getEditValue(i);n.value=i,this.objectType=n}this.isList?(this.reverseParams(t),this.pagination.page=t.page,this.pagination.pageSize=t.pageSize):this.objectIdEditVal.value=t.id,this.refreshUrl()}},isCorrectJsonValue:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];try{var t=JSON.parse(this.tempJsonValue);if(["number"].includes(Object(i.a)(t)))throw new Error("格式不合法");return!0}catch(t){return null===this.tempJsonValue||""===this.tempJsonValue||(e&&this.$message({message:"输入正确格式的JSON数据！",type:"warning"}),!1)}},validate:function(){var e=this.objectType,t=this.objectIdEditVal;return"string"==typeof this.editVal||Array.isArray(this.editVal)?"请输入正确的JSON配置！":this.isList&&!e.value?"请配置对象类型标识":this.isList||t.value?!1!==this.validateArr(this.filterArr,"name","value")||"筛选项参数配置不完整":"请配置对象实例Id"},validateFilter:function(){var e={},t=!0,a="";return this.filterArr.some((function(i){if("and"===i.filterType){if(e.hasOwnProperty(i.name)&&e[i.name]!==i.value)return t=!1,void(a="筛选项中存在非法查询条件：".concat(i.name," = ").concat(e[i.name]," and ").concat(i.name," = ").concat(i.value));e[i.name]=i.value}})),{res:t,msg:a}},getHandlerEditVal:function(){var e=Object(d.e)(this.editVal);return e.responseSchema||(e.responseSchema={}),e.requestPayload||(e.requestPayload={}),(e=Object.assign(e,this.baseEditVal)).variables=this.getVariables(e),e},getVariables:function(e){var t=this.getVariableNames(e.url),a=this.getVariableNames(e.requestPayload),i=this.getVariableNames(e.responseSchema);return this.formatVariables([].concat(Object(r.a)(t),Object(r.a)(a),Object(r.a)(i)))},handleIconClick:function(){this.open()},open:function(){this.$setAttr(this.data,"editorDialogVisible",!0),this.dialogVisible=!0},close:function(){this.closeHandler(this.ownSign)},clear:function(){this.clearByType(this.ownSign)},resetData:function(){this.showVal="",this.editVal={url:"",method:"get",exceptionStrategy:"throw",fields:"",containsKey:1,pagination:0,dataType:"",defaultLoad:!0,commonFlag:!0,requestPayload:{},responseSchema:{},variables:[],quickSelect:{},historySelect:[],isQuickSelect:!1,totalFields:[],metaData:"{}"},this.commonResetData(this.ownSign),this.setMetaData()},handleConfigTypeChange:function(e){var t=this,a=this.configTypes.find((function(e){return e.value===t.configType}))||this.configTypes[0];if(this.configApi=a.api,this.configType=a.value,this.showTest=!1,this.viewMode=1,this.paramsArr=[],this.intanceList=[],this.isList)this.collapseValue="filter",!0!==e&&this.recoverDefaultKey(["objectIdEditVal","objectType"]);else if(this.collapseValue="param",!0!==e){this.recoverDefaultKey(["filterArr","subFilterArr","orderByArr","pagination","objectType"])}},onAlertClose:function(){},handleSwitchViewMode:function(e){if(this.showTest=!1,2===e)this.viewMode=e,this.jsonValueHandler();else if(this.isCorrectJsonValue())this.viewMode=e;else{try{var t,a,i;(null===(t=this.$refs.viewModeRadio)||void 0===t||null===(a=t.$children[0])||void 0===a||null===(i=a.$el)||void 0===i?void 0:i.getElementsByTagName("input")[0]).checked=!1}catch(e){}this.viewMode=2}},getEditValue:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",a=/\$\{(.*?)\}/g,i=a.exec(t);return(null==i?void 0:i[0])===t?{static:"",type:"variable",variable:null===(e=i[1])||void 0===e?void 0:e.split(".")}:{static:t,type:"static",variable:[]}},setCommonParamsKeys:function(e){this.commonParamsKeys=e},refreshUrl:function(e){this.showTest=!1;var t=this.objectType,a=x(x({},this.commonSetParams),this.commonLinkSet),i=this.pagination,n=[],r=["fields","containsKey","pagination","dataType","defaultLoad","commonFlag"];for(var o in t.value&&n.push("objectType=".concat(t.value)),a)r.includes(o)?this.editVal[o]=a[o]:null!==a[o]&&void 0!==a[o]&&n.push("".concat(o,"=").concat(a[o]));this.projectIdentifier&&n.push("projectIdentifier=".concat(this.projectIdentifier)),n.push("pagination=".concat(this.commonLinkSet.pagination)),this.commonLinkSet.pagination&&(i.page&&n.push("$page=".concat(i.page)),i.pageSize&&n.push("$pageSize=".concat(i.pageSize)));var l=this.getAllQueryData(!0);if(l&&n.push(l),this.editVal.url=this.configApi+(n.length?"?"+n.join("&"):""),!this.isList){var s=this.objectIdEditVal.value;s&&(this.editVal.url=this.editVal.url.replace("{id}",s),this.editVal.id=s)}this.showTest||2!==this.viewMode||this.jsonValueHandler()},reverseParams:function(e){var t=this;this.subFilterArr=[],this.filterArr=[],this.orderByArr=[];var a={};for(var i in e){if(i.indexOf("$subFilter")>-1){var n=i.replace("$subFilter","");isNaN(n)||(a[n]||(a[n]={}),a[n].filter=e[i])}if(i.indexOf("$subFilterField")>-1){var r=i.replace("$subFilterField","");isNaN(r)||(a[r]||(a[r]={}),a[r].field=e[i])}}for(var o in a){var l=a[o];l.filter&&l.field&&this.subFilterArr.length<5&&this.subFilterArr.push(l)}var s=e.$filter,c=e.$orderBy;if(s.length)if("complex"===e.filterType)this.filterArr=this.complexFilterStrToArr(s);else{s.split(",").forEach((function(e){t.filterArr.push(t.getFiledByFilterStr(e))}))}if(c.length){var u=c.split(",").map((function(e){var t=e.trim().split(" ");return{attr:t[0]||"",sort:t[1]||""}}));this.orderByArr=u.length?u:[{attr:"",sort:"asc"}]}},getFilterData:function(){var e="";return"complex"===this.commonSetParams.filterType?(e=this.getComplexFilter(this.filterArr),this.filterString=e):this.filterArr.filter((function(e){return e.name})).forEach((function(t,a){var i;e+="".concat(a?",":"").concat(t.name," ").concat(t.logicExp," ").concat(null!==(i=t.value)&&void 0!==i?i:"")})),{$filter:e}},getSubFilterData:function(){var e={};return this.subFilterArr.filter((function(e){return e.filter&&e.field})).forEach((function(t,a){e["$subFilter".concat(a+1)]=t.filter,e["$subFilterField".concat(a+1)]=t.field})),e},getOrderData:function(){var e="";return this.orderByArr.filter((function(e){return e.attr&&e.sort})).forEach((function(t,a){e+="".concat(a?",":"").concat(t.attr," ").concat(t.sort)})),{$orderBy:e}},getAllQueryData:function(e){var t=this.getFilterData(),a=this.getSubFilterData(),i=this.getOrderData(),n=x(x(x({},t),a),i);if(e){var r=[];for(var o in n)n[o]&&r.push("".concat(o,"=").concat(n[o]));return r.join("&")}return n},handleTest:function(){if(this.isCorrectJsonValue()){var e=this.getHandlerEditVal();e.requestParams={},this.paramsArr=[];var t=/\$\{(.*?)\}/g,a=this.objectType.value;for(var i in t.test(a)&&(this.paramsArr.push({name:"objectType",value:a}),t.lastIndex=0),this.commonSetParams)t.test(this.commonSetParams[i])&&(this.paramsArr.push({name:i,value:this.commonSetParams[i]}),t.lastIndex=0);if(this.isList){if(!this.objectType.value)return void this.$message.warning("请选择对象类型");(this.pagination.page||0===this.pagination.page)&&(e.requestParams.$page=this.pagination.page),(this.pagination.pageSize||0===this.pagination.pageSize)&&(e.requestParams.$pageSize=this.pagination.pageSize)}else{var n=this.objectIdEditVal.value;if(!n)return void this.$message.warning("请配置对象实例id");t.test(n)&&this.paramsArr.push({name:"id",value:n})}this.configToTest=e,this.showTest=!0}},testChangeField:function(e){this.editVal.fields=e.join(","),this.initCommonLinkSet(this.editVal)},handleTotalColsChange:function(){},beforeTest:function(e,t){if(this.isList){var a=this.objectType.value.match(/\$\{(.*?)\}/g);if(a){var i=t.find((function(e){return e.name===a[0]}));return!(!i||!i.value)||(this.$message.warning("请填写对象类型变量值"),!1)}return!0}return!0},testDialogClose:function(){this.showTest=!1},objectTypeOnChange:function(e){this.refreshUrl()},objectIdOnChange:function(e){this.refreshUrl()},previewFilterStrChange:function(){this.filterArr=this.complexFilterStrToArr(this.filterString)}}},E=(a("1d73"),Object(f.a)(j,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"object-link-editor"},[e.showInput?t("el-input",{staticClass:"editor-input",attrs:{placeholder:e.placeholder,value:e.showVal,readonly:"",size:"mini",clearable:""},nativeOn:{click:function(t){return e.handleIconClick.apply(null,arguments)}}},[t("i",{staticClass:"el-input__icon array-editor-icon",class:e.iconClass,attrs:{slot:"suffix"},slot:"suffix"})]):e._e(),t("el-drawer",{ref:"editorDrawer",attrs:{"custom-class":"object-link-editor-drawer",size:"1200px",visible:e.dialogVisible,direction:"rtl",wrapperClosable:!1,"append-to-body":!0,"show-close":!1},on:{"update:visible":function(t){e.dialogVisible=t},close:e.close}},[t("div",{staticClass:"editor-drawer-title",attrs:{slot:"title"},slot:"title"},[t("div",{staticClass:"title-text"},[t("iconfont",{attrs:{type:"icon-close"},on:{click:e.close}}),e._v("\n        对象类型配置\n        "),t("a",{directives:[{name:"show",rawName:"v-show",value:e.objectTipsLoaded&&e.objectTipsLoaded.description,expression:"objectTipsLoaded && objectTipsLoaded.description"}],attrs:{href:e.objectTipsLoaded&&e.objectTipsLoaded.description,target:"_blank"}},[t("i",{staticClass:"el-icon-question"})])],1),t("div",{staticClass:"title-btn"},[t("el-button",{attrs:{size:"small"},on:{click:e.clear}},[e._v(" 清空 ")]),t("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.clickSure}},[e._v("\n          提交\n        ")])],1)]),t("div",{staticClass:"object-link-editor-content",attrs:{"comp-uid":e.compUid}},[e.dialogVisible?t("control-common-alert",{staticClass:"api-link-alert",attrs:{show:!e.showCloseTips},on:{showCloseTips:function(t){e.showCloseTips=!0}}},[t("div",{domProps:{innerHTML:e._s(e.objectTipsLoaded&&e.objectTipsLoaded.value)}})]):e._e(),t("div",{directives:[{name:"show",rawName:"v-show",value:!e.showTest,expression:"!showTest"}]},[t("el-tabs",{on:{"tab-click":e.handleConfigTypeChange},model:{value:e.configType,callback:function(t){e.configType=t},expression:"configType"}},e._l(e.configTypes,(function(e){return t("el-tab-pane",{key:e.value,attrs:{label:e.label,name:e.value}})})),1)],1),t("div",{directives:[{name:"show",rawName:"v-show",value:!e.showTest,expression:"!showTest"}],staticClass:"object-link-tab-content"},[t("div",{staticClass:"tab-left"},[t("el-radio-group",{on:{change:e.objectSelectTypeChange},model:{value:e.objectType.type,callback:function(t){e.$set(e.objectType,"type",t)},expression:"objectType.type"}},e._l(e.objectTypeSelect,(function(a){return t("el-radio",{key:a.value,attrs:{label:a.value}},[e._v(e._s(a.label))])})),1)],1),t("div",{staticClass:"hc-view-switch hc-view-switch-api-link"},[t("div",[t("el-radio-group",{ref:"viewModeRadio",on:{change:e.handleSwitchViewMode},model:{value:e.viewMode,callback:function(t){e.viewMode=t},expression:"viewMode"}},[t("el-radio-button",{attrs:{label:1}},[e._v("普通视图")]),t("el-radio-button",{attrs:{label:2}},[e._v("JSON视图")])],1)],1),t("div",[t("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.showTest,expression:"!showTest"}],attrs:{type:"info"},on:{click:e.handleTest}},[e._v("测 试")])],1)])]),t("div",{staticClass:"editor-content_wrap"},[t("div",{directives:[{name:"show",rawName:"v-show",value:!e.showTest&&"static"===e.objectType.type,expression:"!showTest && objectType.type === 'static'"}],staticClass:"left-tree-wrap"},[t("objectTypeTree",{on:{change:e.objectTypeTreeChange},model:{value:e.objectType.value,callback:function(t){e.$set(e.objectType,"value",t)},expression:"objectType.value"}})],1),t("div",{staticClass:"right-content-wrap",class:{"right-content-wrap_full":e.showTest||"variable"===e.objectType.type}},[1===e.viewMode?t("div",{directives:[{name:"show",rawName:"v-show",value:!e.showTest,expression:"!showTest"}],staticClass:"hc-view-switch-content"},[t("el-collapse",{staticClass:"hc-view-switch-content-collapse",attrs:{accordion:""},model:{value:e.collapseValue,callback:function(t){e.collapseValue=t},expression:"collapseValue"}},[e._l(e.paramsSettingItems,(function(a){return[!1!==a.visible?t("el-collapse-item",{key:a.id,class:{"filter-collapse-item":"filter"===a.id},attrs:{name:a.id}},[t("template",{slot:"title"},[t("div",{staticClass:"hc-view-switch-content-collapse-title"},[t("div",[t("span",[e._v(" "+e._s(a.label)+" ")]),t("basic-tips",{attrs:{type:"popover",title:"配置说明",width:600,placement:"bottom-start",iconStyle:{color:"#C9D0D4"},content:""}},[t("ul",{staticClass:"basic-tip-content-ul"},e._l(a.tips,(function(a){return t("li",{key:a},[e._v("\n                              "+e._s(a)+"\n                            ")])})),0)])],1),t("div",[e._v("\n                        已配置\n                        "),t("span",{style:{color:e.themeColor}},[e._v(e._s(a.count))]),e._v("\n                        项\n                      ")])])]),"subFilter"===a.id?t("sub-filter",{on:{change:e.refreshUrl},model:{value:e.subFilterArr,callback:function(t){e.subFilterArr=t},expression:"subFilterArr"}}):"filter"===a.id?t("api-filters-select",{attrs:{showIn:!0,showLeftlike:!0,filterType:e.commonSetParams.filterType},on:{change:e.refreshUrl},model:{value:e.filterArr,callback:function(t){e.filterArr=t},expression:"filterArr"}},[t("div",{staticStyle:{padding:"8px 0px"}},[t("span",[e._v("条件类型：")]),t("el-radio-group",{on:{change:e.refreshUrl},model:{value:e.commonSetParams.filterType,callback:function(t){e.$set(e.commonSetParams,"filterType",t)},expression:"commonSetParams.filterType"}},[t("el-radio",{attrs:{label:"and"}},[e._v("and")]),t("el-radio",{attrs:{label:"or"}},[e._v("or")]),t("el-radio",{attrs:{label:"complex"}},[t("basic-tips",{attrs:{type:"popover",title:"配置说明",width:600,placement:"bottom-start",content:"",iconStyle:{color:"#C9D0D4"}}},[t("ul",{staticClass:"basic-tip-content-ul"},[t("li",[e._v("complex类型: $filter 为and、or和()自由组合条件")])])]),e._v("\n                          complex\n                        ")],1)],1),"complex"===e.commonSetParams.filterType?t("el-input",{attrs:{type:"textarea",rows:3},on:{clear:e.previewFilterStrChange,blur:e.previewFilterStrChange},nativeOn:{keyup:function(t){return e.previewFilterStrChange.apply(null,arguments)}},model:{value:e.filterString,callback:function(t){e.filterString=t},expression:"filterString"}}):e._e()],1)]):"sort"===a.id?t("orderby-setting",{attrs:{isShowDeleteConfirm:e.isShowDeleteConfirm},on:{change:e.refreshUrl},model:{value:e.orderByArr,callback:function(t){e.orderByArr=t},expression:"orderByArr"}}):"param"===a.id?t("common-set",{attrs:{configType:e.configType,pagination:e.commonLinkSet.pagination},on:{change:e.refreshUrl,validKeys:e.setCommonParamsKeys},model:{value:e.commonSetParams,callback:function(t){e.commonSetParams=t},expression:"commonSetParams"}}):e._e()],2):e._e()]}))],2),t("el-form",{attrs:{"label-width":"120px"}},[t("el-form-item",{attrs:{label:"对象类型"}},[t("label",{attrs:{slot:"label"},slot:"label"},[t("span",[e._v("对象类型")]),t("basic-tips",{attrs:{type:"popover",title:"配置说明",width:600,placement:"bottom-start",content:""}},[t("ul",{staticClass:"basic-tip-content-ul"},[t("li",[e._v("可在左侧对象类型树选择")]),e.isList?e._e():t("li",[e._v("默认是去instance表查询")]),e.isList?e._e():t("li",[e._v("对象类型定义为分表存储时必填，此处类型为寻找分表不参与数据过滤")])])])],1),t("variable-editor-components",{attrs:{compoundItem:e.compoundItem,data:e.objectType,args:e.newArgs},on:{change:e.objectTypeOnChange}})],1),e.isList?e._e():t("el-form-item",{attrs:{label:"对象实例id"}},[t("variable-editor-components",{ref:"variableEditor",attrs:{compoundItem:e.compoundItem,data:e.objectIdEditVal,args:e.newArgs,staticType:"static"===e.objectType.type?"virtualSelect":"static"},on:{onSure:e.variableOnSure,change:e.objectIdOnChange}})],1),t("common-link-set",{attrs:{config:e.commonLinkSet,data:e.data,"show-tips":!1,hiddenConfig:{pagination:!e.isList},emitChangeFiled:["containsKey","defaultLoad","commonFlag","fieldsArr","pagination"]},on:{change:e.refreshUrl}},[t("template",{slot:"pagination"},[t("pagination-setting",{directives:[{name:"show",rawName:"v-show",value:e.commonLinkSet.pagination&&e.isList,expression:"commonLinkSet.pagination && isList"}],ref:"paginationSetting",staticClass:"hc-view-switch-content-pagination",on:{change:e.refreshUrl},model:{value:e.pagination,callback:function(t){e.pagination=t},expression:"pagination"}})],1)],2)],1)],1):e._e(),t("div",{directives:[{name:"show",rawName:"v-show",value:!e.showTest&&2===e.viewMode,expression:"!showTest && viewMode === 2"}],staticClass:"hc-view-switch-content-json"},[t("base-code-editor",{ref:"codeEditorJSON",attrs:{params:e.codeJSONOptions,value:e.jsonValue,height:"100%"},on:{blur:e.codeEditorJSONBlur}})],1),t("div",{staticClass:"api-test-panel-wrap"},[e.showTest?t("api-test-panel",{ref:"apiTestPanel",attrs:{"origin-config":e.configToTest,payload:[],paramsArr:e.paramsArr,filterArr:e.filterArr,orderByArr:e.orderByArr,pagination:e.pagination,isPagination:!(!e.commonLinkSet.pagination||!e.isList),fields:e.commonLinkSet.fields,dataType:e.data.type,beforeTest:e.beforeTest},on:{totalColsChange:e.handleTotalColsChange,changeFields:e.testChangeField,close:e.testDialogClose}}):e._e()],1)])])],1)])],1)}),[],!1,null,null,null));t.default=E.exports},"3c84":function(e,t,a){},"3e19":function(e,t,a){"use strict";var i=(a("8e6e"),a("456d"),a("bd86")),n=(a("7f7f"),a("ac6a"),a("c5f6"),a("c276")),r=a("a542"),o=a("b19c");function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){Object(i.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var c={name:"ComplexGroup",props:{level:{type:Number,default:0},parent:{type:Object,default:function(){}},data:{type:Object,default:function(){}},index:{type:Number,default:0},len:{type:String,default:""},expandable:{type:Boolean,default:!1},attrName:{type:String,default:""}},data:function(){return{customGroupNames:{},isExpand:this.expandable,copyData:Object(o.e)(this.data)}},computed:{attributes:function(){return this.parent&&this.parent.attributes},showHeader:function(){return"array"===Object(o.g)(this.attributes)&&this.attributes.length>0},showContent:function(){return"array"!==Object(o.g)(this.attributes)||!!(this.attributes.length>0&&this.isExpand)},readonly:function(){return!!this.parent.readonly},editable:function(){return!1!==this.parent.editable},styles:function(){var e={};return"array"===Object(o.g)(this.attributes)&&(e["padding-left"]="5px",e["padding-right"]="5px",e["border-color"]=Object(n.nb)("borderColor"),e["border-width"]=Object(n.nb)("borderWidth"),e["border-style"]=Object(n.nb)("borderStyle"),e["border-radius"]=Object(n.nb)("borderRadius"),e["background-color"]=Object(n.nb)("middleBackgroundColor"),this.attributes.length-1!==this.index&&(e["margin-bottom"]="10px")),e},titleStyles:function(){return{color:Object(n.nb)("color")}},componentFid:function(){var e=this.$store.getters.pageEditor;return e.pagesKV[e.pagesActiveName].activeComponentFid},titleVisibleAttr:function(){for(var e in this.data){var t=this.data[e];if(t.titleVisible)return t}return null},groupName:function(){if(this.titleVisibleAttr){var e=Object(n.pb)(this.titleVisibleAttr.value,this.titleVisibleAttr.default),t=new r.a(this.titleVisibleAttr.type),a=t.getBaseType();if(Object(n.rb)(e))return"";if("Enum"!==a)return t.destroy(),e;var i=t.getAttach(),o="";return i&&i.length&&i.forEach((function(t){t.value===e&&(o=t.label)})),t.destroy(),o||e}return""}},mounted:function(){this.init()},methods:{checkIsLastValidateItem:function(){return 1===(this.attributes||[]).filter((function(e){return!e.pageComponentName||!e.pageComponentName.hidden})).length},init:function(){var e=this;this.$nextTick((function(){"array"===Object(o.g)(e.attributes)&&e.$bus.$emit("complexCreated",{context:e,attr:e.data,attrs:e.attributes})}))},handleRemove:function(){var e=this;!1!==this.handleBus("remove",this.attributes[this.index],this.attributes,(function(){e.handleDel()}))&&this.$confirm("确定要删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.handleBus("removeBefore",e.attributes[e.index],e.attributes,(function(){}),e.attrName),e.handleDel(),e.handleBus("removeAfter",e.attributes[e.index],e.attributes,(function(){}),e.attrName)})).catch((function(){}))},handleDel:function(){var e=this.attributes.splice(this.index,1);this.commitDeleteCustomGroupNames(e[0])},handleUp:function(){if(0!==this.index){var e=this.attributes.splice(this.index,1);this.attributes.splice(this.index-1,0,e[0])}},handleDown:function(){if(this.index!==this.attributes.length-1){var e=this.attributes.splice(this.index,1);this.attributes.splice(this.index+1,0,e[0])}},handleExpand:function(){this.isExpand=!this.isExpand},handleAdd:function(){this.handleAddItem()},handleAddItem:function(){var e,t,a,i=this,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o=this.getNewVal(r),l=[],s=[];this.attributes.forEach((function(e){var t,a,i,n=null==e||null===(t=e.customMethodsSetting)||void 0===t||null===(a=t.editValue)||void 0===a?void 0:a.functionName;n&&l.push({name:n});var r=null==e||null===(i=e.name)||void 0===i?void 0:i.value;r&&s.push({name:r})}));var c=null==o||null===(e=o.customMethodsSetting)||void 0===e||null===(t=e.editValue)||void 0===t?void 0:t.functionName;if(c&&null!=l&&l.length){var u=Object(n.X)(l,c);if(u){var d,p,h,f="method: $_".concat(u);null!=o&&null!==(d=o.customMethodsSetting)&&void 0!==d&&null!==(p=d.attributes)&&void 0!==p&&p.functionName&&(o.customMethodsSetting.attributes.functionName.lastValue=u,o.customMethodsSetting.attributes.functionName.value=u),o.customMethodsSetting.lastValue=f,o.customMethodsSetting.value=f,null!=o&&null!==(h=o.name)&&void 0!==h&&h.default&&(o.name.default=u),o.customMethodsSetting.editValue.functionName=u}}var m=null==o||null===(a=o.name)||void 0===a?void 0:a.value;if(m&&null!=s&&s.length){var v=Object(n.X)(s,m);v&&(o.name.lastValue=v,o.name.value=v)}var b=this.handleBus(r?"copy":"add",o,this.attributes,(function(){i.attributes.splice(i.index+1,0,o)}),this.attrName);if(!1!==b){var g=n.a.MAX_LENGTH_ADD;"*"===this.len&&this.attributes.length>=g?this.$message.warning("超过系统允许的最大个数"+g+"！"):"*"!==this.len&&this.attributes.length>=this.len?this.$message.warning("超过组件属性设置允许的最大个数"+this.len+"！"):(o.hasOwnProperty("isObject")&&!o.isObject.hasOwnProperty("value")&&(o.objectAttr.visible=!1,o.objectAttr.attributes.length>1&&o.objectAttr.attributes.splice(1,o.objectAttr.attributes.length-1),o.objectAttr.attributes.forEach((function(e){for(var t in e)if(Object.hasOwnProperty.call(e,t)){delete e[t].value}}))),this.attributes.splice(this.index+1,0,o))}},handleCopy:function(){this.handleAddItem(!0)},handleBus:function(e,t,a,i,n){var r={returnValue:!0,context:this,index:this.index,type:e,attr:t,attrs:a,callback:i,attrName:n};return this.$bus.$emit("complexClick",r),r.returnValue},getNewVal:function(e){var t,a,i=this,r=s({},this.copyData);this.copyData.customMethodsSetting&&null!==(t=this.copyData)&&void 0!==t&&null!==(a=t.name)&&void 0!==a&&a.default&&(r.name.default="");var l=Object(o.e)(e?this.data:r),c=Object(n.ob)();return function t(a){var n=Object(o.g)(a);if("array"===n)a.forEach((function(e){t(e)}));else if("object"===n)for(var r in a){var l=a[r];if(l.fid=c,!e){if(i.$removeAttr(l,"value"),i.$removeAttr(l,"editValue"),i.$removeAttr(l,"lastValue"),i.$removeAttr(l,"editorChanged"),i.$removeAttr(l,"visibleChanged"),i.$removeAttr(l,"readonlyChanged"),i.$removeAttr(l,"typeChanged"),i.$removeAttr(l,"linkConfig"),"executionContent"===r){var s=a.executionType,u=s&&s.default;l.editor=u||l.editor}a.hasOwnProperty("validateType")&&(l.hasOwnProperty("defaultVisible")?i.$setAttr(l,"visible",l.defaultVisible):i.$removeAttr(l,"visible"),l.hasOwnProperty("validateDefaultType")&&(i.$setAttr(l,"type",l.validateDefaultType),i.$removeAttr(l,"editor")))}l.customGroupName&&i.setCustomGroupNames(l.customGroupName,l);var d=l.attributes;if(d&&(t(d),Array.isArray(d)&&!e)){var p=d.every((function(e){return e.hasOwnProperty("pageComponentName")?!e.pageComponentName.hasOwnProperty("value")||""===e.pageComponentName.value:!e.hasOwnProperty("pageComponentName")}));null!=l&&l.readonly||!p||null==d||!d.length||d.splice(0,d.length-1)}}}(l),this.commitSetCustomGroupNames(),l},setCustomGroupNames:function(e,t){var a=this.customGroupNames[e];a||(a=this.customGroupNames[e]=[]),a.push(t)},commitSetCustomGroupNames:function(){var e,t=(null===(e=this.data.pageComponentName)||void 0===e?void 0:e.componentFid)||this.componentFid;this.$store.commit("SET_CUSTOM_GROUP_NAMES",{fid:t,data:this.customGroupNames}),this.customGroupNames={}},commitDeleteCustomGroupNames:function(e){var t={};for(var a in e){var i=e[a],n=i.customGroupName;n&&(t[n]||(t[n]=[]),t[n].push(i))}this.$store.commit("DELETE_CUSTOM_GROUP_NAMES",{fid:this.componentFid,data:t}),this.$message.success("删除成功！")}}},u=(a("17fe"),a("2877")),d=Object(u.a)(c,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"complex-group",style:e.styles},[e.showHeader?t("div",{staticClass:"complex-group-header"},[t("div",{staticClass:"complex-group-title"},[!e.readonly&&e.editable?t("el-button",{attrs:{title:"增加一组",size:"mini",icon:"el-icon-plus",type:"primary",plain:""},on:{click:function(t){return t.stopPropagation(),e.handleAdd.apply(null,arguments)}}}):e._e(),!e.readonly&&e.editable?t("el-button",{attrs:{title:"复制一组",size:"mini",icon:"el-icon-document-copy",type:"primary",plain:""},on:{click:function(t){return t.stopPropagation(),e.handleCopy.apply(null,arguments)}}}):e._e(),t("span",{staticClass:"complex-group-name",style:e.titleStyles,attrs:{title:e.groupName}},[e._v(e._s(e.groupName))])],1),t("div",{staticClass:"complex-group-actions"},[!e.readonly&&e.editable?t("el-button",{attrs:{title:"删除",size:"mini",icon:"el-icon-close",disabled:e.checkIsLastValidateItem(),plain:""},on:{click:function(t){return t.stopPropagation(),e.handleRemove.apply(null,arguments)}}}):e._e(),!e.readonly&&e.editable?t("el-button",{attrs:{title:"上移",size:"mini",icon:"el-icon-top",disabled:0===e.index||e.checkIsLastValidateItem(),plain:""},on:{click:function(t){return t.stopPropagation(),e.handleUp.apply(null,arguments)}}}):e._e(),!e.readonly&&e.editable?t("el-button",{attrs:{title:"下移",size:"mini",icon:"el-icon-bottom",disabled:e.index===e.attributes.length-1||e.checkIsLastValidateItem(),plain:""},on:{click:function(t){return t.stopPropagation(),e.handleDown.apply(null,arguments)}}}):e._e(),t("el-button",{attrs:{title:"折叠/展开",size:"mini",icon:e.isExpand?"el-icon-arrow-down":"el-icon-arrow-right",plain:""},on:{click:function(t){return t.stopPropagation(),e.handleExpand.apply(null,arguments)}}})],1)]):e._e(),t("div",{directives:[{name:"show",rawName:"v-show",value:e.showContent,expression:"showContent"}],staticClass:"complex-group-content"},[e._t("default")],2)])}),[],!1,null,"b6e4c350",null);t.a=d.exports},"3f89":function(e,t,a){"use strict";a("032c")},"431e":function(e,t,a){"use strict";a("c68f")},"446d":function(e,t,a){},"446e":function(e,t,a){},"44cb":function(e,t,a){"use strict";a.r(t);var i=(a("7514"),a("ac6a"),a("c5f6"),a("04c8")),n=a("36f0"),r=a("b19c"),o=a("c276"),l={name:"VariableLinkEditor",alias:"变量",command:"variable-link",components:{VariablePanel:i.a},mixins:[n.a],props:{title:{type:String,default:"变量关联配置"},visible:{type:String,default:function(){return!1}},showInput:{type:String,default:function(){return!0}},iconClass:{type:String,default:function(){return"el-icon-edit"}},data:{type:Object,default:function(){return{alias:"",type:"",default:"",value:"",primitiveLabels:""}}},placeholder:{type:String,default:""},autoSetValue:{type:Boolean,default:!0},linkType:{type:Number,default:function(){return 1}},handleRulesResult:{type:Function,default:function(){}},handleChangeResult:{type:Function,default:function(){}}},computed:{excludes:function(){var e=this.$store.getters.pageEditor,t=e&&e.pagesKV[e.pagesActiveName];return["Page","Arguments","pageVariable","customVariable","Response","Request",t?t.page.fid:""]},inputPlaceholder:function(){return"variable"===this.editValType?"点击选择":"请输入内容"}},data:function(){return{showVal:"",editVal:{accessType:"variable",linkType:this.linkType,type:"variable",static:"",variable:[],useExpression:!1},dialogVisible:!1,editValType:"variable",editValStaticVar:""}},watch:{dialogVisible:{handler:function(e){e&&this.initData()},immediate:!0},"data.value":function(){this.initData()},visible:{handler:function(e){var t=this;e&&this.initData(),this.$nextTick((function(){t.dialogVisible=e}))},immediate:!0},editValStaticVar:{handler:function(e){"variable"!==this.editValType&&(this.editVal.static=e)},immediate:!1}},created:function(){this.initData()},methods:{changeVariable:function(e){if(!(e.length<1)){var t=e.join(".");this.editValStaticVar="${".concat(t,"}")}},changetype:function(e){var t,a;this.editVal.useExpression="useExpression"===e,"variable"===e?(this.editVal.type=e,this.editValStaticVar=this.editVal.variable.length>0?"${".concat(this.editVal.variable.join("."),"}"):""):(this.editVal.type="static",this.editValStaticVar=(null===(t=this.data.linkConfig)||void 0===t?void 0:t.useExpression)===this.editVal.useExpression?null===(a=this.data.linkConfig)||void 0===a?void 0:a.static:"")},initData:function(){var e=this,t=this.data.linkConfig;if(t&&"variable"===t.accessType){for(var a in t)this.editVal[a]=Object(r.e)(t[a]);this.editVal.variable&&this.editVal.variable.length&&(this.editVal.variable=this.compatible(this.editVal.variable)),this.showVal=this.getCommonShowVal("variable",this.editVal)}this.$nextTick((function(){"variable"===e.editVal.type?(e.editValType=e.editVal.type,e.editValStaticVar=e.editVal.variable.length>0?"${".concat(e.editVal.variable.join("."),"}"):""):(e.editValType=e.editVal.useExpression?"useExpression":"static",e.editValStaticVar=e.editVal.static)}))},compatible:function(e){var t=this,a=[];return e.forEach((function(e){t.excludes.find((function(t){return t===e}))||a.push(e)})),a},resetData:function(){this.showVal="",this.editVal={accessType:"variable",linkType:this.linkType,type:"variable",static:"",variable:[],useExpression:!1},this.commonResetData()},handleIconClick:function(){this.open()},open:function(){this.$setAttr(this.data,"editorDialogVisible",!0)},close:function(){this.dialogVisible=!1,this.closeHandler("variable")},clear:function(){this.clearByType("variable")},cancel:function(){this.close()},getShowVal:function(){return"${"+this.editVal.variable.join(".")+"}"},clickSure:function(){"variable"===this.editVal.type?this.editVal.static="":this.editVal.variable=[],this.commonSureHandler("variable")},getHandlerEditVal:function(){return Object(r.e)(this.editVal)},validate:function(){return"variable"===this.editVal.type&&0===this.editVal.variable.length?"请选择变量":"static"!==this.editVal.type||this.editVal.static?!("static"===this.editVal.type&&this.editVal.static.length>o.a.PAYLOAD_NAME_MAX_LENGTH)||"字符的长度不能超过"+o.a.PAYLOAD_NAME_MAX_LENGTH:"请手动输入"}}},s=(a("fe2b"),a("2877")),c=Object(s.a)(l,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"variable-link-editor"},[t("el-popover",{ref:"popover",attrs:{title:e.title,"popper-class":"variable-link-editor-dialog",placement:"bottom",width:"600"},on:{hide:e.close},model:{value:e.dialogVisible,callback:function(t){e.dialogVisible=t},expression:"dialogVisible"}},[t("el-input",{staticClass:"input-with-select",attrs:{placeholder:e.inputPlaceholder,readonly:"variable"===e.editValType},model:{value:e.editValStaticVar,callback:function(t){e.editValStaticVar=t},expression:"editValStaticVar"}},[t("el-select",{attrs:{slot:"prepend",placeholder:"请选择"},on:{change:e.changetype},slot:"prepend",model:{value:e.editValType,callback:function(t){e.editValType=t},expression:"editValType"}},[t("el-option",{attrs:{label:"变量选择",value:"variable"}}),t("el-option",{attrs:{label:"手动输入",value:"static"}}),t("el-option",{attrs:{label:"表达式",value:"useExpression"}})],1)],1),t("el-collapse-transition",["variable"===e.editValType?t("variable-panel",{attrs:{args:this.args,data:e.data,showIframes:!1},on:{change:e.changeVariable},model:{value:e.editVal.variable,callback:function(t){e.$set(e.editVal,"variable",t)},expression:"editVal.variable"}}):e._e()],1),"useExpression"===e.editValType?t("el-alert",{staticStyle:{"margin-top":"20px"},attrs:{title:"支持js表达式语法，支持混合使用变量，${...}是对变量的引用，其中...为变量名",type:"info","show-icon":"",closable:!1}}):e._e(),t("div",{staticClass:"dialog-footer"},[t("el-button",{attrs:{type:"danger"},on:{click:e.clear}},[e._v("清 空")]),t("el-button",{on:{click:e.cancel}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.clickSure}},[e._v("确 定")])],1),t("el-input",{staticClass:"editor-input",attrs:{slot:"reference",placeholder:e.placeholder,value:e.showVal,readonly:"",size:"mini",clearable:""},slot:"reference"},[t("i",{staticClass:"el-input__icon variable-editor-icon",class:e.iconClass,attrs:{slot:"suffix"},slot:"suffix"})])],1)],1)}),[],!1,null,"6bf77d47",null);t.default=c.exports},"45e0":function(e,t,a){"use strict";a.r(t),a("8e6e"),a("456d");var i=a("bd86"),n=(a("6762"),a("7f7f"),a("7514"),a("ac6a"),a("b19c"));function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){Object(i.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}t.default=function(){var e=[],t={},i=a("fe88");return i.keys().forEach((function(a,r){var l=/\.\/([^/]+)\/(.+)\.(js|vue)/g.exec(a),s=l[1],c=l[3];if("js"!==t[s]){var u=i(a).default;if(!["TempVariableLinkEditor","NewIndicatorLinkEditor","DeviceLinkEditor"].find((function(e){return u.name===e}))){var d=Object(n.h)(window.location.href,"assetsId"),p=Object(n.h)(window.location.href,"projectId"),h=Object(n.h)(window.location.href,"isProjectPage"),f=["ApiLinkEditor","IndicatorLinkEditor","RtdataLinkEditor","SqlLinkEditor"],m=d&&p||h;if((!h||!f.includes(u.name))&&(!["AssetsLinkEditor","AlarmLinkEditor"].includes(u.name)||m)&&(!m||!f.includes(u.name))){var v=Object(n.h)(window.location.href,"templateId"),b=Object(n.h)(window.location.href,"templateIdentifier");("TemplatesLinkEditor"!==u.name||v&&b)&&(v&&b&&["ApiLinkEditor","IndicatorLinkEditor","RtdataLinkEditor","SqlLinkEditor"].includes(u.name)||(e.push(o({},u)),t[s]=c))}}}})),e}()},4702:function(e,t,a){"use strict";a("7f7f");var i=(a("8e6e"),a("6762"),a("2fdb"),a("96cf"),a("3b8d")),n=(a("f559"),a("ac6a"),a("456d"),a("bd86")),r=a("967e"),o=a.n(r),l=a("b19c"),s=a("2f62"),c=(a("7514"),function(){var e=this,t=e._self._c;return t("div",{staticStyle:{width:"100%"}},[t("table",{directives:[{name:"theme",rawName:"v-theme",value:e.themeStyles,expression:"themeStyles"}],staticClass:"hc-editor-payload-table"},[t("thead",{staticClass:"hc-editor-payload-table-thead",style:e.theadStyles},[e._m(0)]),t("tbody",{staticClass:"hc-editor-payload-table-tbody"},e._l(e.value,(function(a,i){return t("tr",{key:i},[t("td",[t("el-select",{ref:"treeSelect",refInFor:!0,class:{validate:!a.dictIdentifier},staticStyle:{width:"100%"},attrs:{value:e.getDictValue(a.dictIdentifier),"value-key":a.dictIdentifier,clearable:""},on:{clear:function(t){return e.handleSelectClear(a)}}},[t("el-option",{attrs:{hidden:"",value:a.dictIdentifier,id:"tree-option",created:""}}),t("el-tree",{attrs:{"expand-on-click-node":!1,"current-node-key":a.dictIdentifier,props:{label:"name",value:"identifier"},data:e.dictOptions},on:{"node-click":function(t){return e.onTreeSelectClick(a,i,t)}}})],1)],1),t("td",[t("el-input",{class:{validate:!a.dictKey},attrs:{placeholder:"请输入"},model:{value:a.dictKey,callback:function(t){e.$set(a,"dictKey",t)},expression:"param.dictKey"}})],1),t("td",[t("el-input",{attrs:{placeholder:"请输入"},model:{value:a.dictKeyName,callback:function(t){e.$set(a,"dictKeyName",t)},expression:"param.dictKeyName"}})],1),t("td",{staticClass:"hc-payload-operation",attrs:{align:"center"}},[t("CommonTableMoveOprate",{attrs:{data:e.value,index:i,icon:!1,text:!0,layout:"top, bottom, del, clear"},on:{click:e.handleEventContent}})],1)])})),0)]),t("div",{staticClass:"params-add-btn"},[t("el-button",{attrs:{title:"添加维度",icon:"el-icon-plus",plain:""},on:{click:function(t){return e.handleEventContent("add")}}},[e._v("添加扩展维度")])],1)])}),u=a("c276");function d(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function p(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?d(Object(a),!0).forEach((function(t){Object(n.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):d(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var h={name:"MeasIndicatorExpandsTable",model:{props:"value",event:"change"},props:{value:{type:Array,default:function(){return[]}},args:{type:Array,default:function(){return[]}},originItem:{type:Object,default:function(){return{dictIdentifier:"",dictKey:"",dictKeyName:""}}}},data:function(){return{dictOptions:[]}},computed:p(p({},Object(s.a)(["measureOptions"])),{},{themeStyles:function(){return{target:"th,td",style:{"border-width":Object(u.nb)("borderWidth"),"border-style":Object(u.nb)("borderStyle"),"border-color":Object(u.nb)("borderColor"),padding:"0 5px"}}},theadStyles:function(){return{"background-color":Object(u.nb)("middleBackgroundColor")}}}),created:function(){this.init()},methods:{init:function(){this.getDictOptions(),this.value&&"array"===Object(l.g)(this.value)&&this.value.length||this.$emit("change",[Object(l.e)(this.originItem)])},handleSelectClear:function(e){e.dictIdentifier=""},getDictValue:function(e){var t=(this.list||[]).find((function(t){return t.identifier===e}));return(null==t?void 0:t.name)||e},getDictOptions:function(){var e=this;this.$axiosRequest({url:"/api/model/instances",method:"get",params:{objectType:"COM_CODEDICTIONARY",queryMode:"simple",pagination:0,lazyLoad:0,$orderBy:"createTime desc"}}).then((function(t){e.list=e.ReplaceID(e.GetData(t));var a=[];e.listToTree(e.list,a,"-1"),e.dictOptions=a}))},listToTree:function(e,t,a){var i=this;e.forEach((function(n){if(n.parentId===a){var r=p(p({},n),{},{label:n.key||n.name,children:[]});i.listToTree(e,r.children,n.identifier),r.children.length<=0&&delete r.children,t.push(r)}}))},GetData:function(e){var t=[];return e.forEach((function(a){0!==e.filter((function(e){return e.parentId===a.id})).length&&t.push(a)})),t},ReplaceID:function(e){return e.forEach((function(t){var a=e.find((function(e){return e.id===t.parentId}));t.parentId=a&&a.identifier?a.identifier:t.parentId,t.name+="（".concat(t.identifier,"）")})),e},handleEventContent:function(e,t){var a=this,i=this.value.length;if("add"===e)return i>u.a.MAX_LENGTH_ADD?void this.$message({message:"最多添加"+u.a.MAX_LENGTH_ADD+"项！",type:"warning"}):void this.value.push(Object(l.e)(this.originItem));if("del"!==e)if("top"!==e){if("bottom"===e){if(t===i-1)return;var n=this.value.splice(t,1);this.value.splice(t+1,0,n[0])}}else{if(0===t)return;var r=this.value.splice(t,1);this.value.splice(t-1,0,r[0])}else this.$confirm("确定要删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){a.value.splice(t,1)})).catch((function(){}))},onTreeSelectClick:function(e,t,a){e.dictIdentifier=a.identifier,this.$refs.treeSelect[t].blur()}}},f=(a("e173"),a("2877")),m={name:"MeasIndicatorExpands",components:{MeasIndicatorExpandsTable:Object(f.a)(h,c,[function(){var e=this,t=e._self._c;return t("tr",[t("th",{staticClass:"required"},[e._v("字典值")]),t("th",{staticClass:"required",attrs:{width:"20%"}},[e._v("虚拟列名称")]),t("th",{attrs:{width:"20%"}},[e._v("虚拟列中文名")]),t("th",{attrs:{width:"200px"}},[e._v("操作")])])}],!1,null,"91709438",null).exports},props:{updateStore:{type:Boolean,default:!1},defaultExpand:{type:Object,default:function(){return{}}}},data:function(){return{visible:!0,loading:!0,expandInfo:{},expands:[],expandsCopy:[]}},created:function(){this.initData()},methods:{initData:function(){var e,t,a;this.loading=!0,null!==(e=this.defaultExpand)&&void 0!==e&&null!==(t=e.dataType)&&void 0!==t&&null!==(a=t.expands)&&void 0!==a&&a.dicts?this.setExpandsData(this.defaultExpand):this.getExpands()},setExpandsData:function(e){var t,a,i;this.expandInfo=e,this.expands=null===(t=this.expandInfo)||void 0===t||null===(a=t.dataType)||void 0===a||null===(i=a.expands)||void 0===i?void 0:i.dicts,this.expandsCopy=Object(l.e)(this.expands)},getExpands:function(){var e=this,t={url:"/api/model/profiles/134/properties",method:"get",params:{$filter:"status eq 1",$pagination:0,inherit:"custom",$orderBy:"createTime desc"}};this.$axiosRequest(t).then((function(t){e.setExpandsData((t||[]).find((function(e){return"EXPANDS"===e.propertyIdentifier})))})).finally((function(){e.loading=!1}))},handleClose:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.$emit("close","boolean"==typeof e&&e)},clickSure:function(){this.expands.some((function(e){return!e.dictIdentifier||!e.dictKey}))?this.$message.info("请填写完整"):this.save()},save:function(){var e=this,t={url:"/api/model/profiles/134/properties?propertyId=".concat(this.expandInfo.propertyId),method:"patch",params:{dataType:this.expandInfo.dataType}};this.$axiosRequest(t).then((function(t){e.$message.success("操作成功"),e.updateStore?e.$store.dispatch("initMeasDicts",{forceUpdate:function(){e.handleClose(!0)}}):e.handleClose(!0)})).catch((function(e){}))},delDiff:function(){}}};function v(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function b(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?v(Object(a),!0).forEach((function(t){Object(n.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):v(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var g={name:"MeasIndicatorDefine",components:{MeasIndicatorExpands:Object(f.a)(m,(function(){var e=this,t=e._self._c;return t("div",[t("el-dialog",{attrs:{title:"扩展维度",visible:e.visible,width:"900px","modal-append-to-body":"","append-to-body":"","destroy-on-close":!0},on:{"update:visible":function(t){e.visible=t},closed:e.handleClose}},[e.loading?e._e():t("meas-indicator-expands-table",{model:{value:e.expands,callback:function(t){e.expands=t},expression:"expands"}}),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.handleClose}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.clickSure}},[e._v("确 定")])],1)],1)],1)}),[],!1,null,"1e8a2255",null).exports},inject:["isProjectPage","isTemplatePage"],props:{defaultIndicator:{type:Object,default:function(){return{identifier:"",name:""}}},updateStore:{type:Boolean,default:!1}},data:function(){return{visible:!0,measIndicatorExpandsVisible:!1,indicator:{identifier:"",name:""},showMeasTips:!0}},computed:b(b({},Object(s.a)(["measureOptions"])),{},{dictList:function(){return this.isProjectPage||this.isTemplatePage?this.measureOptions.measureIndicatorDictOptions:this.measureOptions.measureIndicatorExpandsDicts}}),watch:{defaultIndicator:{immediate:!0,handler:function(e){this.indicator=Object(l.e)(e)}},"measureOptions.measureIndicatorExpandsDicts":{immediate:!0,handler:function(e){var t=this;if(!this.isProjectPage&&!this.isTemplatePage){var a=Object.keys(this.indicator);a.length&&((e||[]).forEach((function(e){var a;null!==(a=t.indicator)&&void 0!==a&&a.hasOwnProperty(e.displayName)||t.$set(t.indicator,e.displayName,"")})),a.forEach((function(a){a.startsWith("expands.")&&!(e||[]).some((function(e){return e.displayName===a}))&&delete t.indicator[a]})))}}},"measureOptions.measureIndicatorDictOptions":{immediate:!0,handler:function(e){var t=this;if(this.isProjectPage||this.isTemplatePage){var a=Object.keys(this.indicator);a.length&&((e||[]).forEach((function(e){var a;null!==(a=t.indicator)&&void 0!==a&&a.hasOwnProperty(e.displayName)||t.$set(t.indicator,e.displayName,"")})),a.forEach((function(a){a.startsWith("expands.")&&!(e||[]).some((function(e){return e.displayName===a}))&&delete t.indicator[a]})))}}}},methods:{openExpands:function(){this.measIndicatorExpandsVisible=!0},onMeasIndicatorExpandsClose:function(e){this.measIndicatorExpandsVisible=!1},handleClose:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;this.$emit("close","boolean"==typeof e&&e,t)},clickSure:function(){this.save()},getIndicatorExpands:function(e){var t=this,a=Object.keys(e||{});if(a.length){var i={};return a.forEach((function(e){e.startsWith("expands.")&&(i[e]=t.indicator[e]||"COM_NULL")})),i}},save:function(){var e=this;return Object(i.a)(o.a.mark((function t(){var a,i,n,r,l;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getCurrentInfo();case 2:for(r in a=t.sent,i="/api/model/instances/".concat(e.indicator.id),n=e.getIndicatorExpands(e.indicator),a)r.includes("expands")&&(n[r]||(n[r]="COM_NULL"));l={url:i,method:"patch",params:n},e.$axiosRequest(l).then((function(t){e.$message.success("操作成功"),e.handleClose(!0,b({id:e.indicator.id},n))})).catch((function(e){}));case 8:case"end":return t.stop()}}),t)})))()},getCurrentInfo:function(){var e=this;return new Promise((function(t){var a="/api/model/instances/".concat(e.indicator.id);e.$axiosRequest({url:a,method:"get"}).then((function(e){t(e)})).catch((function(){t({})}))}))}}},y=(a("1ce5"),Object(f.a)(g,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"meas-indicator-define"},[t("el-dialog",{attrs:{title:"编辑指标扩展维度",visible:e.visible,width:"600px","modal-append-to-body":"","append-to-body":"","destroy-on-close":!0},on:{"update:visible":function(t){e.visible=t},closed:e.handleClose}},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.showMeasTips,expression:"showMeasTips"}],staticClass:"meas-tips"},[t("span",[e._v("ℹ️扩展维度相关配置项在数据字典-指标量目录下进行设置。")]),t("el-button",{attrs:{type:"text"},on:{click:function(t){e.showMeasTips=!1}}},[e._v("关闭提示")])],1),t("div",{staticClass:"meas-indicator-define-info"},[t("div",[t("div",{staticClass:"meas-indicator-define-info-label"},[e._v("\n          标识:\n        ")]),t("div",[e._v("\n          "+e._s(e.indicator.identifier)+"\n        ")])]),t("div",[t("div",{staticClass:"meas-indicator-define-info-label"},[e._v("\n          名称:\n        ")]),t("div",[e._v("\n          "+e._s(e.indicator.name)+"\n        ")])]),t("div",[t("div",[e.isProjectPage?e._e():t("el-button",{attrs:{type:"text"},on:{click:e.openExpands}},[e._v("配置扩展维度")])],1)])]),t("el-form",{staticClass:"meas-indicator-define-form",attrs:{"label-width":"140px"}},e._l(e.dictList,(function(a){return t("el-form-item",{key:a.dictIdentifier},[t("div",{attrs:{slot:"label"},slot:"label"},[e._v("\n          "+e._s(a.displayName)+"\n        ")]),t("el-select",{staticClass:"meas-indicator-define-form-content",attrs:{clearable:""},model:{value:e.indicator[a.displayName],callback:function(t){e.$set(e.indicator,a.displayName,t)},expression:"indicator[item.displayName]"}},e._l(a.options,(function(e){return t("el-option",{key:e.value,attrs:{value:e.value,label:e.name}})})),1)],1)})),1),e.measIndicatorExpandsVisible?t("meas-indicator-expands",{attrs:{updateStore:""},on:{close:e.onMeasIndicatorExpandsClose}}):e._e(),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.handleClose}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.clickSure}},[e._v("确 定")])],1)],1)],1)}),[],!1,null,"40f0fdc0",null));t.a=y.exports},"471b":function(e,t,a){"use strict";a("1711")},"488c":function(e,t,a){},"48d2":function(e,t,a){"use strict";a("3c84")},"48f4":function(e,t,a){},"48f9":function(e,t,a){"use strict";a.r(t);var i=(a("7514"),a("ac6a"),a("04c8")),n=a("c276"),r=a("b19c"),o={name:"VariableEditor",components:{VariablePanel:i.a},model:{prop:"value",event:"change"},props:{value:{type:String,default:""},title:{type:String,default:function(){return"设置变量"}},showInput:{type:Boolean,default:function(){return!0}},iconClass:{type:String,default:function(){return"el-icon-close"}},onlyName:{type:Boolean,default:function(){return!1}},args:{type:Array,default:function(){return[]}},data:{type:Object,default:function(){return{alias:"",type:"",default:"",value:"",primitiveLabels:""}}},disabled:{type:Boolean,default:function(){return!1}},placeholder:{type:String,default:""},params:{type:Object,default:function(){return{}}},handleRulesResult:{type:Function,default:function(){}},handleChangeResult:{type:Function,default:function(){}}},computed:{excludes:function(){var e=this.$store.getters.pageEditor,t=e&&e.pagesKV[e.pagesActiveName];return["Page","Arguments","pageVariable","customVariable","Response","Request",t?t.page.fid:""]},inputPlaceholder:function(){return"variable"===this.editValType?"点击选择":"请输入内容"}},data:function(){return{showVal:"",editVal:{type:"variable",static:"",variable:[],useExpression:!1},dialogVisible:!1,editValType:"variable",editValStaticVar:""}},watch:{"data.value":function(){this.initData()},dialogVisible:function(e){e&&this.initData()},editValStaticVar:{handler:function(e){"variable"!==this.editValType&&(this.editVal.static=e)},immediate:!1}},created:function(){this.initData()},methods:{clearVariable:function(){var e=this;this.showVal="",this.editVal={type:"variable",static:"",variable:[],useExpression:!1},this.$removeAttr(this.data,"value"),this.$removeAttr(this.data,"lastValue"),this.$removeAttr(this.data,"editValue"),this.$emit("change",""),this.editVal.useExpression=!1,this.editValStaticVar=this.editVal.variable.length>0?"${".concat(this.editVal.variable.join("."),"}"):"",this.$nextTick((function(){e.close()}))},changeVariable:function(e){if(!(e.length<1)){var t=e.join(".");this.editValStaticVar="${".concat(t,"}")}},changetype:function(e){var t,a;this.editVal.useExpression="useExpression"===e,"variable"===e?(this.editVal.type=e,this.editValStaticVar=this.editVal.variable.length>0?"${".concat(this.editVal.variable.join("."),"}"):""):(this.editVal.type="static",this.editValStaticVar=(null===(t=this.data.linkConfig)||void 0===t?void 0:t.useExpression)===this.editVal.useExpression?null===(a=this.data.linkConfig)||void 0===a?void 0:a.static:"")},onValueChange:function(e){this.$emit("change",e)},initData:function(){var e=Object(n.pb)(this.data.value,this.data.default);this.editVal=Object(r.e)(this.data.editValue||{type:"variable",static:"",variable:[],useExpression:!1}),this.editVal.variable&&this.editVal.variable.length&&(this.editVal.variable=this.compatible(this.editVal.variable)),e&&!this.data.hasOwnProperty("editValue")&&(this.editVal.type="static",this.editVal.static=e),"variable"===this.params.type&&this.params.hasOwnProperty("useOnlyName")&&!this.editVal.hasOwnProperty("useOnlyName")&&this.$set(this.editVal,"useOnlyName",this.params.useOnlyName),"variable"===this.params.type&&this.params.hasOwnProperty("useLastName")&&!this.editVal.hasOwnProperty("useLastName")&&(this.editVal.useLastName=this.params.useLastName),this.editValType=this.editVal.type,this.showVal=this.getShowVal()},compatible:function(e){var t=this,a=[];return e.forEach((function(e){t.excludes.find((function(t){return t===e}))||a.push(e)})),a},handleIconClick:function(){this.disabled||(this.dialogVisible=!0)},close:function(){this.dialogVisible=!1},cancel:function(){this.close()},clear:function(){var e=this;this.$confirm("确定要清空相关设置吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.showVal="",e.editVal={type:"variable",static:"",variable:[],useExpression:!1},e.$removeAttr(e.data,"value"),e.$removeAttr(e.data,"lastValue"),e.$removeAttr(e.data,"editValue"),e.$emit("change",""),e.close()})).catch((function(){}))},getShowVal:function(){return"static"===this.editVal.type?this.editVal.static:this.editVal.variable&&this.editVal.variable.length?!0===this.editVal.useLastName?this.editVal.variable[this.editVal.variable.length-1]:!0===this.editVal.useOnlyName?this.editVal.variable.join("."):"${"+this.editVal.variable.join(".")+"}":""},clickSure:function(){"variable"===this.editVal.type?this.editVal.static="":this.editVal.variable=[];var e=this.validate();!0===e?(this.showVal=this.getShowVal(),!1!==this.handleChangeResult(this.showVal,this.data)?(this.$setAttr(this.data,"value",this.showVal),this.$setAttr(this.data,"lastValue",this.showVal),this.$setAttr(this.data,"editValue",Object(r.e)(this.editVal)),this.$emit("onSure",this.showVal,Object(r.e)(this.editVal),this.data),this.onValueChange(this.showVal),this.dialogVisible=!1):this.$setAttr(this.data,"lastValue",this.data.lastValue)):this.$message.warning(e)},validate:function(){return"variable"===this.editVal.type&&0===this.editVal.variable.length?"请选择变量":"static"!==this.editVal.type||this.editVal.static?!("static"===this.editVal.type&&this.editVal.static.length>n.a.PAYLOAD_NAME_MAX_LENGTH)||"字符的长度不能超过"+n.a.PAYLOAD_NAME_MAX_LENGTH:"请手动输入"}}},l=(a("8fee"),a("2877")),s=Object(l.a)(o,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"hc-attr-editor hc-attr-editor-variable variable-link-editor"},[t("el-popover",{ref:"popover",attrs:{title:e.title,"popper-class":"variable-link-editor-dialog",placement:"bottom",width:"600"},on:{hide:e.close},model:{value:e.dialogVisible,callback:function(t){e.dialogVisible=t},expression:"dialogVisible"}},[t("el-input",{staticClass:"input-with-select",attrs:{placeholder:e.inputPlaceholder,readonly:"variable"===e.editValType},model:{value:e.editValStaticVar,callback:function(t){e.editValStaticVar=t},expression:"editValStaticVar"}},[t("el-select",{attrs:{slot:"prepend",placeholder:"请选择"},on:{change:e.changetype},slot:"prepend",model:{value:e.editValType,callback:function(t){e.editValType=t},expression:"editValType"}},[t("el-option",{attrs:{label:"变量选择",value:"variable"}}),t("el-option",{attrs:{label:"手动输入",value:"static"}}),t("el-option",{attrs:{label:"表达式",value:"useExpression"}})],1)],1),t("el-collapse-transition",["variable"===e.editValType?t("variable-panel",{attrs:{args:this.args,data:e.data,editVal:e.editVal},on:{change:e.changeVariable},model:{value:e.editVal.variable,callback:function(t){e.$set(e.editVal,"variable",t)},expression:"editVal.variable"}}):e._e()],1),"useExpression"===e.editValType?t("el-alert",{staticStyle:{"margin-top":"20px"},attrs:{title:"支持js表达式语法，支持混合使用变量，${...}是对变量的引用，其中...为变量名",type:"info","show-icon":"",closable:!1}}):e._e(),t("div",{staticClass:"dialog-footer"},[t("el-row",["variable"===e.editVal.type&&e.editVal.hasOwnProperty("useOnlyName")?t("el-col",{staticStyle:{"text-align":"left","padding-left":"10px"},attrs:{span:12}},[t("el-checkbox",{model:{value:e.editVal.useOnlyName,callback:function(t){e.$set(e.editVal,"useOnlyName",t)},expression:"editVal.useOnlyName"}},[e._v("仅使用变量名称")])],1):e._e(),t("el-col",{attrs:{span:"variable"===e.editVal.type&&e.editVal.hasOwnProperty("useOnlyName")?12:24}},[t("el-button",{attrs:{type:"danger"},on:{click:e.clear}},[e._v("清 空")]),t("el-button",{on:{click:e.cancel}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.clickSure}},[e._v("确 定")])],1)],1)],1),e.showInput?t("el-input",{staticClass:"editor-input",attrs:{slot:"reference",placeholder:e.placeholder,value:e.showVal,readonly:"",size:"mini"},slot:"reference"},[0!==e.showVal.length?t("i",{staticClass:"el-input__icon variable-editor-icon",class:e.iconClass,attrs:{slot:"suffix"},on:{click:function(t){return t.stopPropagation(),e.clearVariable.apply(null,arguments)}},slot:"suffix"}):e._e()]):e._e()],1)],1)}),[],!1,null,"209eecfa",null);t.default=s.exports},"491d":function(e,t,a){},4981:function(e,t,a){},"49cc":function(e,t,a){},"4a0e":function(e,t,a){},"4c80":function(e,t,a){"use strict";a("a564")},"4c93":function(e,t,a){},"4cd5":function(e,t,a){"use strict";a("981a")},"4cfa":function(e,t,a){},"4d68":function(e,t,a){"use strict";a("8855")},"4de0":function(e,t,a){},"4e58":function(e,t,a){"use strict";a("0163")},"4ed8":function(e,t,a){"use strict";a("4a0e")},"4f5d":function(e,t,a){},"4f6f":function(e,t,a){"use strict";a("2f15")},"4fe8":function(e,t,a){},"50e8":function(e,t,a){},"510c":function(e,t,a){},"52bf":function(e,t,a){},"52e2":function(e,t,a){"use strict";a("5643")},5325:function(e,t,a){"use strict";a("d66b")},"548e":function(e,t,a){"use strict";var i=(a("8e6e"),a("ac6a"),a("456d"),a("bd86")),n=(a("c5f6"),a("c276")),r=a("2f62");function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){Object(i.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var s={name:"ComplexBox",props:{level:{type:Number,default:0},data:{type:Object,default:function(){}}},data:function(){return{showName:!0}},created:function(){var e=this.data.originGroupName||this.data.groupName;this.data.showField||"methods"!==e&&"events"!==e||(this.showName=!1),this.data.tips||(this.data.tips=this.data.alias)},mounted:function(){},computed:l(l({},Object(r.a)(["attrTips"])),{},{showLabel:function(){return"events"!==this.data.editor},styles:function(){var e={"border-color":Object(n.nb)("borderColor"),"border-style":Object(n.nb)("borderStyle"),"border-width":Object(n.nb)("borderWidth"),padding:"0","border-left-width":"0","border-bottom-width":"0","border-right-width":"0"};return(this.level>1||!this.showName)&&(e.border="0"),e},innerStyles:function(){var e={color:"#aaaaaa","text-align":"center"};return this.level>1&&(e.color=Object(n.nb)("color"),e["text-align"]="left"),e}}),methods:{}},c=(a("6122"),a("2877")),u=Object(c.a)(s,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"complex-box"},[t("fieldset",{staticClass:"complex-line",style:e.styles},[e.showName&&e.showLabel?t("legend",{staticClass:"complex-name",style:e.innerStyles},[e._v("\n      "+e._s(e.data.alias)+"\n      "),t("el-tooltip",{directives:[{name:"show",rawName:"v-show",value:e.attrTips(e.data)&&e.attrTips(e.data).status,expression:"attrTips(data) && attrTips(data).status"}],attrs:{placement:"right","open-delay":1e3}},[t("i",{staticClass:"el-icon-question",on:{mouseenter:function(t){return e.$store.dispatch("getCurrentTips",e.data)}}}),t("div",{attrs:{slot:"content"},domProps:{innerHTML:e._s(e.attrTips(e.data)&&e.attrTips(e.data).value)},slot:"content"})])],1):e._e(),e._t("default")],2)])}),[],!1,null,"8ae0bb54",null);t.a=u.exports},"54ca":function(e,t,a){},5570:function(e,t,a){"use strict";a("6b5a")},"557a":function(e,t,a){},5643:function(e,t,a){},5686:function(e,t,a){"use strict";a("52bf")},"56b1":function(e,t,a){"use strict";var i={name:"TemplateCollapse",data:function(){return{title:"标题"}}},n=(a("4c80"),a("2877")),r=Object(n.a)(i,(function(){var e=this,t=e._self._c;return t("el-collapse",{staticClass:"template-collapse"},[t("el-collapse-item",{staticClass:"template-collapse-item"},[e._t("title",(function(){return[e._v("\n      "+e._s(e.title)+"\n    ")]}),{slot:"title"}),e._t("default")],2)],1)}),[],!1,null,null,null);t.a=r.exports},"56d7":function(e,t,a){"use strict";a.r(t),a("cadf"),a("551c"),a("f751"),a("097d");var i=a("2b0e"),n=a("5c96"),r=a.n(n),o={name:"App",data:function(){return{isActive:!0}},provide:function(){return{reloadPage:this.reloadPage}},mounted:function(){window.$common.$util.request({url:"/api/component/components",params:{pagination:0},method:"get"}).then((function(e){sessionStorage.setItem("storagedComponentJSON",JSON.stringify(e))}))},methods:{reloadPage:function(){var e=this;this.isActive=!1,setTimeout((function(){e.isActive=!0}),0)},insertAsyncFunctionConstructor:function(){try{new Function("args","const AsyncFunction = Object.getPrototypeOf(async function() {}).constructor;window.AsyncFunction = AsyncFunction;")()}catch(e){}}}},l=(a("27d8"),a("2877")),s=Object(l.a)(o,(function(){var e=this._self._c;return e("div",{attrs:{id:"app"}},[e("router-view")],1)}),[],!1,null,null,null).exports,c=(a("ac6a"),a("7514"),a("7f7f"),a("b76a")),u=a.n(c),d=a("75fc"),p=a("e611").a,h=(a("b542"),a("eab8"),Object(l.a)(p,(function(){var e=this,t=e._self._c;return e.isEmptyContainer?t("component-render",{attrs:{data:e.data,parent:e.parent,runtime:e.runtime,pageId:e.pageId,pageContentHeight:e.autoHeight,hasBorder:e.hasBorder,isSelected:e.activeComponentFid===e.data.fid}}):t("component-box-wrapper",{attrs:{data:e.data,parentComponentName:e.parentComponentName,id:e.fid,parentId:e.parentId,xs:e.xs,sm:e.sm,md:e.span,lg:e.lg,offset:e.offset}},[t("component-block",{staticClass:"hc-block-component",class:e.className,style:e.styles,attrs:{headerStyle:e.headerStyle,nameKey:"blockToolbarName",title:e.blockTitle,titleStyle:e.titleStyle,showType:e.blockToolbarShowType,toolbars:e.blockToolbars},on:{toolbarChange:e.handleToolbarChange},nativeOn:{click:function(t){return e.handleSelect(e.data.fid,t)}}},[t("div",{class:["hc-block-component-box"].concat(Object(d.a)(e.classNameInner)),style:e.stylesInner,attrs:{"comp-name":e.componentName}},[e.fid?t("component-render",{attrs:{data:e.data,parent:e.parent,runtime:e.runtime,pageId:e.pageId,pageContentHeight:e.autoHeight,hasBorder:e.hasBorder,isSelected:e.activeComponentFid===e.data.fid}}):e._e()],1)])],1)}),[],!1,null,"5f2eb27a",null)).exports,f=(a("8e6e"),a("456d"),a("a481"),a("c5f6"),a("bd86"));function m(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function v(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?m(Object(a),!0).forEach((function(t){Object(f.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):m(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var b={name:"ComponentBlock",props:{headerStyle:{type:Object,default:function(){return{}}},title:{type:String,default:""},titleStyle:{type:Object,default:function(){return{}}},showType:{type:String,default:"none"},nameKey:{type:String,default:"name"},toolbars:{type:Array,default:function(){return[]}},clickStop:{type:Boolean,default:!0}},computed:{styles:function(){return v(v({},this.headerStyle),{},{height:this.titleStyle.height,margin:Array.isArray(this.titleStyle.margin)?"".concat(this.titleStyle.margin.join("px "),"px"):"",padding:Array.isArray(this.titleStyle.padding)?"".concat(this.titleStyle.padding.join("px "),"px"):""},this.title?{}:{position:"absolute",zIndex:2,top:0,left:"auto",right:0,border:0})},contentStyles:function(){var e={height:"100%"};if(!this.title)return e;var t=Array.isArray(this.titleStyle.margin)?this.titleStyle.margin[0]+this.titleStyle.margin[2]:0,a=Number(this.titleStyle.height.replace("px",""))+t;return e.height="calc(100% - "+a+"px)",e},titlePrependIcon:function(){return this.titleStyle.icon},headerTitleStyle:function(){return{fontSize:"".concat(this.titleStyle.fontSize,"px"),color:this.titleStyle.color}},toolbarStyle:function(){return{flex:this.title?"0 0 auto":"1 0",maxWidth:this.title?"50%":"100%"}}},methods:{handleCommand:function(e){this.handleChange(e)},handleChange:function(e){this.$emit("toolbarChange",e[this.nameKey].value,e)}}},g=(a("19e5"),Object(l.a)(b,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"component-block"},[e._t("editorToolbars"),e.title||"none"!==e.showType?t("div",{staticClass:"component-block-header-box"},[t("div",{staticClass:"component-block-header",style:e.styles},[e.title?t("h3",{staticClass:"t-text-primary t-font-size__medium component-block-title",style:e.headerTitleStyle,attrs:{title:e.title}},[e.titlePrependIcon?t("iconfont",{attrs:{type:e.titlePrependIcon,right:5}}):e._e(),t("span",[e._v(e._s(e.title))])],1):e._e(),t("div",{staticClass:"component-block-toolbar",style:e.toolbarStyle},["none"!==e.showType?["grid"===e.showType?t("el-button-group",[e.toolbars&&e.toolbars.length>0?e._l(e.toolbars,(function(a,i){return t("el-button",{key:i,attrs:{size:"mini",plain:""},on:{click:function(t){return e.handleChange(a)}}},[e._v(e._s(a[e.nameKey].value))])})):e._e()],2):"list"===e.showType?t("el-dropdown",{on:{command:e.handleCommand}},[t("span",{staticClass:"el-dropdown-link"},[t("i",{staticClass:"el-icon-more"})]),e.toolbars&&e.toolbars.length>0?t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},e._l(e.toolbars,(function(a,i){return t("el-dropdown-item",{key:i,attrs:{command:a}},[e._v(e._s(a[e.nameKey].value))])})),1):e._e()],1):e._e()]:e._e()],2)])]):e._e(),t("div",{staticClass:"component-block-content",style:e.contentStyles},[e._t("default")],2),e._t("others")],2)}),[],!1,null,null,null)).exports,y=(a("9253"),a("386d"),a("28a5"),a("6762"),a("2fdb"),a("b19c"));function _(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function C(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?_(Object(a),!0).forEach((function(t){Object(f.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):_(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var O={name:"ComponentPageManage",props:{mode:{type:String,default:"readonly"},groupId:{type:String,default:""},pageId:{type:String,default:""}},inject:["isSDC"],data:function(){return{filterStr:"",filterString:"",importSetting:{importVisible:!1,importAccept:"json",importFileSize:20,forceCover:0,file:null,groupId:"0"},filter:{mdSpan:9,lgSpan:9,filters:[{k:"pageType",o:"=",v:this.isSDC?6:2,keep:!0}],filterColumn:[{prop:"name",label:"".concat(this.isSDC?"二开组件":"页面","名称"),type:"input",operator:"like",mdSpan:14,lgSpan:14},{prop:"pageType",hidden:!0,type:"input",operator:"=",keep:!0,defaultValue:this.isSDC?6:2}]},operations:{delbtnDisabled:!0},form:{width:"600px",modalAppendToBody:!0,loading:!1,visible:!1,currentId:"",data:{id:"",name:"",title:"",description:"",parentId:"0",pageType:this.isSDC?6:2},rules:{name:[{required:!0,message:"请输入".concat(this.isSDC?"二开组件别名":"页面名称"),trigger:"blur"},{max:50,message:"长度在 1 到 50 个字符",trigger:"blur"}],componentName:[{required:!0,message:"请输入二开组件名称",trigger:"blur"},{max:50,message:"长度在 1 到 50 个字符",trigger:"blur"}],parentId:[{required:!0,message:"请选择所属分组",trigger:"blur"}],title:[{message:"超过允许的最大长度50",maxlength:50,trigger:"blur"}],description:[{message:"超过允许的最大长度500",maxlength:500,trigger:"blur"}]}},formGroup:{width:"600px",modalAppendToBody:!0,loading:!1,visible:!1,currentId:"",data:{id:"",name:"",description:"",parentId:"0",pageType:this.isSDC?5:1},rules:{name:[{required:!0,message:"请输入分组名称",trigger:"blur"}],parentId:[{required:!0,message:"请选择所属分组",trigger:"blur"}]}},tree:{isDone:!1,highlightCurrent:!0,currentNode:{id:"0",name:"/"},loading:!1,searchName:"",treeProps:{label:"name",isLeaf:function(e){return[2,6].includes(e.pageType)},handler:{edit:{label:"修改",event:this.handleEdit},del:{label:"删除",event:this.handleDel}}},fetchOption:{url:"/api/page/pages",payload:{orders:{name:"ascending"}},params:{queryEditContent:0,pagination:0},isFilter:!1,childrenFetchOption:{}},rootNode:{id:"0",label:"/",name:"/"},disabled:!1},table:{showToolbarRight:!1,highlightCurrentRow:!0,preloadingData:!1,height:"500px",defaultSort:{name:"ascending"},fetchOption:{url:"/api/page/pages",params:{queryEditContent:0,levelCode:this.isSDC?"0":"-1",pageType:this.isSDC?6:2}},rowHandlers:[{label:"修改",event:this.handleEdit},{label:"导出",event:this.handleExport},{label:"删除",event:this.handleDel}],rowHandlerFixed:!1,tableColumn:[{prop:"name",label:"".concat(this.isSDC?"二开组件别名":"页面名称"),width:"130px",show:!0,sortable:!0},{prop:"componentName",label:"二开组件名称",width:"130px",show:this.isSDC,sortable:!0},{prop:"parentPageName",label:"分组名称",width:"100px",show:!0},{prop:"updateTime",label:"修改时间",width:"130px",sortable:!0,show:!0},{prop:"updateUser",label:"修改人",show:!0}]}}},computed:{treeStyles:function(){var e={},t=this.table.height.replace("px",""),a=Number(t);return e.height=("full"===this.mode?a:a+32)+60+"px",e},selectorTree:function(){return{treeProps:{label:"name",isLeaf:function(e){return[2,6].includes(e.pageType)}},fetchOption:{url:"/api/page/pages",payload:{filters:[{k:"pageType",o:"=",v:this.isSDC?5:1}],orders:{name:"ascending"}},params:{$filter:this.filterStr,queryEditContent:0,pagination:0}},rootNode:{id:"0",label:"/",name:"/"}}},isManagement:function(){return!!this.getQueryVariable("projectIdentifier")}},created:function(){this.initStr(),this.initFormData()},mounted:function(){var e=this.isManagement&&!this.isSDC?"-1":"0";if(this.groupId&&"0"!==this.groupId&&(e=this.groupId),this.table.fetchOption.params.levelCode=e,this.isManagement||(this.table.fetchOption.params.$filter="parentId eq 0"),this.searchTable(),this.isSDC){var t=this.getQueryVariable("projectIdentifier");t&&(this.table.fetchOption.params.$filter="projectIdentifier in COMMON::".concat(t))}},watch:{searchName:function(e){e||(this.searchState=!1)},mode:{handler:function(e){this.setData(e)},immediate:!0}},methods:{initStr:function(){var e=this.getQueryVariable("projectIdentifier"),t=this.isSDC?5:1;e?(this.filterStr="pageType eq ".concat(t,",path eq /").concat(e),this.filterString="pageType eq ".concat(t,",path likeright /").concat(e,"/"),this.tree.fetchOption.params={$filter:this.filterStr,queryEditContent:0,pagination:0},this.tree.fetchOption.childrenFetchOption={url:"/api/page/pages",payload:{orders:{name:"ascending"}},params:{$filter:this.filterString,queryEditContent:0,pagination:0}},this.tree.fetchOption.isFilter=!0):(this.tree.fetchOption.isFilter=!1,this.tree.fetchOption.params={$filter:"pageType eq ".concat(t),queryEditContent:0,pagination:0}),this.tree.fetchOption.isFilter},getQueryVariable:function(e){var t=location.href.split("?");if(t.length>1){for(var a=t[1].split("&"),i=0;i<a.length;i++){var n=a[i].split("=");if(n[0]==e)return n[1]}return""}return""},setLeveCode:function(){this.table.fetchOption.params.levelCode=0==this.tree.currentNode.id?this.isManagement&&!this.isSDC?"-1":"0":this.tree.currentNode.id,this.table.fetchOption.params.$filter="parentId eq ".concat(this.table.fetchOption.params.levelCode)},setData:function(e){var t={edit:{label:"修改",event:this.handleEdit},del:{label:"删除",event:this.handleDel}},a=[{label:"修改",event:this.handleEdit},{label:"导出",event:this.handleExport},{label:"删除",event:this.handleDel}];"full"===e?(this.$set(this.tree.treeProps,"handler",C({},t)),this.$set(this.table,"rowHandlers",[].concat(a))):"readonly"===e?(this.$set(this.tree.treeProps,"handler",null),this.$set(this.table,"rowHandlers",[])):"quick"===e&&(this.$set(this.tree.treeProps,"handler",C({},t)),this.$set(this.table,"rowHandlers",[]))},initFormData:function(){var e=this.form.data;e.id="",e.name="",e.title="",e.description="",e.parentId=this.tree.currentNode.id},setTreeCurrentKey:function(e){this.$refs.tree&&this.tree.isDone&&this.$refs.tree.setCurrentKey(e||"0")},refreshTree:function(){this.$refs.tree&&this.$refs.tree.init()},handleTreeSearch:function(){this.$refs.tree&&this.tree.isDone&&this.$refs.tree.filter(this.tree.searchName)},handleTreeAdd:function(){this.formGroup.data.id="",this.formGroup.data.name="",this.formGroup.data.description="",this.formGroup.data.parentId=this.tree.currentNode.id,this.formGroup.visible=!0},handleTreeDone:function(){this.tree.isDone=!0,this.setTreeCurrentKey(this.tree.currentNode.id),this.searchTable()},handleTableDone:function(e){var t=this,a=e.filter((function(e){return e.id===t.form.currentId}));a&&a.length&&this.setCurrentRowTable(a[0])},handleSelectorTreeFocus:function(){},handleSelectorTreeDone:function(){},handleCurrentRowChange:function(e){this.$emit("current-change",{page:e,group:this.tree.currentNode})},handleCurrentChange:function(e){this.tree.currentNode.id=e.id,this.tree.currentNode.name=e.name,this.form.data.parentId=e.id,this.formGroup.data.parentId=e.id,this.setLeveCode(),this.searchTable(),this.$emit("current-group-change",this.tree.currentNode)},handleCheckedChange:function(e,t){},searchTable:function(){var e=this;this.$nextTick((function(){e.$refs.table&&e.$refs.table.search()}))},refreshTable:function(){this.$refs.table.getTableData()},setCurrentRowTable:function(e){this.$refs.table.setCurrentRow(e)},pageCreateHandle:function(e,t,a){var i=this,n={url:"/api/page/pages",method:"post",data:e.data};this.$util.request(n).then((function(e){i.$message.success("新增成功"),"function"===Object(y.g)(t)&&t(e)})).catch((function(e){"function"===Object(y.g)(a)&&a(e)}))},pageSaveHandle:function(e,t,a){var i=this,n={url:"/api/page/pages/".concat(e.data.id),method:"patch",data:e.data};this.$util.request(n).then((function(e){i.$message.success("修改成功"),"function"===Object(y.g)(t)&&t(e)})).catch((function(e){"function"===Object(y.g)(a)&&a(e)}))},pageDeleteHandle:function(e,t,a,i){var n=this,r={url:"/api/page/pages/batch",method:"post",data:{data:e,method:"delete",pageType:i}};this.$util.request(r).then((function(e){n.$message.success("删除成功"),"function"===Object(y.g)(t)&&t(e)})).catch((function(e){"function"===Object(y.g)(a)&&a(e)}))},handleAdd:function(){this.initFormData(),this.form.visible=!0},handleImport:function(e){this.handleImportVisibleChange(!0),this.importSetting.groupId=this.tree.currentNode.id},handleExport:function(e){var t=this,a={url:"/api/page/pages/export",method:"post",data:{pageIdList:[e.id],pageType:e.pageType},meta:{validate:!0}};return this.$util.request(a).then((function(a){try{Object(y.f)("".concat(e.name,".json"),JSON.stringify(a))}catch(a){t.doLogHandler({message:a.message,info:"".concat(t.isSDC?"二开组件":"页面","导出失败")},"warn"),Object(y.f)("".concat(e.name,".json"),JSON.stringify({errorMessage:"".concat(t.isSDC?"二开组件":"页面","导出失败！")}))}})).catch((function(e){t.doLogHandler({message:e.message,info:"".concat(t.isSDC?"二开组件":"页面","导出失败")},"warn")}))},handleEdit:function(e){if("0"!==e.id){var t=e.pageType,a=[1,5].includes(t)?this.formGroup:this.form,i=a.data;i.id=e.id,i.name=e.name,i.componentName=e.componentName,i.title=e.title,i.description=e.description||"",i.pageType=e.pageType,i.permissionId=e.permissionId,i.orgId=e.orgId,i.parentId=e.parentId,a.visible=!0}else this.$message.warning("根节点不允许修改！")},handleDel:function(e){var t=this;"0"!==e.id?this.$confirm("你确定要删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var a=e.pageType,i=[e.id];t.pageDeleteHandle(i,(function(i){[1,5].includes(a)?t.removeNode(e):t.refreshTable()}),void 0,a)})):this.$message.warning("根节点不允许删除！")},handleFilterSearch:function(){this.refreshTable()},handleFilterReset:function(){this.searchTable()},handleFormDialogClose:function(){},handleFormLoading:function(e){Reflect.set(this,"loading",{beforeLoginPage:e,afterLoginPage:e,theme:e,menu:e})},handleFormSubmit:function(e){var t=this;e.data.path=e.data.name;var a=e.data.pageType,i=this.handleRules(e.data);!0===i?(this.isSDC&&(e.data.parentId=this.getQueryVariable("parentId"),e.data.projectIdentifier=this.getQueryVariable("projectIdentifier")),e.data.id?this.pageSaveHandle(e,(function(i){if([1,5].includes(a))return t.updateNode(e.data),void(e.visible=!1);e.visible=!1,t.refreshTable()})):this.pageCreateHandle(e,(function(i){var n=i.id;if([1,5].includes(a))return t.appendNode(C(C({},e.data),{},{id:n})),void(e.visible=!1);e.visible=!1,e.currentId=n,t.refreshTable()}))):this.$message.warning(i)},handleRules:function(e){return e.name&&e.name.length>50?"名称不能超过50字符！":e.path&&e.path.length>100?"路径不能超过100字符！":!(e.description&&e.description.length>500)||"描述不能超过500字符！"},appendNode:function(e){var t=this.$refs.tree.getTreeContext();if(t){var a=t.getNode(e.parentId);if(a){var i=a.childNodes,n=i[0]&&i[0].data.id;n?t.insertBefore(e,n):t.append(e,e.parentId)}this.refreshTree()}},updateNode:function(e){var t=this.$refs.tree.getTreeContext();if(t){var a=t.getNode(e.id);a&&(a.data.name=e.name,a.data.description=e.description)}},removeNode:function(e){var t=this.$refs.tree.getTreeContext();t&&t.remove(e),this.tree.currentNode.id="0",this.tree.currentNode.name="/",this.form.data.parentId="0",this.formGroup.data.parentId="0",this.setTreeCurrentKey(),this.handleCurrentChange({id:"0",name:"/"}),this.setLeveCode()},resetTree:function(){this.tree.searchName="",this.handleTreeSearch(this.tree.searchName)},resetFilter:function(){this.$refs.filter&&this.$refs.filter.handleFilterReset()},handleImportFormSubmit:function(){this.importSetting.file?(this.isSDC&&(this.importSetting.groupId=this.getQueryVariable("parentId"),this.importSetting.projectIdentifier=this.getQueryVariable("projectIdentifier")),this.doModelImport(this.importSetting)):this.$message.error("请上传".concat(this.isSDC?"二开组件":"页面","json文件！"))},doModelImport:function(e){var t=this,a=new FormData;a.append("pageFile",e.file),a.append("groupId",e.groupId),this.isSDC&&a.append("projectIdentifier",e.projectIdentifier),a.append("forceCover",e.forceCover),a.append("autoPublish",1),a.append("pageType",this.isSDC?6:2);var i={url:"/api/page/pages/import",method:"post",headers:{"Content-Type":"multipart/form-data"},data:a};return this.$util.request(i).then((function(){t.$message.success("导入成功！"),t.handleImportFormDialogClose(),t.handleFilterSearch()})).catch((function(e){t.doLogHandler({message:e.message,info:"".concat(t.isSDC?"二开组件":"页面","导入失败")},"warn")}))},handleImportFormDialogClose:function(){this.$refs.importUpload.handleFileClean(),this.handleImportVisibleChange(!1),this.initImportFormData()},handleImportVisibleChange:function(e){this.importSetting.importVisible=!!e},initImportFormData:function(){this.importSetting.file=null}}},T=(a("e8ad"),a("a077"),Object(l.a)(O,(function(){var e=this,t=e._self._c;return t("el-row",{staticClass:"hc-page-manage"},[e.isSDC&&e.isManagement?e._e():t("el-col",{staticClass:"hc-group-tree",attrs:{span:9}},[t("basic-container",{staticStyle:{"padding-top":"0","padding-bottom":"0"},attrs:{loading:e.tree.loading}},[t("div",{staticClass:"hc-group-tree-header"},[t("el-row",{attrs:{gutter:5}},[t("el-col",{attrs:{span:"readonly"!==e.mode?16:24}},[t("el-input",{attrs:{placeholder:"输入分组名称",clearable:!0},on:{clear:e.handleTreeSearch},model:{value:e.tree.searchName,callback:function(t){e.$set(e.tree,"searchName",t)},expression:"tree.searchName"}},[t("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.handleTreeSearch},slot:"append"})],1)],1),"readonly"!==e.mode?t("el-col",{staticStyle:{"text-align":"right"},attrs:{span:8}},[t("el-button",{attrs:{type:"success",icon:"el-icon-plus"},on:{click:e.handleTreeAdd}},[e._v("新增分组")])],1):e._e()],1)],1),t("div",{staticClass:"hc-group-tree-content",style:e.treeStyles},[t("selector-async",{ref:"tree",attrs:{fetchOption:e.tree.fetchOption,props:e.tree.treeProps,nodeKey:e.tree.nodeKey,rootNode:e.tree.rootNode,highlightCurrent:e.tree.highlightCurrent,expandOnClickNode:e.tree.expandOnClickNode,defaultExpandedKeys:e.groupId,defaultCheckedKeys:[e.groupId]},on:{"current-change":e.handleCurrentChange,done:e.handleTreeDone}})],1)])],1),t("el-col",{staticClass:"hc-main-content",attrs:{span:e.isSDC&&e.isManagement?24:15}},[t("basic-container",{staticStyle:{"padding-top":"0","padding-bottom":"0"}},[t("basic-filter",{ref:"filter",attrs:{mdSpan:e.filter.mdSpan,lgSpan:e.filter.lgSpan,columns:e.filter.filterColumn},on:{reset:e.handleFilterReset,search:e.handleFilterSearch},model:{value:e.filter.filters,callback:function(t){e.$set(e.filter,"filters",t)},expression:"filter.filters"}}),t("basic-table",{ref:"table",attrs:{filters:e.filter.filters,tableColumn:e.table.tableColumn,fetchOption:e.table.fetchOption,rowHandlers:e.table.rowHandlers,rowHandlerFixed:e.table.rowHandlerFixed,showToolbarRight:e.table.showToolbarRight,highlightCurrentRow:e.table.highlightCurrentRow,height:e.table.height,preloadingData:e.table.preloadingData,defaultSort:e.table.defaultSort,size:"mini"},on:{"current-change":e.handleCurrentRowChange,done:e.handleTableDone}},["full"===e.mode?t("template",{slot:"handler"},[t("el-button",{attrs:{type:"success",icon:"el-icon-plus"},on:{click:e.handleAdd}},[e._v("\n            新增"+e._s(e.isSDC?"二开组件":"页面")+"\n          ")]),t("el-button",{attrs:{type:"default",icon:"el-icon-upload2"},on:{click:e.handleImport}},[e._v("\n            导入"+e._s(e.isSDC?"二开组件":"页面")+"\n          ")])],1):e._e()],2),"full"===e.mode?t("basic-form",{ref:"inputForm",attrs:{width:"600px",formData:e.importSetting,dialogTitle:"导入"+(e.isSDC?"二开组件":"页面")},on:{submit:e.handleImportFormSubmit,close:e.handleImportFormDialogClose},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-form-item",{attrs:{label:"强制覆盖"}},[t("el-switch",{attrs:{"active-value":1,"inactive-value":0,"active-text":"是","inactive-text":"否"},model:{value:e.importSetting.forceCover,callback:function(t){e.$set(e.importSetting,"forceCover",t)},expression:"importSetting.forceCover"}})],1),t("el-form-item",{attrs:{label:(e.isSDC?"二开组件":"页面")+"文件",prop:e.importSetting.file}},[t("basic-upload",{ref:"importUpload",staticClass:"hc-basic-upload-import",attrs:{autoUpload:!0,accept:e.importSetting.importAccept,fileSize:e.importSetting.importFileSize},model:{value:e.importSetting.file,callback:function(t){e.$set(e.importSetting,"file",t)},expression:"importSetting.file"}},[t("span",{attrs:{slot:"tip"},slot:"tip"},[t("span",[e._v("将")]),t("span",{staticStyle:{color:"#E6A23C"}},[e._v(e._s(e.isSDC?"二开组件":"页面")+"json文件")]),t("span",[e._v("拖到此处，或")])]),e._t("default",(function(){return[e._v("\n                只能上传JSON文件，且不超过20MB\n              ")]}),{slot:"description"}),t("iconfont",{attrs:{slot:"img",colorful:!0,type:"icon-json"},slot:"img"})],2)],1),e.isSDC?e._e():t("el-form-item",{attrs:{label:"所属分组",prop:e.importSetting.groupId}},[t("selector-tree",{ref:"formImportGroupSelectTree",attrs:{fetchOption:e.selectorTree.fetchOption,"root-node":e.selectorTree.rootNode,props:e.selectorTree.treeProps,placeholder:"请选择所属分组"},on:{focus:function(){return e.handleSelectorTreeFocus("afterLoginPage")},done:e.handleSelectorTreeDone},model:{value:e.importSetting.groupId,callback:function(t){e.$set(e.importSetting,"groupId",t)},expression:"importSetting.groupId"}})],1)]}}],null,!0),model:{value:e.importSetting.importVisible,callback:function(t){e.$set(e.importSetting,"importVisible",t)},expression:"importSetting.importVisible"}}):e._e(),"full"===e.mode?t("basic-form",{attrs:{width:e.form.width,modalAppendToBody:e.form.modalAppendToBody,loading:e.form.loading,formData:e.form.data,rules:e.form.rules,title:e.isSDC?"二开组件":"页面"},on:{submit:function(t){return e.handleFormSubmit(e.form)},close:e.handleFormDialogClose},model:{value:e.form.visible,callback:function(t){e.$set(e.form,"visible",t)},expression:"form.visible"}},[t("el-form-item",{attrs:{label:e.isSDC?"二开组件别名":"页面名称",prop:"name"}},[t("el-input",{attrs:{placeholder:"请输入".concat(e.isSDC?"二开组件":"页面","名称")},model:{value:e.form.data.name,callback:function(t){e.$set(e.form.data,"name",t)},expression:"form.data.name"}})],1),e.isSDC?t("el-form-item",{attrs:{label:"二开组件名称",prop:"componentName"}},[t("el-input",{attrs:{placeholder:"请输入二开组件名称"},model:{value:e.form.data.componentName,callback:function(t){e.$set(e.form.data,"componentName",t)},expression:"form.data.componentName"}})],1):e._e(),e.isSDC?e._e():t("el-form-item",{attrs:{label:"所属分组",prop:"parentId"}},[t("selector-tree",{ref:"formSelectTree",attrs:{fetchOption:e.selectorTree.fetchOption,"root-node":e.selectorTree.rootNode,props:e.selectorTree.treeProps,placeholder:"请选择所属分组"},on:{focus:function(){return e.handleSelectorTreeFocus("afterLoginPage")},done:e.handleSelectorTreeDone},model:{value:e.form.data.parentId,callback:function(t){e.$set(e.form.data,"parentId",t)},expression:"form.data.parentId"}})],1),t("el-form-item",{attrs:{label:"".concat(e.isSDC?"二开组件":"页面","描述"),prop:"description"}},[t("el-input",{attrs:{type:"textarea",rows:5,placeholder:"请输入".concat(e.isSDC?"二开组件":"页面","描述")},model:{value:e.form.data.description,callback:function(t){e.$set(e.form.data,"description",t)},expression:"form.data.description"}})],1)],1):e._e(),"readonly"!==e.mode?t("basic-form",{attrs:{width:e.formGroup.width,modalAppendToBody:e.formGroup.modalAppendToBody,loading:e.formGroup.loading,formData:e.formGroup.data,rules:e.formGroup.rules,title:"分组"},on:{submit:function(t){return e.handleFormSubmit(e.formGroup)},close:e.handleFormDialogClose},model:{value:e.formGroup.visible,callback:function(t){e.$set(e.formGroup,"visible",t)},expression:"formGroup.visible"}},[t("el-form-item",{attrs:{label:"分组名称",prop:"name"}},[t("el-input",{attrs:{placeholder:"分组名称"},model:{value:e.formGroup.data.name,callback:function(t){e.$set(e.formGroup.data,"name",t)},expression:"formGroup.data.name"}})],1),t("el-form-item",{attrs:{label:"所属分组",prop:"parentId"}},[t("selector-tree",{ref:"formGroupSelectTree",attrs:{fetchOption:e.selectorTree.fetchOption,"root-node":e.selectorTree.rootNode,props:e.selectorTree.treeProps,placeholder:"请选择所属分组"},on:{focus:function(){return e.handleSelectorTreeFocus("afterLoginPage")},done:e.handleSelectorTreeDone},model:{value:e.formGroup.data.parentId,callback:function(t){e.$set(e.formGroup.data,"parentId",t)},expression:"formGroup.data.parentId"}})],1)],1):e._e()],1)],1)],1)}),[],!1,null,"9ed80e9c",null)).exports,V=(a("ac4d"),a("8a81"),a("5df3"),a("1c4c"),a("6b54"),a("f559"),a("96cf"),a("3b8d")),w=a("768b"),P=(a("aef6"),a("3b2b"),a("967e")),x=a.n(P),S=(a("8615"),a("4917"),a("c276")),j=void 0;function E(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function k(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?E(Object(a),!0).forEach((function(t){Object(f.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):E(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function I(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return A(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?A(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,l=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return o=e.done,e},e:function(e){l=!0,r=e},f:function(){try{o||null==a.return||a.return()}finally{if(l)throw r}}}}function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=new Array(t);a<t;a++)i[a]=e[a];return i}var D=function(e){var t=window.$VUE_ROOT.$store.getters.getPageParserInstanceByPageId;if("function"===Object(y.g)(t))return t(e)},N=function(e){var t=window.$VUE_ROOT.$store.getters.getComponentInstanceByPageId;if("function"===Object(y.g)(t))return t(e)},$=function(e){var t=window.$VUE_ROOT.$store.getters.getComponentInstanceByComponentName;if("function"===Object(y.g)(t))return t(e)},L=function(e,t,a){var i="object"===Object(y.g)(e)?e[e.type]:e,n=/^\${(.+)}$/g.exec(i);if(!n)return i;var r=n[1];if(!r)return"";if(r=r.replace(/(^\s*)|(\s*$)/g,""),a&&a.hasOwnProperty(r))return a[r]||"";var o=r.split("."),l=null;if(o.forEach((function(e,t){l=0===t?a&&a[e]:l&&l[e]})),l)return l;var s=D(t);if(!s)return"";var c=s.getVariable(r);return void 0===c?"":c},M=function(e,t){var a=[],i=function(e){var t=D(e);return t?["Page","Arguments","pageVariable","customVariable","Response","Request",t.getPageFid()]:[]}(t);return e.forEach((function(e){i.find((function(t){return t===e}))||a.push(e)})),a},q=function(e,t,a,i){var n=M(e,t);if(n&&null!=n&&n.length){var r;if(["item","$parent_item"].includes(n[0]))return n.forEach((function(e,t){r=["item","$parent_item"].includes(e)&&0===t?a[e]:r?r[e]:void 0})),r;var o,l=n.join(".");if(a&&a.hasOwnProperty(l))return a[l];if(l.indexOf(":")>-1){var s,c,u=l.slice(0,l.lastIndexOf(":"));if(i&&(c=D(t)).fromPageId)s=N(c.fromPageId)[u];o=function(e,t){var a=window.$VUE_ROOT.$store.getters.getPageParserInstanceByIframeNameInPageId;if("function"===Object(y.g)(a))return a(e,t)}(s?c.fromPageId:t,u),l=l.slice(l.lastIndexOf(":")+1,l.length)}else o=D(t);if(o)return o.getVariable(l)}},B=function(e,t,a,i,n,r){if("object"!==Object(y.g)(e))return e;var o=e.type,l=e[e.type],s=null==e?void 0:e.useExpression;if((window.$VUE_ROOT.$store.getters.getMethodParamTypes||["static"]).includes(o))return H(l,t,a,s);if("page"===o){if(2===e.source)return H(e.webUrl,t,a,s);if(3===e.source){if(!0===e.useLastName){var c=null==e?void 0:e.variable;return c?c[c.length-1]:""}return!0===e.useOnlyName?((null==e?void 0:e.variable)||[]).join("."):q(e.variable,t,a,r)}return l.id}if("variable"===o){if(!0===e.useLastName){var u=l?l[l.length-1]:"";return u.indexOf(":")>-1?u.slice(u.lastIndexOf(":")+1,u.length):u}return!0===e.useOnlyName?((l=(l||[]).map((function(e){return(e||"").indexOf(":")>-1?e.slice(e.lastIndexOf(":")+1,e.length):e})))||[]).join("."):q(l,t,a,r)}return"script"===o?J.call(n,null==e?void 0:e.content,t,a,i):l},F=function e(t,a,i,n,r,o){if(!t||!t.length)return null;var l,s={},c=I(t);try{for(c.s();!(l=c.n()).done;){var u=l.value;if(u.returnValue)s[u.name]=void 0;else if(u.isCallback)s[u.name]=u.callbacks;else if(u.isObject&&u.objectAttr){var d=e(u.objectAttr,a,i,n,r,o);s=k(k({},s),d)}else u.editValue?s[u.name]=B(u.editValue,i,a,n,r,o):s[u.name]=Object(S.pb)(u.value,u.default)}}catch(e){c.e(e)}finally{c.f()}return s},R=function(e){var t={};return e?(t.functionName=e[e.length-1],t.componentName=e[0],t):t},K=function(e,t,a){if(void 0!==t)return e+" "+a+" "+t},U=function(e){var t="";return e.forEach((function(e){if("pageVariables"===e.name){var a=e.editValue;if(a&&"variable"===a.type){var i=a.variable;i&&"array"===Object(y.g)(i)&&(t=i[i.length-1])}}})),t},z=function(e,t,a,i,n,r){if(e){var o=e[i];if(o&&"function"===Object(y.g)(o)){var l,s=F(n.payloads,r,t,a,e,n.isOtherIframe),c=Object(y.e)(Object(S.M)(s));try{if("$openDialog"===i&&(c.fromPageId=t,c.bodyHeight=c.height,c.pageParse=D(t),c.includedSelf)){var u=c.pageVariables,d=U(n.payloads);c.pageVariables={},c.pageVariables[d]=u}if("$openDrawer"===i&&(c.fromPageId=t,c.pageParse=D(t),c.includedSelf)){var p=c.pageVariables,h=U(n.payloads);c.pageVariables={},c.pageVariables[h]=p}if("$openUrl"===i&&c.includedSelf){var f=c.pageVariables,m=U(n.payloads);c.pageVariables={},c.pageVariables[m]=f}if("$notify"===i){var v=Math.pow(10,9)-1;c.duration>v&&(c.duration=v)}if("$confirmDialog"===i&&(c.args=r),"$openCodeEditor"===i&&(c.fromPageId=t,c.bodyHeight=c.height),"$conditionalBranch"===i&&(c||(c={}),c.args=r,c.conditionalBranches=n.conditionalBranches,"object"===Object(y.g)(a)&&(c.target=Object(y.e)(a)),c.pageId=t),"$assets"===i){c||(c={}),c.args=r;var b=F(n.assets.payloads,r,t,a,e,n.isOtherIframe);c.assets=k(k({},n.assets),{},{payloads:b}),"object"===Object(y.g)(a)&&(c.target=Object(y.e)(a)),c.pageId=t}if(!(i||"").indexOf("$_")&&Object(S.tb)(c)){var g=[],_=null==a?void 0:a.attributes;if(null!=_&&_.length){var C=_.find((function(t){return t.pageComponentMethod.value===i||t.pageComponentMethod.value===i+"_"+e.data.fid}));if(C){var O,T,V=null==C||null===(O=C.executionContent)||void 0===O||null===(T=O.editValue)||void 0===T?void 0:T.payloads;null!=V&&V.length&&(g=V.map((function(e){return e.name})))}}else"array"===Object(y.g)(a)&&n&&(g=((null==n?void 0:n.payloads)||[]).map((function(e){return e.name})));l=o.apply(e,g.map((function(e){return c[e]})))}else l=o.call(e,c)}catch(e){this.$sendLog({logData:{message:e.message,info:Object(S.yb)({pageId:t,componentName:a.componentName,componentFid:a.componentFid,functionName:i})},logTitle:"事件方法执行错误"})}var w=function(e){if("array"===Object(y.g)(e))return e.filter((function(e){return e.returnValue}))[0]}(n.payloads);if(w){var P=function(e){if("array"===Object(y.g)(e))return e.filter((function(e){return"attrName"===e.name}))[0]}(n.payloads);return void this.$setVariable(w.value,l,P&&P.value)}return l}}else this.$sendLog({logData:{message:"方法执行失败，执行方法所属的组件可能已经被删除！",info:Object(S.yb)({pageId:t,componentName:a.componentName,componentFid:a.componentFid,functionName:i})},logTitle:"执行方法时未找到组件实例"})},G=function(e,t,a,i){var n,r,o,l,s,c,u,d;if(e){var p=R(e.fn),h=p.functionName,f=p.componentName;if(new RegExp(S.d).test(p.functionName)){var m=p.functionName.lastIndexOf("_");h=p.functionName.slice(0,m),f=p.functionName.slice(m+1,p.functionName.length)}var v=N(t);if(v){var b=v[f];if(!b)if(f.indexOf("_")>-1)b=$(f),e.isOtherIframe=!0;else{var g=D(t);if(g.fromPageId)(b=N(g.fromPageId)[f])&&(t=g.fromPageId)}var y=(null===(n=b)||void 0===n||null===(r=n.data)||void 0===r||null===(o=r.attributes)||void 0===o||null===(l=o.foreachData)||void 0===l?void 0:l.componentName)||"",_=(null===(s=b)||void 0===s||null===(c=s.data)||void 0===c||null===(u=c.attributes)||void 0===u||null===(d=u.foreachData)||void 0===d?void 0:d.value)||[];if(!_||!_.length){var C=(null==i?void 0:i.componentName)||"",O=new RegExp("-copy-(\\d)$"),T=C.match(O),V=b;if(null!=T&&T.length&&T[1]&&!isNaN(+T[1])){var w,P,x,j,E=null===(w=b)||void 0===w||null===(P=w.data)||void 0===P||null===(x=P.attributes)||void 0===x||null===(j=x.componentName)||void 0===j?void 0:j.value,k=this.$getComponent("".concat(E,"-copy-").concat(T[1]));k&&(V=k)}return z.call(this,V,t,i,h,e,a)}for(var I in _){var A=this.$getComponent("".concat(y,"-copy-").concat(I));z.call(this,A,t,i,h,e,a)}}else this.$sendLog({logData:{message:"方法执行失败，当前页面的组件实例未找到！",info:Object(S.yb)({pageId:t,componentName:i.componentName,componentFid:i.componentFid,functionName:h})},logTitle:"执行方法时未找到当前页面的组件实例"})}},H=function(e,t,a,i){var n=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("boolean"==typeof e)return e;if(e){var r=!1,o="array"===Object(y.g)(e)||"object"===Object(y.g)(e);if(o&&(e=JSON.stringify(e),r=!0),"string"!=typeof e)return e;var l=/\$\{(.*?)\}/g,s=e.match(l),c=e;if(null!=s&&s.length&&s.forEach((function(e){var i=L(e,t,a);i instanceof Object&&(i=JSON.stringify(i)),c=c.replace(e,""===i&&n?null:i)})),r)try{c=JSON.parse(c)}catch(t){c=JSON.parse(e)}if(i)try{return Object(y.a)(c)}catch(e){return c}return c}},W=function(e,t,a,i){var n=this;if(e){var r,o=H(e.url,t,a),l=e.method||e.type,s=e.isValidation,c=e.payloads,u="multipart/form-data"===e.contentType,d={"Content-Type":e.contentType||"application/json"},p=e.callbacks,h=e.errorCallbacks,m=u?new FormData:{},v=[],b=I(c);try{for(b.s();!(r=b.n()).done;){var g=r.value,_=B(g.editValue,t,a),C=g.filter;if(C){var O=K("".concat(g.name).trim(),_,C);O&&v.push(O)}else u?m.append(g.name,_):m[g.name]=_}}catch(e){b.e(e)}finally{b.f()}v.length&&(u?m.append("$filter",v.join(",")):m.$filter=v.join(","));var T={url:o,method:l,isValidation:s,headers:d,params:Object(y.e)(Object(S.M)(m))};if(e.responseType&&(T.responseType=e.responseType),e.errorValidator){T.meta||(T.meta={}),T.meta.errorValidator=function(t){if(e.errorValidator&&e.errorValidator.length>0&&t.error){var a=e.errorValidator.filter((function(e){return e.errorId===t.error.errorId}));return a.length>0?n.$message.error(a[0].message):t.error.message&&n.$message.error(t.error.message),!1}}}var V=this.$getPageParser(t);if(V&&!1!==s){var w=V.validation(m.componentName);if(T.isValidation=!w,!0!==w)return}var P=e.beforeEvents;!1!==this.$eventContentParse(P,k(k({},a),{},{options:T}))&&this.$request(T).then((function(e){var t=Object(S.eb)("result",a);n.$eventContentParse(p,k(k({},a),{},Object(f.a)({},t,e)))})).catch((function(e){var r,o=e.code,l=Object(S.eb)("error",a);n.$eventContentParse(h,k(k({},a),{},Object(f.a)({},l,null!==(r=e.data)&&void 0!==r?r:e))),"CheckFailed"!==o&&n.$sendLog({logData:{message:e.message,info:Object(S.yb)({pageId:t,componentName:i.componentName,componentFid:i.componentFid})},logTitle:"事件方法执行错误"})}))}},J=function(e,t,a,i){if(e){var n,r="string"===Object(y.g)(e)?e:e.content;try{n=this.$parseScript(r,a)}catch(e){this.$sendLog({logData:{message:e.message,info:Object(S.yb)({pageId:t,componentName:i.componentName,componentFid:i.componentFid})},logTitle:"事件脚本执行出错"})}return n}},Y=function(e,t){var a,i;if("Page"!==e.componentType){var n=this.$getPageParser(t);if(!n)return{item:null,itemIndex:-1};var r=n.findForeachItemAndIndex(null==this||null===(a=this.data)||void 0===a?void 0:a.fid),o=n.findForeachItemAndIndex(null==this||null===(i=this.data)||void 0===i?void 0:i.parentFid);return o={$parent_item:o.item,$parent_itemIndex:o.itemIndex},Object.assign(r,o)}},Z=function(e,t,a){var i;if(e){var n="object"===Object(y.g)(e)?e.attributes:e;if(n&&n.length&&(a=a||(null===(i=this.data)||void 0===i?void 0:i.pageId)))if((n||[]).find((function(e){var t;return!(null==e||null===(t=e.executionType)||void 0===t||!t.value)}))){var r=Y.call(this,e,a),o=k(k({},t),r),l={};for(var s in n){var c=n[s];if(!Object.values(l).some((function(e){return!1===e}))){var u=c.executionType,d=c.executionContent,p=Object(S.pb)(u.value,u.default),h=Object(S.pb)(d.editValue,d.value);if("method"!==p)if("api"!==p)"script"===p&&(l[s]=J.call(this,h,a,o,e));else{if(!h)continue;var f=h.beforeEvents;if(!1===this.$eventContentParse(f,k({},o)))continue;l[s]=W.call(this,h,a,o,e)}else l[s]=G.call(this,h,a,o,e)}}return!Object.values(l).some((function(e){return!1===e}))}}},Q=function e(t,a,i){var n,r={pageIdAndFid:[],componentName:[]},o=I(t=t||[]);try{var l=function(){var t,o=n.value;if(null==o||null===(t=o.executionType)||void 0===t||!t.value)return 0;var l=Object(S.pb)(o.executionType.value,o.executionType.default),s=Object(S.pb)(o.executionContent.editValue,o.executionContent.value);if(!s)return 0;var c=function e(t){t.forEach((function(t){if(t.isObject&&t.objectAttr)e(t.objectAttr);else if(t.editValue){var n=t.editValue.type;if("variable"===n&&!t.editValue.useLastName&&!t.editValue.useOnlyName){var o=t.editValue[n],l=M(o,i);if(!("item"===l[0]||a&&a.hasOwnProperty(l.join(".")))){var s,c=I(l);try{for(c.s();!(s=c.n()).done;){var u=s.value;u.indexOf(":")>-1&&(r.componentName.push(u.slice(0,u.lastIndexOf(":"))),r.pageId=i)}}catch(e){c.e(e)}finally{c.f()}}}}}))};if("method"===l){var u=R(s.fn).componentName;u.indexOf("_")>-1&&(r.pageIdAndFid.push(u),r.pageId=i),c(s.payloads)}else if("script"===l);else if("api"===l){for(var d in s){var p=s[d];if(p.length&&p[0].hasOwnProperty("executionContent")){var h=e(s.beforeEvents,null,i);h.pageId&&(r.pageId=i,r.pageIdAndFid=r.pageIdAndFid.concat(h.pageIdAndFid),r.componentName=r.componentName.concat(h.componentName))}}c(s.payloads)}};for(o.s();!(n=o.n()).done;)l()}catch(e){o.e(e)}finally{o.f()}return r},X=function(e){return e.pageIdAndFid.every((function(e){return Object(S.r)(e)}),j)&&e.componentName.every((function(t){return Object(S.q)(t,e.pageId)}),j)},ee=Z=new Proxy(Z,{apply:function(e,t,a){var i,n,r=Q.apply(t,[null===(i=a[0])||void 0===i?void 0:i.attributes,a[1],a[2]||(null==t||null===(n=t.data)||void 0===n?void 0:n.pageId)]);return r.pageId?Object(V.a)(x.a.mark((function i(){return x.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,Object(S.Eb)(X,r,1e4);case 2:return i.abrupt("return",e.apply(t,a));case 3:case"end":return i.stop()}}),i)})))():e.apply(t,a)}}),te=(a("20d6"),function(e){for(var t=[7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2],a=e+"",i=e[17],n=a.substring(0,17).split(""),r=n.length,o=0,l=0;l<r;l++)o+=n[l]*t[l];return!!(i===["1","0","X","9","8","7","6","5","4","3","2"][o%11]&/^[1-9][0-9]{5}([1][9][0-9]{2}|[2][0][0|1][0-9])([0][1-9]|[1][0|1|2])([0][1-9]|[1|2][0-9]|[3][0|1])[0-9]{3}([0-9]|[X])$/.test(e))}),ae={required:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return"string"==typeof e?a?e.length>0:e.trim().length>0:!(null==e||"number"==typeof e&&isNaN(e))},maxlength:function(e,t,a){return"string"!=typeof e||(a?e.length<=t.maxlength:e.trim().length<=t.maxlength)},minlength:function(e,t,a){return"string"!=typeof e||(a?e.length>=t.minlength:e.trim().length>=t.minlength)},email:function(e){return/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(e)},url:function(e){return/^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(e)},date:function(e){return/^(\d{4})-(\d{2})-(\d{2})$/i.test(e)},dateISO:function(e){return/^\d{4}[\/\-]\d{1,2}[\/\-]\d{1,2}$/.test(e)},number:function(e){return/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(e)},digits:function(e){return/^\d+$/.test(e)},positiveinteger:function(e){var t=parseInt(e);return t>0&&t+""===e},integer:function(e){return/^-?[1-9]\d*$/.test(e)||/^0*$/.test(e)},digital:function(e){return/^\d*\.{0,1}\d{0,9}\.{0,1}\d{0,9}$/.test(e)},decimalOne:function(e){return/^(\d+(\.\d{1,2})?)$/g.test(e)},decimalTwo:function(e){return/^(\d+(\.\d{1,2})?)$/g.test(e)},decimalFour:function(e){return/^(\d+(\.\d{1,4})?)$/g.test(e)},decimalSix:function(e){return/^(\d+(\.\d{1,6})?)$/g.test(e)},creditcard:function(e){if(/[^0-9 \-]+/.test(e))return!1;for(var t=0,a=0,i=!1,n=(e=e.replace(/\D/g,"")).length-1;n>=0;n--){var r=e.charAt(n);a=parseInt(r,10),i&&(a*=2)>9&&(a-=9),t+=a,i=!i}return t%10==0},hzsx:function(e){return/^[a-zA-Z0-9_\u4e00-\u9fa5]+$/g.test(e)},szx:function(e){return/^\w+$/g.test(e)},equalLength:function(e,t){return!0},maxCharCodelength:function(e,t){return!0},min:function(e,t){return e>=t.min},max:function(e,t){return e<=t.max},range:function(e,t){return e>=t[0]&&e<=t[1]},notEqualTo:function(e,t){return!0},idCard:function(e){return te(e)},useName:function(e){return/^[\Α-\￥\w]+$/.test(e)},mobile:function(e){return/^1[3|4|5|6|7|8|9]\d{9}$/.test(e)},tel:function(e){return/^(\d{3,4}-?)?(\d{3,4}-?)?\d{3,8}$/g.test(e)},inputBox:function(e){return/^[a-zA-Z0-9_\s-]{1,}$/.test(e)},inputBox1:function(e){return/^[0-9A-Z_-]{1,}$/.test(e)},inputBox2:function(e){return/^[a-zA-Z0-9\u4e00-\u9fa5]{1,}$/.test(e)},contact:function(e){var t=e.length;return 11===t&&/^0?1[3|4|5|6|7|8|9][0-9]\d{8}$/g.test(e)||t>=7&&/^(\d{3,4}-?)?(\d{3,4}-?)?\d{2,7}$/g.test(e)},fax:function(e){return/^(([0\+]\d{2,3}-?)?(0\d{2,3})-?)?(\d{7,8})([-|转]?(\d{3,}))?$/.test(e)},zipCode:function(e){return/^[0-9]{6}$/.test(e)},datetime:function(e){return/(\d{2}|\d{4})(?:\-)?([0]{1}\d{1}|[1]{1}[0-2]{1})(?:\-)?([0-2]{1}\d{1}|[3]{1}[0-1]{1})(?:\s)?([0-1]{1}\d{1}|[2]{1}[0-3]{1})(?::)?([0-5]{1}\d{1})(?::)?([0-5]{1}\d{1})/.test(e)},splitMaxlength:function(e,t){return e.split(",").length<=t},splitMinlength:function(e,t){return e.split(",").length>=t},filetype:function(e,t){t="string"==typeof t?[t]:t;var a=e.toLowerCase().split("."),i=a[a.length-1];return-1!==t.findIndex((function(e){return e===i}))},hex:function(e){return/^[0-9a-fA-F]{4}$/.test(e)},hex2:function(e){return/^[0-9a-fA-F]{8}$/.test(e)},letterAndNumber:function(e){return/(([a-zA-Z]+[0-9]+)|([0-9]+[a-zA-Z]+))[a-zA-Z0-9]*/.test(e)},inputLetterOrNumber:function(e){return/^[a-zA-Z0-9]{1,}$/.test(e)},letterAndNumberAndCharacters:function(e){return/([a-zA-Z]+[\d]+[@#\$&_\.]*)|([\d]+[a-zA-Z]+[@#\$&_\.]*)|([a-zA-Z]+[@#\$&_\.]*[\d]+)|([\d]+[@#\$&_\.]*[a-zA-Z]+)/.test(e)},specialCharacters:function(e){return/^[a-zA-Z0-9\u4e00-\u9fa5_-]{1,}$/.test(e)},firstCharactersChecked:function(e){return/^[M|m|D|d]+\d+$/.test(e)},ip:function(e){if(!e)return!1;return!!(/^(\d+)\.(\d+)\.(\d+)\.(\d+)$/g.test(e)&&RegExp.$1<256&&RegExp.$2<256&&RegExp.$3<256&&RegExp.$4<256)},port:function(e){if(!e)return!1;return!!(/^\d+$/.test(e)&&e<65536)},score:function(e){return!!e&&window.$common.$util.getPswScore(e,12,4)>=4}},ie={required:"必填字段",maxlength:"最大长度不能大于${maxlength}",minlength:"最小长度不能小于${minlength}",max:"最大值不能大于${max}",min:"最小值不能小于${min}",remote:"您输入的值已经存在，请重新输入",email:"请输入正确格式的电子邮件",url:"请输入合法的网址",date:"请输入合法的日期",dateISO:"请输入合法的日期 (ISO).",number:"请输入合法的数字",positiveinteger:"只能输入正整数",digits:"只能输入正整数和零",integer:"只能输入整数",digital:"只能输入数字和小数点",decimalOne:"只能输入数字和最多一位小数",decimalTwo:"只能输入数字和最多两位小数",decimalFour:"只能输入数字和最多四位小数",decimalSix:"只能输入数字和最多六位小数",creditcard:"请输入合法的信用卡号",equalTo:"请再次输入相同的值",accept:"请输入拥有合法后缀名的字符串",idCard:"请输入正确的身份证号码",useName:"用户名只能包括中文字、英文字母、数字和下划线",mobile:"请输入正确的手机号码",tel:"请输入正确的电话号码",contact:"请输入正确的手机号或电话号码",fax:"请输入正确传真号码",zipCode:"请输入正确的邮政编码",datetime:"请输入正确的时间格式：YYYY-MM-DD HH:MM:SS",compareDate:"结束日期必须大于开始日期",compareEqualDate:"结束日期必须大于或者等于开始日期",compareLessThanDate:"开始日期必须小于结束日期",compareLessThanEqualDate:"开始日期必须小于或者等于结束日期",compareTime:"结束时间必须大于开始时间",filetype:"上传的文件类型不允许",inputBox:"只允许输入数字、字母、连接符、下划线、空格符的组合",inputBox1:"只允许输入数字、大写字母、下划线和分隔符的组合",inputBox2:"只允许输入中文、数字和字母的组合",hex:"只允许输入4位十六进制字符",hex2:"只允许输入8位十六进制字符",letterAndNumber:"必须包含字母+数字",inputLetterOrNumber:"只允许输入字母或数字",letterAndNumberAndCharacters:"必须包含字母和数字，支持@、#、$、&、_、.",specialCharacters:"只允许输入数字、字母、中文字、下划线和分隔符的组合",firstCharactersChecked:"首字母必须是D,d,M,m，后面输入正整数",only:"你输入的值有重复，请重新输入",ip:"请输入正确的ip地址",port:"请输入正确的端口号",hzsx:"只允许输入汉字、字母、数字和下划线",szx:"只允许输入数字、字母和下划线",score:"密码强度过低，请包含大写字母、小写字母、数字、特殊字符其中3项，且长度不小于12位"};function ne(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return re(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?re(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,l=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return o=e.done,e},e:function(e){l=!0,r=e},f:function(){try{o||null==a.return||a.return()}finally{if(l)throw r}}}}function re(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=new Array(t);a<t;a++)i[a]=e[a];return i}function oe(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function le(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?oe(Object(a),!0).forEach((function(t){Object(f.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):oe(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var se=function(e){var t=this.$getPageParser();if(t)return t.validation(e)},ce=function(e){var t=this.$getPageParser();if(t)return t.locateComponentsInTabs(e)},ue=function(){var e,t,a=this.$getPageParser();if(!a)return{item:null,itemIndex:-1};var i=a.findForeachItemAndIndex(null==this||null===(e=this.data)||void 0===e?void 0:e.fid),n=a.findForeachItemAndIndex(null==this||null===(t=this.data)||void 0===t?void 0:t.parentFid);return n={$parent_item:n.item,$parent_itemIndex:n.itemIndex},Object.assign(i,n)},de=function(e){if(e=e||this.data&&this.data.pageId){var t=this.$store.getters.getComponentInstanceByPageId;if("function"===Object(y.g)(t))return t(e)}};function pe(e,t){if("all"===(t=t||{}).type)fe.call(this,e),e.closeDialog();else if("parent"===t.type){var a=e.fromPageId,i=this.$getPageParser(a);e.closeDialog(),i.closeDialog()}else e.closeDialog()}function he(e,t){if("all"===(t=t||{}).type)me.call(this,e),e.closeDrawer();else if("parent"===t.type){var a=e.fromPageId,i=this.$getPageParser(a);e.closeDrawer(),i.closeDrawer()}else e.closeDrawer()}function fe(e){var t=e&&e.fromPageId;if(t){e.closeDialog();var a=this.$getPageParser(t);return fe.call(this,a)}}function me(e){var t=e&&e.fromPageId;if(t){e.closeDrawer();var a=this.$getPageParser(t);return me.call(this,a)}}var ve=function(){var e=Object(V.a)((function(e){var t=this,a=e.iframeName,i=e.callback;return x.a.mark((function e(n){var r,o,l,s,c,u,d,p,h,f;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.$getPageParser()){e.next=3;break}return e.abrupt("return");case 3:if(o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(Array.isArray(i)){var a={pageId:(e||{}).pageId},n=r.getComponent("Page");if(n)return void t.$eventContentParse.call(n,i,a,r.pageId)}"function"==typeof i&&i((e||{}).pageId,e)},!(l=r.getComponent(a))||!l.$page){e.next=8;break}return o(l.$page),e.abrupt("return",l.$page);case 8:e.t0=x.a.keys(r.data.componentKV);case 9:if((e.t1=e.t0()).done){e.next=17;break}if(c=e.t1.value,"Iframe"!==(u=r.data.componentKV[c]).name||u.attributes.componentName.value!==a){e.next=15;break}return s=u,e.abrupt("break",17);case 15:e.next=9;break;case 17:if(1!==(null==(d=s.attributes.value)||null===(n=d.editValue)||void 0===n?void 0:n.source)){e.next=27;break}return h=null==d||null===(p=d.editValue)||void 0===p?void 0:p.page,e.next=22,Object(S.wb)(h.id,s.pageId);case 22:return f=e.sent,o(f),e.abrupt("return",f);case 27:o({});case 28:return e.abrupt("return",l);case 29:case"end":return e.stop()}}),e)}))()}));return function(t){return e.apply(this,arguments)}}(),be=function(e){var t=this,a=e.createInstances,i=e.validDisable,n=e.performence,r=e.relationKey,o=e.beforeEvents,l=e.successEvents,s=e.failEvents,c={createInstances:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"children",a=[],i=/-/g,n=function(){return Object(S.ob)().replace(i,"")};return"object"===Object(y.g)(e)&&(e=[e]),Array.isArray(e)?(r(e),a):a;function r(e,i){e.forEach((function(e){if("object"===Object(y.g)(e)){var o=le({},e);i&&(o.parentId=i);var l=o[t];if(delete o[t],o.identifier||(o.identifier=n()),Array.isArray(l)&&l.length){var s="@"+Object(S.ob)();o.id=s,a.push(o),r(l,s)}else a.push(o)}}))}}(a,r),validDisable:i,performence:n};if(!1!==this.$eventContentParse(o,{requestParams:c}))if(Array.isArray(c.createInstances)&&c.createInstances.length){if(c.createInstances.find((function(e){return!e.name})))this.$message({message:"存在实例没有对象实例名称",type:"error"});else{var u=c.createInstances.find((function(e){return!e.objectType}));if(u)this.$message({message:"".concat(u.name,"没有对象类型标识（objectType）"),type:"error"});else{var d=Object(y.h)(window.location.href,"projectIdentifier");this.$axiosRequest({url:"/api/model/instances/transaction_v2"+(d?"&projectIdentifier=".concat(d):""),method:"post",params:c}).then((function(e){t.$eventContentParse(l,{respond:e})})).catch((function(e){t.$eventContentParse(s,{error:e})}))}}}else this.$message({message:"无效实例列表",type:"error"})},ge=function(e,t){var a="${".concat(t,"}"),i=this;i||(i=window.$VUE_ROOT),i.$setAttr(e,"editor","variable-link"),i.$setAttr(e,"editorDefined","code"),i.$setAttr(e,"editorChanged",!0),i.$setAttr(e,"editorDialogVisible",!1),i.$setAttr(e,"linkConfig",function(e,t,a){if("variable"===t)return{accessType:"variable",linkType:1,type:"variable",static:"",useExpression:!1,dataType:e.type.indexOf("Enum")>-1?"String":e.type,variable:(a||"").split(".")}}(e,"variable",t)),i.$setAttr(e,"lastValue",a),i.$setAttr(e,"value",a)},ye=function(e,t){for(var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"name",i=0;i<((null==e?void 0:e.length)||0);i++)for(var n=e[i],r=0;r<((null===(o=n.objectAttr)||void 0===o||null===(l=o.attributes)||void 0===l?void 0:l.length)||0);r++){var o,l,s,c,u=n.objectAttr.attributes[r];if(t===Object(S.pb)(null===(s=u[a])||void 0===s?void 0:s.value,null===(c=u[a])||void 0===c?void 0:c.default))return u}};var _e={util:S.D,eventContentParse:ee,parseScript:function(e,t){var a=this.$getPageParser();if(a)return t=le(le({},ue.call(this)),t),a.parseScript(e,t,this)},validate:function(e,t,a){if("object"!==Object(y.g)(e)||"{}"===JSON.stringify(e))return"{}"===JSON.stringify(e)?se.call(this,void 0):se.call(this,e);var i=!0,n="";if(!e)return{validate:i,message:n};var r=e.attributes.filter((function(e){return Object(S.pb)(e.validateContent.value,e.validateContent.default)}));if(!r||!r.length)return{validate:i,message:n};if(!(r.find((function(e){var t=Object(S.pb)(e.validateType.value,e.validateType.default),a=Object(S.pb)(e.validateContent.value,e.validateContent.default);return"default"===t&&"required"===a}))||t||0===t&&!1===t))return{validate:i,message:n};for(var o=0;o<r.length;o++){var l=void 0,s=r[o],c=Object(S.pb)(s.validateType.value,s.validateType.default),u=Object(S.pb)(s.validateContent.value,s.validateContent.default),d=Object(S.pb)(s.validateMessage.value,s.validateMessage.default),p={maxlength:Object(S.pb)(s.maxlength.value,s.maxlength.default),minlength:Object(S.pb)(s.minlength.value,s.minlength.default),max:Object(S.pb)(s.max.value,s.max.default),min:Object(S.pb)(s.min.value,s.min.default)};if("script"===c){var h=s.validateContent.editValue&&s.validateContent.editValue.content,f=le({value:t},ue.call(this)),m=this.$parseScript(h,f);if(m&&!m.validate){l=s.payload.componentFid,i=!1,n=m.message;break}}if("default"===c){var v=e&&"RichTextEditor"===e.componentType,b=ae[u](t,p,v);"required"===u?b||(l=s.payload.componentFid,i=!1):""===t||b||(l=s.payload.componentFid,i=!1)}if("regex"===c){var g=/^\/(.+)\/(.+)?$/.exec(u),_=u,C="";g&&(_=g[1],C=g[2]),new RegExp(_,C).test(t)||(l=s.payload.componentFid,i=!1)}if("local"!==a&&l&&ce.call(this,l),!i){n=Object(S.ib)(d||ie[u],p);break}}return{validate:i,message:n}},clearValidate:function(e){var t=this.$getPageParser();if(t)return t.clearValidate(e)},refresh:function(){var e=this.$getPageParser();e&&e.refresh()},requestLinkData:function(e,t,a,i,n,r){if(e){var o=this.$getPageParser();if(o){var l=Object(y.g)(e),s=[];("array"!==l?[e]:e).forEach((function(e){var t="object"===Object(y.g)(e)?e.linkId:e;t&&s.push(t)})),o.requestLinkData(s,t,a,i,n,r)}}},request:function(e,t){var a=this.$getPageParser();if(!a)return Promise.reject({code:"PageParseNotFound",message:"请求失败，未找到pageParse"});if(!0!==(!1===e.isValidation||a.validation(t)))return Promise.reject({code:"CheckFailed",message:"请求失败, 校验不通过"});var i=le(le({},e),{},{url:e.url||"",method:e.method||"post",data:e.params||{},params:"get"===e.method&&e.params||{},headers:e.headers||{},meta:e.meta||{}});return e.responseType&&(i.responseType=e.responseType),window.$VUE_ROOT.$util.request(i)},setAttr:function(e,t,a){if(e){"editor"===t?this.$set(e,"editorChanged",!0):"visible"===t?this.$set(e,"visibleChanged",!0):"readonly"===t?this.$set(e,"readonlyChanged",!0):"type"===t&&this.$set(e,"typeChanged",!0),"value"===t&&(a=function(e,t){if("Boolean"===(null==e?void 0:e.type)&&"boolean"!==Object(y.g)(t)){if("true"===t)return!0;if("false"===t)return!1;var a=Number(t);return isNaN(a)?Boolean(t):Boolean(a)}return"Number"===(null==e?void 0:e.type)&&"number"!==Object(y.g)(t)?Number(t):t}(e,a)),this.$set(e,t,a);var i=e.linkable&&e.linkConfig;if("value"===t&&i&&"variable"===i.accessType){var n=this.$getPageParser();n&&n.setVariable(e,a)}}},removeAttr:function(e,t){if(e&&("editor"===t?(this.$delete(e,"editor"),this.$delete(e,"editorChanged")):"visible"===t?(this.$delete(e,"visible"),this.$delete(e,"visibleChanged")):"readonly"===t?(this.$delete(e,"readonly"),this.$delete(e,"readonlyChanged")):"type"===t&&(this.$delete(e,"type"),this.$delete(e,"typeChanged")),this.$delete(e,t),"value"===t)){var a=e.linkable&&e.linkConfig;if(a){if("variable"===a.accessType){var i=this.$getPageParser();i&&i.setVariable(e,void 0)}e.hasOwnProperty("editor")&&(e.editorDefined?this.$set(e,"editor",e.editorDefined):this.$delete(e,"editor"))}this.$delete(e,"linkConfig"),this.$delete(e,"editValue"),this.$delete(e,"lastValue")}},setComponentVisible:function(e,t){var a=this.$getPageParser();if(a){var i=Object(y.g)(e);if("string"===i||"array"===i)("string"==typeof e?[e]:e).forEach((function(e){var i=a.getComponent(e).data;a.setComponentAttr("display","visible",!0,i),a.setComponentAttr("display","value",!!t,i)}))}},setComponentAttr:function(e,t,a,i){var n=this.$getPageParser();if(n)return n.setComponentAttr(e,t,a,i||this.data)},setComponentAttrByFid:function(e,t,a,i){var n=this.$getPageParser();if(n)return n.setComponentAttrByFid(e,t,a,i||this.data)},getPageId:function(){var e=this.data&&this.data.pageId;if(e)return e;var t=Object(y.h)(this.$route.query);return null==t?void 0:t.pageId},getPageParser:function(e,t){if(e=e||this.data&&this.data.pageId){var a=this.$store.getters.getPageParserInstanceByPageId;if("function"===Object(y.g)(a)){if(1===e.split("_").length){var i,n,r=(null===(i=this.$store.getters)||void 0===i||null===(n=i.pageViewStore)||void 0===n?void 0:n.pageParserInstanceKV)||{},o=Object.keys(r).filter((function(t){return-1!==t.indexOf(e)}));return isNaN(Number(t))?a(o[0]):a(o[t])}return a(e)}}},getPageViewArea:de,getComponents:function(){var e=this.$getPageParser();if(e)return e.getComponents()},getComponent:function(e,t){var a=this.$getPageParser(t);if(a)return a.getComponent(e)},getComponentAttrByName:function(e,t){var a=this.$getComponent(t);if(a){var i=a.data;return i.attributes&&i.attributes[e]}},getComponentAttrByLinkId:function(e){var t=this.$getPageParser();if(t)return t.getAttrByLinkId(e)},getVariable:function(e){var t=this.$getPageParser();if(t)return t.getVariable(e)},setVariable:function(e,t,a){var i=this.$getPageParser();if(i){var n="object"===Object(y.g)(e)&&!e.linkConfig,r=n?e.name:e,o=n?e.value:t,l=n?e.key:a;return i.setVariable(r,o,l)}},clearVariable:function(e){var t=this.$getPageParser();if(t){var a="object"===Object(y.g)(e)?e.name:e;return t.clearVariable(a)}},notEmptyCheckVariable:function(e,t,a){var i="object"===Object(y.g)(e)?e.name:e,n="object"===Object(y.g)(e)?e.falseMessage:t,r="object"===Object(y.g)(e)?e.trueMessage:a;if(!i)return!0;var o=this.$getPageParser();return o?function(e){var t=Object(y.g)(e);return"object"===t?"{}"===Object(y.b)(e):"array"===t?0===e.length:!e&&0!==e&&!1!==e}(o.getVariable(i))?(n&&this.$message({message:n,type:"error"}),!1):(r&&this.$message({message:r,type:"error"}),!0):(this.$message({message:"获取变量异常",type:"error"}),!1)},setVariableValue:function(e,t){var a=this.$getPageParser();if(a){var i="object"===Object(y.g)(e)?e.variable:e,n="object"===Object(y.g)(e)?e.value:t;return a.setVariableValue(i,n)}},getCustomGroupNameAttrs:function(e,t){var a=this.$getPageParser();if(a)return a.getCustomGroupNameAttrs(e,t)},closeDialog:function(e){var t=this,a=this.$getPageParser();if(a){var i="object"===Object(y.g)(e)?e.delayTime:e;i&&"number"===Object(y.g)(i)?setTimeout((function(){pe.call(t,a,e)}),i):pe.call(this,a,e)}},closeDrawer:function(e){var t=this,a=this.$getPageParser();if(a){var i="object"===Object(y.g)(e)?e.delayTime:e;i&&"number"===Object(y.g)(i)?setTimeout((function(){he.call(t,a,e)}),i):he.call(this,a,e)}},getFromPage:function(){var e=this.$getPageParser();if(e)return e.getFromPage()},setFromPageVariable:function(e,t){var a="object"===Object(y.g)(e)?e.name:e,i="object"===Object(y.g)(e)?e.value:t;this.$invokeFromPageMethod("Page","$setVariable",[a,i])},invokeFromPageMethod:function(e,t,a){var i="object"===Object(y.g)(e)?e.componentName:e,n="object"===Object(y.g)(e)?e.method:t,r="object"===Object(y.g)(e)?e.params:a;if(i||n){var o=this.$getFromPage();if(o){var l=o.getComponent(i);if(l){var s=l[n];return"function"===Object(y.g)(s)?"array"!==Object(y.g)(r)?s.call(l,r):s.apply(l,r):void 0}}}},invokeMethodByPageId:function(e){var t=e.pageId,a=e.componentName,i=e.method,n=e.pageIndex;if(t||a||i){var r=this.$getPageParser(t,n);if(r){var o=r.getComponent(a);if(o){var l=o[i];return"function"===Object(y.g)(l)?l.call(o,e.params):void 0}}}},confirmDialog:function(e,t,a,i,n,r,o,l){var s=this,c="object"===Object(y.g)(e)?e.message:e,u="object"===Object(y.g)(e)?e.title:t,d="object"===Object(y.g)(e)?e.confirmButtonText:a,p="object"===Object(y.g)(e)?e.cancelButtonText:i,h="object"===Object(y.g)(e)?e.confirmContent:n,f="object"===Object(y.g)(e)?e.cancelContent:r,m="object"===Object(y.g)(e)?e.args:o,v="object"===Object(y.g)(e)?e.type:l,b={closeOnClickModal:!1,closeOnPressEscape:!1,confirmButtonText:d||"确定",cancelButtonText:p||"取消"};v&&"none"!==v&&(b.type=v),this.$confirm(null!=c?c:"是否确认删除？",null!=u?u:"提示",b).then((function(){s.$eventContentParse(h,m)})).catch((function(){s.$eventContentParse(f,m)}))},showLoading:function(e){var t=this.$getPageParser();if(t){var a=t.getPageView();a&&a.showLoading(e)}},hideLoading:function(){var e=this.$getPageParser();if(e){var t=e.getPageView();t&&t.hideLoading()}},isLoading:function(){var e=this.$getPageParser();if(!e)return!1;var t=e.getPageView();return!!t&&t.loading},getUrlParams:function(e){var t;return Object(y.h)(e||(null===(t=this.$route)||void 0===t?void 0:t.query))},downloadExcel:function(e){var t=e.url,a=e.name,i=e.params,n=this.$getPageParser();if(n){var r=H(t,n.pageId),o=H(a,n.pageId),l={url:r,method:"get",responseType:"blob",params:i||{}};window.$common.$axiosRequest(l).then((function(e){var t=new Blob([e],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=utf-8"}),a=URL.createObjectURL(t),i=document.createElement("a"),n=o;i.href=a,i.setAttribute("download",[".xlsx",".xls"].find((function(e){return n.endsWith(e)}))?n:"".concat(n,".xlsx")),document.body.appendChild(i),i.click(),i.remove(),window.URL.revokeObjectURL(a)}))}},downloadReport:function(e){var t=e.reportData,a=e.reportParams,i=e.type;if(t)if(i){var n="".concat(window.location.origin,"/jmreport/view/").concat(t.id,"?token=").concat(null==this?void 0:this.$getToken());if(Object.keys(a||{}).length)for(var r in a)n+="&".concat(r,"=").concat(a[r]);var o=!["Excel","PDF"].includes(i)&&document.querySelector("#reportDownload_".concat(i,"_").concat(t.id)),l=o||document.createElement("iframe"),s=l.src!==n;s&&(l.src=n),o||(l.id="reportDownload_".concat(i,"_").concat(t.id),l.style.height="100px",l.style.width="100px",l.height="100px",l.width="100px",l.style.position="absolute",l.style.zIndex="-1",l.style.opacity="0");try{var c=function(){var e=null==l?void 0:l.contentWindow;Object(S.Eb)((function(){return e&&e.document.getElementById(i)})).then((function(t){var a=["/jmreport/exportAllExcelStream","/jmreport/exportPdfStream"],i=!1;e.XMLHttpRequest.prototype.open=new Proxy(e.XMLHttpRequest.prototype.open,{apply:function(e,t,n){var r=Object(w.a)(n,2),o=r[0],l=void 0===o?"":o,s=r[1];i="post"===l.toLowerCase()&&a.includes(s),e.apply(t,n)}}),e.XMLHttpRequest.prototype.send=new Proxy(e.XMLHttpRequest.prototype.send,{apply:function(e,t,a){e.apply(t,a),i&&(t.onload=function(){l.remove()})}}),null!=t&&t.click?setTimeout((function(){t.click()}),1e3):l.remove()}))};o?!s&&c():l.onload=function(e){c()}}catch(e){l.remove()}o||document.body.appendChild(l)}else this.$message.error("未获取到下载类型");else this.$message.error("未获取到关联报表")},checkPermission:function(e){var t,a,i="object"===Object(y.g)(e)?e.identifier:e;return!!((null===(t=this.$store)||void 0===t||null===(a=t.getters)||void 0===a?void 0:a.allPermissions)||[]).find((function(e){return e.permissionIdentifier===i||e.id===i}))},refreshAsyncVariables:function(e){var t=e.keys;if(t&&t.length){var a=t.split(",");if(a.length){var i=this.$getPageParser();if(i){var n=i.data.page.attributes.customVariable.attributes,r=[];n.forEach((function(e){var t,i;a.includes(null===(t=e.name)||void 0===t?void 0:t.value)&&null!=e&&null!==(i=e.value)&&void 0!==i&&i.linkId&&r.push(e.value.linkId)})),i.requestLinkData(r,null,(function(){i.getVariableLinkValues(r),i.handleLinkVariable()}))}}}},clearTimer:function(e){var t,a=de.call(this);(a&&a.Page&&(t=a.Page),t&&e&&e.names)&&e.names.split(",").forEach((function(e){t.pageTimer[e]&&(clearTimeout(t.pageTimer[e]),clearInterval(t.pageTimer[e]),t.pageTimer[e]=null)}))},setZoom:function(e){var t=+("object"===Object(y.g)(e)?e.zoom:e);isNaN(t)&&(t=100);var a=(t<10?10:t>200?200:t)/100;this.$util.setZoom(a)},getZoom:function(){var e=100*this.$util.getZoom();return isNaN(e)?void 0:e},loadTempIframePage:ve,destroyTempIframePage:function(e){var t,a,i,n=e.iframeName,r=e.pageId;if("string"==typeof r){var o=this.$getPageParser(r)||{};if(o.isTemp)return void(o.isTemp&&Object(S.G)(o.pageId))}if(n){var l=this.$getPageParser();if(l){var s;for(var c in l.data.componentKV){var u=l.data.componentKV[c];if("Iframe"===u.name&&u.attributes.componentName.value===n){s=u;break}}var d=null===(t=s)||void 0===t||null===(a=t.attributes)||void 0===a?void 0:a.value;if(1===(null==d||null===(i=d.editValue)||void 0===i?void 0:i.source)){var p,h=null==d||null===(p=d.editValue)||void 0===p?void 0:p.page;try{var f=Object(S.mb)(h.id)||{};f.pageId&&Object(S.G)(f.pageId)}catch(e){}}}}},sleepWait:S.Eb,conditionalBranch:function(e){var t=e.target,a=e.args,i=e.pageId,n=e.conditionalBranches;t&&(null==t||delete t.attributes);var r,o=ne(n);try{for(o.s();!(r=o.n()).done;){var l=r.value,s=l.conditionalContent,c=void 0;t?(c=Object(y.e)(t)).attributes=[l]:c=[l];var u=null==s?void 0:s.value;if(u){var d=void 0;try{d=H(u+"",i,a,!0,!0)}catch(e){}d&&this.$eventContentParse(c,a,i)}else this.$eventContentParse(c,a,i)}}catch(e){o.e(e)}finally{o.f()}},assets:function(e){var t=this,a=e.target,i=(e.args,e.pageId),n=e.assets;n.assetIdentifier&&n.regCode&&n.methodIdentifier&&this.$axiosRequest({url:"/api/thing-model/instances/".concat(n.assetIdentifier,"/methods/").concat(n.methodIdentifier,"/execute"),method:"post",params:le({deviceIdentifier:n.regCode},Object.keys(n.payloads||{}).length?{reqData:n.payloads}:{})}).then((function(){})).catch((function(e){t.$sendLog({logData:{message:e.message,info:Object(S.yb)({pageId:i,componentName:a.componentName,componentFid:a.componentFid})},logTitle:"事件资产方法执行错误"})})).finally((function(){t.$message.success("执行完成")}))},addModelInstances:function(e){var t=this;if((e=e||{}).relation)be.call(this,e);else{var a=e,i=a.profileIdentifier,n=a.instances,r=a.transactionType,o=a.beforeEvents,l=a.successEvents,s=a.failEvents,c={profileIdentifier:i,transactionType:r,instances:n};if(Array.isArray(c.profileIdentifier)&&(c.profileIdentifier=c.profileIdentifier.pop()),!1!==this.$eventContentParse(o,{requestParams:c})){var u=c.profileIdentifier,d=c.instances,p=c.transactionType;if(u){var h=!1,f=/-/g,m=function(){return Object(S.ob)().replace(f,"")};if("string"===Object(y.g)(d)?d&&(c.instances=[{name:d,objectType:u,identifier:m()}],h=!0):"object"===Object(y.g)(d)?d.name&&(d.objectType||(d.objectType=u),d.identifier||(d.identifier=m()),c.instances=[d],h=!0):"array"===Object(y.g)(d)&&d.length&&(d.forEach((function(e){e.objectType||(e.objectType=u),e.identifier||(e.identifier=m())})),c.instances=d,h=!0),h){var v=Object(y.h)(window.location.href,"projectIdentifier");this.$axiosRequest({url:"/api/model/instances/batch?profileIdentifier=".concat(u,"&operationType=add&transactionType=").concat(p)+(v?"&projectIdentifier=".concat(v):""),method:"post",params:c}).then((function(e){t.$eventContentParse(l,{respond:e})})).catch((function(e){t.$eventContentParse(s,{error:e})}))}else this.$message({message:"无效对象实例数据",type:"error"})}else this.$message({message:"对象类型标识为空",type:"error"})}}},delModelInstances:function(e){var t=this,a=e=e||{},i=a.profileIdentifier,n=a.data,r=a.cascade,o=a.beforeEvents,l=a.successEvents,s=a.failEvents,c={profileIdentifier:i,data:n,cascade:r};Array.isArray(c.profileIdentifier)&&(c.profileIdentifier=c.profileIdentifier.pop());var u=this.$eventContentParse(o,{requestParams:c});if(!1!==u){var d=c.profileIdentifier,p=c.data;if(d){var h=!1;"string"===Object(y.g)(p)?p&&(c.data=p.split(","),h=!0):"object"===Object(y.g)(p)?p.id&&"string"==typeof p.id?(c.data=p.id.split(","),h=!0):"array"===Object(y.g)(p.id)&&(c.data=p.id,h=!0):"array"===Object(y.g)(p)&&p.length&&(c.data=p,h=!0),h?this.$axiosRequest({url:"/api/model/instances/batch?profileIdentifier=".concat(d,"&operationType=delete&cascade=").concat(r),method:"post",params:c}).then((function(e){t.$eventContentParse(l,{respond:e})})).catch((function(e){t.$eventContentParse(s,{error:e})})):this.$message({message:"无效id：删除对象实例失败",type:"error"})}else this.$message({message:"对象类型标识为空",type:"error"})}},editModelInstances:function(e){var t=this,a=e=e||{},i=a.beforeEvents,n=a.successEvents,r=a.failEvents,o=e.modelInstance||{};if("string"==typeof o)try{o=JSON.parse(o)}catch(e){this.$message({message:"参数 modelInstance 数据类型应该为object, 数据类型错误，参数值被忽略",type:"error"}),o={}}for(var l in delete e.beforeEvents,delete e.successEvents,delete e.failEvents,delete e.modelInstance,e){var s=e[l];["",null,void 0].includes(s)&&delete e[l]}var c=le(le({},o),e);if(Array.isArray(c.objectType)&&(c.objectType=c.objectType.pop()),!1!==this.$eventContentParse(i,{requestParams:c})){var u=c.id,d=(c.name,c.objectType);if(u){var p="/api/model/instances/".concat(u)+(d?"?objectType=".concat(d):"");this.$axiosRequest({url:p,method:"patch",params:c}).then((function(e){t.$eventContentParse(n,{respond:e})})).catch((function(e){t.$eventContentParse(r,{error:e})}))}else this.$message({message:"实例id不能为空",type:"error"})}},testDataType:function(e){alert(JSON.stringify(e))},autoBindComponentAttributes:function(e,t,a,i){var n=this;n||(n=window.$VUE_ROOT);var r=e[t.name];if(r){var o,l={},s=ne(r);try{var c=function(){var e=o.value,r=Object(S.qb)(t.attributes,e.key.replaceAll("_","."));if(!r)return 0;if("function"==typeof(null==e?void 0:e.binder))e.binder(r,a,i);else if("$_variable"===e.binder){if("$_self"===e.value){var s,c,u=(null==a||null===(s=a.attributes)||void 0===s||null===(c=s.componentName)||void 0===c?void 0:c.value)||(null==a?void 0:a.name);ge.apply(n,[r,u])}else if((e.value||"").startsWith("$_")){var d,p,h,f,m=i||e.value.replace("$_","");if(l[m]=l[m]||ye(null==a||null===(d=a.attributes)||void 0===d||null===(p=d.scopedVariable)||void 0===p?void 0:p.attributes,m,i?"name":"type"),null!==(h=l[m])&&void 0!==h&&null!==(f=h.name)&&void 0!==f&&f.value){var v,b,g,_,C=((null==a||null===(v=a.attributes)||void 0===v||null===(b=v.componentName)||void 0===b?void 0:b.value)||(null==a?void 0:a.name))+"."+(null===(g=l[m])||void 0===g||null===(_=g.name)||void 0===_?void 0:_.value);ge.apply(n,[r,C])}}else if(e.value){var O,T;if(!function(e,t){var a,i;if("ContainerArray"===e.name)return["pageInfo","result","dynamicFields"].includes(t);for(var n=null==e||null===(a=e.attributes)||void 0===a||null===(i=a.scopedVariable)||void 0===i?void 0:i.attributes,r=0;r<((null==n?void 0:n.length)||0);r++)for(var o=n[r],l=0;l<((null===(s=o.objectAttr)||void 0===s||null===(c=s.attributes)||void 0===c?void 0:c.length)||0);l++){var s,c,u,d,p=o.objectAttr.attributes[l];if(t===Object(S.pb)(null===(u=p.name)||void 0===u?void 0:u.value,null===(d=p.name)||void 0===d?void 0:d.default))return!0}}(a,e.value))return 0;var V=((null==a||null===(O=a.attributes)||void 0===O||null===(T=O.componentName)||void 0===T?void 0:T.value)||(null==a?void 0:a.name))+"."+e.value;ge.apply(n,[r,V])}}else{var w=e.value;if("string"==typeof w&&w.startsWith("$_")){var P,x,j,E,k=w.split("."),I=k[0].replace("$_","");"self"===I?l[I]=l[I]||(null==a||null===(P=a.attributes)||void 0===P||null===(x=P.scopedVariable)||void 0===x?void 0:x.attributes[0]):l[I=i||I]=l[I]||ye(null==a||null===(j=a.attributes)||void 0===j||null===(E=j.scopedVariable)||void 0===E?void 0:E.attributes,I,i?"name":"type"),k.forEach((function(e,t){if(0===t)w=Object(y.e)(l[I]);else{if(!w)return;var a;if(a="array"===Object(y.g)(w)?w.find((function(t){return(t.name.hasOwnProperty("value")?t.name.value:t.name)===e})):w[e],t===k.length-1){var i=Object(y.g)(a);if("object"===i&&a.hasOwnProperty("value"))return void(w=a.value);if("array"===i)return void(w=a.map((function(e){var t=e;return Object.keys(e).forEach((function(a){"object"===Object(y.g)(e[a])&&e[a].hasOwnProperty("value")&&(t[a]=e[a].value)})),t})))}w=a}}))}if(void 0===w)return 0;if("value"===e.binder){if(w===(null==r?void 0:r.default))return 0;n.$setAttr(r,"lastValue",w)}n.$setAttr(r,e.binder,w),r.changeHandler&&setTimeout((function(){Object(S.S)(r.changeHandler,t.fid)(w,r.lastValue,r,Object(S.Y)(t.fid))}))}};for(s.s();!(o=s.n()).done;)c()}catch(e){s.e(e)}finally{s.f()}}},autoFillComponents:function(e){Object(S.R)(e)},getScopedVarByAttr:ye};var Ce=function(){var e=[],t={},i=a("8c2f");return i.keys().forEach((function(a,n){var r=/\.\/([^/]+)\/(.+)\.(js|vue)/g.exec(a),o=r[1],l=r[3];if("js"!==t[o]){var s=i(a).default;!function(e){return"Object"===Object.prototype.toString.call(e).slice(8,-1)}(s)?Array.isArray(s)&&s.forEach((function(a){e.push({name:a.name||o,content:a}),t[o]=l})):(e.push({name:s.name||o,content:s}),t[o]=l)}})),e}(),Oe=a("7618"),Te=a("d225"),Ve=a("b0b4"),we=function(e,t,a){return[e,t*a/((e=(2-t)*a)<1?e:2-e)||0,e/2]},Pe=function(e,t){(function(e){return"string"==typeof e&&-1!==e.indexOf(".")&&1===parseFloat(e)})(e)&&(e="100%");var a=function(e){return"string"==typeof e&&-1!==e.indexOf("%")}(e);return e=Math.min(t,Math.max(0,parseFloat(e))),a&&(e=parseInt(e*t,10)/100),Math.abs(e-t)<1e-6?1:e%t/parseFloat(t)},xe={10:"A",11:"B",12:"C",13:"D",14:"E",15:"F"},Se={A:10,B:11,C:12,D:13,E:14,F:15},je=function(e){return 2===e.length?16*(Se[e[0].toUpperCase()]||+e[0])+(Se[e[1].toUpperCase()]||+e[1]):Se[e[1].toUpperCase()]||+e[1]},Ee=function(e,t,a){e=Pe(e,255),t=Pe(t,255),a=Pe(a,255);var i,n,r=Math.max(e,t,a),o=Math.min(e,t,a),l=r,s=r-o;if(n=0===r?0:s/r,r===o)i=0;else{switch(r){case e:i=(t-a)/s+(t<a?6:0);break;case t:i=(a-e)/s+2;break;case a:i=(e-t)/s+4}i/=6}return{h:360*i,s:100*n,v:100*l}},ke=function(e,t,a){e=6*Pe(e,360),t=Pe(t,100),a=Pe(a,100);var i=Math.floor(e),n=e-i,r=a*(1-t),o=a*(1-n*t),l=a*(1-(1-n)*t),s=i%6,c=[a,o,r,r,l,a][s],u=[l,a,a,o,r,r][s],d=[r,r,l,a,a,o][s];return{r:Math.round(255*c),g:Math.round(255*u),b:Math.round(255*d)}},Ie=function(){function e(t){for(var a in Object(Te.a)(this,e),this._hue=0,this._saturation=100,this._value=100,this._alpha=100,this.enableAlpha=!1,this.format="hex",this.value="",t=t||{})t.hasOwnProperty(a)&&(this[a]=t[a]);this.doOnChange()}return Object(Ve.a)(e,[{key:"set",value:function(e,t){if(1!==arguments.length||"object"!==Object(Oe.a)(e))this["_"+e]=t,this.doOnChange();else for(var a in e)e.hasOwnProperty(a)&&this.set(a,e[a])}},{key:"get",value:function(e){return this["_"+e]}},{key:"toRgb",value:function(){return ke(this._hue,this._saturation,this._value)}},{key:"fromString",value:function(e){var t=this;if(!e)return this._hue=0,this._saturation=100,this._value=100,void this.doOnChange();var a=function(e,a,i){t._hue=Math.max(0,Math.min(360,e)),t._saturation=Math.max(0,Math.min(100,a)),t._value=Math.max(0,Math.min(100,i)),t.doOnChange()};if(-1!==e.indexOf("hsl")){var i=e.replace(/hsla|hsl|\(|\)/gm,"").split(/\s|,/g).filter((function(e){return""!==e})).map((function(e,t){return t>2?parseFloat(e):parseInt(e,10)}));if(4===i.length?this._alpha=Math.floor(100*parseFloat(i[3])):3===i.length&&(this._alpha=100),i.length>=3){var n=function(e,t,a){a/=100;var i=t/=100,n=Math.max(a,.01);return t*=(a*=2)<=1?a:2-a,i*=n<=1?n:2-n,{h:e,s:100*(0===a?2*i/(n+i):2*t/(a+t)),v:100*((a+t)/2)}}(i[0],i[1],i[2]);a(n.h,n.s,n.v)}}else if(-1!==e.indexOf("hsv")){var r=e.replace(/hsva|hsv|\(|\)/gm,"").split(/\s|,/g).filter((function(e){return""!==e})).map((function(e,t){return t>2?parseFloat(e):parseInt(e,10)}));4===r.length?this._alpha=Math.floor(100*parseFloat(r[3])):3===r.length&&(this._alpha=100),r.length>=3&&a(r[0],r[1],r[2])}else if(-1!==e.indexOf("rgb")){var o=e.replace(/rgba|rgb|\(|\)/gm,"").split(/\s|,/g).filter((function(e){return""!==e})).map((function(e,t){return t>2?parseFloat(e):parseInt(e,10)}));if(4===o.length?this._alpha=Math.floor(100*parseFloat(o[3])):3===o.length&&(this._alpha=100),o.length>=3){var l=Ee(o[0],o[1],o[2]);a(l.h,l.s,l.v)}}else if(-1!==e.indexOf("#")){var s,c,u,d=e.replace("#","").trim();if(!/^(?:[0-9a-fA-F]{3}){1,2}|[0-9a-fA-F]{8}$/.test(d))return;3===d.length?(s=je(d[0]+d[0]),c=je(d[1]+d[1]),u=je(d[2]+d[2])):6!==d.length&&8!==d.length||(s=je(d.substring(0,2)),c=je(d.substring(2,4)),u=je(d.substring(4,6))),8===d.length?this._alpha=Math.floor(je(d.substring(6))/255*100):3!==d.length&&6!==d.length||(this._alpha=100);var p=Ee(s,c,u);a(p.h,p.s,p.v)}}},{key:"compare",value:function(e){return Math.abs(e._hue-this._hue)<2&&Math.abs(e._saturation-this._saturation)<1&&Math.abs(e._value-this._value)<1&&Math.abs(e._alpha-this._alpha)<1}},{key:"doOnChange",value:function(){var e=this._hue,t=this._saturation,a=this._value,i=this._alpha,n=this.format;if(this.enableAlpha)switch(n){case"hsl":var r=we(e,t/100,a/100);this.value="hsla(".concat(e,", ").concat(Math.round(100*r[1]),"%, ").concat(Math.round(100*r[2]),"%, ").concat(i/100,")");break;case"hsv":this.value="hsva(".concat(e,", ").concat(Math.round(t),"%, ").concat(Math.round(a),"%, ").concat(i/100,")");break;default:var o=ke(e,t,a),l=o.r,s=o.g,c=o.b;this.value="rgba(".concat(l,", ").concat(s,", ").concat(c,", ").concat(i/100,")")}else switch(n){case"hsl":var u=we(e,t/100,a/100);this.value="hsl(".concat(e,", ").concat(Math.round(100*u[1]),"%, ").concat(Math.round(100*u[2]),"%)");break;case"hsv":this.value="hsv(".concat(e,", ").concat(Math.round(t),"%, ").concat(Math.round(a),"%)");break;case"rgb":var d=ke(e,t,a),p=d.r,h=d.g,f=d.b;this.value="rgb(".concat(p,", ").concat(h,", ").concat(f,")");break;default:this.value=function(e){var t=e.r,a=e.g,i=e.b,n=function(e){e=Math.min(Math.round(e),255);var t=Math.floor(e/16),a=e%16;return""+(xe[t]||t)+(xe[a]||a)};return isNaN(t)||isNaN(a)||isNaN(i)?"":"#"+n(t)+n(a)+n(i)}(ke(e,t,a))}}}]),e}(),Ae=!1,De=function(e,t){if(!i.default.prototype.$isServer){var a=function(e){t.drag&&t.drag(e)},n=function e(i){document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",e),document.onselectstart=null,document.ondragstart=null,Ae=!1,t.end&&t.end(i)};e.addEventListener("mousedown",(function(e){Ae||(document.onselectstart=function(){return!1},document.ondragstart=function(){return!1},document.addEventListener("mousemove",a),document.addEventListener("mouseup",n),Ae=!0,t.start&&t.start(e))}))}},Ne={name:"ElSlPanel",props:{color:{required:!0}},computed:{colorValue:function(){return{hue:this.color.get("hue"),value:this.color.get("value")}}},watch:{colorValue:function(){this.update()}},methods:{update:function(){var e=this.color.get("saturation"),t=this.color.get("value"),a=this.$el,i=a.clientWidth,n=a.clientHeight;this.cursorLeft=e*i/100,this.cursorTop=(100-t)*n/100,this.background="hsl("+this.color.get("hue")+", 100%, 50%)"},handleDrag:function(e){var t=this.$el.getBoundingClientRect(),a=e.clientX-t.left,i=e.clientY-t.top;a=Math.max(0,a),a=Math.min(a,t.width),i=Math.max(0,i),i=Math.min(i,t.height),this.cursorLeft=a,this.cursorTop=i,this.color.set({saturation:a/t.width*100,value:100-i/t.height*100}),this.color.key=void 0}},mounted:function(){var e=this;De(this.$el,{drag:function(t){e.handleDrag(t)},end:function(t){e.handleDrag(t)}}),this.update()},data:function(){return{cursorTop:0,cursorLeft:0,background:"hsl(0, 100%, 50%)"}}},$e=Object(l.a)(Ne,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"el-color-svpanel",style:{backgroundColor:e.background}},[t("div",{staticClass:"el-color-svpanel__white"}),t("div",{staticClass:"el-color-svpanel__black"}),t("div",{staticClass:"el-color-svpanel__cursor",style:{top:e.cursorTop+"px",left:e.cursorLeft+"px"}},[t("div")])])}),[],!1,null,null,null).exports,Le={name:"ElColorHueSlider",props:{color:{required:!0},vertical:Boolean},data:function(){return{thumbLeft:0,thumbTop:0}},computed:{hueValue:function(){return this.color.get("hue")}},watch:{hueValue:function(){this.update()}},methods:{handleClick:function(e){var t=this.$refs.thumb;e.target!==t&&this.handleDrag(e),this.color.key=void 0},handleDrag:function(e){var t,a=this.$el.getBoundingClientRect(),i=this.$refs.thumb;if(this.vertical){var n=e.clientY-a.top;n=Math.min(n,a.height-i.offsetHeight/2),n=Math.max(i.offsetHeight/2,n),t=Math.round((n-i.offsetHeight/2)/(a.height-i.offsetHeight)*360)}else{var r=e.clientX-a.left;r=Math.min(r,a.width-i.offsetWidth/2),r=Math.max(i.offsetWidth/2,r),t=Math.round((r-i.offsetWidth/2)/(a.width-i.offsetWidth)*360)}this.color.set("hue",t)},getThumbLeft:function(){if(this.vertical)return 0;var e=this.$el,t=this.color.get("hue");if(!e)return 0;var a=this.$refs.thumb;return Math.round(t*(e.offsetWidth-a.offsetWidth/2)/360)},getThumbTop:function(){if(!this.vertical)return 0;var e=this.$el,t=this.color.get("hue");if(!e)return 0;var a=this.$refs.thumb;return Math.round(t*(e.offsetHeight-a.offsetHeight/2)/360)},update:function(){this.thumbLeft=this.getThumbLeft(),this.thumbTop=this.getThumbTop()}},mounted:function(){var e=this,t=this.$refs,a=t.bar,i=t.thumb,n={drag:function(t){e.handleDrag(t)},end:function(t){e.handleDrag(t)}};De(a,n),De(i,n),this.update()}},Me=Object(l.a)(Le,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"el-color-hue-slider",class:{"is-vertical":e.vertical}},[t("div",{ref:"bar",staticClass:"el-color-hue-slider__bar",on:{click:e.handleClick}}),t("div",{ref:"thumb",staticClass:"el-color-hue-slider__thumb",style:{left:e.thumbLeft+"px",top:e.thumbTop+"px"}})])}),[],!1,null,null,null).exports,qe={name:"ElColorAlphaSlider",props:{color:{required:!0},vertical:Boolean},watch:{"color._alpha":function(){this.update()},"color.value":function(){this.update()}},methods:{handleClick:function(e){var t=this.$refs.thumb;e.target!==t&&this.handleDrag(e),this.color.key=void 0},handleDrag:function(e){var t=this.$el.getBoundingClientRect(),a=this.$refs.thumb;if(this.vertical){var i=e.clientY-t.top;i=Math.max(a.offsetHeight/2,i),i=Math.min(i,t.height-a.offsetHeight/2),this.color.set("alpha",Math.round((i-a.offsetHeight/2)/(t.height-a.offsetHeight)*100))}else{var n=e.clientX-t.left;n=Math.max(a.offsetWidth/2,n),n=Math.min(n,t.width-a.offsetWidth/2),this.color.set("alpha",Math.round((n-a.offsetWidth/2)/(t.width-a.offsetWidth)*100))}},getThumbLeft:function(){if(this.vertical)return 0;var e=this.$el,t=this.color._alpha;if(!e)return 0;var a=this.$refs.thumb;return Math.round(t*(e.offsetWidth-a.offsetWidth/2)/100)},getThumbTop:function(){if(!this.vertical)return 0;var e=this.$el,t=this.color._alpha;if(!e)return 0;var a=this.$refs.thumb;return Math.round(t*(e.offsetHeight-a.offsetHeight/2)/100)},getBackground:function(){if(this.color&&this.color.value){var e=this.color.toRgb(),t=e.r,a=e.g,i=e.b;return"linear-gradient(to right, rgba(".concat(t,", ").concat(a,", ").concat(i,", 0) 0%, rgba(").concat(t,", ").concat(a,", ").concat(i,", 1) 100%)")}return null},update:function(){this.thumbLeft=this.getThumbLeft(),this.thumbTop=this.getThumbTop(),this.background=this.getBackground()}},data:function(){return{thumbLeft:0,thumbTop:0,background:null}},mounted:function(){var e=this,t=this.$refs,a=t.bar,i=t.thumb,n={drag:function(t){e.handleDrag(t)},end:function(t){e.handleDrag(t)}};De(a,n),De(i,n),this.update()}},Be=Object(l.a)(qe,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"el-color-alpha-slider",class:{"is-vertical":e.vertical}},[t("div",{ref:"bar",staticClass:"el-color-alpha-slider__bar",style:{background:e.background},on:{click:e.handleClick}}),t("div",{ref:"thumb",staticClass:"el-color-alpha-slider__thumb",style:{left:e.thumbLeft+"px",top:e.thumbTop+"px"}})])}),[],!1,null,null,null).exports,Fe={props:{colors:{type:Array,required:!0},color:{required:!0}},data:function(){return{rgbaColors:this.parseColors(this.colors,this.color)}},methods:{handleSelect:function(e){this.color.fromString(this.colors[e])},parseColors:function(e,t){return e.map((function(e){var a=new Ie;return a.enableAlpha=!0,a.format="rgba",a.fromString(e),a.selected=a.value===t.value,a}))}},watch:{"$parent.currentColor":function(e){var t=new Ie;t.fromString(e),this.rgbaColors.forEach((function(e){e.selected=t.compare(e)}))},colors:function(e){this.rgbaColors=this.parseColors(e,this.color)},color:function(e){this.rgbaColors=this.parseColors(this.colors,e)}}},Re=Object(l.a)(Fe,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"el-color-predefine"},[t("div",{staticClass:"el-color-predefine__colors"},e._l(e.rgbaColors,(function(a,i){return t("div",{key:e.colors[i],staticClass:"el-color-predefine__color-selector",class:{selected:a.selected,"is-alpha":a._alpha<100},on:{click:function(t){return e.handleSelect(i)}}},[t("div",{style:{"background-color":a.value}})])})),0)])}),[],!1,null,null,null).exports,Ke=a("17ec"),Ue=a("d4b4"),ze=a("ffa3"),Ge=a("ad53"),He=a("2f62");function We(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function Je(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?We(Object(a),!0).forEach((function(t){Object(f.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):We(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var Ye={name:"ColorList",props:{rgbaColors:{type:Array,default:function(){return[]}},colorKey:{type:String,default:""}},data:function(){return{light:"#ffffff",dark:"#000000"}},computed:Je(Je({},Object(He.a)(["themeConstColor","themeInfoMap"])),{},{descriptions:function(){var e;return(null===(e=this.themeInfoMap)||void 0===e?void 0:e.description)||{}}}),methods:{handleSelect:function(e){this.$emit("select",e)},getRgba:function(e){var t=e.replace(/rgba?\(/,"").replace(/\)/,"").replace(/[\s+]/g,"").split(","),a=parseFloat(t[3]||1);return{r:Math.floor(a*parseInt(t[0])+255*(1-a)),g:Math.floor(a*parseInt(t[1])+255*(1-a)),b:Math.floor(a*parseInt(t[2])+255*(1-a))}},hexColor:function(e){var t=this.getRgba(e),a=t.r,i=t.g,n=t.b;return"#"+("0"+a.toString(16)).slice(-2)+("0"+i.toString(16)).slice(-2)+("0"+n.toString(16)).slice(-2)},getLevel:function(e){var t=this.getRgba(e);return.299*t.r+.587*t.g+.114*t.b>=192},colorReverse:function(e){var t="000000"+(16777215-(e="0x"+this.hexColor(e).replace(/#/g,""))).toString(16);return"#"+t.substring(t.length-6,t.length)}}},Ze=(a("d587"),a("c1a8"),Object(l.a)(Ye,(function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"el-color-theme__colors"},e._l(e.rgbaColors,(function(a,i){return t("div",{key:i,class:["el-color-theme__color-selector"],style:{backgroundColor:a.value,boxShadow:a.selected?"0 0 3px 2px ".concat(e.themeConstColor.primary):"none"},on:{click:function(t){return e.handleSelect(i)}}},[[e.descriptions[a.key]?t("el-tooltip",{staticClass:"item",attrs:{slot:"label",effect:"dark",content:e.descriptions[a.key],placement:"top"},slot:"label"},[t("iconfont",{style:{color:e.getLevel(a.value)?e.dark:e.light},attrs:{type:"el-icon-magic-stick"}})],1):t("iconfont",{style:{color:e.getLevel(a.value)?e.dark:e.light},attrs:{type:"el-icon-magic-stick"}})]],2)})),0)])}),[],!1,null,"618f85ce",null)).exports,Qe=[{key:"THEME_CONST_COLOR",icon:"icon-module",label:"基础"},{key:"THEME_LAYOUT_COLOR",icon:"el-icon-setting",label:"系统"},{key:"THEME_INFO_MAP.palette",icon:"el-icon-orange",label:"调色板"}],Xe={name:"Theme",components:{ColorList:Ze},props:{color:{required:!0},showPopper:{type:Boolean,default:!1}},data:function(){return{activeName:"THEME_CONST_COLOR",activeType:"",rgbaColors:[],colorKey:"",themeConstGroup:Qe}},computed:{colors:function(){var e=this.getDeepConstByStr(this.activeName)||{};return this.isObject(e)?(Object.keys(e)||[]).reduce((function(t,a){var i=e[a];return"string"==typeof i&&t.push({key:a,value:i}),t}),[]):Array.isArray(e)?e.map((function(e,t){return{value:e,key:t}})):[]},colorValues:function(){return this.colors.map((function(e){return e.value}))},colorKeys:function(){return this.colors.map((function(e){return e.key}))}},created:function(){this.loadThemeGroups(),this.loadRgbaColors()},watch:{activeName:function(){this.loadRgbaColors()},"$parent.currentColor":function(e){var t=this,a=new Ie;a.fromString(e),this.rgbaColors.forEach((function(e){e.selected=t.colorKey?t.colorKey===a.key:a.compare(e)}))},colors:function(e){this.loadRgbaColors(e)},showPopper:function(e){e&&this.loadRgbaColors()},color:{handler:function(e){this.colorKey=this.color.key},deep:!0},colorKey:function(){this.loadRgbaColors()}},methods:{reset:function(){this.colorKey="",delete this.color.key},loadThemeGroups:function(){var e=this;Qe.forEach((function(t){var a=e.getDeepConstByStr(t.key);a&&e.$set(e,t.key,a)}))},changeGroupType:function(){var e=Qe.filter(this.activeName);e&&e.length&&(this.activeType=e[0].type)},getDeepConstByStr:function(e){if(e=e||"","string"!==this.$util.getObjType(e))return e;var t=window,a=e.split(".");if(a&&a.length>0){for(var i=0;i<a.length&&(t=t[a[i]]);i++);return t}return t[e]},isObject:function(e){return"Object"===Object.prototype.toString.call(e).slice(8,-1)},loadRgbaColors:function(e,t){e=e||this.colors,t=t||this.color,this.rgbaColors=this.parseColors(e,t)},handleTabClick:function(e){this.activeName=e.name},handleSelect:function(e){this.colorKey="".concat(this.activeName,".").concat(this.colors[e].key),this.color.fromString(this.colorValues[e]),this.color.key=this.colorKey},parseColors:function(e,t){var a=this;return e.map((function(e){var i=new Ie;return i.enableAlpha=!0,i.format="rgba",i.fromString(e.value),i.key="".concat(a.activeName,".").concat(e.key),i.selected=t&&t.key?i.key===t.key:i.value===t.value,i}))}}},et=(a("1253"),Object(l.a)(Xe,(function(){var e=this,t=e._self._c;return t("el-tabs",{staticClass:"el-color-theme",on:{"tab-click":e.handleTabClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},e._l(e.themeConstGroup,(function(a){return t("el-tab-pane",{key:a.key,attrs:{name:a.key}},[t("div",{staticClass:"el-color-theme-tab-title",attrs:{slot:"label"},slot:"label"},[t("iconfont",{attrs:{type:a.icon,right:5}}),t("span",{staticStyle:{"font-size":"12px"}},[e._v(e._s(a.label))])],1),t("color-list",{attrs:{colorKey:e.colorKey,rgbaColors:e.rgbaColors},on:{select:e.handleSelect}})],1)})),1)}),[],!1,null,"217b060a",null)).exports,tt={name:"ElColorPickerDropdown",mixins:[Ke.a,Ue.a],components:{Theme:et,SvPanel:$e,HueSlider:Me,AlphaSlider:Be,ElInput:ze.a,ElButton:Ge.a,Predefine:Re},props:{color:{required:!0},showAlpha:Boolean,predefine:Array},data:function(){return{customInput:"",lastValue:""}},computed:{currentColor:function(){var e=this.$parent;return e.value||e.showPanelColor?e.color.value:""}},methods:{handleClear:function(){this.$emit("clear");var e=this.$refs.theme;e&&e.reset()},confirmValue:function(){this.$emit("pick")},handleBak:function(){this.lastValue=this.customInput},handleConfirm:function(e){this.lastValue!==this.customInput&&this.color.key&&(this.color.key=""),this.color.fromString(this.customInput)}},mounted:function(){this.$parent.popperElm=this.popperElm=this.$el,this.referenceElm=this.$parent.$el},watch:{showPopper:function(e){var t=this;!0===e&&this.$nextTick((function(){var e=t.$refs,a=e.sl,i=e.hue,n=e.alpha;a&&a.update(),i&&i.update(),n&&n.update()}))},currentColor:{immediate:!0,handler:function(e){this.customInput=e}}}},at=Object(l.a)(tt,(function(){var e=this,t=e._self._c;return t("transition",{attrs:{name:"el-zoom-in-top"},on:{"after-leave":e.doDestroy}},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.showPopper,expression:"showPopper"}],staticClass:"el-color-dropdown"},[t("div",{staticClass:"el-color-dropdown__main-wrapper"},[t("hue-slider",{ref:"hue",staticStyle:{float:"right"},attrs:{color:e.color,vertical:""}}),t("sv-panel",{ref:"sl",attrs:{color:e.color}})],1),e.showAlpha?t("alpha-slider",{ref:"alpha",attrs:{color:e.color}}):e._e(),e.predefine?t("predefine",{attrs:{color:e.color,colors:e.predefine}}):e._e(),t("theme",{ref:"theme",attrs:{showPopper:e.showPopper,color:e.color}}),t("div",{staticClass:"el-color-dropdown__btns"},[t("span",{staticClass:"el-color-dropdown__value"},[t("el-input",{attrs:{"validate-event":!1,size:"mini"},on:{focus:e.handleBak,blur:e.handleConfirm},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleConfirm.apply(null,arguments)}},model:{value:e.customInput,callback:function(t){e.customInput=t},expression:"customInput"}})],1),t("el-button",{staticClass:"el-color-dropdown__link-btn",attrs:{size:"mini",type:"text"},on:{click:e.handleClear}},[e._v("\n        "+e._s(e.t("el.colorpicker.clear"))+"\n      ")]),t("el-button",{staticClass:"el-color-dropdown__btn",attrs:{plain:"",size:"mini"},on:{click:e.confirmValue}},[e._v("\n        "+e._s(e.t("el.colorpicker.confirm"))+"\n      ")])],1)],1)])}),[],!1,null,null,null).exports,it=a("9169"),nt={name:"ThemeColorPicker",mixins:[a("f6f4").a],props:{value:String,showAlpha:Boolean,colorFormat:String,disabled:Boolean,size:String,popperClass:String,predefine:Array},inject:{elForm:{default:""},elFormItem:{default:""}},directives:{Clickoutside:it.a},computed:{displayedColor:function(){return this.value||this.showPanelColor?this.displayedRgb(this.color,this.showAlpha):"transparent"},_elFormItemSize:function(){return(this.elFormItem||{}).elFormItemSize},colorSize:function(){return this.size||this._elFormItemSize||(this.$ELEMENT||{}).size},colorDisabled:function(){return this.disabled||(this.elForm||{}).disabled}},watch:{value:function(e,t){e?e&&e!==this.color.value&&(Object(S.sb)(e)?this.color.fromString(e):(this.color.fromString(Object(S.cb)(e)),this.color.key=e)):this.showPanelColor=!1},color:{deep:!0,handler:function(){this.showPanelColor=!0}},displayedColor:function(e){if(this.showPicker){var t=new Ie({enableAlpha:this.showAlpha,format:this.colorFormat});t.fromString(this.value),e!==this.displayedRgb(t,this.showAlpha)&&this.$emit("active-change",e)}}},methods:{handleTrigger:function(){this.colorDisabled||(this.showPicker=!this.showPicker)},confirmValue:function(){var e=this.color.key||this.color.value;this.$emit("input",e),this.$emit("change",e),this.dispatch("ElFormItem","el.form.change",e),this.showPicker=!1},clearValue:function(){this.$emit("input",null),this.$emit("change",null),null!==this.value&&this.dispatch("ElFormItem","el.form.change",null),this.showPanelColor=!1,this.showPicker=!1,this.resetColor()},hide:function(){this.showPicker=!1,this.resetColor()},resetColor:function(){var e=this;this.$nextTick((function(t){e.value?e.color.fromString(e.value):e.showPanelColor=!1}))},displayedRgb:function(e,t){if(!(e instanceof Ie))throw Error("color should be instance of Color Class");var a=e.toRgb(),i=a.r,n=a.g,r=a.b;return t?"rgba(".concat(i,", ").concat(n,", ").concat(r,", ").concat(e.get("alpha")/100,")"):"rgb(".concat(i,", ").concat(n,", ").concat(r,")")}},mounted:function(){var e=this.value;e&&(Object(S.sb)(e)?this.color.fromString(e):(this.color.fromString(Object(S.cb)(e)),this.color.key=e)),this.popperElm=this.$refs.dropdown.$el},data:function(){return{color:new Ie({enableAlpha:this.showAlpha,format:this.colorFormat}),showPicker:!1,showPanelColor:!1}},components:{PickerDropdown:at}},rt=Object(l.a)(nt,(function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"clickoutside",rawName:"v-clickoutside",value:e.hide,expression:"hide"}],class:["el-color-picker",e.colorDisabled?"is-disabled":"",e.colorSize?"el-color-picker--".concat(e.colorSize):""]},[e.colorDisabled?t("div",{staticClass:"el-color-picker__mask"}):e._e(),t("div",{staticClass:"el-color-picker__trigger",on:{click:e.handleTrigger}},[t("span",{staticClass:"el-color-picker__color",class:{"is-alpha":e.showAlpha}},[t("span",{staticClass:"el-color-picker__color-inner",style:{backgroundColor:e.displayedColor}}),e.value||e.showPanelColor?e._e():t("span",{staticClass:"el-color-picker__empty el-icon-close"})]),t("span",{directives:[{name:"show",rawName:"v-show",value:e.value||e.showPanelColor,expression:"value || showPanelColor"}],staticClass:"el-color-picker__icon el-icon-arrow-down"})]),t("picker-dropdown",{ref:"dropdown",class:["el-color-picker__panel",e.popperClass||""],attrs:{color:e.color,"show-alpha":e.showAlpha,predefine:e.predefine},on:{pick:e.confirmValue,clear:e.clearValue},model:{value:e.showPicker,callback:function(t){e.showPicker=t},expression:"showPicker"}})],1)}),[],!1,null,null,null).exports;rt.install=function(e){e.component(rt.name,rt)};var ot=rt,lt={props:{runtime:{type:Boolean,default:!1},data:{type:Object,default:function(){return{}}},pageId:{type:String,default:""},parent:{type:Object,default:function(){return{}}}},computed:{isRuntimeMode:function(){return this.runtime||!this.data.isCurrentTopSDC}},watch:{"data.isCurrentTopSDC":{immediate:!0,handler:function(e){var t=this;e&&Object.keys(this.data.attributes).forEach((function(e){var a=t.data.attributes[e];"height"===e&&(a.default="100%"),["layout","foreach"].includes(a.groupName)&&(a.visible=!1)}))}}},methods:{handleEvent:function(e,t){if(t.stopPropagation(),!this.isRuntimeMode){var a={mode:t.pullMode,index:t.newIndex};"add"===e&&(a.parentFid=this.data.fid,this.handleAdd(a))}},handleAdd:function(e){this.$store.dispatch("addComponent",e)},renderChildren:function(e){var t,a=this;return e(this.isRuntimeMode?"div":"draggable",this.isRuntimeMode?{class:"hc-layout-block hc-flow-box-item",style:{height:"100%"}}:{class:"hc-layout-block hc-flow-box-item",style:{height:"100%",width:"100%",minHeight:"32px"},attrs:{group:{name:"components",put:this.handlePut},dataComponentType:"containerSDC",list:this.data.children},nativeOn:{end:function(e){return e.stopPropagation()},start:function(e){return e.stopPropagation()},move:function(e){return e.stopPropagation()},choose:function(e){return e.stopPropagation()},add:function(e){return e.stopPropagation()}},on:{end:function(e){return a.handleEvent("end",e)},start:function(e){return a.handleEvent("start",e)},move:function(e){return a.handleEvent("move",e)},choose:function(e){return a.handleEvent("choose",e)},add:function(e){return a.handleEvent("add",e)}}},[null!==(t=this.data.children)&&void 0!==t&&t.length?this.data.children.map((function(t){return e("component-box",{key:t.fid,props:{parentId:a.data.fid,parent:a.data.children,data:t,runtime:a.runtime,pageId:a.pageId,parentComponentName:"grid"}})})):""])},handlePut:function(e,t,a,i){var n=null==a?void 0:a.dataset.groupName;return["layout","quickLayout"].includes(n)||n.startsWith("SDC_")}},render:function(e){return e("el-row",{style:{height:"100%"}},[this.renderChildren(e)])}},st=a("1ac1"),ct={name:"ContainerSDC",attrs:st,components:{ContainerRender:lt},props:{data:{type:Object,default:function(){}},runtime:{type:Boolean,default:!1},pageId:{type:String,default:""},parent:{type:Object,default:function(){return{}}}},data:function(){return{pagination:{page:null,pageSize:null},SDCTimer:{},SDCTimerWatcher:{}}},watch:{},computed:{showIsFlow:function(){return!this.runtime&&this.data.isCurrentTopSDC}},mounted:function(){this.initImportsAttrs()},beforeDestroy:function(){this.onUnmount()},methods:{onUnmount:function(){this.clearTimerWatcher(),this.clearTimerTimeout()},eventOnload:function(){if(this.runtime){this.timerContentParse();var e=this.data.attributes,t=e&&e.onload,a=t&&t.attributes,i=a&&a.content;(i.attributes||[]).find((function(e){var t;return!(null==e||null===(t=e.executionType)||void 0===t||!t.value)}))&&this.$eventContentParse(i)}},clearTimerWatcher:function(){var e=this;Object.keys(this.SDCTimerWatcher||{}).forEach((function(t){"function"==typeof e.SDCTimerWatcher[t]&&e.SDCTimerWatcher[t]()}))},clearTimerTimeout:function(){for(var e in this.SDCTimer)clearInterval(this.SDCTimer[e]),clearTimeout(this.SDCTimer[e]),this.SDCTimer[e]=null},clearTimer:function(e){var t=this;e&&e.names&&e.names.split(",").forEach((function(e){t.SDCTimer[e]&&(clearTimeout(t.SDCTimer[e]),clearInterval(t.SDCTimer[e]),t.SDCTimer[e]=null)}))},timerContentParse:function(){var e=this,t=this.data.attributes,a=t&&t.timer,i=a&&a.attributes,n=i&&i.content,r=n.attributes||[];this.clearTimerWatcher(),r.forEach((function(t){e.SDCTimerWatcher[Object(S.ob)()]=e.$watch((function(){return t}),(function(){var a=t.timerCycle&&(t.timerCycle.value||t.timerCycle.default),i=t.timerName&&(t.timerName.value||t.timerName.default);clearInterval(e.SDCTimer[i]),clearTimeout(e.SDCTimer[i]),e.SDCTimer[i]=null;var r=t.isTimeCycle&&(t.isTimeCycle.value||t.isTimeCycle.default);if(t.executionContent&&t.executionContent.value){var o;if(r){var l=t.timerCycle.min>a?t.timerCycle.min:t.timerCycle.max<a?t.timerCycle.max:a;o=setInterval((function(){var a=n;a.attributes=[t],e.$eventContentParse(a)}),l)}else o=setTimeout((function(){var a=n;a.attributes=[t],e.$eventContentParse(a)}),a);e.$set(e.SDCTimer,i,o)}}),{deep:!0,immediate:!0})}))},dataLinkMounted:function(e){this.$eventContentParse(this.data.attributes.onResolved.attributes.content,{status:e})},scopedVariableChangeHandler:function(e,t,a,i){},setAttrsVisible:function(e){var t=this;if(!this.runtime){var a=Object.keys(e||{});a.length&&a.forEach((function(a){var i=a.split("."),n=t.data.attributes;i.forEach((function(e){n=n[e]})),t.$setAttr(n,"visible",e[a])}))}},customsChangeHandler:function(e,t,a,i,n){var r=n||a;null!=r&&r.name.startsWith("$V_")&&this.$setVariable(r.name.replace(/^\$V(_)/,r.componentName+"$1"),e)},importsChangeHandler:function(e,t,a,i,n){var r=n||a;if(null!=r&&r.name.startsWith("$I_")&&r.originComponentFid)try{var o;if(this.runtime){o=this.$getComponent(null==r?void 0:r.originComponentFid).data}else{var l=this.$store.getters.pageEditor;o=l.pagesKV[l.pagesActiveName].componentKV[null==r?void 0:r.originComponentFid]}var s=new RegExp("\\^$I_"+r.originComponentFid+"_"),c=o.attributes[r.name.replace(s,"")];this.$setAttr(c,"lastValue",e),this.$setAttr(c,"value",e)}catch(e){}},allDataLinkMountedHandler:function(e){},initImportsAttrs:function(){var e=this;Object.keys(this.data.attributes).forEach((function(t){var a=e.data.attributes[t];t.startsWith("$V_")&&!a.linkable&&a.hasOwnProperty("value")&&e.$setVariable(t.replace(/^\$V(_)/,a.componentName+"$1"),a.value)}))}}},ut=(a("e7fb"),Object(l.a)(ct,(function(){var e=this;return(0,e._self._c)("container-render",{ref:"containerRender",class:{"is-flow":e.showIsFlow},attrs:{data:e.data,runtime:e.runtime,"page-id":e.pageId,parent:e.parent}})}),[],!1,null,"9057a7fc",null)).exports,dt={name:"ComponentExtends",computed:{visibility:function(){var e,t;return null==this||null===(e=this.data)||void 0===e||null===(t=e.attributes)||void 0===t?void 0:t.visibility}},methods:{show:function(){this.$setAttr(this.visibility,"value","inherit")},hide:function(e){var t="object"===this.$util.getObjType(e)?e.placeholder:e;this.$setAttr(this.visibility,"value",t?"hidden":"none")}}};function pt(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function ht(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?pt(Object(a),!0).forEach((function(t){Object(f.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):pt(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function ft(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return mt(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?mt(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,l=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return o=e.done,e},e:function(e){l=!0,r=e},f:function(){try{o||null==a.return||a.return()}finally{if(l)throw r}}}}function mt(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=new Array(t);a<t;a++)i[a]=e[a];return i}a("ffc1"),a("f6b3");var vt=[["title","legend","grid","polar","radiusAxis","angleAxis","radar","geoConfig","grid3D","xAxis3D","yAxis3D","zAxis3D","tooltip"],["dataZoom","inside","slider","visualMap","continuous","piecewise"],["series","xAxis","yAxis","geo","radar"]],bt="attributes",gt="name",yt="groupName",_t="default",Ct="value",Ot={AGetter:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if(e){for(var a=e,i=0,n=(t=t.split(".")).length;i<n;i++){if(void 0===a[t[i]])return;a=a[t[i]]}return a}},ASetter:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;if(!e)return!1;for(var i=e,n=0,r=(t=t.split(".")).length;n<r-1;n++){if(void 0===i[t[n]]&&(i[t[n]]={}),!(i[t[n]]instanceof Object))throw new Error("A."+t.splice(0,n+1).join(".")+"is not Object");i=i[t[n]]}return i[t[n]]=a},AGetLastName:function(e){var t=e.split(".");return t[t.length-1]},ACutFirstName:function(e){return void 0===e?e:e.split(".").slice(1).join(".")},AGetAttributes:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:bt;return Reflect.has(e,t)?e[t]:e},StrToArr:function(e){return"string"==typeof e&&e.startsWith("[")?JSON.parse(e):e},AGetValue:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_t,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ct;if(Reflect.has(e,a)){if(e.linkConfig&&!this.runtime)return this.StrToArr(e[t]);if(""===e[a]&&null===e[t])return this.StrToArr(e[t]);var i=e[a];return"series.data"!==e.name&&"series.originData"!==e.name||(i=Object(y.j)(i),Array.isArray(i))?this.StrToArr(i):[i]}return e.linkConfig&&this.runtime&&"series.data"===e.name?[]:this.StrToArr(e[t])},AGetKV:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:gt,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:_t,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Ct;if(Reflect.has(e,t)&&Reflect.has(e,a))return Object(f.a)({},e[t],this.AGetValue(e,a,i))},AGetMapKV:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:gt,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:_t,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Ct,r=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=0,l=Object.values(t);o<l.length;o++){var s=l[o];r?this.ASetter(e,this.ACutFirstName(s[a]),this.AGetValue(s,i,n)):this.ASetter(e,s[a],this.AGetValue(s,i,n))}return e},AGetArrMapKV:function(e){var t,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:gt,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:_t,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Ct,r=[],o=ft(e.values());try{for(o.s();!(t=o.n()).done;){var l=t.value;r.push(this.AGetMapKV({},l,a,i,n,!0))}}catch(e){o.e(e)}finally{o.f()}return r},AJsonToOption:function(e,t){var a={};this.runtime=t;for(var i=this.AGetAttributes(e),n=0,r=Object.entries(i);n<r.length;n++){var o=Object(w.a)(r[n],2),l=o[0],s=o[1];vt[2].includes(l)?this.ASetter(a,l,this.AGetArrMapKV(this.AGetAttributes(s))):vt[1].includes(l)?Array.isArray(a[s[yt]])?a[s[yt]]=[].concat(Object(d.a)(a[s[yt]]),Object(d.a)(this.AGetArrMapKV(this.AGetAttributes(s)))):this.ASetter(a,s[yt],this.AGetArrMapKV(this.AGetAttributes(s))):vt[0].includes(l)&&this.AGetMapKV(a,this.AGetAttributes(s))}a.series=this.flattenDataArray(JSON.parse(JSON.stringify(a.series))),a.series.forEach((function(e){a.xAxis&&e.xAxisIndex>=a.xAxis.length-1&&(e.xAxisIndex=a.xAxis.length-1),a.yAxis&&e.yAxisIndex>=a.yAxis.length-1&&(e.yAxisIndex=a.yAxis.length-1)}));return a.color=["#5470c6","#91cc75","#fac858","#ee6666","#73c0de","#3ba272","#fc8452","#9a60b4","#ea7ccc","#dbdaf7","#513cfa","#7b1729","#6b7260","#1efc97","#cd7978","#9fb561","#b5e9e5","#4e9a86","#8180e6","#2b8b13","#f19361","#770bb4","#d6f525","#d3f270","#e42e26","#6d7bb4","#4ea1db","#7997c0","#bd5864","#9280aa"],this.handlerData(a,e)},clearAttributes:function(e,t){var a=function(a){var i=t[a];if(e.hasOwnProperty(a)){var n=e[a];for(var r in i.attributes){var o=i.attributes[r];if(isNaN(r)||!Array.isArray(i.attributes))!n[r]&&null!=o&&o.hasOwnProperty("value")&&window.$VUE_ROOT.$removeAttr(o,"value");else if(n[r]&&"object"===Object(Oe.a)(n[r]))for(var l in o){var s;!n[r][l]&&null!==(s=o[l])&&void 0!==s&&s.hasOwnProperty("value")&&window.$VUE_ROOT.$removeAttr(o[l],"value")}else i.attributes.splice(r,1)}}else if(vt.find((function(e){return e.includes(a)})))for(var c in i.attributes){var u;(null===(u=i.attributes[c])||void 0===u?void 0:u.hasOwnProperty("value"))&&window.$VUE_ROOT.$removeAttr(i.attributes[c],"value")}};for(var i in t)a(i)},AOptionToJson:function(e,t){var a=function t(a,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;for(var l in i){var s=i[l];if("object"!==Object(Oe.a)(s)||Array.isArray(s)){var c=e[r].attributes;if(void 0===o||isNaN(o)||!Array.isArray(c)){var u=c["".concat(n).concat(l)];a["".concat(n).concat(l)]="".concat(n).concat(l),(null==u?void 0:u.default)!==s&&window.$VUE_ROOT.$setAttr(u,"value",s)}else{var d;for(null!==(d=c)&&void 0!==d&&d.length||(c=[]);c.length<=Number(o);)c.push(ht(ht({},Object(y.e)(c[0]||{})),{},{fid:Object(S.ob)()}));a.hasOwnProperty(o)||(a[o]={}),a[o]["".concat(n).concat(l)]="".concat(n).concat(l);var p=c[o]["".concat(n).concat(l)];(null!=p&&p.hasOwnProperty("value")||(null==p?void 0:p.default)!==s)&&window.$VUE_ROOT.$setAttr(p,"value",s)}}else t(a,s,"".concat(n).concat(l,"."),r,o)}},i={},n=function(e){if(vt.find((function(t){return t.includes(e)}))){var n=t[e];if("object"===Object(Oe.a)(n))if(Array.isArray(n)){if(n.length)if(vt[1].includes(e)){var r={};n.forEach((function(e){r.hasOwnProperty(e.type)?r[e.type]++:r[e.type]=0,i[e.type]={},a(i[e.type],e,e.type+".",e.type,r[e.type])}))}else n.forEach((function(t,n){i[e]={},a(i[e],t,e+".",e,n)}))}else i[e]={},a(i[e],n,e+".",e)}};for(var r in t)n(r);this.clearAttributes(i,e)},handlerData:function(e,t){var a=t.attributes.commonLinkData||{},i=a.value,n=a.linkConfig;if(i){var r=this.convert2dLinkData(i,n);return this.handlerOption(r,e)}return e},handlerOption:function(e,t){var a=this,i=vt[2];for(var n in t)if(i.includes(n)){var r=t[n];Array.isArray(r)&&r.forEach((function(t){var i=t.dataField,n=t.nameField;if(i&&e.hasOwnProperty(i))if(n&&e.hasOwnProperty(n)){var r=e[i],o=e[n];Array.isArray(r)&&Array.isArray(o)&&(t.data=[],r.forEach((function(e,a){var i={value:e,name:o[a]};t.data.push(i)})))}else t.data=e[i];else if(i.indexOf(",")>-1){var l=a.handler3dData(i,n,e);l.length&&(t.data=l)}}))}return t},handler3dData:function(e,t,a){var i=[],n=e.split(","),r=[];n.length&&n.forEach((function(e){a[e]&&r.push(a[e])})),r.forEach((function(e){e.forEach((function(e,t){if(i[t])i[t].push(e);else{var a=[];a.push(e),i[t]=a}}))}));var o=[];if(!t||!a.hasOwnProperty(t))return i;var l=a[t];return Array.isArray(i)&&Array.isArray(l)?(i.forEach((function(e,t){var a={value:e,name:l[t]};o.push(a)})),o):void 0},convertData:function(e){var t={};return Array.isArray(e)&&e.forEach((function(e){for(var a in e)t.hasOwnProperty(a)||(t[a]=[]),t[a].push(e[a])})),t},convert2dLinkData:function(e,t,a){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=[],r={result:[],pageInfo:{}};if(t&&!t.hasOwnProperty("pagination"))return this.convertData(e);var o=(null==t?void 0:t.fields)||"";n=o?o.split(","):[];var l=[];if(Array.isArray(e)&&t&&(null!=t&&t.containsKey&&t.pagination?(n=e[0],l=e[1],e=e.slice(2,e.length)):null!=t&&t.containsKey&&!t.pagination?(n=e[0],e=e.slice(1,e.length)):null!=t&&t.pagination&&!t.containsKey&&(l=e[0],e=e.slice(1,e.length)),(l&&Array.isArray(l)&&l.length||a)&&(r.pageInfo={page:l[0]||1,pageSize:l[1]||10,total:i?l[2]:l[2]||e.length})),Array.isArray(e)&&Array.isArray(n)&&n.length){var s={};return e.forEach((function(e){Array.isArray(e)&&(e.length>n.length&&(e=e.slice(0,n.length)),e.forEach((function(e,t){var a=n[t];s.hasOwnProperty(a)||(s[a]=[]),s[a].push(e)})))})),s}return this.convertData(e)},flattenDataArray:function(e){for(var t=0;t<e.length;t++)if(e[t].data instanceof Array)for(var a=0;a<e[t].data.length;a++)1===e[t].data[a].length&&(e[t].data[a]=e[t].data[a][0]);return e},getJSON:function(e){return new Promise((function(t,a){var i=new XMLHttpRequest;i.open("GET",e),i.onreadystatechange=function(){4===this.readyState&&(200===this.status?t(this.response):a(new Error(this.statusText)))},i.responseType="json",i.setRequestHeader("Accept","application/json"),i.send()}))},extend:function(e,t){for(var a in t)e[a]=t[a];return e},throttle:function(){var e,t=arguments[0];if("boolean"==typeof t)(e=arguments[1]).__throttleID&&(clearTimeout(e.__throttleID),delete e.__throttleID);else{e=t;var a=arguments[1],i=this.extend({context:null,args:[],time:500},a),n=this.throttle;n(!0,e),e.__throttleID=setTimeout((function(){e.apply(i.context,i.args),n(!0,e)}),i.time)}},clickHandler:function(e,t){var a=t.attributes,i=a&&a.click,n=i&&i.attributes,r=n&&n.content;this.$eventContentParse(r,e)},logHandler:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"图表组件",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a={logData:{message:"".concat(e,"渲染错误，请检查options是否有误"),info:"render chart error"},logTitle:"".concat(e,"错误日志"),logLevel:"error",moduleName:"".concat(e)},i=ht(ht({},a),t);this.$sendLog(i)},setValue:function(e,t,a){Array.isArray(t)?(this.$setAttr(e,"value",t),this.$setVariable(e,t)):this.$message.warning("【".concat(a,"】仅支持数组格式，请确认数据配置是否正确！"))},setDataByGroupAndAttrName:function(e,t,a,i,n){var r=this.data.attributes[a],o=r&&r.attributes&&r.attributes[t];if(o){var l=o[i];l&&Ot.setValue.call(this,l,e,n)}}},Tt=Ot;function Vt(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function wt(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Vt(Object(a),!0).forEach((function(t){Object(f.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Vt(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var Pt=a("eec4"),xt={computed:{echarts:function(){return window.$lib.echarts},themeConstColor:function(){return this.$store.getters.themeConstColor},palette:function(){return this.themeConstColor.palette}},props:{runtime:{type:Boolean,default:!1},data:{type:Object,default:function(){return{}}}},data:function(){return{myChart:null,isClick:!1,chartId:"main".concat(+new Date),chartData:Tt.AJsonToOption(this.data,this.runtime),timer:null,timeNum:300}},beforeDestroy:function(){this.myChart.dispose(),window.removeEventListener("resize",this.resizeChart)},created:function(){var e=this,t="main".concat(+new Date);this.runtime||(t=this.data.attributes.componentName.value),this.chartId=t,setTimeout((function(){e.initListen()}),500)},methods:{parseChartData:function(e){var t=this;this.timer&&clearTimeout(this.timer),this.timer=setTimeout((function(){"chart"===e.groupName&&t.$setAttr(e.attributes.enableRender,"visible",!0),["ChartLine","ChartBar"].includes(e.name)&&t.$setAttr(e.attributes.angleAxis.attributes["angleAxis.axisLine.symbolSize"],"visible",!1),e.attributes.series&&e.attributes.series.attributes&&(e.attributes.xAxis&&(e.attributes.series.attributes||[]).forEach((function(a){t.$setAttr(a["series.xAxisIndex"],"max",e.attributes.xAxis.attributes.length-1)})),e.attributes.yAxis&&(e.attributes.series.attributes||[]).forEach((function(a){t.$setAttr(a["series.yAxisIndex"],"max",e.attributes.yAxis.attributes.length-1)})));var a=Tt.AJsonToOption(e,t.runtime);Object(y.i)(t.chartData,a)||(t.chartData=a,t.handleChartDiff(),t.myEcharts(),t.timer=null)}),this.timeNum)},initChart:function(){var e=this;this.myChart=this.echarts.init(document.getElementById(this.chartId));var t=this.data.attributes.enableRender;!1===(t.hasOwnProperty("value")?t.value:t.default)&&this.runtime||(this.handleChartDiff(),setTimeout((function(){e.myEcharts(),window.addEventListener("resize",e.resizeChart),e.myChart.on("click",(function(t){e.clickEventHandler(t)}))}),0))},drawChart:function(e){var t=this.myChart,a=this.chartData;try{t.clear(),t.setOption(a)}catch(t){"function"==typeof this.$util.logHandler&&this.$util.logHandler.call(this,e)}t.resize()},initListen:function(){var e=Pt(),t=this;e.listenTo(document.getElementById(this.chartId),(function(){try{t.$nextTick((function(){t.myChart&&t.myChart.resize()}))}catch(e){}}))},setOption:function(e,t){var a=arguments,i=this;e=e||{},t=t||{},setTimeout((function(){try{if("object"!==Object(y.g)(e))throw Error("设置option时出错,请检查数据格式");var n=Array.from(a).slice(2);n.length&&i.$message.warning("合并配置参数请放在第二个参数里，系统已忽略".concat(n.join(","),"这几个参数"));var r=i.myChart,o=e,l=o.optMode,s=void 0===l?{}:l,c=o.option,u=void 0===c?{}:c;if(["notMerge","replaceMerge","lazyUpdate","silent"].forEach((function(t){e.hasOwnProperty(t)&&(s[t]=e[t],delete e[t])})),s=wt(wt({},s),t),delete(u=wt(wt({},e),u)).option,"string"==typeof s.replaceMerge&&s.replaceMerge&&(s.replaceMerge=s.replaceMerge.split(",")),!Object.keys(u).length)throw Error("未配置任何option项");r.setOption(u,s)}catch(e){i.$message.warning(e.message||"设置option时出错,请检查数据格式"),i.$util.chartUtils.logHandler.call(i,"echarts图表")}}),0)},resizeChart:function(){this.myChart.resize()},refresh:function(){var e=this.$getCustomGroupNameAttrs(this.data,"linkable");this.$requestLinkData(e)},clickEventHandler:function(e){var t=this;try{if(this.isClick)return;this.isClick=!0,setTimeout((function(){t.isClick=!1}),800);var a=this.data.attributes,i=a&&a.click,n=i&&i.attributes,r=n&&n.content;this.$eventContentParse(r,{params:{componentType:e.componentType,seriesType:e.seriesType,seriesIndex:e.seriesIndex,seriesName:e.seriesName,name:e.name,dataIndex:e.dataIndex,data:e.data,value:e.value,color:e.color}})}catch(e){var o={logData:{message:e.message,info:"".concat(this.data.name,"事件执行出错")},logTitle:"".concat(this.data.alias,"组件")};this.$sendLog(o)}},handleChartDiff:function(){var e=this.data.name;["ChartLine","ChartBar","ChartScatter"].includes(e)&&this.handleDataZoom()}}},St=a("9a04");function jt(e){var t=new Proxy(Proxy,{construct:function(e,t){var a=Object(St.a)(e,Object(d.a)(t));return Object.defineProperty(a,"__isProxy__",{value:"Proxy",enumerable:!1,configurable:!0}),a}}),a=new Proxy(e.prototype.$set,{apply:function(e,t,a){var i=Object(w.a)(a,3),n=i[0],r=i[1],o=i[2];return null!=n&&n.__isProxy__&&("value"===r&&JSON.stringify(n.__originValue__)!==JSON.stringify(o)?n.__originValue__=o:"default"===r&&JSON.stringify(n.__originDefault__)!==JSON.stringify(o)&&(n.__originDefault__=o)),e.apply(t,a)}}),i=new Proxy(e.prototype.$delete,{apply:function(e,t,a){var i=Object(w.a)(a,2),n=i[0],r=i[1];return null!=n&&n.__isProxy__&&null!=n&&n.__originValue__&&"value"===r&&(n.__originValue__="__delete__"),e.apply(t,a)}});window.Proxy=t,e.prototype.$set=a,e.prototype.$delete=i}function Et(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function kt(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Et(Object(a),!0).forEach((function(t){Object(f.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Et(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var It={name:"CommonTableMoveOprate",props:{data:{type:Array,default:function(){return[]}},index:{type:Number,default:0},icon:{type:Boolean,default:!0},text:{type:Boolean,default:!1},layout:{type:[Array,String],default:"top, bottom, del, clear"},clear:{type:Function,default:function(){}},keyMap:{type:Object,default:function(){return{}}},plain:{type:Boolean,default:!1},defaultValue:{type:Object,default:function(){return{}}}},computed:{operations:function(){var e=this.layout,t=this.index,a=this.items,i=this.data.filter((function(e){return"group"!==e.filterType})).length,n=[];"string"==typeof e&&(e=(e=e.replace(/\s/g,"")).split(","));var r=e.includes("add"),o=e.includes("clear");return e.forEach((function(e){"add"===e?0===t&&n.push(a[e]):"clear"===e?1===i&&n.push(a[e]):"del"===e?r?n.push(a[e]):o&&1===i||n.push(a[e]):n.push(a[e])})),n},disabled:function(){var e=this;return function(t){return"function"==typeof t.disabled?t.disabled(e.index,e.data):!0===t.disabled}}},data:function(){return{items:{top:{key:"top",name:"上移",disabled:function(e){return 0===e},icon:"el-icon-top"},bottom:{key:"bottom",name:"下移",disabled:function(e,t){return e===t.length-1},icon:"el-icon-bottom"},add:{key:"add",name:"新增",icon:"el-icon-plus"},del:{key:"del",name:"删除",disabled:function(e,t){return 1===t.length},type:"danger",icon:"el-icon-minus"},clear:{key:"clear",name:"清空",type:"danger",icon:"el-icon-close"},copy:{key:"copy",name:"复制",icon:"el-icon-document-copy"},paste:{key:"paste",name:"粘贴",icon:"el-icon-document-checked"}},defaultKeyMap:{top:"top",bottom:"bottom",add:"add",del:"del",clear:"clear",copy:"copy",paste:"paste"}}},methods:{handleClick:function(e){var t=this,a=kt(kt({},this.defaultKeyMap),this.keyMap);if(this.$emit("click",a[e],this.index),"clear"===e){var i=this.data[this.index];if("function"==typeof this.clear)if(!1===this.clear(i,this.index))return;this.$confirm("确定要清空吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.innerClear(i),t.$emit("click",a[e],t.index)})).catch((function(){}))}},innerClear:function(e){for(var t in e)this.defaultValue.hasOwnProperty(t)?e[t]=this.defaultValue[t]:e[t]="editValue"===t?"":"logicExp"===t?"eq":"sort"===t?"asc":""}}},At=(a("344c"),Object(l.a)(It,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"common-table-move-oprate"},e._l(e.operations,(function(a){return t("el-button",{key:a.key,class:{"plain-style":e.plain},attrs:{size:"mini",type:e.plain?"":"text",title:a.name,disabled:e.disabled(a),icon:e.icon?a.icon:"",plain:e.plain},on:{click:function(t){return e.handleClick(a.key)}}},[e._v("\n    "+e._s(e.text?a.name:"")+"\n  ")])})),1)}),[],!1,null,"4d724c2c",null)).exports,Dt=(a("55dd"),function(){var e=this,t=e._self._c;return t("div",{staticClass:"page-open"},[e.dialogVisible?t("el-dialog",{directives:[{name:"elDragDialog",rawName:"v-elDragDialog",value:!0,expression:"true"}],staticClass:"page-open-dialog",attrs:{draggable:!0,visible:e.dialogVisible,"close-on-click-modal":!1,title:e.settings.title||"设置"+(e.data.alias||e.data.name),width:"76%","append-to-body":!0,"modal-append-to-body":!0,top:"4vh"},on:{close:e.close}},[e.dialogVisible?t("component-page-manage",{ref:"pageManage",attrs:{groupId:e.settings.parentId,mode:e.modeType},on:{"current-change":e.handleChange}}):e._e(),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-row",[t("el-col",{staticClass:"dialog-footer-tips",attrs:{span:16}},[e.editorVal.page.name?[e._v("\n            当前已选"+e._s(e.isSDC?"二开组件":"页面")+"："+e._s(e.editorVal.page.name)+"\n          ")]:[e._v("\n            请点击表格行以选择"+e._s(e.isSDC?"二开组件":"页面")+"\n          ")]],2),t("el-col",{staticClass:"dialog-footer-buttons",attrs:{span:8}},[t("el-button",{on:{click:e.cancel}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.clickSure}},[e._v("确 定")])],1)],1)],1)],1):e._e()],1)}),Nt={name:"PageOpen",props:{settings:{type:Object,default:function(){return{title:"",width:"70%",pageName:"",className:"page-open-dialog",type:""}}}},inject:["isSDC"],data:function(){return{editorVal:{type:"page",page:{id:"",name:"",groupName:""},group:{id:"",name:"",groupName:""}},modeType:"full",dialogVisible:!1}},watch:{dialogVisible:function(e){this.clear()}},methods:{handleChange:function(e){this.setEditorVal(e.page,e.group)},setEditorVal:function(e,t){e&&(this.editorVal.page.id=e.id,this.editorVal.page.name=e.name,this.editorVal.page.groupName=e.parentPageName),t&&(this.editorVal.group.id=t.id,this.editorVal.group.name=t.name,this.editorVal.group.groupName=e.parentPageName)},open:function(){this.dialogVisible=!0},close:function(){this.dialogVisible=!1},cancel:function(){this.dialogVisible=!1},clear:function(){this.editorVal={type:"page",page:{id:"",name:"",groupName:""},group:{id:"",name:"",groupName:""}}},clickSure:function(){this.$emit("onSure",{dialog:this,editorVal:this.editorVal})}}},$t=(a("b216"),Object(l.a)(Nt,Dt,[],!1,null,null,null)).exports,Lt={name:"PageSave",props:{settings:{type:Object,default:function(){return{title:"",width:"70%",pageName:"",parentId:"",className:"page-save-dialog",mode:"quick",type:""}}}},inject:["isSDC"],data:function(){return{editorVal:{name:this.settings.pageName,componentName:this.settings.componentName,parentId:"0",type:""},modeType:"quick",dialogVisible:!1,rules:{name:[{required:!0,message:"请输入".concat(this.isSDC?"二开组件别名":"页面名称"),trigger:"blur"},{max:50,message:"长度在 1 到 50 个字符",trigger:"blur"}],componentName:[{required:!0,message:"请输入二开组件名称",trigger:"blur"},{max:50,message:"长度在 1 到 50 个字符",trigger:"blur"}]}}},watch:{dialogVisible:function(e){e?this.initData():this.clear()}},methods:{initData:function(){var e=this;this.editorVal.name=this.settings.pageName,this.editorVal.parentId=this.settings.parentId||"0",this.editorVal.type=this.settings.type,this.editorVal.componentName=this.settings.componentName,this.$nextTick((function(){e.$refs.name.focus()}))},handleChange:function(e){this.editorVal.parentId=e.id||"0"},open:function(){this.dialogVisible=!0},close:function(){this.dialogVisible=!1},cancel:function(){this.dialogVisible=!1},clear:function(){this.editorVal={name:"",parentId:"",type:"",componentName:""}},clickSure:function(){var e=this;this.$refs.formRef.validate((function(t,a){if(t)if(e.editorVal.parentId)if(e.editorVal.name)if(!e.isSDC||e.editorVal.componentName)if(e.editorVal.name.length>50)e.$message.warning("".concat(e.isSDC?"二开组件别名":"页面名称","最大长度不能超过50！"));else{var i={dialog:e,editorVal:e.editorVal};if(e.isSDC){var n=Object(y.h)(window.location.href,"projectIdentifier")||"COMMON";i.editorVal.projectIdentifier=n}e.$emit("onSure",i)}else e.$message.warning("".concat(e.isSDC?"二开组件名称":"页面标识","不能为空！"));else e.$message.warning("".concat(e.isSDC?"二开组件别名":"页面名称","不能为空！"));else e.$message.warning("请选择".concat(e.isSDC?"二开组件":"页面","分组！"))}))}}},Mt=(a("5f6d"),Object(l.a)(Lt,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"page-save"},[e.dialogVisible?t("el-dialog",{directives:[{name:"elDragDialog",rawName:"v-elDragDialog",value:!0,expression:"true"}],staticClass:"page-editor-dialog",attrs:{draggable:!0,visible:e.dialogVisible,"close-on-click-modal":!1,title:e.settings.title||"设置"+(e.data.alias||e.data.name),width:"76%","append-to-body":!0,"modal-append-to-body":!0,top:"4vh"},on:{close:e.close}},[e.dialogVisible?t("component-page-manage",{ref:"pageManage",attrs:{groupId:e.editorVal.parentId,mode:e.modeType},on:{"current-group-change":e.handleChange}}):e._e(),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-form",{ref:"formRef",attrs:{"label-width":"120px",model:e.editorVal,"inline-message":!0,rules:e.rules}},[t("el-row",[t("el-col",{staticClass:"dialog-footer-tips",attrs:{span:e.isSDC?8:16}},[t("div",{staticClass:"dialog-footer-form"},[t("el-form-item",{attrs:{label:"".concat(e.isSDC?"二开组件别名":"页面名称"),prop:"name"}},[t("el-input",{ref:"name",attrs:{placeholder:"请输入".concat(e.isSDC?"二开组件别名":"页面名称"),clearable:""},model:{value:e.editorVal.name,callback:function(t){e.$set(e.editorVal,"name",t)},expression:"editorVal.name"}})],1)],1)]),e.isSDC?t("el-col",{staticClass:"dialog-footer-tips",attrs:{span:8}},[t("div",{staticClass:"dialog-footer-form"},[t("el-form-item",{attrs:{label:"".concat(e.isSDC?"二开组件名称":"页面标识"),prop:"componentName"}},[t("el-input",{ref:"name",attrs:{placeholder:"请输入".concat(e.isSDC?"二开组件名称":"页面标识"),clearable:""},model:{value:e.editorVal.componentName,callback:function(t){e.$set(e.editorVal,"componentName",t)},expression:"editorVal.componentName"}})],1)],1)]):e._e(),t("el-col",{staticClass:"dialog-footer-buttons",attrs:{span:8}},[t("el-button",{on:{click:e.cancel}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.clickSure}},[e._v("确 定")])],1)],1)],1)],1)],1):e._e()],1)}),[],!1,null,null,null)).exports,qt=function(){function e(){Object(Te.a)(this,e),this.init()}return Object(Ve.a)(e,[{key:"init",value:function(){}}],[{key:"toData",value:function(e){var t,a,i=this;if(null==e||null===(t=e.page)||void 0===t||null===(a=t.attributes)||void 0===a||!a.length)return e;var n=Object(y.e)(e),r=n.page.attributes;n.page.attributes=r.filter((function(e){var t=i.BASE_DATA[e.name];return!t||i.isDiff(t,e)}));var o=n.countKV;return Object.keys(o).forEach((function(e){0===o[e]&&delete n.countKV[e]})),n}},{key:"toEdit",value:function(e){var t,a=this;if(!Array.isArray(null==e||null===(t=e.page)||void 0===t?void 0:t.attributes))return e;var i=Object(y.e)(e),n=i.page.attributes,r=n.map((function(e){return e.name}));return Object.keys(this.BASE_DATA).forEach((function(e){r.includes(e)||n.push(a.BASE_DATA[e])})),i.page.attributes=n,i}},{key:"isDiff",value:function(e,t){var a=!0;try{var i=JSON.stringify(e),n=JSON.stringify(t);i.length===n.length&&i===n&&(a=!1)}catch(e){}return a}}]),e}();Object(f.a)(qt,"BASE_DATA",{pageTitle:{name:"pageTitle"},permissionId:{name:"permissionId"},customVariable:{name:"customVariable",attributes:[[{name:"objectAttr",attributes:[[]]}]]},onbeforeload:{name:"onbeforeload",attributes:[{name:"content",attributes:[[{name:"executionTitle",value:""},{name:"executionType",value:"method"}]]}]},onload:{name:"onload",attributes:[{name:"content",attributes:[[{name:"executionTitle",value:""},{name:"executionType",value:"method"}]]}]},timer:{name:"timer",attributes:[{name:"content",attributes:[[{name:"executionTitle",value:""},{name:"executionType",value:"method"}]]}]},beforeunload:{name:"beforeunload",attributes:[{name:"content",attributes:[[{name:"executionTitle",value:""},{name:"executionType",value:"method"}]]}]},afterRefreshAsyncVariables:{name:"afterRefreshAsyncVariables",attributes:[{name:"content",attributes:[[{name:"executionTitle",value:""},{name:"executionType",value:"method"}]]}]},onresize:{name:"onresize",attributes:[{name:"content",attributes:[[{name:"executionTitle",value:""},{name:"executionType",value:"method"}]]}]},onKeyDown:{name:"onKeyDown",attributes:[{name:"content",attributes:[[{name:"executionTitle",value:""},{name:"executionType",value:"method"}]]}]},customMethods:{name:"customMethods",attributes:[[{name:"customMethodsSetting",attributes:[{name:"payload",attributes:[[]]}]}]]}});var Bt=qt,Ft=a("a599");function Rt(e){if(e instanceof Set){var t=Object(d.a)(e),a=new Set;return t.forEach((function(e){var t=e.split(".")[0];t&&a.add(t)})),Object(d.a)(a)}return[]}function Kt(e,t,a){var i=!0,n=new Set;return t.forEach((function(t){var r=t.name,o=(t.value,t.relative),l=e.concat();l.push(r);var s=o.map((function(e){return function(e,t){return t.find((function(t){return t.name===e}))}(e,a)})).filter((function(e){return e}));return l.length>Object(d.a)(new Set(l)).length?(i=!1,l.length&&n.add(l[0]),!1):!s.length||void(Kt(l,s,a).flag||(l.length&&n.add(l[0]),i=!1))})),{repeated:n,flag:i}}function Ut(e){var t,a=[],i=(null===(t="".concat(e).match(/\$\{(.*?)\}/g))||void 0===t?void 0:t.map((function(e){return e.substring(2,e.length-1)})))||[];return a=[].concat(Object(d.a)(a),Object(d.a)(i))}function zt(e){var t=[];return e.forEach((function(e){var a,i,n,r=null===(a=e.find((function(e){return"name"===e.name})))||void 0===a?void 0:a.value,o=(null===(i=e.find((function(e){return"value"===e.name})))||void 0===i?void 0:i.value)||"",l=Ut(o),s=new Set;l.forEach((function(e){s.add(e)}));var c,u=null===(n=e.find((function(e){return"isObject"===e.name})))||void 0===n?void 0:n.value,p=new Set;u&&((null===(c=e.find((function(e){return"objectAttr"===e.name})))||void 0===c?void 0:c.attributes)||[]).forEach((function(e){var a,i,n=null===(a=e.find((function(e){return"name"===e.name})))||void 0===a?void 0:a.value,o="".concat(r,".").concat(n),l=(null===(i=e.find((function(e){return"value"===e.name})))||void 0===i?void 0:i.value)||"",s=Ut(l),c=new Set;s.forEach((function(e){p.add(e),c.add(e)}));var u=Object(d.a)(c);t.push({name:o,value:l,relative:u})}));var h=new Set([].concat(Object(d.a)(s),Object(d.a)(p)));t.push({name:r,value:o,relative:Object(d.a)(h)})})),t}a("4f7f");var Gt=a("d374"),Ht=a("c0e9"),Wt=a.n(Ht);function Jt(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function Yt(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Jt(Object(a),!0).forEach((function(t){Object(f.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Jt(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var Zt={name:"Header",components:{PageOpen:$t,PageSave:Mt},props:{height:{type:Number,default:14}},inject:["targetTypeByPageType","isProjectPage","isSDC"],data:function(){return{timer:null,isDisabledPreview:!1,isDisabledPublish:!1,pageOpenSettings:{parentId:this.getPageParentId(),title:"打开".concat(this.isSDC?"二开组件":"页面")},pageSaveSettings:{parentId:"",pageName:"",title:"保存".concat(this.isSDC?"二开组件":"页面"),type:"",componentName:""},pageId:"",templateId:"",templateIdentifier:"",pageBorder:!1,bemPointerAll:!1,openIds:{},pageType:null,autoSaveInterval:null,autoSaveCycle:60,autoSave:!1,savingPage:!1}},computed:Yt(Yt({},Object(He.a)(["customMethods"])),{},{currentPage:function(){var e=this.$store.getters.pageEditor,t=e.pagesActiveName;return e.pagesKV[t]},excludes:function(){var e=this.currentPage;return["Page","Arguments","pageVariable","customVariable","Response","Request",e?e.page.fid:""]},isTemplate:function(){return!this.pageId&&!!this.templateId},isProjectPageFromUrl:function(){return"true"===Object(y.h)(this.$route.query).isProjectPage},projectIdentifierByUrl:function(){return Object(y.h)(window.location.href,"projectIdentifier")},isH5Page:function(){return(this.isProjectPage||this.isTemplate)&&!this.isProjectPageFromUrl}}),created:function(){var e=this;this.getComponents((function(){var t=Object(y.h)(e.$route.query),a=t.pageId,i=t.templateId;e.pageType=t.pageType,a?(e.pageId=a,e.setRouteQuery("pageId",a),e.fetchPage(a)):i&&(e.templateId=i,e.templateIdentifier=t.templateIdentifier,e.setRouteQuery("templateId",i),e.fetchModel(i,t.templateIdentifier))})),this.$store.commit("SET_HEADER_INSTANCE",this)},mounted:function(){this.addEvents(),this.initHasBorder(),window.$getCurPageCodeInfo=this.getCurPageCodeInfo.bind(this)},beforeDestroy:function(){window.removeEventListener("beforeunload",this.handleBeforeunload),document.removeEventListener("keydown",this.keydownListener),this.destroyAutoSave()},watch:{bemPointerAll:function(e){this.$store.dispatch("serBemPointerAll",e)}},methods:{handleAutoSaveChange:function(e){this.autoSave=e,e?(this.$message.success("自动保存已开启"),this.initAutoSave()):(this.$message.success("自动保存已关闭"),this.destroyAutoSave())},initAutoSave:function(){var e=1e3*this.autoSaveCycle;this.autoSaveInterval=setInterval(this.handlePageSave,e,!1)},destroyAutoSave:function(){this.autoSaveInterval&&clearInterval(this.autoSaveInterval)},initBemPointerAll:function(){},initHasBorder:function(){this.pageBorder=!!this.$util.getStore({name:"hasBorder"})},addEvents:function(){window.addEventListener("beforeunload",this.handleBeforeunload),document.addEventListener("keydown",this.keydownListener)},keydownListener:function(e){e.ctrlKey&&83===e.keyCode&&(e.preventDefault(),this.handleCtrlS())},handleBeforeunload:function(e){this.getUnSaved()&&(e.preventDefault(),e.returnValue="")},getComponents:function(e){var t=this,a=this.$store.getters.pageEditor;(null==a?void 0:a.componentUrl)!==this.$store.getters.compIndexUrl&&this.$store.commit("DELETE_COMPONENTS");var i=null==a?void 0:a.components;if(i&&i.length)"function"===Object(y.g)(e)&&e();else{var n=[];this.$util.request({url:"/api/component/components",params:{pagination:0},method:"get"}).then((function(e){t.$store.getters.pageEditor.innerComponents.concat(e||[]).forEach((function(e){if(0!==e.status){var t=window.Vue.options.components[e.name];t&&i.push(t.options.attrs||{})}else n.push(e.name)})),t.$store.commit("SET_ORIGIN_COMPONENTS",e)})).finally((function(){i=i.sort((function(e,t){return e.order-t.order})),i=Object(S.l)(i,t.$store.getters.pageEditor),t.$store.dispatch("convertComponents",i),t.$store.commit("SET_DISABLE_COMPONENTS",n),t.$store.commit("SET_COMPONENTS_URL",t.$store.getters.compIndexUrl),"function"===Object(y.g)(e)&&e()}))}},createPage:function(e){this.$store.dispatch("createPage",Yt(Yt({},e),{},{isSDC:this.isSDC}))},handleCreate:function(){var e=this,t=this.getUnSaved();t||this.pageId?this.$confirm("当前页面正在编辑, 是否要强制覆盖?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.pageId=null,e.setRouteQuery("pageId",null),e.$store.dispatch("createPage",{isSDC:e.isSDC})})):null!==this.pageId||t?(this.pageId=null,this.setRouteQuery("pageId",null),this.$store.dispatch("createPage",{isSDC:this.isSDC})):this.$message.warning("当前页面未保存，请保存后新建")},handleCtrlS:function(){this.handleClick("save")},handlePageSave:function(){var e,t,a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],i=JSON.parse(this.getPageData(this.currentPage)),n=null===(e=i.page)||void 0===e?void 0:e.attributes.find((function(e,t){return"customMethods"===e.name}));n.attributes=n.attributes.filter((function(e){return e.hasOwnProperty("value")}));var r=null===(t=i.page)||void 0===t?void 0:t.attributes.find((function(e,t){return"customVariable"===e.name})),o=zt(r.attributes),l=Kt([],o,o),s=Rt(l.repeated);if(l.flag){var c=this.validateRepeat(r.attributes);1!==c.length?2!==c.length?this.pageId?this.handleSavePage(a):this.templateId?this.handleSaveModel(a):this.handleSaveDialog("save"):this.$message({message:"自定义变量 ".concat(c[0]," 中存在重复key：").concat(c[1]),type:"error"}):this.$message({message:"存在重复自定义变量：".concat(c[0]),type:"error"})}else this.$message({message:"自定义变量(".concat(s.join(","),")出现循环引用"),type:"error"})},validateRepeat:function(e){var t=[];return function e(a,i){var n={};a.some((function(a){var r={};if(a.forEach((function(e){"name"===e.name?r.key=e.value:"isObject"===e.name?r.isObject=e.value:"objectAttr"===e.name&&(r.objectAttr=e.attributes)})),n[r.key]?t=[i,r.key].filter((function(e){return e})):(t=[],n[r.key]=!0),t.length)return!0;r.isObject&&e(r.objectAttr,r.key)}))}(e),t},handleClick:function(e){var t=this;this.debounceHandler((function(){"create"!==e?"open"!==e?"save"!==e?"saveAs"!==e?"preview"!==e?"publish"!==e?"previewAndPublish"===e&&t.handlePublish(!0):t.handlePublish(!1):t.handlePreview():t.handleSaveDialog("saveAs"):t.handlePageSave():t.handleOpenDialog():t.handleCreate()}))},handleCommand:function(e){this.handleClick(e)},handleOpenDialog:function(){var e=this.currentPage;if(e){if(!e.id||this.getUnSaved())return void this.$message.warning("当前编辑的页面未保存, 请先保存！");this.$refs.headerPageOpen.open()}else this.$refs.headerPageOpen.open()},handleSaveDialog:function(e){this.currentPage?(this.changeDialogTitle(e),this.$refs.headerPageSave.open()):this.$message.warning("未找到页面")},changeDialogTitle:function(e){if("save"===e)return this.pageSaveSettings.title=(this.isSDC?"二开组件":"页面")+"保存",this.pageSaveSettings.pageName=this.getPageName(),this.pageSaveSettings.type="save",this.pageSaveSettings.parentId=this.getPageParentId(),void(this.pageSaveSettings.componentName="");"saveAs"===e&&(this.pageSaveSettings.title=(this.isSDC?"二开组件":"页面")+"另存为",this.pageSaveSettings.pageName=this.getPageName(),this.pageSaveSettings.type="saveAs",this.pageSaveSettings.parentId=this.getPageParentId(),this.pageSaveSettings.componentName="")},getUnSaved:function(){var e=this.currentPage;return!e||e.unSaved},handleOpenOnSure:function(e){var t=this,a=e.dialog,i=e.editorVal,n=i.id||i.page.id;this.getUnSaved()||this.pageId?this.$confirm("当前页面正在编辑, 是否要强制覆盖?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.pageId=n,t.setRouteQuery("pageId",n),t.fetchPage(n),a.close()})):(this.pageId=n,this.setRouteQuery("pageId",n),this.fetchPage(n),a.close())},replaceSDCName:function(e,t,a){if(!e||!t||!a)return e;t=t.replace(/^#T-/,"");var i=new RegExp("#T-".concat(t),"g");return e.replace(i,"#T-".concat(a))},handleSaveOnSure:function(e){var t,a,i=this,n=this.getPageData(this.currentPage);if(this.isSDC&&null!==(t=this.currentPage.component)&&void 0!==t&&t.length&&e.editorVal.componentName){var r,o,l=null===(r=this.currentPage.component[0].attributes)||void 0===r||null===(o=r.componentName)||void 0===o?void 0:o.value;n=this.replaceSDCName(n,l,e.editorVal.componentName)}var s=zt((null===(a=JSON.parse(n).page)||void 0===a?void 0:a.attributes.find((function(e){return"customVariable"===e.name}))).attributes),c=Kt([],s,s),u=Rt(c.repeated);if(c.flag){var d=e.dialog,p=e.editorVal,h=Yt(Yt({},this.getSaveData(n)),p);delete h.type,this.pageCreateHandle(h,(function(e){i.$message.success("保存成功"),i.pageId=e,i.setRouteQuery("pageId",e),i.fetchPage(e),d.close()}),(function(e){"81030004"===e.code&&i.$confirm("页面名称已存在，是否要强制覆盖?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){i.pageCreateHandle(Yt(Yt({},h),{},{forceCover:1}),(function(e){i.$message.success("覆盖成功"),i.pageId=e,i.setRouteQuery("pageId",e),i.fetchPage(e),d.close()}))}))}))}else this.$message({message:"自定义变量(".concat(u.join(","),")出现循环引用"),type:"error"})},pageCreateHandle:function(e,t,a){var i={url:"/api/page/pages",method:"post",data:e,meta:{errorValidator:function(e){if(e.error&&"PAGE_NAME_EXIST"===e.error.errorId)return!1}}};this.$util.request(i).then((function(e){t(e.id)})).catch((function(e){a(e)}))},setRouteQuery:function(e,t){var a,i=this.$route.path||"/page-editor";if(!t){var n,r=JSON.parse(JSON.stringify((null==this||null===(n=this.$route)||void 0===n?void 0:n.query)||{}));return delete r[e],void this.$router.push({path:i,query:r})}this.$router.push({path:i,query:Yt(Yt({},(null==this||null===(a=this.$route)||void 0===a?void 0:a.query)||{}),{},Object(f.a)({},e,t))})},getSaveData:function(e){var t=this.currentPage;if(t)return{name:t.name,title:this.getPageTitleByAttr(t.page),parentId:t.parentId,pageType:t.pageType,pageData:e||this.getPageData(t),permissionId:this.getPermissionId(t.page),orgId:this.getOrgId(t.page)};this.$message.warning("未找到页面")},fetchPage:function(e){var t=this,a={url:"/api/page/pages/"+e+(this.pageType?"?pageType=".concat(this.pageType):""),method:"get"};this.$util.request(a).then((function(e){t.pageId=e.id,t.setRouteQuery("pageId",e.id),t.createPage(e)})).catch((function(e){"81030001"===e.code&&(t.pageId="",t.setRouteQuery("pageId"))}))},fetchModel:function(e,t){var a=this,i={url:"/api/thing-model/model-template/".concat(t,"/page/").concat(e),method:"get"};this.$util.request(i).then((function(e){a.templateId=e.id,a.createPage(e)})).catch((function(e){"81030001"===e.code&&(a.templateId="",a.setRouteQuery("templateId"))}))},handleSavePage:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],a=this.currentPage;if(a){var i=this.getPageData(a),n=Object(y.j)(i),r=Bt.toData(n);this.savingPage=!0,setTimeout(Object(V.a)(x.a.mark((function i(){var n,o,l;return x.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(n={url:"/api/page/pages/".concat(a.id),method:"patch",data:{id:a.id,name:a.name,title:e.getPageTitleByAttr(a.page),parentId:a.parentId,pageType:a.pageType,pageData:Object(y.b)(r),permissionId:e.getPermissionId(a.page),orgId:e.getOrgId(a.page)}},!e.isSDC){i.next=6;break}return o=e.currentPage.componentInstance[e.currentPage.component[0].fid],l=o.$el,i.next=6,Wt()(l).then((function(e){var t=e.toDataURL("image/png");n.data.icon=t}));case 6:e.$util.request(n).then((function(a){t&&e.$message.success("保存成功"),e.$store.commit("SET_UN_SAVED",!1)})).catch((function(e){})).finally((function(){e.savingPage=!1}));case 7:case"end":return i.stop()}}),i)}))),200)}else this.$message.warning("未找到页面")},handleSaveModel:function(e){var t=this,a=this.currentPage;if(a){var i=this.getPageData(a),n=Object(y.j)(i),r=Bt.toData(n);setTimeout(Object(V.a)(x.a.mark((function i(){var n;return x.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:n={url:"/api/thing-model/model-template/".concat(t.templateIdentifier,"/page/").concat(t.templateId),method:"patch",data:{name:a.name,description:"",pageData:Object(y.b)(r)}},t.$util.request(n).then((function(a){e&&t.$message.success("保存成功"),t.$store.commit("SET_UN_SAVED",!1)})).catch((function(e){}));case 2:case"end":return i.stop()}}),i)}))),200)}else this.$message.warning("未找到页面")},getPermissionId:function(e){var t,a=e&&e.attributes;return a?null==a||null===(t=a.permissionId)||void 0===t?void 0:t.value:""},getOrgId:function(e){return""},getPageTitleByAttr:function(e){var t,a;return null==e||null===(t=e.attributes)||void 0===t||null===(a=t.pageTitle)||void 0===a?void 0:a.value},getPageData:function(e){var t,a,i,n;if((null===(t=e.page.attributes)||void 0===t||null===(a=t.customVariable)||void 0===a?void 0:a.attributes.length)>1){var r,o,l,s=(null===(r=e.page.attributes)||void 0===r?void 0:r.customVariable.attributes.filter((function(e){return"name"===e.name.name&&e.name.hasOwnProperty("value")&&""!==e.name.value})).length)<1;e.page.attributes.customVariable.attributes=null===(o=e.page.attributes)||void 0===o||null===(l=o.customVariable)||void 0===l?void 0:l.attributes.filter((function(e,t){return!(!s||0!==t)||!("name"===e.name.name&&""===e.name.default&&!e.name.hasOwnProperty("value"))}))}if((null===(i=e.page.attributes)||void 0===i||null===(n=i.customMethods)||void 0===n?void 0:n.attributes.length)>1){var c,u,d,p=(null===(c=e.page.attributes)||void 0===c?void 0:c.customMethods.attributes.filter((function(e){return"name"===e.name.name&&e.name.hasOwnProperty("value")&&""!==e.name.value})).length)<1;e.page.attributes.customMethods.attributes=null===(u=e.page.attributes)||void 0===u||null===(d=u.customMethods)||void 0===d?void 0:d.attributes.filter((function(e,t){return!(!p||0!==t)||!("name"===e.name.name&&""===e.name.default&&!e.name.hasOwnProperty("value"))}))}var h={component:this.getSaveComponent(Object(y.e)(e.component)),page:this.getSavePage(Object(y.e)(e.page)),countKV:Object(y.e)(e.countKV),version:window.pageVersion,customMethods:this.customMethods};return Object(y.b)(h)},getSaveComponent:function(e){var t=this;if(e){var a=[];return e.forEach((function(e){var i,n;if(delete e.isCurrentTopSDC,e.type||"block"===e.name){var r="block"===e.name?e:{fid:e.fid,name:e.name,componentId:null==e||null===(i=e.attributes)||void 0===i||null===(n=i.componentName)||void 0===n?void 0:n.value};if(e.hasOwnProperty("tabIndex")&&(r.tabIndex=e.tabIndex),e.attributes){var o=t.getAttrs(e.attributes,e);o&&o.length>0&&(r.attributes=o)}var l=t.getSaveComponent(e.children);l&&l.length>0&&(r.children=l),e.compatibleConfig&&(r.compatibleConfig=e.compatibleConfig),a.push(r)}else a.push(e)})),a}},getSavePage:function(e){var t,a,i={fid:e.fid,name:e.name,componentId:null==e||null===(t=e.attributes)||void 0===t||null===(a=t.componentName)||void 0===a?void 0:a.value};if(e.attributes){var n=this.getAttrs(e.attributes,e);n&&n.length>0&&(i.attributes=n)}return i},getAttrs:function(e,t){var a=this;if(!0!==t.readonly){if("array"===Object(y.g)(e)){var i=[];return e.forEach((function(e){i.push(a.getAttrsByKV(e))})),i}return this.getAttrsByKV(e)}},getAttrsByKV:function(e){var t=[];for(var a in e)if("componentName"!==a&&"componentType"!==a&&"pageName"!==a){var i,n,r=e[a],o={name:a};r.hasOwnProperty("value")&&(o.value=r.value),r.hasOwnProperty("visibleChanged")&&(o.visible=r.visible),r.hasOwnProperty("editorChanged")&&(o.editor=r.editor),r.hasOwnProperty("readonlyChanged")&&(o.readonly=r.readonly),r.hasOwnProperty("typeChanged")&&(o.type=r.type),r.hasOwnProperty("defaultLoad")&&(o.defaultLoad=r.defaultLoad),r.hasOwnProperty("defaultArgs")&&(o.defaultArgs=r.defaultArgs),r.hasOwnProperty("reserved")&&(o.reserved=r.reserved),r.hasOwnProperty("hidden")&&(o.hidden=r.hidden),r.hasOwnProperty("editValue")&&(o.editValue=this.compatibleEditValue(r.editValue)),r.linkable&&r.hasOwnProperty("linkConfig")&&(o.linkable=!0,o.linkConfig=this.compatibleEditValue(r.linkConfig),null!==(i=o.linkConfig)&&void 0!==i&&i.projectIdentifier&&(null===(n=o.linkConfig)||void 0===n?void 0:n.projectIdentifier)!==this.projectIdentifierByUrl?(delete o.linkConfig,delete o.lastValue,delete o.value,delete o.editor,r.editorDefined&&(o.editor=r.editorDefined)):o.linkConfig.projectIdentifier=this.projectIdentifierByUrl||"");var l=r.attributes;if(l){var s=this.getAttrs(l,r);s&&s.length>0&&(o.attributes=s)}var c=!0;for(var u in o)"name"!==u&&(c=!1);c||t.push(o)}return t},compatibleEditValue:function(e){var t=this;if("assets"===e.accessType||"templates"===e.accessType){var a;if("history"===e.queryType){var i="indicator"===e.historyType,n={},r=Object(y.e)(e);if(i){var o;if(n=Object(y.e)(e.indicatorEditor),delete r.indicatorEditor,"fixed"===n.requestPayload.timeRangeType&&(n.requestPayload.relativeTime=""),"templates"===e.accessType&&null!==(o=n.requestPayload)&&void 0!==o&&o.indicatorIds){var l,s=new RegExp("^@{.+}@$");n.requestPayload.indicatorIds=null===(l=n.requestPayload)||void 0===l?void 0:l.indicatorIds.split(",").map((function(e){return s.test(e)?e:"@{".concat(e,"}@")})).join(",")}}else{var c,u,d;n=Object(y.e)(e.rtEditor),delete r.rtEditor;var p=null===(c=e)||void 0===c||null===(u=c.requestPayload)||void 0===u?void 0:u.properties,h=Object(Gt.a)(p);if(null!=h&&h.length)!function(t){var a;if(null!==(a=n)&&void 0!==a&&a.requestPayload&&Array.isArray(t)){var i=new RegExp("^@{.+}@$"),r="templates"===e.accessType?t.map((function(e){return i.test(e)?e:"@{".concat(e,"}@")})):t;n.requestPayload.instanceId=r.join(",")}}(h.map((function(t){return"templates"===e.accessType?t.identifier:t.businessId})));var f="",m=(null===(d=n)||void 0===d?void 0:d.requestPayload)||{};Object.keys(m).forEach((function(e,t){f+="".concat(t?"&":"?").concat(e,"=").concat(m[e])})),n.url="".concat("/api/realtimedata/records").concat(f)}e=Yt(Yt({},n),{},{origin:r,fields:r.fields,containsKey:r.containsKey,pagination:r.pagination,dataType:r.dataType})}if(e.requestPayload.projectIdentifier="${projectIdentifier}","templates"===e.accessType||"templates"===(null===(a=e.origin)||void 0===a?void 0:a.accessType)){var v,b=new RegExp("^#{.+}#$"),g=new RegExp("^@{.+}@$");[e,null===(v=e)||void 0===v?void 0:v.origin].forEach((function(t){var a,i,n,r,o;if(t){var l=(null==t||null===(a=t.requestPayload)||void 0===a?void 0:a.identifier)||(null===(i=e)||void 0===i||null===(n=i.origin)||void 0===n||null===(r=n.requestPayload)||void 0===r?void 0:r.identifier);l&&!b.test(l)&&(t.requestPayload.identifier="#{".concat(l,"}#"));var s=null==t||null===(o=t.requestPayload)||void 0===o?void 0:o.properties;"object"===Object(Oe.a)(s)&&Object.keys(s).forEach((function(e){t.requestPayload.properties[e].forEach((function(e){"actualTime"!==(null==t?void 0:t.queryType)||b.test(e.identifier)||(e.identifier="#{".concat(e.identifier,"}#")),"history"!==(null==t?void 0:t.queryType)||g.test(e.identifier)||(e.identifier="@{".concat(e.identifier,"}@"))}))}))}}))}}return"variable"!==e.type&&"variable"!==e.accessType||(e.variable=this.compatible(e.variable)),"method"===e.type&&e.payloads&&e.payloads.length&&e.payloads.forEach((function(e){e.hasOwnProperty("editValue")&&(e.editValue=t.compatibleEditValue(e.editValue))})),e},compatibleValue:function(e,t){return"variable"===t.type?"${"+t.variable.join(".")+"}":e},compatible:function(e){var t=this,a=[];return e.forEach((function(e){t.excludes.find((function(t){return t===e}))||a.push(e)})),a},handlePublish:function(e){var t=this,a=this.currentPage;if(!a)return this.$message.warning("未找到页面"),this.isDisabledPreview=!1,void(this.isDisabledPublish=!1);var i=a.id;if(!i||this.getUnSaved())return this.$message.warning("当前编辑的页面未保存, 请先保存！"),this.isDisabledPreview=!1,void(this.isDisabledPublish=!1);e?this.isDisabledPreview=!0:this.isDisabledPublish=!0;var n="发布后运行时页面将更新，你确定要发布吗？";this.isSDC&&(n="发布后将更新至所有已引入该组件的页面，确保此次发布向下兼容或已知可能造成的影响。你确定要发布吗？"),this.$confirm(n,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var a,n=null!==(a=t.targetTypeByPageType[t.pageType])&&void 0!==a?a:1,r={url:"/api/page/pages/publish",method:"post",data:Yt({pageId:i,targetType:n},4===n?{publishContent:t.getPageData(t.currentPage)}:{})};t.$util.request(r).then((function(a){var n,r;if(e)return null!==(n=window)&&void 0!==n&&null!==(r=n.cacheManager)&&void 0!==r&&r.deleteAll&&window.cacheManager.deleteAll(),void setTimeout((function(){t.jump(i,!1)}),300);t.$message.success("发布成功")})).finally((function(){t.isDisabledPreview=!1,t.isDisabledPublish=!1}))})).catch((function(){t.isDisabledPreview=!1,t.isDisabledPublish=!1}))},getPageName:function(){var e=this.currentPage;return null==e?void 0:e.name},getPageParentId:function(){var e=this.currentPage,t=null==e?void 0:e.parentId;!t&&this.isSDC&&(t=Object(y.h)(this.$route.query).parentId);return t},handlePreview:function(){var e,t,a=this,i=this.currentPage;if(!i)return this.$message.warning("未找到页面"),this.isDisabledPreview=!1,void(this.isDisabledPublish=!1);var n=i.id;if(!n||this.getUnSaved())return this.$message.warning("当前编辑的页面未保存, 请先保存！"),this.isDisabledPreview=!1,void(this.isDisabledPublish=!1);null!==(e=window)&&void 0!==e&&null!==(t=e.cacheManager)&&void 0!==t&&t.deleteAll&&window.cacheManager.deleteAll(),setTimeout((function(){a.$store.dispatch("updateActiveComponentByFid",a.currentPage.fid),a.jump(n,!0)}),300)},debounceHandler:function(e){var t=this;this.timer||("function"==typeof e&&e(),this.timer=setTimeout((function(){t.timer=null}),800))},jump:function(e,t){var a,i,n,r=this,o="page-view",l=this.$store.getters.routerCachedModules,s=null===(a=this.constructor)||void 0===a||null===(i=a.options)||void 0===i||null===(n=i.components)||void 0===n?void 0:n.PageView,c="/modules/".concat(o,"/index.js?time=").concat((new Date).getTime()),u="/modules/".concat(o,"/main.css?time=").concat((new Date).getTime());l.includes(o)&&s?(this.openDialog(e,t),this.isDisabledPreview=!1):window.$common.$loadModuleJs(c).then((function(a){var i,n,l,s;window.$common.$util.loadStyle(u);var c=a.init;if(a&&a.store&&(null===(i=r.$store)||void 0===i||null===(n=i._modules)||void 0===n||null===(l=n.root)||void 0===l||null===(s=l._children)||void 0===s||!s.pageViewStore)){var d=a.store;r.$store.registerModule(d.name,d)}"function"==typeof c&&c(),r.$store.commit("SET_ROUTE_CACHED_MODULES",o),r.openDialog(e,t),r.isDisabledPreview=!1})).catch((function(){r.$message.error("操作失败，请重试"),r.isDisabledPreview=!1}))},openDialog:function(e,t){var a={title:this.getPageName(),url:e,showFullScreen:!0,width:"80%",bodyHeight:.8*window.innerHeight+"px",fromPageId:0,params:{enableCache:!1,onlyPreview:!!t}};window.$common.$openDialog(a)},pageBorderChange:function(e){Ft.a.$emit("pageBorderChange",e),this.$util.setStore({name:"hasBorder",content:e})},getCurPageCodeInfo:function(){var e,t=[],a=[],i=[],n=/\$\{(.*?)\}/g,r=window.$VUE_ROOT.$store.state.pageEditor.pagesActiveName,o=(null===(e=window.$VUE_ROOT.$store.state.pageEditor.pagesKV[r])||void 0===e?void 0:e.componentKV)||{},l=function(e){var a,i=o[e],n=i.name,r=i.attributes,l=i.alias,s=i.componentType,u=(i.children,null==r||null===(a=r.componentName)||void 0===a?void 0:a.value);if("Grid"===s)return 1;"Page"===n?(r.customVariable.attributes||[]).forEach((function(a){var i=a.value,n=i.value,r=i.linkConfig,o=void 0===r?{}:r;if("string"==typeof n&&n.startsWith("script:")&&"script"===o.accessType){var s=o.content;t.push({compId:e,compName:u,compAlias:l,propertyName:a.name.value,propertyAlias:"页面自定义变量",content:s})}})):c(r,e,u,l)};for(var s in o)l(s);return{scripts:t,events:a,useVariables:i,tips:"scripts: 当前页面脚本概览，events：当前页面事件概览, useVariables: 组件引用的变量"};function c(e,r,o,l){var s=function(){var s=e[c],u=s.groupName,d=s.value,p=(s.editor,s.linkConfig),h=void 0===p?{}:p,f=s.alias,m=s.name,v={compId:r,compName:o,compAlias:l,propertyName:m,propertyAlias:f};if("events"===u){var b,g;((null===(b=s.attributes)||void 0===b||null===(g=b.content)||void 0===g?void 0:g.attributes)||[]).forEach((function(e){var i=e.pageComponentMethod,n=void 0===i?{}:i,r=e.executionContent,o=void 0===r?{}:r;if("script"===(null==n?void 0:n.value)){var l,s=null===(l=o.editValue)||void 0===l?void 0:l.content;t.push(Object.assign({},v,{content:s}))}o.value&&a.push(Object.assign({},v,{content:o.value}))}))}else{if("script"===h.accessType){var y=h.content;t.push(Object.assign({},v,{content:y}))}"string"==typeof d&&n.test(d)&&(i.push(Object.assign({},v,{content:d})),n.lastIndex=0)}};for(var c in e)s()}}}},Qt=(a("d787"),a("21eb"),Object(l.a)(Zt,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"page-editor-header"},[t("el-row",{attrs:{gutter:20}},[t("el-col",{style:{height:e.height+"px",display:"flex","align-items":"center"},attrs:{span:8}},[e.isH5Page?e._e():t("el-button",{attrs:{size:"mini",icon:"el-icon-document-add",type:"success"},on:{click:function(t){return e.handleClick("create")}}},[e._v(e._s(e.isSDC?"新建二开组件":"新建页面"))]),e.isH5Page?e._e():t("el-button",{attrs:{size:"mini",icon:"el-icon-thumb"},on:{click:function(t){return e.handleClick("open")}}},[e._v(e._s(e.isSDC?"打开二开组件":"打开页面"))]),e.isH5Page?e._e():t("el-divider",{staticClass:"mg2H2",attrs:{direction:"vertical"}})],1),t("el-col",{style:{"line-height":e.height-2+"px","text-align":"right"},attrs:{span:16}},[t("el-switch",{ref:"switch",staticClass:"isInside",attrs:{width:"120","active-text":"显示布局边界","inactive-text":"隐藏布局边界"},on:{change:e.pageBorderChange},model:{value:e.pageBorder,callback:function(t){e.pageBorder=t},expression:"pageBorder"}}),t("el-switch",{staticClass:"isInside",attrs:{width:"120","active-text":"开启自动保存","inactive-text":"关闭自动保存"},on:{change:e.handleAutoSaveChange},model:{value:e.autoSave,callback:function(t){e.autoSave=t},expression:"autoSave"}}),t("el-button",{staticClass:"mgL5",attrs:{size:"mini",icon:"icon-btn-save",loading:e.savingPage,disabled:e.savingPage},on:{click:function(t){return e.handleClick("save")}}},[e._v("保存")]),e.isH5Page?e._e():t("el-button",{staticClass:"mgL5",attrs:{size:"mini",icon:"icon-btn-save-as",disabled:e.savingPage},on:{click:function(t){return e.handleClick("saveAs")}}},[e._v("另存为")]),e.isTemplate?e._e():t("el-button",{staticClass:"mgL5",attrs:{size:"mini",icon:"icon-btn-preview",disabled:e.savingPage},on:{click:function(t){return e.handleClick("preview")}}},[e._v("预览")]),e.isTemplate?e._e():t("el-dropdown",{staticClass:"publish-dropdown",staticStyle:{"margin-left":"10px",position:"relative"},attrs:{disabled:e.savingPage,size:"mini","split-button":""},on:{click:function(t){return e.handleClick("publish")},command:e.handleCommand}},[t("i",{staticClass:"icon-btn-publish"}),t("span",[e._v("发布")]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{attrs:{command:"previewAndPublish"}},[e._v("发布并预览")])],1)],1)],1)],1),t("page-open",{ref:"headerPageOpen",attrs:{settings:e.pageOpenSettings},on:{onSure:e.handleOpenOnSure}}),t("page-save",{ref:"headerPageSave",attrs:{settings:e.pageSaveSettings},on:{onSure:e.handleSaveOnSure}})],1)}),[],!1,null,"fb00e50c",null)).exports;function Xt(e,t,a){var i=t.getBoundingClientRect(),n=e.getBoundingClientRect(),r=n.bottom-i.bottom,o=a?21:0;return{top:"".concat(i.top-n.top-o,"px"),bottom:"".concat(r-o,"px"),left:"".concat(i.left-n.left-o,"px"),width:"".concat(i.width+2*o,"px"),height:"".concat(i.height+2*o,"px")}}function ea(e){Ft.a.$emit("pageBorderChange",e),window.$VUE_ROOT.$util.setStore({name:"hasBorder",content:e})}function ta(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=e.getAttribute&&"Page"===e.getAttribute("comp-name");if(a)return e;if(Array.from(e.classList||[]).includes("component-block")){var i=e.lastElementChild.firstElementChild,n=null==i?void 0:i.getAttribute("comp-name");if(null!=i&&i.getAttribute&&n&&!new RegExp(S.h).test(n)&&!t.includes(i))return e}}function aa(e){var t=e.querySelector("[comp-name]")||e;return function e(a){var i=ta(a,[t]);if("BODY"!==a.tagName)return i||(a.parentNode?e(a.parentNode):void 0)}(t)}function ia(e,t,a){return{name:e,position:t,type:"pointer",el:a}}function na(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function ra(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?na(Object(a),!0).forEach((function(t){Object(f.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):na(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}a("2f0d"),a("f5cd");var oa={name:"ComponentList",props:{width:{type:Number,default:0},type:{type:String,default:"widget",validator:function(e){return["widget","sdc"].includes(e)}}},data:function(){return{filterText:"",dialogDetailTipsVisible:!1,activeName:"",activeTitle:"",time:null,compCdnIcon:{"grid-1":"/cdn/assets/editor/grid_8.svg","grid-2":"/cdn/assets/editor/grid_3.svg","grid-3":"/cdn/assets/editor/grid_4.svg","grid-4":"/cdn/assets/editor/grid_2.svg","grid-5":"/cdn/assets/editor/grid_5.svg"}}},computed:{isSDC:function(){return"sdc"===this.type},placeholder:function(){return"搜索".concat(this.isSDC?"二开组件":"原子组件")},pageEditor:function(){return this.$store.getters.pageEditor},compSpan:function(){return this.width?Math.floor(24/(this.width/95)):12},tipsInfo:function(){var e=this.$store.getters.pageEditor.tips,t=this.activeName;return{fragment:t&&e[t]&&e[t].fragment,detail:t&&e[t]&&e[t].detail}},themeStyles:function(){return{target:".el-collapse-item__header, ",style:{"background-color":Object(S.nb)("middleBackgroundColor"),"border-bottom-color":Object(S.nb)("borderColor")}}},pageEditorComponents:function(){var e=this.isSDC?this.pageEditor.SDCComponents:this.pageEditor.components,t=this.filterText.trim(),a=[];return t&&(t=t.toLowerCase()),e.forEach((function(e){var i,n=!1,r=ra(ra({},e),{},{children:[]});(null===(i=e.children)||void 0===i?void 0:i.length)&&e.children.forEach((function(e){var a,i;(!t||(null==e||null===(a=e.alias)||void 0===a||null===(i=a.toLowerCase())||void 0===i?void 0:i.indexOf(t))>-1)&&!1!==e.visible&&(n=!0,r.children.push(e))})),n&&a.push(r)})),a},originCompMap:function(){return(this.pageEditor||[]).originComponents.reduce((function(e,t){return e[t.name]=t,e}),{})}},methods:{handleComponentHelp:function(e){},getCompIcon:function(e){var t="Button",a=this.compCdnIcon[e.key]||this.originCompMap[e.name]&&this.originCompMap[e.name].iconPath||e.icon;return a||(a=this.originCompMap[t]&&this.originCompMap[t].iconPath),a},getPointByInnerEle:function(e,t){var a=aa(e);if(a){var i=a.getAttribute&&"Page"===a.getAttribute("comp-name"),n=a;if(!i||(n=a.firstElementChild)){var r=Xt(t,n,i);return ia(i?a.getAttribute("comp-name"):a.lastElementChild.firstElementChild.getAttribute("comp-name"),r,a)}}},dragStart:function(e){var t=this,a=document.querySelector("[comp-name=Page]");Ft.a.$emit("bemDisabledSelect",!0),ea(!0);var i=function(){var i=t.getPointByInnerEle(e.item,a);i&&Ft.a.$emit("bemPointer",i)};i(),clearInterval(this.SIV_intervalPointer),this.SIV_intervalPointer=a&&setInterval((function(){i()}),100)},dragEnd:function(e){Ft.a.$emit("bemDisabledSelect",!1),ea(!1),clearInterval(this.SIV_intervalPointer)},handleCompEvent:function(e,t){switch(e){case"start":this.dragStart(t);break;case"end":this.dragEnd(t)}},handlePull:function(e,t,a,i){var n,r=null==a?void 0:a.dataset.groupName;return!("page"===(null==e||null===(n=e.el)||void 0===n?void 0:n.dataset.componentType)&&!["layout","quickLayout"].includes(r)&&!r.startsWith("SDC_"))&&"clone"},handleChoose:function(e){var t;this.$store.dispatch("updateActiveComponentByFid"),["quickLayout"].includes(null==e||null===(t=e.item.__vue__)||void 0===t?void 0:t.$attrs["data-group-name"])},getTipsInfo:function(e){var t=this;this.activeTitle=e.alias,this.activeName=e.name,null!==this.time&&clearTimeout(this.time),this.time=setTimeout((function(){t.$store.dispatch("setTips",t.activeName)}),500)},openTipsDialog:function(e){this.dialogDetailTipsVisible=!0},close:function(){this.dialogDetailTipsVisible=!1}}},la=(a("08db"),a("6f46"),Object(l.a)(oa,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"component-list-container"},[t("div",{staticClass:"top"},[t("el-input",{attrs:{placeholder:e.placeholder,"auto-complete":"off",autocomplete:"off",name:"meaningless","suffix-icon":"el-icon-search"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}})],1),t("el-collapse",{directives:[{name:"theme",rawName:"v-theme",value:e.themeStyles,expression:"themeStyles"}],staticClass:"page-editor-component-list",model:{value:e.pageEditor.componentsActiveNames,callback:function(t){e.$set(e.pageEditor,"componentsActiveNames",t)},expression:"pageEditor.componentsActiveNames"}},e._l(e.pageEditorComponents,(function(a,i){return t("el-collapse-item",{key:i,attrs:{title:a.groupAlias,name:a.groupName}},[t("el-row",{attrs:{gutter:10}},[t("draggable",{attrs:{list:a.children,group:{name:"components",pull:e.handlePull,put:!1},sort:!1},on:{start:function(t){return t.stopPropagation(),e.handleCompEvent("start",t)},end:function(t){return t.stopPropagation(),e.handleCompEvent("end",t)},choose:e.handleChoose}},e._l(a.children,(function(i){return t("el-col",{key:i.key?i.key:i.name,attrs:{span:e.compSpan,"data-name":i.key?i.key:i.name,"data-group-name":a.groupName}},[t("el-popover",{attrs:{placement:"right",width:"200",trigger:"hover","open-delay":"1000"},on:{show:function(t){return e.getTipsInfo(i)}}},[t("div",{staticClass:"popover-content"},[t("div",{staticClass:"title"},[t("span",[t("i",{staticClass:"el-icon-document-copy"}),e._v(e._s(i.alias))])]),t("el-divider"),t("div",{domProps:{innerHTML:e._s(e.tipsInfo.fragment||"暂无内容")}}),t("div",{directives:[{name:"show",rawName:"v-show",value:e.tipsInfo.fragment,expression:"tipsInfo.fragment"}],staticClass:"detail",on:{click:function(t){return e.openTipsDialog(i)}}},[e._v("详情")])],1),t("div",{class:["page-editor-component-item"],attrs:{slot:"reference"},slot:"reference"},[t("div",{staticClass:"page-editor-component-item-content"},[t("div",{staticClass:"page-editor-component-item-content-icon"},[e.getCompIcon(i)?t("img",{attrs:{src:e.getCompIcon(i)}}):t("svg",{staticClass:"icon",attrs:{t:"1653564892689",viewBox:"0 0 1463 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"17702",width:"200",height:"200"}},[t("path",{attrs:{d:"M1165.036084 0H287.141913a73.474548 73.474548 0 0 0-73.052281 73.052281v877.894171a73.052281 73.052281 0 0 0 73.052281 73.052281h877.894171a72.630013 72.630013 0 0 0 73.052281-73.052281V73.052281A73.052281 73.052281 0 0 0 1165.036084 0zM287.141913 942.078835s59.961988-364.416869 179.463695-364.416869 105.144612 101.766472 195.087594 101.766472 126.680256-313.744767 247.448766-313.744767 255.894116 576.395163 255.894116 576.395164z",fill:"#A6C5F6","p-id":"17703"}}),t("path",{attrs:{d:"M146.104562 219.57911H72.630013A73.052281 73.052281 0 0 0 0 292.209123v439.580487a73.052281 73.052281 0 0 0 72.630013 72.630013h73.474549zM1316.630124 219.57911h73.896816a73.052281 73.052281 0 0 1 72.630013 72.630013v439.580487a73.052281 73.052281 0 0 1-72.630013 72.630013h-73.896816zM475.473226 219.57911a109.789555 109.789555 0 1 1-109.789555 109.789555 109.367287 109.367287 0 0 1 109.789555-109.789555z",fill:"#4E8CEE","p-id":"17704"}}),t("path",{attrs:{d:"M475.473226 459.849328a130.902931 130.902931 0 1 1 130.902931-130.480663 130.902931 130.902931 0 0 1-130.902931 130.480663z m0-219.156842a88.676179 88.676179 0 1 0 88.676179 88.676179 88.676179 88.676179 0 0 0-88.676179-88.676179z",fill:"#FFFFFF","p-id":"17705"}})])]),t("div",{staticClass:"page-editor-component-item-content-help",on:{click:function(t){return t.stopPropagation(),e.handleComponentHelp(i)}}},[e._e()],1)]),t("div",{staticClass:"page-editor-component-item-title"},[e._v("\n                  "+e._s(i.alias)+"\n                ")])])])],1)})),1)],1)],1)})),1),t("el-dialog",{attrs:{title:e.activeTitle,visible:e.dialogDetailTipsVisible,width:"800px","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogDetailTipsVisible=t},close:e.close}},[t("div",{staticStyle:{height:"500px"},domProps:{innerHTML:e._s(e.tipsInfo.detail)}})])],1)}),[],!1,null,"3c9f62eb",null)).exports,sa=a("6dd8");function ca(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function ua(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ca(Object(a),!0).forEach((function(t){Object(f.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ca(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var da={name:"PageStructureTree",data:function(){return{defaultProps:{children:"children",label:"name",isPage:"isPage",key:"fid",disabled:"disabled"},seletedKeys:[],isSelecting:!1,filterText:"",treescrollWidth:"auto",resizeObserver:null}},props:{asideWidth:{type:Number,default:0}},watch:{filterText:function(e){this.$refs.tree.filter(e)},activeComponentFid:function(e){}},computed:ua(ua({},Object(He.a)(["themeConstColor"])),{},{pageEditor:function(){return this.$store.getters.pageEditor.pages},renderTree:function(){var e=this,t=[];return this.pageEditor.forEach((function(a){var i=a.page.fid,n={isPage:1,disabled:!0,fid:i,id:i,name:"页面",children:[],key:i,pagefid:a.fid};a.component.forEach((function(t){n.children.push(e.walkComponent(t))})),t.push(n)})),t},getSelectFids:function(){return this.$refs.tree.getCheckedKeys()},activeComponentFid:function(){return this.$store.getters.currentPage.activeComponentFid},currentPage:function(){var e=this.$store.getters.pageEditor;return e.pagesKV[e.pagesActiveName]}}),mounted:function(){var e=this;this.$nextTick((function(){e.resizeObserver=new sa.default((function(t,a){var i;e.$refs.tree.$el.style.maxWidth="".concat(null===(i=e.$refs.treeParent)||void 0===i?void 0:i.scrollWidth,"px")||!1})),e.resizeObserver.observe(e.$refs.treeParent)}))},methods:{filterNode:function(e,t){return!e||-1!==t.name.indexOf(e)},allowDrop:function(e,t,a){if("inner"===a){var i,n,r;if(-1===["Flow","block","CollapseItem","tabsItem","carouseItem","ContainerArray","ContainerObject","ContainerPoint"].indexOf(t.data.componentName))return!1;var o=null===(i=e.data)||void 0===i?void 0:i.componentName,l=null===(n=e.data)||void 0===n?void 0:n.groupName,s=null==t||null===(r=t.data)||void 0===r?void 0:r.fid,c=!0;if(s){var u=this.currentPage.componentInstance[s],d=null==u?void 0:u.checkPut;c="function"!=typeof d||d(l,o)}if(!c)return!1}else{var p,h,f,m,v,b,g,y,_;if(-1!==["Grid","Collapse","Tabs","CarouselLayout"].indexOf(null===(p=t.parent)||void 0===p||null===(h=p.data)||void 0===h?void 0:h.componentName))return!1;if(!t.parent||null===(f=t.parent)||void 0===f||!f.parent)return!1;if(!(null!==(m=t.parent)&&void 0!==m&&null!==(v=m.parent)&&void 0!==v&&v.parent||["Flow","Grid","Collapse","Tabs","CarouselLayout"].includes(e.data.componentName)))return!1;var C=null===(b=e.data)||void 0===b?void 0:b.componentName,O=null===(g=e.data)||void 0===g?void 0:g.groupName,T=null==t||null===(y=t.parent)||void 0===y||null===(_=y.data)||void 0===_?void 0:_.fid,V=!0;if(T){var w=this.currentPage.componentInstance[T],P=null==w?void 0:w.checkPut;V="function"!=typeof P||P(O,C)}if(!V)return!1}return!0},allowDrag:function(e){var t,a,i;if(!e.parent||null===(t=e.parent)||void 0===t||!t.parent)return!1;return-1===["Grid","Collapse","Tabs","CarouselLayout"].indexOf(null===(a=e.parent)||void 0===a||null===(i=a.data)||void 0===i?void 0:i.componentName)},handleDragEnd:function(e,t,a,i){var n,r,o=Object(S.I)(e.data.fid,this.currentPage.component),l=["CollapseItem","tabsItem","carouseItem"],s=null;if("none"===a);else if("inner"===a)l.includes(t.data.componentName)?(n=ua(ua({},o),{},{tabIndex:t.data.index,parentFid:t.data.fid}),r=t.parent.data.fid):(delete(n=ua(ua({},o),{},{parentFid:t.data.fid})).tabIndex,r=t.data.fid);else{var c,u,d,p=Object(S.I)(t.data.fid,this.currentPage.component),h=Object(S.I)(p.parentFid,this.currentPage.component);s=h?h.children.findIndex((function(e){return e.fid===p.fid})):this.currentPage.component.findIndex((function(e){return e.fid===p.fid})),"after"===a&&s++,l.includes(null===(c=t.parent)||void 0===c?void 0:c.data.componentName)?(n=ua(ua({},o),{},{tabIndex:null===(u=t.parent)||void 0===u?void 0:u.data.index,parentFid:(null==h?void 0:h.fid)||void 0}),r=(null==h?void 0:h.fid)||void 0):(delete(n=ua(ua({},o),{},{tabIndex:null===(d=t.parent)||void 0===d?void 0:d.data.index,parentFid:(null==h?void 0:h.fid)||void 0})).tabIndex,r=(null==h?void 0:h.fid)||void 0)}this.$store.dispatch("innerMoveComponent",{newItem:n,parentFid:r,index:s})},getTabComponentChild:function(e){var t=this.getTabs(e.attributes.tabNameConfig);return e.children.forEach((function(e){var a,i=e.tabIndex;null===(a=t.find((function(e){return e.index===i})))||void 0===a||a.children.push(e)})),t},getCollapseComponentChild:function(e){var t=this.getCollapses(e.attributes.collapseName);return e.children.forEach((function(e){var a,i=e.tabIndex;null===(a=t.find((function(e){return e.index===i})))||void 0===a||a.children.push(e)})),t},getCarouseComponentChild:function(e){var t=this.getCarouse(e.attributes.carouseItemLength);return e.children.forEach((function(e){var a=e.tabIndex;t[a].children.push(e)})),t},getTabs:function(e){var t=[];return e.attributes.forEach((function(e,a){var i=e.tabName,n=e.tabId,r={name:"tabsItem",fid:i.fid,type:"tab",groupName:"标签页",key:i.fid,id:i.fid,showName:i.value,disabled:!0,index:n.value,children:[]};t.push(r)})),t},getCollapses:function(e){var t=[];return e.attributes.forEach((function(e,a){var i=e.label,n=e.index,r={name:"CollapseItem",fid:i.fid,type:"collapse",groupName:"折叠",key:i.fid,id:i.fid,showName:i.value||i.default,index:n.value,disabled:!0,children:[]};t.push(r)})),t},getCarouse:function(e){for(var t=e.value||e.default,a=[],i=0;i<t;i++){var n={name:"carouseItem",fid:"",type:"carouse",groupName:"轮播",key:"",id:"",showName:i+1,index:i,disabled:!0,children:[]};a.push(n)}return a},getColName:function(e){var t,a,i,n,r,o=e.parentFid,l=null===(t=this.currentPage)||void 0===t?void 0:t.componentKV[o],s=null==l||null===(a=l.attributes)||void 0===a||null===(i=a.cols)||void 0===i?void 0:i.attributes;if(!s)return"Col";var c=s.find((function(t){return t.colId.value===e.colId}));return"Col-"+((null==c||null===(n=c.span)||void 0===n?void 0:n.value)||(null==c||null===(r=c.span)||void 0===r?void 0:r.default))},walkComponent:function(e){var t,a,i,n,r={fid:e.fid,name:e.colId?this.getColName(e):(null===(t=e.attributes)||void 0===t||null===(a=t.componentName)||void 0===a?void 0:a.value)||e.showName,type:(null===(i=e.attributes)||void 0===i||null===(n=i.componentType)||void 0===n?void 0:n.value)||e.componentType,groupName:e.groupName,key:e.fid,id:e.fid,disabled:!!e.colId||e.disabled,componentName:e.name,index:e.index};if("ContainerSDC"===e.name){if(!e.isCurrentTopSDC)return r;r.disabled=!0,r.isCurrentTopSDC=!0}if(e.children&&e.children.length){var o=[];return"Tabs"===e.name?(o=this.getTabComponentChild(e),ua(ua({},r),{},{children:o.map(this.walkComponent)})):"Collapse"===e.name?(o=this.getCollapseComponentChild(e),ua(ua({},r),{},{children:o.map(this.walkComponent)})):"CarouselLayout"===e.name?(o=this.getCarouseComponentChild(e),ua(ua({},r),{},{children:o.map(this.walkComponent)})):(e.children.forEach((function(e){o.push(e)})),ua(ua({},r),{},{children:o.map(this.walkComponent)}))}return r},handleNodeClick:function(e){if(e.disabled&&!e.isPage&&!e.isCurrentTopSDC)return this.$refs.tree.setCurrentKey(this.activeComponentFid),void this.$refs.tree.filter(this.filterText);e.isPage?this.$store.dispatch("updateActiveComponentByFid",e.pagefid):this.$store.dispatch("updateActiveComponent",e.fid)},renderContent:function(e,t){var a=t.node,i=t.data,n=1;(t.store,["block","carouseItem","tabsItem","CollapseItem"]).includes(a.data.componentName)&&(n=.5);var r={color:a.isCurrent?this.themeConstColor.primary:"",opacity:n},o={width:"100%",lineHeight:"30px",cursor:!a.disabled||i.isPage||i.isCurrentTopSDC?"unset":"not-allowed"};return e("div",{attrs:{title:a.label},style:o},[e("span",[e("span",{style:r},[a.label])])])},remove:function(e){var t=this;this.$confirm("确定要删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.$store.dispatch("removeComponent",e)})).catch((function(){}))},goBatchDelete:function(){this.$refs.tree.setCheckedKeys([]),this.isSelecting=!0},batchDelete:function(){var e=this;this.$refs.tree.getCheckedKeys().length?this.$confirm("确定要删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.$store.dispatch("removeComponent",e.$refs.tree.getCheckedKeys())})).catch((function(){})):this.$message("请选择要删除的组件")},cancelBatchDelete:function(){this.$refs.tree.setCheckedKeys([]),this.isSelecting=!1},handleCheckChange:function(e,t,a){if(t.checkedKeys.find((function(t){return t===e.fid}))){var i=e.children;i&&i.length&&this.setCheckedChildren(i)}},setCheckedChildren:function(e){var t=this;("array"!==Object(y.g)(e)?[e]:e).forEach((function(e){var a=e.children;t.$refs.tree.setChecked(e,!0),a&&a.length&&t.setCheckedChildren(a)}))}}},pa=(a("9df4"),Object(l.a)(da,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"page-structure-tree-container"},[t("div",{staticClass:"filters"},[t("el-input",{attrs:{placeholder:"输入关键字进行过滤"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}})],1),e.renderTree.length&&e.asideWidth?t("div",{staticClass:"page-structure-tree-header"},[t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"批量删除",placement:"top"}},[e.isSelecting?e._e():t("el-button",{staticClass:"deleteBtn",attrs:{type:"danger",icon:"icon-btn-batch-delete"},on:{click:e.goBatchDelete}})],1),e.isSelecting?t("el-button",{attrs:{type:"danger"},on:{click:e.batchDelete}},[e._v("删除")]):e._e(),e.isSelecting?t("el-button",{on:{click:e.cancelBatchDelete}},[e._v("取消")]):e._e()],1):e._e(),t("div",{ref:"treeParent",staticStyle:{maxHeight:"calc(100% - 120px)",overflow:"auto"},attrs:{titlaae:e.scrollWidth}},[t("el-tree",{ref:"tree",style:{width:e.scrollWidth},attrs:{data:e.renderTree,props:e.defaultProps,indent:12,"expand-on-click-node":!1,"show-checkbox":e.isSelecting,"check-strictly":!0,"default-checked-keys":e.seletedKeys,"node-key":"fid","render-content":e.renderContent,"default-expand-all":"","current-node-key":e.activeComponentFid,draggable:!0,"allow-drop":e.allowDrop,"allow-drag":e.allowDrag,"highlight-current":"","filter-node-method":e.filterNode},on:{"node-click":e.handleNodeClick,check:e.handleCheckChange,"node-drag-end":e.handleDragEnd}})],1)])}),[],!1,null,null,null)).exports,ha=a("a542");function fa(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function ma(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?fa(Object(a),!0).forEach((function(t){Object(f.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):fa(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var va={name:"Viewarea",components:{ConfirmDialog:a("a337").a},inject:["isProjectPage","isKeepAlive","isSDC"],props:{data:{type:Object,default:function(){}},runtime:{type:Boolean,default:!1},pageId:{type:String,default:""},fromPageId:{type:[String,Number],default:""},isAutoHeight:{type:Boolean,default:!1}},data:function(){return{complexData:null,scriptComplexData:null,validateComplexData:null,innerHeight:window.innerHeight,pageTimer:{},pageTimerWatcher:{},hasBorder:!1,confirmDialogContent:{visible:!1,content:"切换组件，方法，参数将会被清空！是否要继续？",key:"dialogVisible"},confirmDefautData:{}}},created:function(){this.isKeepAlive||this.dealConfig(),this.register()},activated:function(){this.isKeepAlive&&(this.dealConfig(),this.resizeFunc=this.$util.debounce(this.handleResize,300),this.addEvents(),this.initBemBorder())},mounted:function(){this.isKeepAlive||(this.resizeFunc=this.$util.debounce(this.handleResize,300),this.addEvents(),this.initBemBorder())},deactivated:function(){this.isKeepAlive&&this.unmount()},beforeDestroy:function(){this.unmount()},computed:ma(ma({},Object(He.a)(["portalInfo"])),{},{dataLoaded:function(){var e,t,a,i;return this.runtime?null===(e=this.$store.getters)||void 0===e||null===(t=e.pageViewStore)||void 0===t?void 0:t.pagesKVLoaded[this.data.fid]:null===(a=this.$store.getters)||void 0===a||null===(i=a.pageEditor)||void 0===i?void 0:i.pagesKVLoaded[this.data.fid]},gutter:function(){var e=this.data.page.attributes;return e&&e.gutter&&!1!==e.gutter.visible?Object(S.pb)(e.gutter.value,e.gutter.default):0},type:function(){var e=this.data.page.attributes;return e&&e.type&&!1!==e.type.visible?Object(S.pb)(e.type.value,e.type.default):""},justify:function(){var e=this.data.page.attributes;return e&&e.justify&&!1!==e.justify.visible?Object(S.pb)(e.justify.value,e.justify.default):""},align:function(){var e=this.data.page.attributes;return e&&e.align&&!1!==e.align.visible?Object(S.pb)(e.align.value,e.align.default):""},autoHeight:function(){var e=this.data.page.attributes,t=e&&e.margin,a=t&&Object(S.pb)(t.value,t.default||Object(S.nb)(t.name)),i=a&&a[0]||0,n=a&&a[2]||0,r=this.runtime?this.$store.getters.mainContentOffsetTop||0:91,o=this.innerHeight-r-i-n;return this.runtime?this.$store.commit("SET_PAGE_CONTENT_HEIGHT_VIEW",o):this.$store.commit("SET_PAGE_CONTENT_HEIGHT",o),o},innerStyles:function(){var e=this.data.page.attributes,t={},a={appearance:!0,layout:!0,quickLayout:!0};for(var i in e){var n=e[i];if(a[n.groupName]){var r=new ha.a(n.type),o=r.getBaseType();t[n.name]=this.getAttrValue(n,o),r.destroy()}}return t},styles:function(){var e=this.data.page.attributes,t={height:"100%"},a={appearance:!0,layout:!0,quickLayout:!0};for(var i in e){var n=e[i];if(a[n.groupName]){if("overflow"===n.name||"height"===n.name)continue;var r=new ha.a(n.type),o=r.getBaseType();t[n.name]=this.getAttrValue(n,o),r.destroy()}}return t["background-color"]=Object(S.nb)("mainContentBgColor"),t}}),methods:{handleConfirmSubmit:function(e){switch(e){case"dialogVisible":this.handleComplexClick();break;case"scriptDialogVisible":this.handleScriptComplexClick();break;case"validateDialogVisible":this.handleValidateComplexClick();break;default:this.handleIsSubmit(!0)}this.confirmDialogContent.visible=!1},handleConfirmClose:function(e){switch(e){case"dialogVisible":this.handleComplexClose();break;case"scriptDialogVisible":this.handleScriptComplexClose();break;case"validateDialogVisible":this.handleValidateComplexClose();break;default:this.handleIsSubmit(!1)}this.confirmDialogContent.visible=!1},handleIsSubmit:function(e){var t=this.confirmDefautData,a=t.targetCon,i=t.groupExecutionType,n=t.executionComponentName,r=t.newVal,o=t.oldVal,l=t.attr;e?(this.$setAttr(a,"editor","method"),this.$setAttr(i,"value","method"),this.$setAttr(a,"value","method: ".concat(r)),this.$setAttr(a,"lastValue","method: ".concat(r)),this.$setAttr(a,"editValue",{fn:[n.value,r],payloads:[],type:"method"})):(this.$setAttr(l,"value",o),this.$setAttr(l,"lastValue",o))},unmount:function(){for(var e in window.removeEventListener("resize",this.resizeFunc),Ft.a.$off("pageBorderChange",this.onPageBorderChange),this.clearTimerWatcher(),this.pageTimer)clearInterval(this.pageTimer[e]),clearTimeout(this.pageTimer[e]),this.pageTimer[e]=null;this.runtime||window.removeEventListener("keydown",this.handleKeydown)},dealConfig:function(){var e,t,a;this.isProjectPage&&null!==(e=this.data)&&void 0!==e&&null!==(t=e.page)&&void 0!==t&&null!==(a=t.attributes)&&void 0!==a&&a.$assets&&(this.data.page.attributes.$assets.visible=!0)},scriptClose:function(){},handleScriptComplexClick:function(){var e=this.scriptComplexData;if(e){var t=e.oldVal,a=e.targetCon,i=e.attr,n=e.newVal,r=e.customGroupName,o=e.groupExecutionType,l=e.executionComponentName;"script"===n||"api"===n?(this.handleExecutionType(n,t,i,r),this.$setAttr(o,"value",n)):(this.$setAttr(a,"editor","method"),this.$setAttr(o,"value","method"),this.$setAttr(a,"value","method: ".concat(n)),this.$setAttr(a,"lastValue","method: ".concat(n)),this.$setAttr(a,"editValue",{fn:[l.value,n],payloads:[],type:"method"}))}},handleScriptComplexClose:function(){var e=this.scriptComplexData;if(e){var t=e.attr,a=e.oldVal;this.$setAttr(t,"value",a),this.$setAttr(t,"lastValue",a)}},handleComplexClose:function(){var e=this.complexData;if(e){var t=e.attr,a=e.oldVal;this.$setAttr(t,"value",a),this.$setAttr(t,"lastValue",a)}},handleComplexClick:function(){var e=this.complexData;if(e){var t=e.element,a=e.targetCon,i=e.attr,n=e.newVal,r=e.targetTitle,o=e.componentName;this.$removeAttr(t,"value"),this.$removeAttr(t,"editValue"),this.$removeAttr(a,"value"),this.$setAttr(a,"editor","method"),this.$removeAttr(a,"editValue"),this.$setAttr(i,"value",n),this.$setAttr(i,"lastValue",n),this.$setAttr(r,"value",o)}},handleValidateComplexClose:function(){var e=this.validateComplexData;if(e){var t=e.attr,a=e.oldVal;this.$setAttr(t,"value",a),this.$setAttr(t,"lastValue",a)}},handleValidateComplexClick:function(){var e=this.validateComplexData;if(e){var t=e.newVal,a=e.item,i=e.customGroupName;"default"===t?(this.$setAttr(a,"type",a.validateDefaultType),this.$removeAttr(a,"editor")):"regex"===t?(this.$setAttr(a,"type","String"),this.$removeAttr(a,"editor")):"script"===t&&(this.$setAttr(a,"type","String"),this.$setAttr(a,"editor","script")),this.setValidateAttrVisible(i.validateMaxlength,a.fid,!1),this.setValidateAttrVisible(i.validateMinlength,a.fid,!1),this.setValidateAttrVisible(i.validateMax,a.fid,!1),this.setValidateAttrVisible(i.validateMin,a.fid,!1),this.setValidateAttrByFid(i.validateScriptRelated,a.fid,t),this.$removeAttr(a,"value"),this.$removeAttr(a,"editValue")}},initBemBorder:function(){Ft.a.$on("pageBorderChange",this.onPageBorderChange),this.hasBorder=!this.runtime&&!!this.$util.getStore({name:"hasBorder"})},register:function(){var e=this.data.page.fid;if(e)if(this.runtime){var t=this.pageId;if(!t)return;this.$store.commit("SET_COMPONENT_INSTANCE_BY_PAGE_ID",{pageId:t,componentName:"Page",fid:e,componentInstance:this})}else this.$store.dispatch("registerComponentInstance",{componentName:"Page",fid:e,componentInstance:this})},onload:function(){if(this.runtime){this.timerContentParse();try{var e=this.data.page.attributes,t=e&&e.onload,a=t&&t.attributes,i=a&&a.content;if((i.attributes||[]).find((function(e){var t;return!(null==e||null===(t=e.executionType)||void 0===t||!t.value)}))){var n=this.$getPageParser(this.data.pageId);"function"==typeof n.fireSDCOnLoadEvent&&n.fireSDCOnLoadEvent(),this.$eventContentParse(i)}}catch(e){this.$sendLog({logData:{message:e.message,info:Object(S.yb)({pageId:this.data.pageId})},logTitle:"页面onload事件错误"})}}},clearTimerWatcher:function(){var e=this;Object.keys(this.pageTimerWatcher||{}).forEach((function(t){"function"==typeof e.pageTimerWatcher[t]&&e.pageTimerWatcher[t]()}))},timerContentParse:function(){var e=this,t=this.data.page.attributes,a=t&&t.timer,i=a&&a.attributes,n=i&&i.content,r=n.attributes||[];this.clearTimerWatcher(),r.forEach((function(t){e.pageTimerWatcher[Object(S.ob)()]=e.$watch((function(){return t}),(function(){var a=t.timerCycle&&(t.timerCycle.value||t.timerCycle.default),i=t.timerName&&(t.timerName.value||t.timerName.default);clearInterval(e.pageTimer[i]),clearTimeout(e.pageTimer[i]),e.pageTimer[i]=null;var r=t.isTimeCycle&&(t.isTimeCycle.value||t.isTimeCycle.default);if(t.executionContent&&t.executionContent.value){var o;if(r){var l=t.timerCycle.min>a?t.timerCycle.min:t.timerCycle.max<a?t.timerCycle.max:a;o=setInterval((function(){var a=n;a.attributes=[t],e.$eventContentParse(a)}),l)}else o=setTimeout((function(){var a=n;a.attributes=[t],e.$eventContentParse(a)}),a);e.$set(e.pageTimer,i,o)}}),{deep:!0,immediate:!0})}))},pageAttrValidator:function(e,t,a,i){},getCustomType:function(e){var t,a=ha.a.TYPE_MAP,i=ha.a.BASE_EMPTY;return null!==(t=a[e])&&void 0!==t?t:i},handleCustomType:function(e,t,a,i){var n,r=this,o=i.isCustomVariable,l=a.fid;o&&o.forEach((function(o){if(o.fid===l)if("empty"===o.name&&(r.$setAttr(o,"visible",!0),r.$setAttr(o,"value",void 0),r.$setAttr(o,"type",r.getCustomType(e))),"value"===o.name&&(n=o),"Complex"===e){if("isObject"===o.name){var s;r.$setAttr(o,"value",!0);var c=i.objectAttr,u=ha.a.toComplex(null===(s=n)||void 0===s?void 0:s.value);"Object"!==Object.prototype.toString.call(u).slice(8,-1)&&r.$setAttr(n,"value",""),c.forEach((function(t){t.fid===l&&(!1===u?r.$setAttr(t,"visible",e):r.asyncComplexAttrs(t,u,n))})),r.handleIsObject(!0,t,a,i)}}else"isObject"===o.name&&r.$setAttr(o,"value",!1),r.handleIsObject(!1,t,a,i)}))},createNewObjectAttr:function(e,t,a,i,n){return{name:{name:"name",alias:"属性名",type:"String",changeHandler:"pageAttrChangeHandler",customGroupName:"isCustomVariableAttrName",titleVisible:!0,linkable:!1,fid:e,componentFid:t,componentName:"Page",componentType:"Page",value:i,lastValue:i,reserved:{objectName:n,objectAttrName:i}},alias:{name:"alias",alias:"属性别名",type:"String",default:"",linkable:!1,fid:e,componentFid:t,componentName:"Page",componentType:"Page",reserved:{objectName:n,objectAttrName:i}},description:{name:"description",alias:"属性描述",type:"String",linkable:!1,fid:e,componentFid:t,componentName:"Page",componentType:"Page",reserved:{objectName:n,objectAttrName:i}},value:{name:"value",alias:"属性值",type:"String",default:"",customGroupName:"isCustomVariable",fid:e,componentFid:t,componentName:"Page",componentType:"Page",value:a,lastValue:a,reserved:{objectName:n,objectAttrName:i}}}},asyncObjectAttrs:function(e,t,a){var i=this;if(t&&Object(S.tb)(t)){var n=Object.keys(t).map((function(e){var n,r=Object(S.ob)();return i.createNewObjectAttr(r,a.componentFid,t[e],e,null==a||null===(n=a.reserved)||void 0===n?void 0:n.objectName)}));this.$setAttr(e,"attributes",n)}else this.$setAttr(e,"attributes",[])},asyncComplexAttrs:function(e,t,a){var i=this;if(t&&Object(S.tb)(t)){var n=Object.keys(t).map((function(e){var n,r=Object(S.ob)();return i.createNewObjectAttr(r,a.componentFid,t[e],e,null==a||null===(n=a.reserved)||void 0===n?void 0:n.objectName)}));this.$setAttr(e,"attributes",n)}else{if(""!==t&&void 0!==t||!1===t)return void this.$message.error("变量值转换 [Complex]类型失败");var r=this.createNewObjectAttr(Object(S.ob)(),a.componentFid,"","","");this.$setAttr(e,"attributes",[r])}},handleValue:function(e,t,a,i){var n,r=this,o=i.isCustomVariable,l=a.fid;o&&o.forEach((function(t){if(t.fid===l&&("value"===t.name&&(n=t),"isObject"===t.name))if(!1===(t.value||t.default)){var o,s=i.objectAttr,c=ha.a.toEnum(null===(o=n)||void 0===o?void 0:o.value);s.forEach((function(e){e.fid===l&&r.asyncObjectAttrs(t,c,a)}))}else{if(""===e)return;var u=i.objectAttr,d=ha.a.toComplex(n.value);"Object"!==Object.prototype.toString.call(d).slice(8,-1)&&r.$setAttr(n,"value",""),u.forEach((function(e){e.fid===l&&r.asyncComplexAttrs(e,d,n)}))}}))},pageAttrChangeHandler:function(e,t,a,i){return"type"===a.name?this.handleCustomType(e,t,a,i):"value"===a.name?this.handleValue(e,t,a,i):"isObject"===a.name?this.handleIsObject(e,t,a,i):"isCustomVariableAttrName"===a.customGroupName?this.handleIsCustomVariableAttrName(e,t,a,i):"name"===a.name?this.handleName(e,t,a,i):"executionType"===a.name?this.handleExecutionType(e,t,a,i):"validateType"===a.name?this.handleValidateType(e,t,a,i):"validateContent"===a.name?this.handleValidateContent(e,t,a,i):void 0},handleIsObject:function(e,t,a,i){var n=this,r=i.objectAttr,o=a.fid;r&&r.forEach((function(t){t.fid===o&&n.$setAttr(t,"visible",e)}))},handleIsCustomVariableAttrName:function(e,t,a,i){var n=this,r=a.fid;i.objectAttr.forEach((function(t){var a;t.visible&&null!=t&&null!==(a=t.attributes)&&void 0!==a&&a.length&&t.attributes.forEach((function(a){var i;if((null==a||null===(i=a.name)||void 0===i?void 0:i.fid)===r){var o,l=t.attributes.map((function(e){var t,a;return(null==e||null===(t=e.name)||void 0===t?void 0:t.fid)!==r?null==e||null===(a=e.name)||void 0===a?void 0:a.value:void 0}));e&&l.includes(e)&&(n.$message.warning("属性名已存在"),n.$setAttr(a.name,"value",null==a||null===(o=a.name)||void 0===o?void 0:o.lastValue),n.$store.commit("SET_UN_SAVED",!0))}}))}));var o=i.isCustomVariable;o&&o.forEach((function(t){t.fid===r&&(t.hasOwnProperty("reserved")?t.reserved.objectAttrName=e:t.reserved={objectAttrName:e})}))},handleName:function(e,t,a,i){var n=a.fid,r=i.customVariableName,o=[];if(r.forEach((function(e){e.fid!==n&&o.push((null==e?void 0:e.value)||(null==e?void 0:e.default))})),null!=a&&a.value&&o.includes(a.value))return this.$message.warning("变量名已存在"),this.$setAttr(a,"value",a.lastValue),void this.$store.commit("SET_UN_SAVED",!0);var l=i.isCustomVariable;if(l){l.forEach((function(t){t.fid===n&&(t.hasOwnProperty("reserved")?t.reserved.objectName=e:t.reserved={objectName:e})}));var s=i.objectAttr;s&&s.forEach((function(t){if(t.fid===n){var a=t.attributes;a&&a.length&&a.forEach((function(t){var a="";for(var i in t){var n=t[i];"name"===i&&n.hasOwnProperty("value")&&(a=n.value),n.hasOwnProperty("reserved")?(n.reserved.objectName=e,n.reserved.objectAttrName=a):n.reserved={objectName:e,objectAttrName:a}}}))}}))}},pageComponentNameHandler:function(e,t,a,i){if("pageComponentName"===a.name){var n=i.executionComponentMethod.find((function(e){return e.fid===a.fid})),r=i.executionContent.find((function(e){return e.fid===a.fid})),o=i.executionTitleGroup.find((function(e){return e.fid===a.fid})),l=this.$store.getters.pageEditor,s=ma(ma({},l.pagesKV[l.pagesActiveName].componentKV),Object(S.fb)(l.pagesActiveName))[e].name;n&&this.$setAttr(n,"optionsFid",e),n&&n.value||r&&r.value?(this.complexData={element:n,targetCon:r,attr:a,newVal:e,targetTitle:o,componentName:s,oldVal:t},this.confirmDialogContent.key="dialogVisible",this.confirmDialogContent.content="切换组件，方法，参数将会被清空！是否要继续？",this.confirmDialogContent.visible=!0):this.$setAttr(o,"value",s)}else if("pageComponentMethod"===a.name){var c=i.executionComponentName.find((function(e){return e.fid===a.fid})),u=i.executionContent.find((function(e){return e.fid===a.fid})),d=i.groupExecutionType.find((function(e){return e.fid===a.fid}));"script"===e&&"script"!==t||"script"!==e&&"script"===t||"api"===e&&"api"!==t||"api"!==e&&"api"===t?(this.scriptComplexData={oldVal:t,targetCon:u,attr:a,newVal:e,customGroupName:i,groupExecutionType:d,executionComponentName:c},this.confirmDialogContent.key="scriptDialogVisible",this.confirmDialogContent.content="切换组件，方法，参数将会被清空！是否要继续？",this.confirmDialogContent.visible=!0):"script"===e||"api"===e?(this.handleExecutionType(e,t,a,i),this.$setAttr(d,"value",e)):(this.confirmDefautData={targetCon:u,groupExecutionType:d,newVal:e,executionComponentName:c,attr:a},this.confirmDialogContent.key="defualt",this.confirmDialogContent.content="切换组件，方法，参数将会被清空！是否要继续？",this.confirmDialogContent.visible=!0)}},handleExecutionType:function(e,t,a,i){var n=this,r=i.executionContent;if(r){var o=a.fid;r.forEach((function(t){t.fid===o&&(t.value&&(n.$removeAttr(t,"value"),n.$removeAttr(t,"editValue"),n.$setAttr(t,"editor",e)),n.$removeAttr(t,"value"),n.$removeAttr(t,"editValue"),n.$setAttr(t,"editor",e))}))}},setValidateAttrByFid:function(e,t,a){var i=this;e&&e.forEach((function(e){e.fid===t&&("default"===a||"regex"===a?i.$setAttr(e,"visible",!0):"script"===a&&i.$setAttr(e,"visible",!1))}))},handleValidateType:function(e,t,a,i){var n=this,r=i.validateTypeRelated;if(r){t=t||a.default;var o=a.fid;r.forEach((function(r){if(r.fid===o){if(r.value)return n.validateComplexData={attr:a,newVal:e,item:r,customGroupName:i,oldVal:t},n.confirmDialogContent.key="validateDialogVisible",n.confirmDialogContent.content="切换校验类型，校验内容会被清空！是否要继续？",void(n.confirmDialogContent.visible=!0);"default"===e?(n.$setAttr(r,"type",r.validateDefaultType),n.$removeAttr(r,"editor")):"regex"===e?(n.$setAttr(r,"type","String"),n.$removeAttr(r,"editor")):"script"===e&&(n.$setAttr(r,"type","String"),n.$setAttr(r,"editor","script")),n.setValidateAttrVisible(i.validateMaxlength,r.fid,!1),n.setValidateAttrVisible(i.validateMinlength,r.fid,!1),n.setValidateAttrVisible(i.validateMax,r.fid,!1),n.setValidateAttrVisible(i.validateMin,r.fid,!1),n.setValidateAttrByFid(i.validateScriptRelated,r.fid,e),n.$removeAttr(r,"value"),n.$removeAttr(r,"editValue")}}))}},handleValidateContent:function(e,t,a,i){var n=this,r=i.validateContentRelated;r&&r.forEach((function(t){t.fid===a.fid&&(n.setValidateAttrVisible(i.validateMaxlength,t.fid,!1),n.setValidateAttrVisible(i.validateMinlength,t.fid,!1),n.setValidateAttrVisible(i.validateMax,t.fid,!1),n.setValidateAttrVisible(i.validateMin,t.fid,!1),"maxlength"!==e?"minlength"!==e?"max"!==e?"min"===e&&n.setValidateAttrVisible(i.validateMin,t.fid,!0):n.setValidateAttrVisible(i.validateMax,t.fid,!0):n.setValidateAttrVisible(i.validateMinlength,t.fid,!0):n.setValidateAttrVisible(i.validateMaxlength,t.fid,!0))}))},setValidateAttrVisible:function(e,t,a){var i=this;e&&e.forEach((function(e){e.fid===t&&(e.visible!==a&&i.$setAttr(e,"visible",a))}))},getCalcHeight:function(e){var t=Object(S.pb)(e.value,e.default);if(this.isAutoHeight&&t.indexOf("%")>-1)return"auto";if(0===this.fromPageId)return t;if(t.indexOf("%")>-1&&!this.fromPageId){if(!this.runtime){var a=Object(S.nb)("editorPadding")||[20,20,20,20];return t.replace("%","")*this.autoHeight/100-a[0]-a[2]+"px"}return t.replace("%","")*this.autoHeight/100+"px"}return t},getAttrValue:function(e,t){if("height"===e.name)return this.getCalcHeight(e);if("background-image"===e.name){var a=Object(S.pb)(e.value,e.default),i=e.editValue;if(i)if(1===(null==i?void 0:i.source)){var n=window.location.origin,r="/files",o=(this.portalInfo||{}).filePathPrefix;a.startsWith("".concat(r,"/"))||(a="".concat(o||n).concat(r).concat(a))}else a=i.webUrl;return a?'url("'+a+'")':""}if("padding"===e.name||"margin"===e.name||"border-width"===e.name){var l=Object(S.pb)(e.value,e.default||Object(S.nb)(e.name),e.type);return"array"===this.$util.getObjType(l)?l.map((function(e){return e+"px"})).join(" "):l}if("border-style"===e.name||"border-color"===e.name){var s=Object(S.pb)(e.value,e.default||Object(S.nb)(e.name),e.type);return"array"===this.$util.getObjType(s)?s.join(" "):s}return"background-color"===e.name||"background"===e.name||"color"===e.name?Object(S.cb)(e.value):Object(S.pb)(e.value,e.default)+("Number"===t&&"z-index"!==e.name?"px":"")},handleSelect:function(){this.runtime||this.$store.dispatch("updateActiveComponentByFid",this.data.fid)},handlePut:function(e,t,a,i){var n=null==a?void 0:a.dataset.groupName;return["layout","quickLayout"].includes(n)||(null==n?void 0:n.startsWith("SDC_"))},handleAdd:function(e){this.$store.dispatch("addComponent",e)},handleEvent:function(e,t){if(this.$store.getters.pageEditor,!this.runtime){var a={mode:t.pullMode,index:t.newIndex};if("add"!==e)if("end"!==e||t.from===t.to){if("start"===e){var i=t.item.id;this.$store.dispatch("updateActiveComponent",i)}}else{a.parentFid=t.to.id,a.itemId=t.item.id;var n=Object(S.S)("handleAdd",a.parentFid);"function"===this.$util.getObjType(n)&&n(a)}else this.handleAdd(a)}},addEvents:function(){window.addEventListener("resize",this.resizeFunc,!1),this.runtime||window.addEventListener("keydown",this.handleKeydown,!1)},handleKeydown:function(e){if(e||window.e){var t=e.keyCode,a=e.target;if(8!==t&&46!==t)return;var i=this.$store.getters.pageEditor,n=i.designerInstance;if(!n)return;var r=n.$el;if(a.contains(r)){var o=i&&i.pagesKV[i.pagesActiveName];if(!o)return;var l=o.activeComponentFid,s=o.page.fid;if(!l||l===s)return;o.componentInstance[l]&&this.handleRemove(l)}}},handleResize:function(){this.innerHeight=window.innerHeight,Ft.a.$emit("viewResize")},debouncedHandleResize:function(){return this.$util.debounce(this.handleResize,300)},handleRemove:function(e){var t=this;this.$confirm("确定要删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.$store.dispatch("removeComponent",e)})).catch((function(){}))},onPageBorderChange:function(e){this.hasBorder=e&&!this.runtime}}},ba=(a("2806"),Object(l.a)(va,(function(){var e=this,t=e._self._c;return t("div",{style:e.innerStyles},[t("el-row",{key:e.pageId,staticStyle:{height:"100%"},attrs:{gutter:e.gutter}},[t(e.runtime||e.isSDC?"div":"draggable",{directives:[{name:"show",rawName:"v-show",value:e.dataLoaded,expression:"dataLoaded"}],key:e.data.pageId,tag:"component",class:{"page-content":!0,editorMod:!e.runtime},attrs:{id:e.data.pageId,group:{name:"components",put:e.handlePut},"ghost-class":"ghost",animation:200,"data-component-type":"page",list:e.data.component},on:{end:function(t){return t.stopPropagation(),e.handleEvent("end",t)},start:function(t){return t.stopPropagation(),e.handleEvent("start",t)},move:function(t){return t.stopPropagation(),e.handleEvent("move",t)},choose:function(t){return t.stopPropagation(),e.handleEvent("choose",t)},add:function(t){return t.stopPropagation(),e.handleEvent("add",t)}}},e._l(e.data.component,(function(a,i){return t("component-box",{key:e.pageId+"_"+i,ref:"item.fid",refInFor:!0,attrs:{parentId:e.pageId,pageId:e.pageId,parent:e.data.component,data:a,hasBorder:e.hasBorder,runtime:e.runtime}})})),1)],1),t("confirm-dialog",{attrs:{visible:e.confirmDialogContent.visible,content:e.confirmDialogContent.content},on:{close:function(t){return e.handleConfirmClose(e.confirmDialogContent.key)},submit:function(t){return e.handleConfirmSubmit(e.confirmDialogContent.key)}}})],1)}),[],!1,null,null,null)).exports,ga=i.default.prototype.$isServer,ya=!ga&&document.addEventListener?function(e,t,a){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];e&&t&&a&&e.addEventListener(t,a,i)}:function(e,t,a){e&&t&&a&&e.attachEvent("on"+t,a)},_a=!ga&&document.removeEventListener?function(e,t,a){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];e&&t&&e.removeEventListener(t,a,i)}:function(e,t,a){e&&t&&e.detachEvent("on"+t,a)};var Ca=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;function Oa(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return Ta(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?Ta(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,l=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return o=e.done,e},e:function(e){l=!0,r=e},f:function(){try{o||null==a.return||a.return()}finally{if(l)throw r}}}}function Ta(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=new Array(t);a<t;a++)i[a]=e[a];return i}var Va,wa,Pa=!1;function xa(){Pa=!1,Ft.a.$emit("bemDisabledSelect",!1),ea(!1),clearInterval(wa),Va=null}function Sa(e,t,a){var i;if(Pa)i=aa(a);else{i=function(e){var t,a=Oa(e);try{for(a.s();!(t=a.n()).done;){var i=ta(t.value);if(i)return i}}catch(e){a.e(e)}finally{a.f()}}(function(e){return e.path||e.composedPath&&e.composedPath()||[]}(e))}var n=i.getAttribute&&"Page"===i.getAttribute("comp-name");if(i){var r=i;if(!n||(r=i.firstElementChild)){var o=Xt(t,r,n);return ia(n?i.getAttribute("comp-name"):i.lastElementChild.firstElementChild.getAttribute("comp-name"),o,i)}}}var ja={inserted:function(e,t,a){var i=a.elm;e.ondragstart=function(e){Va=e.target,Pa=!0,Ft.a.$emit("bemDisabledSelect",!0),ea(!0);var t=function(){var t=Sa(e,i,Va);Ft.a.$emit("bemPointer",t)};t(),clearInterval(wa),wa=setInterval((function(){t()}),100)},window.removeEventListener("dragend",xa,!0),window.addEventListener("dragend",xa,!0),e.onmouseover=function(e){if(!Pa){var t=Sa(e,i,Va);Ft.a.$emit("bemPointer",t)}},e.onmouseout=function(){Ft.a.$emit("bemPointer","",{})}},beforeUnmount:function(e){e.onmouseover=null,e.onmouseout=null,window.removeEventListener("dragend",xa,!0),clearInterval(wa),Va=null}},Ea={name:"BemTitle",props:{name:{type:String,default:""}}},ka=(a("bb50"),Object(l.a)(Ea,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"bem-header-title t-primary-bg t-text-primary__reverse"},[t("div",{staticClass:"title-icon"},[t("iconfont",{attrs:{right:5,type:"el-icon-star-off"}})],1),t("div",{staticClass:"title-content"},[e._v(e._s(e.name))])])}),[],!1,null,"0d82e7ed",null)).exports,Ia={name:"PasteDialog",data:function(){return{visible:!1,list:[{name:"内部",value:"inner"},{name:"下方",value:"rear"}],type:"rear",selected:"",children:[]}},props:{component:{type:Object,default:function(){return{}}}},watch:{},methods:{handleTypeChange:function(){var e=Object(y.e)(this.component).name;"Flow"!==e&&"LoadRefresh"!==e&&(this.selected="")},reset:function(){this.list=[{name:"内部",value:"inner"},{name:"下方",value:"rear"}],this.type="rear",this.selected="",this.children=[]},handleClickSure:function(){if(this.validate()){var e=this.getPasteParams();this.$emit("paste",e),this.visible=!1}else this.$message({type:"error",message:"请选择粘贴到内部的何处"})},validate:function(){return"inner"!==this.type||""!==this.selected&&void 0!==this.selected},handleComponent:function(){this.reset();var e=Object(y.e)(this.component),t=e.attributes,a=e.name,i=e.children;switch(a){case"LoadRefresh":case"Flow":this.children=[{name:"内部",value:"inner"}],this.selected="inner";break;case"Grid":this.children=i.map((function(e,t){return{name:"Col-".concat(t,"(第").concat(t+1,"列)"),value:e.fid}}));break;case"Mobiletab":case"Tabs":this.children=t.tabNameConfig.attributes.map((function(e,t){return{name:"".concat(e.tabName.value),value:e.tabId.value}}));break;case"Collapse":this.children=t.collapseName.attributes.map((function(e,t){return{name:"第".concat(t,"个"),value:t}}));break;case"CarouselLayout":for(var n=t.carouseItemLength.value||t.carouseItemLength.default,r=[],o=0;o<n;o++)r.push({name:"第".concat(o,"个"),value:o});this.children=r}},getPasteParams:function(){if("rear"===this.type)return{type:this.type};var e={};switch(this.component.name){case"LoadRefresh":case"Flow":e.parentFid=this.component.fid;break;case"Grid":e.parentFid=this.selected;break;case"Mobiletab":case"Tabs":case"Collapse":case"CarouselLayout":e.parentFid=this.component.fid,e.tabIndex=this.selected}return{type:this.type,payload:e}}}},Aa=(a("9d38"),Object(l.a)(Ia,(function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{"close-on-click-modal":!1,width:"76%","append-to-body":!0,"modal-append-to-body":!0,visible:e.visible,title:"粘贴选择"},on:{"update:visible":function(t){e.visible=t}}},[t("div",[e._v("\n    粘贴方式\n    "),t("el-radio-group",{staticClass:"checkbox-group",model:{value:e.type,callback:function(t){e.type=t},expression:"type"}},e._l(e.list,(function(a,i){return t("el-radio",{key:i,attrs:{label:a.value,border:""},on:{change:e.handleTypeChange}},[e._v(e._s(a.name))])})),1)],1),"inner"===e.type?t("div",[e._v("\n    粘贴位置\n    "),t("el-radio-group",{staticClass:"checkbox-group",model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}},e._l(e.children,(function(a,i){return t("el-radio",{key:i,attrs:{label:a.value,border:""}},[e._v(e._s(a.name))])})),1)],1):e._e(),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.handleClickSure}},[e._v("确认")])],1),t("div")])}),[],!1,null,"50a3b9f7",null)).exports,Da={name:"BemOperation",components:{PasteDialog:Aa},props:{page:{type:Object,default:function(){return{}}},comp:{type:Object,default:function(){return{}}}},inject:["isSDC"],data:function(){var e=this;return{hover:"",operations:[{key:"decompose",name:"组件分解",visible:function(t){return"Page"!==t.compType&&e.operationVisible(t,"decompose")},icon:"/modules/page-editor/public/svg/decompose.svg",style:{fontSize:"16px",marginLeft:"-1px",marginRight:"-1px"}},{key:"quick",name:"快速复制",visible:function(t){return"Page"!==t.compType&&e.operationVisible(t,"quick")},icon:"el-icon-copy-document"},{key:"copy",name:"拷贝",visible:function(t){return"Page"!==t.compType&&e.operationVisible(t,"copy")},icon:"el-icon-upload2"},{key:"paste",name:"粘贴",visible:function(t){return"Page"!==t.compType&&e.operationVisible(t,"paste")},icon:"el-icon-download"},{key:"delete",name:"删除",visible:function(t){return"Page"!==t.compType&&e.operationVisible(t,"delete")},icon:"el-icon-delete"},{key:"copy-page-variables",name:"复制页面变量",visible:function(t){return"Page"===t.compType&&e.operationVisible(t,"copy-page-variables")},icon:"el-icon-upload2"},{key:"paste-page-variables",name:"粘贴页面变量",visible:function(t){return"Page"===t.compType&&e.operationVisible(t,"paste-page-variables")},icon:"el-icon-download"}],currentComponent:{}}},methods:{operationVisible:function(e,t){var a,i=null===(a=e._instance)||void 0===a?void 0:a.data,n=(null==i?void 0:i.name)&&i.isCurrentTopSDC;return"decompose"===t?!n&&"ContainerSDC"===(null==i?void 0:i.name):!n},handleOperationClick:function(e){var t="i"===e.target.localName?e.target.parentNode:e.target;if(t){var a,i=t.getAttribute("operationName");if(!i)i=null===(a=(e.path||e.composedPath&&e.composedPath()).find((function(e){return e.hasAttribute("operationName")})))||void 0===a?void 0:a.getAttribute("operationName");switch(i){case"decompose":this.handleDecomposeClick();break;case"quick":this.handleQuickClick();break;case"copy":this.handleCopyClick();break;case"paste":this.handlePasteClick();break;case"delete":this.handleDeleteClick();break;case"copy-page-variables":this.handleCopyPageVariables();break;case"paste-page-variables":this.handlePastePageVariables()}}},handleCopyPageVariables:function(){try{var e=JSON.stringify(this.page.page.attributes.customVariable.attributes);localStorage.setItem("page-variables-clip",e),this.$message({message:"复制成功",type:"success"})}catch(e){this.$message({message:"复制失败",type:"error"})}},handlePastePageVariables:function(){var e=this;this.$confirm("粘贴将清空已有页面变量，是否确定?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var t=localStorage.getItem("page-variables-clip");try{var a=JSON.parse(t),i=e.page.page.fid,n=a.map((function(e){for(var t in e)e[t].fid=i;return e}));e.$store.commit("SET_PAGE_VARIABLES",n),e.$message({message:"粘贴成功!",type:"success",duration:3e3})}catch(t){e.$message({message:"粘贴失败",type:"warning"})}})).catch((function(){}))},getCompAndParent:function(){var e,t,a=this.comp.id;return function i(n){for(var r=0;r<n.length;r++){var o=n[r];o.fid!==a?Array.isArray(o.children)&&i(o.children):(e=o,t=n)}}(this.page.component),{comp:e,parent:t}},handleDecomposeClick:function(){var e=this;this.$confirm("确定要分解吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var t=e.getCompAndParent(),a=t.comp,i=t.parent;a&&"ContainerSDC"===(null==a?void 0:a.name)&&i&&e.$store.dispatch("decomposeComponent",{fid:a.fid,data:a,target:i})})).catch((function(){}))},handleQuickClick:function(){var e=this.getCompAndParent(),t=e.comp,a=e.parent,i=this.clearComponent(t),n={fid:t.fid,data:i,target:a};t&&t.hasOwnProperty("author")&&a&&(this.debounceQuick||(this.debounceQuick=this.$util.debounce((function(e){this.$store.dispatch("copyComponent",e)}),300,!0)),this.debounceQuick(n))},clearComponent:function(e){var t=JSON.stringify(e);return JSON.parse(t)},handleCopyClick:function(){var e,t,a=null===(e=this.comp)||void 0===e||null===(t=e._instance)||void 0===t?void 0:t.data;if(a){var i=Object(y.e)(a);localStorage.setItem("inovance-webtools-page-clip",JSON.stringify(i)),this.$message({message:"拷贝成功",type:"success"})}else this.$message({message:"拷贝失败",type:"error"})},handlePasteClick:function(){var e=this,t=this.getCompAndParent(),a=t.comp;if(t.parent,"layout"===a.groupName||"quickLayout"===a.groupName)return this.currentComponent=a,void this.$nextTick((function(){e.$refs.pasteDialog.visible=!0,e.$refs.pasteDialog.handleComponent()}));this.handlePaste(null==a?void 0:a.parentFid,a,a.tabIndex)},handleDeleteClick:function(){var e=this;this.$confirm("确定要删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.$store.dispatch("removeComponent",e.comp.id)})).catch((function(){}))},onMouseOver:function(e){var t="i"===e.target.localName?e.target.parentNode:e.target;if(t&&(this.hover=t.getAttribute("hoverName"),!this.hover)){var a,i=e.path||e.composedPath&&e.composedPath();this.hover=null===(a=i.find((function(e){return e.hasAttribute("hoverName")})))||void 0===a?void 0:a.getAttribute("hoverName")}},onMouseOut:function(){this.hover=""},handlePasteSure:function(e){var t=this.getCompAndParent(),a=t.comp,i=(t.parent,e.type),n=e.payload;if("inner"===i){var r=n.parentFid,o=n.tabIndex;this.handlePaste(r,a,o)}else this.handlePaste(a.parentFid,a,a.tabIndex)},handlePaste:function(e,t,a){var i=this,n=localStorage.getItem("inovance-webtools-page-clip");if(n)try{var r=JSON.parse(n);if(!e&&"layout"!==r.groupName&&"ContainerSDC"!==r.name&&"container"!==r.groupName)return void this.$message({message:"不可复制在页面最外层",type:"warning"});var o=Object(S.I)(e,this.page.component),l=Object(S.A)(r,["dataContainer"].includes(null==o?void 0:o.groupName)?null==o?void 0:o.componentType:null==o?void 0:o.name,!0,!0),s=this.getCompAndParent(),c=s.comp,u=s.parent;l.pageId=c.pageId,l.tabIndex=a,l.parentFid=e;var d={componentName:l.attributes.componentName.value,componentType:l.attributes.componentType.value,componentFid:l.fid};for(var p in l.attributes)l.attributes[p].componentName||(l.attributes[p].componentName=d.componentName),l.attributes[p].componentType||(l.attributes[p].componentType=d.componentType),l.attributes[p].componentFid||(l.attributes[p].componentFid=d.componentFid);this.$store.dispatch("copyComponent",{fid:c.fid,data:l,parentFid:e,target:u}),this.$message({message:"粘贴成功! ",type:"success",duration:3e3}),setTimeout((function(){i.$message({message:"该功能不会自动将关联组件带入，如果事件或脚本中使用了组件方法，将可能失效，须重新配置。",type:"info",duration:2e3})}),100)}catch(e){this.$message({message:"组件格式错误，不可粘贴",type:"warning"})}else this.$message({message:"暂无可粘贴组件",type:"warning"})}}},Na=(a("9921"),Object(l.a)(Da,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"bem-operation t-primary-bg"},[t("div",{staticClass:"bem-operation-wrap",on:{mouseover:function(t){return t.stopPropagation(),e.onMouseOver.apply(null,arguments)},mouseout:function(t){return t.stopPropagation(),e.onMouseOut.apply(null,arguments)},click:function(t){return t.stopPropagation(),e.handleOperationClick.apply(null,arguments)}}},e._l(e.operations,(function(a){return t("div",{directives:[{name:"show",rawName:"v-show",value:"function"!=typeof a.visible||a.visible(e.comp),expression:"typeof item.visible === 'function' ? item.visible(comp) : true"}],key:a.key,class:["bem-operation-item",{"t-color-primary-light-1__bg":a.key===e.hover}],attrs:{operationName:a.key,hoverName:a.key}},[t("el-tooltip",{attrs:{effect:"dark",content:a.name,placement:"top"}},[t("iconfont",{staticClass:"t-text-primary__reverse",style:a.style,attrs:{type:a.icon}})],1)],1)})),0),t("paste-dialog",{ref:"pasteDialog",attrs:{component:e.currentComponent},on:{paste:e.handlePasteSure}})],1)}),[],!1,null,"470bcf0f",null)).exports;var $a={inserted:function(e){e.onmouseover=function(e){e.stopPropagation()},e.onmouseout=function(e){e.stopPropagation()}},beforeUnmount:function(e){e.onmouseover=null,e.onmouseout=null}},La={name:"BemDatabase"},Ma=(a("6371"),Object(l.a)(La,(function(){var e=this._self._c;return e("div",{staticClass:"bem-database t-color-primary-light-8__bg t-color-primary"},[e("iconfont",{staticClass:"bem-database-icon",attrs:{type:"el-icon-coin"}}),e("span",{staticClass:"bem-database-source"},[this._v("database")])],1)}),[],!1,null,"5b9b5d53",null)).exports,qa={name:"BemPath",components:{BemTitle:ka},props:{name:{type:String,default:""},links:{type:Array,default:function(){return[]}}},computed:{linkStyle:function(){return{}}},methods:{command:function(){this.$emit.apply(this,["command"].concat(Array.prototype.slice.call(arguments)))},visibleChange:function(){this.$emit.apply(this,["visible-change"].concat(Array.prototype.slice.call(arguments)))},mouseOver:function(){this.$emit.apply(this,["mouseOver"].concat(Array.prototype.slice.call(arguments)))},mouseOut:function(){this.$emit.apply(this,["mouseOut"].concat(Array.prototype.slice.call(arguments)))}}},Ba=(a("f903"),Object(l.a)(qa,(function(){var e=this,t=e._self._c;return t("el-dropdown",{directives:[{name:"pointer-stop",rawName:"v-pointer-stop"}],staticClass:"bem-path",attrs:{placement:"bottom-start",size:"mini"},on:{command:e.command,"visible-change":e.visibleChange}},[t("span",{staticClass:"el-dropdown-link"},[t("bem-title",{attrs:{name:e.name}})],1),t("el-dropdown-menu",{directives:[{name:"pointer-stop",rawName:"v-pointer-stop"}],staticClass:"list-content",attrs:{slot:"dropdown"},slot:"dropdown"},e._l(e.links,(function(a,i){return t("el-dropdown-item",{key:i,staticClass:"t-primary-bg t-text-primary__reverse",style:e.linkStyle,attrs:{command:a},nativeOn:{mouseover:function(t){return t.stopPropagation(),e.mouseOver(a)},onmouseout:function(t){return t.stopPropagation(),e.mouseOut.apply(null,arguments)}}},[t("iconfont",{attrs:{right:5,type:"el-icon-star-off"}}),t("span",[e._v(e._s(a.name))])],1)})),1)],1)}),[],!1,null,"1741cb6c",null)).exports,Fa={name:"BemSetting",data:function(){return{visible:!1,rules:[],setting:{source:""}}},created:function(){this.busMonitor()},destroyed:function(){this.busDestroy()},methods:{onVisibleChange:function(){this.visible=!this.visible},busMonitor:function(){Ft.a.$on("bemSetting",this.onVisibleChange)},busDestroy:function(){Ft.a.$off(["bemSetting"])}}};function Ra(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function Ka(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ra(Object(a),!0).forEach((function(t){Object(f.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ra(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var Ua={name:"Bem",components:{BemSetting:(a("a525"),a("d663"),Object(l.a)(Fa,(function(){var e=this,t=e._self._c;return t("el-popover",{attrs:{placement:"bottom-start","popper-class":"bem-setting-popper",width:"300",trigger:"manual"},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[t("div",{staticClass:"bem-setting t-primary-bg t-text-primary__reverse",attrs:{slot:"reference"},on:{click:function(t){return t.stopPropagation(),e.onVisibleChange.apply(null,arguments)}},slot:"reference"},[t("iconfont",{staticClass:"bem-setting-icon",attrs:{type:"el-icon-setting"}})],1),t("el-form",{ref:"form",attrs:{"label-width":"300px",model:e.setting,"label-position":"top",size:"mini",rules:e.rules}},[t("el-form-item",{staticClass:"bem-setting-item",attrs:{label:"数据源",prop:"source"}},[t("el-input")],1)],1)],1)}),[],!1,null,"44154810",null)).exports,BemPath:Ba,BemDatabase:Ma,BemOperation:Na,BemTitle:ka},data:function(){return{pointerBorderWidth:1,selectedBorderWidth:2,pointer:{},selected:{},pathLinks:[],pointers:[],link:{},selectedWatch:[],pointerWatch:[],headerReverse:!1,selectedPage:{},structure:[],operation:[{key:""}],scrollStartTop:0,scrollEndTop:0,scrollTimer:null,selectedShow:!0,pointerShow:!0,observer:null}},directives:{pointerStop:$a},computed:Ka(Ka({},Object(He.a)(["themeConstColor","pageEditor","bemPointerAll"])),{},{pointStyle:function(){var e=this.pointer,t=e.name,a=e.position;return Ka({border:"".concat(t?1:0,"px dashed ").concat(this.themeConstColor.primary)},a||{})},selectedStyle:function(){var e=this.selected,t=e.name,a=e.position;return Ka({border:"".concat(t?1:0,"px solid ").concat(this.themeConstColor.primary)},a||{})},linkStyle:function(){return{}},pointerName:function(){return this.pointer.name||""},selectedName:function(){return this.selected.name||""}}),watch:{link:{handler:function(e){e&&this.setPointerById(e.id,e.type)},deep:!0},bemPointerAll:function(e){e?this.setPointerAll():this.removePointerAll()}},created:function(){this.busMonitor(),this.initMutation()},mounted:function(){this.viewWatcher()},destroyed:function(){this.selectedWatchClear(),this.pointerWatchClear(),this.busDestroy(),this.viewWatcherDestroy(),this.selectedDisconnect()},methods:{mutations:function(){},viewWatcher:function(){var e,t,a,i=null===(e=this.pageEditor)||void 0===e?void 0:e.pagesKV[null===(t=this.pageEditor)||void 0===t?void 0:t.pagesActiveName],n=null==i?void 0:i.componentInstance[null==i||null===(a=i.page)||void 0===a?void 0:a.fid];null!=n&&n.$el&&ya(null==n?void 0:n.$el,"scroll",this.onElementScroll,!0)},onElementScroll:function(e){var t=this;clearTimeout(this.timer);var a=e.target;this.selectedShow=!1,this.pointerShow=!1,this.timer=setTimeout(Object(V.a)(x.a.mark((function e(){return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.isScrollEnd(a);case 2:t.selectedShow=!0,t.pointerShow=!0;case 4:case"end":return e.stop()}}),e)}))),300),this.scrollStartTop=a.scrollTop},isScrollEnd:function(e){if(this.scrollEndTop=e.scrollTop,this.scrollEndTop===this.scrollStartTop)return this.scrollStartTop=0,this.scrollEndTop=0,this.scrollTimer=null,this.refreshPointer(),this.setSelected(this.selectedPage)},refreshPointer:function(){var e=this.$parent.$el,t=this.pointer.el;if(e&&t){var a=Xt(e,t);this.pointer=Ka(Ka({},this.pointer),{},{position:a})}},viewWatcherDestroy:function(){var e,t,a=null===(e=this.pageEditor)||void 0===e?void 0:e.pagesKV[null===(t=this.pageEditor)||void 0===t?void 0:t.pagesActiveName];null!=a&&a.$el&&_a(null==a?void 0:a.$el,"scroll",this.onElementScroll,!0)},handleLinkCommand:function(e){var t="Page"===e.type;this.$store.dispatch(t?"updateActiveComponentByFid":"updateActiveComponent",e.id)},onLinkMouseOver:function(e){this.link=Ka(Ka({},e),{},{_v:+new Date})},onLinkMouseOut:function(){this.link={}},onStructureLinkShow:function(e){e&&this.initStructure()},initStructure:function(){var e=function(e){var t={id:e.fid,fid:e.fid,name:"页面",type:"Page"},a=[t];return function e(t,i){(t||[]).forEach((function(t){var n,r,o,l;a.push({id:t.fid,name:null==t||null===(n=t.attributes)||void 0===n||null===(r=n.componentName)||void 0===r?void 0:r.value,type:null==t||null===(o=t.attributes)||void 0===o||null===(l=o.componentType)||void 0===l?void 0:l.value,pid:i.fid}),Array.isArray(t.children)&&e(t.children,t)}))}(e.component,t),a}(this.selectedPage);this.pathLinks=function(e,t){var a=[],i=e.find((function(e){return e.id===t}));return i&&function t(i){var n=e.find((function(e){return e.id===i}));n&&(n.name&&a.push(n),n.pid&&t(n.pid))}(i.pid),a}(e,this.selected.id)},getHeaderStyle:function(e){var t,a="selected"===e.type?this.selectedBorderWidth:this.pointerBorderWidth,i=e.position,n=void 0===i?{}:i,r=20+a+1,o=n.top&&parseInt(n.top)>20,l=n.bottom&&parseInt(n.bottom)>20,s=!o&&!l;return t={},Object(f.a)(t,o||s?"top":"bottom","".concat(s?1:-r,"px")),Object(f.a)(t,"left",this.headerReverse?"auto":"".concat(s?a:-a,"px")),Object(f.a)(t,"right","".concat(s?a:-a,"px")),Object(f.a)(t,"height","".concat(20,"px")),Object(f.a)(t,"lineHeight","".concat(20,"px")),t},getRectStyle:function(e){var t=e.name,a=e.position,i=e.type,n="selected"===i,r="pointerAll"===i,o=n?this.selectedBorderWidth:this.pointerBorderWidth,l="".concat(t?o:0,"px"),s=n?"solid":"dashed",c=r?"#cccccc":this.themeConstColor.primary;return Ka({border:"".concat(l," ").concat(s," ").concat(c)},a||{})},setDisabledSelect:function(e){this.disabledSelect=e},busMonitor:function(){var e=this;Ft.a.$on("bemDisabledSelect",this.setDisabledSelect),Ft.a.$on("bemPointer",this.setPointer),Ft.a.$on("bemSelected",this.setSelected),Ft.a.$on("bemSetPointerAll",this.setPointerAll),Ft.a.$on("bemSelectedRefresh",(function(){return e.setSelected(e.selectedPage)})),Ft.a.$on("viewResize",this.viewResize)},busDestroy:function(){Ft.a.$off(["bemDisabledSelect","bemPointer","bemSelected","bemSetPointerAll","bemSelectedRefresh","viewResize"])},viewResize:function(){this.bemPointerAll&&this.setPointerAll(),this.setSelected(this.selectedPage)},getCompContentBlock:function(e,t){return Array.from(e.classList||[]).includes("component-block")||!e.parentNode?e:this.getCompContentBlock(e.parentNode)},setPointerAll:function(){var e,t,a=this,i=this.selectedPage,n=null===(e=this.pageEditor)||void 0===e?void 0:e.pagesKV[null===(t=this.pageEditor)||void 0===t?void 0:t.pagesActiveName],r=i.componentInstance||(null==n?void 0:n.componentInstance)||{},o=[],l=this.$parent.$el;this.pointerWatchClear();var s=[];Object.values(r).forEach((function(e){var t,i,n;s=s.concat(a.attrWatcher(e,a.setPointerAll,a.setPointerAll));var r=a.getCompContentBlock(e.$el),c=Xt(l,r);o.push({name:null==e||null===(t=e.data)||void 0===t||null===(i=t.attributes)||void 0===i||null===(n=i.componentName)||void 0===n?void 0:n.value,position:c,type:"pointerAll"})})),this.pointerWatch=s,this.pointers=[].concat(o,[{name:"Page",position:Xt(l,l),type:"pointerAll"}])},setPointerCancel:function(e){},removePointerAll:function(){this.pointers=[]},checkSamePointer:function(e,t){return(null==e?void 0:e.el)===(null==t?void 0:t.el)&&(null==e?void 0:e.name)===(null==t?void 0:t.name)&&(null==e?void 0:e.type)===(null==t?void 0:t.type)&&JSON.stringify((null==e?void 0:e.position)||{})===JSON.stringify((null==t?void 0:t.position)||{})},setPointer:function(e){e.name&&e.name===this.selected.name||this.checkSamePointer(this.pointer,e)||(this.pointer=e)},setPointerById:function(e,t){var a,i,n,r=this.selectedPage.componentInstance[e],o="Page"===t,l=this.$parent.$el,s=Xt(l,o?l:this.getCompContentBlock(r.$el));this.setPointer({name:o?"Page":null==r||null===(a=r.data)||void 0===a||null===(i=a.attributes)||void 0===i||null===(n=i.componentName)||void 0===n?void 0:n.value,position:s,type:"pointer"})},selectedWatchClear:function(){for(;this.selectedWatch.length;){var e=this.selectedWatch.pop();e&&e()}},pointerWatchClear:function(){for(;this.pointerWatch.length;){var e=this.pointerWatch.pop();e&&e()}},initMutation:function(){var e,t=this;this.observer=new Ca((function(e,a){return t.setSelected(t.selectedPage)}));var a,i=null===(e=this.$parent)||void 0===e?void 0:e.$children;(null==i?void 0:i.length)>=2&&this.selectedObserve(null===(a=i[0])||void 0===a?void 0:a.$el)},selectedObserve:function(e){this.observer.observe(e,{attributes:!0,childList:!0,subtree:!0})},selectedDisconnect:function(){this.observer.disconnect()},attrWatcher:function(e,t,a){if(e.$watch){var i=[];["height","width","xs","sm","span"].forEach((function(a){var n=e.$watch("data.attributes.".concat(a,".value"),t);i.push(n)}));var n=e.$watch("data.attributes.visibility",(function(e){["none"].includes(e.value||e.default)?a():["inherit","hidden"].includes(e.value||e.default)&&t()}),{deep:!0});return i.push(n),i}},selectedCancel:function(){this.$store.dispatch("updateActiveComponentByFid",this.selectedPage.pagesActiveName)},createSelectedWatch:function(e){var t=this;this.selectedWatchClear(),this.selectedWatch=this.attrWatcher(e,(function(){return t.setSelected(t.selectedPage)}),this.selectedCancel)},setSelected:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(V.a)(x.a.mark((function i(){var n,r,o,l,s,c,u,d,p,h,f,m,v,b,g,y,_,C;return x.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(e.componentInstance&&!t.disabledSelect){i.next=2;break}return i.abrupt("return");case 2:return t.selectedPage=e,t.headerReverse=!1,i.next=6,new Promise((function(t){Object(S.Eb)((function(){return e.componentInstance[a.id||e.activeComponentFid]}),null,1e3).then((function(e){var a,i;null!==(a=v=e)&&void 0!==a&&a.$nextTick?(null===(i=v)||void 0===i?void 0:i.$nextTick)&&v.$nextTick((function(){t()})):t()}))}));case 6:if(b="Page"===(null===(n=v)||void 0===n||null===(r=n.data)||void 0===r||null===(o=r.page)||void 0===o?void 0:o.name),g="Page"===a.type,y=t.$parent.$el,g||v){i.next=11;break}return i.abrupt("return");case 11:_=b?null===(l=v)||void 0===l?void 0:l.$el:g?y:t.getCompContentBlock(v.$el),C=Xt(y,_,b),t.selected={id:g?a.id:v.data.fid,name:b||g?"Page":null===(s=v)||void 0===s||null===(c=s.data)||void 0===c||null===(u=c.attributes)||void 0===u||null===(d=u.componentName)||void 0===d?void 0:d.value,compType:b||g?"Page":null===(p=v)||void 0===p||null===(h=p.data)||void 0===h||null===(f=h.attributes)||void 0===f||null===(m=f.componentType)||void 0===m?void 0:m.value,type:"selected",_instance:v,position:C},t.pointer={},t.$nextTick((function(){return t.checkRight(y)}));case 16:case"end":return i.stop()}}),i)})))()},checkRight:function(e){var t=this.$refs.bemOperation,a=null==t?void 0:t.$el.getBoundingClientRect(),i=e.getBoundingClientRect();a&&i&&a.right>i.right?this.headerReverse=!0:this.headerReverse=!1}}},za=(a("987c"),a("6f2d"),Object(l.a)(Ua,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"hc-editor-bem",attrs:{id:"editorBem"}},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.pointerShow&&e.pointerName,expression:"pointerShow && pointerName"}],staticClass:"hc-editor-bem-pointer pointer-hover",style:e.getRectStyle(e.pointer)},[t("div",{staticClass:"bem-header bem-header-pointer",style:e.getHeaderStyle(e.pointer)},[t("bem-title",{attrs:{name:e.pointerName}})],1)]),e.bemPointerAll?e._l(e.pointers,(function(a,i){return t("div",{key:i,staticClass:"hc-editor-bem-pointer",style:e.getRectStyle(a)})})):e._e(),t("div",{directives:[{name:"show",rawName:"v-show",value:e.selectedShow&&e.selectedName,expression:"selectedShow && selectedName"}],staticClass:"hc-editor-bem-selected",style:e.getRectStyle(e.selected)},[t("div",{directives:[{name:"pointer-stop",rawName:"v-pointer-stop"}],staticClass:"bem-header bem-selected",style:e.getHeaderStyle(e.selected)},[t("div",{staticClass:"header-wrap"},[t("div",{staticClass:"header-wrap-list"},[t("bem-path",{attrs:{name:e.selectedName,links:e.pathLinks},on:{command:e.handleLinkCommand,"visible-change":e.onStructureLinkShow,mouseOver:e.onLinkMouseOver,mouseOut:e.onLinkMouseOut}})],1),t("bem-operation",{ref:"bemOperation",staticClass:"header-wrap-operation",attrs:{page:e.selectedPage,comp:e.selected}})],1)])])],2)}),[],!1,null,"01c2a59c",null)).exports,Ga={name:"Placeholder",data:function(){return{img:"/modules/page-editor/public/img/placeholder.png"}},computed:{placeholderStyles:function(){var e={},t=Object(S.nb)("editorPadding"),a="20px";return"array"===this.$util.getObjType(t)&&(a=t.map((function(e){return e+"px"})).join(" ")),e.padding=a,e},wrapStyles:function(){return{backgroundColor:Object(S.nb)("mainContentBgColor")}}}},Ha={name:"Designer",components:{Placeholder:(a("f877"),Object(l.a)(Ga,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"hc-page-editor-placeholder",style:e.placeholderStyles},[t("div",{staticClass:"placeholder-wrap",style:e.wrapStyles},[t("div",{staticClass:"placeholder-content"},[t("img",{attrs:{src:e.img}}),t("p",{staticClass:"t-text-secondary"},[e._v("\n        从左侧组件面板中拖入布局到这里\n      ")])])])])}),[],!1,null,"128e4b3c",null)).exports,Viewarea:ba,Bem:za},data:function(){return{checked:!1,pointer:{},currentComponents:[],currentComponentFids:[],bemLoad:!0}},inject:["setPageEditorId","getPageUnSaved","isProjectPage"],directives:{pointer:ja},computed:{pageEditor:function(){return this.$store.getters.pageEditor},currentPageInfo:function(){var e,t;return null!==(e=this.pageEditor)&&void 0!==e&&e.pagesKV?null===(t=this.pageEditor)||void 0===t?void 0:t.pagesKV[this.pageEditor.pagesActiveName]:null},styles:function(){var e={},t=Object(S.nb)("editorPadding"),a="20px";return"array"===this.$util.getObjType(t)&&(a=t.map((function(e){return e+"px"})).join(" ")),e.padding=a,e["background-color"]=Object(S.nb)("mainContentBgColor"),e},pointerPadding:function(){var e={top:20,left:20},t=Object(S.nb)("editorPadding");if("array"===this.$util.getObjType(t))switch(t.length){case 1:e.top=t[0],e.left=t[0];break;case 2:case 3:e.top=t[0],e.left=t[1];break;case 4:e.top=t[0],e.left=t[3]}return e}},watch:{"pageEditor.pagesActiveName":function(){this.bemReload()}},created:function(){this.$store.commit("SET_DESINGER_INSTANCE",this)},methods:{checkPageAppearance:function(){var e,t=(null===(e=this.currentPageInfo)||void 0===e?void 0:e.currentAttrs)||{},a=Object.values(t).filter((function(e){return"appearance"===e.groupName}));return null==a||!a.length||!a.some((function(e){return e.hasOwnProperty("value")}))},bemReload:function(){var e=this;this.bemLoad=!1,setTimeout((function(){e.bemLoad=!0}),0)},tabRemove:function(){var e=this;this.getPageUnSaved()?this.$confirm("当前页面正在编辑，确认关闭当前页面?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.tabRemoveHandler()})).catch((function(){})):this.tabRemoveHandler()},tabRemoveHandler:function(){this.$store.dispatch("removePageByFid",this.currentPageInfo.fid),this.setPageEditorId(null)},tabClick:function(e){},getCurrentComponents:function(){if(this.currentPageInfo){this.currentComponents=[],this.currentComponentFids=[];var e=this.currentPageInfo.component;this.currentComponents=this.getChildren(e)}},setCurrentComponentFids:function(e){this.currentComponentFids.find((function(t){return t===e}))||this.currentComponentFids.push(e)},getParentData:function(e){var t,a=this.$refs.tree.getNode(e);return null==a||null===(t=a.parent)||void 0===t?void 0:t.data},getBlockData:function(e){},getChildren:function(e){var t=this,a=[];return e&&e.length?(e.forEach((function(e){var i,n,r=e.attributes,o=e.componentId||(null==r||null===(i=r.componentName)||void 0===i?void 0:i.value),l=e.name||(null==r||null===(n=r.componentType)||void 0===n?void 0:n.value),s=t.getChildren(e.children),c={value:e.fid,type:l,label:"[".concat(l,"] ")+(o||l)};t.setCurrentComponentFids(e.fid),s&&s.length&&(c.children=s),"block"===e.name&&(c.disabled=!0),a.push(c)})),a):a},handleSelect:function(e){this.$store.dispatch("updateActiveComponentByFid",null==e?void 0:e.fid)},handleQuick:function(e){var t=this.pageEditor.headerInstance;"add"!==e?"open"===e&&t&&t.handleOpenDialog():t&&t.handleCreate()}}},Wa=(a("8a02"),Object(l.a)(Ha,(function(){var e=this,t=e._self._c;return e.pageEditor.pagesActiveName?t("div",{staticClass:"hc-page-editor-designer"},[t("el-tabs",{staticClass:"hc-page-editor-designer-tabs",attrs:{type:"border-card",closable:!e.isProjectPage},on:{"tab-remove":e.tabRemove,"tab-click":e.tabClick},model:{value:e.pageEditor.pagesActiveName,callback:function(t){e.$set(e.pageEditor,"pagesActiveName",t)},expression:"pageEditor.pagesActiveName"}},e._l(e.pageEditor.pages,(function(a){return t("el-tab-pane",{directives:[{name:"pointer",rawName:"v-pointer"}],key:a.fid,staticClass:"hc-page-editor-designer-viewport",style:e.styles,attrs:{label:a.name,name:a.fid,"comp-name":"Page"},nativeOn:{click:function(t){return e.handleSelect(a)}}},[t("viewarea",{staticClass:"hc-page-editor-designer-viewarea",attrs:{data:a,runtime:!1,pageId:a.pageId}}),!a.component.length&&e.checkPageAppearance()?t("placeholder"):e._e(),e.bemLoad?t("bem"):e._e()],1)})),1),t("div",{staticClass:"hc-page-editor-designer-operation"})],1):t("div",{staticStyle:{padding:"15px","border-top":"1px solid #ddd"}},[t("el-alert",{attrs:{type:"warning",closable:!1}},[t("template",{slot:"title"},[e._v("\n      请先"),t("el-button",{staticStyle:{margin:"0  5px"},attrs:{type:"text"},on:{click:function(t){return e.handleQuick("add")}}},[e._v("新建")]),e._v("或"),t("el-button",{staticStyle:{margin:"0  5px"},attrs:{type:"text"},on:{click:function(t){return e.handleQuick("open")}}},[e._v("打开")]),e._v("一个页面\n    ")],1)],2)],1)}),[],!1,null,null,null)).exports;function Ja(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function Ya(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ja(Object(a),!0).forEach((function(t){Object(f.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ja(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var Za={name:"Attributes",components:{AttrItem:a("9f02").a},computed:Ya(Ya({},Object(He.a)(["currentPage"])),{},{activeComponentFid:function(){var e;return null==this||null===(e=this.currentPage)||void 0===e?void 0:e.activeComponentFid},themeStyles:function(){return{target:".el-collapse-item__header",style:{"background-color":Object(S.nb)("middleBackgroundColor"),"border-bottom-color":Object(S.nb)("borderColor")}}},pageEditor:function(){return this.$store.getters.pageEditor},currentPage:function(){var e=this.pageEditor.pagesActiveName;return this.pageEditor.pagesKV[e]},activeComponent:function(){return this.currentPage&&this.currentPage.componentKV[this.currentPage.activeComponentFid]},attrsPanel:function(){var e,t,a,i,n="",r=this.currentPage;if(r){var o=this.activeComponent;n=o&&o.name}return((null==r||null===(e=r.currentAttrs)||void 0===e||null===(t=e.customMethods)||void 0===t?void 0:t.attributes)||[]).forEach((function(e){e.customMethodsSetting.value&&(e.name.default="$_".concat(e.customMethodsSetting.editValue.functionName))})),((null==r||null===(a=r.currentAttrs)||void 0===a||null===(i=a.customVariable)||void 0===i?void 0:i.attributes)||[]).forEach((function(e){var t;null!==(t=e.isObject)&&void 0!==t&&t.value&&(e.objectAttr.visible=e.isObject.value)})),{attrsActiveNames:r&&r.attrsActiveNames,currentAttrs:r&&r.currentAttrs,attrGroup:this.pageEditor.attrGroups[n]}},groupAttrs:function(){var e=this;return function(t){var a=e.attrsPanel.currentAttrs,i=[];for(var n in a){var r=a[n];r.groupName===t&&!1!==r.visible&&i.push(r)}return i}}})},Qa=(a("3416"),Object(l.a)(Za,(function(){var e=this,t=e._self._c;return t("el-collapse",{directives:[{name:"theme",rawName:"v-theme",value:e.themeStyles,expression:"themeStyles"}],key:e.activeComponentFid,staticClass:"page-editor-attributes",model:{value:e.attrsPanel.attrsActiveNames,callback:function(t){e.$set(e.attrsPanel,"attrsActiveNames",t)},expression:"attrsPanel.attrsActiveNames"}},[e._l(e.attrsPanel.attrGroup,(function(a,i){return[!1!==a.visible&&e.groupAttrs(a.name).length>0?t("el-collapse-item",{key:i,attrs:{title:a.alias,name:a.name}},[e._l(e.attrsPanel.currentAttrs,(function(i){return[i.groupName===a.name&&!1!==i.visible?t("attr-item",{key:i.name,attrs:{attr:i}}):e._e()]}))],2):e._e()]}))],2)}),[],!1,null,null,null)).exports;function Xa(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function ei(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Xa(Object(a),!0).forEach((function(t){Object(f.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Xa(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var ti={1:null,2:1,3:4,4:null},ai={name:"PageEditor",components:{EditorHeader:Qt,ComponentList:la,Designer:Wa,Attributes:Qa,PageStructureTree:pa},data:function(){return{headerHeight:50,pageId:"",themeColor:"#fff",asideWidth:300,asideWidthL:308,isTransLation:!1,asideIconShow:!1,asideIconStyle:"border-bottom-right-radius:16px;border-top-right-radius:16px;",asideIcon:"el-icon-d-arrow-right",asideIconL:"el-icon-d-arrow-left",tokenActiveTimer:null,activeSideType:1,activeCompTabName:"widget"}},computed:ei(ei({},Object(He.a)(["themeConstColor"])),{},{headerStyles:function(){var e=Object(S.nb)("paddingMedium");return{"padding-left":e,"padding-right":e,"background-color":Object(S.nb)("headerBgColor")}}}),created:function(){this.init(),this.$store.dispatch("resetLazyLoad"),document.body.ondrop=function(e){try{e.stopPropagation(),e.preventDefault()}catch(e){}}},mounted:function(){var e=this;setTimeout((function(){e.getThemColor(),e.asideIconStyle="background:".concat(e.themeColor),e.asideIconShow=!0,e.dragControllerDiv(),e.dragControllerDivL()}),500)},beforeRouteUpdate:function(e,t,a){var i=this;setTimeout((function(){i.setTitle()}),10),a()},destroyed:function(){clearInterval(this.tokenActiveTimer),this.tokenActiveTimer=null},provide:function(){var e=Object(y.h)(window.location.href,"assetsId"),t=Object(y.h)(window.location.href,"projectId"),a=Object(y.h)(window.location.href,"isProjectPage"),i=Object(y.h)(window.location.href,"templateId"),n=Object(y.h)(window.location.href,"templateIdentifier"),r=Object(y.h)(window.location.href,"sdc");return this.$store.dispatch("updateIsSDCEditor",r),{setPageEditorId:this.headSetPageId,getPageUnSaved:this.getUnSaved,targetTypeByPageType:ti,isProjectPage:e&&t||a,isTemplatePage:i&&n,isSDC:"1"===r||"true"===r}},methods:{init:function(){this.setTitle(),this.initTokenActiveTimer()},handleCompTabClick:function(){},initTokenActiveTimer:function(){var e=this,t=(this.$store.getters.loginData||{}).expires_in;this.keepTokenActive(),this.tokenActiveTimer=setInterval((function(){e.keepTokenActive()}),t/2*1e3)},keepTokenActive:function(){this.$util.request({url:"/api/auth/certification/permissions",method:"get",meta:{hideMessage:!0}}).then((function(){}))},setTitle:function(){document.title=this.$route.name},setPageId:function(){this.pageId=this.$route.query.pageId},headSetPageId:function(e){this.$refs.editorHeader&&this.$refs.editorHeader.setPageId(e)},getUnSaved:function(){return this.$refs.editorHeader&&this.$refs.editorHeader.getUnSaved()},getThemColor:function(){var e=window.$VUE_ROOT.$store.getters.themeConstColor;this.themeColor=e.primary},changeAsideDisplay:function(){var e=this;this.isTransLation=!0,setTimeout((function(){e.isTransLation=!1,Ft.a.$emit("bemSelectedRefresh"),Ft.a.$emit("bemSetPointerAll")}),400),this.asideWidth<=0?(this.asideWidth=240,this.asideIcon="el-icon-d-arrow-right"):(this.asideWidth=0,this.asideIcon="el-icon-d-arrow-left")},changeLAsideDisplay:function(){var e=this;this.isTransLation=!0,setTimeout((function(){e.isTransLation=!1,Ft.a.$emit("bemSelectedRefresh"),Ft.a.$emit("bemSetPointerAll")}),400),this.asideWidthL<=0?(this.asideWidthL=308,this.asideIconL="el-icon-d-arrow-left"):(this.asideWidthL=0,this.asideIconL="el-icon-d-arrow-right")},dragControllerDiv:function(){var e=this,t=document.getElementById("resizeAttributes");t.onmousemove=function(e){t.style.background="#ddd"},t.onmouseout=function(e){t.style.background=""},t.onmousedown=function(a){t.style.background="#ddd";var i=a.clientX;return t.left=t.offsetLeft,document.onmousemove=function(t){var a=t.clientX,n=a-i;return i=a,e.asideWidth-=n,e.asideWidth>440?(e.asideWidth=440,!1):e.asideWidth<240?(e.asideWidth=240,!1):void 0},document.onmouseup=function(){t.style.background="",Ft.a.$emit("asideWidth",e.asideWidth),document.onmousemove=null,document.onmouseup=null},!1}},dragControllerDivL:function(){var e=this,t=document.getElementById("resizeAsideIconL");t.onmousemove=function(e){t.style.background="#ddd"},t.onmouseout=function(e){t.style.background=""},t.onmousedown=function(a){t.style.background="#ddd";var i=a.clientX;return t.left=t.offsetLeft,document.onmousemove=function(t){var a=t.clientX,n=a-i;return i=a,e.asideWidthL+=n,e.asideWidthL>440?(e.asideWidthL=440,!1):e.asideWidthL<240?(e.asideWidthL=240,!1):void 0},document.onmouseup=function(){t.style.background="",Ft.a.$emit("asideWidth",e.asideWidth),document.onmousemove=null,document.onmouseup=null},!1}},setActiveType:function(e){this.activeSideType=e}}},ii=[{name:"page-editor",openType:"root",routes:[{path:"/page-editor",name:"页面编辑器",component:(a("e4b1"),a("8175"),a("ff36"),Object(l.a)(ai,(function(){var e=this,t=e._self._c;return t("el-container",{staticClass:"page-editor"},[t("el-header",{style:e.headerStyles,attrs:{height:e.headerHeight+"px"}},[t("editor-header",{ref:"editorHeader",attrs:{height:e.headerHeight}})],1),t("el-container",{staticClass:"page-editor-container"},[t("el-aside",{class:["side-bar","col-left",{animateTrans:e.isTransLation}],style:{width:e.asideWidthL+42+"px"}},[t("div",{staticClass:"left-tab-container"},[t("div",{class:["left-tab"],style:{color:1===e.activeSideType?e.themeConstColor.primary:""},on:{click:function(t){return e.setActiveType(1)}}},[t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"组件库",placement:"right","open-delay":"500","popper-class":"opacityStyle"}},[t("i",{staticClass:"left-tab-icon icon-kuaijiecaidan"})])],1),t("div",{class:["left-tab"],style:{color:2===e.activeSideType?e.themeConstColor.primary:""},on:{click:function(t){return e.setActiveType(2)}}},[t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"大纲树",placement:"right","open-delay":"500","popper-class":"opacityStyle"}},[t("i",{staticClass:"left-tab-icon icon-dagangshu"})])],1)]),t("div",{staticClass:"left-content-container",staticStyle:{display:"inline-block",height:"100%",width:"calc(100% - 54px)"}},[1===e.activeSideType?t("el-tabs",{staticClass:"left-content-container-tabs",on:{"tab-click":e.handleCompTabClick},model:{value:e.activeCompTabName,callback:function(t){e.activeCompTabName=t},expression:"activeCompTabName"}},[t("el-tab-pane",{attrs:{label:"原子组件",name:"widget"}},[t("component-list")],1),t("el-tab-pane",{attrs:{label:"二开组件",name:"sdc"}},[t("component-list",{attrs:{type:"sdc"}})],1)],1):e._e(),2===e.activeSideType?t("page-structure-tree",{attrs:{asideWidth:e.asideWidthL}}):e._e()],1)]),t("div",{class:["resizeAreaL",{animateTrans:e.isTransLation}],style:{left:e.asideWidthL+42+4+"px"}},[e.asideIconShow?t("div",{staticClass:"asideIcon asideIconL",style:e.asideIconStyle,on:{click:e.changeLAsideDisplay}},[t("i",{class:e.asideIconL})]):e._e(),t("div",{attrs:{id:"resizeAsideIconL"}})]),t("el-main",{class:["col-main",{animateTrans:e.isTransLation}],style:{left:e.asideWidthL+42+"px",right:e.asideWidth+16+"px"}},[t("designer")],1),t("div",{class:["resizeAreaR",{animateTrans:e.isTransLation}],style:{right:e.asideWidth+2+"px"}},[e.asideIconShow?t("div",{staticClass:"asideIcon",style:e.asideIconStyle,on:{click:e.changeAsideDisplay}},[t("i",{class:e.asideIcon})]):e._e(),t("div",{attrs:{id:"resizeAttributes"}})]),t("el-aside",{class:["side-bar","col-right",{animateTrans:e.isTransLation}],style:{width:e.asideWidth+"px"}},[t("attributes")],1)],1)],1)}),[],!1,null,"0e7a16af",null)).exports,meta:{keepAlive:!0,isTab:!1,isAuth:!0}}]}],ni=a("a8db"),ri=[{name:"4:20",cols:[4,20]},{name:"8:8:8",cols:[8,8,8]},{name:"4:16:4",cols:[4,16,4]},{name:"12:12",cols:[12,12]},{name:"6:6:6:6",cols:[6,6,6,6]}],oi=["sourceId","SDCName","replaceFn"],li=["isSDC"],si=["isSDC"];function ci(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function ui(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ci(Object(a),!0).forEach((function(t){Object(f.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ci(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var di=S.f,pi={router:ii,store:{name:"pageEditor",state:{dataLinkFilterTypes:[],SDCComponentsCache:{},isSDCEditor:!1,innerComponents:[st],headerInstance:null,designerInstance:null,componentsActiveNames:[],localComponent:{},components:[],SDCComponents:[],originComponents:[],componentsKV:{},componentsUrl:"",disableComponents:[],pagesActiveName:"",pages:[],pagesKV:{},othersPage:{},attrGroups:{},historyOperationList:[],historyOperationIndex:-1,historyOperationsMax:50,pageContentHeight:0,customMethods:[],bemPointerAll:!1,measureIndicatorExpandsDicts:[],measureIndicatorDimensionDictOptions:[],measureIndicatorParentIdDictOptions:[],measureIndicatorProjectDictOptions:[],measureIndicatorDictOptions:[],scriptsTree:[],eventEditingComponentFid:"",tips:{},linkTips:{indicator:{},api:{},assets:{},rtdata:{},object:{},sql:{}},attrTips:{commonTips:{}},lazyLoad:{status:{measureIndicatorExpandsDicts:1,measureIndicatorDimensionDictOptions:1,measureIndicatorParentIdDictOptions:1,measureIndicatorProjectDictOptions:1,measureIndicatorDictOptions:1,scriptsTree:1,customIconGroups:1,SDCComponents:1,dataLinkFilterTypes:1},func:{measureIndicatorExpandsDicts:"initMeasDicts",measureIndicatorDimensionDictOptions:"getTimeDimensionDicts",measureIndicatorParentIdDictOptions:"getOrgsDicts",measureIndicatorProjectDictOptions:"getProjectDicts",measureIndicatorDictOptions:"initDictOptions",scriptsTree:"getScripts",customIconGroups:"initCustomIconGroups",SDCComponents:"initSDCComponents",dataLinkFilterTypes:"initDataLinkFilterTypes"}},customIconGroups:[],methodParamTypes:["static","String","date-picker","select","switch","Boolean","Number","Array","Object","cascader","treeselect","virtualSelect"],pagesKVLoaded:{}},getters:{pageEditor:function(e){return new Proxy(e,{get:function(t,a,i){return["scriptsTree","customIconGroups","SDCComponents","dataLinkFilterTypes"].includes(a)&&t.lazyLoad.status[a]&&(window.$VUE_ROOT.$store.dispatch(e.lazyLoad.func[a]),window.$VUE_ROOT.$store.commit("NOT_LAZY_LOAD_RELOAD",a)),t[a]}})},pageEditorOf:function(e){return function(t){return e.othersPage&&e.othersPage[t]}},getLinkTipsOf:function(e){return function(t){return e.linkTips&&e.linkTips[t]}},attrTips:function(e){return function(t){var a=t.fullName.replace(/\./g,"-"),i=t.componentType,n=Object.assign({},e.attrTips.commonTips,e.attrTips[i]);return n&&n[a]}},getCount:function(e){return function(t){var a=e.pagesKV[e.pagesActiveName],i=a.countKV;if(!i.hasOwnProperty(t))return 0;i[t]++;var n=t+"-"+i[t],r=a.componentNames;return r[n]?(i[t]++,n=t+"-"+i[t]):r[n]=!0,"".concat(e.isSDCEditor?"#T-":"").concat(n)}},getTempCount:function(e){return function(t){return function(a){return"".concat(e.isSDCEditor?"#T-":"").concat(t||a)}}},currentPage:function(e){return e.pagesKV[e.pagesActiveName]},customMethods:function(e){return e.customMethods},bemPointerAll:function(e){return e.bemPointerAll},measureOptions:function(e){var t={measureIndicatorExpandsDicts:e.measureIndicatorExpandsDicts,measureIndicatorDimensionDictOptions:e.measureIndicatorDimensionDictOptions,measureIndicatorParentIdDictOptions:e.measureIndicatorParentIdDictOptions,measureIndicatorProjectDictOptions:e.measureIndicatorProjectDictOptions,measureIndicatorDictOptions:e.measureIndicatorDictOptions};return new Proxy(t,{get:function(t,a,i){return e.lazyLoad.status[a]&&(window.$VUE_ROOT.$store.dispatch(e.lazyLoad.func[a]),window.$VUE_ROOT.$store.commit("NOT_LAZY_LOAD_RELOAD",a)),t[a]}})},measureOptionsLoaded:function(e){return{measureIndicatorExpandsDicts:!e.lazyLoad.status.measureIndicatorExpandsDicts,measureIndicatorDimensionDictOptions:!e.lazyLoad.status.measureIndicatorDimensionDictOptions,measureIndicatorParentIdDictOptions:!e.lazyLoad.status.measureIndicatorParentIdDictOptions,measureIndicatorProjectDictOptions:!e.lazyLoad.status.measureIndicatorProjectDictOptions,measureIndicatorDictOptions:e.measureIndicatorDictOptions}},getMethodParamTypes:function(e){return e.methodParamTypes}},actions:{fetchSDCComponent:function(e,t){return e.commit,e.state,e.dispatch,e.getters,Object(V.a)(x.a.mark((function e(){var a,i;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={pageIds:[],pagePaths:[]},i=[new Promise((function(e,a){var i;if(null!=t&&null!==(i=t.pagePaths)&&void 0!==i&&i.length){var n={url:"/api/page/pages/query-last-publish-page",method:"post",data:{pagePaths:t.pagePaths}};window.$common.$util.request(n).then((function(t){e({isPath:!0,res:t})})).catch((function(){e({isPath:!0,res:[]})}))}else e({isPath:!0,res:[]})})),new Promise((function(e,a){var i;if(null!=t&&null!==(i=t.pageIds)&&void 0!==i&&i.length){var n={url:"/api/page/pages/query-last-publish-page",method:"post",data:{pageIds:t.pageIds}};window.$common.$util.request(n).then((function(t){e({res:t})})).catch((function(){e({res:[]})}))}else e({res:[]})}))],e.next=4,Promise.all(i).then((function(e){e.forEach((function(e){e.isPath?a.pagePaths=e.res:a.pageIds=e.res}))}));case 4:return e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})))()},getSDCComponent:function(e,t){var a=e.commit,i=e.state,n=e.dispatch,r=e.getters;return Object(V.a)(x.a.mark((function e(){var o,l,s,c,u,d,p,h,f,m,v,b,g,_;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=t.sourceId,l=t.SDCName,s=t.replaceFn,c=Object(ni.a)(t,oi),d={},p=function(e){var t=e.info,o=e.componentData,l=i.pagesKV[i.pagesActiveName];u=null!=o&&o.length?Object(S.W)(o,(function(e,o){var s,u,p,h,f,m,v,b;if(S.c.includes(e.name)&&e.attributes.some((function(e){return"keepValue"===e.name&&!(e.visible&&e.value)}))){var g=e.attributes.findIndex((function(e){return"value"===e.name&&!(e.visible&&e.value)}));e.attributes.splice(g,1)}var y=!o;y&&(o=c);var _,C=("block"===(null===(s=o)||void 0===s?void 0:s.name)||["dataContainer"].includes(null===(u=o)||void 0===u?void 0:u.groupName)?null===(p=o)||void 0===p?void 0:p.componentType:null===(h=o)||void 0===h?void 0:h.name)||(null===(f=o)||void 0===f?void 0:f.componentType),O=e.key||e.name||e.componentType,T=i.componentsKV[O],V=i.attrGroups[O];if(!T)return e.pageId=null==l?void 0:l.pageId,e.pageVersion=null==l?void 0:l.pageVersion,e.parentFid=null===(_=o)||void 0===_?void 0:_.fid,e;["dataContainer"].includes(T.groupName)&&(T.componentType=C);var w,P,x,j=Object(S.Q)(T,r.getCount,V,e);return V||a("SET_ATTR_GROUPS",{componentType:O,data:j.attrGroup}),a("SET_COMPONENT_NAMES",e.componentId),j.converted=Object(S.A)(j.converted,C),j.converted.pageId=null==l?void 0:l.pageId,j.converted.pageVersion=null==l?void 0:l.pageVersion,j.converted.parentFid=null===(m=o)||void 0===m?void 0:m.fid,"ContainerSDC"===O?(w=Object(S.xb)(j.converted,ui(ui({},e),{},{attributes:e.attributes.filter((function(e){return!e.name.startsWith("$V_")}))})),j.converted=Object(S.y)(j.converted,!0),w=Object(S.xb)(j.converted,ui(ui({},e),{},{attributes:e.attributes.filter((function(e){return e.name.startsWith("$V_")}))}))):w=Object(S.xb)(j.converted,e),"ContainerSDC"===O&&null!==(v=w.attributes)&&void 0!==v&&null!==(b=v.importsManager)&&void 0!==b&&b.value&&(d[w.fid]=null===(P=w.attributes)||void 0===P||null===(x=P.importsManager)||void 0===x?void 0:x.value),y&&(w.attributes.sourceId.value=t.sourceId,w.attributes.sourceName.value=t.sourceName,w.attributes.sourcePath.value=t.sourcePath,w.attributes.sourceVersion.value=t.sourceVersion,w.attributes.uuid.value=t.uuid),n("setCustomGroupNamesByAttrs",{fid:e.fid,data:w.attributes}),w}))[0]:{},Object(S.T)([u],i.disableComponents,(function(e){n("updateComponentKV",{fid:e.fid,data:e})}))},s=s||S.N,!i.SDCComponentsCache[o]){e.next=9;break}h=s(i.SDCComponentsCache[o]),p(h),e.next=14;break;case 9:return e.next=11,n("fetchSDCComponent",{pageIds:[o]});case 11:m=e.sent,(v=null==m?void 0:m.pageIds).length&&null!==(f=v[0])&&void 0!==f&&f.editContent&&(b=v[0],(g=Object(y.j)(b.editContent)||{}).SDCName=l,g.sourceId=b.id,g.sourceName=b.name,g.sourcePath=b.path,g.sourceVersion=b.version,i.SDCComponentsCache[o]=g,_=s(g),p(_));case 14:return u.importAttrs=d,e.abrupt("return",u);case 16:case"end":return e.stop()}}),e)})))()},initDataLinkFilterTypes:function(e,t){var a=e.commit,i=e.state;if(i.lazyLoad.status.dataLinkFilterTypes){var n={url:"/api/compdata/operators",method:"post",data:{types:t||[1]}};window.$common.$util.request(n).then((function(e){null!=e&&e.length&&(i.dataLinkFilterTypes=e,a("NOT_LAZY_LOAD_RELOAD","dataLinkFilterTypes"))}))}},initSDCComponents:function(e,t){var a=e.commit,i=e.state,n=e.dispatch;return Object(V.a)(x.a.mark((function e(){var t,r,o,l,s,c,u;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u=function(e){if(Array.isArray(e)){var t=[],r={};e.forEach((function(e){r[e.parentId]||(r[e.parentId]={children:[],groupAlias:e.parentPageName,groupName:"SDC_"+e.parentId,order:1},t.push(r[e.parentId]),a("SET_COMPONENTS_ACTIVE_NAMES",r[e.parentId].groupName));var i={alias:e.name,attributes:[],author:e.createUser,children:[],description:"",fictitious:{},groupAlias:r[e.parentId].groupAlias,groupName:"SDC_"+e.parentId,name:"ContainerSDC",key:e.componentName||e.id,sourceId:e.id,sourcePath:e.path,order:1e4,type:"vue",icon:e.icon,version:e.version};r[e.parentId].children.push(i),a("SET_COMPONENTS_KV",i),n("initCount",i.key)})),i.SDCComponents=t,a("NOT_LAZY_LOAD_RELOAD","SDCComponents")}},c=function(e,t){return new Promise((function(a){var i={url:"/api/page/pages?queryEditContent=0&$filter=".concat(e,"&pagination=0")+(t?"&pageType=".concat(t):""),method:"get"};window.$common.$util.request(i).then((function(e){a(e)})).catch((function(e){a([])}))}))},i.lazyLoad.status.SDCComponents){e.next=5;break}return e.abrupt("return");case 5:return t=Object(y.h)(window.location.href,"projectIdentifier"),r=Object(y.h)(window.location.href),o=[],t?o.push(c("pageType eq 6,publishStatus eq 1,status ne 0,projectIdentifier in ".concat(t,"::COMMON"),"6")):!r.pageId&&r.templateId?o.push(c("pageType eq 6,publishStatus eq 1,status ne 0,projectIdentifier eq COMMON","6")):o.push(c("pageType eq 6,publishStatus eq 1,status ne 0","6")),e.next=11,Promise.all(o);case 11:l=e.sent,s=[],l.forEach((function(e){s.push.apply(s,Object(d.a)(e))})),u(s);case 16:case"end":return e.stop()}}),e)})))()},initCustomIconGroups:function(e,t){var a=e.commit,i=e.state,n=e.getters;if(i.lazyLoad.status.customIconGroups){var r=n.portalInfo,o=null!=r&&r.isManagement&&"iot"!==(null==r?void 0:r.nameEn)?"COMMON":"IOT";window.$common.$util.request({url:"/api/model/profiles?$filter=identifier eq ICON_LIB",method:"get"}).then((function(e){var t;if(null!==(t=e.result)&&void 0!==t&&t.length){var n={url:"/api/model/instances?objectType=ICON_GROUP&$filter=status eq 1&$orderBy= updateTime asc&$page=1&$pageSize=9999",method:"get",params:{projectIdentifier:o}};window.$common.$util.request(n).then((function(e){if(i.customIconGroups=(e.result||[]).map((function(e){return ui(ui({},e),{},{label:e.name,custom:!0})})),i.customIconGroups.length){var t={url:"/api/model/instances?objectType=ICON_LIB&$filter=status eq 1&$orderBy= updateTime asc&$page=1&$pageSize=9999",method:"get"};window.$common.$util.request(t).then((function(e){i.customIconGroups.forEach((function(t){t.list=[],(e.result||[]).forEach((function(e){e.parentId===t.id&&t.list.push(ui(ui({},e),{},{name:e.url,alias:e.name}))}))})),a("NOT_LAZY_LOAD_RELOAD","customIconGroups")}))}}))}}))}},initDictOptions:function(e,t){var a=e.commit,i=e.state;if(i.lazyLoad.status.measureIndicatorDictOptions||null!=t&&t.forceUpdate){var n=[new Promise((function(e,t){var a=Object(y.h)(window.location.href,"projectIdentifier"),i={url:"/api/model/instances?objectType=COM_CODEDICTIONARY&$filter=pathName leftlike /IOT/INDICATOR_EXPAND/&projectIdentifier=COMMON".concat(a?"::".concat(a):"","&pagination=0"),method:"get"};window.$common.$util.request(i).then((function(t){var a=t.filter((function(e){return/^\/IOT\/INDICATOR_EXPAND\/\w+$/.test(e.pathName)})).map((function(e){return{dictIdentifier:e.identifier,dictKey:e.value,dictKeyName:e.name,options:t.filter((function(t){return t.parentId===e.id})),propertyName:"expands",displayName:"expands."+e.value}}));e(a)})).catch((function(t){e([])}))}))];Promise.all(n).then((function(e){i.measureIndicatorDictOptions=(e||[]).reduce((function(e,t){return[].concat(Object(d.a)(e),Object(d.a)(t))}),[]),a("NOT_LAZY_LOAD_RELOAD","measureIndicatorDictOptions")})).finally((function(){null!=t&&t.forceUpdate&&"function"==typeof t.forceUpdate&&t.forceUpdate()}))}},initMeasDicts:function(e,t){var a=e.commit,i=e.state;if(i.lazyLoad.status.measureIndicatorExpandsDicts||null!=t&&t.forceUpdate){window.$common.$util.request({url:"/api/model/profiles?$filter=identifier eq MEAS_INDICATOR",method:"get"}).then((function(e){var n,r=null==e||null===(n=e.result[0])||void 0===n?void 0:n.id,o={url:"/api/model/profiles/".concat(r,"/properties?$filter=status eq 1&$pagination=0&inherit=custom&$orderBy=createTime desc"),method:"get"};window.$common.$util.request(o).then((function(e){var n=e.find((function(e){return"dictenum"===e.dataType.type}));if(n){var r=n.dataType.expands.dicts,o=n.propertyName,l=r.map((function(e){return new Promise((function(t,a){var i={url:"/api/model/instances?objectType=COM_CODEDICTIONARY&$filter=identifier eq ".concat(e.dictIdentifier,"&queryChild=1&queryMode=simple"),method:"get"};window.$common.$util.request(i).then((function(a){var i,n=null==a||null===(i=a.result[0])||void 0===i?void 0:i.id,r={url:"/api/model/instances?objectType=COM_CODEDICTIONARY&parentId=".concat(n,"&queryChild=1&queryMode=simple"),method:"get"};window.$common.$util.request(r).then((function(a){t(ui(ui({},e),{},{options:a.result,propertyName:o,displayName:o+"."+e.dictKey}))}))}))}))}));Promise.all(l).then((function(e){i.measureIndicatorExpandsDicts=e,a("NOT_LAZY_LOAD_RELOAD","measureIndicatorExpandsDicts")})).finally((function(){null!=t&&t.forceUpdate&&"function"==typeof t.forceUpdate&&t.forceUpdate()}))}}))}))}},getTimeDimensionDicts:function(e){var t=e.commit,a=e.state;if(a.lazyLoad.status.measureIndicatorDimensionDictOptions){window.$common.$util.request({url:"/api/model/instances?objectType=COM_CODEDICTIONARY&pagination=0&$filter=identifier eq SYS_DICT_DIMENSION_TIME&queryMode=simple&$orderBy=creatime asc&queryChild=1",method:"get"}).then((function(e){a.measureIndicatorDimensionDictOptions=e,t("NOT_LAZY_LOAD_RELOAD","measureIndicatorDimensionDictOptions")}))}},getOrgsDicts:function(e){var t=e.commit,a=e.state,i=e.getters;if(a.lazyLoad.status.measureIndicatorParentIdDictOptions){var n,r=i.portalInfo;r&&(n=r.extraObjectType);var o={url:"/api/model/instances?objectType=HR_COMPANY,HR_DEPARTMENT,SYS_ASSET,SYS_EQUIPMENT".concat(n?",".concat(n):"","&queryMode=simple&pagination=0&lazyLoad=0&$orderBy=createTime desc"),method:"get"};window.$common.$util.request(o).then((function(e){var i=Object(S.vb)(e,"id","parentId","children","-1"),n=Object(S.z)(Object(y.e)(i));a.measureIndicatorParentIdDictOptions=[{id:"-1",parentId:"-1",label:"/",value:{id:"-1"},children:n}],t("NOT_LAZY_LOAD_RELOAD","measureIndicatorParentIdDictOptions")}))}},getProjectDicts:function(e){var t=e.commit,a=e.state;if(e.getters,a.lazyLoad.status.measureIndicatorProjectDictOptions){window.$common.$util.request({url:"/api/model/instances?objectType=MEAS_INDICATORITEM&queryMode=simple&pagination=0&parentId=-1&lazyLoad=0",method:"get"}).then((function(e){var i=Object(S.vb)(e,"id","parentId","children","-1"),n=Object(S.z)(Object(y.e)(i));a.measureIndicatorProjectDictOptions=[{id:"-1",parentId:"-1",label:"/",value:{id:"-1"},children:n}],t("NOT_LAZY_LOAD_RELOAD","measureIndicatorProjectDictOptions")}))}},getScripts:function(e){var t=e.commit,a=e.state;if(a.lazyLoad.status.scriptsTree){window.$common.$util.request({url:"/api/sqldata/scripts?$pageSize=1000000000",method:"get"}).then((function(e){var i=e.result.map((function(e){return ui(ui({},e),{},{disabled:1===e.scriptType})})),n=Object(S.vb)(i,"id","parentId","children","0"),r=Object(S.z)(Object(y.e)(n));a.scriptsTree=r,t("NOT_LAZY_LOAD_RELOAD","scriptsTree")}))}},convertComponents:function(e,t){var a=e.commit,i=(e.state,[]),n={},r=t.filter((function(e){return"Grid"===e.name})),o=ri.map((function(e,t){return ui(ui({},Object(y.e)(r[0])),{},{alias:e.name,groupName:"quickLayout",groupAlias:"快速布局",key:"grid-".concat(t+1),order:1e4+t,fictitious:{cols:e.cols},children:[]})}));[].concat(Object(d.a)(o),Object(d.a)(t)).forEach((function(e){var t={};if(n[e.groupName])n[e.groupName].children.push(e);else{var r=S.E.find((function(t){return t.name===e.groupName}));t={groupName:e.groupName,groupAlias:r?r.alias:e.groupAlias,order:r?r.order:e.order,children:[e]},i.push(t),n[e.groupName]=t,a("SET_COMPONENTS_ACTIVE_NAMES",e.groupName)}a("SET_COMPONENTS_KV",e)})),i.sort((function(e,t){return e.order-t.order})),a("SET_COMPONENTS",i)},updateCommonTipsStatus:function(e){var t=e.state;Object(S.V)("common-attribute","commonTips",t)},setCurrentTipsStatus:function(e,t){var a,i=e.state,n=t.name;1!=(null===(a=i.attrTips[n])||void 0===a?void 0:a.status)&&Object(S.V)("".concat(n,"-attribute"),n,i)},getCurrentTips:function(e,t){var a,i=e.state,n=t.fullName.replace(/\./g,"-"),r=t.componentType;if(null===(a=i.attrTips[r][n])||void 0===a||!a.value){var o=["".concat(r,"-").concat(n),n],l={url:"/api/model/instances?objectType=SNIPPET&$pagination=0&$filter=identifier eq ".concat(o.join("::")),method:"get"};window.$common.$util.request(l).then((function(e){var t,a=i.attrTips[r][n];window.$VUE_ROOT.$set(i.attrTips[a?r:"commonTips"][n],"value",Object(S.Gb)(null===(t=e.result[0])||void 0===t?void 0:t.snippetContent))}))}},updateCountKV:function(e,t){var a=e.dispatch,i=e.state;for(var n in a("addCount","PageTab"),i.componentsKV)a("addCount",n);if(t)for(var r in t){i.pagesKV[i.pagesActiveName].countKV[r]=t[r]}},addCount:function(e,t){var a=e.state,i=a.pagesKV[a.pagesActiveName].countKV;i.hasOwnProperty(t)?i[t]++:i[t]=0},initCount:function(e,t){var a=e.state,i=a.pagesKV[a.pagesActiveName],n=null==i?void 0:i.countKV;n&&!n.hasOwnProperty(t)&&(n[t]=0)},removeOtherPage:function(e,t){var a=e.commit;e.state,a("REMOVE_OTHER_PAGE",t),Object(S.Ab)("events")},createOtherPage:function(e,t){var a=e.commit,i=e.getters,n=e.state,r=e.dispatch,o=t.pageInfo,l=t.componentFid;if(l){n.othersPage[l]||(n.othersPage[l]={pagesActiveName:"",pages:[],pagesKV:{},customMethods:[],attrGroups:{},componentsKV:{}});var s=n.othersPage[l];s.pages=[];var c=Object(S.ob)(),u=Object(S.ob)(),d={fid:c,name:"未命名",id:"",pageId:"",path:"",title:"",parentId:"",pageType:2,pageVersion:"",component:[],componentKV:{},componentPageKV:{},page:{fid:u,name:"Page",attributes:{}},countKV:{},componentNames:{},componentInstance:{},componentNameFid:{},customGroupNames:{},activeComponentFid:"",attrsActiveNames:[],currentAttrs:{},unSaved:!1},p=s.pages.findIndex((function(e){return e.id===d.id}));if(-1===p){s.pages.push(d),s.pagesKV[c]=d,s.pagesActiveName=c;var h=Object(y.j)(o&&o.pageData)||{};d.pageVersion=h.version,s.customMethods=h.customMethods||[],o&&(d.name=o.name,d.id=o.id,d.pageId=o.id,d.path=o.path,d.title=o.title,d.permissionId=o.permissionId,d.parentId=o.parentId,d.pageType=o.pageType),d.component=Object(S.W)(h.component,(function(e,t){var o=("block"===(null==t?void 0:t.name)||["dataContainer"].includes(null==t?void 0:t.groupName)?null==t?void 0:t.componentType:null==t?void 0:t.name)||(null==t?void 0:t.componentType),c=e.key||e.name||e.componentType,u=n.componentsKV[c],p=s.attrGroups[c];if(!u)return e.pageId=d.pageId,e.pageVersion=d.pageVersion,e.parentFid=null==t?void 0:t.fid,e;["dataContainer"].includes(u.groupName)&&(u.componentType=o);var h=Object(S.Q)(u,i.getCount,p,e);p||a("SET_OTHERS_PAGE_ATTR_GROUPS",{componentType:c,data:h.attrGroup,othersPageId:l}),a("SET_OTHERS_PAGE_COMPONENT_NAMES",{componentId:e.componentId,othersPageId:l}),h.converted=Object(S.A)(h.converted,o),h.converted.pageId=d.pageId,h.converted.pageVersion=d.pageVersion,h.converted.parentFid=null==t?void 0:t.fid;var f=Object(S.xb)(h.converted,e);return r("setOthersPageCustomGroupNamesByAttrs",{fid:e.fid,data:f.attributes,othersPageId:l}),f}));var f=s.attrGroups.Page,m=Object(S.U)(h.page,f);for(var v in h.page&&(u=h.page.fid||u,d.page.fid=u,d.page.pageId=d.pageId),d.page.attributes=m.converted,d.page.attributes.pageName.value=d.name,d.page.attributes.pageTitle.value=d.title,d.page.attributes.permissionId.value=d.permissionId,f||a("SET_OTHERS_PAGE_ATTR_GROUPS",{componentType:"Page",data:m.attrGroup,othersPageId:l}),r("setOthersPageCustomGroupNamesByAttrs",{fid:u,data:m.converted,othersPageId:l}),d.componentKV=Object(S.T)(d.component,n.disableComponents),d.componentKV[u]=d.page,d.componentKV)d.componentPageKV["".concat(d.pageId,"_").concat(v)]=d.componentKV[v];Object(S.Ab)("events")}else s.pages[p]=d}},createPage:function(e,t){var a=e.commit,i=e.getters,n=e.state,r=e.dispatch,o=t.isSDC,l=Object(ni.a)(t,li);l=Object.keys(l||{}).length?l:void 0,r("removePageAll");var s=Object(S.ob)(),c=Object(S.ob)(),u={fid:s,name:"未命名",id:"",pageId:"",path:"",title:"",parentId:"",pageType:o?6:2,pageVersion:"",component:[],componentKV:{},page:{fid:c,name:"Page",attributes:{}},countKV:{},componentNames:{},componentInstance:{},componentNameFid:{},customGroupNames:{},activeComponentFid:"",attrsActiveNames:[],currentAttrs:{},unSaved:!1};a("SET_PAGES",u),a("SET_PAGES_KV",{fid:s,data:u}),a("SET_PAGES_ACTIVE_NAME",s);var d=Object(y.j)(l&&l.pageData)||{},p=Bt.toEdit(d);u.pageVersion=p.version,a("SET_CUSTOM_METHODS",p.customMethods||[]),l&&(u.name=l.name,u.id=l.id,u.pageId=l.id,u.path=l.path,u.title=l.title,u.permissionId=l.permissionId,u.parentId=l.parentId,u.pageType=l.pageType),r("updateCountKV",p.countKV),r("updateCommonTipsStatus");var h={},f={};u.component=Object(S.W)(p.component,(function(e,t){var s,c,d,p,m=("block"===(null==t?void 0:t.name)||["dataContainer"].includes(null==t?void 0:t.groupName)?null==t?void 0:t.componentType:null==t?void 0:t.name)||(null==t?void 0:t.componentType),v=e.key||e.name||e.componentType,b=Object(y.e)(n.componentsKV[v]),g=n.attrGroups[v];if(!o||t&&"Page"!==t.name||(p=!0),!b)return e.pageId=u.pageId,e.pageVersion=u.pageVersion,e.parentFid=null==t?void 0:t.fid,e;["dataContainer"].includes(b.groupName)&&(b.componentType=m),p&&(b.isCurrentTopSDC=p);var _,C,O,T=Object(S.Q)(b,p?i.getTempCount(l.componentName):i.getCount,g,e);if(g||a("SET_ATTR_GROUPS",{componentType:v,data:T.attrGroup}),a("SET_COMPONENT_NAMES",e.componentId),p&&(T.converted.isCurrentTopSDC=p),T.converted=Object(S.A)(T.converted,m),T.converted.pageId=u.pageId,T.converted.pageVersion=u.pageVersion,T.converted.parentFid=null==t?void 0:t.fid,p||"ContainerSDC"!==v?_=Object(S.xb)(T.converted,e):(_=Object(S.xb)(T.converted,ui(ui({},e),{},{attributes:e.attributes.filter((function(e){return!e.name.startsWith("$V_")}))})),T.converted=Object(S.y)(T.converted),_=Object(S.xb)(T.converted,ui(ui({},e),{},{attributes:e.attributes.filter((function(e){return e.name.startsWith("$V_")}))}))),"ContainerSDC"===v&&null!==(s=_.attributes)&&void 0!==s&&null!==(c=s.importsManager)&&void 0!==c&&c.value&&(f[_.fid]=null===(C=_.attributes)||void 0===C||null===(O=C.importsManager)||void 0===O?void 0:O.value),p&&(_.attributes.importsManager.visible=!0),"ContainerSDC"===v&&!p&&null!==(d=_.attributes.sourceId)&&void 0!==d&&d.value){var V,w=(null===(V=_.attributes.sourcePath)||void 0===V?void 0:V.value)||_.attributes.sourceId.value;h[w]||(h[w]=[]),h[w].push({compFid:_.fid,sourceVersion:_.attributes.sourceVersion.value})}return r("setCustomGroupNamesByAttrs",{fid:e.fid,data:_.attributes}),_}));var m,v,b=n.attrGroups.Page,g=Object(S.U)(p.page,b,o);p.page&&(c=p.page.fid||c,u.page.fid=c,u.page.pageId=u.pageId),u.page.attributes=g.converted,u.page.attributes.pageName.value=u.name,u.page.attributes.pageTitle.value=u.title,u.page.attributes.permissionId.value=u.permissionId,b||a("SET_ATTR_GROUPS",{componentType:"Page",data:g.attrGroup}),r("setCustomGroupNamesByAttrs",{fid:c,data:g.converted}),u.componentKV=Object(S.T)(u.component,n.disableComponents),u.componentKV[c]=u.page,Object(S.B)(f,u.componentKV),r("updateActiveComponentByFid",s),Object(S.s)(h,u,f).finally((function(){a("SET_PAGE_KV_LOADED",s)})),o&&(null!==(m=u.component)&&void 0!==m&&m.length||(u.component||(u.component=[]),u.component.push(Object(y.e)(st)),r("addComponent",{index:0,mode:"clone",isSDC:o,SDCName:(null===(v=l)||void 0===v?void 0:v.componentName)||Object(S.jb)()})))},updateActiveComponent:function(e,t){var a=e.commit,i=e.dispatch,n=Object(S.J)(t);i("updateCurrentAttrs",n),a("SET_ACTIVE_COMPONENT_FID",n)},updateActiveComponentByFid:function(e,t){var a=e.dispatch,i=e.state;t=t||i.pagesActiveName;var n=i.pagesKV[t];if(n){var r=n.page;r&&a("updateActiveComponent",r.fid)}},setTips:function(e,t){var a=e.commit,i=e.state;if(!i.tips[t]||1!==i.tips[t].status){var n=["".concat(t,"-brief"),"".concat(t,"-detail")],r={url:"/api/model/instances?objectType=SNIPPET&$pagination=0&$filter=identifier eq ".concat(n.join("::")),method:"get"};window.$common.$util.request(r).then((function(e){var n,r,o=e.result;window.$VUE_ROOT.$set(i.tips,t,{}),window.$VUE_ROOT.$set(i.tips[t],"fragment",Object(S.Gb)(null===(n=o[0])||void 0===n?void 0:n.snippetContent)),window.$VUE_ROOT.$set(i.tips[t],"detail",Object(S.Gb)(null===(r=o[1])||void 0===r?void 0:r.snippetContent)),a("NOT_LAZY_LOAD_RELOAD_TIPS",t)}))}},setLinkEditorTips:function(e,t){var a=e.commit,i=e.state,n="".concat(t,"-link");if(!i.linkTips[n]||1!==i.linkTips[n].status){var r={url:"/api/model/instances?objectType=SNIPPET&$pagination=0&$filter=identifier eq ".concat(n),method:"get"};window.$common.$util.request(r).then((function(e){var t,r,o=e.result;window.$VUE_ROOT.$set(i.linkTips,n,{}),window.$VUE_ROOT.$set(i.linkTips[n],"value",Object(S.Gb)(null===(t=o[0])||void 0===t?void 0:t.snippetContent)),window.$VUE_ROOT.$set(i.linkTips[n],"description",null===(r=o[0])||void 0===r?void 0:r.description),a("NOT_LAZY_LOAD_RELOAD_INNER_TIPS",n)}))}},updateOthersPageActiveComponent:function(e,t){var a=e.commit,i=e.dispatch,n=e.state,r=t.componentFid,o=t.pageId,l=t.othersPageId;if(l){if(o){o=o||n.othersPage[l].pagesActiveName;var s=n.othersPage[l].pagesKV[o];if(!s)return;var c=s.page;if(!c)return;r=c.fid}i("updateOthersPageCurrentAttrs",{componentFid:r,othersPageId:l}),a("SET_OTHERS_PAGE_ACTIVE_COMPONENT_FID",{componentFid:r,othersPageId:l})}},updateOthersPageCurrentAttrs:function(e,t){var a=e.commit,i=e.state,n=t.componentFid,r=t.othersPageId,o=i.othersPage[r],l=o.pagesKV[o.pagesActiveName];if(l){var s=l.componentKV,c=s&&s[n];if(c){a("SET_OTHERS_PAGE_CURRENT_ATTRS",{attrs:c.attributes,othersPageId:r});var u=[],d=c.name,p=o.attrGroups[d];p&&(u=p.map((function(e){return!1!==e.expandable&&e.name}))),a("SET_OTHERS_PAGE_ATTRS_ACTIVE_NAMES",{activeNames:u,othersPageId:r})}}},updateCurrentAttrs:function(e,t){var a=e.commit,i=e.state,n=e.dispatch,r=i.pagesKV[i.pagesActiveName];if(r){var o=r.componentKV,l=o&&o[t];if(l){a("SET_CURRENT_ATTRS",l.attributes),n("setCurrentTipsStatus",l);var s=[],c=l.name,u=i.attrGroups[c];u&&(s=u.map((function(e){return!1!==e.expandable&&e.name}))),a("SET_ATTRS_ACTIVE_NAMES",s)}}},addComponent:function(e,t){var a=e.commit,i=e.state,n=e.dispatch,r=e.getters;return Object(V.a)(x.a.mark((function e(){var o,l,s,c,u,d,p,h,m,v,b,g,y,_,C,O,T,V,w,P,j,E,k,I,A,D,N,$;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l=t.isSDC,s=Object(ni.a)(t,si),c=i.pagesKV[i.pagesActiveName]){e.next=4;break}return e.abrupt("return");case 4:if(u=null,d=c.component,p="",s.parentFid&&(u=c.componentKV[s.parentFid],d=u&&u.children,p=u&&(u.name||u.componentType)),"Grid"!==p){e.next=12;break}return e.next=11,n("addComponentForGrid",s);case 11:return e.abrupt("return");case 12:if(h=s.tabIndex,m=~di.indexOf(p)?Object(S.lb)(s.index,h,d,null==s?void 0:s.itemId):s.index,v=d[m],s.componentData&&(v=s.componentData),v){e.next=21;break}if(s.from){e.next=20;break}return e.abrupt("return");case 20:return e.abrupt("return");case 21:if(l&&!s.parentFid&&(v.isCurrentTopSDC=!0),g=(b=v).fid,!(y=S.g.includes(v.name)&&!(null!==(o=v.attributes)&&void 0!==o&&o.length))){e.next=32;break}return e.next=28,n("getSDCComponent",ui({sourceId:v.sourceId,SDCName:v.key},u||{}));case 28:b=e.sent,g=null===(_=b)||void 0===_?void 0:_.fid,e.next=45;break;case 32:v.componentType="dataContainer"===(null===(C=u)||void 0===C?void 0:C.groupName)?u.parentName:p,v.pageId=null!==(O=v.pageId)&&void 0!==O?O:c.id,w=v.name||v.componentType,P=i.attrGroups[w],"clone"===s.mode&&(j=Object(S.Q)(v,v.isCurrentTopSDC?r.getTempCount(null==s?void 0:s.SDCName):r.getCount,P),b=j.converted,v.isCurrentTopSDC&&(b.attributes.importsManager.visible=!0),P||a("SET_ATTR_GROUPS",{componentType:w,data:j.attrGroup}),a("SET_CUSTOM_GROUP_NAMES",{fid:b.fid,data:j.customGroupNames})),~di.indexOf(p)?b.tabIndex=h:delete b.tabIndex,(b=Object(S.A)(b,["dataContainer"].includes(null===(T=u)||void 0===T?void 0:T.groupName)?u.componentType:p,!0)).pageVersion=c.pageVersion,E=b.parentFid,b.parentFid=null===(V=u)||void 0===V?void 0:V.fid,g=b.fid,s.mode&&"clone"!==s.mode&&(N=c.componentKV[E],$=null==N||null===(k=N.attributes)||void 0===k||null===(I=k.componentName)||void 0===I?void 0:I.value,"dataContainer"===N.groupName&&$&&"dataContainer"!==(null===(A=u)||void 0===A?void 0:A.groupName)?Object(S.K)(b.attributes,(function(e){Object(S.Bb)(e,Object(f.a)({},$,""))})):"dataContainer"===(null===(D=u)||void 0===D?void 0:D.groupName)&&Object(S.o)(b)),n("updateComponentKV",{fid:g,data:b});case 45:d&&(d.splice(m,1,b),n("updateActiveComponent",g)),y&&Object(S.B)(b.importAttrs,i.pagesKV[i.pagesActiveName].componentKV,!0),"dataContainer"===b.groupName&&"clone"===s.mode&&(i.isSDCEditor&&window.$VUE_ROOT.$setAttr(b.attributes.keepValue,"visible",!0),setTimeout((function(){window.$VUE_ROOT.$setAttr(b.attributes.value,"editorDialogVisible",!0)}),0)),a("SET_UN_SAVED",!0);case 49:case"end":return e.stop()}}),e)})))()},addComponentForGrid:function(e,t){var a=e.commit,i=e.state,n=e.dispatch,r=e.getters;return Object(V.a)(x.a.mark((function e(){var o,l,s,c,u,d,p,h,m,v,b,g,_,C,O,T,V,w,P,j,E,k,I,A,D,N,$;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.colId){e.next=2;break}return e.abrupt("return");case 2:if(l=i.pagesKV[i.pagesActiveName],s=l.componentKV[t.parentFid],c=null==s?void 0:s.children,u="Grid",d=null!=c&&c.find((function(e){return!e.hasOwnProperty("colId")&&!e.hasOwnProperty("rowId")}))?c.splice(0,c.length):null,!t.isBlock){e.next=17;break}if(!((c||[]).filter((function(e){return e.colId===t.colId})).length>0)){e.next=11;break}return e.abrupt("return");case 11:return p={fid:Object(S.ob)(),rowId:t.rowId,colId:t.colId,name:"block",componentType:u,pageId:t.pageId,parentFid:null==s?void 0:s.fid,children:d||[]},t.isCopy&&(h=t.copyData,"array"===Object(y.g)(h)&&(m=[],v=function(e,t){t&&(n("updateComponentKV",{fid:e,data:t}),n("setCustomGroupNamesByAttrs",{fid:e,data:t.attributes}))},h.forEach((function(e){var t=Object(S.P)(e,r.getCount,v);m.push(t)})),p.children=m)),t.hasOwnProperty("index")?c.splice(t.index+1,0,p):c.push(p),n("updateComponentKV",{fid:p.fid,data:p}),a("SET_UN_SAVED",!0),e.abrupt("return");case 17:if(b=c.find((function(e){return e.rowId===t.rowId&&e.colId===t.colId})),g=null==b?void 0:b.children,_=t.index,C=g[_],O=C,T=null==C?void 0:C.fid,!(V=S.g.includes(C.name)&&!(null!==(o=C.attributes)&&void 0!==o&&o.length))){e.next=33;break}return e.next=27,n("getSDCComponent",ui({sourceId:C.sourceId,SDCName:C.key},b||{}));case 27:if(O=e.sent,T){e.next=31;break}return g&&g.length&&(g.splice(_,1,O),T=O.fid,n("updateActiveComponent",T),V&&Object(S.B)(O.importAttrs,i.pagesKV[i.pagesActiveName].componentKV,!0)),e.abrupt("return");case 31:e.next=54;break;case 33:if(C.componentType="dataContainer"===(null==s?void 0:s.groupName)?s.parentName:u,C.pageId=null!==(w=C.pageId)&&void 0!==w?w:l.id,T){e.next=47;break}return P=C.name||C.componentType,j=i.attrGroups[P],E=Object(S.Q)(C,r.getCount,j),(O=Object(S.A)(E.converted,["dataContainer"].includes(null==s?void 0:s.groupName)?s.componentType:u,!0)).pageVersion=l.pageVersion,O.parentFid=null==b?void 0:b.fid,j||a("SET_ATTR_GROUPS",{componentType:P,data:E.attrGroup}),a("SET_CUSTOM_GROUP_NAMES",{fid:O.fid,data:E.customGroupNames}),g&&g.length&&(g.splice(_,1,O),k=O.fid,n("updateComponentKV",{fid:k,data:O}),n("updateActiveComponent",k)),"dataContainer"===O.groupName&&"clone"===t.mode&&(i.isSDCEditor&&window.$VUE_ROOT.$setAttr(O.attributes.keepValue,"visible",!0),setTimeout((function(){window.$VUE_ROOT.$setAttr(O.attributes.value,"editorDialogVisible",!0)}),0)),e.abrupt("return");case 47:(O=Object(S.A)(O,["dataContainer"].includes(null==s?void 0:s.groupName)?s.componentType:u,!0)).pageVersion=l.pageVersion,I=O.parentFid,O.parentFid=null==b?void 0:b.fid,T=O.fid,t.mode&&"clone"!==t.mode&&(N=l.componentKV[I],$=null==N||null===(A=N.attributes)||void 0===A||null===(D=A.componentName)||void 0===D?void 0:D.value,"dataContainer"===N.groupName&&$&&"dataContainer"!==(null==s?void 0:s.groupName)?Object(S.K)(O.attributes,(function(e){Object(S.Bb)(e,Object(f.a)({},$,""))})):"dataContainer"===(null==s?void 0:s.groupName)&&Object(S.o)(O)),n("updateComponentKV",{fid:T,data:O});case 54:n("updateActiveComponent",T),V&&Object(S.B)(O.importAttrs,i.pagesKV[i.pagesActiveName].componentKV,!0),a("SET_UN_SAVED",!0);case 57:case"end":return e.stop()}}),e)})))()},updateComponentKV:function(e,t){e.commit;var a=e.state,i=a.pagesKV[a.pagesActiveName];i&&(i.componentKV[t.fid]=t.data)},changeComponentKV:function(e,t){var a=e.commit,i=(e.state,e.dispatch);a("DELETE_COMPONENT_NAMES",t.oldKey),a("SET_COMPONENT_NAMES",t.newKey),i("changeComponentNameFid",t),a("SET_UN_SAVED",!0)},changeComponentNameFid:function(e,t){var a=e.commit,i=e.state;a("SET_COMPONENT_NAME_FID",{fid:(e.dispatch,i.pagesKV[i.pagesActiveName]).componentNameFid[t.oldKey],componentName:t.newKey}),a("DELETE_COMPONENT_NAME_FID",t.oldKey)},removeComponent:function(e,t){var a=e.commit,i=e.state,n=e.dispatch,r="object"===Object(y.g)(t)?t.fid:t,o="object"!==Object(y.g)(t)||t.isUpdateActive;if(r){var l=i.pagesKV[i.pagesActiveName];if(l){var s="array"!==Object(y.g)(r)?[r]:r,c=[];t.remain?c=[r]:s.forEach((function(e){var t,a=Object(S.I)(e,l.component);if(a){var i=Object(S.O)(a);(t=c).push.apply(t,Object(d.a)(i))}})),(c=c.reverse()).forEach((function(e){if(e){var i=Object(S.I)(e,l.component);if(Object(S.F)(e,l.component),!t.remain){if(i){var n,r,o=null==i||null===(n=i.attributes)||void 0===n||null===(r=n.componentName)||void 0===r?void 0:r.value;a("DELETE_COMPONENT_NAMES",o),a("DELETE_COMPONENT_NAME_FID",o)}a("DELETE_COMPONENT_INSTANCE",e),a("DELETE_CUSTOM_GROUP_NAMES",{fid:e}),delete l.componentKV[e]}}})),o&&n("updateActiveComponentByFid",i.pagesActiveName),(null==t||!t.keepSaved)&&a("SET_UN_SAVED",!0)}}},setCustomGroupNamesByAttrs:function(e,t){var a=e.commit,i={},n=t.data,r=t.fid;Object(S.K)(n,(function(e){e.customGroupName&&Object(S.Db)(e.customGroupName,e,i)})),a("SET_CUSTOM_GROUP_NAMES",{fid:r,data:i})},setOthersPageCustomGroupNamesByAttrs:function(e,t){var a=e.commit,i={},n=t.data,r=t.fid;Object(S.K)(n,(function(e){e.customGroupName&&Object(S.Db)(e.customGroupName,e,i)})),a("SET_OTHERS_PAGE_CUSTOM_GROUP_NAMES",{fid:r,data:i,othersPageId:t.othersPageId})},decomposeComponent:function(e,t){var a,i=e.commit,n=e.state,r=e.dispatch,o=(e.getters,n.pagesKV[n.pagesActiveName]),l=Object(S.I)(t.parentFid,o.component);l&&(t.target=l.children);var s=t.target.findIndex((function(e){return e.fid===t.fid}));if(s<0)window.$VUE_ROOT.$message.warning("组件分解失败");else{var c=t.data,u=Object(S.C)(c),p={},h=null!=u&&u.length?Object(S.W)(u,(function(e,t){var a,i,n,r;return"ContainerSDC"===(e.key||e.name||e.componentType)&&null!==(a=e.attributes)&&void 0!==a&&null!==(i=a.importsManager)&&void 0!==i&&i.value&&(p[e.fid]=null===(n=e.attributes)||void 0===n||null===(r=n.importsManager)||void 0===r?void 0:r.value),e})):[];if(Object(S.T)(h,n.disableComponents,(function(e){r("updateComponentKV",{fid:e.fid,data:e})})),(a=t.target).splice.apply(a,[s,1].concat(Object(d.a)(h))),r("updateActiveComponent",h[0].fid),Object(S.B)(p,n.pagesKV[n.pagesActiveName].componentKV),c){var f,m,v=null==c||null===(f=c.attributes)||void 0===f||null===(m=f.componentName)||void 0===m?void 0:m.value;i("DELETE_COMPONENT_NAMES",v),i("DELETE_COMPONENT_NAME_FID",v)}i("DELETE_COMPONENT_INSTANCE",t.fid),i("DELETE_CUSTOM_GROUP_NAMES",{fid:t.fid}),delete o.componentKV[t.fid],i("SET_UN_SAVED",!0)}},copyComponent:function(e,t){var a=e.commit,i=e.state,n=e.dispatch,r=e.getters,o=i.pagesKV[i.pagesActiveName],l=Object(S.I)(t.parentFid,o.component);l&&(t.target=l.children);var s=t.target.findIndex((function(e){return e.fid===t.fid})),c=t.data,u={},d=Object(S.P)(c,r.getCount,(function(e,o){var l,s;if(o){var c,d,p=o.name||o.componentType;"ContainerSDC"===p&&null!==(l=o.attributes)&&void 0!==l&&null!==(s=l.importsManager)&&void 0!==s&&s.value&&(u[o.fid]=null===(c=o.attributes)||void 0===c||null===(d=c.importsManager)||void 0===d?void 0:d.value);var h=i.attrGroups[p],f=o;if("clone"===t.mode){var m=Object(S.Q)(f,r.getCount,h);f=m.converted,h||a("SET_ATTR_GROUPS",{componentType:p,data:m.attrGroup}),a("SET_CUSTOM_GROUP_NAMES",{fid:f.fid,data:m.customGroupNames})}else if(!h){var v=o.key||o.name||o.componentType;if("block"!==v){var b=i.componentsKV[v],g=Object(S.Q)(b,r.getCount,h);a("SET_ATTR_GROUPS",{componentType:v,data:g.attrGroup}),a("SET_CUSTOM_GROUP_NAMES",{fid:f.fid,data:g.customGroupNames})}}n("updateComponentKV",{fid:e,data:o}),n("setCustomGroupNamesByAttrs",{fid:e,data:o.attributes})}}));-1===s?t.target.push(d):t.target.splice(s+1,0,d),setTimeout((function(){n("updateActiveComponent",d.fid),Object(S.B)(u,i.pagesKV[i.pagesActiveName].componentKV,!1,!0)})),a("SET_UN_SAVED",!0)},innerMoveComponent:function(e,t){e.commit;var a,i,n,r,o,l=e.state,s=e.dispatch,c=(e.getters,l.pagesKV[l.pagesActiveName]),u=t.newItem,d=t.parentFid,p=t.index,h=Object(S.I)(d,c.component);o=h?h.children:c.component;var m=Object(S.A)(u,["dataContainer"].includes(null==h?void 0:h.groupName)?h.componentType:null==h?void 0:h.name,!0);s("removeComponent",{fid:m.fid,remain:!0}),null===p?o.push(m):o.splice(p,0,m);var v=c.componentKV[m.fid],b=c.componentKV[v.parentFid],g=null==b||null===(a=b.attributes)||void 0===a||null===(i=a.componentName)||void 0===i?void 0:i.value,y=null==h||null===(n=h.attributes)||void 0===n||null===(r=n.componentName)||void 0===r?void 0:r.value;if("dataContainer"===b.groupName&&g){var _="dataContainer"===(null==h?void 0:h.groupName)?y:"";Object(S.K)(m.attributes,(function(e){Object(S.Bb)(e,Object(f.a)({},g,_))}))}else"dataContainer"===(null==h?void 0:h.groupName)&&Object(S.o)(m);s("updateComponentKV",{fid:m.fid,data:m}),s("updateActiveComponent",""),window.$VUE_ROOT.$nextTick((function(){s("updateActiveComponent",m.fid)}))},copyOnlyTab:function(e,t){e.commit;var a=e.state,i=(e.dispatch,e.getters,t.fid),n=t.index,r=a.pagesKV[a.pagesActiveName];if(r){var o=r.componentKV[i];if(o&&o.children){var l=[];o.children.forEach((function(e){e.tabIndex===n&&l.push(e)})),localStorage.setItem("inovance-webtools-page-tabs-clip",JSON.stringify(l)),window.$VUE_ROOT.$message({message:"标签页复制成功",type:"success"})}}},pasteTabContent:function(e,t){e.commit;var a=e.state,i=e.dispatch;return e.getters,Object(V.a)(x.a.mark((function e(){var n,r,o,l,s,c,u,d;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.fid,r=t.index,o=a.pagesKV[a.pagesActiveName]){e.next=4;break}return e.abrupt("return");case 4:if((l=o.componentKV[n])&&l.children){e.next=7;break}return e.abrupt("return");case 7:return s=[],l.children.forEach((function(e){e.tabIndex===r&&s.push(e.fid)})),e.next=11,i("removeComponent",s);case 11:c=localStorage.getItem("inovance-webtools-page-tabs-clip"),e.prev=12,u=JSON.parse(c),d=0;case 15:if(!(d<u.length)){e.next=22;break}return u[d].tabIndex=r,e.next=19,i("copyComponent",{fid:u[d].fid,target:l.children,data:u[d]});case 19:d++,e.next=15;break;case 22:window.$VUE_ROOT.$message({message:"标签页粘贴成功",type:"success"}),e.next=28;break;case 25:e.prev=25,e.t0=e.catch(12),window.$VUE_ROOT.$message({message:"暂时没有合法的粘贴内容",type:"warning"});case 28:case"end":return e.stop()}}),e,null,[[12,25]])})))()},registerComponentInstance:function(e,t){var a=e.commit;e.state,a("SET_COMPONENT_INSTANCE",t),a("SET_COMPONENT_NAME_FID",t)},removePageAll:function(e){e.commit,e.state.pages=[]},removePageByFid:function(e,t){var a=e.commit,i=e.state;i.pages.forEach((function(e,n){e.fid===t&&(a("SET_PAGES_ACTIVE_NAME",""),i.pages.splice(n,1))}))},removePageByPageId:function(e,t){e.commit;var a=e.state;a.pages.forEach((function(e,i){e.id&&e.id===t&&a.pages.splice(i,1)}))},addCustomMethods:function(e,t){var a=e.commit,i=e.state,n=[],r=[];[].concat(Object(d.a)(i.customMethods),[t]).reverse().forEach((function(e){r.includes(e.functionName)||(r.push(e.functionName),n.push(e))})),a("SET_CUSTOM_METHODS",n)},removeCustomMethods:function(e,t){(0,e.commit)("SET_CUSTOM_METHODS",e.state.customMethods.filter((function(e){return e.functionName===t.functionName})))},serCustomMethods:function(e,t){var a=e.commit;e.state,a("SET_CUSTOM_METHODS",t)},serBemPointerAll:function(e,t){var a=e.commit;e.state,a("SET_BEM_POINTER_ALL",t)},deleteTabIndexComponents:function(e,t){e.commit;var a=e.state,i=e.dispatch,n=a.pagesKV[a.pagesActiveName],r=t.fid,o=t.tabIndex;i("removeComponent",Object(S.I)(r,n.component).children.filter((function(e){return e.tabIndex===o})).map((function(e){return e.fid})))},setEventEditingComponentFid:function(e,t){(0,e.commit)("SET_EVENT_EDITING_COMPONENT_FID",t)},resetLazyLoad:function(e,t){var a=e.commit,i=e.state;if(t)a("RESET_LAZY_LOAD_RELOAD",t);else for(var n in i.lazyLoad.status)a("RESET_LAZY_LOAD_RELOAD",n)},updateIsSDCEditor:function(e,t){(0,e.commit)("SET_IS_SDC_EDITOR",t)}},mutations:{SET_PAGE_KV_LOADED:function(e,t){window.$VUE_ROOT.$set(e.pagesKVLoaded,t,!0)},SET_IS_SDC_EDITOR:function(e,t){e.isSDCEditor=!!t},RESET_LAZY_LOAD_RELOAD:function(e,t){e.lazyLoad.status[t]=1},NOT_LAZY_LOAD_RELOAD:function(e,t){e.lazyLoad.status[t]=0},NOT_LAZY_LOAD_RELOAD_TIPS:function(e,t){e.tips[t].status=1},NOT_LAZY_LOAD_RELOAD_INNER_TIPS:function(e,t){e.linkTips[t].status=1},REMOVE_OTHER_PAGE:function(e,t){delete e.othersPage[t]},SET_EVENT_EDITING_COMPONENT_FID:function(e,t){e.eventEditingComponentFid=t},SET_BEM_POINTER_ALL:function(e,t){e.bemPointerAll=t},SET_CUSTOM_METHODS:function(e,t){e.customMethods=t},SET_COMPONENTS_ACTIVE_NAMES:function(e,t){e.componentsActiveNames.push(t)},SET_COMPONENTS:function(e,t){e.components=t},SET_ORIGIN_COMPONENTS:function(e,t){e.originComponents=t},SET_COMPONENTS_KV:function(e,t){e.componentsKV[t.key?t.key:t.name]=t},SET_COMPONENTS_URL:function(e,t){e.componentsUrl=t||""},SET_PAGES_ACTIVE_NAME:function(e,t){e.pagesActiveName=t},SET_ACTIVE_COMPONENT_FID:function(e,t){var a=e.pagesKV[e.pagesActiveName];a.activeComponentFid=t,Ft.a.$emit("bemSelected",a)},SET_OTHERS_PAGE_ACTIVE_COMPONENT_FID:function(e,t){var a=t.componentFid,i=t.othersPageId,n=e.othersPage[i];n.pagesKV[n.pagesActiveName].activeComponentFid=a},SET_PAGES:function(e,t){var a=e.pages.findIndex((function(e){return e.id===t.id}));-1===a?e.pages.push(t):e.pages[a]=t},SET_PAGES_KV:function(e,t){e.pagesKV[t.fid]=t.data},SET_ATTR_GROUPS:function(e,t){e.attrGroups[t.componentType]=t.data},SET_OTHERS_PAGE_ATTR_GROUPS:function(e,t){t.othersPageId&&(e.othersPage[t.othersPageId].attrGroups[t.componentType]=t.data)},SET_ATTRS_ACTIVE_NAMES:function(e,t){e.pagesKV[e.pagesActiveName].attrsActiveNames=t},SET_OTHERS_PAGE_ATTRS_ACTIVE_NAMES:function(e,t){var a=t.activeNames,i=t.othersPageId,n=e.othersPage[i];n.pagesKV[n.pagesActiveName].attrsActiveNames=a},SET_CURRENT_ATTRS:function(e,t){e.pagesKV[e.pagesActiveName].currentAttrs=t},SET_OTHERS_PAGE_CURRENT_ATTRS:function(e,t){var a=t.attrs,i=t.othersPageId,n=e.othersPage[i];n.pagesKV[n.pagesActiveName].currentAttrs=a},SET_COMPONENT_NAMES:function(e,t){t&&(e.pagesKV[e.pagesActiveName].componentNames[t]=!0)},SET_OTHERS_PAGE_COMPONENT_NAMES:function(e,t){if(null!=t&&t.othersPageId&&t.componentId){var a=e.othersPage[t.othersPageId];a.pagesKV[a.pagesActiveName].componentNames[t.componentId]=!0}},DELETE_COMPONENT_NAMES:function(e,t){t&&delete e.pagesKV[e.pagesActiveName].componentNames[t]},SET_COMPONENT_INSTANCE:function(e,t){e.pagesKV[e.pagesActiveName].componentInstance[t.fid]=t.componentInstance},DELETE_COMPONENT_INSTANCE:function(e,t){delete e.pagesKV[e.pagesActiveName].componentInstance[t]},SET_COMPONENT_NAME_FID:function(e,t){t.fid&&t.componentName&&(e.pagesKV[e.pagesActiveName].componentNameFid[t.componentName]=t.fid)},DELETE_COMPONENT_NAME_FID:function(e,t){delete e.pagesKV[e.pagesActiveName].componentNameFid[t]},SET_UN_SAVED:function(e,t){e.pagesKV[e.pagesActiveName].unSaved=t},SET_HEADER_INSTANCE:function(e,t){e.headerInstance=t},SET_DESINGER_INSTANCE:function(e,t){e.designerInstance=t},SET_CUSTOM_GROUP_NAMES:function(e,t){var a=e.pagesKV[e.pagesActiveName],i=a.customGroupNames[t.fid];i||(i=a.customGroupNames[t.fid]={});var n=function(e){t.data[e].forEach((function(t){i[e]||(i[e]=[]),i[e].push(t)}))};for(var r in t.data)n(r)},SET_OTHERS_PAGE_CUSTOM_GROUP_NAMES:function(e,t){if(t.othersPageId){var a=e.othersPage[t.othersPageId],i=a.pagesKV[a.pagesActiveName],n=i.customGroupNames[t.fid];n||(n=i.customGroupNames[t.fid]={});var r=function(e){t.data[e].forEach((function(t){n[e]||(n[e]=[]),n[e].push(t)}))};for(var o in t.data)r(o)}},DELETE_CUSTOM_GROUP_NAMES:function(e,t){var a=e.pagesKV[e.pagesActiveName];if(t.data){var i=a.customGroupNames[t.fid],n=function(){var e=t.data[r],a=i[r];if(!a)return 1;e.forEach((function(e){a.forEach((function(t,i){t.fid===e.fid&&a.splice(i,1)}))})),0===e.length&&delete i[r]};for(var r in t.data)n()}else delete a.customGroupNames[t.fid]},SET_PAGE_CONTENT_HEIGHT:function(e,t){e.pageContentHeight=t},SET_LOCAL_COMPONENT:function(e,t){e.localComponent=t},SET_DISABLE_COMPONENTS:function(e,t){e.disableComponents=t},ADD_HISTORYOPERATIONITEM:function(e,t){t.isRedo?e.historyOperationList.splice(e.historyOperationIndex,t):(e.historyOperationList.push(t),e.historyOperationIndex++),e.historyOperationIndex.length>e.max&&(e.historyOperationList.shift(),e.historyOperationIndex--)},BACK_HISTORY:function(e,t){0===e.historyOperationList.length||e.historyOperationIndex<0||e.historyOperationIndex--},GO_HISTORY:function(e,t){0===e.historyOperationList.length||e.historyOperationIndex>=e.historyOperationList.length||e.historyOperationIndex++},DELETE_COMPONENTS:function(e){e.components=[],e.componentsKV={},e.disableComponents=[],e.componentsActiveNames=[]},SET_PAGE_VARIABLES:function(e,t){t&&(e.pagesKV[e.pagesActiveName].page.attributes.customVariable.attributes=t)}}},init:function(e){!function(e){for(var t in jt(e),_e)if(_e.hasOwnProperty(t)){var i=_e[t];if("util"===t){var n=e.prototype.$util;if(n)for(var r in i)n[r]||(n[r]=i[r]);else e.prototype.$util=i;continue}e.prototype["$"+t]||(e.prototype["$"+t]=i)}Ce.forEach((function(t){e.component(t.name,t.content)})),e.options.components.componentExtends=dt,e.component(h.name,h),e.component(g.name,g),e.component(u.a.name,u.a),e.component(T.name,T),e.component(At.name,At),e.component(ot.name,ot),e.component(ut.name,ut),e.prototype.$bus=e.prototype.$bus||new e,window.pageVersion=(window.pageVersion||a("9224").version)+"",window.$common.$util.chartUtils=Tt,window.$common.$util.chartComMixin=xt}(e||window.Vue)}},hi=a("1a80");function fi(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function mi(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?fi(Object(a),!0).forEach((function(t){Object(f.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):fi(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var vi={1:null,2:1,3:4,4:null},bi={name:"PageView",components:{ViewArea:ba},provide:function(){return{isKeepAlive:this.isKeepAlive}},data:function(){return{loadingType:1,isLeave:!1,loading:!0,loadingText:null,pageId:"",queries:{},show:!0,attrList:[],viewArea:null,viewAreaMounted:!1,pageParse:null,dialogNoPermissionSupport:!1,dialogNoPublish:!1,noPermissionImg:"/modules/page-view/public/img/no-permission.png",noPublishImg:"/modules/page-view/public/img/no-publish.png",resizeTimer:null,data:{fid:"",name:"",id:"",path:"",parentId:"",pageType:2,component:[],componentKV:{},pageId:"",page:{fid:"",name:"",attributes:{}},countKV:{},componentNames:{},componentInstance:{},componentNameFid:{},customGroupNames:{},activeComponentFid:"",attrsActiveNames:[],currentAttrs:{}}}},props:{id:{type:String,default:""},path:{type:String,default:""},pageVariables:{type:Object,default:function(){}},dialog:{type:Object,default:function(){}},drawer:{type:Object,default:function(){return{}}},fromPageId:{type:String,default:""},fromPagePath:{type:String,default:""},params:{type:Object,default:function(){return{enableCache:!0,onlyPreview:!1}}},routeIgnore:{type:Boolean,default:!1},loadingIgnore:{type:Boolean,default:!1},options:{type:Object,default:function(){return{}}},parentFid:{type:String,default:""},isAutoHeight:{type:Boolean,default:!1},isKeepAlive:{type:[Boolean,Number],default:0}},beforeDestroy:function(){var e,t;this.isLeave=!0,this.handleRemoveEvents();try{var a=this.data.page.attributes,i=a&&a.beforeunload,n=i&&i.attributes,r=n&&n.content;(r.attributes||[]).find((function(e){var t;return!(null==e||null===(t=e.executionType)||void 0===t||!t.value)}))&&this.$eventContentParse(r)}catch(e){this.$sendLog({logData:{message:e.message,info:Object(S.yb)({pageId:this.data.pageId})},logTitle:"页面beforeunload事件错误"})}var o=(null===(e=this.pageParse)||void 0===e?void 0:e.pageId)||this.data.pageId,l=(null===(t=this.pageParse)||void 0===t?void 0:t.pagePath)||this.data.pagePath;this.clearDataByPageId(o),this.clearDataByPageId(l)},created:function(){var e,t;this.isKeepAlive||this.handleAddEvents();var a=Object(y.h)(this.$route.query),i=a.pageType;if(this.$store.dispatch("resetLazyLoad"),this.id||this.path||this.routeIgnore){var n,r;this.getPageInfo(this.id,this.path,null!==(n=null===(r=this.options)||void 0===r?void 0:r.targetType)&&void 0!==n?n:vi[i])}else{var o=a.pageId,l=a.path;this.queries=a,this.getPageInfo(o,l,null!==(e=null===(t=this.options)||void 0===t?void 0:t.targetType)&&void 0!==e?e:vi[i])}},activated:function(){this.isKeepAlive&&this.handleAddEvents()},deactivated:function(){this.isKeepAlive&&this.handleRemoveEvents()},computed:mi(mi({},Object(He.a)(["portalInfo"])),{},{check:function(){return!this.loadingIgnore||!this.loading},dataLoaded:function(){var e,t;return null===(e=this.$store.getters)||void 0===e||null===(t=e.pageViewStore)||void 0===t?void 0:t.pagesKVLoaded[this.data.fid]},loading$:function(){return!this.loadingIgnore&&(this.loading||!this.dataLoaded)},loadingText$:function(){return 1===this.loadingType?"加载中，请稍后...":this.loadingText},isMobile:function(){var e;return 1===(null==this||null===(e=this.portalInfo)||void 0===e?void 0:e.isMobile)}}),watch:{$route:function(e,t){if(!this.isKeepAlive){var a,i;if(this.routeIgnore)return;if(e.path!==t.path)return;if(e.query.path&&e.query.path===t.query.path)return;var n=Object(y.h)(e.query),r=n.pageId,o=n.path,l=n.pageType;this.queries=n,this.getPageInfo(r,o,null!==(a=null===(i=this.options)||void 0===i?void 0:i.targetType)&&void 0!==a?a:vi[l])}}},methods:{getDefaultLoadingText:function(e){var t,a,i,n,r="加载中，请稍后...",o=(null===(t=e.page.attributes)||void 0===t||null===(a=t.$showLoading)||void 0===a||null===(i=a.attributes)||void 0===i||null===(n=i.payload)||void 0===n?void 0:n.attributes)||[];if(0===o.length)return r;for(var l=0;l<o.length;l++)if("loadingText"===o[l].name.default){r=o[l].default.default;break}return r},handleAddEvents:function(){window.addEventListener("resize",this.handleResize,!1),document.onkeydown=this.handleKeyDown},handleRemoveEvents:function(){window.removeEventListener("resize",this.handleResize),document.onkeydown=""},handleResize:function(e){var t=this;this.resizeTimer||(this.resizeTimer=setTimeout((function(){t.resizeTimer=null;try{var a=t.data.page.attributes,i=a&&a.onresize,n=i&&i.attributes,r=n&&n.content;(r.attributes||[]).find((function(e){var t;return!(null==e||null===(t=e.executionType)||void 0===t||!t.value)}))&&t.$eventContentParse(r,{eventTarget:e})}catch(e){t.$sendLog({logData:{message:e.message,info:Object(S.yb)({pageId:t.data.pageId})},logTitle:"窗口调整大小（resize）事件错误"})}}),300))},handleKeyDown:function(e){var t=this;try{var a=this.data.page.attributes,i=a&&a.onKeyDown,n=i&&i.attributes,r=n&&n.content,o=(r.attributes||[]).filter((function(e){var t;return!(null==e||null===(t=e.executionContent)||void 0===t||!t.value)}));o.length>0&&o.forEach((function(a){if((a.keyCode.value||a.keyCode.default)==="".concat(e.keyCode)){var i=mi(mi({},r),{},{attributes:[a]});t.$eventContentParse(i,{eventTarget:e}),e.preventDefault()}}))}catch(e){this.$sendLog({logData:{message:e.message,info:Object(S.yb)({pageId:this.data.pageId})},logTitle:"按键（onKeyDown）事件错误"})}},errorValidator:function(e){var t,a,i,n=(null==e||null===(t=e.error)||void 0===t?void 0:t.message)||(null==e?void 0:e.message),r=(null==e||null===(a=e.error)||void 0===a?void 0:a.errorId)||(null==e?void 0:e.errorId),o=(null==e||null===(i=e.error)||void 0===i?void 0:i.errorCode)||(null==e?void 0:e.errorCode);this.dialogNoPermissionSupport="permission_not_support"===r,this.dialogNoPublish="8103000d"===o,this.dialogNoPermissionSupport&&this.fromPageId||this.dialogNoPublish&&this.fromPageId||this.$message.error(n)},clearDataByPageId:function(e){e&&this.$store.dispatch("deletePageParserInstance",e)},getPageInfo:function(e,t){var a=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Object(V.a)(x.a.mark((function n(){var r,o,l,s,c,u,d;return x.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a.loading=!0,e||t){n.next=5;break}return a.$message.error("参数 pageId 不能为空"),a.loading=!1,n.abrupt("return");case 5:if(c=(null===(r=a.params)||void 0===r?void 0:r.pageVersion)||(null===(o=a.queries)||void 0===o?void 0:o.pageVersion),u=null!==(l=a.params)&&void 0!==l&&l.onlyPreview||c?"/api/page/preview":"/api/page/published-pages",d={url:u,method:"get",params:{targetType:null!=i?i:1},meta:{errorValidator:function(e){return a.errorValidator(e),!1}}},c&&(d.params.version=c),e?e.indexOf("/")>-1?d.params.pagePath=e:d.params.pageId=e:d.params.pagePath=t,!1===(null===(s=a.params)||void 0===s?void 0:s.enableCache)){n.next=23;break}n.prev=11,d.params.pagePath,n.next=18;break;case 17:a.loading=!1;case 18:n.next=23;break;case 20:n.prev=20,n.t0=n.catch(11);case 23:n.next=25;break;case 25:a.$util.request(d).then(function(){var e=Object(V.a)(x.a.mark((function e(t){return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:setTimeout(Object(V.a)(x.a.mark((function e(){var i;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.pageId&&a.$route.query.pageId&&a.$route.query.pageId.indexOf("/")>-1&&((i=a.$route.query).pageId=t.pageId,a.$router.replace({path:a.$route.path,query:i})),e.prev=1,!t){e.next=7;break}return a.loading=!0,e.next=6,a.renderPage(t,d.params.pagePath?d.params.pagePath:d.params.pageId);case 6:a.loading=!1;case 7:e.next=13;break;case 9:e.prev=9,e.t0=e.catch(1),a.$store.commit("SET_RUNTIME_PAGE_KV_LOADED",a.data.fid);case 13:case"end":return e.stop()}}),e,null,[[1,9]])}))),100);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){a.hideLoading(),a.$store.commit("SET_RUNTIME_PAGE_KV_LOADED",a.data.fid)}));case 26:case"end":return n.stop()}}),n,null,[[11,20]])})))()},renderPage:function(e,t){var a=this;return Object(V.a)(x.a.mark((function i(){var n;return x.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(a.isLeave){i.next=3;break}return i.next=3,a.lazyLoadComps(e,t).catch((function(e){}));case 3:if(a.isLeave){i.next=7;break}return i.next=6,a.getFromPageId();case 6:n=i.sent;case 7:a.isLeave||a.handlePage(e,n,t);case 8:case"end":return i.stop()}}),i)})))()},setAppStore:function(e,t){var a,i,n,r={dataType:Object(Oe.a)(t),content:t};try{n=JSON.stringify(r)}catch(e){}n&&null!==(a=window)&&void 0!==a&&null!==(i=a.flutter_inappwebview)&&void 0!==i&&i.callHandler&&window.flutter_inappwebview.callHandler("MessageDeal",{type:"saveDataToLocal",data:Object(f.a)({},e,n)})},getAppStore:function(e){var t=this;return Object(V.a)(x.a.mark((function a(){var i,n,r,o,l,s;return x.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(null===(i=window)||void 0===i||null===(n=i.flutter_inappwebview)||void 0===n||!n.callHandler){a.next=5;break}return a.next=3,window.flutter_inappwebview.callHandler("MessageDeal",{type:"getDataFromLocal",data:{keys:[e]}}).then((function(e){l=e}));case 3:a.next=6;break;case 5:l=t.$store.getters.componentKV;case 6:return s=null===(r=l)||void 0===r||null===(o=r.data)||void 0===o?void 0:o[e],a.abrupt("return",null==s?void 0:s.content);case 8:case"end":return a.stop()}}),a)})))()},lazyLoadComps:function(e,t){var a=this;return new Promise(function(){var t=Object(V.a)(x.a.mark((function t(i,n){var r,o,l,s,c;return x.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,r=JSON.parse(e.pageData),o=r.componentKV,l=[],!a.isMobile){t.next=11;break}return t.next=7,a.getAppStore("componentKV");case 7:(s=t.sent)&&(l=s||[]),t.next=12;break;case 11:l=a.$store.getters.componentKV;case 12:if(c=l.reduce((function(e,t){return Reflect.set(e,t.name,t.version),e}),{}),o&&o.length){t.next=16;break}return i(),t.abrupt("return");case 16:a.$util.request({url:"/api/component/components/content",method:"get",params:{names:o.join(","),versions:o.map((function(e){return c[e]?c[e]:0})).join(","),mergeType:0}}).then(function(){var e=Object(V.a)(x.a.mark((function e(t){var n,r,o,s,c,u,p,h,f,m;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.list||[],r=n.map((function(e){return e.name})),o=[],s=[],l.forEach((function(e){return r.includes(e.name)?s.push(e):o.push(e)})),c=[].concat(o,Object(d.a)(n)),a.isMobile?a.setAppStore("componentKV",c):a.$store.commit("SET_COMPONENT_KV",c),u=document.createElement("style"),!a.isMobile){e.next=14;break}return p=function(){var e=Object(V.a)(x.a.mark((function e(){var t,i;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=0;case 1:if(!(t<n.length)){e.next=13;break}if(!n[t].cssContent){e.next=6;break}u.append(n[t].cssContent),e.next=10;break;case 6:return e.next=8,a.getAppStore(n[t].name);case 8:null!=(i=e.sent)&&i.cssContent&&u.append(i.cssContent);case 10:t++,e.next=1;break;case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.next=12,p();case 12:e.next=15;break;case 14:t.cssContent?u.append(t.cssContent):n.forEach((function(e){e.cssContent&&u.append(e.cssContent)}));case 15:if((h=document.getElementsByTagName("head"))&&h.length&&h[0].append(u),f=window.Vue,s.forEach((function(e){return n.forEach((function(t){return e.name===t.name&&e.version!==t.version&&delete f.options.components[e.name]}))})),!a.isMobile){e.next=25;break}return m=function(){var e=Object(V.a)(x.a.mark((function e(){var t,i;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=0;case 1:if(!(t<n.length)){e.next=14;break}if(!n[t].jsContent){e.next=7;break}a.setAppStore(n[t].name,n[t]),Object(y.a)(n[t].jsContent),e.next=11;break;case 7:return e.next=9,a.getAppStore(n[t].name);case 9:null!=(i=e.sent)&&i.jsContent&&Object(y.a)(i.jsContent);case 11:t++,e.next=1;break;case 14:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.next=23,m();case 23:e.next=26;break;case 25:t.jsContent?Object(y.a)(t.jsContent):n.forEach((function(e){e.jsContent&&Object(y.a)(e.jsContent)}));case 26:i();case 27:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){n(new Error(e.message||e))})),t.next=23;break;case 20:t.prev=20,t.t0=t.catch(0),n(new Error(t.t0));case 23:case"end":return t.stop()}}),t,null,[[0,20]])})));return function(e,a){return t.apply(this,arguments)}}())},getFromPageId:function(){var e=this;return Object(V.a)(x.a.mark((function t(){var a,i;return x.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.fromPageId){t.next=2;break}return t.abrupt("return",e.fromPageId);case 2:if(e.fromPagePath){t.next=4;break}return t.abrupt("return");case 4:return a={url:"/api/page/pages/0?pagePath="+e.fromPagePath,method:"get"},t.next=7,e.$util.request(a);case 7:return i=t.sent,t.abrupt("return",i.id);case 9:case"end":return t.stop()}}),t)})))()},showLoading:function(e){var t,a=this.getDefaultLoadingText(this.data);t="object"===Object(Oe.a)(e)&&null!==e?e.loadingText&&e.loadingText||"":a,this.loading=!0,this.loadingType=2,this.loadingText=t},hideLoading:function(){this.loading=!1,this.loadingType=1},handleLoad:function(e){var t=this;this.data=e,setTimeout((function(){t.isLeave||t.$refs.viewArea&&(t.$refs.viewArea.register(),t.$refs.viewArea.onload(),t.$emit("pageViewLoaded",t.pageParse))}),0),this.hideLoading()},handlePage:function(e,t,a){var i=this;this.pageId=e.pageId,this.data.pageId=e.pageId;var n=new hi.a({pageInfo:e,pageId:e.pageId,pagePath:a,pageVariables:this.pageVariables,queries:this.queries,dialog:this.dialog,drawer:this.drawer,fromPageId:t||this.fromPageId,pageView:this,parentFid:this.parentFid,foreachAttrCallback:function(e){e.hasOwnProperty("editValue")&&"deviceVariable"===e.editValue.accessType&&(e.value="",i.attrList.push(e))},onbeforeload:this.handleBeforeLoad,onload:function(e){i.handleLoad(e),i.attrList.length&&i.requestDeviceRdata()}});this.pageParse=n},requestDeviceRdata:function(){var e=this,t=[];this.attrList.forEach((function(e){var a,i;null!=e&&null!==(a=e.editValue)&&void 0!==a&&null!==(i=a.deviceVariable)&&void 0!==i&&i.id&&t.push(e.editValue.deviceVariable.id)}));var a={url:"/api/realtimedata/multi-snapshot",method:"post",data:{instanceIds:t}};this.$util.request(a).then((function(t){var a=(Array.isArray(t)?t:[t]).reduce((function(e,t){return e[t.instanceId]=t.dataValue,e}),{});e.attrList.forEach((function(e){var t,i=null!==(t=a[e.editValue.deviceVariable.id])&&void 0!==t?t:"";i&&(e.value=i)}))})).catch((function(e){}))},handleBeforeLoad:function(e){try{this.$emit("pageViewBeforeLoad",this.pageParse);var t=e.page.attributes,a=t&&t.onbeforeload,i=a&&a.attributes,n=i&&i.content;(n.attributes||[]).find((function(e){var t;return!(null==e||null===(t=e.executionType)||void 0===t||!t.value)}))&&this.$eventContentParse(n,null,e.pageId)}catch(e){this.$sendLog({logData:{message:e.message,info:Object(S.yb)({pageId:this.data.pageId})},logTitle:"页面beforeload事件错误"})}}}},gi=(a("171e"),Object(l.a)(bi,(function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading$,expression:"loading$"}],staticClass:"page-view-cont",attrs:{"element-loading-text":e.loadingText$}},[e.isLeave||e.dialogNoPermissionSupport?e._e():t("ViewArea",{ref:"viewArea",attrs:{data:e.data,isAutoHeight:e.isAutoHeight,runtime:!0,pageId:e.data.pageId,fromPageId:e.fromPageId}}),e.dialogNoPermissionSupport&&e.fromPageId?t("div",{staticClass:"common-box",staticStyle:{height:"500px"}},[t("img",{staticClass:"no-permission-img",attrs:{src:"/modules/page-view/public/img/no-permission.png"}}),t("div",{staticClass:"tips"},[e._v("\n      抱歉，该页面您没有访问权限！\n    ")])]):e._e(),e.dialogNoPublish&&e.fromPageId?t("div",{staticClass:"common-box",staticStyle:{height:"700px"}},[t("img",{staticClass:"no-publish-img",attrs:{src:"/modules/page-view/public/img/no-publish.png"}}),t("div",{staticClass:"tips"},[e._v("\n      抱歉，该页面未发布！\n    ")])]):e._e()],1)}),[],!1,null,"0f67c3e2",null)).exports;function yi(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function _i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?yi(Object(a),!0).forEach((function(t){Object(f.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):yi(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var Ci={router:[{name:"page-view",openType:"children",routes:[{path:"/page-view",name:"预览页面",component:gi,meta:{keepAlive:!1}}]}],store:{name:"pageViewStore",state:{innerComponents:[st],pageContentHeight:0,localComponent:{},components:[],componentsKV:{},componentsUrl:"",disableComponents:[],componentInstanceKV:{},pageParserInstanceKV:{},cachedPageInfo:{},IframeLoadStatusKV:{},lazyLoad:{status:{customIconGroups:1},func:{customIconGroups:"initCustomIconGroups"}},customIconGroups:[],pagesKVLoaded:{}},getters:{pageViewStore:function(e){return new Proxy(e,{get:function(t,a,i){return"customIconGroups"===a&&t.lazyLoad.status[a]&&(window.$VUE_ROOT.$store.dispatch(e.lazyLoad.func[a]),window.$VUE_ROOT.$store.commit("NOT_LAZY_LOAD_RELOAD",a)),t[a]}})},getComponentInstanceByPageId:function(e){return function(t){return e.componentInstanceKV[t]}},getPageParserInstanceByPageId:function(e){return function(t){return e.pageParserInstanceKV[t]}},getPageParserInstanceByIframeNameInPageId:function(e){return function(t,a){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=(a||"").split(":")||[],r=function t(a){var r,o,l,s,c,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,d=e.componentInstanceKV[a]&&e.componentInstanceKV[a][n[u]],p=null==d||null===(r=d.data)||void 0===r||null===(o=r.attributes)||void 0===o||null===(l=o.value)||void 0===l||null===(s=l.editValue)||void 0===s||null===(c=s.page)||void 0===c?void 0:c.id;for(var h in e.pageParserInstanceKV)if(h.startsWith(p)){var f=e.pageParserInstanceKV[h];if(f.fromPageId===a&&(!f.parentFid||f.parentFid===d.data.fid)&&!!f.isTemp==!!i)return n.length>u+1?t(f,u++):f}};return n.length&&r(t)}},getComponentInstanceByComponentName:function(e){return function(t){var a=(t||"").split("_");if(2===a.length)for(var i in e.componentInstanceKV){var n,r=e.componentInstanceKV[i];if(i.startsWith(a[0])&&r[a[1]]&&e.componentInstanceKV.hasOwnProperty(null===(n=e.pageParserInstanceKV[i])||void 0===n?void 0:n.fromPageId))return r[a[1]]}}},cachedPageInfo:function(e){return e.cachedPageInfo},getIframePageLoading:function(e){return function(t){return!t||e.IframeLoadStatusKV[t]}},innerComponents:function(e){return e.innerComponents}},actions:{fetchPublishedPage:function(e,t){return e.commit,e.state,Object(V.a)(x.a.mark((function e(){var a,i;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={url:"/api/page/published-pages/batch",method:"post",data:t},e.next=3,window.$common.$util.request(a).then((function(e){i=e})).catch((function(e){}));case 3:return e.abrupt("return",i);case 4:case"end":return e.stop()}}),e)})))()},initCustomIconGroups:function(e,t){var a=e.commit,i=e.state,n=e.getters.portalInfo,r=null!=n&&n.isManagement&&"iot"!==(null==n?void 0:n.nameEn)?"COMMON":"IOT";window.$common.$util.request({url:"/api/model/profiles?$filter=identifier eq ICON_LIB",method:"get"}).then((function(e){var t;if(null!==(t=e.result)&&void 0!==t&&t.length){var n={url:"/api/model/instances?objectType=ICON_GROUP&$filter=status eq 1&$orderBy= updateTime asc&$page=1&$pageSize=9999",method:"get",params:{projectIdentifier:r}};window.$common.$util.request(n).then((function(e){if(i.customIconGroups=(e.result||[]).map((function(e){return _i(_i({},e),{},{label:e.name,custom:!0})})),i.customIconGroups.length){var t={url:"/api/model/instances?objectType=ICON_LIB&$filter=status eq 1&$orderBy= updateTime asc&$page=1&$pageSize=9999",method:"get"};window.$common.$util.request(t).then((function(e){i.customIconGroups.forEach((function(t){t.list=[],(e.result||[]).forEach((function(e){e.parentId===t.id&&t.list.push(_i(_i({},e),{},{name:e.url,alias:e.name}))}))})),a("NOT_LAZY_LOAD_RELOAD","customIconGroups")}))}}))}}))},deletePageParserInstance:function(e,t){var a=e.commit,i=e.dispatch,n=e.state;if(t){var r=n.pageParserInstanceKV[t];r&&(i("deleteComponentInstance",{pageId:t}),r.destroy(),a("DELETE_PAGE_PARSER_INSTANCE_BY_PAGE_ID",t))}},deleteComponentInstance:function(e,t){var a=e.commit,i=e.state;if(null!=t&&t.pageId){var n=i.componentInstanceKV[t.pageId];if(n)if(null!=t&&t.fid){var r,o,l,s=n[t.fid];s&&(s.$destroy(),delete n[t.fid],delete n[null==s||null===(r=s.data)||void 0===r||null===(o=r.attributes)||void 0===o||null===(l=o.componentName)||void 0===l?void 0:l.value])}else{for(var c in n){var u=n[c];u&&(u.$destroy(),delete n[c])}a("DELETE_COMPONENT_INSTANCE_BY_PAGE_ID",t.pageId)}}},setIframeLoadStatus:function(e,t){var a=e.commit;e.state,t.pageId&&t.iframeFid&&a("SET_IFRAME_LOAD_STATUS",t)},removeIframeLoadStatus:function(e,t){var a=e.commit;e.state,t.pageId&&a("REMOVE_IFRAME_LOAD_STATUS",t)},resetLazyLoad:function(e,t){var a=e.commit,i=e.state;if(t)a("RESET_LAZY_LOAD_RELOAD",t);else for(var n in i.lazyLoad.status)a("RESET_LAZY_LOAD_RELOAD",n)}},mutations:{SET_RUNTIME_PAGE_KV_LOADED:function(e,t){window.$VUE_ROOT.$set(e.pagesKVLoaded,t,!0)},SET_IFRAME_LOAD_STATUS:function(e,t){e.IframeLoadStatusKV[t.pageId]=t.iframeFid},NOT_LAZY_LOAD_RELOAD:function(e,t){e.lazyLoad.status[t]=0},REMOVE_IFRAME_LOAD_STATUS:function(e,t){delete e.IframeLoadStatusKV[t.pageId]},SET_COMPONENTS_VIEW:function(e,t){t=t||[],t="array"!==Object(y.g)(t)?[t]:t,e.components=t,t.forEach((function(t){e.componentsKV[t.name]=t}))},SET_PAGE_INFO_CACHE:function(e,t){var a=t.key,i=t.value;e.cachedPageInfo[a]=i},SET_COMPONENTS_URL_VIEW:function(e,t){e.componentsUrl=t||""},SET_COMPONENT_INSTANCE_BY_PAGE_ID:function(e,t){var a=e.componentInstanceKV[t.pageId];a||(a=e.componentInstanceKV[t.pageId]={}),a[t.fid]=t.componentInstance,a[t.componentName]=t.componentInstance;var i=e.pageParserInstanceKV[t.pageId];i&&i.doneChangeHandlers(t.fid)},DELETE_COMPONENT_INSTANCE_BY_PAGE_ID:function(e,t){delete e.componentInstanceKV[t]},SET_PAGE_PARSER_INSTANCE_BY_PAGE_ID:function(e,t){e.pageParserInstanceKV[t.pageId]=t.instance},DELETE_PAGE_PARSER_INSTANCE_BY_PAGE_ID:function(e,t){delete e.pageParserInstanceKV[t]},SET_PAGE_CONTENT_HEIGHT_VIEW:function(e,t){e.pageContentHeight=t},SET_LOCAL_COMPONENT_VIEW:function(e,t){e.localComponent=t},SET_DISABLE_COMPONENTS_VIEW:function(e,t){e.disableComponents=t},DELETE_COMPONENTS_VIEW:function(e){e.components=[],e.componentsKV={},e.disableComponents=[]}}},init:function(e){!function(e){for(var t in jt(e),_e)if(_e.hasOwnProperty(t)){var i=_e[t];if("util"===t){var n=e.prototype.$util;if(n)for(var r in i)n[r]||(n[r]=i[r]);else e.prototype.$util=i;continue}e.prototype["$"+t]||(e.prototype["$"+t]=i)}e.options.components.componentExtends=dt,e.component(gi.name,gi),e.component(h.name,h),e.component(g.name,g),e.component(ot.name,ot),e.component(ut.name,ut),e.component(At.name,At),e.prototype.$bus=e.prototype.$bus||new e,window.pageVersion=(window.pageVersion||a("9224").version)+"",window.$common.$util.chartUtils=Tt,window.$common.$util.chartComMixin=xt}(e||window.Vue)}},Oi=function(){this.Framework=null,this.Vue=null};Oi.prototype.install=function(e,t){if(!e)throw new Error("缺少Framework参数");t=t||window.Vue,Ci.init(t),pi.init(t),window.FRAMEWORK_CONFIG={PERMISSION_PATH_WHITE:["/page-editor","/page-view"]},window.$common.$util.addRoutes(Ci.router),window.$common.$util.addRoutes(pi.router),window.$common.$util.registerStoreModule(Ci.store),window.$common.$util.registerStoreModule(pi.store),this.Framework=e,this.Vue=t},Oi.prototype.setLocalComponent=function(e){e.find((function(e){return"string"===Object(y.g)(e)}))||(this.Framework.instances.store.commit("SET_LOCAL_COMPONENT_VIEW",e),this.Framework.instances.store.commit("SET_LOCAL_COMPONENT",e))},Oi.prototype.registerComponent=function(e){var t,a,i,n=this;if(!e)throw new Error("缺少组件");var r="object"===Object(y.g)(e)?[e]:e,o=null===(t=this.Vue)||void 0===t||null===(a=t.options)||void 0===a||null===(i=a.components)||void 0===i?void 0:i.componentExtends;r.forEach((function(e,t){if("string"===Object(y.g)(e)){if(!window.System)return void r.splice(t,1);var a=(new Date).getTime(),i=e+"?time=".concat(a);window.System.import(i).then((function(e){r.splice(t,1,e.default),n.setLocalComponent(r)})).catch((function(e){n.setLocalComponent(r)}))}e.extends=o})),this.setLocalComponent(r)},new Oi,i.default.config.productionTip=!1,i.default.config.silent=!0,i.default.use(r.a,{size:"small"}),window.$VUE_ROOT=new i.default({created:function(){jt(i.default)},mounted:function(){},render:function(e){return e(s)}}).$mount("#app")},"570a":function(e,t,a){"use strict";a("2cf4")},"572a":function(e,t,a){},"58de":function(e,t,a){"use strict";a("072f")},"5a6b":function(e,t,a){"use strict";a("1f4a")},"5aee":function(e,t,a){"use strict";a.r(t),t.default=a.p+"img/decompose.5dc400d0.svg"},"5b6c":function(e,t,a){"use strict";a("7f7f");var i=(a("8e6e"),a("ac6a"),a("456d"),a("bd86"));function n(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}a("c5f6");var r={name:"MoreInfo",props:{list:{type:Array,default:function(){return[]}},span:{type:Number,default:6},prop:{type:Object,default:function(){return{prop:"prop",name:"name",value:"value"}}}},computed:{ownProp:function(){return function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?n(Object(a),!0).forEach((function(t){Object(i.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):n(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({prop:"prop",name:"name",value:"value"},this.prop)}}},o=(a("ad63"),a("2877")),l=Object(o.a)(r,(function(){var e=this,t=e._self._c;return t("div",[t("el-row",{attrs:{gutter:12}},e._l(e.list,(function(a){return t("el-col",{key:a[e.ownProp.prop||e.ownProp.name],attrs:{span:e.span}},[t("div",{staticClass:"info-wrapper"},[t("div",{staticClass:"info-name",attrs:{title:a[e.ownProp.name]}},[e._v(e._s(a[e.ownProp.name])+"：")]),t("div",{staticClass:"info-value",attrs:{title:a[e.ownProp.value]}},[e._v(e._s(a[e.ownProp.value]))])])])})),1)],1)}),[],!1,null,"4f45b600",null);t.a=l.exports},"5ba0":function(e,t,a){},"5c68":function(e,t,a){"use strict";var i=(a("7f7f"),a("c5f6"),a("c276")),n=a("b19c"),r={name:"ComponentBoxWrapper",props:{data:{type:Object,default:function(){}},parentComponentName:{type:String,default:""},runtime:{type:Boolean,default:!1},id:{type:String,default:""},parentId:{type:String,default:""},lg:{type:Number,default:24},md:{type:Number,default:24},xs:{type:Number,default:24},sm:{type:Number,default:24},offset:{type:Number,default:0}},computed:{styles:function(){var e={},t=this.data.attributes,a=null==t?void 0:t.float;if(a&&!1!==a.visible){var r=Object(i.pb)(a.value,a.default);"none"===r?e.clear="both":(delete e.clear,e.float=r),this.setMarginDefault()}var o=null==t?void 0:t.margin;if(o){var l=Object(i.pb)(o.value,o.default||Object(i.nb)(o.name),o.type);if("array"===Object(n.g)(l)){var s=l.map((function(e,t){return(e||0)+"px"}));e.margin=s.join(" ")}else e.margin=l}var c=null==t?void 0:t.position;if(c){var u=Object(i.pb)(c.value,c.default);"none"!==u&&(e.position=u)}var d=null==t?void 0:t.left;if(d&&!1!==d.visible){var p=Object(i.pb)(d.value,d.default);p&&(e.left=p)}var h=null==t?void 0:t.right;if(h&&!1!==h.visible){var f=Object(i.pb)(h.value,h.default);f&&(e.right=f)}var m=null==t?void 0:t.top;if(m&&!1!==m.visible){var v=Object(i.pb)(m.value,m.default);v&&(e.top=v)}var b=null==t?void 0:t.bottom;if(b&&!1!==b.visible){var g=Object(i.pb)(b.value,b.default);g&&(e.bottom=g)}var y=t?t["z-index"]:null;if(y&&!1!==y.visible){var _=Object(i.pb)(y.value,y.default);e["z-index"]=_}var C=null==t?void 0:t.width;if(C&&!1!==C.visible){var O=Object(i.pb)(C.value,C.default);O&&(e.width=O)}(t&&t.height&&!1!==t.height.visible||this.data.isCurrentTopSDC)&&(!this.runtime&&this.data.isCurrentTopSDC||"ContainerSDC"!==this.data.name||void 0!==t.height.value||"auto"!==t.height.default?e.height=Object(i.pb)(t.height.value,t.height.default)||"100%":e.height="100%");var T=null==t?void 0:t.display;if(T&&!1!==T.visible){var V=Object(i.pb)(T.value,T.default)?"":"none";V&&(e.display=V)}var w=null==t?void 0:t.visibility;if(w&&!1!==w.visible){var P=Object(i.pb)(w.value,w.default);"none"!==P?e.visibility=P:e.display=P}return e["flex-shrink"]=0,e}},methods:{setMarginDefault:function(){var e,t,a=null===(e=this.data)||void 0===e||null===(t=e.attributes)||void 0===t?void 0:t.float;if(a&&!1!==a.visible){var n,r,o=Object(i.pb)(a.value,a.default),l=null===(n=this.data)||void 0===n||null===(r=n.attributes)||void 0===r?void 0:r.margin;"left"===o?this.$setAttr(l,"default",[0,10,0,0]):"right"===o?this.$setAttr(l,"default",[0,0,0,10]):this.$setAttr(l,"default",[0,0,0,0])}},handleSelect:function(){this.$emit("onSelect",this.id)}}},o=a("2877"),l=Object(o.a)(r,(function(){var e=this,t=e._self._c;return"flow"!==e.parentComponentName?t("el-col",{style:e.styles,attrs:{id:e.id,"data-parentId":e.parentId,lg:e.lg,md:e.md,xs:e.xs,sm:e.sm,offset:e.offset}},[e._t("default")],2):t("div",{style:e.styles,attrs:{id:e.id,"data-parentId":e.parentId}},[e._t("default")],2)}),[],!1,null,null,null);t.a=l.exports},"5c9f":function(e,t,a){"use strict";a.r(t),a("6762"),a("2fdb");var i=(a("8e6e"),a("456d"),a("75fc")),n=(a("28a5"),a("ac6a"),a("7f7f"),a("bd86")),r=(a("c5f6"),a("36f0")),o=a("b19c"),l=a("2f62");function s(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function c(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?s(Object(a),!0).forEach((function(t){Object(n.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):s(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var u={name:"NewIndicatorLinkEditor",alias:"指标数据",command:"new-indicator-link",mixins:[r.a],props:{visible:{type:String,default:function(){return!1}},showInput:{type:String,default:function(){return!0}},iconClass:{type:String,default:function(){return"el-icon-edit"}},data:{type:Object,default:function(){return{alias:"",type:"",default:"",value:"",primitiveLabels:""}}},placeholder:{type:String,default:""},autoSetValue:{type:Boolean,default:!0},linkType:{type:Number,default:function(){return 1}},handleRulesResult:{type:Function,default:function(){}},handleChangeResult:{type:Function,default:function(){}}},data:function(){return{queryLatestTypes:[{label:"是",value:1},{label:"否",value:0}],baseUrl:"/api/indicator/values/aggregation",viewMode:1,showVal:"",editVal:{accessType:"indicator",linkType:this.linkType,url:"/api/indicator/values/aggregation",method:"post",contentType:"application/json",fields:"",dataType:"",requestPayload:{indicatorIds:"",queryLatest:1,timeRangeType:"fixed",queryType:"1",updateTimeBegin:"",updateTimeEnd:"",relativeTime:"",dimensionTime:"",aggOperation:"",sortOperation:"",cmpOperation:"",precision:"",filters:""},variableEditData:{indicatorIdsData:{name:"indicatorIds",value:"",editValue:null},updateTimeBeginData:{name:"updateTimeBegin",value:"",editValue:null},updateTimeEndData:{name:"updateTimeEnd",value:"",editValue:null},dimensionTimeData:{name:"dimensionTime",value:"",editValue:null},compareTimeData:{name:" compareTime",value:"",editValue:null},parentIdData:{name:" parentId",value:"",editValue:null},timeDimensionData:{name:" timeDimension",value:"",editValue:null},projectData:{name:"project",value:"",editValue:null}},assistAttr:{relativeType:"",relativeNumber:1,timeDimension:"",orderNumber:1,orderType:"asc",compareType:"M2M",compareNumber:1,isNow:!1,compareTime:"",tableData:[],extraFilter:"",timeDimensionFilter:"",parentIdFilter:"",projectFilter:""},responseSchema:{},exceptionStrategy:"throw"},jsonValue:"{}",codeValue:"{}",responseSchema:"{}",codeOptions:{},codeJSONOptions:{},dialogVisible:this.visible,indicatorIds:"",queryTypes:[{label:"单点查询",value:"1"},{label:"区间查询",value:"2"},{label:"聚合",value:"3"},{label:"排序",value:"4"},{label:"比较",value:"5"}],timeDimensions:[{label:"分钟",value:"min"},{label:"小时",value:"hour"},{label:"日",value:"day"},{label:"月",value:"month"},{label:"年",value:"year"},{label:"周",value:"week"},{label:"季度",value:"quarter"}],aggOperations:[{label:"求和",value:"1"},{label:"求平均值",value:"2"},{label:"求最大值",value:"3"},{label:"求最小值",value:"4"},{label:"第一条",value:"5"},{label:"最后一条",value:"6"}],orderTypes:[{label:"升序",value:"asc"},{label:"降序",value:"desc"}],compareTypes:[{label:"同比",value:"Y2Y"},{label:"环比",value:"M2M"}],tableData:[],dialogInfo:{index:0,edit:!1},map:{1:["indicatorIds","filters","dimensionTime"],2:["indicatorIds","filters","updateTimeBegin","updateTimeEnd"]}}},computed:c(c({rules:function(){return{"requestPayload.indicatorIds":[{required:!0,message:"请选择",trigger:"change"}],"requestPayload.updateTimeBegin":[{required:!this.editVal.requestPayload.queryLatest,message:"请选择",trigger:"change"}],"requestPayload.updateTimeEnd":[{required:!this.editVal.requestPayload.queryLatest,message:"请选择",trigger:"change"}]}}},Object(l.a)(["measureOptions"])),{},{measureIndicatorDimensionDictOptions:function(){return this.measureOptions.measureIndicatorDimensionDictOptions.map((function(e){return c(c({},e),{},{label:e.name})}))},measureIndicatorProjectDictOptions:function(){return this.measureOptions.measureIndicatorProjectDictOptions.map((function(e){return c(c({},e),{},{label:e.name})}))},relativeTypes:function(){return"1"===this.editVal.requestPayload.queryType?[{label:"当期",value:"current"},{label:"上期",value:"last"}]:[{label:"当期",value:"current"},{label:"近期",value:"recent"},{label:"上期",value:"last"}]}}),watch:{"data.value":function(){this.initData()},visible:function(e){this.dialogVisible=e,e&&this.initData()}},created:function(){this.initData()},methods:{changeIndicatorIdsSelector:function(e){var t=e.type,a=e.payload;if("static"===t)this.editVal.requestPayload.indicatorIds=a.join(",");else{var i=[];a.forEach((function(e){i.push("".concat(e.name," eq ").concat(e.value))}));var n="$filter="+i.join(",");this.editVal.requestPayload.indicatorIds=n}this.editVal.requestPayload=Object(o.e)(this.editVal.requestPayload)},refreshEditValPayload:function(){"current"===this.editVal.assistAttr.relativeType&&(this.editVal.assistAttr.relativeNumber=1);var e=this.editVal.assistAttr,t=e.relativeType,a=e.relativeNumber,i=e.timeDimension,n=e.orderNumber,r=e.orderType,o=e.compareType,l=e.compareNumber,s=e.isNow,c=e.compareTime,u=t?"".concat(t,":").concat(a,":").concat(i):"";this.editVal.requestPayload.relativeTime=u;var d=n?"".concat(n,":").concat(r):"";this.editVal.requestPayload.sortOperation=d;var p=s?"now":c,h=o?"".concat(o,":").concat(l,":").concat(p):"";this.editVal.requestPayload.cmpOperation=h},changeVariable:function(e,t){this.editVal.requestPayload[t]=e},changeAssistVariable:function(e,t){this.editVal.assistAttr[t]=e},handleSwitchViewMode:function(e){this.viewMode=e,2===e&&this.jsonValueHandler()},responseSchemaBlur:function(e){this.responseSchema=e,this.editVal.responseSchema=Object(o.j)(e)},codeEditorBlur:function(e){this.codeValue=e,this.editVal.requestPayload=Object(o.j)(e)},codeEditorJSONBlur:function(e){this.editVal=Object(o.j)(e),this.codeValue=Object(o.b)(this.editVal.requestPayload)},handleSelectorFocus:function(e){this.$refs[e]&&this.$refs[e].onPopoverHide&&this.$refs[e].onPopoverHide()},initData:function(){this.commonInitData("indicator"),this.syncPropsToData(),this.syncPropsToFilter()},cleanData:function(){switch(this.editVal.requestPayload.queryType){case"1":case"2":this.editVal.requestPayload.aggOperation="",this.editVal.requestPayload.sortOperation="",this.editVal.requestPayload.cmpOperation="";break;case"3":this.editVal.requestPayload.sortOperation="",this.editVal.requestPayload.cmpOperation="";break;case"4":this.editVal.requestPayload.aggOperation="",this.editVal.requestPayload.cmpOperation="";break;case"5":this.editVal.requestPayload.aggOperation="",this.editVal.requestPayload.sortOperation=""}},initAssistAttrs:function(){var e=this.editVal.requestPayload,t=e.relativeTime,a=e.sortOperation,i=e.cmpOperation,n=t.split(":");this.editVal.assistAttr.relativeType=n[0],this.editVal.assistAttr.relativeNumber=Number(n[1]),this.editVal.assistAttr.timeDimension=n[2];var r=a.split(":");this.editVal.assistAttr.orderNumber=Number(r[0]),this.editVal.assistAttr.orderType=r[1];var o=i.split(":");this.editVal.assistAttr.compareType=o[0],this.editVal.assistAttr.compareNumber=Number(o[1]),this.editVal.assistAttr.isNow="now"===o[2],"now"!==o[2]&&(this.editVal.assistAttr.compareTime=o[2])},resetData:function(){this.showVal="",this.editVal={accessType:"indicator",linkType:this.linkType,url:"/api/indicator/values/aggregation",method:"post",contentType:"application/json",requestPayload:{indicatorIds:"",queryLatest:1,timeRangeType:"fixed",queryType:"1",updateTimeBegin:"",updateTimeEnd:"",relativeTime:"",dimensionTime:"",aggOperation:"",sortOperation:"",cmpOperation:"",precision:"",filters:""},variableEditData:{indicatorIdsData:{name:"indicatorIds",value:"",editValue:null},updateTimeBeginData:{name:"updateTimeBegin",value:"",editValue:null},updateTimeEndData:{name:"updateTimeEnd",value:"",editValue:null},dimensionTimeData:{name:"dimensionTime",value:"",editValue:null},compareTimeData:{name:" compareTime",value:"",editValue:null},parentIdData:{name:" parentId",value:"",editValue:null},timeDimensionData:{name:" timeDimension",value:"",editValue:null},projectData:{name:"project",value:"",editValue:null}},assistAttr:{relativeType:"",relativeNumber:1,timeDimension:"",orderNumber:1,orderType:"asc",compareType:"M2M",compareNumber:1,isNow:!1,compareTime:"",tableData:[],timeDimensionFilter:"",parentIdFilter:"",projectFilter:""},responseSchema:{},exceptionStrategy:"throw"},this.codeValue="{}",this.jsonValue="{}",this.commonResetData()},focusCodeEditor:function(){this.$refs.codeEditor&&this.$refs.codeEditor.setMethod("focus")},handleIconClick:function(){this.open()},open:function(){this.$setAttr(this.data,"editorDialogVisible",!0),this.dialogVisible=!0},close:function(){this.closeHandler("indicator")},clear:function(){this.clearByType("indicator")},cancel:function(){this.close()},handleCurrentChange:function(e){this.currentRow=e,this.editVal.url=e.id},getShowVal:function(){return Object(o.b)(this.editVal)},getTimeStamp:function(e){return new Date(e).valueOf()},additionalFilter:function(){var e=this.editVal.assistAttr.extraFilter;e&&(this.editVal.requestPayload.filters?this.editVal.requestPayload.filters=this.editVal.requestPayload.filters+","+e:this.editVal.requestPayload.filters="$filter=".concat(e))},staticParamFilter:function(){var e=this,t=this.editVal.assistAttr;[{name:"parentId",value:t.parentIdFilter},{name:"timeDimension",value:t.timeDimensionFilter},{name:"indicatorItemId",value:t.projectFilter}].forEach((function(t){t&&null!=t&&t.value&&(e.editVal.requestPayload.filters?e.editVal.requestPayload.filters=e.editVal.requestPayload.filters+","+"".concat(t.name," eq ").concat(t.value):e.editVal.requestPayload.filters="$filter=".concat(t.name," eq ").concat(t.value))}))},clickSure:function(){var e=this;if(this.syncTableToProps(),this.refreshEditValPayload(),this.additionalFilter(),this.staticParamFilter(),this.cleanData(),this.editVal.requestPayload.updateTimeEnd&&this.editVal.requestPayload.updateTimeBegin){var t=this.getTimeStamp(this.editVal.requestPayload.updateTimeEnd),a=this.getTimeStamp(this.editVal.requestPayload.updateTimeBegin);if("number"==typeof t&&"number"==typeof a&&!window.isNaN(t)&&!window.isNaN(a)&&a>t)return void this.$message({type:"error",message:"开始时间需要早于结束时间"})}this.$refs.form.validate((function(t){t&&e.commonSureHandler("indicator")}))},syncTableToProps:function(){var e=this.tableData,t=[],a=[],i={};e.forEach((function(e){for(var n in e.isDynamic?e.selected.forEach((function(t){i[t]?i[t].push(e.rowInfo[t]):i[t]=[e.rowInfo[t]]})):t.push(e.rowInfo.id),i){var r=i[n].join("::");a.push("".concat(n," eq ").concat(r))}}));var n=t.join(","),r=a.length?"$filter="+a.join(","):"";this.editVal.requestPayload.indicatorIds=n,this.editVal.requestPayload.filters=r,this.editVal.assistAttr.tableData=this.tableData},syncPropsToData:function(){this.tableData=this.editVal.assistAttr.tableData},syncPropsToFilter:function(){this.editVal.assistAttr.timeDimensionFilter&&(this.editVal.variableEditData.timeDimensionData={editValue:this.getEditValue(this.editVal.assistAttr.timeDimensionFilter)}),this.editVal.assistAttr.parentIdFilter&&(this.editVal.variableEditData.parentIdData={editValue:this.getEditValue(this.editVal.assistAttr.parentIdFilter)}),this.editVal.assistAttr.projectFilter&&(this.editVal.variableEditData.projectData={editValue:this.getEditValue(this.editVal.assistAttr.projectFilter)})},getEditValue:function(e){var t,a=/\$\{(.*?)\}/g.exec(e);return(null==a?void 0:a[0])===e?{static:"",type:"variable",variable:null===(t=a[1])||void 0===t?void 0:t.split(".")}:{static:e,type:"static",variable:[]}},getHandlerEditVal:function(){var e=Object(o.e)(this.editVal);return e.responseSchema||(e.responseSchema={}),e.url=this.baseUrl,e.responseSchema||(e.responseSchema={}),e.requestPayload||(e.requestPayload={}),e.variables=this.getVariables(e),e},getVariables:function(e){var t=this.getVariableNames(e.url),a=this.getVariableNames(e.requestPayload),n=this.getVariableNames(e.responseSchema);return this.formatVariables([].concat(Object(i.a)(t),Object(i.a)(a),Object(i.a)(n)))},validate:function(){return!0},changeTimeRangeType:function(){var e;"fixed"===(null===(e=this.editVal.requestPayload)||void 0===e?void 0:e.timeRangeType)&&(this.assistAttr.relativeType="")},handleInsertId:function(){this.dialogInfo={edit:!1,index:0},this.$refs.dynamicParams.reset(),this.$refs.dynamicParams.dialogVisible=!0},changeTable:function(e){var t=this.dialogInfo,a=t.index;t.edit?this.tableData.splice(a,1,e):this.tableData.push(e)},goEdit:function(e,t){this.dialogInfo={edit:!0,index:t},this.$refs.dynamicParams.enterEdit(e),this.$refs.dynamicParams.dialogVisible=!0},deleteRow:function(e,t){var a=this;this.$confirm("确定要删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){a.tableData.splice(t,1)})).catch((function(){}))},queryTypeChange:function(){this.editVal.assistAttr.relativeType="",this.editVal.assistAttr.relativeNumber=1,this.editVal.assistAttr.timeDimension=""}}},d=(a("6d84"),a("2877")),p=Object(d.a)(u,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"indicator-link-editor"},[e.showInput?t("el-input",{staticClass:"editor-input",attrs:{placeholder:e.placeholder,value:e.showVal,readonly:"",size:"mini",clearable:""},nativeOn:{click:function(t){return e.handleIconClick.apply(null,arguments)}}},[t("i",{staticClass:"el-input__icon array-editor-icon",class:e.iconClass,attrs:{slot:"suffix"},slot:"suffix"})]):e._e(),t("el-dialog",{staticClass:"indicator-link-editor-dialog",attrs:{visible:e.dialogVisible,"close-on-click-modal":!1,title:"指标关联配置",width:"70%","append-to-body":!0},on:{close:e.close}},[t("div",{staticClass:"hc-view-switch-content"},[t("el-form",{ref:"form",attrs:{"label-width":"200px",model:e.editVal,rules:e.rules}},[t("el-form-item",{attrs:{label:"查询类型",prop:"requestPayload.queryType"}},[t("el-select",{on:{change:e.queryTypeChange},model:{value:e.editVal.requestPayload.queryType,callback:function(t){e.$set(e.editVal.requestPayload,"queryType",t)},expression:"editVal.requestPayload.queryType"}},e._l(e.queryTypes,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),["1","2","3","4"].includes(e.editVal.requestPayload.queryType)?t("el-form-item",{attrs:{label:"时间范围类型",prop:"requestPayload.timeRangeType"}},[t("el-select",{on:{change:e.changeTimeRangeType},model:{value:e.editVal.requestPayload.timeRangeType,callback:function(t){e.$set(e.editVal.requestPayload,"timeRangeType",t)},expression:"editVal.requestPayload.timeRangeType"}},[t("el-option",{attrs:{label:"固定时间",value:"fixed"}}),t("el-option",{attrs:{label:"相对时间",value:"relative"}})],1)],1):e._e(),"fixed"===e.editVal.requestPayload.timeRangeType&&["2","3","4"].includes(e.editVal.requestPayload.queryType)?t("el-form-item",{attrs:{label:"开始时间",prop:"requestPayload.updateTimeBegin"}}):e._e(),"fixed"===e.editVal.requestPayload.timeRangeType&&["2","3","4"].includes(e.editVal.requestPayload.queryType)?t("el-form-item",{attrs:{label:"结束时间",prop:"requestPayload.updateTimeEnd"}}):e._e(),"relative"===e.editVal.requestPayload.timeRangeType&&["1","2","3","4"].includes(e.editVal.requestPayload.queryType)?t("el-form-item",{attrs:{label:"时间类型",prop:"assistAttr.relativeType"}},[t("el-select",{on:{change:e.refreshEditValPayload},model:{value:e.editVal.assistAttr.relativeType,callback:function(t){e.$set(e.editVal.assistAttr,"relativeType",t)},expression:"editVal.assistAttr.relativeType"}},e._l(e.relativeTypes,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1):e._e(),"relative"===e.editVal.requestPayload.timeRangeType&&["1","2","3","4"].includes(e.editVal.requestPayload.queryType)&&"current"!==e.editVal.assistAttr.relativeType?t("el-form-item",{attrs:{label:"偏移",prop:"assistAttr.relativeNumber"}},[t("el-input-number",{attrs:{min:1,disabled:"current"===e.editVal.assistAttr.relativeType},on:{change:e.refreshEditValPayload},model:{value:e.editVal.assistAttr.relativeNumber,callback:function(t){e.$set(e.editVal.assistAttr,"relativeNumber",t)},expression:"editVal.assistAttr.relativeNumber"}})],1):e._e(),"relative"===e.editVal.requestPayload.timeRangeType&&["1","2","3","4"].includes(e.editVal.requestPayload.queryType)?t("el-form-item",{attrs:{label:"时间维度",prop:"assistAttr.timeDimension"}},[t("el-select",{on:{change:e.refreshEditValPayload},model:{value:e.editVal.assistAttr.timeDimension,callback:function(t){e.$set(e.editVal.assistAttr,"timeDimension",t)},expression:"editVal.assistAttr.timeDimension"}},e._l(e.timeDimensions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1):e._e(),"fixed"===e.editVal.requestPayload.timeRangeType&&"1"===e.editVal.requestPayload.queryType?t("el-form-item",{attrs:{label:"维度时间",prop:"requestPayload.dimensionTime"}}):e._e(),"3"===e.editVal.requestPayload.queryType?t("el-form-item",{attrs:{label:"聚合操作",prop:"requestPayload.aggOperation"}},[t("el-select",{model:{value:e.editVal.requestPayload.aggOperation,callback:function(t){e.$set(e.editVal.requestPayload,"aggOperation",t)},expression:"editVal.requestPayload.aggOperation"}},e._l(e.aggOperations,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1):e._e(),"4"===e.editVal.requestPayload.queryType?t("el-form-item",{attrs:{label:"排序顺序",prop:"assistAttr.orderType"}},[t("el-select",{on:{change:e.refreshEditValPayload},model:{value:e.editVal.assistAttr.orderType,callback:function(t){e.$set(e.editVal.assistAttr,"orderType",t)},expression:"editVal.assistAttr.orderType"}},e._l(e.orderTypes,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1):e._e(),"4"===e.editVal.requestPayload.queryType?t("el-form-item",{attrs:{label:"取前几个",prop:"assistAttr.orderNumber"}},[t("el-input-number",{attrs:{min:1},on:{change:e.refreshEditValPayload},model:{value:e.editVal.assistAttr.orderNumber,callback:function(t){e.$set(e.editVal.assistAttr,"orderNumber",t)},expression:"editVal.assistAttr.orderNumber"}})],1):e._e(),"5"===e.editVal.requestPayload.queryType?t("el-form-item",{attrs:{label:"比较类型",prop:"assistAttr.compareType"}},[t("el-select",{on:{change:e.refreshEditValPayload},model:{value:e.editVal.assistAttr.compareType,callback:function(t){e.$set(e.editVal.assistAttr,"compareType",t)},expression:"editVal.assistAttr.compareType"}},e._l(e.compareTypes,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1):e._e(),"5"===e.editVal.requestPayload.queryType?t("el-form-item",{attrs:{label:"比较偏移量",prop:"assistAttr.compareNumber"}},[t("el-input-number",{attrs:{min:1},on:{change:e.refreshEditValPayload},model:{value:e.editVal.assistAttr.compareNumber,callback:function(t){e.$set(e.editVal.assistAttr,"compareNumber",t)},expression:"editVal.assistAttr.compareNumber"}})],1):e._e(),"5"===e.editVal.requestPayload.queryType?t("el-form-item",{attrs:{label:"从现在比较",prop:"assistAttr.isNow"}},[t("el-checkbox",{on:{change:e.refreshEditValPayload},model:{value:e.editVal.assistAttr.isNow,callback:function(t){e.$set(e.editVal.assistAttr,"isNow",t)},expression:"editVal.assistAttr.isNow"}})],1):e._e(),"5"!==e.editVal.requestPayload.queryType||e.editVal.assistAttr.isNow?e._e():t("el-form-item",{attrs:{label:"输入时间",prop:"assistAttr.compareTime"}}),t("el-form-item",{attrs:{label:"指标项"}},[t("el-button",{staticStyle:{float:"right"},attrs:{type:"primary"},on:{click:e.handleInsertId}},[e._v("增加指标项")]),t("el-table",{staticStyle:{width:"100%","max-height":"300px","overflow-y":"auto"},attrs:{data:e.tableData,"tooltip-effect":"dark"}},[t("el-table-column",{attrs:{prop:"rowInfo.identifier",label:"标识",width:"120"}}),t("el-table-column",{attrs:{prop:"rowInfo.name",label:"名称"}}),t("el-table-column",{attrs:{prop:"isDynamic",label:"是否维度取值"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(t.row.isDynamic?"是":"否")+"\n              ")]}}])}),t("el-table-column",{attrs:{label:"操作",width:"100"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){return e.goEdit(a.row,a.$index)}}},[e._v("编辑")]),t("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){return e.deleteRow(a.row,a.$index)}}},[e._v("删除")])]}}])})],1)],1),t("el-form-item",{attrs:{label:"筛选项",prop:"assistAttr.extraFilter"}},[t("div",{staticClass:"filters"},[t("div",{staticClass:"filters-item"},[t("span",[e._v("时间维度")])]),t("div",{staticClass:"filters-item"},[t("span",[e._v("组织机构")])]),t("div",{staticClass:"filters-item"},[t("span",[e._v("项目/主题")])])])]),t("el-form-item",{attrs:{label:"额外筛选",prop:"assistAttr.extraFilter"}},[t("el-input",{on:{change:this.refreshEditValPayload},model:{value:e.editVal.assistAttr.extraFilter,callback:function(t){e.$set(e.editVal.assistAttr,"extraFilter",t)},expression:"editVal.assistAttr.extraFilter"}})],1),t("exception-strategy",{model:{value:e.editVal.exceptionStrategy,callback:function(t){e.$set(e.editVal,"exceptionStrategy",t)},expression:"editVal.exceptionStrategy"}}),t("response-schema",{attrs:{visible:e.dialogVisible,value:e.responseSchema},on:{blur:e.responseSchemaBlur}}),t("common-link-set",{attrs:{config:e.commonLinkSet,data:e.data,defaultLoad:e.defaultLoad}})],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"danger"},on:{click:e.clear}},[e._v("清 空")]),t("el-button",{on:{click:e.cancel}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.clickSure}},[e._v("确 定")])],1)])],1)}),[],!1,null,"4057c9b6",null);t.default=p.exports},"5dda":function(e,t,a){},"5f6d":function(e,t,a){"use strict";a("3019")},"5fd4":function(e,t,a){"use strict";a("213b")},6122:function(e,t,a){"use strict";a("4cfa")},"62a5":function(e,t,a){},"62bd":function(e,t,a){},6371:function(e,t,a){"use strict";a("6e9d")},6375:function(e,t,a){"use strict";a("268c")},"643b":function(e,t,a){"use strict";var i=a("75fc"),n=(a("7514"),a("ac6a"),{name:"TemplateTable",props:{data:{type:Array,default:function(){return[]}},types:{type:Object,default:function(){return{}}},propertyTypeMap:{type:Object,default:function(){return{}}},pagination:{type:Object,default:function(){return{page:1,pageSize:10,total:0}}},multipleSelection:{type:Array,default:function(){return[]}}},data:function(){return{pageSizes:[10,20,50,100],tagType:{collect:"",calculate:"success",indicator:"warning",manual:"danger",measuringPoint:"info"}}},methods:{handleSelected:function(e){var t=this;setTimeout((function(){t.data.forEach((function(a){if(e.some((function(e){return e.id===a.id||e.identifier===a.identifier}))){var i=t.$refs.table.tableData.find((function(e){return e.id===a.id}));i&&t.$refs.table.toggleRowSelection(i,!0)}}))}),100)},typeFormat:function(e){return this.types[this.propertyTypeMap[e]]||e},handleSelectChange:function(e){var t,a=this;this.multipleSelection||(this.multipleSelection=[]);for(var n=0,r=function(){var e=a.multipleSelection[n];a.data.some((function(t){return t.id===e.id}))?a.multipleSelection.splice(n,1):n++};n<((null===(o=this.multipleSelection)||void 0===o?void 0:o.length)||0);){var o;r()}(t=this.multipleSelection).splice.apply(t,[this.multipleSelection.length,0].concat(Object(i.a)(e))),this.$emit("selectionChange",this.multipleSelection)},handleSizeChange:function(e){this.pagination.pageSize=e,this.$emit("paginationChange",this.pagination)},handleCurrentChange:function(e){this.pagination.page=e,this.$emit("paginationChange",this.pagination)},clearSelection:function(){var e,t;null===(e=this.$refs)||void 0===e||null===(t=e.table)||void 0===t||t.clearSelection()}}}),r=(a("ea9c"),a("6887"),a("2877")),o=Object(r.a)(n,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"template-table"},[t("el-table",{ref:"table",staticStyle:{width:"100%"},attrs:{data:e.data},on:{select:e.handleSelectChange,"select-all":e.handleSelectChange}},[t("el-table-column",{attrs:{type:"selection",width:"70"}}),t("el-table-column",{attrs:{prop:"propertyType",label:"类型",width:"100"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tag",{attrs:{type:e.tagType[e.propertyTypeMap[a.row.propertyType]],size:"mini"}},[e._v(e._s(e.typeFormat(a.row.propertyType)))])]}}])}),t("el-table-column",{attrs:{prop:"name",label:"名称",width:"180"}}),t("el-table-column",{attrs:{prop:"identifier",label:"标识"}})],1),t("el-pagination",{staticClass:"template-pagination",attrs:{size:"small","current-page":e.pagination.page,"page-sizes":e.pageSizes,"page-size":e.pagination.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.pagination.total||e.data.length},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)}),[],!1,null,"df20ae60",null);t.a=o.exports},"653c":function(e,t,a){},"65d4":function(e,t,a){"use strict";a("c5f6"),a("87f3");var i=(a("8e6e"),a("ac6a"),a("456d"),a("bd86")),n=a("2f62");function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){Object(i.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var l={name:"RadioCard",model:{prop:"value",event:"change"},props:{data:{type:Array,default:function(){return[]}},value:{type:String,default:""}},computed:o(o({},Object(n.a)(["themeConstColor"])),{},{itemCheckBg:function(){return{borderColor:"transparent ".concat(this.themeConstColor.primary," transparent transparent")}},itemStyle:function(){var e=this.data.length,t=e?Math.floor(100*Math.pow(10,4)/e)/Math.pow(10,4):100;return{width:"".concat(t,"%")}}}),methods:{isActive:function(e){return e.value===this.value},itemBoxStyle:function(e){return{borderColor:this.isActive(e)?this.themeConstColor.primary:""}},onValueChange:function(e){this.$emit("change",e)},getDescription:function(e){return e.length>18?"".concat(e.substring(0,18),"..."):e}}},s=(a("749c"),a("2877")),c={name:"ParamSetting",components:{RadioCard:Object(s.a)(l,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"radio-card"},e._l(e.data,(function(a,i){return t("div",{key:i,staticClass:"radio-card-item",style:e.itemStyle},[t("div",{staticClass:"item-box t-border t-text-secondary",style:e.itemBoxStyle(a),on:{click:function(t){return e.onValueChange(a.value)}}},[e.isActive(a)?t("div",{staticClass:"item-check"},[t("div",{staticClass:"item-check-bg",style:e.itemCheckBg}),t("i",{staticClass:"el-icon-check"})]):e._e(),t("p",{staticClass:"item-label"},[e._v(e._s(a.label))]),t("p",{staticClass:"item-description",attrs:{title:a.description}},[e._v(e._s(e.getDescription(a.description)))])])])})),0)}),[],!1,null,"47394d1a",null).exports},props:{editVal:{type:Object,default:function(){return{}}},listItemVisible:{type:Array,default:function(){return[]}}},data:function(){return{rules:{compareTime:[{trigger:"change",required:!0,message:"输入时间不能为空"}],aggOperation:[{trigger:"change",required:!0,message:"聚合操作不能为空"}],timeDimension:[{trigger:"change",required:!0,message:"时间维度不能为空"}],dimensionTimeFilter:[{trigger:"change",required:!0,message:"维度时间不能为空"}],updateTimeBegin:[{trigger:"change",required:!0,message:"开始时间不能为空"}],updateTimeEnd:[{trigger:"change",required:!0,message:"结束时间不能为空"}],orderNumber:[{trigger:"change",required:!0,message:"取前几个不能为空"},{trigger:"change",pattern:/^\d+$/,message:"只能输入正整数"}],compareNumber:[{trigger:"blur",required:!0,message:"比较偏移量不能为空"},{trigger:"blur",pattern:/^\d+$/,message:"只能输入正整数"}]},compoundItem:[{label:"变量选择",value:"variable",formItem:"variable-Panel"},{label:"手动输入",value:"static",formItem:"date-picker"}],timeRangeOption:[{label:"固定时间",value:"fixed"},{label:"相对时间",value:"relative"}],timeDimensions:[{label:"分钟",value:"minute"},{label:"小时",value:"hour"},{label:"日",value:"day"},{label:"月",value:"month"},{label:"年",value:"year"},{label:"周",value:"week"},{label:"季度",value:"quarter"}],aggOptions:[{label:"求和",value:"1"},{label:"求平均值",value:"2"},{label:"求最大值",value:"3"},{label:"求最小值",value:"4"},{label:"第一条",value:"5"},{label:"最后一条",value:"6"}],orderTypes:[{label:"升序",value:"asc"},{label:"降序",value:"desc"}],compareTypes:[{label:"同比",value:"Y2Y"},{label:"环比",value:"M2M"}]}},computed:{timeDimension:function(){return"relative"===this.editVal.requestPayload.timeRangeType&&this.checkFlag(30)&&(!this.checkFlag(2)||"current"!==this.editVal.assistAttr.relativeType)},getDimensionMax:function(){var e,t,a=100,i=864e3;switch((null==this||null===(e=this.editVal)||void 0===e||null===(t=e.assistAttr)||void 0===t?void 0:t.timeDimension)||""){case"year":return a;case"quarter":return 400;case"month":return 1200;case"week":return 5200;case"day":return 36e3;case"hour":return i;case"min":return 5184e4;default:return a}},relativeNumberRules:function(){var e=this;return[{trigger:"blur",required:!0,message:"偏移不能为空"},{trigger:"blur",pattern:/^\d+$/,message:"只能输入正整数"},{trigger:"change",validator:function(t,a,i){a>e.getDimensionMax?i(new Error("偏移不能大于".concat(e.getDimensionMax))):i()}}]},relativeTypes:function(){return this.checkFlag(2)?[{label:"当期",value:"current"},{label:"上期",value:"last"}]:[{label:"当期",value:"current"},{label:"近期",value:"recent"},{label:"上期",value:"last"}]},list:function(){var e=this;return[{label:"单点查询",value:"1",description:"查询一个或者多个指标在某一时间点（维度时间）的值，不限制指标结果类型"},{label:"区间查询",value:"2",description:"对一个或者多个指标基于时间区间做特定的聚合操作，不限制指标结果类型"},{label:"聚合",value:"3",description:"对一个或者多个指标基于时间区间做特定的聚合操作，指标结果类型需为数值型"},{label:"排序",value:"4",description:"对给定的多个指标，在指定的时间区间内，根据指标值的大小求TOP几，指标结果类型需为数值型"},{label:"比较",value:"5",description:"比较操作目前支持环比、同比，指标结果类型需为数值型"}].filter((function(t){var a;return!(null!==(a=e.listItemVisible)&&void 0!==a&&a.length)||e.listItemVisible.some((function(e){return e+""===t.value}))}))}},watch:{timeDimension:{handler:function(e,t){e||""===this.editVal.assistAttr.timeDimension&&(this.editVal.assistAttr.timeDimension="year")},immediate:!0}},created:function(){this.refreshEditValPayload()},methods:{handleCompareTimeChange:function(e){this.editVal.assistAttr.compareTime=e,this.refreshEditValPayload()},handleTimeRangeTypeChange:function(){var e,t;null!=this&&null!==(e=this.editVal)&&void 0!==e&&null!==(t=e.assistAttr)&&void 0!==t&&t.relativeNumber&&(this.editVal.assistAttr.relativeNumber=void 0),this.clearValidate(["relativeNumber"]),this.refreshEditValPayload()},handleQueryTypeChange:function(e){this.dealValues(e),this.clearValidate(e)},dealValues:function(e){"1"===e&&"recent"===this.editVal.assistAttr.relativeType&&(this.editVal.assistAttr.relativeType="current")},checkFlag:function(e){var t,a;return e&1<<+(null==this||null===(t=this.editVal)||void 0===t||null===(a=t.requestPayload)||void 0===a?void 0:a.queryType)},clearValidate:function(e){this.$emit("clearValidate",e)},changeTimeRangeType:function(e){this.clearValidate()},changeVariable:function(e,t){this.editVal.requestPayload[t]=e},refreshEditValPayload:function(){var e,t;"current"===this.editVal.assistAttr.relativeType&&(this.editVal.assistAttr.relativeNumber=1);var a=this.editVal.assistAttr,i=a.relativeType,n=a.relativeNumber,r=a.timeDimension,o=a.orderNumber,l=a.orderType,s=a.compareType,c=a.compareNumber,u=a.isNow,d=a.compareTime,p=a.dimensionTimeFilter,h=i?"".concat(i,":").concat(n,":").concat(r):"";this.editVal.requestPayload.relativeTime=h;var f=o?"".concat(o,":").concat(l):"";this.editVal.requestPayload.sortOperation=f;var m=u?"now":d,v=s?"".concat(s,":").concat(c,":").concat(m):"";this.editVal.requestPayload.cmpOperation=v;var b=this.editVal.variableEditData,g=b.updateTimeBeginData,y=b.updateTimeEndData;this.editVal.requestPayload.dimensionTime=p,this.editVal.requestPayload.updateTimeBegin=null!==(e=g.value)&&void 0!==e?e:"",this.editVal.requestPayload.updateTimeEnd=null!==(t=y.value)&&void 0!==t?t:""}}},u=(a("471b"),Object(s.a)(c,(function(){var e=this,t=e._self._c;return t("div",[t("radio-card",{attrs:{data:e.list},on:{change:e.handleQueryTypeChange},model:{value:e.editVal.requestPayload.queryType,callback:function(t){e.$set(e.editVal.requestPayload,"queryType",t)},expression:"editVal.requestPayload.queryType"}}),t("div",{staticClass:"param-setting"},[e.checkFlag(30)?t("el-form-item",{key:"timeRangeType",attrs:{label:"时间范围类型",prop:"requestPayload.timeRangeType"}},[t("el-radio-group",{on:{change:e.changeTimeRangeType},model:{value:e.editVal.requestPayload.timeRangeType,callback:function(t){e.$set(e.editVal.requestPayload,"timeRangeType",t)},expression:"editVal.requestPayload.timeRangeType"}},e._l(e.timeRangeOption,(function(a){return t("el-radio",{key:a.value,attrs:{label:a.value}},[e._v(e._s(a.label))])})),1)],1):e._e(),"fixed"===e.editVal.requestPayload.timeRangeType&&e.checkFlag(28)?t("el-form-item",{key:"updateTimeBegin",attrs:{label:"开始时间",rules:e.rules.updateTimeBegin,prop:"requestPayload.updateTimeBegin"}},[t("variable-editor-components",{attrs:{compoundItem:e.compoundItem,"value-format":"yyyy-MM-dd HH:mm:ss",data:e.editVal.variableEditData.updateTimeBeginData},on:{change:function(t){return e.changeVariable(t,"updateTimeBegin")}}})],1):e._e(),"fixed"===e.editVal.requestPayload.timeRangeType&&e.checkFlag(28)?t("el-form-item",{key:"updateTimeEnd",attrs:{label:"结束时间",rules:e.rules.updateTimeEnd,prop:"requestPayload.updateTimeEnd"}},[t("variable-editor-components",{attrs:{compoundItem:e.compoundItem,"value-format":"yyyy-MM-dd HH:mm:ss",data:e.editVal.variableEditData.updateTimeEndData},on:{change:function(t){return e.changeVariable(t,"updateTimeEnd")}}})],1):e._e(),"relative"===e.editVal.requestPayload.timeRangeType&&e.checkFlag(30)?t("el-form-item",{key:"relativeType",attrs:{prop:"assistAttr.relativeType"}},[t("template",{slot:"label"},[e._v("\n        时间类型\n        ")]),t("el-radio-group",{on:{change:e.refreshEditValPayload},model:{value:e.editVal.assistAttr.relativeType,callback:function(t){e.$set(e.editVal.assistAttr,"relativeType",t)},expression:"editVal.assistAttr.relativeType"}},e._l(e.relativeTypes,(function(a){return t("el-radio",{key:a.value,attrs:{label:a.value}},[e._v(e._s(a.label))])})),1)],2):e._e(),"relative"===e.editVal.requestPayload.timeRangeType&&e.checkFlag(30)&&"current"!==e.editVal.assistAttr.relativeType?t("el-form-item",{key:"relativeNumber",attrs:{label:"偏移",rules:e.relativeNumberRules,prop:"assistAttr.relativeNumber"}},[t("el-input-number",{staticClass:"field-class",attrs:{min:1,"step-strictly":"",step:1,max:e.getDimensionMax,disabled:"current"===e.editVal.assistAttr.relativeType},on:{change:e.refreshEditValPayload},model:{value:e.editVal.assistAttr.relativeNumber,callback:function(t){e.$set(e.editVal.assistAttr,"relativeNumber",t)},expression:"editVal.assistAttr.relativeNumber"}})],1):e._e(),e.timeDimension?t("el-form-item",{key:"timeDimension",attrs:{label:"时间维度",prop:"assistAttr.timeDimension",rules:e.rules.timeDimension}},[t("el-select",{staticClass:"field-class",on:{change:e.handleTimeRangeTypeChange},model:{value:e.editVal.assistAttr.timeDimension,callback:function(t){e.$set(e.editVal.assistAttr,"timeDimension",t)},expression:"editVal.assistAttr.timeDimension"}},e._l(e.timeDimensions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1):e._e(),"fixed"===e.editVal.requestPayload.timeRangeType&&e.checkFlag(2)?t("el-form-item",{key:"dimensionTimeFilter",attrs:{label:"维度时间",prop:"assistAttr.dimensionTimeFilter",rules:e.rules.dimensionTimeFilter}},[t("variable-editor-components",{attrs:{compoundItem:e.compoundItem,data:e.editVal.variableEditData.dimensionTimeData},on:{change:function(t){e.editVal.assistAttr.dimensionTimeFilter=t,e.changeVariable(t,"dimensionTime")}}})],1):e._e(),e.checkFlag(8)?t("el-form-item",{key:"aggOperation",attrs:{label:"聚合操作",prop:"requestPayload.aggOperation",rules:e.rules.aggOperation}},[t("el-radio-group",{model:{value:e.editVal.requestPayload.aggOperation,callback:function(t){e.$set(e.editVal.requestPayload,"aggOperation",t)},expression:"editVal.requestPayload.aggOperation"}},e._l(e.aggOptions,(function(a){return t("el-radio",{key:a.value,attrs:{label:a.value}},[e._v(e._s(a.label))])})),1)],1):e._e(),e.checkFlag(16)?t("el-form-item",{key:"orderType",attrs:{label:"排序顺序",prop:"assistAttr.orderType"}},[t("el-radio-group",{on:{change:e.refreshEditValPayload},model:{value:e.editVal.assistAttr.orderType,callback:function(t){e.$set(e.editVal.assistAttr,"orderType",t)},expression:"editVal.assistAttr.orderType"}},e._l(e.orderTypes,(function(a){return t("el-radio",{key:a.value,attrs:{label:a.value}},[e._v(e._s(a.label))])})),1)],1):e._e(),e.checkFlag(16)?t("el-form-item",{key:"orderNumber",attrs:{label:"取前几个",prop:"assistAttr.orderNumber",rules:e.rules.orderNumber}},[t("el-input-number",{staticClass:"field-class",attrs:{min:1,max:Number.MAX_SAFE_INTEGER,"step-strictly":"",step:1},on:{change:e.refreshEditValPayload},model:{value:e.editVal.assistAttr.orderNumber,callback:function(t){e.$set(e.editVal.assistAttr,"orderNumber",t)},expression:"editVal.assistAttr.orderNumber"}})],1):e._e(),e.checkFlag(32)?t("el-form-item",{key:"compareType",attrs:{label:"比较类型",prop:"assistAttr.compareType"}},[t("el-radio-group",{on:{change:e.refreshEditValPayload},model:{value:e.editVal.assistAttr.compareType,callback:function(t){e.$set(e.editVal.assistAttr,"compareType",t)},expression:"editVal.assistAttr.compareType"}},e._l(e.compareTypes,(function(a){return t("el-radio",{key:a.value,attrs:{label:a.value}},[e._v(e._s(a.label))])})),1)],1):e._e(),"Y2Y"===e.editVal.assistAttr.compareType&&e.checkFlag(32)?t("el-form-item",{key:"compareNumber",attrs:{label:"比较偏移量",prop:"assistAttr.compareNumber",rules:e.rules.compareNumber}},[t("el-input-number",{staticClass:"field-class",attrs:{min:1,max:100,"step-strictly":"",step:1},on:{change:e.refreshEditValPayload},model:{value:e.editVal.assistAttr.compareNumber,callback:function(t){e.$set(e.editVal.assistAttr,"compareNumber",t)},expression:"editVal.assistAttr.compareNumber"}})],1):e._e(),e.checkFlag(32)?t("el-form-item",{key:"isNow",attrs:{label:"从现在比较",prop:"assistAttr.isNow"}},[t("el-checkbox",{on:{change:e.refreshEditValPayload},model:{value:e.editVal.assistAttr.isNow,callback:function(t){e.$set(e.editVal.assistAttr,"isNow",t)},expression:"editVal.assistAttr.isNow"}})],1):e._e(),e.checkFlag(32)&&!e.editVal.assistAttr.isNow?t("el-form-item",{key:"compareTime",attrs:{label:"输入时间",prop:"assistAttr.compareTime",rules:e.rules.compareTime}},[t("variable-editor-components",{attrs:{compoundItem:e.compoundItem,data:e.editVal.variableEditData.compareTimeData},on:{change:e.handleCompareTimeChange}})],1):e._e()],1)],1)}),[],!1,null,"88013352",null));t.a=u.exports},"662a":function(e,t,a){"use strict";a("77df")},"66b3":function(e,t,a){"use strict";a.r(t);var i=(a("ac4d"),a("8a81"),a("5df3"),a("1c4c"),a("6b54"),a("8e6e"),a("456d"),a("55dd"),a("a481"),a("28a5"),a("7618")),n=(a("6762"),a("2fdb"),a("ac6a"),a("7f7f"),a("75fc")),r=a("bd86"),o=(a("c5f6"),a("36f0")),l=a("b19c"),s=a("c7fd"),c=a("d8fe"),u=(a("1816"),a("8e8a")),d=a("bc2d"),p=a("91ff"),h=a("ae83"),f=(a("20d6"),function(){var e=this;return(0,e._self._c)("el-cascader",{staticStyle:{width:"100%"},attrs:{options:e.options,children:"value.children"},on:{change:e.handleChange},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}})});function m(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function v(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?m(Object(a),!0).forEach((function(t){Object(r.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):m(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var b={name:"PresetApiList",created:function(){var e,t=this;null!==(e=this.defaultValue)&&void 0!==e&&e.length&&(this.value=this.defaultValue);this.$util.request({url:"/api/compdata/apis?type=1,2&pagination=0",meta:{errorValidator:function(e){return!1}}}).then((function(e){var a=t.tramnsformData(e);t.options=function e(t){return t.map((function(t){return v(v({},t),{},{children:t.value.children?e(t.value.children):null,value:v(v({},t.value),{},{children:null})})}))}(a)}))},data:function(){return{value:[],options:[]}},props:{defaultValue:{type:Object,default:function(){return{}}}},methods:{tramnsformData:function(e){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"id",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"parentId",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"children",n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:-1;i=i||"children";var r=[],o={};return e&&e.length>0&&(e.forEach((function(e){o[e[t]]=e})),e.forEach((function(e){var t={label:e.name,value:e},l=o[e[a]];if(!l)return null!=n&&""!==n?String(e[a])===String(n)?void r.push(t):void 0:void r.push(t);l[i]||(l[i]=[]),l[i].push(t)}))),r}(e)},handleChange:function(e){var t,a=this,i=e.length&&(null===(t=e[e.length-1])||void 0===t?void 0:t.id),n={url:"/api/compdata/apis/".concat(i),meta:{errorValidator:function(e){return!1}}};this.$util.request(n).then((function(t){t&&Object.defineProperty(t,"__modalValue__",{value:e,enumerable:!1,configurable:!0}),a.$emit("change",t)}))}}},g=a("2877"),y={name:"ApiUrl",components:{PresetApiList:Object(g.a)(b,f,[],!1,null,"7dfe3f33",null).exports},model:{prop:"value",event:"change"},props:{value:{type:String,default:""},defaultSelect:{type:Boolean,default:!1},defaultQuickSelect:{type:Object,default:function(){return{}}},historySelect:{type:Array,default:function(){return[]}}},data:function(){return{type:"input",options:[{label:"手动配置",value:"input"},{label:"快速配置",value:"select"}],quickSelect:{},lastSelects:[]}},created:function(){this.init()},methods:{init:function(){this.type=this.defaultSelect?"select":"input",this.lastSelects=this.historySelect,this.quickSelect=this.defaultQuickSelect},setLastSelects:function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];var i=t[0].__modalValue__;if(i.length){var n={label:i.map((function(e){return e.name})).join("/"),value:t[0]},r=this.lastSelects.findIndex((function(e){return e.label===n.label}));r>-1?this.lastSelects.splice(r,1):this.lastSelects.length>=5&&this.lastSelects.splice(4,this.lastSelects.length),this.lastSelects.unshift(n)}this.$emit("historySelectChange",this.lastSelects)},onLastClick:function(e,t){var a;(a=this.lastSelects).unshift.apply(a,Object(n.a)(this.lastSelects.splice(t,1))),this.$refs.presetApiList.value=this.lastSelects[0].value,this.emitChange(e.value)},onQuickChange:function(){this.setLastSelects.apply(this,arguments),this.emitChange.apply(this,arguments)},emitChange:function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];this.$emit.apply(this,["quickChange"].concat(t))},onInputChange:function(e){this.$emit("change",e)},onInputBlur:function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];this.$emit.apply(this,["blur"].concat(t))}}},_=(a("bf78"),Object(g.a)(y,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"api-url"},[t("div",{staticClass:"api-url-setter"},[t("el-select",{staticClass:"api-url-setter-type",model:{value:e.type,callback:function(t){e.type=t},expression:"type"}},e._l(e.options,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),t("div",{staticClass:"api-url-setter-content",staticStyle:{height:"32px"}},[t("preset-api-list",{ref:"presetApiList",class:["api-url-setter-content-select",{"api-url-setter-content-top":"select"===e.type}],attrs:{placeholder:"请输入请求地址"},on:{change:e.onQuickChange},model:{value:e.quickSelect,callback:function(t){e.quickSelect=t},expression:"quickSelect"}}),t("div",{staticClass:"api-url-setter-content-input"},[t("el-input",e._b({on:{change:e.onInputChange,blur:e.onInputBlur},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}},"el-input",e.$attrs,!1))],1)],1)],1),e.lastSelects.length?t("div",{staticClass:"api-url-last"},[t("span",{staticClass:"api-url-last-label"},[e._v("配置模板路径：")]),e._l(e.lastSelects,(function(a,i){return t("el-button",{key:a.value,staticClass:"api-url-last-link",attrs:{type:"text"},on:{click:function(t){return e.onLastClick(a,i)}}},[e._v(e._s(a.label))])}))],2):e._e()])}),[],!1,null,null,null)).exports,C=a("2f62"),O=a("c276");function T(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return V(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?V(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,l=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return o=e.done,e},e:function(e){l=!0,r=e},f:function(){try{o||null==a.return||a.return()}finally{if(l)throw r}}}}function V(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=new Array(t);a<t;a++)i[a]=e[a];return i}function w(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function P(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?w(Object(a),!0).forEach((function(t){Object(r.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):w(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var x={name:"ApiLinkEditor",components:{OrderbySetting:p.a,PaginationSetting:d.a,ApiFiltersSelect:u.a,ApiTestPanel:c.a,ParamsSelect:s.a,controlCommonAlert:h.a,ApiUrl:_},alias:"API",command:"api-link",mixins:[o.a],props:{visible:{type:String,default:function(){return!1}},showInput:{type:String,default:function(){return!0}},iconClass:{type:String,default:function(){return"el-icon-edit"}},data:{type:Object,default:function(){return{alias:"",type:"",default:"",value:"",primitiveLabels:""}}},parent:{type:Object,default:function(){}},placeholder:{type:String,default:""},linkType:{type:Number,default:function(){return 1}},handleRulesResult:{type:Function,default:function(){}},handleChangeResult:{type:Function,default:function(){}}},data:function(){return{compUid:"",showCloseTips:JSON.parse(localStorage.getItem("link-tips-api")),arrIfEmpty:[{name:"",value:"",filter:"",editValue:"",logicExp:"eq"}],queryTypes:[{label:"POST",value:"post"},{label:"GET",value:"get"}],exceptionStrategyTypes:[{value:"throw"},{value:"adapt"}],contentTypes:[{value:"application/json"},{value:"multipart/form-data"},{value:"text/xml"},{value:"application/x-www-form-urlencoded"}],viewMode:1,showVal:"",baseEditVal:{accessType:"api",linkType:this.linkType,contentType:"application/json",exceptionStrategy:"throw"},editVal:{url:"",method:"post",exceptionStrategy:"throw",fields:"",containsKey:1,pagination:0,dataType:"",requestPayload:{},responseSchema:{},variables:[],quickSelect:{},historySelect:[],isQuickSelect:!1,totalFields:[]},jsonValue:"{}",tempJsonValue:"",codeValue:"{}",responseSchema:"{}",codeOptions:{},codeJSONOptions:{},dialogVisible:this.visible,payloads:[{name:"",value:"",filter:"",editValue:""}],filterArr:[{name:"",value:"",filter:"",editValue:"",logicExp:"eq"}],paramsArr:[{name:"",value:"",filter:"",editValue:""}],orderByArr:[{attr:"",sort:"asc"}],pagination:{page:"",pageSize:"",enabled:!0},currentPreset:{},showTest:!1,configToTest:{},contentHeight:"auto",commonLinkSet:{fields:"",containsKey:0,pagination:0,totalFields:[]},apiTestDataType:""}},computed:P(P({},Object(C.a)(["themeConstColor","getLinkTipsOf"])),{},{themeColor:function(){return this.themeConstColor.primary},apiTipsLoaded:function(){return this.getLinkTipsOf("api-link")},paramsSettingItems:function(){return[].concat(Object(n.a)("get"!==this.editVal.method?[{label:"BODY",id:"body",tips:["添加请求体参数"],count:(this.payloads.filter((function(e){return e.name&&e.value}))||[]).length}]:[]),[{label:"URL",id:"url",tips:["添加请求地址参数，配置后实时在请求地址中体现","首个参数以?开头连接，后续以&开头连接"],count:(this.paramsArr.filter((function(e){return e.name&&e.value}))||[]).length},{label:"筛选项",id:"filter",tips:["限制接口返回与指定字段、过滤类型匹配的数据"],count:(this.filterArr.filter((function(e){return e.name&&e.value}))||[]).length},{label:"排序",id:"sort",tips:["按照配置顺序以指定字段进行排序，支持升序和降序"],count:(this.orderByArr.filter((function(e){return e.attr}))||[]).length}])},isComplexArray:function(){return this.data.type.toLowerCase().indexOf("complex[")>-1}}),watch:{"data.value":function(){this.initData()},showCloseTips:function(e){localStorage.setItem("link-tips-api",e)},visible:function(e){this.dialogVisible=e,e&&this.initData(!0)},"commonLinkSet.pagination":{handler:function(e){var t;e||(this.pagination.page="",this.pagination.pageSize="",null===(t=this.$refs.paginationSetting)||void 0===t||t.resetParams(),this.refreshUrl()),this.editVal.pagination=e?1:0}}},created:function(){this.initData(!0)},methods:{getDataType:function(){var e=this,t="String";if("scopedVariable"===this.parent.name||"customVariable"===this.parent.name){var a=this.parent.attributes;a.length>0&&(a.forEach((function(a){e.data.name===a.value.name&&(t=a.type.value)})),"Enum"===t&&(t="Complex[*]"))}else t=this.data.type;this.apiTestDataType=t},handleTotalColsChange:function(e){},isCorrectJsonValue:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];try{var t,a,n;if("function"==typeof(null===(t=this.$refs)||void 0===t||null===(a=t.codeEditorJSON)||void 0===a?void 0:a.validate)&&(null===(n=this.$refs)||void 0===n||!n.codeEditorJSON.validate()))return;var r=JSON.parse(this.tempJsonValue);if(["number"].includes(Object(i.a)(r)))throw new Error("格式不合法");return!0}catch(t){return null===this.tempJsonValue||""===this.tempJsonValue||(e&&this.$message({message:"输入正确格式的JSON数据！",type:"warning"}),!1)}},setContentHeight:function(){var e=this;this.$nextTick((function(){var t,a=document.getElementsByClassName("api-link-editor-content");if(null!==(t=a)&&void 0!==t&&t.length){var i,n,r=T(a);try{for(r.s();!(n=r.n()).done;){var o=n.value,l=null==o?void 0:o.getAttribute("comp-uid");if(Number(l)===e.compUid){a=o;break}}}catch(e){r.e(e)}finally{r.f()}null!==(i=a)&&void 0!==i&&i.length&&(a=a[0]);var s=a.getElementsByClassName("hc-view-switch-content")[0];e.contentHeight=a.clientHeight-s.offsetTop+a.offsetTop}}))},handleSwitchViewMode:function(e){if(2===e)this.viewMode=e,this.jsonValueHandler();else if(this.isCorrectJsonValue())this.viewMode=e;else{try{var t,a,i;(null===(t=this.$refs.viewModeRadio)||void 0===t||null===(a=t.$children[0])||void 0===a||null===(i=a.$el)||void 0===i?void 0:i.getElementsByTagName("input")[0]).checked=!1}catch(e){}this.viewMode=2}},changeUrl:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=[],n=[],r=Object(O.zb)(e),o=null==r?void 0:r.query,s=null==o?void 0:o.$filter;if(s&&s.length){var c=s.split(",");c.forEach((function(e){var a,n,r,o=e.trim().split(" ");if(o.length&&(a=o[0]),2===o.length&&(n=o[1],r=""),o.length>=3&&(n=o[1],r=o[2],o[3]))for(var l=3;l<o.length;l++)r+=" "+o[l];var s={editValue:t.getEditValue(r),filter:"",lastValue:r,name:a,value:r,logicExp:n};i.push(s)}))}if(this.isComplexArray){var u;null!==(u=this.data)&&void 0!==u&&u.linkConfig&&!this.data.linkConfig.hasOwnProperty("pagination")&&(this.commonLinkSet.pagination=1);var d=this.commonLinkSet.pagination,p=this.editVal.url;null!=o&&o.$pageSize&&(!0!==a||d?(this.pagination.pageSize=(null==o?void 0:o.$pageSize)||"",d=1):(p=p.replace("".concat(p.indexOf("?$pageSize")>-1?"?":"&","$pageSize=").concat(null==o?void 0:o.$pageSize),""),delete o.$pageSize)),null!=o&&o.$page&&(!0!==a||d?(this.pagination.page=(null==o?void 0:o.$page)||"",d=1):(p=p.replace("".concat(p.indexOf("?$page")>-1?"?":"&","$page=").concat(null==o?void 0:o.$page),""),delete o.$page)),p!==this.editVal.url&&(this.editVal.url=p),this.isComplexArray&&this.commonLinkSet.pagination!==d&&(this.commonLinkSet.pagination=d)}var h=null==o?void 0:o.$orderBy;if(h){var f=h.split(",").map((function(e){var t=e.trim().split(" ");return{attr:t[0]||"",sort:t[1]||""}}));this.orderByArr=f.length?f:[{attr:"",sort:"asc"}]}for(var m in o)if(["$orderBy","$filter"].concat(this.isComplexArray?["$pageSize","$page"]:[]).includes(m));else{var v=this.getEditValue(o[m]),b={editValue:v,filter:"",lastValue:o[m],name:m,value:o[m]};n.push(b)}i.length?this.filterArr=i:this.filterArr=Object(l.e)(this.arrIfEmpty),n.length?this.paramsArr=n:this.paramsArr=Object(l.e)(this.arrIfEmpty)},refreshUrl:function(e){var t=this,a=!1,i=!1,n=Object(O.zb)(this.editVal.url),r="/$none$"===n.pathname?"":n.pathname,o=this.paramsArr,l=this.filterArr,s=this.pagination,c=this.orderByArr,u="?",d="&$filter=",p="",h="&$orderBy=";o.forEach((function(a,i){var n;a.name&&(t.isComplexArray&&["$page","$pageSize"].includes(a.name)?"url"===e&&(t.commonLinkSet.pagination||(t.commonLinkSet.pagination=1),o.length>1?t.paramsArr.splice(i,1):t.paramsArr.splice(i,1,{name:"",value:"",filter:"",editValue:""}),t.$message.info("分页信息请使用下方的【分页配置】")):u+="&".concat(a.name,"=").concat(null!==(n=a.value)&&void 0!==n?n:""))})),l.forEach((function(e,t){var i;e.name&&(a=!0,d+="".concat(t?",":"").concat(e.name," ").concat(e.logicExp," ").concat(null!==(i=e.value)&&void 0!==i?i:""))})),this.pagination.enabled&&(s.page&&(p+="&$page=".concat(s.page)),s.pageSize&&(p+="&$pageSize=".concat(s.pageSize)));var f="";return c.forEach((function(e){e.attr&&e.sort&&(f+=", ".concat(e.attr," ").concat(e.sort))})),f.length&&(i=!0,h+=f.substring(1,f.length)),a&&(u+=d),i&&(u+=h),r+="?"===(u+=p)?"":u.replaceAll("?&","?"),this.editVal.url=r,this.editVal.containsKey=this.commonLinkSet.containsKey,this.editVal.pagination=this.commonLinkSet.pagination,r},jsonValueHandler:function(){var e=Object(l.e)(this.editVal),t=this.data.type.toLowerCase();delete(e=P(P({},e),this.commonLinkSet)).linkType,delete e.accessType,delete e.contentType,delete e.exceptionStrategy,delete e.responseSchema,delete e.dataType,delete e.variables,delete e.quickSelect,delete e.historySelect,delete e.isQuickSelect,delete e.requestParams,delete e.totalFields,"isCustomVariable"===this.data.customGroupName?(delete e.fields,delete e.containsKey,delete e.pagination):-1===t.indexOf("complex[")&&(delete e.containsKey,delete e.pagination),e.defaultLoad=this.data.defaultLoad,"get"===e.method&&delete e.requestPayload,this.jsonValue=Object(l.b)(e),this.tempJsonValue=""},responseSchemaBlur:function(e){this.responseSchema=e,this.editVal.responseSchema=Object(l.j)(e)},codeEditorBlur:function(e){this.codeValue=e,this.editVal.requestPayload=Object(l.j)(e)},codeEditorJSONBlur:function(e){this.tempJsonValue=e,this.isCorrectJsonValue(!1)&&(this.editVal=P(P({},Object(l.j)(e)),{},{quickSelect:this.editVal.quickSelect}),this.data.defaultLoad=this.editVal.defaultLoad,delete this.editVal.defaultLoad,this.initCommonLinkSet(this.editVal),this.payloadStringToArray(e),this.changeUrl(Object(l.e)(this.editVal.url)))},handleSelectorFocus:function(e){this.$refs[e]&&this.$refs[e].onPopoverHide&&this.$refs[e].onPopoverHide()},initData:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.compUid=this._uid,this.commonInitData("api"),this.initTips(),this.jsonValueHandler(),this.payloadStringToArray(),this.changeUrl(Object(l.e)(this.editVal.url),e),this.setContentHeight(),this.getDataType()},initTips:function(){this.$store.dispatch("setLinkEditorTips","api")},resetData:function(){this.showVal="",this.editVal={url:"",method:"post",requestPayload:{},fields:"",dataType:"",responseSchema:{},exceptionStrategy:"throw",variables:[],quickSelect:{},historySelect:[],isQuickSelect:!1,totalFields:[]},this.commonResetData("api")},focusCodeEditor:function(){this.$refs.codeEditor&&this.$refs.codeEditor.setMethod("focus")},handleIconClick:function(){this.open()},open:function(){this.$setAttr(this.data,"editorDialogVisible",!0),this.dialogVisible=!0},close:function(){this.closeHandler("api")},clear:function(){this.clearByType("api")},cancel:function(){this.close()},getShowVal:function(){return Object(l.b)(this.editVal)},clickSure:function(){this.isCorrectJsonValue()||(this.showTest=!1,this.viewMode=2),this.commonSureHandler("api")},getHandlerEditVal:function(){var e=Object(l.e)(this.editVal);return e.responseSchema||(e.responseSchema={}),e.requestPayload||(e.requestPayload={}),(e=Object.assign(e,this.baseEditVal)).variables=this.getVariables(e),e},validate:function(){return!1===this.validateArr(this.paramsArr,"name","value")?"URL参数配置不完整":!1===this.validateArr(this.payloads,"name","value")?"BODY参数配置不完整":!1===this.validateArr(this.filterArr,"name","value")?"筛选项参数配置不完整":"string"==typeof this.editVal||Array.isArray(this.editVal)?"请输入正确的API-JSON配置！":this.editVal.url?this.editVal.method?""===this.editVal.requestPayload||"string"!=typeof this.editVal.requestPayload||"请配置正确的请求参数（requestPayload）":"请配置请求类型method":"请配置请求地址url"},getVariables:function(e){var t=this.getVariableNames(e.url),a=this.getVariableNames(e.requestPayload),i=this.getVariableNames(e.responseSchema);return this.formatVariables([].concat(Object(n.a)(t),Object(n.a)(a),Object(n.a)(i)))},payloadsChange:function(e){this.refreshUrl();var t=this.payloadArrayToString(e);this.editVal.requestPayload=Object(l.j)(t)},payloadArrayToString:function(e){var t={};return e.forEach((function(e){t[e.name]=e.value})),JSON.stringify(t)},getEditValue:function(e){var t,a=/\$\{(.*?)\}/g.exec(e);return(null==a?void 0:a[0])===e?{static:"",type:"variable",variable:null===(t=a[1])||void 0===t?void 0:t.split(".")}:{static:e,type:"static",variable:[]}},onApiUrlChange:function(e){this.editVal.isQuickSelect=!1},onHistorySelectChange:function(e){this.editVal.historySelect=e},onQuickChange:function(e){var t,a=this;this.editVal.isQuickSelect=!0;var i=e;if(i){this.editVal.url=i.url;var n=[],r=[],o=[];(i.params||[]).forEach((function(e){switch(e.positionType){case"query":if("$filter"===e.name)e.filterConditions.forEach((function(e){var t={editValue:a.getEditValue(e.defaultValue),filter:"",lastValue:e.defaultValue,name:e.key,value:e.defaultValue,logicExp:e.expression[0]};o.push(Object(l.e)(t))}));else{var t={editValue:a.getEditValue(e.defaultValue),filter:"",lastValue:e.defaultValue,name:e.name,value:e.defaultValue};r.push(Object(l.e)(t))}break;case"body":var i={editValue:a.getEditValue(e.defaultValue),filter:"",lastValue:e.defaultValue,name:e.name,value:e.defaultValue};n.push(Object(l.e)(i))}})),this.editVal.method=i.method||"get",this.filterArr=null!=o&&o.length?o:Object(l.e)(this.arrIfEmpty),this.paramsArr=null!=r&&r.length?r:Object(l.e)(this.arrIfEmpty),this.payloads=null!=n&&n.length?n:Object(l.e)(this.arrIfEmpty),this.editVal.pagination=null===(t=i.paginationCondition)||void 0===t?void 0:t.pagination,this.editVal.quickSelect=i,this.refreshUrl()}},payloadStringToArray:function(){var e=Object(l.e)(this.editVal.requestPayload),t=[];for(var a in e){var i={editValue:this.getEditValue(e[a]),filter:"",lastValue:e[a],name:a,value:e[a]};t.push(i)}t.length?this.payloads=t:this.payloads=Object(l.e)(this.arrIfEmpty)},testDialogClose:function(){this.showTest=!1},handleTest:function(){if(this.isCorrectJsonValue()){var e=this.getHandlerEditVal();e.requestParams={},this.paramsArr.length&&this.paramsArr.forEach((function(t){t.name&&(e.requestParams[t.name]=t.value)})),(this.pagination.page||0===this.pagination.page)&&(e.requestParams.$page=this.pagination.page),(this.pagination.pageSize||0===this.pagination.pageSize)&&(e.requestParams.$pageSize=this.pagination.pageSize),this.configToTest=e,this.showTest=!0}},testChangeField:function(e){this.editVal.fields=e.join(","),this.initCommonLinkSet(this.editVal)}}},S=(a("1583"),Object(g.a)(x,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"api-link-editor"},[e.showInput?t("el-input",{staticClass:"editor-input",attrs:{placeholder:e.placeholder,value:e.showVal,readonly:"",size:"mini",clearable:""},nativeOn:{click:function(t){return e.handleIconClick.apply(null,arguments)}}},[t("i",{staticClass:"el-input__icon array-editor-icon",class:e.iconClass,attrs:{slot:"suffix"},slot:"suffix"})]):e._e(),t("el-drawer",{ref:"editorDrawer",attrs:{"custom-class":"api-link-editor-drawer",size:"1000px",visible:e.dialogVisible,direction:"rtl",wrapperClosable:!1,"append-to-body":!0,"show-close":!1},on:{"update:visible":function(t){e.dialogVisible=t},close:e.close}},[t("div",{staticClass:"editor-drawer-title",attrs:{slot:"title"},slot:"title"},[t("div",{staticClass:"title-text"},[t("iconfont",{attrs:{type:"icon-close"},on:{click:e.close}}),e._v("\n        API关联配置\n        "),t("a",{directives:[{name:"show",rawName:"v-show",value:e.apiTipsLoaded&&e.apiTipsLoaded.description,expression:"apiTipsLoaded && apiTipsLoaded.description"}],attrs:{href:e.apiTipsLoaded&&e.apiTipsLoaded.description,target:"_blank"}},[t("i",{staticClass:"el-icon-question"})])],1),t("div",{staticClass:"title-btn"},[t("el-button",{attrs:{size:"small"},on:{click:e.clear}},[e._v("\n          清空\n        ")]),t("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.clickSure}},[e._v("\n          提交\n        ")])],1)]),t("div",{staticClass:"api-link-editor-content",attrs:{"comp-uid":e.compUid}},[t("control-common-alert",{staticClass:"api-link-alert",attrs:{show:!e.showCloseTips},on:{showCloseTips:function(t){e.showCloseTips=!0}}},[t("div",{domProps:{innerHTML:e._s(e.apiTipsLoaded&&e.apiTipsLoaded.value)}})]),t("div",{staticClass:"hc-view-switch hc-view-switch-api-link"},[t("div",[t("el-radio-group",{ref:"viewModeRadio",attrs:{value:e.viewMode},on:{input:e.handleSwitchViewMode}},[t("el-radio-button",{attrs:{label:1}},[e._v("普通视图")]),t("el-radio-button",{attrs:{label:2}},[e._v("JSON视图")])],1)],1),t("div",[t("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.showTest,expression:"!showTest"}],attrs:{type:"info"},on:{click:e.handleTest}},[e._v("测 试")])],1)]),t("div",{staticClass:"hc-view-switch-content",style:{height:e.contentHeight+"px"}},[1===e.viewMode?t("el-form",{directives:[{name:"show",rawName:"v-show",value:!e.showTest,expression:"!showTest"}],attrs:{"label-width":"94px"},model:{value:e.editVal,callback:function(t){e.editVal=t},expression:"editVal"}},[t("el-form-item",{attrs:{label:"请求地址",prop:"url"}},[t("api-url",{attrs:{defaultSelect:e.editVal.isQuickSelect,"default-quick-select":e.editVal.quickSelect,"history-select":e.editVal.historySelect,placeholder:"请输入请求地址",clearable:""},on:{historySelectChange:e.onHistorySelectChange,quickChange:e.onQuickChange,change:e.onApiUrlChange,blur:function(t){return e.changeUrl(e.editVal.url)}},model:{value:e.editVal.url,callback:function(t){e.$set(e.editVal,"url",t)},expression:"editVal.url"}})],1),t("el-form-item",{attrs:{label:"请求类型"}},[t("el-radio-group",{model:{value:e.editVal.method,callback:function(t){e.$set(e.editVal,"method",t)},expression:"editVal.method"}},e._l(e.queryTypes,(function(a){return t("el-radio",{key:a.value,attrs:{label:a.value}},[e._v(e._s(a.label))])})),1)],1),t("el-form-item",{attrs:{label:"参数配置"}},[t("el-collapse",{staticClass:"hc-view-switch-content-collapse",attrs:{value:"body",accordion:""}},e._l(e.paramsSettingItems,(function(a){return t("el-collapse-item",{key:a.id,attrs:{name:a.id}},[t("template",{slot:"title"},[t("div",{staticClass:"hc-view-switch-content-collapse-title"},[t("div",[t("span",[e._v("\n                        "+e._s(a.label)+"\n                      ")]),t("basic-tips",{attrs:{type:"popover",title:"配置说明",width:600,placement:"bottom-start",iconStyle:{color:"#C9D0D4"},content:""}},[t("ul",e._l(a.tips,(function(a){return t("li",{key:a},[e._v(e._s(a))])})),0)])],1),t("div",[e._v("\n                      已配置\n                      "),t("span",{style:{color:e.themeColor}},[e._v(e._s(a.count))]),e._v("\n                      项\n                    ")])])]),"body"===a.id?t("params-select",{on:{change:e.payloadsChange},model:{value:e.payloads,callback:function(t){e.payloads=t},expression:"payloads"}}):"url"===a.id?t("params-select",{on:{change:function(t){return e.refreshUrl("url")}},model:{value:e.paramsArr,callback:function(t){e.paramsArr=t},expression:"paramsArr"}}):"filter"===a.id?t("api-filters-select",{on:{change:e.refreshUrl},model:{value:e.filterArr,callback:function(t){e.filterArr=t},expression:"filterArr"}}):"sort"===a.id?t("orderby-setting",{on:{change:e.refreshUrl},model:{value:e.orderByArr,callback:function(t){e.orderByArr=t},expression:"orderByArr"}}):e._e()],2)})),1)],1),t("common-link-set",{attrs:{config:e.commonLinkSet,data:e.data,defaultLoad:e.defaultLoad,"show-tips":!1,emitChangeFiled:["containsKey","pagination"]},on:{change:e.refreshUrl}},[t("template",{slot:"pagination"},[t("pagination-setting",{directives:[{name:"show",rawName:"v-show",value:e.commonLinkSet.pagination,expression:"commonLinkSet.pagination"}],ref:"paginationSetting",staticClass:"hc-view-switch-content-pagination",on:{change:e.refreshUrl},model:{value:e.pagination,callback:function(t){e.pagination=t},expression:"pagination"}})],1)],2),t("exception-strategy",{model:{value:e.editVal.exceptionStrategy,callback:function(t){e.$set(e.editVal,"exceptionStrategy",t)},expression:"editVal.exceptionStrategy"}}),t("response-schema",{attrs:{visible:e.dialogVisible,value:e.responseSchema},on:{blur:e.responseSchemaBlur}})],1):e._e(),2===e.viewMode?t("div",{directives:[{name:"show",rawName:"v-show",value:!e.showTest,expression:"!showTest"}],staticClass:"hc-view-switch-content-json"},[e.dialogVisible?t("base-code-editor",{ref:"codeEditorJSON",attrs:{params:e.codeJSONOptions,value:e.jsonValue,height:"100%"},on:{blur:e.codeEditorJSONBlur}}):e._e()],1):e._e(),e.showTest?t("api-test-panel",{ref:"apiTestPanel",attrs:{"origin-config":e.configToTest,payload:e.payloads,paramsArr:e.paramsArr,filterArr:e.filterArr,orderByArr:e.orderByArr,pagination:e.pagination,isPagination:e.commonLinkSet.pagination,dataType:e.data.type,apiTestDataType:e.apiTestDataType,fields:e.commonLinkSet.fields},on:{totalColsChange:e.handleTotalColsChange,changeFields:e.testChangeField,close:e.testDialogClose}}):e._e()],1)],1)])],1)}),[],!1,null,null,null));t.default=S.exports},6834:function(e,t,a){"use strict";a.r(t),a("7f7f");var i=(a("8e6e"),a("75fc")),n=(a("28a5"),a("4f7f"),a("5df3"),a("1c4c"),a("f559"),a("456d"),a("ac6a"),a("96cf"),a("3b8d")),r=(a("6762"),a("2fdb"),a("7514"),a("bd86")),o=(a("c5f6"),a("967e")),l=a.n(o),s=a("36f0"),c=a("ae83"),u=a("b19c"),d=a("88da"),p=a("314f"),h={name:"AssetsTable",props:{data:{type:Array,default:function(){return[]}},types:{type:Object,default:function(){return{}}},propertyTypeMap:{type:Object,default:function(){return{}}},pagination:{type:Object,default:function(){return{page:1,pageSize:10,total:0}}},multipleSelection:{type:Array,default:function(){return[]}}},data:function(){return{pageSizes:[10,20,50,100],tagType:{collect:"",calculate:"success",indicator:"warning",manual:"danger",measuringPoint:"info"}}},methods:{handleSelected:function(e){var t=this;return Object(n.a)(l.a.mark((function a(){return l.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.$refs.table.$nextTick();case 2:t.data.forEach((function(a){e.some((function(e){return e.id===a.id||e.identifier===a.identifier}))&&t.$refs.table.toggleRowSelection(a)}));case 3:case"end":return a.stop()}}),a)})))()},typeFormat:function(e){return this.types[this.propertyTypeMap[e]]||e},handleSelectChange:function(e){var t,a=this;this.multipleSelection||(this.multipleSelection=[]);for(var n=0,r=function(){var e=a.multipleSelection[n];a.data.some((function(t){return t.id===e.id}))?a.multipleSelection.splice(n,1):n++};n<((null===(o=this.multipleSelection)||void 0===o?void 0:o.length)||0);){var o;r()}(t=this.multipleSelection).splice.apply(t,[this.multipleSelection.length,0].concat(Object(i.a)(e))),this.$emit("selectionChange",this.multipleSelection)},handleSizeChange:function(e){this.pagination.pageSize=e,this.$emit("paginationChange",this.pagination)},handleCurrentChange:function(e){this.pagination.page=e,this.$emit("paginationChange",this.pagination)},clearSelection:function(){var e,t;null===(e=this.$refs)||void 0===e||null===(t=e.table)||void 0===t||t.clearSelection()}}},f=(a("a797"),a("a1f7"),a("2877")),m=Object(f.a)(h,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"assets-table"},[t("el-table",{ref:"table",staticStyle:{width:"100%"},attrs:{data:e.data},on:{select:e.handleSelectChange,"select-all":e.handleSelectChange}},[t("el-table-column",{attrs:{type:"selection",width:"70"}}),t("el-table-column",{attrs:{prop:"propertyType",label:"类型",width:"100"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tag",{attrs:{type:e.tagType[e.propertyTypeMap[a.row.propertyType]],size:"mini"}},[e._v(e._s(e.typeFormat(a.row.propertyType)))])]}}])}),t("el-table-column",{attrs:{prop:"name",label:"名称",width:"180"}}),t("el-table-column",{attrs:{prop:"identifier",label:"标识"}})],1),t("el-pagination",{staticClass:"assets-pagination",attrs:{size:"small","current-page":e.pagination.page,"page-sizes":e.pageSizes,"page-size":e.pagination.pageSize,"pager-count":5,layout:"total, sizes, prev, pager, next, jumper",total:e.pagination.total||e.data.length},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)}),[],!1,null,"4f7805ba",null).exports,v=a("f246"),b=a("65d4"),g=a("0338");function y(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function _(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?y(Object(a),!0).forEach((function(t){Object(r.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):y(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var C={name:"HistorySetting",props:{editVal:{type:Object,default:function(){return{}}}},data:function(){return{compoundItem:[{label:"变量选择",value:"variable",formItem:"variable-Panel"},{label:"手动输入",value:"static",formItem:"date-picker"}],rtDataTypes:[{label:"实时数据",value:1},{label:"历史数据",value:2}],queryDirections:[{label:"小于等于采集/归档时间",value:1},{label:"大于等于采集/归档时间",value:2},{label:"小于采集/归档时间",value:3},{label:"大于采集/归档时间",value:4}],queryTypes:[{label:"采集时间",value:1},{label:"归档时间",value:2},{label:"时间区间",value:4}],recordTypes:[{label:"历史记录",value:1},{label:"按天归档的数据",value:2},{label:"按小时归档的数据",value:3},{label:"按分钟归档的数据",value:4}]}},computed:{orders:function(){return 1===this.editVal.requestPayload.recordType?[{label:"升序",value:"collectTime asc"},{label:"降序",value:"collectTime desc"}]:[{label:"升序",value:"archiveDate asc"},{label:"降序",value:"archiveDate desc"}]}},methods:{changeVariable:function(e,t){var a,i="collectTime"===t?this.editVal.variableEditData[t+"Data"]:null,n="static"===(null==i||null===(a=i.editValue)||void 0===a?void 0:a.type)?+new Date(e):e;this.editVal.requestPayload[t]=isNaN(n)?e:n},handleTypeChange:function(e){2===e&&(this.editVal.requestPayload=_(_({},this.editVal.requestPayload),this.requestPayloadBak),this.editVal.variableEditData=_(_({},this.editVal.variableEditData),this.variableEditDataBak),this.changeRecordType(this.editVal.requestPayload.recordType))},handleDataTypeChange:function(e){4===e&&(this.editVal.requestPayload.querySize=1e3)},changeRecordType:function(e){var t=this.editVal.requestPayload.$orderBy.split(" ");t.length&&(t[0]=1===e?"collectTime":"archiveDate",this.editVal.requestPayload.$orderBy=t.join(" "))}}},O=Object(f.a)(C,(function(){var e=this,t=e._self._c;return t("div",[t("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{label:"数据类型："}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},on:{change:e.handleTypeChange},model:{value:e.editVal.rtDataType,callback:function(t){e.$set(e.editVal,"rtDataType",t)},expression:"editVal.rtDataType"}},e._l(e.rtDataTypes,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),2===e.editVal.rtDataType?t("el-form-item",{attrs:{label:"查询类型："}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},on:{change:e.handleDataTypeChange},model:{value:e.editVal.requestPayload.queryType,callback:function(t){e.$set(e.editVal.requestPayload,"queryType",t)},expression:"editVal.requestPayload.queryType"}},e._l(e.queryTypes,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1):e._e(),2===e.editVal.rtDataType?t("el-form-item",{attrs:{label:"记录类型："}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},on:{change:e.changeRecordType},model:{value:e.editVal.requestPayload.recordType,callback:function(t){e.$set(e.editVal.requestPayload,"recordType",t)},expression:"editVal.requestPayload.recordType"}},e._l(e.recordTypes,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1):e._e(),2===e.editVal.rtDataType&&4!==e.editVal.requestPayload.queryType?t("div",[t("el-form-item",{attrs:{label:"查询范围："}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.editVal.requestPayload.queryDirection,callback:function(t){e.$set(e.editVal.requestPayload,"queryDirection",t)},expression:"editVal.requestPayload.queryDirection"}},e._l(e.queryDirections,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"查询条数："}},[t("el-input-number",{attrs:{size:"mini",min:1,max:1e3,step:1,"step-strictly":""},on:{blur:e.onQuerySizeBlur},model:{value:e.editVal.requestPayload.querySize,callback:function(t){e.$set(e.editVal.requestPayload,"querySize",t)},expression:"editVal.requestPayload.querySize"}})],1),t("el-form-item",{attrs:{label:"排序："}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.editVal.requestPayload.$orderBy,callback:function(t){e.$set(e.editVal.requestPayload,"$orderBy",t)},expression:"editVal.requestPayload.$orderBy"}},e._l(e.orders,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1):e._e(),2===e.editVal.rtDataType&&4!==e.editVal.requestPayload.queryType?t("div",[t("el-form-item",{attrs:{label:"".concat(1===e.editVal.requestPayload.queryType?"采集":"归档","时间："),prop:"requestPayload.collectTime"}},[t("variable-editor-components",{key:"collectTime",attrs:{compoundItem:e.compoundItem,"value-format":"timestamp",data:e.editVal.variableEditData.collectTimeData},on:{change:function(t){return e.changeVariable(t,"collectTime")}}})],1)],1):e._e(),2===e.editVal.rtDataType&&4===e.editVal.requestPayload.queryType?t("div",[t("el-form-item",{attrs:{label:"开始时间：",prop:"requestPayload.beginTime"}},[t("variable-editor-components",{key:"beginTime",attrs:{compoundItem:e.compoundItem,"value-format":"timestamp",data:e.editVal.variableEditData.beginTimeData},on:{change:function(t){return e.changeVariable(t,"beginTime")}}})],1),t("el-form-item",{attrs:{label:"结束时间：",prop:"requestPayload.endTime"}},[t("variable-editor-components",{key:"endTime",attrs:{compoundItem:e.compoundItem,"value-format":"timestamp",data:e.editVal.variableEditData.endTimeData},on:{change:function(t){return e.changeVariable(t,"endTime")}}})],1)],1):e._e()],1)}),[],!1,null,"8fd981a0",null).exports,T=a("d374"),V={name:"AssetsHeader",components:{MoreInfo:a("aeb2").a},props:{activeView:{type:String,default:""},currentNode:{type:Object,default:function(){return{}}},profileProperties:{type:Array,default:function(){return[]}},profileInfo:{type:Object,default:function(){return{}}},deviceName:{type:String,default:""},queryType:{type:String,default:""},actualTimeType:{type:String,default:""},historyType:{type:String,default:""},name:{type:String,default:""},selectedLength:{type:Number,default:0},types:{type:Object,default:function(){return{}}},editVal:{type:Object,default:function(){return{}}}},data:function(){return{collapse:!0,moreInfoProp:{},actualTimeTypes:[{key:"static",value:"静态"},{key:"dynamic",value:"动态"}]}},computed:{isDevice:function(){return"device"===this.activeView},isUnDevice:function(){return"unDevice"===this.activeView},currentAssetClass:function(){return["assets-header-title",{"t-text-placeholder":!this.currentNode.name,"t-text-primary":this.currentNode.name}]},moreInfoClass:function(){return this.collapse?"el-icon-arrow-down":"el-icon-arrow-up"},propertyTypes:function(){var e=this;return Object.keys(this.types).map((function(t){return{key:t,value:e.types[t]}}))},historyTypes:function(){var e=this;return Object.keys(this.types).filter((function(e){return["collect","calculate","indicator"].includes(e)})).map((function(t){return{key:t,value:e.types[t]}}))}},filters:{assetTitle:function(e){return e||"请选择资产"},deviceStatus:function(e){return e?"在线":"离线"}},methods:{handleSearchName:function(){this.$emit("handle-search-name",this.name,this.queryType)},handleInputSearchName:function(){this.$emit("handle-input-search-name",this.name)},handleMoreInfoClick:function(){this.collapse=!this.collapse},handleViewChange:function(e){this.$emit("view-change",e)},handleTabClick:function(e){this.name="",this.$emit("handle-input-search-name",this.name),this.$emit("tab-click",e)},handleHistoryTypeChange:function(e){this.$emit("history-type-change",e)},handleActualTimeTypeChange:function(e){this.$emit("actualTime-type-change",e)}}},w=(a("cff2"),a("1bd7"),Object(f.a)(V,(function(){var e=this,t=e._self._c;return t("div",[e.isUnDevice?[t("div",{staticClass:"assets-property-header"},[t("div",{staticClass:"header-title"},[t("div",{staticClass:"assets-header-wrapper"},[t("span",{class:e.currentAssetClass},[e._v(e._s(e._f("assetTitle")(e.currentNode.name)))]),e._e()],1),e.currentNode.name?t("div",{staticClass:"assets-header-description t-text-regular"},[e._v("\n          标识："),t("span",[e._v(e._s(e.profileInfo.identifier))])]):e._e()]),!e.deviceName||"history"===e.queryType&&"indicator"===e.historyType?e._e():t("div",{staticClass:"header-device t-border",on:{click:function(t){return e.handleViewChange("device")}}},[t("el-tag",{attrs:{size:"mini","disable-transitions":!0,type:e.currentNode.isOnline?"success":"info"}},[e._v(e._s(e._f("deviceStatus")(e.currentNode.isOnline)))]),t("span",{staticClass:"t-color-primary",staticStyle:{margin:"0 6px 0 4px"}},[e._v(e._s(e.deviceName))]),t("i",{staticClass:"el-icon-arrow-right"}),t("div",{staticClass:"header-device-select t-text-regular"},[e._v("已选择"),t("em",{staticClass:"t-color-primary"},[e._v(e._s(e.selectedLength))]),e._v("条内置测点")])],1)]),e.collapse?e._e():t("div",[t("more-info",{staticClass:"assets-more-info",attrs:{list:e.profileProperties,prop:e.moreInfoProp,span:8}})],1),t("el-tabs",{on:{"tab-click":e.handleTabClick},model:{value:e.queryType,callback:function(t){e.queryType=t},expression:"queryType"}},[t("el-tab-pane",{attrs:{label:"实时数据",name:"actualTime"}},[t("div",{staticClass:"flex-row"},[t("div",{staticClass:"flex-row-free"},[t("el-radio-group",{staticClass:"assets-history-type",attrs:{size:"mini"},on:{input:e.handleActualTimeTypeChange},model:{value:e.actualTimeType,callback:function(t){e.actualTimeType=t},expression:"actualTimeType"}},e._l(e.actualTimeTypes,(function(a){return t("el-radio-button",{key:a.key,attrs:{label:a.key}},[e._v(e._s(a.value))])})),1)],1),t("el-input",{staticStyle:{width:"200px"},attrs:{clearable:"",placeholder:"请输入名称"},on:{input:e.handleInputSearchName,clear:e.handleInputSearchName},model:{value:e.name,callback:function(t){e.name="string"==typeof t?t.trim():t},expression:"name"}},[t("el-button",{attrs:{slot:"append",icon:"el-icon-search",size:"mini"},on:{click:e.handleSearchName},slot:"append"})],1)],1)]),t("el-tab-pane",{attrs:{label:"历史数据",name:"history"}},[t("div",{staticClass:"flex-row"},[t("div",{staticClass:"flex-row-free"},[t("el-radio-group",{staticClass:"assets-history-type",attrs:{size:"mini"},on:{input:e.handleHistoryTypeChange},model:{value:e.historyType,callback:function(t){e.historyType=t},expression:"historyType"}},e._l(e.historyTypes,(function(a){return t("el-radio-button",{key:a.key,attrs:{label:a.key}},[e._v(e._s(a.value))])})),1)],1),t("el-input",{staticStyle:{width:"200px"},attrs:{clearable:"",placeholder:"请输入名称"},on:{input:e.handleInputSearchName,clear:e.handleInputSearchName},model:{value:e.name,callback:function(t){e.name="string"==typeof t?t.trim():t},expression:"name"}},[t("el-button",{attrs:{slot:"append",icon:"el-icon-search",size:"mini"},on:{click:e.handleSearchName},slot:"append"})],1)],1)])],1)]:e._e(),e.isDevice?[t("div",{staticClass:"assets-device-title",on:{click:function(t){return e.handleViewChange("unDevice")}}},[t("el-icon",{staticClass:"el-icon-arrow-left title-icon"}),t("span",{staticClass:"title-name"},[e._v(e._s(e._f("assetTitle")(e.currentNode.name))+" / "+e._s(e.deviceName))]),t("el-tag",{attrs:{size:"mini","disable-transitions":!0,type:e.currentNode.isOnline?"success":"info"}},[e._v(e._s(e._f("deviceStatus")(e.currentNode.isOnline)))])],1)]:e._e()],2)}),[],!1,null,"25ca2a8e",null)).exports,P=a("e13a"),x={name:"ResponseFields",props:{fields:{type:Array,default:function(){return[]}},description:{type:String,default:""}}},S=(a("f5a6"),Object(f.a)(x,(function(){var e=this,t=e._self._c;return e.fields.length?t("el-form-item",{staticClass:"link-editor-response-fields",attrs:{label:"响应数据提示"}},[t("div",{staticClass:"t-text-secondary"},[e._v(e._s(e.title))]),e._l(e.fields,(function(a){return t("el-tag",{key:a,attrs:{effect:"plain"}},[e._v(e._s(a))])}))],2):e._e()}),[],!1,null,"618898ad",null)).exports,j=a("2f62"),E=a("c276");function k(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function I(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?k(Object(a),!0).forEach((function(t){Object(r.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):k(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var A={name:"AssetsLinkEditor",alias:"资产",command:"assets-link",mixins:[s.a],components:{ResponseFields:S,AssetsDynamic:P.a,AssetsHeader:w,HistorySetting:O,AssetsTable:m,AssetsCollapse:p.a,AssetsIndicatorTable:v.a,controlCommonAlert:c.a,EditorCollapse:d.a,ParamSetting:b.a,FilterSetting:g.a},props:{visible:{type:String,default:function(){return!1}},linkType:{type:Number,default:function(){return 1}},handleChangeResult:{type:Function,default:function(){}},data:{type:Object,default:function(){return{alias:"",type:"",default:"",value:""}}}},data:function(){return{showVal:"",showCloseTips:JSON.parse(localStorage.getItem("link-tips-assets")),searchName:"",dialogVisible:this.visible,projectName:"",deviceName:"",activeView:"unDevice",currentNode:{},currentNodeId:"",syncIndicatorLoading:!1,originEditor:{accessType:"assets",linkType:this.linkType,url:"/api/indicator/values/aggregation",method:"post",contentType:"application/json",pagination:0,defaultLoad:!0},propSelected:[],indicatorFields:[],editVal:{},defaultProps:{children:"children",label:"name"},types:{collect:"采集",indicator:"指标",calculate:"计算",manual:"自定义点",measuringPoint:"内置测点"},propertyTypeMap:{1:"collect",2:"calculate",3:"indicator",4:"manual",5:"measuringPoint"},assetsList:[],tableData:[],tablePagination:{page:1,pageSize:10},hasIndicator:!1,profileInfo:{},profileProperties:[],historyTypeParams:{name:"",identifier:"",propertyType:"",labels:""}}},watch:{"data.value":function(){this.initData()},visible:function(e){this.dialogVisible=e,this.initData()},showCloseTips:function(e){localStorage.setItem("link-tips-assets",e)},"propSelected.length":{handler:function(e){this.hasIndicator=this.propSelected.some((function(e){return 3==+(null==e?void 0:e.propertyType)}))}},hasIndicator:function(){}},computed:I(I({},Object(j.a)(["getLinkTipsOf"])),{},{assetsTipsLoaded:function(){return this.getLinkTipsOf("assets-link")||{}},assetsData:function(){var e=this,t=[],a=this.assetsList,i={},n=function(t){var a;return~(null==t||null===(a=t.name)||void 0===a?void 0:a.toLowerCase().indexOf((e.searchName||"").toLowerCase()))};return this.isProjectPage?(i={id:this.property},this.listToTree(a,t,i,n),t):(i=a.find((function(t){return t.id===e.assetsId||t.identifier===e.assetsIdentifier})))?(this.listToTree(a,t,i,n),n(i)?[I(I({},i),{},{children:t})]:t):[]},selectedLength:function(){var e,t,a,i;return null===(e=this.editVal)||void 0===e||null===(t=e.measuringSelected)||void 0===t||null===(a=t[null===(i=this.currentNode)||void 0===i?void 0:i.id])||void 0===a?void 0:a.length},responseFields:function(){return"actualTime"===this.editVal.queryType?["id","name","type","updateTime","value","identifier"]:this.isIndicatorEditor?this.indicatorFields:["id","instanceId","collectTime","collectTimeFormat","dataIdentifier","dataValue","deviceIdentifier","ruleIdentifier","groupIdentifier","archiveDate","archiveDateFormat","quality"]},responseDescription:function(){return this.isIndicatorEditor?"响应数据字段可使用函数过滤，例timeFormat(updateTime::year::1)，字段列表如下：":""},formData:function(){return this.isRTEditor?this.editVal.rtEditor:this.isIndicatorEditor?this.editVal.indicatorEditor:this.editVal},hiddenConfig:function(){return{pagination:!0}},measuringSelected:function(){return this.editVal.measuringSelected||{}},projectId:function(){return Object(u.h)(window.location.href,"projectId")},assetsId:function(){return Object(u.h)(window.location.href,"assetsId")},isProjectPage:function(){return Object(u.h)(window.location.href,"isProjectPage")},projectIdentifier:function(){return Object(u.h)(window.location.href,"projectIdentifier")},assetsIdentifier:function(){return Object(u.h)(window.location.href,"assetsIdentifier")},property:function(){return Object(u.h)(window.location.href,"property")},isDevice:function(){return"device"===this.activeView},isUnDevice:function(){return"unDevice"===this.activeView},isStatic:function(){return"static"===this.editVal.actualTimeType},isDynamic:function(){return"dynamic"===this.editVal.actualTimeType},isRTEditor:function(){return"history"===this.editVal.queryType&&["collect","calculate","manual"].includes(this.editVal.historyType)},indicatorList:function(){var e,t,a;return this.isIndicatorEditor||this.propSelected.some((function(e){return 3==+(null==e?void 0:e.propertyType)}))?null===(e=this.editVal)||void 0===e||null===(t=e.indicatorEditor)||void 0===t||null===(a=t.assistAttr)||void 0===a?void 0:a.tableData:[]},isIndicatorEditor:function(){return"history"===this.editVal.queryType&&"indicator"===this.editVal.historyType}}),created:function(){this.initData()},methods:{initData:function(){var e=this;return Object(n.a)(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$store.dispatch("initDictOptions");case 2:return t.next=4,e.$store.dispatch("setLinkEditorTips","assets");case 4:if(e.resetEditorVal(),e.commonInitData("assets"),!e.dialogVisible){t.next=11;break}return t.next=9,e.getAssetsData();case 9:return t.next=11,e.formatData();case 11:case"end":return t.stop()}}),t)})))()},formatData:function(){var e=this;return Object(n.a)(l.a.mark((function t(){var a,i,n,r,o,s,c;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null!=(a=e.data.linkConfig)&&a.queryType&&(e.handleTabClick({name:a.queryType},!0),"history"===a.queryType&&null!=a&&a.historyType&&e.handleHistoryTypeChange(a.historyType,!1,!0)),null==a||!a.requestPayload){t.next=14;break}if(i=a.requestPayload,n=i.assetId,r=i.identifier,o=i.properties,!(s=e.assetsList.find((function(e){return e.id===n||e.identifier===r})))){t.next=14;break}return t.next=8,e.handleNodeClick(s,!0);case 8:return c=Object(T.a)(o),t.next=11,e.$refs.assetsTree.$nextTick();case 11:return e.$refs.assetsTree.setCurrentKey(s.id||n),t.next=14,e.initSelected(c);case 14:case"end":return t.stop()}}),t)})))()},initSelected:function(e){var t=this;return Object(n.a)(l.a.mark((function a(){return l.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return t.propSelected=e.filter((function(e){return"measuringPoint"!==e.type})),a.next=3,t.doPropertySelected(t.propSelected);case 3:case"end":return a.stop()}}),a)})))()},doPropertySelected:function(e){var t=this;return Object(n.a)(l.a.mark((function a(){var i;return l.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(!(i=t.$refs.assetsTable)){a.next=6;break}return a.next=4,i.$nextTick();case 4:return a.next=6,i.handleSelected(e);case 6:case"end":return a.stop()}}),a)})))()},refreshIndicators:function(){this.syncIndicator(this.propSelected.filter((function(e){return 3==+(null==e?void 0:e.propertyType)}))||[])},syncIndicator:function(e){var t=this;return Object(n.a)(l.a.mark((function a(){var i;return l.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:t.syncIndicatorLoading=!0,t.syncIndicatorLoading=!1,i=e.map((function(e){var a=(t.editVal.indicatorEditor.assistAttr.tableData||[]).find((function(t){return t.id===e.id||t.rowInfo.identifier===e.identifier}))||{};return{id:e.id,name:e.name,rowInfo:I(I({},a.rowInfo),e),isDynamic:!(null==a||!a.isDynamic),selected:(null==a?void 0:a.selected)||[]}})),t.editVal.indicatorEditor.assistAttr.tableData=i,t.onIndicatorChange(i);case 5:case"end":return a.stop()}}),a)})))()},onIndicatorChange:function(e){var t,a,i,n=e||(null==this||null===(t=this.editVal)||void 0===t||null===(a=t.indicatorEditor)||void 0===a||null===(i=a.assistAttr)||void 0===i?void 0:i.tableData)||[],r=[];n.forEach((function(e){Object.keys((null==e?void 0:e.rowInfo)||{}).forEach((function(e){e.startsWith("expands.")||r.push(e)}))}));var o=r.length?["value"].concat(r):r;this.indicatorFields=Array.from(new Set(o))},onPropSelectedChange:function(e){if(this.isDevice){var t=this.currentNode.id;this.editVal.measuringSelected=I(I({},this.measuringSelected),{},Object(r.a)({},t,e))}else this.propSelected=e,this.isIndicatorEditor?this.syncIndicator(e):e.some((function(e){return 3==+(null==e?void 0:e.propertyType)}))&&this.syncIndicator(e.filter((function(e){return 3==+(null==e?void 0:e.propertyType)}))||[],!0)},handlePropertiesChange:function(e){this.editVal.requestPayload.properties=e},handleViewChange:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Object(n.a)(l.a.mark((function i(){var n;return l.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(a||(t.tablePagination.page=1),t.activeView=e,"device"!==e){i.next=9;break}return i.next=5,t.getAssetsInnerData(t.currentNode);case 5:return i.next=7,t.doPropertySelected(t.measuringSelected[null===(n=t.currentNode)||void 0===n?void 0:n.id]||[]);case 7:i.next=13;break;case 9:return i.next=11,t.getAssetPropData(t.currentNode);case 11:return i.next=13,t.doPropertySelected(t.propSelected);case 13:case"end":return i.stop()}}),i)})))()},handleHistoryTypeChange:function(e){var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.tablePagination.page=1,this.editVal.historyType=e,t||this.onPropSelectedChange([]),this.getAssetHistoryData(this.currentNode)},handleActualTimeTypeChange:function(e){this.tablePagination.page=1,this.editVal.actualTimeType=e,"static"===e?this.handlePropertiesChange([{id:"",type:"",name:this.editVal.name}]):this.onPropSelectedChange([])},handleInputSearchName:function(e){this.editVal.name=e,this.handleHistoryParamsChange({name:e})},handleSearchName:function(e,t){this.tablePagination.page=1,this.editVal.name=e,"actualTime"===t?(this.handleHistoryParamsChange({name:e,propertyType:""}),this.getAssetPropData(this.currentNode)):(this.handleHistoryParamsChange({name:e}),this.handleHistoryTypeChange(this.editVal.historyType))},onPaginationChange:function(e){this.tablePagination.page=e.page,this.tablePagination.pageSize=e.pageSize,this.handleViewChange(this.activeView,!0)},getAssetPropData:function(e){var t=this;return Object(n.a)(l.a.mark((function a(){var i;return l.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.fetchProperty(null==e?void 0:e.identifier);case 2:i=a.sent,t.tableData=(null==i?void 0:i.result)||[],(null==i?void 0:i.pageInfo)&&(t.tablePagination=i.pageInfo);case 5:case"end":return a.stop()}}),a)})))()},handleHistoryParamsChange:function(e){this.historyTypeParams=I(I({},this.historyTypeParams),e)},resetHistoryParams:function(){this.historyTypeParams={name:"",identifier:"",propertyType:"",labels:""}},getAssetHistoryData:function(e){var t=this;return Object(n.a)(l.a.mark((function a(){var i;return l.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return t.handleHistoryParamsChange({propertyType:t.editVal.historyType,name:t.editVal.name}),a.next=3,t.fetchProperty(e.identifier);case 3:i=a.sent,t.tableData=(null==i?void 0:i.result)||[],(null==i?void 0:i.pageInfo)&&(t.tablePagination=i.pageInfo);case 6:case"end":return a.stop()}}),a)})))()},getAssetsInnerData:function(e){var t=this;return Object(n.a)(l.a.mark((function a(){var i;return l.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(null!=e&&e.regCodeIdentifier){a.next=3;break}return t.tableData=[],a.abrupt("return");case 3:return a.next=5,t.fetchProperty(null==e?void 0:e.regCodeIdentifier,{name:"",identifier:"",propertyType:"",labels:""});case 5:i=a.sent,t.tableData=((null==i?void 0:i.result)||[]).map((function(e){return I(I({},e),{},{propertyType:"5"})})),(null==i?void 0:i.pageInfo)&&(t.tablePagination=i.pageInfo);case 8:case"end":return a.stop()}}),a)})))()},ranNum:function(e,t){return Math.floor(Math.random()*(t-e+1)+e)},handleTabClick:function(e){var t=e.name,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.tablePagination.page=1,this.editVal.queryType=t,"history"===t?(this.editVal.actualTimeType="static",this.handleHistoryTypeChange(this.editVal.historyType,!1,a)):(this.editVal.historyType="collect",this.resetHistoryParams(),this.onPropSelectedChange([])),this.getAssetPropData(this.currentNode)},clearProperties:function(){delete this.measuringSelected[this.currentNodeId],this.propSelected=[]},handleNodeClick:function(e,t){var a=this;return Object(n.a)(l.a.mark((function i(){var n;return l.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(!0!==t&&a.currentNodeId!==e.id&&(a.resetData_(),a.clearProperties()),a.currentNodeId=e.id,a.currentNode=e,a.deviceName=e["regCode.name"]||"",!a.isUnDevice){i.next=11;break}return i.next=7,a.getProfileProperties(e);case 7:return i.next=9,a.getAssetPropData(e);case 9:i.next=15;break;case 11:return i.next=13,a.getAssetsInnerData(a.currentNode);case 13:return i.next=15,a.doPropertySelected(a.measuringSelected[null===(n=a.currentNode)||void 0===n?void 0:n.id]||[]);case 15:case"end":return i.stop()}}),i)})))()},resetData_:function(){this.tablePagination.page=1,this.editVal.actualTimeType="static",this.resetHistoryParams(),this.editVal.queryType="actualTime",this.editVal.historyType="collect",this.editVal.name=""},clearValidate:function(e){null!=e&&e.length?this.$refs.form.clearValidate(e):this.$refs.form.clearValidate()},setProfileInfo:function(e,t){this.profileInfo={identifier:e.identifier,company:e.identifier,description:e.description},this.profileProperties=t.map((function(t){return{name:t.propertyLocalName,prop:t.propertyName,value:e[t.propertyName]}}))},getProfileProperties:function(e){var t=this;return Object(n.a)(l.a.mark((function a(){var i,n,r,o;return l.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.fetchProfiles(e.objectType);case 2:if(i=a.sent,1!==(null==(n=null==i?void 0:i.result)?void 0:n.length)){a.next=10;break}return r=n[0],a.next=8,t.fetchProfileProperties(null==r?void 0:r.id);case 8:o=a.sent,t.setProfileInfo(e,o);case 10:case"end":return a.stop()}}),a)})))()},getEdgeDevice:function(e){return[{"icon-suffix-online":e.isOnline,"icon-suffix-offline":!e.isOnline}]},getAssetsData:function(){var e=this;return Object(n.a)(l.a.mark((function t(){var a,i,n,r;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.fetchProjectInfo();case 2:if(null==(a=t.sent)||!a.id){t.next=13;break}return e.projectName=null==a?void 0:a.name,t.next=7,e.fetchModels();case 7:return i=t.sent,n=i.map((function(e){return e.identifier})),t.next=11,e.fetchAssets(n.join(","));case 11:r=t.sent,e.assetsList=r.map((function(e){return I(I({},e),{},{isOnline:1===e.onlineStatus,regCode:!!e.regCode})}));case 13:case"end":return t.stop()}}),t)})))()},listToTree:function(e,t,a,i){var n=this;e.forEach((function(r){if(r.parentId===a.id){var o=I(I({},r),{},{children:[]});n.listToTree(e,o.children,r),o.children.length<=0&&delete o.children,"function"==typeof i?i(o)&&t.push(o):t.push(o)}}))},fetchIndicators:function(e){var t=this;return Object(n.a)(l.a.mark((function a(){var i;return l.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(i=[],null==e||!e.length){a.next=4;break}return a.next=4,t.$util.request({url:"/api/model/instances",method:"get",params:{objectType:"MEAS_INDICATOR",queryMode:"simple",pagination:0,$orderBy:"createTime desc",$filter:"identifier eq ".concat(e.join("::")),projectIdentifier:"".concat(t.projectIdentifier)}}).then((function(e){i=e})).catch((function(e){}));case 4:return a.abrupt("return",i);case 5:case"end":return a.stop()}}),a)})))()},fetchProjectInfo:function(){var e=this;return Object(n.a)(l.a.mark((function t(){var a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a={},!e.projectId){t.next=4;break}return t.next=4,e.$util.request({url:"/api/model/instances/".concat(e.projectId),method:"get"}).then((function(e){a=e})).catch((function(e){}));case 4:return t.abrupt("return",a);case 5:case"end":return t.stop()}}),t)})))()},fetchResourceInfo:function(e){var t=this;return Object(n.a)(l.a.mark((function a(){var i;return l.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(i={},!e){a.next=4;break}return a.next=4,t.$util.request({url:"/api/resource-tree/projects/".concat(e),method:"get"}).then((function(e){i=e})).catch((function(e){}));case 4:return a.abrupt("return",i);case 5:case"end":return a.stop()}}),a)})))()},fetchModels:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"IOT_MODEL",a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2?arguments[2]:void 0;return Object(n.a)(l.a.mark((function n(){var r;return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=[],!t){n.next=4;break}return n.next=4,e.$util.request({url:"/api/model/instances",method:"get",params:{objectType:t,$filter:"pathName leftlike ".concat(a).concat(i?",status ne ".concat(i):""),pagination:0,$orderBy:"createTime desc"}}).then((function(e){r=e})).catch((function(e){}));case 4:return n.abrupt("return",r);case 5:case"end":return n.stop()}}),n)})))()},fetchAssets:function(e,t){var a=this;return Object(n.a)(l.a.mark((function i(){var n,r,o,s;return l.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(n=[],!e){i.next=10;break}return i.next=4,a.$util.request({url:"/api/thing-model/instances/query-profiles",method:"post",data:{objectTypeList:e.split(",")}});case 4:return r=i.sent,o=Object(E.n)((r||[]).map((function(e){return e.identifier}))),s=[],o.forEach((function(e){s.push(new Promise((function(i,n){var r=e.join(",");a.$util.request({url:"/api/model/instances",method:"get",params:null!=t?t:{objectType:r,pagination:0,$filter:"status eq 1",$orderBy:"updateTime desc",accessMethod:"foreign_key",relationProperties:"name"}}).then((function(e){i(e)})).catch((function(){i([])}))})))})),i.next=10,Promise.all(s).then((function(e){n=Object(E.m)(e)}));case 10:return i.abrupt("return",n);case 11:case"end":return i.stop()}}),i)})))()},fetchProfiles:function(e){var t=this;return Object(n.a)(l.a.mark((function a(){var i;return l.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(i=[],!e){a.next=4;break}return a.next=4,t.$util.request({url:"/api/model/profiles",method:"get",params:{$filter:"identifier eq ".concat(e)}}).then((function(e){i=e})).catch((function(e){}));case 4:return a.abrupt("return",i);case 5:case"end":return a.stop()}}),a)})))()},fetchProfileProperties:function(e){var t=this;return Object(n.a)(l.a.mark((function a(){var i;return l.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(i=[],!e){a.next=4;break}return a.next=4,t.$util.request({url:"/api/model/profiles/".concat(e,"/properties"),method:"get",params:{$filter:"status eq 1",pagination:0,inherit:"custom",$orderBy:"createTime desc"}}).then((function(e){i=e})).catch((function(e){}));case 4:return a.abrupt("return",i);case 5:case"end":return a.stop()}}),a)})))()},fetchProperty:function(e,t){var a=this;return Object(n.a)(l.a.mark((function i(){var n,r,o,s,c,u,d,p,h,f,m,v,b;return l.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(n={},!e){i.next=7;break}return o=t||a.historyTypeParams,s=o.name,c=void 0===s?"":s,u=o.identifier,d=void 0===u?"":u,p=o.propertyType,h=void 0===p?"":p,f=o.labels,m=void 0===f?"":f,v=Object(T.c)(a.propertyTypeMap),b=null!==(r=v[h])&&void 0!==r?r:"",i.next=7,a.$util.request({url:"/api/thing-model/instances/".concat(e,"/properties"),method:"get",params:{$page:a.tablePagination.page,$pageSize:a.tablePagination.pageSize,$filter:"name like ".concat(c,",identifier eq ").concat(d,",propertyType eq ").concat(b,",labels em ").concat(m,",configFlag eq 1")}}).then((function(e){n=e})).catch((function(e){}));case 7:return i.abrupt("return",n);case 8:case"end":return i.stop()}}),i)})))()},handleAssetsClick:function(){this.$setAttr(this.data,"editorDialogVisible",!0),this.dialogVisible=!0},onClose:function(){var e;this.closeHandler("assets"),null===(e=this.$refs.assetsTable)||void 0===e||e.clearSelection()},handleClear:function(){this.clearByType("assets")},resetEditorVal:function(){this.editVal={accessType:"assets",linkType:this.linkType,url:"/api/indicator/values/aggregation",method:"post",contentType:"application/json",pagination:0,defaultLoad:!0,fields:"",historyType:"collect",queryType:"actualTime",actualTimeType:"static",measuringSelected:{},requestPayload:{assetId:"",deviceId:"",properties:[{id:"",type:"",name:""}]},rtEditor:{accessType:"rtdata",linkType:this.linkType,url:"/api/realtimedata/records",method:"get",contentType:"application/json",objectType:"",rtDataType:2,requestPayload:{instanceId:"",queryDirection:1,querySize:1e3,$orderBy:"collectTime asc",collectTime:"",queryMode:1,$filter:"",objectType:"",queryType:1,beginTime:"",endTime:"",recordType:1},variableEditData:{instanceIdData:{name:"instanceId",value:"",editValue:null},collectTimeData:{name:"collectTime",value:"",editValue:null},beginTimeData:{name:"beginTime",value:"",editValue:null},endTimeData:{name:"endTime",value:"",editValue:null}},responseSchema:{},exceptionStrategy:"throw",showIdTable:!0,filterItems:[{name:"",value:"",filter:"",editValue:""}],tableData:[]},indicatorEditor:{accessType:"indicator",linkType:this.linkType,url:"/api/indicator/values/aggregation",method:"post",contentType:"application/json",fields:"",dataType:"",requestPayload:{indicatorIds:"",queryLatest:1,timeRangeType:"fixed",queryType:"",updateTimeBegin:"",updateTimeEnd:"",relativeTime:"",dimensionTime:"",aggOperation:"",sortOperation:"",cmpOperation:"",precision:"",filters:"",valueFilter:""},variableEditData:{indicatorIdsData:{name:"indicatorIds",value:"",editValue:null},updateTimeBeginData:{name:"updateTimeBegin",value:"",editValue:null},updateTimeEndData:{name:"updateTimeEnd",value:"",editValue:null},dimensionTimeData:{name:"dimensionTime",value:"",editValue:null},compareTimeData:{name:" compareTime",value:"",editValue:null},parentIdData:{name:" parentId",value:"",editValue:null},timeDimensionData:{name:" timeDimension",value:"",editValue:null},projectData:{name:"project",value:"",editValue:null},valueData:{name:"value",value:"",editValue:null}},assistAttr:{relativeType:"current",relativeNumber:1,timeDimension:"",orderNumber:1,orderType:"asc",compareType:"M2M",compareNumber:1,isNow:!1,compareTime:"",tableData:[{id:this.$util.uuid(),rowInfo:{},isDynamic:!1,selected:[]}],extraFilter:"",timeDimensionFilter:"",parentIdFilter:"",projectFilter:"",dimensionTimeFilter:"",valueFilterOperator:"",valueFilter:""},responseSchema:{},exceptionStrategy:"throw"},variableEditData:{properties:{name:"properties",value:"",editValue:null}}}},resetData:function(){this.showVal="",this.resetEditorVal(),this.commonResetData()},validate:function(){return!0},getHandlerEditVal:function(){var e,t,a,n=Object(u.e)(this.editVal),r=this.propSelected,o=null==n?void 0:n.measuringSelected[this.currentNode.id];null!=o&&o.length&&(r=[].concat(Object(i.a)(r),Object(i.a)(o.map((function(e){return I(I({},e),{},{propertyType:"5"})})))));var l=T.b.call(this,r),s="dynamic"===n.actualTimeType;return n.requestPayload={assetId:this.currentNode.id,identifier:this.currentNode.identifier,deviceId:this.currentNode.edgeCode,filters:(null==n||null===(e=n.requestPayload)||void 0===e?void 0:e.filters)||"",properties:s?null==n||null===(t=n.variableEditData)||void 0===t||null===(a=t.properties)||void 0===a?void 0:a.value:l},n},syncTableToProps:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.indicatorList||[],a=[],i=[],n={};for(var r in t.forEach((function(e){e.isDynamic?((null==e?void 0:e.selected)||[]).forEach((function(t){n[t]?n[t].push(e.rowInfo[t]):n[t]=[e.rowInfo[t]]})):a.push(e.rowInfo.indicatorId)})),n){var o=n[r].join("::");o&&i.push("".concat(r," eq ").concat(o))}var l=a.join(","),s=i.length?"$filter="+i.join(","):"";e?(this.editVal.indicatorEditor.requestPayload.indicatorIds=l,this.editVal.indicatorEditor.requestPayload.filters=s):this.editVal.requestPayload.filters=s},refreshEditValPayload:function(){var e,t;"current"===this.editVal.indicatorEditor.assistAttr.relativeType&&(this.editVal.indicatorEditor.assistAttr.relativeNumber=1);var a=this.editVal.indicatorEditor.assistAttr,i=a.relativeType,n=a.relativeNumber,r=a.timeDimension,o=a.orderNumber,l=a.orderType,s=a.compareType,c=a.compareNumber,u=a.isNow,d=a.compareTime,p=a.dimensionTimeFilter,h=i?"".concat(i,":").concat(n,":").concat(r):"";this.editVal.indicatorEditor.requestPayload.relativeTime=h;var f=o?"".concat(o,":").concat(l):"";this.editVal.indicatorEditor.requestPayload.sortOperation=f;var m=u?"now":d,v=s?"".concat(s,":").concat(c,":").concat(m):"";this.editVal.indicatorEditor.requestPayload.cmpOperation=v;var b=this.editVal.indicatorEditor.variableEditData,g=b.updateTimeBeginData,y=b.updateTimeEndData;this.editVal.indicatorEditor.requestPayload.dimensionTime=p,this.editVal.indicatorEditor.requestPayload.updateTimeBegin=null!==(e=g.value)&&void 0!==e?e:"",this.editVal.indicatorEditor.requestPayload.updateTimeEnd=null!==(t=y.value)&&void 0!==t?t:"","fixed"===this.editVal.indicatorEditor.requestPayload.timeRangeType?this.editVal.indicatorEditor.requestPayload.relativeTime="":"relative"===this.editVal.indicatorEditor.requestPayload.timeRangeType&&(this.editVal.indicatorEditor.requestPayload.dimensionTime="",this.editVal.indicatorEditor.requestPayload.updateTimeBegin="",this.editVal.indicatorEditor.requestPayload.updateTimeEnd="")},additionalFilter:function(){var e=this.editVal.indicatorEditor.assistAttr.extraFilter;e&&(this.editVal.indicatorEditor.requestPayload.filters?this.editVal.indicatorEditor.requestPayload.filters=this.editVal.indicatorEditor.requestPayload.filters+","+e:this.editVal.indicatorEditor.requestPayload.filters="$filter=".concat(e))},staticParamFilter:function(){var e=this,t=this.editVal.indicatorEditor.assistAttr;[{name:"parentId",value:t.parentIdFilter},{name:"timeDimension",value:t.timeDimensionFilter},{name:"indicatorItemId",value:t.projectFilter}].forEach((function(t){t&&null!=t&&t.value&&(e.editVal.indicatorEditor.requestPayload.filters?e.editVal.indicatorEditor.requestPayload.filters=e.editVal.indicatorEditor.requestPayload.filters+","+"".concat(t.name," eq ").concat(t.value):e.editVal.indicatorEditor.requestPayload.filters="$filter=".concat(t.name," eq ").concat(t.value))}))},cleanData:function(){var e=this.editVal.requestPayload,t=e.queryType,a=e.timeRangeType;switch(t){case"1":this.editVal.requestPayload.aggOperation="",this.editVal.requestPayload.sortOperation="",this.editVal.requestPayload.cmpOperation="",this.editVal.requestPayload.updateTimeBegin="",this.editVal.requestPayload.updateTimeEnd="","fixed"===a?this.editVal.requestPayload.relativeTime="":"relative"===a&&(this.editVal.requestPayload.dimensionTime="");break;case"2":this.editVal.requestPayload.aggOperation="",this.editVal.requestPayload.sortOperation="",this.editVal.requestPayload.cmpOperation="",this.editVal.requestPayload.dimensionTime="","fixed"===a?this.editVal.requestPayload.relativeTime="":"relative"===a&&(this.editVal.requestPayload.updateTimeBegin="",this.editVal.requestPayload.updateTimeEnd="");break;case"3":this.editVal.requestPayload.sortOperation="",this.editVal.requestPayload.cmpOperation="",this.editVal.requestPayload.dimensionTime="","fixed"===a?this.editVal.requestPayload.relativeTime="":"relative"===a&&(this.editVal.requestPayload.updateTimeBegin="",this.editVal.requestPayload.updateTimeEnd="");break;case"4":this.editVal.requestPayload.aggOperation="",this.editVal.requestPayload.cmpOperation="",this.editVal.requestPayload.dimensionTime="","fixed"===a?this.editVal.requestPayload.relativeTime="":"relative"===a&&(this.editVal.requestPayload.updateTimeBegin="",this.editVal.requestPayload.updateTimeEnd="");break;case"5":this.editVal.requestPayload.aggOperation="",this.editVal.requestPayload.sortOperation="",this.editVal.requestPayload.dimensionTime="",this.editVal.requestPayload.updateTimeBegin="",this.editVal.requestPayload.updateTimeEnd=""}},getTimeStamp:function(e){return new Date(e).valueOf()},handleSubmit:function(){var e=this;if(this.isIndicatorEditor&&(void 0===this.editVal.indicatorEditor.requestPayload.queryType||""===this.editVal.indicatorEditor.requestPayload.queryType))return this.$message.warning("请配置查询配置"),!1;this.$refs.form.validate((function(t){if(t){if("history"===e.editVal.queryType&&"indicator"===e.editVal.historyType){if(e.syncTableToProps(),e.refreshEditValPayload(),e.additionalFilter(),e.staticParamFilter(),e.cleanData(),e.editVal.indicatorEditor.requestPayload.updateTimeEnd&&e.editVal.indicatorEditor.requestPayload.updateTimeBegin){var a=e.getTimeStamp(e.editVal.indicatorEditor.requestPayload.updateTimeEnd),i=e.getTimeStamp(e.editVal.indicatorEditor.requestPayload.updateTimeBegin);if("number"==typeof a&&"number"==typeof i&&!window.isNaN(a)&&!window.isNaN(i)&&i>a)return void e.$message({type:"error",message:"开始时间需要早于结束时间"})}if(!e.editVal.indicatorEditor.requestPayload.queryType)return void e.$message({type:"error",message:"请设置“查询配置”"})}else e.hasIndicator&&e.syncTableToProps(!1);e.commonSureHandler("assets")}}))}}},D=(a("5fd4"),a("662a"),Object(f.a)(A,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"assets-link-editor"},[t("el-input",{staticClass:"editor-input",attrs:{value:e.showVal,readonly:"",size:"mini",clearable:""},nativeOn:{click:function(t){return e.handleAssetsClick.apply(null,arguments)}}}),t("el-drawer",{attrs:{"custom-class":"editor-drawer t-text-regular",size:"1000px",visible:e.dialogVisible,direction:"rtl",wrapperClosable:!1,"append-to-body":!0},on:{"update:visible":function(t){e.dialogVisible=t},close:e.onClose}},[t("div",{staticClass:"editor-drawer-title",attrs:{slot:"title"},slot:"title"},[t("div",{staticClass:"title-text"},[e._v("\n        资产\n        "),t("a",{directives:[{name:"show",rawName:"v-show",value:e.assetsTipsLoaded&&e.assetsTipsLoaded.description,expression:"assetsTipsLoaded && assetsTipsLoaded.description"}],attrs:{href:e.assetsTipsLoaded&&e.assetsTipsLoaded.description,target:"_blank"}},[t("i",{staticClass:"el-icon-question"})])]),t("div",{staticClass:"title-btn"},[t("el-button",{attrs:{size:"small"},on:{click:e.handleClear}},[e._v("\n          清空\n        ")]),t("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.handleSubmit}},[e._v("\n          提交\n        ")])],1)]),t("control-common-alert",{staticClass:"assets-link-alert",attrs:{show:!e.showCloseTips},on:{showCloseTips:function(t){e.showCloseTips=!0}}},[t("div",{domProps:{innerHTML:e._s(e.assetsTipsLoaded&&e.assetsTipsLoaded.value)}}),t("em",{staticClass:"assets-link-document t-color-primary"},[t("span",[e._v("边缘设备图标")]),t("svg",{staticStyle:{"margin-left":"3px"},attrs:{width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[t("path",{staticStyle:{fill:"#0099F2"},attrs:{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M10.991 5.69215C11.1209 5.79946 11.2942 5.85312 11.4782 5.85312C11.8572 5.85312 12.1712 5.59557 12.1712 5.27364C12.1712 3.7391 11.1967 2.33333 9.60504 1.57143C8.01336 0.809524 6.03189 0.809524 4.44021 1.57143C2.83771 2.33333 1.85238 3.74983 1.85238 5.28437C1.85238 5.59557 2.16639 5.85312 2.54536 5.85312C2.92433 5.85312 3.23833 5.59557 3.23833 5.28437C3.23833 4.15761 3.95296 3.12743 5.12236 2.56942C6.29175 2.0114 7.73184 2.0114 8.90124 2.56942C10.0706 3.12743 10.7853 4.15761 10.7853 5.28437C10.7853 5.43461 10.8611 5.57411 10.991 5.69215ZM2.29632 7.89202H11.7056C12.0738 7.89202 12.3769 8.24614 12.3769 8.68612V12.2059C12.3769 12.6459 12.0738 13 11.7056 13H2.29632C1.92818 13 1.625 12.6351 1.625 12.2059V8.68612C1.625 8.24614 1.92818 7.89202 2.29632 7.89202ZM3.54151 10.9933C3.68227 10.9933 3.83386 10.9289 3.95296 10.8216C4.06124 10.7036 4.12621 10.5533 4.13703 10.4031C4.13703 10.0812 3.86634 9.81288 3.54151 9.81288C3.21668 9.81288 2.94598 10.0812 2.94598 10.4031C2.94598 10.725 3.21668 10.9933 3.54151 10.9933ZM5.33891 10.9933C5.47967 10.9933 5.63126 10.9289 5.75037 10.8216C5.85864 10.7036 5.92361 10.5533 5.93444 10.4031C5.93444 10.0812 5.67457 9.81288 5.33891 9.81288C5.01408 9.81288 4.74339 10.0812 4.74339 10.4031C4.74339 10.725 5.00325 10.9933 5.33891 10.9933ZM7.1688 10.9933C7.30956 10.9933 7.46115 10.9289 7.58025 10.8216C7.69936 10.7036 7.76432 10.5533 7.76432 10.4031C7.76432 10.0812 7.50446 9.81288 7.1688 9.81288C6.84397 9.81288 6.57327 10.0812 6.57327 10.4031C6.57327 10.725 6.83314 10.9933 7.1688 10.9933ZM6.99555 7.45205C6.56245 7.45205 6.21596 7.11938 6.21596 6.70087C6.21596 6.29309 6.56245 5.96043 6.99555 5.9497C7.42866 5.9497 7.77515 6.28236 7.77515 6.70087C7.77515 7.11938 7.42866 7.45205 6.99555 7.45205ZM8.85667 6.25035C8.9866 6.35766 9.15984 6.41131 9.34391 6.41131C9.72289 6.41131 10.0369 6.15377 10.0261 5.8533C10.0261 4.46899 8.65094 3.3315 6.98347 3.3315C5.316 3.3315 3.9517 4.44753 3.9517 5.84257C3.9517 6.05719 4.09246 6.23961 4.30902 6.34692C4.52557 6.45424 4.77461 6.45424 5.00199 6.34692C5.22938 6.23961 5.35931 6.05719 5.35931 5.84257C5.35931 5.08066 6.0956 4.46899 7.00512 4.46899C7.90383 4.46899 8.65094 5.08066 8.65094 5.84257C8.65094 5.9928 8.72673 6.14303 8.85667 6.25035Z",fill:"#00B864"}})])]),t("span",[e._v("将显示其所有的内置测点。")])]),t("div",{staticClass:"assets-header t-text-primary"},[e._v("\n      "+e._s(e.projectName)+"\n    ")]),t("div",{staticClass:"assets-contents"},[t("el-row",{attrs:{gutter:32}},[t("el-col",{staticStyle:{"border-right":"1px solid #F2F5F7"},attrs:{span:6}},[t("el-input",{attrs:{placeholder:"搜索资产","suffix-icon":"el-icon-search"},model:{value:e.searchName,callback:function(t){e.searchName=t},expression:"searchName"}}),t("el-tree",{ref:"assetsTree",staticClass:"assets-tree",attrs:{data:e.assetsData,props:e.defaultProps,"highlight-current":!0,"current-node-key":e.currentNodeId,"node-key":"id","default-expand-all":"","expand-on-click-node":!1},on:{"node-click":e.handleNodeClick},scopedSlots:e._u([{key:"default",fn:function(a){var i=a.node,n=a.data;return t("div",{staticClass:"assets-tree-node"},[t("i",{class:[n.icon||"icon-module","icon-prefix","t-color-primary"]}),t("span",{staticClass:"tree-title"},[e._v(e._s(i.label))]),n.regCode?t("svg",{staticStyle:{margin:"0 5px"},attrs:{width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[t("path",{class:e.getEdgeDevice(n),attrs:{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M10.991 5.69215C11.1209 5.79946 11.2942 5.85312 11.4782 5.85312C11.8572 5.85312 12.1712 5.59557 12.1712 5.27364C12.1712 3.7391 11.1967 2.33333 9.60504 1.57143C8.01336 0.809524 6.03189 0.809524 4.44021 1.57143C2.83771 2.33333 1.85238 3.74983 1.85238 5.28437C1.85238 5.59557 2.16639 5.85312 2.54536 5.85312C2.92433 5.85312 3.23833 5.59557 3.23833 5.28437C3.23833 4.15761 3.95296 3.12743 5.12236 2.56942C6.29175 2.0114 7.73184 2.0114 8.90124 2.56942C10.0706 3.12743 10.7853 4.15761 10.7853 5.28437C10.7853 5.43461 10.8611 5.57411 10.991 5.69215ZM2.29632 7.89202H11.7056C12.0738 7.89202 12.3769 8.24614 12.3769 8.68612V12.2059C12.3769 12.6459 12.0738 13 11.7056 13H2.29632C1.92818 13 1.625 12.6351 1.625 12.2059V8.68612C1.625 8.24614 1.92818 7.89202 2.29632 7.89202ZM3.54151 10.9933C3.68227 10.9933 3.83386 10.9289 3.95296 10.8216C4.06124 10.7036 4.12621 10.5533 4.13703 10.4031C4.13703 10.0812 3.86634 9.81288 3.54151 9.81288C3.21668 9.81288 2.94598 10.0812 2.94598 10.4031C2.94598 10.725 3.21668 10.9933 3.54151 10.9933ZM5.33891 10.9933C5.47967 10.9933 5.63126 10.9289 5.75037 10.8216C5.85864 10.7036 5.92361 10.5533 5.93444 10.4031C5.93444 10.0812 5.67457 9.81288 5.33891 9.81288C5.01408 9.81288 4.74339 10.0812 4.74339 10.4031C4.74339 10.725 5.00325 10.9933 5.33891 10.9933ZM7.1688 10.9933C7.30956 10.9933 7.46115 10.9289 7.58025 10.8216C7.69936 10.7036 7.76432 10.5533 7.76432 10.4031C7.76432 10.0812 7.50446 9.81288 7.1688 9.81288C6.84397 9.81288 6.57327 10.0812 6.57327 10.4031C6.57327 10.725 6.83314 10.9933 7.1688 10.9933ZM6.99555 7.45205C6.56245 7.45205 6.21596 7.11938 6.21596 6.70087C6.21596 6.29309 6.56245 5.96043 6.99555 5.9497C7.42866 5.9497 7.77515 6.28236 7.77515 6.70087C7.77515 7.11938 7.42866 7.45205 6.99555 7.45205ZM8.85667 6.25035C8.9866 6.35766 9.15984 6.41131 9.34391 6.41131C9.72289 6.41131 10.0369 6.15377 10.0261 5.8533C10.0261 4.46899 8.65094 3.3315 6.98347 3.3315C5.316 3.3315 3.9517 4.44753 3.9517 5.84257C3.9517 6.05719 4.09246 6.23961 4.30902 6.34692C4.52557 6.45424 4.77461 6.45424 5.00199 6.34692C5.22938 6.23961 5.35931 6.05719 5.35931 5.84257C5.35931 5.08066 6.0956 4.46899 7.00512 4.46899C7.90383 4.46899 8.65094 5.08066 8.65094 5.84257C8.65094 5.9928 8.72673 6.14303 8.85667 6.25035Z",fill:"#00B864"}})]):e._e()])}}])})],1),t("el-col",{attrs:{span:18}},[t("assets-header",{attrs:{activeView:e.activeView,profileInfo:e.profileInfo,profileProperties:e.profileProperties,currentNode:e.currentNode,queryType:e.editVal.queryType,historyType:e.editVal.historyType,name:e.editVal.name,deviceName:e.deviceName,actualTimeType:e.editVal.actualTimeType,types:e.types,editVal:e.editVal,selectedLength:e.selectedLength},on:{"tab-click":e.handleTabClick,"view-change":e.handleViewChange,"history-type-change":e.handleHistoryTypeChange,"actualTime-type-change":e.handleActualTimeTypeChange,"handle-search-name":e.handleSearchName,"handle-input-search-name":e.handleInputSearchName}}),e.isStatic?t("assets-table",{ref:"assetsTable",attrs:{"multiple-selection":e.isDevice?e.measuringSelected[e.currentNodeId]:e.propSelected,data:e.tableData,pagination:e.tablePagination,types:e.types,propertyTypeMap:e.propertyTypeMap,deviceName:e.deviceName},on:{selectionChange:e.onPropSelectedChange,paginationChange:e.onPaginationChange}}):e._e(),e.isDynamic?t("assets-dynamic",{staticClass:"assets-dynamic",attrs:{editVal:e.editVal},on:{"properties-change":e.handlePropertiesChange}}):e._e(),e._e(),t("el-form",{ref:"form",attrs:{"label-width":"150px",model:e.formData}},[e.isRTEditor?t("editor-collapse",{staticClass:"link-editor-collapse",attrs:{title:"历史数据"}},[t("history-setting",{attrs:{editVal:e.editVal.rtEditor}})],1):e._e(),e.isIndicatorEditor||this.hasIndicator?[t("editor-collapse",{staticClass:"link-editor-collapse",attrs:{title:"指标配置"}},[t("assets-indicator-table",{directives:[{name:"loading",rawName:"v-loading",value:e.syncIndicatorLoading,expression:"syncIndicatorLoading"}],attrs:{list:e.indicatorList,updateList:e.refreshIndicators},on:{indicatorChange:e.onIndicatorChange}}),e.indicatorList.length?e._e():t("div",{staticClass:"assets-indicator-empty t-text-placeholder t-border__top"},[e._v("请先选择资产属性")])],1),e.isIndicatorEditor?t("editor-collapse",{staticClass:"link-editor-collapse",attrs:{title:"查询配置"}},[t("param-setting",{attrs:{editVal:e.editVal.indicatorEditor},on:{clearValidate:e.clearValidate}})],1):e._e(),e.isIndicatorEditor?t("editor-collapse",{staticClass:"link-editor-collapse",attrs:{title:"筛选项"}},[t("filter-setting",{attrs:{editVal:e.editVal.indicatorEditor}})],1):e._e()]:e._e(),t("editor-collapse",{staticClass:"link-editor-collapse",attrs:{title:"其它"}},[t("response-fields",{attrs:{fields:e.responseFields,description:e.responseDescription}}),t("common-link-set",{attrs:{hiddenConfig:e.hiddenConfig,config:e.commonLinkSet,data:e.data,defaultLoad:e.defaultLoad}})],1)],2)],1)],1)],1)],1)],1)}),[],!1,null,"44061495",null));t.default=D.exports},6887:function(e,t,a){"use strict";a("fceb")},6994:function(e,t,a){"use strict";a("afcd")},"6a5b":function(e){e.exports=JSON.parse('[{"name":"general","alias":"通用","sort":100,"attributes":[{"name":"componentType","alias":"组件类型","type":"String","readonly":true,"default":"Page","value":"Page","visible":false},{"name":"componentName","alias":"页面名称","type":"String","readonly":true,"default":"Page","value":"Page","visible":false},{"name":"pageName","alias":"页面名称","type":"String","readonly":true,"default":"Page","value":"Page","linkable":false},{"name":"pageTitle","alias":"页面标题","type":"String","value":"","linkable":false,"rules":[{"maxlength":50,"message":"最大字符不能超过50"}]}]},{"name":"appearance","alias":"外观","sort":200,"attributes":[{"name":"background-color","alias":"背景颜色","type":"String","default":"","editor":"color","tips":"背景颜色"},{"name":"background-image","alias":"背景图片","type":"String","default":"","editor":"file","editorParams":{"type":"picture","title":"选择图片"},"tips":"背景图片"},{"name":"background-repeat","alias":"背景图像平铺","type":"Enum(\\"no-repeat:不平铺\\", \\"repeat-x:水平平铺\\", \\"repeat-y:垂直平铺\\", \\"repeat:平铺\\")","default":"no-repeat","tips":"背景图像平铺规则"},{"name":"background-size","alias":"背景图片尺寸","type":"String","default":"100%","sort":2012,"tips":"允许六种类型值：1、缩小图片适应元素尺寸:contain；2、扩展图片填满元素:cover；3、指定大小数值+px:100px 100px；4、指定大小百分比:50% 50%；5、3和4的混合:100px 100%；6、空字符","rules":[{"require":false},{"pattern":"/^((__quote:percentage__)(((\\\\s(__quote:percentage__))?)|((\\\\s([1-9]?[0-9]{0,3}px))?))|([1-9]?[0-9]{0,3}px)(((\\\\s([1-9]?[0-9]{0,3}px))?)|((\\\\s(__quote:percentage__))?))|(contain)|(cover))$/","message":"请输入contain、cover、百分比、数字+px、空字符中的一种"}]},{"name":"background-position","alias":"背景图片定位","type":"Enum(\\"left top:左上角\\", \\"center top:顶部居中\\", \\"right top:右上角\\", \\"center center:居中\\", \\"left bottom:左下角\\", \\"center bottom:底部居中\\", \\"right bottom:右下角\\")","default":"left top","tips":"背景图片定位"}]},{"name":"layout","alias":"布局","sort":300,"attributes":[{"name":"margin","alias":"外边距","type":"Number[4]","min":0,"default":[0,0,0,0],"precision":0,"primitiveLabels":["上","右","下","左"]},{"name":"padding","alias":"内边距","type":"Number[4]","min":0,"default":[0,0,0,0],"precision":0,"primitiveLabels":["上","右","下","左"]},{"name":"gutter","alias":"栅格间隔","type":"Number","min":0,"max":9999,"default":10},{"name":"width","alias":"宽度","type":"String","default":"100%","tips":"允许两种值：1.数字+px:300px；2.百分比:100%","rules":[{"pattern":"/^(__quote:percentage__|([1-9]?[0-9]{0,3}px))$/","message":"请输入百分比、数字+px中的一种"}]},{"name":"height","alias":"高度","type":"String","default":"100%","tips":"允许两种值：1.数字+px:300px；2.百分比:100%","rules":[{"pattern":"/^(__quote:percentage__|([1-9]?[0-9]{0,3}px))$/","message":"请输入百分比、数字+px中的一种"}]},{"name":"overflow","alias":"内容溢出","type":"Enum(\\"visible:默认\\", \\"hidden:隐藏\\", \\"auto:自动\\")","default":"visible"},{"name":"type","alias":"布局模式","type":"Enum(\\"none:普通布局\\", \\"flex:flex布局\\")","default":"none","visible":false},{"name":"justify","alias":"水平排列方式","type":"Enum(\\"start:start\\", \\"end:end\\", \\"center:center\\", \\"space-around:space-around\\", \\"space-between:space-between\\")","default":"start","visible":false},{"name":"align","alias":"垂直排列方式","type":"Enum(\\"top:top\\", \\"middle:middle\\", \\"bottom:bottom\\")","default":"top","visible":false}]},{"name":"permission","alias":"权限","sort":400,"attributes":[{"name":"permissionId","alias":"关联权限","type":"Complex","editor":"permission","editorParams":{"moduleType":3,"key":"permissionIdentifier"}}]},{"name":"variable","alias":"变量","sort":500,"attributes":[{"name":"pageVariable","alias":"预设变量","type":"Complex[*]","readonly":true,"inputVisible":false,"attributes":"smartAttrs.variable","default":[{"name":"queryParams","alias":"页面参数","isObject":true,"description":"包含get参数及pageVariables","objectAttr":[]},{"name":"userInfo","alias":"用户信息","isObject":true,"objectAttr":[{"name":"account","alias":"账号"},{"name":"username","alias":"姓名"},{"name":"status","alias":"在线状态"},{"name":"id","alias":"标识"},{"name":"email","alias":"邮箱"},{"name":"telephone","alias":"手机号码"},{"name":"roleIds","alias":"角色ID"}]},{"name":"employee","alias":"职员信息","isObject":true,"description":"职员信息","objectAttr":[]},{"name":"theme","alias":"主题","isObject":true,"description":"主题信息","objectAttr":[{"name":"id","alias":"主键","description":"主题主键"},{"name":"themeKey","alias":"标识","description":"主题标识"},{"name":"name","alias":"名称","description":"主题名称"}]},{"name":"permissions","alias":"页面参数","isObject":true,"description":"包含get参数及pageVariables","objectAttr":[],"mapping":"allPermissions"},{"name":"projectIdentifier","alias":"工程标识","isObject":false,"type":"String","description":"当前所在工程的标识","objectAttr":[]}]},{"name":"customVariable","alias":"自定义变量","type":"Complex[*]","inputVisible":false,"attributes":"smartAttrs.customVariable"}]},{"name":"events","alias":"事件","sort":600,"attributes":[{"name":"onbeforeload","alias":"页面加载前","type":"Complex","attributes":[{"name":"content","alias":"事件执行内容","type":"Complex[*]","inputVisible":false,"attributes":"smartAttrs.eventContent"},{"name":"description","alias":"事件描述","type":"String","default":"页面加载前事件，此时可以对数据进行操作","readonly":true}]},{"name":"onload","alias":"页面加载完成","type":"Complex","attributes":[{"name":"content","alias":"事件执行内容","type":"Complex[*]","inputVisible":false,"attributes":"smartAttrs.eventContent"},{"name":"description","alias":"事件描述","type":"String","default":"页面加载完成事件","readonly":true}]},{"name":"timer","alias":"定时器","type":"Complex","attributes":[{"name":"content","alias":"事件执行内容","type":"Complex[*]","inputVisible":false,"attributes":"smartAttrs.timerEventContent"},{"name":"description","alias":"事件描述","type":"String","default":"定时器事件","readonly":true}]},{"name":"beforeunload","alias":"页面离开前","type":"Complex","attributes":[{"name":"content","alias":"事件执行内容","type":"Complex[*]","inputVisible":false,"attributes":"smartAttrs.eventContent"},{"name":"description","alias":"事件描述","type":"String","default":"页面离开前事件","readonly":true}]},{"name":"afterRefreshAsyncVariables","alias":"刷新异步自定义变量完成","type":"Complex","attributes":[{"name":"content","alias":"事件执行内容","type":"Complex[*]","inputVisible":false,"attributes":"smartAttrs.eventContent"},{"name":"description","alias":"事件描述","type":"String","default":"刷新异步自定义变量完成","readonly":true},{"name":"payload","alias":"参数","type":"Complex[1]","readonly":true,"inputVisible":false,"attributes":"smartAttrs.payload","default":[{"name":"value","alias":"变量值"}]}]},{"name":"onresize","alias":"窗口调整大小","type":"Complex","attributes":[{"name":"content","alias":"事件执行内容","type":"Complex[*]","inputVisible":false,"attributes":"smartAttrs.eventContent"},{"name":"description","alias":"事件描述","type":"String","default":"窗口调整大小事件","readonly":true},{"name":"payload","alias":"参数","type":"Complex[1]","readonly":true,"inputVisible":false,"attributes":"smartAttrs.payload","default":[{"name":"eventTarget","alias":"事件目标"}]}]},{"name":"onKeyDown","alias":"监听按键事件","type":"Complex","attributes":[{"name":"content","alias":"事件执行内容","type":"Complex[*]","inputVisible":false,"attributes":"smartAttrs.keypadEventContent"},{"name":"description","alias":"事件描述","type":"String","default":"监听按键按下事件","readonly":true},{"name":"payload","alias":"参数","type":"Complex[1]","readonly":true,"inputVisible":false,"attributes":"smartAttrs.payload","default":[{"name":"eventTarget","alias":"事件目标"}]}]}]},{"name":"methods","alias":"方法","sort":700,"attributes":[{"name":"customMethods","alias":"自定义方法","type":"Complex[*]","showField":true,"inputVisible":false,"attributes":[{"name":"name","alias":"方法名称","type":"String","titleVisible":true,"visible":false,"inputVisible":false,"default":""},{"name":"customMethodsSetting","alias":"配置","type":"String","editor":"custom-method","attributes":"smartAttrs.customMethod","linkable":false,"default":{"functionName":"","description":"","payload":[{"name":"","alias":"","default":""}],"content":""}}]},{"name":"pageMethods","alias":"预设方法","type":"Complex","showField":true,"attributes":[{"alias":"仅用于分割","visible":false}]},{"name":"$setVariable","alias":"设置变量","type":"Complex","readonly":true,"attributes":[{"name":"functionName","alias":"方法名称","type":"String","default":"$setVariable"},{"name":"description","alias":"方法描述","type":"String","default":"设置变量"},{"name":"payload","alias":"参数","type":"Complex[3]","inputVisible":false,"attributes":"smartAttrs.payload","default":[{"name":"name","alias":"变量名","editor":"variable","editorParams":{"type":"variable","useOnlyName":true}},{"name":"value","alias":"变量值","editor":"variable"},{"name":"key","alias":"变量值的属性名","editor":"variable","editorParams":{"type":"variable","useOnlyName":true,"useLastName":true}}]}]},{"name":"$clearVariable","alias":"清除变量","type":"Complex","readonly":true,"attributes":[{"name":"functionName","alias":"方法名称","type":"String","default":"$clearVariable"},{"name":"description","alias":"方法描述","type":"String","default":"清除变量"},{"name":"payload","alias":"参数","type":"Complex[1]","inputVisible":false,"attributes":"smartAttrs.payload","default":[{"name":"name","alias":"变量名","editor":"variable","editorParams":{"type":"variable","useOnlyName":true}}]}]},{"name":"$notEmptyCheckVariable","alias":"变量非空校验","type":"Complex","readonly":true,"attributes":[{"name":"functionName","alias":"方法名称","type":"String","default":"$notEmptyCheckVariable"},{"name":"description","alias":"方法描述","type":"String","default":"变量非空校验"},{"name":"payload","alias":"参数","type":"Complex[3]","inputVisible":false,"attributes":"smartAttrs.payload","default":[{"name":"name","alias":"变量名","editor":"variable","editorParams":{"type":"variable","useOnlyName":true}},{"name":"falseMessage","alias":"为假提示消息"},{"name":"trueMessage","alias":"为真提示消息"}]},{"name":"output","alias":"返回值","type":"Boolean|String","description":"变量是否非空"}]},{"name":"$openDialog","alias":"打开弹出窗口","type":"Complex","readonly":true,"attributes":[{"name":"functionName","alias":"方法名称","type":"String","default":"$openDialog"},{"name":"description","alias":"方法描述","type":"String","default":"打开弹出窗口"},{"name":"payload","alias":"参数","type":"Complex[7]","inputVisible":false,"attributes":"smartAttrs.payload","default":[{"name":"title","alias":"弹窗标题","editor":"variable"},{"name":"url","alias":"页面","editor":"page"},{"name":"width","alias":"弹窗宽度"},{"name":"height","alias":"弹窗高度","default":"auto"},{"name":"top","alias":"弹窗上偏移量","default":"15vh"},{"name":"showFooter","alias":"操作按钮显示","type":"Boolean","default":false},{"name":"pageVariables","alias":"页面接收的变量","editor":"variable"},{"name":"includedSelf","alias":"变量值是否包含本身","type":"Boolean","default":false},{"name":"beforeClose","alias":"关闭前事件","isCallback":true,"args":[{"name":"done","alias":"done"}]},{"name":"closeEvent","alias":"关闭后事件","isCallback":true},{"name":"draggable","alias":"可拖动","type":"Boolean","default":true}]}]},{"name":"$openCodeEditor","alias":"打开代码编辑器","type":"Complex","readonly":true,"attributes":[{"name":"functionName","alias":"方法名称","type":"String","default":"$openCodeEditor"},{"name":"description","alias":"方法描述","type":"String","default":"打开代码编辑器"},{"name":"payload","alias":"参数","type":"Complex[7]","inputVisible":false,"attributes":"smartAttrs.payload","default":[{"name":"language","alias":"语言类型","type":"Enum(\\"application/json:JSON\\", \\"text/javascript:JavaScript\\")","default":"application/json"},{"name":"code","alias":"内容","editor":"variable"},{"name":"checked","type":"Boolean","alias":"开启内容校验","default":true},{"name":"title","alias":"弹窗标题","editor":"variable"},{"name":"tips","alias":"弹窗提示语","editor":"variable"},{"name":"width","alias":"弹窗宽度","default":"60%"},{"name":"height","alias":"弹窗高度","default":"60%"},{"name":"readonly","type":"Boolean","alias":"是否只读","default":false},{"name":"variableName","alias":"接收返回值的变量名","type":"String","editor":"variable","editorParams":{"type":"variable","useOnlyName":true}},{"name":"okEvent","alias":"确认事件","isCallback":true,"args":[{"name":"code","alias":"code"}]},{"name":"beforeClose","alias":"关闭前事件","isCallback":true,"args":[{"name":"code","alias":"code"},{"name":"done","alias":"done"}]},{"name":"closeEvent","alias":"关闭后事件","isCallback":true}]}]},{"name":"$closeDialog","alias":"关闭本页所在的弹出窗口","type":"Complex","readonly":true,"attributes":[{"name":"functionName","alias":"方法名称","type":"String","default":"$closeDialog"},{"name":"description","alias":"方法描述","type":"String","default":"关闭本页所在的弹出窗口"},{"name":"payload","alias":"参数","type":"Complex[2]","inputVisible":false,"attributes":"smartAttrs.payload","default":[{"name":"delayTime","alias":"延迟关闭时间单位(ms)","type":"Number","default":0},{"name":"type","alias":"类型","type":"Enum(\\"self:仅关闭当前窗口\\", \\"parent:同时关闭来源页面窗口\\", \\"all:关闭所有窗口\\")","default":"self"}]}]},{"name":"$setZoom","alias":"浏览器缩放","type":"Complex","readonly":true,"attributes":[{"name":"functionName","alias":"方法名称","type":"String","default":"$setZoom"},{"name":"description","alias":"方法描述","type":"String","default":"浏览器缩放"},{"name":"payload","alias":"参数","type":"Complex[1]","inputVisible":false,"attributes":"smartAttrs.payload","default":[{"name":"zoom","alias":"倍率(百分比)","editor":"variable","default":"100"}]}]},{"name":"$getZoom","alias":"获取浏览器缩放倍率","type":"Complex","readonly":true,"returnValue":true,"attributes":[{"name":"functionName","alias":"方法名称","type":"String","default":"$getZoom"},{"name":"description","alias":"方法描述","type":"String","default":"获取浏览器缩放倍率"},{"name":"output","alias":"返回值","type":"Number","description":"浏览器缩放倍率值"}]},{"name":"$openDrawer","alias":"打开抽屉","type":"Complex","readonly":true,"attributes":[{"name":"functionName","alias":"方法名称","type":"String","default":"$openDrawer"},{"name":"description","alias":"方法描述","type":"String","default":"打开抽屉"},{"name":"payload","alias":"参数","type":"Complex[9]","inputVisible":false,"attributes":"smartAttrs.payload","default":[{"name":"title","alias":"抽屉标题","editor":"variable"},{"name":"url","alias":"页面","editor":"page"},{"name":"direction","alias":"弹出方向","type":"Enum(\\"ltr:从左往右\\",\\"rtl:从右往左\\",\\"ttb:从上往下\\",\\"btt:从下往上\\")","default":"rtl"},{"name":"size","alias":"尺寸","default":"30%"},{"name":"modal","alias":"是否需要遮罩层","type":"Boolean","default":true},{"name":"wrapperClosable","alias":"点击遮罩层关闭","type":"Boolean","default":false},{"name":"showClose","alias":"关闭按钮显示","type":"Boolean","default":true},{"name":"pageVariables","alias":"页面接收的变量","editor":"variable"},{"name":"includedSelf","alias":"变量值是否包含本身","type":"Boolean","default":false},{"name":"beforeClose","alias":"关闭前事件","isCallback":true,"args":[{"name":"done","alias":"done"}]},{"name":"closeEvent","alias":"关闭后事件","isCallback":true}]}]},{"name":"$closeDrawer","alias":"关闭本页所在的抽屉","type":"Complex","readonly":true,"attributes":[{"name":"functionName","alias":"方法名称","type":"String","default":"$closeDrawer"},{"name":"description","alias":"方法描述","type":"String","default":"关闭本页所在的抽屉"},{"name":"payload","alias":"参数","type":"Complex[2]","inputVisible":false,"attributes":"smartAttrs.payload","default":[{"name":"delayTime","alias":"延迟关闭时间单位(ms)","type":"Number","default":0},{"name":"type","alias":"类型","type":"Enum(\\"self:仅关闭当前窗口\\", \\"parent:同时关闭来源页面窗口\\", \\"all:关闭所有窗口\\")","default":"self"}]}]},{"name":"$openUrl","alias":"打开页面","type":"Complex","readonly":true,"attributes":[{"name":"functionName","alias":"方法名称","type":"String","default":"$openUrl"},{"name":"description","alias":"方法描述","type":"String","default":"打开页面"},{"name":"payload","alias":"参数","type":"Complex[2]","inputVisible":false,"attributes":"smartAttrs.payload","default":[{"name":"title","alias":"标题","editor":"variable"},{"name":"url","alias":"页面","editor":"page"},{"name":"type","alias":"打开类型","type":"Enum(\\"_blank:新窗口\\", \\"_self:当前窗口\\", \\"_top:顶级窗口\\", \\"_mobile:移动端窗口\\")","default":"_blank"},{"name":"layout","alias":"布局方式(站内页面有效)","type":"Enum(\\"\'\':默认\\", \\"vertical:垂直\\", \\"horizontal:水平\\", \\"fullscreen:全屏\\")","default":""},{"name":"pageVariables","alias":"页面接收的变量","editor":"variable"},{"name":"includedSelf","alias":"变量值是否包含本身","type":"Boolean","default":false},{"name":"idKey","alias":"标识名称"}]}]},{"name":"$message","alias":"消息提示","type":"Complex","readonly":true,"attributes":[{"name":"functionName","alias":"方法名称","type":"String","default":"$message"},{"name":"description","alias":"方法描述","type":"String","default":"消息提示"},{"name":"payload","alias":"参数","type":"Complex[2]","inputVisible":false,"attributes":"smartAttrs.payload","default":[{"name":"message","alias":"信息内容","editor":"variable"},{"name":"type","alias":"类型","type":"Enum(\\"normal:默认\\", \\"success:成功\\", \\"warning:警告\\", \\"error:错误\\")","default":"normal"}]}]},{"name":"$notify","alias":"通知","type":"Complex","readonly":true,"attributes":[{"name":"functionName","alias":"方法名称","type":"String","default":"$notify"},{"name":"description","alias":"方法描述","type":"String","default":"通知"},{"name":"payload","alias":"参数","type":"Complex[2]","inputVisible":false,"attributes":"smartAttrs.payload","default":[{"name":"title","alias":"标题","editor":"variable"},{"name":"message","alias":"信息内容","editor":"variable"},{"name":"type","alias":"类型","type":"Enum(\\"info:信息\\", \\"success:成功\\", \\"warning:警告\\", \\"error:错误\\")","default":"info","clearable":true},{"name":"iconClass","alias":"图标","editor":"icon","editorParams":{"group":["基础图标"]}},{"name":"position","alias":"弹出位置","type":"Enum(\\"top-right:上右\\", \\"top-left:上左\\", \\"bottom-right:下右\\", \\"bottom-left:下左\\")","default":"top-right"},{"name":"showClose","alias":"是否显示关闭按钮","type":"Boolean","default":true},{"name":"duration","alias":"显示的时长","type":"Number","default":4500,"min":0}]}]},{"name":"$confirmDialog","alias":"确认对话框","type":"Complex","readonly":true,"attributes":[{"name":"functionName","alias":"方法名称","type":"String","default":"$confirmDialog"},{"name":"description","alias":"方法描述","type":"String","default":"确认对话框"},{"name":"payload","alias":"参数","type":"Complex[6]","inputVisible":false,"attributes":"smartAttrs.payload","default":[{"name":"message","alias":"消息内容","editor":"variable"},{"name":"title","alias":"标题","editor":"variable"},{"name":"type","alias":"类型","type":"Enum(\\"none:无\\", \\"success:成功\\", \\"info:信息\\", \\"warning:警告\\", \\"error:错误\\")","default":"none"},{"name":"confirmButtonText","alias":"确定按钮文字","default":"确定"},{"name":"cancelButtonText","alias":"取消按钮文字","default":"取消"},{"name":"confirmContent","alias":"确认按钮事件","isCallback":true},{"name":"cancelContent","alias":"取消按钮事件","isCallback":true}]}]},{"name":"$validate","alias":"表单校验","type":"Complex","returnValue":true,"readonly":true,"attributes":[{"name":"functionName","alias":"方法名称","type":"String","default":"$validate"},{"name":"description","alias":"方法描述","type":"String","default":"页面内所有表单校验"},{"name":"output","alias":"返回值","type":"Boolean","description":"校验是否通过"}]},{"name":"$clearValidate","alias":"清除表单校验信息","type":"Complex","readonly":true,"attributes":[{"name":"functionName","alias":"方法名称","type":"String","default":"$clearValidate"},{"name":"description","alias":"方法描述","type":"String","default":"页面内所有表单清除校验信息"}]},{"name":"$refresh","alias":"页面刷新","type":"Complex","readonly":true,"attributes":[{"name":"functionName","alias":"方法名称","type":"String","default":"$refresh"},{"name":"description","alias":"方法描述","type":"String","default":"页面内所有组件数据刷新"}]},{"name":"$isLoading","alias":"页面是否正在加载","type":"Complex","returnValue":true,"readonly":true,"attributes":[{"name":"functionName","alias":"方法名称","type":"String","default":"$isLoading"},{"name":"description","alias":"方法描述","type":"String","default":"页面是否正在加载"},{"name":"output","alias":"返回值","type":"Boolean","description":"页面是否正在加载"}]},{"name":"$showLoading","alias":"显示页面加载","type":"Complex","readonly":true,"attributes":[{"name":"functionName","alias":"方法名称","type":"String","default":"$showLoading"},{"name":"description","alias":"方法描述","type":"String","default":"显示页面加载"},{"name":"payload","alias":"参数","type":"Complex[2]","inputVisible":false,"attributes":"smartAttrs.payload","default":[{"name":"loadingText","alias":"加载显示文案","editor":"variable","default":"加载中，请稍后..."}]}]},{"name":"$hideLoading","alias":"关闭页面加载","type":"Complex","readonly":true,"attributes":[{"name":"functionName","alias":"方法名称","type":"String","default":"$hideLoading"},{"name":"description","alias":"方法描述","type":"String","default":"关闭页面加载"}]},{"name":"$setFromPageVariable","alias":"设置源页面变量","type":"Complex","readonly":true,"attributes":[{"name":"functionName","alias":"方法名称","type":"String","default":"$setFromPageVariable"},{"name":"description","alias":"方法描述","type":"String","default":"设置源页面变量"},{"name":"payload","alias":"参数","type":"Complex[2]","inputVisible":false,"attributes":"smartAttrs.payload","default":[{"name":"name","alias":"变量名","editor":"variable","editorParams":{"type":"variable","useOnlyName":true}},{"name":"value","alias":"变量值","editor":"variable"}]}]},{"name":"$invokeFromPageMethod","alias":"调用源页面方法","type":"Complex","readonly":true,"attributes":[{"name":"functionName","alias":"方法名称","type":"String","default":"$invokeFromPageMethod"},{"name":"description","alias":"方法描述","type":"String","default":"调用源页面方法"},{"name":"payload","alias":"参数","type":"Complex[3]","inputVisible":false,"attributes":"smartAttrs.payload","default":[{"name":"componentName","alias":"组件名称"},{"name":"method","alias":"方法名称"},{"name":"params","alias":"参数","type":"String","editor":"variable"}]}]},{"name":"$downloadExcel","alias":"下载表格","type":"Complex","readonly":true,"attributes":[{"name":"functionName","alias":"方法名称","type":"String","default":"$downloadExcel"},{"name":"description","alias":"方法描述","type":"String","default":"调用源页面方法"},{"name":"payload","alias":"参数","type":"Complex[3]","inputVisible":false,"attributes":"smartAttrs.payload","default":[{"name":"url","alias":"url","editor":"variable"},{"name":"name","alias":"文件名称","editor":"variable"},{"name":"params","alias":"请求参数","editor":"script"}]}]},{"name":"$download","alias":"下载导出","type":"Complex","readonly":true,"attributes":[{"name":"functionName","alias":"方法名称","type":"String","default":"$download"},{"name":"description","alias":"方法描述","type":"String","default":"调用源页面方法"},{"name":"payload","alias":"参数","tips":"选择","type":"Complex[*]","inputVisible":false,"attributes":"smartAttrs.payload","default":[{"name":"type","alias":"请求类型","tips":"该值为post且请求地址有值时 fileUrl 和 fileTokenId 无效","default":"post","type":"Enum(\\"post:post\\", \\"get:get\\")"},{"name":"postUrl","alias":"请求地址","tips":"请求类型为post且该属性有值时 fileUrl 和 fileTokenId 无效","editor":"variable"},{"name":"contentType","alias":"请求内容类型","default":"application/json","type":"Enum(\\"application/json:application/json\\", \\"application/octet-stream:application/octet-stream\\", \\"application/x-www-form-urlencoded:application/x-www-form-urlencoded\\", \\"multipart/form-data:multipart/form-data\\", \\"text/xml:text/xml\\")"},{"name":"postParams","alias":"请求参数","tips":"设置请求体参数Body","editor":"script"},{"name":"fileType","alias":"文件类型","placeholder":"请选择","type":"Enum(\\"xls:xls\\", \\"xlsx:xlsx\\", \\"json:json\\", \\"zip:zip\\", \\"7z:7z\\", \\"rar:rar\\", \\"pdf:pdf\\", \\"ppt:ppt\\", \\"pptx:pptx\\", \\"jar:jar\\", \\"docx:docx\\", \\"doc:doc\\")"},{"name":"fileName","alias":"文件名称","editor":"variable"},{"name":"fileUrl","alias":"文件地址","tips":"文件服务资源地址，请求类型为非post或请求地址为空时应用该属性，否则无效","default":"无","editor":"variable"},{"name":"fileTokenId","alias":"文件TokenId","tips":"文件服务资源Token，请求类型为非post或请求地址为空时应用该属性，否则无效","default":"无","editor":"variable"}]}]},{"name":"$downloadReport","alias":"下载报表","type":"Complex","readonly":true,"attributes":[{"name":"functionName","alias":"方法名称","type":"String","readonly":true,"default":"$downloadReport"},{"name":"description","alias":"方法描述","type":"String","readonly":true,"default":"此方法用于下载报表"},{"name":"payload","alias":"参数","type":"Complex[1]","inputVisible":false,"attributes":"smartAttrs.payload","default":[{"name":"reportData","alias":"关联报表","type":"String","editor":"report"},{"name":"reportParams","alias":"报表参数","editor":"script"},{"name":"type","alias":"类型","type":"Enum(\\"Excel:Excel\\", \\"PDF:PDF\\", \\"PDF图像:PDF图像\\", \\"图片:图片\\")","default":"Excel"}]}]},{"name":"$refreshAsyncVariables","alias":"刷新异步自定义变量","type":"Complex","readonly":true,"attributes":[{"name":"functionName","alias":"方法名称","type":"String","default":"$refreshAsyncVariables"},{"name":"description","alias":"方法描述","type":"String","default":"调用源页面方法"},{"name":"payload","alias":"参数","type":"Complex[1]","inputVisible":false,"attributes":"smartAttrs.payload","default":[{"name":"keys","alias":"自定义变量名","editor":"variable","editorParams":{"type":"variable","useOnlyName":false}}]}]},{"name":"$clearTimer","alias":"清除定时器","type":"Complex","readonly":true,"attributes":[{"name":"functionName","alias":"方法名称","type":"String","default":"$clearTimer"},{"name":"description","alias":"方法描述","type":"String","default":"调用源页面方法"},{"name":"payload","alias":"参数","type":"Complex[1]","inputVisible":false,"attributes":"smartAttrs.payload","default":[{"name":"names","alias":"定时器名称"}]}]},{"name":"$invokeMethodByPageId","alias":"调用指定页面方法","type":"Complex","readonly":true,"attributes":[{"name":"functionName","alias":"方法名称","type":"String","default":"$invokeMethodByPageId"},{"name":"description","alias":"方法描述","type":"String","default":"调用指定页面方法"},{"name":"payload","alias":"参数","type":"Complex[4]","inputVisible":false,"attributes":"smartAttrs.payload","default":[{"name":"pageId","alias":"页面ID","editor":"page"},{"name":"pageIndex","alias":"页面索引","type":"Number","default":0},{"name":"componentName","alias":"组件名称"},{"name":"method","alias":"方法名称"},{"name":"params","alias":"参数","type":"String","editor":"variable"}]}]},{"name":"$checkPermission","alias":"检查是否有权限","type":"Complex","readonly":true,"returnValue":true,"attributes":[{"name":"functionName","alias":"方法名称","type":"String","default":"$checkPermission"},{"name":"description","alias":"方法描述","type":"String","default":"根据权限标识检查是否有权限"},{"name":"payload","alias":"参数","type":"Complex[4]","inputVisible":false,"attributes":"smartAttrs.payload","default":[{"name":"identifier","alias":"权限标识","editor":"variable"}]},{"name":"output","alias":"返回值","type":"Boolean","description":"是否有权限"}]},{"name":"$getUserStore","alias":"获取存储数据","type":"Complex","readonly":true,"returnValue":true,"attributes":[{"name":"functionName","alias":"方法名称","type":"String","default":"$getUserStore"},{"name":"description","alias":"方法描述","type":"String","default":"根据关键字获取存储数据"},{"name":"payload","alias":"参数","type":"Complex[4]","inputVisible":false,"attributes":"smartAttrs.payload","default":[{"name":"name","alias":"存储关键字","editor":"variable"}]},{"name":"output","alias":"返回值","type":"Any","description":"存储数据"}]},{"name":"$setUserStore","alias":"存储数据","type":"Complex","readonly":true,"attributes":[{"name":"functionName","alias":"方法名称","type":"String","default":"$setUserStore"},{"name":"description","alias":"方法描述","type":"String","default":"根据关键字存储数据"},{"name":"payload","alias":"参数","type":"Complex[4]","inputVisible":false,"attributes":"smartAttrs.payload","default":[{"name":"name","alias":"存储关键字","editor":"variable"},{"name":"content","alias":"存储内容","editor":"variable"}]}]},{"name":"$loadTempIframePage","alias":"加载临时Iframe页面数据","type":"Complex","readonly":true,"attributes":[{"name":"functionName","alias":"方法名称","type":"String","default":"$loadTempIframePage"},{"name":"description","alias":"方法描述","type":"String","default":"打开弹出窗口"},{"name":"payload","alias":"参数","type":"Complex[2]","inputVisible":false,"attributes":"smartAttrs.payload","default":[{"name":"iframeName","alias":"Iframe组件名称","editor":"variable"},{"name":"callback","alias":"回调函数","isCallback":true,"args":[{"name":"pageId","alias":"pageId"}]}]}]},{"name":"$destroyTempIframePage","alias":"卸载临时Iframe页面数据","type":"Complex","readonly":true,"attributes":[{"name":"functionName","alias":"方法名称","type":"String","default":"$destroyTempIframePage"},{"name":"description","alias":"方法描述","type":"String","default":"打开弹出窗口"},{"name":"payload","alias":"参数","type":"Complex[1]","inputVisible":false,"attributes":"smartAttrs.payload","default":[{"name":"iframeName","alias":"Iframe组件名称","editor":"variable"}]}]},{"name":"$conditionalBranch","alias":"条件判断","type":"Complex","readonly":true,"attributes":[{"name":"functionName","alias":"方法名称","type":"String","default":"$conditionalBranch"},{"name":"description","alias":"方法描述","type":"String","default":"根据条件判断执行"},{"name":"conditionalBranch","alias":"条件分支","type":"Complex[*]","inputVisible":false}]},{"name":"$assets","alias":"资产","type":"Complex","readonly":true,"visible":false,"attributes":[{"name":"functionName","alias":"方法名称","type":"String","default":"$assets"},{"name":"description","alias":"方法描述","type":"String","default":"根据条件判断执行"},{"name":"assets","alias":"资产","type":"Complex[*]","inputVisible":false}]},{"name":"$addModelInstances","alias":"增加实例","type":"Complex","readonly":true,"attributes":[{"name":"functionName","alias":"方法名称","type":"String","default":"$addModelInstances"},{"name":"description","alias":"方法描述","type":"String","default":"添加一条或者多条实例信息"},{"name":"payload","alias":"参数","type":"Complex[4]","inputVisible":false,"attributes":"smartAttrs.payload","default":[{"name":"relation","alias":"关联对象类型","type":"Boolean","default":false},{"name":"profileIdentifier","visible":{"relation":false},"alias":"对象类型标识","type":"cascader","editor":"variable","options":"objectType","selectProps":{"label":"localName","value":"identifier"},"tips":"必填项"},{"name":"instances","visible":{"relation":false},"alias":"需要添加的实例","editor":"variable","type":"Array","tips":["必填项","支持单个添加和批量添加","单个添加：参数类型为string和object，string会把参数值赋值给实例名称","批量添加：参数类型为Array, 数组值为对象实例的 Map","手动输入限制为数组"]},{"name":"transactionType","visible":{"relation":false},"alias":"事务方式","type":"Boolean","tips":"当以非事务的方式执行批量插入时系统会跳过异常的实例数据，并在响应的消息体中记录异常的原因","default":true},{"name":"createInstances","visible":{"relation":true},"alias":"实例对象列表","editor":"variable","type":"Array","tips":["必填项","用树形结构表示关联的对象类型实例","eg: [{name: \'会议纪要\', objectType: \'A\', children: [{name: \'代办1\', objectType: \'A-1\'},{name: \'代办2\', objectType: \'A-2\'}]}]","name 和 objectType 必填，每个实例对象的参考 建模管理服务API 4.2.2"]},{"name":"relationKey","visible":{"relation":true},"alias":"关联子属性字段","default":"children","editor":"variable","type":"String","tips":["树形结构数据中表示子集的字段，默认：children","此处配置要与参数createInstances里保持一致"]},{"name":"validDisable","visible":{"relation":true},"alias":"数据校验控制","editor":"variable","type":"Object","tips":["用于自定义属性校验规则抑制控制","暂支持必填校验抑制、具体配置见 建模管理服务API接口（IVA-SDS-107）里的4.2.17"]},{"name":"performence","visible":{"relation":true},"alias":"数据行为控制","editor":"variable","type":"Object","tips":["用于数据处理过程中一些行为控制","具体配置见 建模管理服务API接口（IVA-SDS-107）里的4.2.17"]},{"name":"beforeEvents","alias":"请求前事件","isCallback":true,"args":[{"name":"requestParams","alias":"请求参数, 可以对参数进行修改， 返回false, 取消请求"}]},{"name":"successEvents","alias":"成功响应事件","isCallback":true,"args":[{"name":"respond","alias":"返回参数"}]},{"name":"failEvents","alias":"失败响应事件","isCallback":true,"args":[{"name":"error","alias":"失败响应参数"}]}]}]},{"name":"$delModelInstances","alias":"删除实例","type":"Complex","readonly":true,"attributes":[{"name":"functionName","alias":"方法名称","type":"String","default":"$delModelInstances"},{"name":"description","alias":"方法描述","type":"String","default":"删除一条或者多条实例信息"},{"name":"payload","alias":"参数","type":"Complex[4]","inputVisible":false,"attributes":"smartAttrs.payload","default":[{"name":"profileIdentifier","alias":"对象类型标识","type":"cascader","editor":"variable","options":"objectType","selectProps":{"label":"localName","value":"identifier","tips":"必填项"}},{"name":"data","alias":"删除实例的id","type":"Array","editor":"variable","tips":["必填项","支持单个删除和批量删除","单个删除：参数格式为id、 {id: id}、[id]，id为实例id","批量删除：参数格式为[id, id] 或者 \'id,id\'，id为实例id","手动输入限制为数组, 格式[id1, id2]"]},{"name":"cascade","alias":"级联删除","type":"Boolean","editor":"variable","default":false,"tips":["是否允许级联删除子实例和关联实例","true允许级联删除，默认false"]},{"name":"beforeEvents","alias":"请求前事件","isCallback":true,"args":[{"name":"requestParams","alias":"请求参数, 可以对参数进行修改， 返回false, 取消请求"}]},{"name":"successEvents","alias":"成功响应事件","isCallback":true,"args":[{"name":"respond","alias":"返回参数"}]},{"name":"failEvents","alias":"失败响应事件","isCallback":true,"args":[{"name":"error","alias":"失败响应参数"}]}]}]},{"name":"$editModelInstances","alias":"修改实例","type":"Complex","readonly":true,"attributes":[{"name":"functionName","alias":"方法名称","type":"String","default":"$editModelInstances"},{"name":"description","alias":"方法描述","type":"String","default":"修改实例信息"},{"name":"payload","alias":"参数","type":"Complex[4]","inputVisible":false,"attributes":"smartAttrs.payload","default":[{"name":"modelInstance","alias":"实例对象","type":"Object","tips":"对象实例的 Map，如果以下参数有值，会覆盖该参数相同的属性值","editor":"variable"},{"name":"id","alias":"实例id","editor":"variable","tips":["必填项","对象实例 ID"]},{"name":"name","alias":"实例名称","editor":"variable","tips":["实例名称，最大长度64"]},{"name":"localName","alias":"本地名称","editor":"variable","tips":"实例本地名称，最大长度32"},{"name":"aliasName","alias":"实例别名","editor":"variable","tips":"实例别名，最大长度128"},{"name":"description","alias":"描述信息","editor":"variable","tips":"描述信息，最大长度255"},{"name":"parentId","alias":"父对象ID","editor":"variable","tips":"父对象ID，最大长度36"},{"name":"status","alias":"状态","editor":"variable","tips":"状态，最大长度16"},{"name":"seq","alias":"序列号","type":"Number","editor":"variable","tips":"序列号，范围0-2147483647","min":0,"max":2147483647},{"name":"ownOrg","alias":"所有组织","editor":"variable","tips":"所有组织，最大长度36"},{"name":"accessor","alias":"访问组织","editor":"variable","tips":"访问组织，最大长度36"},{"name":"readAllow","alias":"读权限","editor":"variable","tips":"读权限，最大长度128"},{"name":"writeAllow","alias":"写权限","editor":"variable","tips":"写权限，最大长度128"},{"name":"objectType","alias":"对象类型标识","type":"cascader","tips":"如果对象类型定义为分表存储时必填，此处类型为寻找分表不参与数据过滤","editor":"variable","options":"objectType","selectProps":{"label":"localName","value":"identifier"}},{"name":"beforeEvents","alias":"请求前事件","isCallback":true,"args":[{"name":"requestParams","alias":"请求参数, 可以对参数进行修改， 返回false, 取消请求"}]},{"name":"successEvents","alias":"成功响应事件","isCallback":true,"args":[{"name":"respond","alias":"返回参数"}]},{"name":"failEvents","alias":"失败响应事件","isCallback":true,"args":[{"name":"error","alias":"失败响应参数"}]}]}]},{"name":"$testDataType","alias":"测试数据类型,测试完成后删除该方法","type":"Complex","readonly":true,"attributes":[{"name":"functionName","alias":"方法名称","type":"String","default":"$testDataType"},{"name":"description","alias":"方法描述","type":"String","default":"测试数据类型"},{"name":"payload","alias":"参数","type":"Complex[4]","inputVisible":false,"attributes":"smartAttrs.payload","default":[{"name":"static","alias":"static","editor":"variable","clearable":false},{"name":"String","alias":"String","editor":"variable","type":"String","clearable":false},{"name":"date-picker","alias":"date-picker","editor":"variable","type":"date-picker"},{"name":"select","alias":"select","editor":"variable","type":"select","options":[{"name":1,"id":2}]},{"name":"cascader","alias":"cascader","editor":"variable","type":"cascader","options":"objectType","selectProps":{"label":"localName","value":"identifier"}},{"name":"switch","alias":"switch","editor":"variable","type":"switch"},{"name":"Boolean","alias":"Boolean","editor":"variable","type":"Boolean"},{"name":"Number","alias":"Number","editor":"variable","type":"Number","min":2,"max":22},{"name":"Array","alias":"Array","editor":"variable","type":"Array"},{"name":"Object","alias":"Object","editor":"variable","type":"Object"}]}]},{"name":"API","alias":"API","type":"Complex","readonly":true,"attributes":[{"name":"functionName","alias":"方法名称","type":"String","default":"api"},{"name":"description","alias":"方法描述","type":"String","default":"API"},{"name":"payload","alias":"参数","type":"Complex[2]","inputVisible":false,"attributes":"smartAttrs.payload","default":[{"name":"componentName","alias":"组件名称"},{"name":"method","alias":"方法名称"}]}]},{"name":"script","alias":"script","type":"Complex","readonly":true,"attributes":[{"name":"functionName","alias":"方法名称","type":"String","default":"script"},{"name":"description","alias":"方法描述","type":"String","default":"脚本"},{"name":"payload","alias":"参数","type":"Complex[2]","inputVisible":false,"attributes":"smartAttrs.payload","default":[{"name":"componentName","alias":"组件名称"},{"name":"method","alias":"方法名称"}]}]}]}]')},"6b34":function(e,t,a){},"6b3b":function(e,t,a){"use strict";a("ec82")},"6b5a":function(e,t,a){},"6d84":function(e,t,a){"use strict";a("0d49")},"6e2f":function(e,t,a){"use strict";a("1516")},"6e9d":function(e,t,a){},"6ea7":function(e,t,a){},"6f0d":function(e,t,a){"use strict";a("351d")},"6f2d":function(e,t,a){"use strict";a("dd81")},"6f46":function(e,t,a){"use strict";a("91e4")},"6fa7":function(e,t,a){"use strict";a("20d6"),a("7514");var i=a("d225"),n=a("b0b4"),r=new(function(){function e(){Object(i.a)(this,e),this.init()}return Object(n.a)(e,[{key:"init",value:function(){this.list=[],this.maxSize=10}},{key:"addValue",value:function(e,t){var a=this;return new Promise((function(i,n){if(a.list.find((function(t){return t.key===e}))){var r=a.list.findIndex((function(t){return t.key===e}));a.list[r].value=t}else a.list.length>=a.maxSize&&a.list.shift(),a.list.push({key:e,value:t});i()}))}},{key:"updateValue",value:function(e,t){var a=this;return new Promise((function(i,n){if(a.list.find((function(t){return t.key===e}))){var r=a.list.findIndex((function(t){return t.key===e}));a.list[r].value=t}else a.list.length>=a.maxSize&&a.list.shift(),a.list.push({key:e,value:t});i()}))}},{key:"getValue",value:function(e){var t=this;return new Promise((function(a,i){var n=t.list.find((function(t){return t.key===e}));a(n?n.value:null)}))}},{key:"deleteValue",value:function(e){var t=this;return new Promise((function(a,i){if(t.list.find((function(t){return t.key===e}))){var n=t.list.findIndex((function(t){return t.key===e}));t.list.splice(n,1)}a()}))}},{key:"deleteAll",value:function(){var e=this;return new Promise((function(t,a){e.list=[],t()}))}}]),e}());window.cacheManager=r,t.a=r},"708f":function(e,t,a){},"713f":function(e,t,a){},"71d3":function(e,t,a){"use strict";a("e1e0")},"73bb":function(e,t,a){"use strict";a("2c9f")},7493:function(e,t,a){"use strict";a("653c")},"749c":function(e,t,a){"use strict";a("62a5")},"77df":function(e,t,a){},"783a":function(e,t,a){"use strict";a("7bf4")},"78bc":function(e,t,a){},"793f":function(e,t,a){},"7af2":function(e,t,a){"use strict";a("7ed5")},"7bb4":function(e,t,a){},"7bec":function(e,t,a){"use strict";a.r(t);var i=(a("8e6e"),a("75fc")),n=(a("4f7f"),a("5df3"),a("1c4c"),a("f559"),a("456d"),a("ac6a"),a("96cf"),a("3b8d")),r=(a("6762"),a("2fdb"),a("7f7f"),a("7514"),a("bd86")),o=(a("c5f6"),a("967e")),l=a.n(o),s=a("36f0"),c=a("ae83"),u=a("b19c"),d=a("88da"),p=a("56b1"),h=a("643b"),f=a("d45e"),m=a("65d4"),v=a("0338"),b=a("8b41"),g=a("2401"),y={name:"TemplateHeader",components:{MoreInfo:a("5b6c").a},props:{activeView:{type:String,default:""},currentNode:{type:Object,default:function(){return{}}},profileProperties:{type:Array,default:function(){return[]}},profileInfo:{type:Object,default:function(){return{}}},deviceName:{type:String,default:""},queryType:{type:String,default:""},actualTimeType:{type:String,default:""},historyType:{type:String,default:""},selectedLength:{type:Number,default:0},types:{type:Object,default:function(){return{}}},editVal:{type:Object,default:function(){return{}}}},data:function(){return{collapse:!0,moreInfoProp:{},actualTimeTypes:[{key:"static",value:"静态"},{key:"dynamic",value:"动态"}]}},computed:{isDevice:function(){return"device"===this.activeView},isUnDevice:function(){return"unDevice"===this.activeView},currentAssetClass:function(){return["template-header-title",{"t-text-placeholder":!this.currentNode.name,"t-text-primary":this.currentNode.name}]},moreInfoClass:function(){return this.collapse?"el-icon-arrow-down":"el-icon-arrow-up"},historyTypes:function(){var e=this;return Object.keys(this.types).filter((function(e){return["collect","calculate","indicator"].includes(e)})).map((function(t){return{key:t,value:e.types[t]}}))}},filters:{templateTitle:function(e){return e||"请选择模板"},deviceStatus:function(e){return e?"在线":"离线"}},methods:{handleMoreInfoClick:function(){this.collapse=!this.collapse},handleViewChange:function(e){this.$emit("view-change",e)},handleTabClick:function(e){this.$emit("tab-click",e)},handleHistoryTypeChange:function(e){this.$emit("history-type-change",e)},handleActualTimeTypeChange:function(e){this.$emit("actualTime-type-change",e)}}},_=(a("b16c"),a("80e7"),a("2877")),C=Object(_.a)(y,(function(){var e=this,t=e._self._c;return t("div",[e.isUnDevice?[t("div",{staticClass:"template-property-header"},[t("div",{staticClass:"header-title"},[t("div",{staticClass:"template-header-wrapper"},[t("span",{class:e.currentAssetClass},[e._v(e._s(e._f("templateTitle")(e.currentNode.name)))]),e._e()],1),e.currentNode.name?t("div",{staticClass:"template-header-description t-text-regular"},[e._v("\n          标识："),t("span",[e._v(e._s(e.currentNode.identifier))])]):e._e()]),!e.deviceName||"history"===e.queryType&&"indicator"===e.historyType?e._e():t("div",{staticClass:"header-device t-border",on:{click:function(t){return e.handleViewChange("device")}}},[t("el-tag",{attrs:{size:"mini","disable-transitions":!0,type:e.currentNode.isOnline?"success":"info"}},[e._v(e._s(e._f("deviceStatus")(e.currentNode.isOnline)))]),t("span",{staticClass:"t-color-primary",staticStyle:{margin:"0 6px 0 4px"}},[e._v(e._s(e.deviceName))]),t("i",{staticClass:"el-icon-arrow-right"}),t("div",{staticClass:"header-device-select t-text-regular"},[e._v("已选择"),t("em",{staticClass:"t-color-primary"},[e._v(e._s(e.selectedLength))]),e._v("条内置测点")])],1)]),e.collapse?e._e():t("div",[t("more-info",{staticClass:"template-more-info",attrs:{list:e.profileProperties,prop:e.moreInfoProp,span:8}})],1),t("el-tabs",{on:{"tab-click":e.handleTabClick},model:{value:e.queryType,callback:function(t){e.queryType=t},expression:"queryType"}},[t("el-tab-pane",{attrs:{label:"实时数据",name:"actualTime"}},[t("el-radio-group",{staticClass:"template-history-type",attrs:{size:"mini"},on:{input:e.handleActualTimeTypeChange},model:{value:e.actualTimeType,callback:function(t){e.actualTimeType=t},expression:"actualTimeType"}},e._l(e.actualTimeTypes,(function(a){return t("el-radio-button",{key:a.key,attrs:{label:a.key}},[e._v(e._s(a.value))])})),1)],1),t("el-tab-pane",{attrs:{label:"历史数据",name:"history"}},[t("el-radio-group",{staticClass:"template-history-type",attrs:{size:"mini"},on:{input:e.handleHistoryTypeChange},model:{value:e.historyType,callback:function(t){e.historyType=t},expression:"historyType"}},e._l(e.historyTypes,(function(a){return t("el-radio-button",{key:a.key,attrs:{label:a.key}},[e._v(e._s(a.value))])})),1)],1)],1)]:e._e(),e.isDevice?[t("div",{staticClass:"template-device-title",on:{click:function(t){return e.handleViewChange("unDevice")}}},[t("el-icon",{staticClass:"el-icon-arrow-left title-icon"}),t("span",{staticClass:"title-name"},[e._v(e._s(e._f("templateTitle")(e.currentNode.name))+" / "+e._s(e.deviceName))]),t("el-tag",{attrs:{size:"mini","disable-transitions":!0,type:e.currentNode.isOnline?"success":"info"}},[e._v(e._s(e._f("deviceStatus")(e.currentNode.isOnline)))])],1)]:e._e()],2)}),[],!1,null,"71532b46",null).exports,O=a("e021"),T={name:"ResponseFields",props:{fields:{type:Array,default:function(){return[]}},description:{type:String,default:""}}},V=(a("6b3b"),Object(_.a)(T,(function(){var e=this,t=e._self._c;return e.fields.length?t("el-form-item",{staticClass:"link-editor-response-fields",attrs:{label:"响应数据提示"}},[t("div",{staticClass:"t-text-secondary"},[e._v(e._s(e.title))]),e._l(e.fields,(function(a){return t("el-tag",{key:a,attrs:{effect:"plain"}},[e._v(e._s(a))])}))],2):e._e()}),[],!1,null,"3b64bca4",null)).exports,w=a("2f62");function P(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function x(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?P(Object(a),!0).forEach((function(t){Object(r.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):P(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var S={name:"TemplatesLinkEditor",alias:"模板",command:"templates-link",mixins:[s.a],components:{ResponseFields:V,TemplateDynamic:O.a,TemplateHeader:C,HistorySetting:b.a,TemplateTable:h.a,TemplateCollapse:p.a,TemplateIndicatorTable:f.a,controlCommonAlert:c.a,EditorCollapse:d.a,ParamSetting:m.a,FilterSetting:v.a},props:{visible:{type:String,default:function(){return!1}},linkType:{type:Number,default:function(){return 1}},handleChangeResult:{type:Function,default:function(){}},data:{type:Object,default:function(){return{alias:"",type:"",default:"",value:""}}}},data:function(){return{showVal:"",showCloseTips:JSON.parse(localStorage.getItem("link-tips-templates")),searchName:"",dialogVisible:this.visible,projectName:"",deviceName:"",activeView:"unDevice",currentNode:{},currentNodeId:"",syncIndicatorLoading:!1,originEditor:{accessType:"templates",linkType:this.linkType,url:"/api/indicator/values/aggregation",method:"post",contentType:"application/json",pagination:0,defaultLoad:!0},propSelected:[],indicatorFields:[],editVal:{},defaultProps:{children:"children",label:"name"},types:{collect:"采集",indicator:"指标",calculate:"计算",manual:"自定义点",measuringPoint:"内置测点"},propertyTypeMap:{1:"collect",2:"calculate",3:"indicator",4:"manual",5:"measuringPoint"},templateList:[],tableData:[],tablePagination:{page:1,pageSize:10},profileInfo:{},profileProperties:[],historyTypeParams:{name:"",identifier:"",propertyType:"",labels:""}}},watch:{"data.value":function(){this.initData()},visible:function(e){this.dialogVisible=e,this.initData()},showCloseTips:function(e){localStorage.setItem("link-tips-templates",e)}},computed:x(x({},Object(w.a)(["getLinkTipsOf"])),{},{templateTipsLoaded:function(){return this.getLinkTipsOf("templates-link")},templateData:function(){var e=this,t=[],a=this.templateList,i=a.find((function(t){return t.id===e.templateId||t.identifier===e.templateIdentifier})),n=function(t){var a;return~(null==t||null===(a=t.name)||void 0===a?void 0:a.toLowerCase().indexOf(e.searchName))};return i?(this.listToTree(a,t,i,n),n(i)?[x(x({},i),{},{children:t})]:t):[]},selectedLength:function(){var e,t,a,i;return null===(e=this.editVal)||void 0===e||null===(t=e.measuringSelected)||void 0===t||null===(a=t[null===(i=this.currentNode)||void 0===i?void 0:i.id])||void 0===a?void 0:a.length},responseFields:function(){return"actualTime"===this.editVal.queryType?["id","name","type","updateTime","value","identifier"]:this.isIndicatorEditor?this.indicatorFields:["id","instanceId","collectTime","collectTimeFormat","dataIdentifier","dataValue","deviceIdentifier","ruleIdentifier","groupIdentifier","archiveDate","archiveDateFormat","quality"]},responseDescription:function(){return this.isIndicatorEditor?"响应数据字段可使用函数过滤，例timeFormat(updateTime::year::1)，字段列表如下：":""},formData:function(){return this.isRTEditor?this.editVal.rtEditor:this.isIndicatorEditor?this.editVal.indicatorEditor:this.editVal},hiddenConfig:function(){return{pagination:!0}},measuringSelected:function(){return this.editVal.measuringSelected||{}},projectId:function(){return Object(u.h)(window.location.href,"projectId")},templateId:function(){return Object(u.h)(window.location.href,"templateId")},templateIdentifier:function(){return Object(u.h)(window.location.href,"templateIdentifier")},modelTemplateTreeIdentifier:function(){return Object(u.h)(window.location.href,"modelTemplateTreeIdentifier")},isDevice:function(){return"device"===this.activeView},isUnDevice:function(){return"unDevice"===this.activeView},isStatic:function(){return"static"===this.editVal.actualTimeType},isDynamic:function(){return"dynamic"===this.editVal.actualTimeType},indicatorList:function(){var e,t,a;return(null===(e=this.editVal)||void 0===e||null===(t=e.indicatorEditor)||void 0===t||null===(a=t.assistAttr)||void 0===a?void 0:a.tableData)||[]},isRTEditor:function(){return"history"===this.editVal.queryType&&["collect","calculate","manual"].includes(this.editVal.historyType)},isIndicatorEditor:function(){return"history"===this.editVal.queryType&&"indicator"===this.editVal.historyType},isActualTimeAndSelectIndicator:function(){return"actualTime"===this.editVal.queryType&&this.propSelected.some((function(e){return 1*e.propertyType==3}))}}),created:function(){this.initData()},methods:{initData:function(){var e=this;return Object(n.a)(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$store.dispatch("initDictOptions");case 2:if(e.$store.dispatch("setLinkEditorTips","templates"),e.resetEditorVal(),e.commonInitData("templates"),!e.dialogVisible){t.next=10;break}return t.next=8,e.getTemplateTree();case 8:return t.next=10,e.formatData();case 10:case"end":return t.stop()}}),t)})))()},formatData:function(){var e=this;return Object(n.a)(l.a.mark((function t(){var a,i,n,r,o,s,c;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null!=(a=e.data.linkConfig)&&a.queryType&&(e.handleTabClick({name:a.queryType},!0),"history"===a.queryType&&null!=a&&a.historyType&&e.handleHistoryTypeChange(a.historyType,!1,!0)),null==a||!a.requestPayload){t.next=14;break}if(i=a.requestPayload,n=i.templateId,r=i.identifier,o=i.properties,!(s=e.templateList.find((function(e){return e.id===n||e.identifier===r})))){t.next=14;break}return t.next=8,e.handleNodeClick(s,!0);case 8:return c=Object(g.a)(o),t.next=11,e.$refs.templateTree.$nextTick();case 11:return e.$refs.templateTree.setCurrentKey(s.id||n),t.next=14,e.initSelected(c);case 14:case"end":return t.stop()}}),t)})))()},initSelected:function(e){var t=this;return Object(n.a)(l.a.mark((function a(){return l.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return t.propSelected=e.filter((function(e){return"measuringPoint"!==e.type})),a.next=3,t.doPropertySelected(t.propSelected);case 3:case"end":return a.stop()}}),a)})))()},doPropertySelected:function(e){var t=this;return Object(n.a)(l.a.mark((function a(){var i;return l.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(!(i=t.$refs.templateTable)){a.next=6;break}return a.next=4,i.$nextTick();case 4:return a.next=6,i.handleSelected(e);case 6:case"end":return a.stop()}}),a)})))()},refreshIndicators:function(){this.syncIndicator(this.propSelected)},syncIndicator:function(e){var t=this;return Object(n.a)(l.a.mark((function a(){var i;return l.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:t.syncIndicatorLoading=!0,t.syncIndicatorLoading=!1,i=e.map((function(e){var a,i;return{id:e.id,name:e.name,rowInfo:e,isDynamic:!(null===(a=(t.editVal.indicatorEditor.assistAttr.tableData||[]).find((function(t){return t.id===e.id})))||void 0===a||!a.isDynamic),selected:(null===(i=(t.editVal.indicatorEditor.assistAttr.tableData||[]).find((function(t){return t.id===e.id})))||void 0===i?void 0:i.selected)||[]}})),t.editVal.indicatorEditor.assistAttr.tableData=i,t.onIndicatorChange(i);case 5:case"end":return a.stop()}}),a)})))()},onIndicatorChange:function(e){var t,a,i,n=e||(null==this||null===(t=this.editVal)||void 0===t||null===(a=t.indicatorEditor)||void 0===a||null===(i=a.assistAttr)||void 0===i?void 0:i.tableData)||[],r=[];n.forEach((function(e){Object.keys((null==e?void 0:e.rowInfo)||{}).forEach((function(e){e.startsWith("expands.")||r.push(e)}))}));var o=r.length?["value"].concat(r):r;this.indicatorFields=Array.from(new Set(o))},onPropSelectedChange:function(e){if(this.isDevice){var t=this.currentNode.id;this.editVal.measuringSelected=x(x({},this.measuringSelected),{},Object(r.a)({},t,e))}else this.propSelected=e,(this.isIndicatorEditor||this.isActualTimeAndSelectIndicator)&&(this.isActualTimeAndSelectIndicator&&(e=e.filter((function(e){return 1*e.propertyType==3}))),this.syncIndicator(e))},handlePropertiesChange:function(e){this.editVal.requestPayload.properties=e},handleViewChange:function(e){var t=this;return Object(n.a)(l.a.mark((function a(){var i;return l.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(t.activeView=e,"device"!==e){a.next=8;break}return a.next=4,t.getTemplateInnerData(t.currentNode);case 4:return a.next=6,t.doPropertySelected(t.measuringSelected[null===(i=t.currentNode)||void 0===i?void 0:i.id]||[]);case 6:a.next=12;break;case 8:return a.next=10,t.getTemplatePropData(t.currentNode);case 10:return a.next=12,t.doPropertySelected(t.propSelected);case 12:case"end":return a.stop()}}),a)})))()},handleHistoryTypeChange:function(e){var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.editVal.historyType=e,t||this.onPropSelectedChange([]),this.getTemplateHistoryData(this.currentNode)},handleActualTimeTypeChange:function(e){this.editVal.actualTimeType=e,"static"===e?this.handlePropertiesChange([{id:"",type:"",name:""}]):this.onPropSelectedChange([]),"dynamic"!==e&&this.getTemplatePropData(this.currentNode)},onPaginationChange:function(e){this.tablePagination.page=e.page,this.tablePagination.pageSize=e.pageSize,this.handleViewChange(this.activeView)},getTemplatePropData:function(e){var t=this;return Object(n.a)(l.a.mark((function a(){var i;return l.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return t.tableData=[],a.next=3,t.fetchProperty(null==e?void 0:e.identifier);case 3:i=a.sent,t.tableData=(null==i?void 0:i.result)||[],(null==i?void 0:i.pageInfo)&&(t.tablePagination=i.pageInfo);case 6:case"end":return a.stop()}}),a)})))()},handleHistoryParamsChange:function(e){this.historyTypeParams=x(x({},this.historyTypeParams),e)},resetHistoryParams:function(){this.historyTypeParams={name:"",identifier:"",propertyType:"",labels:""}},getTemplateHistoryData:function(e){var t=this;return Object(n.a)(l.a.mark((function a(){var i;return l.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return t.handleHistoryParamsChange({propertyType:t.editVal.historyType}),t.tableData=[],a.next=4,t.fetchProperty(e.identifier);case 4:i=a.sent,t.tableData=(null==i?void 0:i.result)||[],(null==i?void 0:i.pageInfo)&&(t.tablePagination=i.pageInfo);case 7:case"end":return a.stop()}}),a)})))()},getTemplateInnerData:function(e){var t=this;return Object(n.a)(l.a.mark((function a(){var i;return l.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(null!=e&&e.regCodeIdentifier){a.next=3;break}return t.tableData=[],a.abrupt("return");case 3:return t.tableData=[],a.next=6,t.fetchProperty(null==e?void 0:e.regCodeIdentifier,{name:"",identifier:"",propertyType:"",labels:""});case 6:i=a.sent,t.tableData=((null==i?void 0:i.result)||[]).map((function(e){return x(x({},e),{},{propertyType:"5"})})),(null==i?void 0:i.pageInfo)&&(t.tablePagination=i.pageInfo);case 9:case"end":return a.stop()}}),a)})))()},ranNum:function(e,t){return Math.floor(Math.random()*(t-e+1)+e)},handleTabClick:function(e){var t=e.name,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.editVal.queryType=t,"history"===t?(this.editVal.actualTimeType="static",this.handleHistoryTypeChange(this.editVal.historyType,!1,a)):(this.resetHistoryParams(),this.onPropSelectedChange([])),this.getTemplatePropData(this.currentNode)},clearProperties:function(){delete this.measuringSelected[this.currentNodeId],this.propSelected=[]},handleNodeClick:function(e,t){var a=this;return Object(n.a)(l.a.mark((function i(){var n;return l.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(!0!==t&&a.currentNodeId!==e.id&&a.clearProperties(),a.currentNodeId=e.id,a.currentNode=e,a.deviceName=e["regCode.name"]||"",!a.isUnDevice){i.next=11;break}return i.next=7,a.getProfileProperties(e);case 7:return i.next=9,a.getTemplatePropData(e);case 9:i.next=15;break;case 11:return i.next=13,a.getTemplateInnerData(a.currentNode);case 13:return i.next=15,a.doPropertySelected(a.measuringSelected[null===(n=a.currentNode)||void 0===n?void 0:n.id]||[]);case 15:case"end":return i.stop()}}),i)})))()},clearValidate:function(e){null!=e&&e.length?this.$refs.form.clearValidate(e):this.$refs.form.clearValidate()},setProfileInfo:function(e,t){this.profileInfo={identifier:e.identifier,company:e.identifier,description:e.description},this.profileProperties=t.map((function(t){return{name:t.propertyLocalName,prop:t.propertyName,value:e[t.propertyName]}}))},getProfileProperties:function(e){var t=this;return Object(n.a)(l.a.mark((function a(){var i,n,r,o;return l.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.fetchProfiles(e.objectType);case 2:if(i=a.sent,1!==(null==(n=null==i?void 0:i.result)?void 0:n.length)){a.next=10;break}return r=n[0],a.next=8,t.fetchProfileProperties(null==r?void 0:r.id);case 8:o=a.sent,t.setProfileInfo(e,o);case 10:case"end":return a.stop()}}),a)})))()},getTemplateTree:function(){var e=this;return Object(n.a)(l.a.mark((function t(){var a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.fetchTemplateTree();case 2:(a=t.sent).length&&(e.templateList=a);case 4:case"end":return t.stop()}}),t)})))()},listToTree:function(e,t,a,i){var n=this;e.forEach((function(r){if(r.parentIdentifier===a.identifier){var o=x(x({},r),{},{children:[]});n.listToTree(e,o.children,r),o.children.length<=0&&delete o.children,"function"==typeof i?i(o)&&t.push(o):t.push(o)}}))},fetchIndicators:function(e){var t=this;return Object(n.a)(l.a.mark((function a(){var i;return l.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(i=[],null==e||!e.length){a.next=4;break}return a.next=4,t.$util.request({url:"/api/model/instances",method:"get",params:{objectType:"MEAS_INDICATOR",queryMode:"simple",pagination:0,$orderBy:"createTime desc",$filter:"id eq ".concat(e.join("::"))}}).then((function(e){i=e})).catch((function(e){}));case 4:return a.abrupt("return",i);case 5:case"end":return a.stop()}}),a)})))()},fetchTemplateTree:function(){var e=this;return Object(n.a)(l.a.mark((function t(){var a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a={},t.next=3,e.$util.request({url:"/api/thing-model/model-template?pagination=0&$filter=modelTemplateTreeIdentifier eq ".concat(e.modelTemplateTreeIdentifier,"&$orderBy=createTime desc"),method:"get"}).then((function(e){a=e})).catch((function(e){}));case 3:return t.abrupt("return",a);case 4:case"end":return t.stop()}}),t)})))()},fetchResourceInfo:function(e){var t=this;return Object(n.a)(l.a.mark((function a(){var i;return l.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(i={},!e){a.next=4;break}return a.next=4,t.$util.request({url:"/api/resource-tree/projects/".concat(e),method:"get"}).then((function(e){i=e})).catch((function(e){}));case 4:return a.abrupt("return",i);case 5:case"end":return a.stop()}}),a)})))()},fetchTemplate:function(e){var t=this;return Object(n.a)(l.a.mark((function a(){var i;return l.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(i=[],!e){a.next=4;break}return a.next=4,t.$util.request({url:"/api/model/instances",method:"get",params:{objectType:e,pagination:0,$orderBy:"updateTime desc",accessMethod:"foreign_key",relationProperties:"name"}}).then((function(e){i=e})).catch((function(e){}));case 4:return a.abrupt("return",i);case 5:case"end":return a.stop()}}),a)})))()},fetchProfiles:function(e){var t=this;return Object(n.a)(l.a.mark((function a(){var i;return l.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(i=[],!e){a.next=4;break}return a.next=4,t.$util.request({url:"/api/model/profiles",method:"get",params:{$filter:"identifier eq ".concat(e)}}).then((function(e){i=e})).catch((function(e){}));case 4:return a.abrupt("return",i);case 5:case"end":return a.stop()}}),a)})))()},fetchProfileProperties:function(e){var t=this;return Object(n.a)(l.a.mark((function a(){var i;return l.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(i=[],!e){a.next=4;break}return a.next=4,t.$util.request({url:"/api/model/profiles/".concat(e,"/properties"),method:"get",params:{$filter:"status eq 1",pagination:0,inherit:"custom",$orderBy:"createTime desc"}}).then((function(e){i=e})).catch((function(e){}));case 4:return a.abrupt("return",i);case 5:case"end":return a.stop()}}),a)})))()},fetchProperty:function(e,t){var a=this;return Object(n.a)(l.a.mark((function i(){var n,r,o,s,c,u,d,p,h,f,m,v,b;return l.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(n={},!e){i.next=7;break}return o=t||a.historyTypeParams,s=o.name,c=void 0===s?"":s,u=o.identifier,d=void 0===u?"":u,p=o.propertyType,h=void 0===p?"":p,f=o.labels,m=void 0===f?"":f,v=Object(g.c)(a.propertyTypeMap),b=null!==(r=v[h])&&void 0!==r?r:"",i.next=7,a.$util.request({url:"/api/thing-model/model-template/".concat(e,"/property"),method:"get",params:{$page:a.tablePagination.page,$pageSize:a.tablePagination.pageSize,$filter:"name eq ".concat(c,",identifierAlias eq ").concat(d,",propertyType eq ").concat(b,",labels em ").concat(m,",configFlag eq 1")}}).then((function(e){n=e})).catch((function(e){}));case 7:return i.abrupt("return",n);case 8:case"end":return i.stop()}}),i)})))()},handleTemplateClick:function(){this.$setAttr(this.data,"editorDialogVisible",!0),this.dialogVisible=!0},onClose:function(){var e,t;this.closeHandler("templates"),null===(e=this.$refs)||void 0===e||null===(t=e.templateTable)||void 0===t||t.clearSelection()},handleClear:function(){this.clearByType("templates")},resetEditorVal:function(){this.editVal={accessType:"templates",linkType:this.linkType,url:"/api/indicator/values/aggregation",method:"post",contentType:"application/json",pagination:0,defaultLoad:!0,fields:"",historyType:"collect",queryType:"actualTime",actualTimeType:"static",measuringSelected:{},requestPayload:{templateId:"",deviceId:"",properties:[{id:"",type:"",name:""}]},rtEditor:{accessType:"rtdata",linkType:this.linkType,url:"/api/realtimedata/records",method:"get",contentType:"application/json",objectType:"",rtDataType:2,requestPayload:{instanceId:"",queryDirection:1,querySize:1e3,$orderBy:"collectTime asc",collectTime:"",queryMode:1,$filter:"",objectType:"",queryType:1,beginTime:"",endTime:"",recordType:1},variableEditData:{instanceIdData:{name:"instanceId",value:"",editValue:null},collectTimeData:{name:"collectTime",value:"",editValue:null},beginTimeData:{name:"beginTime",value:"",editValue:null},endTimeData:{name:"endTime",value:"",editValue:null}},responseSchema:{},exceptionStrategy:"throw",showIdTable:!0,filterItems:[{name:"",value:"",filter:"",editValue:""}],tableData:[]},indicatorEditor:{accessType:"indicator",linkType:this.linkType,url:"/api/indicator/values/aggregation",method:"post",contentType:"application/json",fields:"",dataType:"",requestPayload:{indicatorIds:"",queryLatest:1,timeRangeType:"fixed",queryType:"",updateTimeBegin:"",updateTimeEnd:"",relativeTime:"",dimensionTime:"",aggOperation:"",sortOperation:"",cmpOperation:"",precision:"",filters:"",valueFilter:""},variableEditData:{indicatorIdsData:{name:"indicatorIds",value:"",editValue:null},updateTimeBeginData:{name:"updateTimeBegin",value:"",editValue:null},updateTimeEndData:{name:"updateTimeEnd",value:"",editValue:null},dimensionTimeData:{name:"dimensionTime",value:"",editValue:null},compareTimeData:{name:" compareTime",value:"",editValue:null},parentIdData:{name:" parentId",value:"",editValue:null},timeDimensionData:{name:" timeDimension",value:"",editValue:null},projectData:{name:"project",value:"",editValue:null},valueData:{name:"value",value:"",editValue:null}},assistAttr:{relativeType:"current",relativeNumber:1,timeDimension:"",orderNumber:1,orderType:"asc",compareType:"M2M",compareNumber:1,isNow:!1,compareTime:"",tableData:[{id:this.$util.uuid(),rowInfo:{},isDynamic:!1,selected:[]}],extraFilter:"",timeDimensionFilter:"",parentIdFilter:"",projectFilter:"",dimensionTimeFilter:"",valueFilterOperator:"",valueFilter:""},responseSchema:{},exceptionStrategy:"throw"},variableEditData:{properties:{name:"properties",value:"",editValue:null}}}},resetData:function(){this.showVal="",this.resetEditorVal(),this.commonResetData()},validate:function(){return!0},getHandlerEditVal:function(){var e,t,a,n,r,o=Object(u.e)(this.editVal),l=this.propSelected;this.isActualTimeAndSelectIndicator&&this.syncTableToProps();var s=null==o?void 0:o.measuringSelected[this.currentNode.id];null!=s&&s.length&&(l=[].concat(Object(i.a)(l),Object(i.a)(s.map((function(e){return x(x({},e),{},{propertyType:"5"})})))));var c=g.b.call(this,l),d="dynamic"===o.actualTimeType;return o.requestPayload={templateId:this.currentNode.id,identifier:this.currentNode.identifier,deviceId:this.currentNode.edgeCode,properties:d?null==o||null===(e=o.variableEditData)||void 0===e||null===(t=e.properties)||void 0===t?void 0:t.value:c},null!==(a=this.editVal)&&void 0!==a&&null!==(n=a.indicatorEditor)&&void 0!==n&&null!==(r=n.requestPayload)&&void 0!==r&&r.filters&&(o.requestPayload.filters=this.editVal.indicatorEditor.requestPayload.filters),o},syncTableToProps:function(){var e=this.indicatorList||[],t=[],a=[],i={};for(var n in e.forEach((function(e){e.isDynamic?((null==e?void 0:e.selected)||[]).forEach((function(t){i[t]?i[t].push(e.rowInfo[t]):i[t]=[e.rowInfo[t]]})):t.push(e.rowInfo.identifier)})),i){var r=i[n].join("::");r&&a.push("".concat(n," eq ").concat(r))}var o=t.join(","),l=a.length?"$filter="+a.join(","):"";this.editVal.indicatorEditor.requestPayload.indicatorIds=o,this.editVal.indicatorEditor.requestPayload.filters=l},refreshEditValPayload:function(){var e,t;"current"===this.editVal.indicatorEditor.assistAttr.relativeType&&(this.editVal.indicatorEditor.assistAttr.relativeNumber=1);var a=this.editVal.indicatorEditor.assistAttr,i=a.relativeType,n=a.relativeNumber,r=a.timeDimension,o=a.orderNumber,l=a.orderType,s=a.compareType,c=a.compareNumber,u=a.isNow,d=a.compareTime,p=a.dimensionTimeFilter,h=i?"".concat(i,":").concat(n,":").concat(r):"";this.editVal.indicatorEditor.requestPayload.relativeTime=h;var f=o?"".concat(o,":").concat(l):"";this.editVal.indicatorEditor.requestPayload.sortOperation=f;var m=u?"now":d,v=s?"".concat(s,":").concat(c,":").concat(m):"";this.editVal.indicatorEditor.requestPayload.cmpOperation=v;var b=this.editVal.indicatorEditor.variableEditData,g=b.updateTimeBeginData,y=b.updateTimeEndData;this.editVal.indicatorEditor.requestPayload.dimensionTime=p,this.editVal.indicatorEditor.requestPayload.updateTimeBegin=null!==(e=g.value)&&void 0!==e?e:"",this.editVal.indicatorEditor.requestPayload.updateTimeEnd=null!==(t=y.value)&&void 0!==t?t:"","fixed"===this.editVal.indicatorEditor.requestPayload.timeRangeType?this.editVal.indicatorEditor.requestPayload.relativeTime="":"relative"===this.editVal.indicatorEditor.requestPayload.timeRangeType&&(this.editVal.indicatorEditor.requestPayload.dimensionTime="",this.editVal.indicatorEditor.requestPayload.updateTimeBegin="",this.editVal.indicatorEditor.requestPayload.updateTimeEnd="")},additionalFilter:function(){var e=this.editVal.indicatorEditor.assistAttr.extraFilter;e&&(this.editVal.indicatorEditor.requestPayload.filters?this.editVal.indicatorEditor.requestPayload.filters=this.editVal.indicatorEditor.requestPayload.filters+","+e:this.editVal.indicatorEditor.requestPayload.filters="$filter=".concat(e))},staticParamFilter:function(){var e=this,t=this.editVal.indicatorEditor.assistAttr;[{name:"parentId",value:t.parentIdFilter},{name:"timeDimension",value:t.timeDimensionFilter},{name:"indicatorItemId",value:t.projectFilter}].forEach((function(t){t&&null!=t&&t.value&&(e.editVal.indicatorEditor.requestPayload.filters?e.editVal.indicatorEditor.requestPayload.filters=e.editVal.indicatorEditor.requestPayload.filters+","+"".concat(t.name," eq ").concat(t.value):e.editVal.indicatorEditor.requestPayload.filters="$filter=".concat(t.name," eq ").concat(t.value))}))},cleanData:function(){var e=this.editVal.requestPayload,t=e.queryType,a=e.timeRangeType;switch(t){case"1":this.editVal.requestPayload.aggOperation="",this.editVal.requestPayload.sortOperation="",this.editVal.requestPayload.cmpOperation="",this.editVal.requestPayload.updateTimeBegin="",this.editVal.requestPayload.updateTimeEnd="","fixed"===a?this.editVal.requestPayload.relativeTime="":"relative"===a&&(this.editVal.requestPayload.dimensionTime="");break;case"2":this.editVal.requestPayload.aggOperation="",this.editVal.requestPayload.sortOperation="",this.editVal.requestPayload.cmpOperation="",this.editVal.requestPayload.dimensionTime="","fixed"===a?this.editVal.requestPayload.relativeTime="":"relative"===a&&(this.editVal.requestPayload.updateTimeBegin="",this.editVal.requestPayload.updateTimeEnd="");break;case"3":this.editVal.requestPayload.sortOperation="",this.editVal.requestPayload.cmpOperation="",this.editVal.requestPayload.dimensionTime="","fixed"===a?this.editVal.requestPayload.relativeTime="":"relative"===a&&(this.editVal.requestPayload.updateTimeBegin="",this.editVal.requestPayload.updateTimeEnd="");break;case"4":this.editVal.requestPayload.aggOperation="",this.editVal.requestPayload.cmpOperation="",this.editVal.requestPayload.dimensionTime="","fixed"===a?this.editVal.requestPayload.relativeTime="":"relative"===a&&(this.editVal.requestPayload.updateTimeBegin="",this.editVal.requestPayload.updateTimeEnd="");break;case"5":this.editVal.requestPayload.aggOperation="",this.editVal.requestPayload.sortOperation="",this.editVal.requestPayload.dimensionTime="",this.editVal.requestPayload.updateTimeBegin="",this.editVal.requestPayload.updateTimeEnd=""}},getTimeStamp:function(e){return new Date(e).valueOf()},handleSubmit:function(){var e=this;if(this.isIndicatorEditor&&(void 0===this.editVal.indicatorEditor.requestPayload.queryType||""===this.editVal.indicatorEditor.requestPayload.queryType))return this.$message.warning("请配置查询配置"),!1;this.$refs.form.validate((function(t){if(t){if("history"===e.editVal.queryType&&"indicator"===e.editVal.historyType){if(e.syncTableToProps(),e.refreshEditValPayload(),e.additionalFilter(),e.staticParamFilter(),e.cleanData(),e.editVal.indicatorEditor.requestPayload.updateTimeEnd&&e.editVal.indicatorEditor.requestPayload.updateTimeBegin){var a=e.getTimeStamp(e.editVal.indicatorEditor.requestPayload.updateTimeEnd),i=e.getTimeStamp(e.editVal.indicatorEditor.requestPayload.updateTimeBegin);if("number"==typeof a&&"number"==typeof i&&!window.isNaN(a)&&!window.isNaN(i)&&i>a)return void e.$message({type:"error",message:"开始时间需要早于结束时间"})}if(!e.editVal.indicatorEditor.requestPayload.queryType)return void e.$message({type:"error",message:"请设置“查询配置”"})}e.commonSureHandler("templates")}}))}}},j=(a("5570"),a("431e"),Object(_.a)(S,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"template-link-editor"},[t("el-input",{staticClass:"editor-input",attrs:{value:e.showVal,readonly:"",size:"mini",clearable:""},nativeOn:{click:function(t){return e.handleTemplateClick.apply(null,arguments)}}}),t("el-drawer",{attrs:{"custom-class":"editor-drawer t-text-regular",size:"1000px",visible:e.dialogVisible,direction:"rtl",wrapperClosable:!1,"append-to-body":!0},on:{"update:visible":function(t){e.dialogVisible=t},close:e.onClose}},[t("div",{staticClass:"editor-drawer-title",attrs:{slot:"title"},slot:"title"},[t("div",{staticClass:"title-text"},[e._v("\n        模板\n        "),t("a",{directives:[{name:"show",rawName:"v-show",value:e.templateTipsLoaded&&e.templateTipsLoaded.description,expression:"templateTipsLoaded && templateTipsLoaded.description"}],attrs:{href:e.templateTipsLoaded.description,target:"_blank"}},[t("i",{staticClass:"el-icon-question"})])]),t("div",{staticClass:"title-btn"},[t("el-button",{attrs:{size:"small"},on:{click:e.handleClear}},[e._v("\n          清空\n        ")]),t("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.handleSubmit}},[e._v("\n          提交\n        ")])],1)]),t("control-common-alert",{staticClass:"template-link-alert",attrs:{show:!e.showCloseTips},on:{showCloseTips:function(t){e.showCloseTips=!0}}},[t("div",{domProps:{innerHTML:e._s(e.templateTipsLoaded&&e.templateTipsLoaded.value)}}),t("em",{staticClass:"template-link-document t-color-primary"},[t("span",[e._v("边缘设备图标")]),t("svg",{staticStyle:{"margin-left":"3px"},attrs:{width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[t("path",{staticStyle:{fill:"#0099F2"},attrs:{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M10.991 5.69215C11.1209 5.79946 11.2942 5.85312 11.4782 5.85312C11.8572 5.85312 12.1712 5.59557 12.1712 5.27364C12.1712 3.7391 11.1967 2.33333 9.60504 1.57143C8.01336 0.809524 6.03189 0.809524 4.44021 1.57143C2.83771 2.33333 1.85238 3.74983 1.85238 5.28437C1.85238 5.59557 2.16639 5.85312 2.54536 5.85312C2.92433 5.85312 3.23833 5.59557 3.23833 5.28437C3.23833 4.15761 3.95296 3.12743 5.12236 2.56942C6.29175 2.0114 7.73184 2.0114 8.90124 2.56942C10.0706 3.12743 10.7853 4.15761 10.7853 5.28437C10.7853 5.43461 10.8611 5.57411 10.991 5.69215ZM2.29632 7.89202H11.7056C12.0738 7.89202 12.3769 8.24614 12.3769 8.68612V12.2059C12.3769 12.6459 12.0738 13 11.7056 13H2.29632C1.92818 13 1.625 12.6351 1.625 12.2059V8.68612C1.625 8.24614 1.92818 7.89202 2.29632 7.89202ZM3.54151 10.9933C3.68227 10.9933 3.83386 10.9289 3.95296 10.8216C4.06124 10.7036 4.12621 10.5533 4.13703 10.4031C4.13703 10.0812 3.86634 9.81288 3.54151 9.81288C3.21668 9.81288 2.94598 10.0812 2.94598 10.4031C2.94598 10.725 3.21668 10.9933 3.54151 10.9933ZM5.33891 10.9933C5.47967 10.9933 5.63126 10.9289 5.75037 10.8216C5.85864 10.7036 5.92361 10.5533 5.93444 10.4031C5.93444 10.0812 5.67457 9.81288 5.33891 9.81288C5.01408 9.81288 4.74339 10.0812 4.74339 10.4031C4.74339 10.725 5.00325 10.9933 5.33891 10.9933ZM7.1688 10.9933C7.30956 10.9933 7.46115 10.9289 7.58025 10.8216C7.69936 10.7036 7.76432 10.5533 7.76432 10.4031C7.76432 10.0812 7.50446 9.81288 7.1688 9.81288C6.84397 9.81288 6.57327 10.0812 6.57327 10.4031C6.57327 10.725 6.83314 10.9933 7.1688 10.9933ZM6.99555 7.45205C6.56245 7.45205 6.21596 7.11938 6.21596 6.70087C6.21596 6.29309 6.56245 5.96043 6.99555 5.9497C7.42866 5.9497 7.77515 6.28236 7.77515 6.70087C7.77515 7.11938 7.42866 7.45205 6.99555 7.45205ZM8.85667 6.25035C8.9866 6.35766 9.15984 6.41131 9.34391 6.41131C9.72289 6.41131 10.0369 6.15377 10.0261 5.8533C10.0261 4.46899 8.65094 3.3315 6.98347 3.3315C5.316 3.3315 3.9517 4.44753 3.9517 5.84257C3.9517 6.05719 4.09246 6.23961 4.30902 6.34692C4.52557 6.45424 4.77461 6.45424 5.00199 6.34692C5.22938 6.23961 5.35931 6.05719 5.35931 5.84257C5.35931 5.08066 6.0956 4.46899 7.00512 4.46899C7.90383 4.46899 8.65094 5.08066 8.65094 5.84257C8.65094 5.9928 8.72673 6.14303 8.85667 6.25035Z",fill:"#00B864"}})])]),t("span",[e._v("将显示其所有的内置测点。")])]),t("div",{staticClass:"template-header t-text-primary"},[e._v("\n      "+e._s(e.projectName)+"\n    ")]),t("el-row",{attrs:{gutter:32}},[t("el-col",{staticStyle:{"border-right":"1px solid #F2F5F7"},attrs:{span:6}},[t("el-input",{attrs:{placeholder:"搜索模板","suffix-icon":"el-icon-search"},model:{value:e.searchName,callback:function(t){e.searchName=t},expression:"searchName"}}),t("el-tree",{ref:"templateTree",staticClass:"template-tree",attrs:{data:e.templateData,props:e.defaultProps,"highlight-current":!0,"current-node-key":e.currentNodeId,"node-key":"id","default-expand-all":"","expand-on-click-node":!1},on:{"node-click":e.handleNodeClick},scopedSlots:e._u([{key:"default",fn:function(a){var i=a.node;return t("div",{staticClass:"template-tree-node"},[t("i",{class:["icon-module","icon-prefix","t-color-primary"]}),t("span",{staticClass:"tree-title"},[e._v(e._s(i.label))])])}}])})],1),t("el-col",{attrs:{span:18}},[t("template-header",{attrs:{activeView:e.activeView,profileInfo:e.profileInfo,profileProperties:e.profileProperties,currentNode:e.currentNode,queryType:e.editVal.queryType,historyType:e.editVal.historyType,deviceName:e.deviceName,actualTimeType:e.editVal.actualTimeType,types:e.types,editVal:e.editVal,selectedLength:e.selectedLength},on:{"tab-click":e.handleTabClick,"view-change":e.handleViewChange,"history-type-change":e.handleHistoryTypeChange,"actualTime-type-change":e.handleActualTimeTypeChange}}),e.isStatic?t("template-table",{ref:"templateTable",attrs:{"multiple-selection":e.isDevice?e.measuringSelected[e.currentNodeId]:e.propSelected,data:e.tableData,pagination:e.tablePagination,types:e.types,propertyTypeMap:e.propertyTypeMap,deviceName:e.deviceName},on:{selectionChange:e.onPropSelectedChange,paginationChange:e.onPaginationChange}}):e._e(),e.isDynamic?t("template-dynamic",{staticClass:"template-dynamic",attrs:{editVal:e.editVal},on:{"properties-change":e.handlePropertiesChange}}):e._e(),e._e(),t("el-form",{ref:"form",attrs:{"label-width":"150px",model:e.formData}},[e.isRTEditor?t("editor-collapse",{staticClass:"link-editor-collapse",attrs:{title:"历史数据"}},[t("history-setting",{attrs:{editVal:e.editVal.rtEditor}})],1):e._e(),e.isIndicatorEditor||e.isActualTimeAndSelectIndicator?t("editor-collapse",{staticClass:"link-editor-collapse",attrs:{title:"指标配置"}},[t("template-indicator-table",{directives:[{name:"loading",rawName:"v-loading",value:e.syncIndicatorLoading,expression:"syncIndicatorLoading"}],attrs:{list:e.indicatorList,updateList:e.refreshIndicators},on:{indicatorChange:e.onIndicatorChange}}),e.indicatorList.length?e._e():t("div",{staticClass:"template-indicator-empty t-text-placeholder t-border__top"},[e._v("请先选择模板属性")])],1):e._e(),e.isIndicatorEditor?[t("editor-collapse",{staticClass:"link-editor-collapse",attrs:{title:"查询配置"}},[t("param-setting",{attrs:{editVal:e.editVal.indicatorEditor},on:{clearValidate:e.clearValidate}})],1),t("editor-collapse",{staticClass:"link-editor-collapse",attrs:{title:"筛选项"}},[t("filter-setting",{attrs:{editVal:e.editVal.indicatorEditor}})],1)]:e._e(),t("editor-collapse",{staticClass:"link-editor-collapse",attrs:{title:"其它"}},[t("response-fields",{attrs:{fields:e.responseFields,description:e.responseDescription}}),t("common-link-set",{attrs:{hiddenConfig:e.hiddenConfig,config:e.commonLinkSet,data:e.data,defaultLoad:e.defaultLoad}})],1)],2)],1)],1)],1)],1)}),[],!1,null,"69d2a1bc",null));t.default=j.exports},"7bf4":function(e,t,a){},"7c59":function(e,t,a){"use strict";a("713f")},"7cd7":function(e,t,a){"use strict";a("ae7f")},"7cda":function(e,t,a){"use strict";a("48f4")},"7e1e":function(e,t,a){"use strict";a.r(t),a("7f7f");var i=(a("8e6e"),a("456d"),a("7514"),a("ac6a"),a("bd86")),n=a("c276"),r=a("2f62"),o=a("b19c");function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){Object(i.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var c={functionName:"",description:"",payload:[{name:"",alias:""}],content:""},u={name:"CustomMethodEditor",props:{title:{type:String,default:function(){return"执行方法设置"}},showInput:{type:Boolean,default:function(){return!0}},iconClass:{type:String,default:function(){return"el-icon-edit"}},parentParent:{type:Object,default:function(){return{}}},parent:{type:Object,default:function(){return{}}},data:{type:Object,default:function(){return{}}},args:{type:Array,default:function(){return[]}},placeholder:{type:String,default:""},handleRulesResult:{type:Function,default:function(){}},handleChangeResult:{type:Function,default:function(){}}},data:function(){return{showVal:"",codeValue:"",codeOptions:{language:"javascript"},submit:!1,originData:{},editValue:{},dialogVisible:!1,rules:{functionName:[{required:!0,message:"请输入方法名称",trigger:"blur"},{trigger:"blur",pattern:"^[a-zA-Z0-9_]{1,}$",message:"只能由字母、数字、下划线构成"},{trigger:"blur",max:50,message:"长度不能大于50"}],description:[{trigger:"blur",max:500,message:"长度不能大于500"}]}}},computed:s(s({},Object(r.a)(["customMethods"])),{},{params:function(){return this.editValue.payload.reduce((function(e,t,a){return e="".concat(e).concat(t.name?a?", ".concat(t.name):t.name:"")}),"")},isChangeName:function(){var e,t;return(null==this||null===(e=this.editValue)||void 0===e?void 0:e.functionName)&&this.editValue.functionName!==(null===(t=this.originData)||void 0===t?void 0:t.functionName)},themeStyles:function(){return{target:"th,td",style:{"border-width":Object(n.nb)("borderWidth"),"border-style":Object(n.nb)("borderStyle"),"border-color":Object(n.nb)("borderColor"),padding:"0 5px"}}},theadStyles:function(){return{"background-color":Object(n.nb)("middleBackgroundColor")}},operations:function(){var e=this;return[{key:"up",name:"上移",disabled:function(e){return 0===e},icon:"el-icon-top"},{key:"down",name:"下移",disabled:function(t){return t===e.editValue.payload.length-1},icon:"el-icon-bottom"},{key:"add",name:"新增",icon:"el-icon-plus"},{key:"del",name:"删除",disabled:function(t){return 1===e.editValue.payload.length},type:"danger",icon:"el-icon-minus"}]}}),watch:{"data.value":function(){this.initData()},dialogVisible:function(e){e&&(this.setOriginData(),this.submit=!1,this.initData())},payloadLength:function(){return this.editValue.payload.length}},created:function(){this.initData()},methods:{setOriginData:function(){this.originData=Object(o.e)(this.data.editValue)},onClosed:function(){},getShowVal:function(){return this.editValue.functionName?"method: $_".concat(this.editValue.functionName):""},initData:function(){this.data.editValue?(this.editValue=this.data.editValue,this.setFuncName(this.parent,this.data,this.editValue)):this.editValue=Object(o.e)(c),this.showVal=this.getShowVal()},onCodeEditorBlur:function(e){this.editValue.content=e},handleOperationClick:function(e,t){var a="i"===e.target.localName?e.target.parentNode:e.target;if(!a.disabled)switch(a.getAttribute("operationName")){case"up":this.handleParamUp(t);break;case"down":this.handleParamDown(t);break;case"add":this.handleParamAdd();break;case"del":this.handleParamDel(t)}},handleParamUp:function(e){if(e){var t=this.editValue.payload.splice(e,1);this.editValue.payload.splice(e-1,0,t[0])}},handleParamDown:function(e){if(e!==this.payloadLength-1){var t=this.editValue.payload.splice(e,1);this.editValue.payload.splice(e+1,0,t[0])}},handleParamAdd:function(){this.payloadLength>n.a.MAX_LENGTH_ADD?this.$message({message:"最多添加"+n.a.MAX_LENGTH_ADD+"项！",type:"warning"}):this.editValue.payload.push({name:"",alias:""})},handleParamDel:function(e){var t=this;this.$confirm("确定要删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.editValue.payload.splice(e,1)})).catch((function(){}))},handleIconClick:function(){this.handleDialogOpen()},handleDialogOpen:function(){this.dialogVisible=!0},handleDialogClose:function(){this.dialogVisible=!1},onDialogClose:function(){this.submit||this.$setAttr(this.data,"editValue",Object(o.e)(this.originData)),this.handleDialogClose()},handleCancel:function(){this.onDialogClose()},handleClear:function(){var e=this;this.$confirm("确定要清空相关设置吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.showVal="",e.editValue=Object(o.e)(c),e.$removeAttr(e.data,"value"),e.$removeAttr(e.data,"lastValue"),e.$removeAttr(e.data,"editValue"),e.close()})).catch((function(){}))},handleSubmit:function(){var e,t,a,i=this;("function"!=typeof(null===(e=this.$refs)||void 0===e||null===(t=e.codeEditor)||void 0===t?void 0:t.validate)||null!==(a=this.$refs)&&void 0!==a&&a.codeEditor.validate())&&this.checkPayloads()&&this.checkFunctionName()&&this.$refs.form.validate((function(e){var t;e&&(i.submit=!0,i.setFuncName(i.parent,i.data,i.editValue),i.showVal=i.getShowVal(),i.setValue(i.showVal),i.setEditValue(i.editValue),i.setAttributes(),i.setPayload(),null!==(t=i.data)&&void 0!==t&&t.componentType&&"Page"!==i.data.componentType||i.$store.dispatch("addCustomMethods",i.editValue),i.setOriginData(),i.onDialogClose())}))},checkFunctionName:function(){var e;if(!this.isChangeName)return!0;var t=this.editValue.functionName,a=((null==this||null===(e=this.parent)||void 0===e?void 0:e.attributes)||[]).some((function(e){var a,i,n,r=null==e||null===(a=e.customMethodsSetting)||void 0===a||null===(i=a.attributes)||void 0===i||null===(n=i.functionName)||void 0===n?void 0:n.value;return t&&t===r}));return a&&this.$message.error("方法名".concat(t,"已存在")),!a},checkPayloads:function(){for(var e=this.editValue.payload,t=0;t<e.length;t++){if(1!==(null==e?void 0:e.length)&&!e[t].name)return this.$message.error("第".concat(t+1,"个参数，参数名不能为空！")),!1;for(var a=0;a<t;a++){var i=e[t],n=e[a];if(i.name===n.name)return this.$message.error("参数".concat(i.name,"已存在")),!1}}return!0},setPayload:function(){var e=this,t=[];this.editValue.payload.forEach((function(a){var i=Object(o.e)(e.data.attributes.payload.attributes[0]);i.name.value=a.name,i.alias.value=a.alias,t.push(i)})),this.$setAttr(this.data.attributes.payload,"attributes",t)},setAttributes:function(){this.$setAttr(this.data.attributes.functionName,"value",this.editValue.functionName),this.$setAttr(this.data.attributes.description,"value",this.editValue.description),this.$setAttr(this.data.attributes.content,"value",this.editValue.content)},setEditValue:function(e){this.$setAttr(this.data,"editValue",e)},setValue:function(e){this.$setAttr(this.data,"value",e),this.$setAttr(this.data,"lastValue",e)},setFuncName:function(e,t,a){var i=e.attributes.find((function(e){return e.customMethodsSetting.fid===t.fid}));i&&(i.name.default=a.functionName?"$_".concat(a.functionName):"")}}},d=(a("5325"),a("2877")),p=Object(d.a)(u,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"hc-attr-editor hc-attr-editor-custom-method"},[e.showInput?t("el-input",{staticClass:"hc-attr-editor-input",attrs:{placeholder:e.placeholder,value:e._f("formatShowValue")(e.showVal),readonly:"",size:"mini",clearable:""},nativeOn:{click:function(t){return e.handleIconClick.apply(null,arguments)}}},[t("i",{staticClass:"el-input__icon hc-attr-editor-icon",class:e.iconClass,attrs:{slot:"suffix"},slot:"suffix"})]):e._e(),t("el-dialog",{staticClass:"hc-attr-editor-dialog hc-attr-editor-dialog-method",attrs:{draggable:!0,visible:e.dialogVisible,"close-on-click-modal":!1,title:e.title,width:"56%","append-to-body":!0,top:"5vh","modal-append-to-body":!0},on:{closed:e.onClosed,close:e.onDialogClose}},[t("div",{staticClass:"hc-attr-editor-content"},[e.dialogVisible?t("el-form",{ref:"form",staticClass:"event-editor-form",attrs:{rules:e.rules,"label-width":"120px",model:e.editValue}},[t("el-form-item",{attrs:{label:"方法名称",prop:"functionName"}},[t("el-input",{model:{value:e.editValue.functionName,callback:function(t){e.$set(e.editValue,"functionName",t)},expression:"editValue.functionName"}})],1),t("el-form-item",{attrs:{label:"方法描述",prop:"description"}},[t("el-input",{model:{value:e.editValue.description,callback:function(t){e.$set(e.editValue,"description",t)},expression:"editValue.description"}})],1),t("el-form-item",{attrs:{label:"参数"}},[t("table",{directives:[{name:"theme",rawName:"v-theme",value:e.themeStyles,expression:"themeStyles"}],staticClass:"hc-editor-payload-table"},[t("thead",{staticClass:"hc-editor-payload-table-thead",style:e.theadStyles},[t("tr",[t("th",{attrs:{width:"37%"}},[e._v("参数名")]),t("th",{attrs:{width:"37%"}},[e._v("参数别名")]),t("th",{attrs:{width:"26%"}},[e._v("操作")])])]),t("tbody",{staticClass:"hc-editor-payload-table-tbody"},[e._l(e.editValue.payload,(function(a,i){return[t("tr",{key:i},[t("td",{staticClass:"hc-attr-editor-custom-method-param",attrs:{align:"center"}},[t("div",{staticClass:"value-form-item-group"},[t("el-input",{attrs:{size:"mini",placeholder:"请输入参数名"},model:{value:a.name,callback:function(t){e.$set(a,"name",t)},expression:"param.name"}})],1)]),t("td",{staticClass:"hc-attr-editor-custom-method-param",attrs:{align:"center"}},[t("div",{staticClass:"value-form-item-group"},[t("el-input",{attrs:{size:"mini",placeholder:"请输入参数别名"},model:{value:a.alias,callback:function(t){e.$set(a,"alias",t)},expression:"param.alias"}})],1)]),t("td",{staticClass:"hc-attr-editor-custom-method-operation",attrs:{align:"center"},on:{click:function(t){return e.handleOperationClick(t,i)}}},e._l(e.operations,(function(e){return t("el-button",{key:e.key,attrs:{title:e.name,disabled:"function"==typeof e.disabled&&e.disabled(i,a),size:"mini",type:e.type||"default",icon:e.icon,plain:"",operationName:e.key}})})),1)])]}))],2)])]),t("el-form-item",{attrs:{label:"方法体"}},[e._v("\n          function "+e._s(e.editValue.functionName)+" ("+e._s(e.params)+") {\n          "),e.dialogVisible?t("base-code-editor",{ref:"codeEditor",attrs:{params:e.codeOptions,value:e.editValue.content,height:420},on:{blur:e.onCodeEditorBlur}}):e._e(),e._v("\n          }\n        ")],1)],1):e._e()],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"danger"},on:{click:e.handleClear}},[e._v("清 空")]),t("el-button",{on:{click:e.handleCancel}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.handleSubmit}},[e._v("确 定")])],1)])],1)}),[],!1,null,null,null);t.default=p.exports},"7e77":function(e,t,a){},"7e9f":function(e,t,a){"use strict";a("510c")},"7ebc":function(e,t,a){"use strict";a("86e9")},"7ed5":function(e,t,a){},"7f0e":function(e,t,a){"use strict";a("6b34")},"7fc2":function(e,t,a){"use strict";a.r(t);var i=(a("8e6e"),a("456d"),a("7f7f"),a("ac6a"),a("28a5"),a("7618")),n=a("bd86"),r=(a("c5f6"),a("36f0")),o=a("ae83"),l=a("b19c"),s=a("2f62");function c(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function u(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?c(Object(a),!0).forEach((function(t){Object(n.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):c(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var d={name:"SqlLinkEditor",components:{controlCommonAlert:o.a},alias:"SQL",command:"sql-link",mixins:[r.a],props:{visible:{type:String,default:function(){return!1}},showInput:{type:String,default:function(){return!0}},iconClass:{type:String,default:function(){return"el-icon-edit"}},data:{type:Object,default:function(){return{alias:"",type:"",default:"",value:"",primitiveLabels:""}}},placeholder:{type:String,default:""},autoSetValue:{type:Boolean,default:!0},linkType:{type:Number,default:function(){return 1}},handleRulesResult:{type:Function,default:function(){}},handleChangeResult:{type:Function,default:function(){}}},data:function(){return{showVal:"",exceptionStrategyTypes:[{value:"throw"},{value:"adapt"}],tableData:[],tableRefresh:!0,showCloseTips:!1,editVal:{accessType:"sql",linkType:this.linkType,url:"",method:"post",contentType:"application/json",id:"",fields:"",dataType:"",requestPayload:{},responseSchema:{},jsonParams:[],exceptionStrategy:"throw"},currentRow:{id:""},codeOptions:{},codeValue:"{}",responseSchema:"{}",selectorPaging:{props:{hidden:function(e){return 2!==e.status}},fetchOption:{url:"/api/sqldata/scripts?$filter=status eq 2",payload:{filters:[{k:"status",o:"=",v:2}]}}},dialogVisible:this.visible,sqlScript:"",compoundItem:[{label:"变量选择",value:"variable",formItem:"variable-Panel"},{label:"手动输入",value:"static",formItem:"input",placeholder:"支持字符、${...}、字符与${...}混合三种形式的输入，${...}是对变量的引用，其中...为变量名",tips:"支持字符、${...}、字符与${...}混合三种形式的输入，${...}是对变量的引用，其中...为变量名"}]}},computed:u(u({},Object(s.a)(["getLinkTipsOf"])),{},{pageEditor:function(){return this.$store.getters.pageEditor},sqlTipsLoaded:function(){return this.getLinkTipsOf("sql-link")},sqlInfoFetchOption:function(){return{url:"/api/sqldata/scripts/".concat(this.currentRow.id)}},formLoading:function(){return this.loading.beforeLoginPage||this.loading.afterLoginPage||this.loading.theme||this.loading.menu},rules:function(){return{id:[{required:!0,message:"SQL执行脚本",trigger:"change"}]}}}),watch:{"data.value":function(){this.initData()},visible:function(e){this.dialogVisible=e,e&&this.initData()}},created:function(){var e,t;this.initData(),this.scriptParamToTable(null===(e=this.editVal)||void 0===e||null===(t=e.requestPayload)||void 0===t?void 0:t.scriptParam)},methods:{changeVariable:function(e,t){t.row.value=e,this.refreshPayload()},scriptParamToTable:function(e){if(e){var t=[];for(var a in e){var n={name:a,value:"object"===Object(i.a)(e[a])?JSON.stringify(e[a]):e[a],editValue:{editValue:this.getEditValue(e[a])},json:"object"===Object(i.a)(e[a]),example:Object(l.b)(e[a])};t.push(n)}this.tableData=t}},getInfo:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n="/api/sqldata/scripts/"+this.editVal.id,r={},o="get";return this.$util.request({url:n,params:r,method:o}).then((function(e){var n=t.editVal.requestPayload,r=void 0===n?{}:n,o="{}"===JSON.stringify(r);a&&(t.tableRefresh=!1,setTimeout((function(){t.tableRefresh=!0}),0));var s=a?e.scriptParam:(null==r?void 0:r.scriptParam)||(o?e.scriptParam:Object(l.e)(r)),c=[];for(var d in t.currentRow=u(u({},e||{}),{},{scriptParam:s}),s){var p={name:d,value:"object"===Object(i.a)(s[d])?JSON.stringify(s[d]):s[d],editValue:{editValue:t.getEditValue(s[d])},json:"object"===Object(i.a)(s[d]),example:Object(l.b)(s[d])};c.push(p)}t.tableData=c,t.sqlScript=e.executeScript,t.setEditorVal(),t.$nextTick((function(){t.focusCodeEditor()}))})).catch((function(){t.currentRow={id:""},t.sqlScript="",t.setEditorVal(),t.$nextTick((function(){t.focusCodeEditor()}))}))},getEditValue:function(e){if("object"===Object(i.a)(e))return{static:JSON.stringify(e),type:"static",variable:[]};var t,a=/\$\{(.*?)\}/g.exec(e);return(null==a?void 0:a[0])===e?{static:"",type:"variable",variable:null===(t=a[1])||void 0===t?void 0:t.split(".")}:{static:e,type:"static",variable:[]}},setEditorVal:function(){this.editVal.requestPayload.scriptParam=this.currentRow.scriptParam,this.editVal.url=this.getUrl(this.currentRow.id),this.codeValue=Object(l.b)(this.currentRow.scriptParam)},getUrl:function(e){return"/api/sqldata/scripts/"+e+"/run"},handleSqlDone:function(){},refreshPayload:function(){var e=this.tableData,t={};e.forEach((function(e){var a=e.value;if(e.json)try{a=JSON.parse(e.value)}catch(e){}t[e.name]=a})),this.editVal.requestPayload.scriptParam=t},codeEditorBlur:function(e){this.editVal.requestPayload.scriptParam=Object(l.j)(e)},responseSchemaBlur:function(e){this.responseSchema=e,this.editVal.responseSchema=Object(l.j)(e)},handleSelectorFocus:function(e){this.$refs[e]&&this.$refs[e].onPopoverHide&&this.$refs[e].onPopoverHide()},initData:function(){var e,t,a,i;this.commonInitData("sql"),null!==(e=this.data)&&void 0!==e&&null!==(t=e.linkConfig)&&void 0!==t&&t.id&&this.getInfo(null===(a=this.data)||void 0===a||null===(i=a.linkConfig)||void 0===i?void 0:i.id),this.initTips()},initTips:function(){this.$store.dispatch("setLinkEditorTips","sql")},resetData:function(){this.showVal="",this.editVal={accessType:"sql",id:"",url:"",method:"post",contentType:"application/json",requestPayload:{},responseSchema:{},exceptionStrategy:"throw"},this.currentRow={id:""},this.codeValue="{}",this.commonResetData()},focusCodeEditor:function(){this.$refs.codeEditor&&this.$refs.codeEditor.setMethod("focus")},handleIconClick:function(){this.open()},open:function(){this.$setAttr(this.data,"editorDialogVisible",!0),this.dialogVisible=!0},close:function(){this.closeHandler("sql")},clear:function(){this.clearByType("sql")},cancel:function(){this.close()},handleCurrentChange:function(e){this.currentRow=e,this.editVal.url=e.id},getShowVal:function(){return Object(l.b)(this.editVal)},clickSure:function(){var e=this;this.$refs.form.validate((function(t){t&&e.commonSureHandler("sql")}))},getHandlerEditVal:function(){var e,t=Object(l.e)(this.editVal);return t.responseSchema||(t.responseSchema={}),t.requestPayload?null!=t&&null!==(e=t.requestPayload)&&void 0!==e&&e.scriptParam&&(t.requestPayload=u({},t.requestPayload.scriptParam)):t.requestPayload={},t},validate:function(){return""!==this.editVal.responseSchema&&"string"==typeof this.editVal.responseSchema?"请填写正确的响应数据格式":""===this.editVal.requestPayload||"string"!=typeof this.editVal.requestPayload||"请填写正确的脚本参数"}}},p=(a("7ebc"),a("2877")),h=Object(p.a)(d,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"sql-link-editor"},[e.showInput?t("el-input",{staticClass:"editor-input",attrs:{placeholder:e.placeholder,value:e.showVal,readonly:"",size:"mini",clearable:""},nativeOn:{click:function(t){return e.handleIconClick.apply(null,arguments)}}},[t("i",{staticClass:"el-input__icon array-editor-icon",class:e.iconClass,attrs:{slot:"suffix"},slot:"suffix"})]):e._e(),e.dialogVisible?t("el-dialog",{staticClass:"sql-link-editor-dialog",attrs:{visible:e.dialogVisible,"close-on-click-modal":!1,title:"SQL关联配置",width:"60%","append-to-body":!0},on:{close:e.close}},[t("div",{attrs:{slot:"title"},slot:"title"},[e._v("\n      SQL关联配置\n      "),t("a",{directives:[{name:"show",rawName:"v-show",value:e.sqlTipsLoaded&&e.sqlTipsLoaded.description,expression:"sqlTipsLoaded && sqlTipsLoaded.description"}],attrs:{href:e.sqlTipsLoaded&&e.sqlTipsLoaded.description,target:"_blank"}},[t("i",{staticClass:"el-icon-question"})])]),e.dialogVisible?t("control-common-alert",{staticClass:"sql-link-alert",attrs:{show:!e.showCloseTips},on:{showCloseTips:function(t){e.showCloseTips=!0}}},[t("div",{domProps:{innerHTML:e._s(e.sqlTipsLoaded&&e.sqlTipsLoaded.value)}})]):e._e(),t("div",{staticClass:"hc-view-switch-content"},[t("el-form",{ref:"form",attrs:{"label-width":"200px",model:e.editVal,rules:e.rules}},[t("el-form-item",{attrs:{label:"SQL执行脚本：",prop:"id"}},[t("el-cascader",{staticStyle:{width:"100%"},attrs:{props:{checkStrictly:!0,disabled:"disabled",emitPath:!1,value:"id"},options:e.pageEditor.scriptsTree},on:{change:function(t){return e.getInfo(t,!0)}},model:{value:e.editVal.id,callback:function(t){e.$set(e.editVal,"id",t)},expression:"editVal.id"}})],1),t("el-form-item",{attrs:{label:"",prop:"requestPayload"}},[e.dialogVisible?t("base-code-editor",{ref:"codeEditor",attrs:{height:180,value:e.sqlScript,readOnly:!0}}):e._e()],1),t("el-form-item",{attrs:{label:"脚本参数：",prop:"requestPayload"}},[e.tableRefresh&&e.dialogVisible?t("el-table",{attrs:{data:e.tableData}},[t("el-table-column",{attrs:{prop:"name",label:"参数名",width:"100"}}),t("el-table-column",{attrs:{prop:"value",label:"参数值"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("variable-editor-components",{attrs:{compoundItem:e.compoundItem,data:a.row.editValue},on:{change:function(t){return e.changeVariable(t,a)}}})]}}],null,!1,3506975979)}),t("el-table-column",{attrs:{prop:"json",label:"是否JSON",width:"100"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-checkbox",{on:{change:function(t){return e.refreshPayload(t,a)}},model:{value:a.row.json,callback:function(t){e.$set(a.row,"json",t)},expression:"scope.row.json"}})]}}],null,!1,2454452590)}),t("el-table-column",{attrs:{prop:"example",label:"参数举例",width:"200"}})],1):e._e()],1),t("exception-strategy",{model:{value:e.editVal.exceptionStrategy,callback:function(t){e.$set(e.editVal,"exceptionStrategy",t)},expression:"editVal.exceptionStrategy"}}),t("response-schema",{attrs:{visible:e.dialogVisible,value:e.responseSchema},on:{blur:e.responseSchemaBlur}}),t("common-link-set",{attrs:{config:e.commonLinkSet,data:e.data,defaultLoad:e.defaultLoad}})],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"danger"},on:{click:e.clear}},[e._v("清 空")]),t("el-button",{on:{click:e.cancel}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.clickSure}},[e._v("确 定")])],1)],1):e._e()],1)}),[],!1,null,null,null);t.default=h.exports},"80e7":function(e,t,a){"use strict";a("c840")},8175:function(e,t,a){"use strict";a("4fe8")},8190:function(e,t,a){"use strict";a("e181")},8192:function(e,t,a){},"82bc":function(e,t,a){"use strict";a.r(t),a("7f7f");var i=(a("8e6e"),a("6762"),a("7514"),a("75fc")),n=(a("ac6a"),a("456d"),a("bd86")),r=a("b19c"),o=a("2f62"),l=a("9f02"),s=a("c276"),c=a("a337");function u(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function d(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?u(Object(a),!0).forEach((function(t){Object(n.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):u(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var p={name:"PageEventEditor",components:{AttrItem:l.a,ConfirmDialog:c.a},data:function(){return{editorVal:{},dialogVisible:!1,filterText:"",defaultProps:{children:"children",label:"name",isPage:"isPage",key:"fid",disabled:"disabled"},selectedKeys:[],isSelecting:!1,activeNodeKey:"",attrGroups:[{alias:"事件",name:"events"}],currentAttrs:[],clearDialogVisible:!1}},props:{data:{type:Object,default:function(){return{}}}},computed:d(d({},Object(o.a)(["themeConstColor"])),{},{placeholder:function(){return Object.keys(this.editorVal||{}).length?"已配置":"未配置"},dataValue:function(){return this.data.value},componentFid:function(){var e,t=this.$store.getters.pageEditor;return this.data.componentFid||(null===(e=t.pagesKV[t.pagesActiveName])||void 0===e?void 0:e.activeComponentFid)},pageEditor:function(){var e,t=this.$store.getters.pageEditor,a=t.pagesKV[t.pagesActiveName],i=a.componentKV[null==a?void 0:a.activeComponentFid];return this.$store.getters.pageEditorOf(this.componentFid,null===(e=i.attributes.value)||void 0===e?void 0:e.value)},currentPage:function(){var e,t;return null===(e=this.pageEditor)||void 0===e?void 0:e.pagesKV[null===(t=this.pageEditor)||void 0===t?void 0:t.pagesActiveName]},activeComponentFid:function(){return this.activeNodeKey},renderTree:function(){var e=this,t=[];return this.pageEditor&&this.pageEditor.pages.forEach((function(a){var i=a.page.fid,n={isPage:1,disabled:!0,fid:i,id:i,name:"页面",children:[],key:i,pagefid:a.fid};a.component.forEach((function(t){n.children.push(e.walkComponent(t))})),t.push(n)})),t}}),watch:{filterText:function(e){this.$refs.tree&&this.$refs.tree.filter(e)},activeComponentFid:function(e){this.$refs.tree&&this.$refs.tree.setCurrentKey(e),this.setCurrentAttrs(e)},dialogVisible:{immediate:!0,handler:function(e){if(e)try{this.activeNodeKey=this.renderTree[0].fid,this.setCurrentComponentId(this.renderTree[0].pagefid,!0),this.$refs.tree&&this.$refs.tree.setCurrentKey(this.activeNodeKey),this.setCurrentAttrs(this.activeNodeKey),this.initLastEventsValue()}catch(e){this.closeDialog()}this.$store.dispatch("setEventEditingComponentFid",e?this.componentFid:null)}},dataValue:function(e,t){e!==t&&this.initEditorVal()}},created:function(){this.initEditorVal()},methods:{initEditorVal:function(){this.editorVal=Object(r.e)(this.data.value)||{}},setCurrentComponentId:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.$store.dispatch("updateOthersPageActiveComponent",{componentFid:e,pageId:t?e:null,othersPageId:this.componentFid})},setCurrentAttrs:function(e){var t=this.currentPage;if(t){var a=t.componentKV,i=a&&a[e];i&&(this.currentAttrs=i.attributes)}},initLastEventsValue:function(){var e=this,t=this.currentPage;if(t){var a=t.componentKV;for(var n in a){var o=a[n],l={};for(var s in this.editorVal.hasOwnProperty(n)&&(l=Object(r.e)(this.editorVal[n])),o.attributes){var c=o.attributes[s];if("events"===c.groupName){var u,d;null!==(u=c.attributes.content)&&void 0!==u&&u.attributes||this.$setAttr(c.attributes.content,"attributes",[]);var p=null===(d=c.attributes.content)||void 0===d?void 0:d.attributes;p.forEach((function(t){e.$set(t.pageComponentName,"hidden",1)}));var h=l[s]||[];h.length?p.splice.apply(p,[p.length,0].concat(Object(i.a)(h))):p.push(this.getNewVal(p[0]))}}}}},getNewVal:function(e){var t=this,a=Object(r.e)(e),i=Object(s.ob)();return function e(a){var n=Object(r.g)(a);if("array"===n)a.forEach((function(t){e(t)}));else if("object"===n)for(var o in a){var l=a[o];if(l.fid=i,t.$removeAttr(l,"value"),t.$removeAttr(l,"editValue"),t.$removeAttr(l,"lastValue"),t.$removeAttr(l,"editorChanged"),t.$removeAttr(l,"visibleChanged"),t.$removeAttr(l,"readonlyChanged"),t.$removeAttr(l,"typeChanged"),t.$removeAttr(l,"linkConfig"),t.$removeAttr(l,"hidden"),"executionContent"===o){var s=a.executionType,c=s&&s.default;l.editor=c||l.editor}a.hasOwnProperty("validateType")&&(l.hasOwnProperty("defaultVisible")?t.$setAttr(l,"visible",l.defaultVisible):t.$removeAttr(l,"visible"),l.hasOwnProperty("validateDefaultType")&&(t.$setAttr(l,"type",l.validateDefaultType),t.$removeAttr(l,"editor")));var u=l.attributes;if(u&&(e(u),Array.isArray(u))){var d=u.every((function(e){return!e.hasOwnProperty("attributes")}));null!=l&&l.readonly||!d||null==u||!u.length||u.splice(0,u.length-1)}}}(a),a},filterNode:function(e,t){return!e||-1!==t.name.indexOf(e)},handleCheckChange:function(e,t,a){if(t.checkedKeys.find((function(t){return t===e.fid}))){var i=e.children;i&&i.length&&this.setCheckedChildren(i)}},setCheckedChildren:function(e){var t=this;("array"!==Object(r.g)(e)?[e]:e).forEach((function(e){var a=e.children;t.$refs.tree.setChecked(e,!0),a&&a.length&&t.setCheckedChildren(a)}))},renderContent:function(e,t){var a=t.node,i=t.data,n=1;(t.store,["block","carouseItem","tabsItem","CollapseItem"]).includes(a.data.componentName)&&(n=.5);var r={color:a.isCurrent?this.themeConstColor.primary:"",opacity:n};return e("div",{style:{width:"100%",lineHeight:"30px",cursor:a.disabled&&!i.isPage?"not-allowed":"unset"}},[e("span",[e("span",{style:r},[a.label])])])},handleNodeClick:function(e){!e.disabled||e.isPage?(this.activeNodeKey=e.fid,this.setCurrentComponentId(e.isPage?e.pagefid:e.fid,e.isPage)):this.$refs.tree.setCurrentKey(this.activeComponentFid)},getCollapses:function(e){var t=[];return e.attributes.forEach((function(e,a){var i=e.label,n={name:"CollapseItem",fid:i.fid,type:"collapse",groupName:"折叠",key:i.fid,id:i.fid,showName:i.value,index:a,disabled:!0,children:[]};t.push(n)})),t},getCollapseComponentChild:function(e){var t=this.getCollapses(e.attributes.collapseName);return e.children.forEach((function(e){var a=e.tabIndex;t[a].children.push(e)})),t},getTabs:function(e){var t=[];return e.attributes.forEach((function(e,a){var i=e.tabName,n=e.tabId,r={name:"tabsItem",fid:i.fid,type:"tab",groupName:"标签页",key:i.fid,id:i.fid,showName:i.value,disabled:!0,index:n.value,children:[]};t.push(r)})),t},getTabComponentChild:function(e){var t=this.getTabs(e.attributes.tabNameConfig);return e.children.forEach((function(e){var a,i=e.tabIndex;null===(a=t.find((function(e){return e.index===i})))||void 0===a||a.children.push(e)})),t},getColName:function(e){var t,a,i,n,r,o=e.parentFid,l=null===(t=this.currentPage)||void 0===t?void 0:t.componentKV[o],s=null==l||null===(a=l.attributes)||void 0===a||null===(i=a.cols)||void 0===i?void 0:i.attributes;if(!s)return"Col";var c=s.find((function(t){return t.colId.value===e.colId}));return"Col-"+((null==c||null===(n=c.span)||void 0===n?void 0:n.value)||(null==c||null===(r=c.span)||void 0===r?void 0:r.default))},walkComponent:function(e){var t,a,i,n,r={fid:e.fid,name:e.colId?this.getColName(e):(null===(t=e.attributes)||void 0===t||null===(a=t.componentName)||void 0===a?void 0:a.value)||e.showName,type:(null===(i=e.attributes)||void 0===i||null===(n=i.componentType)||void 0===n?void 0:n.value)||e.componentType,groupName:e.groupName,key:e.fid,id:e.fid,disabled:!!e.colId||e.disabled,componentName:e.name,index:e.index};if(e.children&&e.children.length){var o=[];return"Tabs"===e.name?(o=this.getTabComponentChild(e),d(d({},r),{},{children:o.map(this.walkComponent)})):"Collapse"===e.name?(o=this.getCollapseComponentChild(e),d(d({},r),{},{children:o.map(this.walkComponent)})):"CarouselLayout"===e.name?(o=this.getCarouseComponentChild(e),d(d({},r),{},{children:o.map(this.walkComponent)})):(e.children.forEach((function(e){o.push(e)})),d(d({},r),{},{children:o.map(this.walkComponent)}))}return r},handleIconClick:function(){this.dialogVisible=!0},closeDialog:function(){this.dialogVisible=!1,this.filterText=""},cancel:function(){this.closeDialog(),this.clearComponentAttrsToOrigin()},clear:function(){this.clearDialogVisible=!0},handleCancelClear:function(){this.clearDialogVisible=!1},handleClear:function(){this.clearDialogVisible=!1,this.closeDialog(),this.clearComponentAttrsToOrigin(),this.$removeAttr(this.data,"value"),this.$removeAttr(this.data,"lastValue"),this.editorVal={}},clearComponentAttrsToOrigin:function(){var e=this.currentPage;if(e){var t=e.componentKV;for(var a in t||{}){var n=t[a];for(var r in n.attributes||[]){var o=n.attributes[r];if("events"===o.groupName){var l,s,c=null===(l=o.attributes)||void 0===l||null===(s=l.content)||void 0===s?void 0:s.attributes,u=c.filter((function(e){return e.pageComponentName.hidden}));c.splice.apply(c,[0,c.length].concat(Object(i.a)(u)))}}}}},getEditorValFromComponentsAttrs:function(){var e=this.currentPage;if(e){var t=e.componentKV,a={};for(var i in t||{}){var n=t[i],o={};for(var l in n.attributes||{}){var s=n.attributes[l];if("events"===s.groupName){var c,u,d=(null===(c=s.attributes)||void 0===c||null===(u=c.content)||void 0===u?void 0:u.attributes).filter((function(e){var t;return!e.pageComponentName.hidden&&(null===(t=e.pageComponentMethod)||void 0===t?void 0:t.value)}));d.length&&(o[l]=Object(r.e)(d))}}Object.keys(o).length&&(a[i]=o)}return a}},clickSure:function(){try{this.editorVal=this.getEditorValFromComponentsAttrs(),this.clearComponentAttrsToOrigin(),this.$setAttr(this.data,"value",this.editorVal),this.$setAttr(this.data,"lastValue",this.editorVal),this.closeDialog()}catch(e){}}}},h=(a("8e33"),a("2877")),f=Object(h.a)(p,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"hc-attr-editor hc-attr-editor-variable"},[t("el-input",{staticClass:"array-editor-input",attrs:{readonly:"",size:"mini",placeholder:e.placeholder},nativeOn:{click:function(t){return e.handleIconClick.apply(null,arguments)}}},[t("i",{staticClass:"el-input__icon array-editor-icon",class:e.iconClass,attrs:{slot:"suffix"},slot:"suffix"})]),e.dialogVisible?t("el-dialog",{staticClass:"code-editor-dialog",attrs:{draggable:!0,visible:e.dialogVisible,"close-on-click-modal":!1,title:"编辑"+e.data.alias,width:"40%"},on:{close:e.cancel}},[t("el-row",{attrs:{gutter:10}},[t("el-col",{attrs:{span:12}},[t("div",{staticClass:"page-structure-tree-container"},[t("div",{staticClass:"filters"},[t("el-input",{attrs:{placeholder:"输入关键字进行过滤"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}})],1),t("div",{staticStyle:{"max-height":"calc(100% - 44px)",overflow:"auto"}},[t("el-tree",{ref:"tree",attrs:{data:e.renderTree,props:e.defaultProps,indent:12,"expand-on-click-node":!1,"show-checkbox":e.isSelecting,"check-strictly":!0,"default-checked-keys":e.selectedKeys,"node-key":"fid","render-content":e.renderContent,"default-expand-all":"","current-node-key":e.activeComponentFid,draggable:!1,"highlight-current":"","filter-node-method":e.filterNode},on:{"node-click":e.handleNodeClick,check:e.handleCheckChange}})],1)])]),t("el-col",{attrs:{span:12}},[t("div",e._l(e.attrGroups,(function(a){return t("div",{key:a.name},[e._l(e.currentAttrs,(function(i){return[i.groupName===a.name&&!1!==i.visible?t("attr-item",{key:i.name,attrs:{attr:i}}):e._e()]}))],2)})),0)])],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"danger"},on:{click:e.clear}},[e._v("清 空")]),t("el-button",{on:{click:e.cancel}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.clickSure}},[e._v("确 定")])],1)],1):e._e(),t("confirm-dialog",{attrs:{visible:e.clearDialogVisible,content:"所有页面、组件配置的事件都将会被清空！是否要继续？"},on:{close:e.handleCancelClear,submit:e.handleClear}})],1)}),[],!1,null,"4d48c362",null);t.default=f.exports},"840d":function(e,t,a){},"85fd":function(e,t,a){},"86e9":function(e,t,a){},8855:function(e,t,a){},"88da":function(e,t,a){"use strict";var i=(a("8e6e"),a("ac6a"),a("456d"),a("bd86")),n=a("2f62");function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){Object(i.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var l={name:"EditorCollapse",props:{title:{type:String,default:""},showIcon:{type:Boolean,default:!1}},data:function(){return{activeNames:["current"]}},computed:o(o({},Object(n.a)(["themeConstColor"])),{},{itemTheme:function(){var e,t;return[{target:".el-collapse-item__header",style:{backgroundColor:null===(e=this.themeConstColor)||void 0===e?void 0:e.headerColor,borderBottomWidth:this.activeNames.length?"1px":0,borderRadius:this.activeNames.length?"":"0 0 4px 4px"}},{target:".collapse-icon",style:{color:null===(t=this.themeConstColor)||void 0===t?void 0:t.textPlaceholder}}]}})},s=(a("b996"),a("cfc7"),a("2877")),c=Object(s.a)(l,(function(){var e=this,t=e._self._c;return t("el-collapse",{staticClass:"editor-collapse",model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},[t("el-collapse-item",{directives:[{name:"theme",rawName:"v-theme",value:e.itemTheme,expression:"itemTheme"}],staticClass:"t-border",attrs:{name:"current"}},[t("template",{slot:"title"},[t("span",[e._v(e._s(e.title))]),t("i",{directives:[{name:"show",rawName:"v-show",value:e.showIcon,expression:"showIcon"}],staticClass:"header-icon el-icon-question collapse-icon"})]),e._t("default")],2)],1)}),[],!1,null,"6839ab82",null);t.a=c.exports},"8a02":function(e,t,a){"use strict";a("e23e")},"8b41":function(e,t,a){"use strict";var i=(a("8e6e"),a("ac6a"),a("456d"),a("28a5"),a("bd86"));function n(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function r(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?n(Object(a),!0).forEach((function(t){Object(i.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):n(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var o={name:"HistorySetting",props:{editVal:{type:Object,default:function(){return{}}}},data:function(){return{compoundItem:[{label:"变量选择",value:"variable",formItem:"variable-Panel"},{label:"手动输入",value:"static",formItem:"date-picker"}],rtDataTypes:[{label:"实时数据",value:1},{label:"历史数据",value:2}],queryDirections:[{label:"小于等于采集/归档时间",value:1},{label:"大于等于采集/归档时间",value:2},{label:"小于采集/归档时间",value:3},{label:"大于采集/归档时间",value:4}],queryTypes:[{label:"采集时间",value:1},{label:"归档时间",value:2},{label:"时间区间",value:4}],recordTypes:[{label:"历史记录",value:1},{label:"按天归档的数据",value:2},{label:"按小时归档的数据",value:3},{label:"按分钟归档的数据",value:4}]}},computed:{orders:function(){return 1===this.editVal.requestPayload.recordType?[{label:"升序",value:"collectTime asc"},{label:"降序",value:"collectTime desc"}]:[{label:"升序",value:"archiveDate asc"},{label:"降序",value:"archiveDate desc"}]}},methods:{changeVariable:function(e,t){var a,i="collectTime"===t?this.editVal.variableEditData[t+"Data"]:null,n="static"===(null==i||null===(a=i.editValue)||void 0===a?void 0:a.type)?+new Date(e):e;this.editVal.requestPayload[t]=isNaN(n)?e:n},handleTypeChange:function(e){2===e&&(this.editVal.requestPayload=r(r({},this.editVal.requestPayload),this.requestPayloadBak),this.editVal.variableEditData=r(r({},this.editVal.variableEditData),this.variableEditDataBak),this.changeRecordType(this.editVal.requestPayload.recordType))},handleDataTypeChange:function(e){4===e&&(this.editVal.requestPayload.querySize=1e3)},changeRecordType:function(e){var t=this.editVal.requestPayload.$orderBy.split(" ");t.length&&(t[0]=1===e?"collectTime":"archiveDate",this.editVal.requestPayload.$orderBy=t.join(" "))}}},l=a("2877"),s=Object(l.a)(o,(function(){var e=this,t=e._self._c;return t("div",[t("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{label:"数据类型："}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},on:{change:e.handleTypeChange},model:{value:e.editVal.rtDataType,callback:function(t){e.$set(e.editVal,"rtDataType",t)},expression:"editVal.rtDataType"}},e._l(e.rtDataTypes,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),2===e.editVal.rtDataType?t("el-form-item",{attrs:{label:"查询类型："}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},on:{change:e.handleDataTypeChange},model:{value:e.editVal.requestPayload.queryType,callback:function(t){e.$set(e.editVal.requestPayload,"queryType",t)},expression:"editVal.requestPayload.queryType"}},e._l(e.queryTypes,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1):e._e(),2===e.editVal.rtDataType?t("el-form-item",{attrs:{label:"记录类型："}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},on:{change:e.changeRecordType},model:{value:e.editVal.requestPayload.recordType,callback:function(t){e.$set(e.editVal.requestPayload,"recordType",t)},expression:"editVal.requestPayload.recordType"}},e._l(e.recordTypes,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1):e._e(),2===e.editVal.rtDataType&&4!==e.editVal.requestPayload.queryType?t("div",[t("el-form-item",{attrs:{label:"查询范围："}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.editVal.requestPayload.queryDirection,callback:function(t){e.$set(e.editVal.requestPayload,"queryDirection",t)},expression:"editVal.requestPayload.queryDirection"}},e._l(e.queryDirections,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"查询条数："}},[t("el-input-number",{attrs:{size:"mini",min:1,max:1e3,step:1,"step-strictly":""},on:{blur:e.onQuerySizeBlur},model:{value:e.editVal.requestPayload.querySize,callback:function(t){e.$set(e.editVal.requestPayload,"querySize",t)},expression:"editVal.requestPayload.querySize"}})],1),t("el-form-item",{attrs:{label:"排序："}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.editVal.requestPayload.$orderBy,callback:function(t){e.$set(e.editVal.requestPayload,"$orderBy",t)},expression:"editVal.requestPayload.$orderBy"}},e._l(e.orders,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1):e._e(),2===e.editVal.rtDataType&&4!==e.editVal.requestPayload.queryType?t("div",[t("el-form-item",{attrs:{label:"".concat(1===e.editVal.requestPayload.queryType?"采集":"归档","时间："),prop:"requestPayload.collectTime"}},[t("variable-editor-components",{key:"collectTime",attrs:{compoundItem:e.compoundItem,"value-format":"timestamp",data:e.editVal.variableEditData.collectTimeData},on:{change:function(t){return e.changeVariable(t,"collectTime")}}})],1)],1):e._e(),2===e.editVal.rtDataType&&4===e.editVal.requestPayload.queryType?t("div",[t("el-form-item",{attrs:{label:"开始时间：",prop:"requestPayload.beginTime"}},[t("variable-editor-components",{key:"beginTime",attrs:{compoundItem:e.compoundItem,"value-format":"timestamp",data:e.editVal.variableEditData.beginTimeData},on:{change:function(t){return e.changeVariable(t,"beginTime")}}})],1),t("el-form-item",{attrs:{label:"结束时间：",prop:"requestPayload.endTime"}},[t("variable-editor-components",{key:"endTime",attrs:{compoundItem:e.compoundItem,"value-format":"timestamp",data:e.editVal.variableEditData.endTimeData},on:{change:function(t){return e.changeVariable(t,"endTime")}}})],1)],1):e._e()],1)}),[],!1,null,"38f0cd4e",null);t.a=s.exports},"8b46":function(e,t,a){},"8c2f":function(e,t,a){var i={"./api-editor/index.vue":"ed9e","./array-editor/index.vue":"ddb8","./code-editor/index.vue":"dd8a","./col-editor/index.vue":"2dba","./custom-method-editor/index.vue":"7e1e","./data-source-editor/index.vue":"dc46","./file-editor/index.vue":"d45f","./icon-editor/index.vue":"e122","./import-attrs-editor/index.vue":"19911","./link/alarm-link-editor/index.vue":"904a","./link/api-link-editor/index.vue":"66b3","./link/assets-link-editor/index.vue":"6834","./link/device-variable-link-editor/index.vue":"fcc0","./link/index.js":"45e0","./link/indicator-link-editor-old/index.vue":"5c9f","./link/indicator-link-editor/index.vue":"36ad","./link/object-link-editor-old/index.vue":"93c5","./link/object-link-editor/index.vue":"3c0c","./link/rtdata-link-editor/index.vue":"0456","./link/script-link-editor/index.vue":"020a","./link/sql-link-editor/index.vue":"7fc2","./link/temp-variable-link-editor/index.vue":"31cd","./link/template-link-editor/index.vue":"7bec","./link/variable-link-editor/index.vue":"44cb","./method-editor/index.vue":"e2e1","./organization-editor/index.vue":"ddab","./page-editor/index.vue":"2396","./page-event-editor/index.vue":"82bc","./permission-editor/index.vue":"9abf","./report-editor/index.vue":"c16a","./row-editor/index.vue":"9400","./script-editor/index.vue":"99a8","./variable-editor-components/index.vue":"cbd9","./variable-editor-components/virtual-select/index.vue":"d98f","./variable-editor/index.vue":"48f9"};function n(e){var t=r(e);return a(t)}function r(e){if(!a.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}n.keys=function(){return Object.keys(i)},n.resolve=r,e.exports=n,n.id="8c2f"},"8c7a":function(e,t,a){},"8e33":function(e,t,a){"use strict";a("793f")},"8e41":function(e,t,a){"use strict";a("f5be")},"8e8a":function(e,t,a){"use strict";a("7f7f");var i=a("75fc"),n=(a("28a5"),a("20d6"),a("ac6a"),a("c276")),r=a("b19c"),o=function(e){var t={};for(var a in e){var i=e[a];"name"===a?t.name=Object(n.pb)(i.value,i.default):"alias"===a?t.alias=Object(n.pb)(i.value,i.default):"description"===a?t.description=Object(n.pb)(i.value,i.default):"editor"===a&&(t.editor=Object(n.pb)(i.value,i.default))}return t},l={name:"ApiFiltersSelect",props:{value:{type:Array,default:function(){return[{name:"",value:"",filter:"",editValue:null,logicExp:"eq"}]}},showFilterType:{type:Boolean,default:!1},showDescription:{type:Boolean,default:!1},showIn:{type:Boolean,default:!1},showLeftlike:{type:Boolean,default:!1},filterType:{type:String,default:"and"}},created:function(){var e=this;this.payloads=this.value,this.showIn&&this.filterTypes.push({label:"包含",value:"in",mark:"in"}),this.showLeftlike&&this.filterTypes.splice(2,0,{label:"左相似",value:"leftlike",mark:"=%"}),this.payloads.forEach((function(t){t.filterType||e.$set(t,"filterType",e.complex?"and":e.filterType)})),this.filterTypes.forEach((function(t){e.filterTypesMap[t.value]=t.label}))},watch:{value:function(e,t){this.payloads=e},filterType:function(e,t){}},data:function(){var e=this;return{compoundItem:[{label:"变量选择",value:"variable",formItem:"variable-Panel"},{label:"手动输入",value:"static",formItem:"input",placeholder:"支持字符、${...}、字符与${...}混合三种形式的输入，${...}是对变量的引用，其中...为变量名",tips:"支持字符、${...}、字符与${...}混合三种形式的输入，${...}是对变量的引用，其中...为变量名"},{label:"表达式",value:"useExpression",formItem:"input",placeholder:"支持js表达式语法，支持混合使用变量，${...}是对变量的引用，其中...为变量名",tips:"支持js表达式语法，支持混合使用变量，${...}是对变量的引用，其中...为变量名"}],changed:!0,filterTypes:[{label:"等于",value:"eq",mark:"="},{label:"相似",value:"like",mark:"≈"},{label:"不等于",value:"ne",mark:"≠"},{label:"大于",value:"gt",mark:">"},{label:"大于等于",value:"gte",mark:"≥"},{label:"小于",value:"lt",mark:"<"},{label:"小于等于",value:"lte",mark:"≤"}],filterTypesMap:{},payloads:[{name:"",value:"",filter:"",editValue:null}],dialogVisible:!1,addGroupOptions:{visible:!1,begin:1,end:1,getLabel:function(t){if("group"===t.filterType)return t.divierName;var a,i=e.filterTypesMap[t.logicExp]||t.logicExp;return"".concat(t.name," ").concat(i," '").concat(null!==(a=t.value)&&void 0!==a?a:"","'")}}}},methods:{setFilterType:function(e){var t=this;this.payloads.forEach((function(a){t.$set(a,"filterType",e)}))},getPayloads:function(e){var t=[];if("array"===Object(r.g)(e))e.forEach((function(e){if(!t.length){var a="payload"===e.name?e.attributes:e.payload?e.payload.attributes:null;a&&a.forEach((function(e){var a=o(e);t.push(a)}))}}));else if("object"===Object(r.g)(e))for(var a in e)if("payload"===a){e[a].attributes.forEach((function(e){var a=o(e);t.push(a)}))}return t},handleEvents:function(e,t){var a=this,i=this.payloads.length;if("add"===e)return i>n.a.MAX_LENGTH_ADD?void this.$message({message:"最多添加"+n.a.MAX_LENGTH_ADD+"项！",type:"warning"}):(this.payloads.push({name:"",value:"",filter:"eq",editValue:null,logicExp:"eq",filterType:this.complex?"and":this.filterType}),void this.emitChange());if("del"!==e){if("top"===e){if(0===t)return;var r=this.payloads.splice(t,1);return this.payloads.splice(t-1,0,r[0]),void this.emitChange()}if("bottom"===e){if(t===i-1)return;var o=this.payloads.splice(t,1);this.payloads.splice(t+1,0,o[0]),this.emitChange()}if("clear"===e&&this.emitChange(),"groupDivier"===e){var l=Date.now()+"",s=this.addGroupOptions,c=s.begin,u=s.end;this.payloads.splice(c-1,0,{filterType:"group",divierType:"and",divierCode:"begin",divierName:"分组︵开始",divierSign:l}),this.payloads.splice(u+1,0,{filterType:"group",divierType:"and",divierCode:"end",divierName:"分组︶结束",divierSign:l}),this.addGroupOptions.visible=!1,this.emitChange()}}else this.$confirm("确定要删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var e=a.payloads.splice(t,1),i=e[0].divierSign;if(i){var n=a.payloads.findIndex((function(e){return e.divierSign===i}));if(n>-1)a.payloads.splice(n,1);else if("begin"===e.divierCode){for(var r=t;r<a.payloads.length;r++)if("end"===a.payloads[r].divierCode){a.payloads.splice(r,1);break}}else for(var o=t;o--;)if("begin"===a.payloads[o].divierCode){a.payloads.splice(o,1);break}}a.emitChange()})).catch((function(){}))},importVariable:function(){var e=this;this.$confirm("导入页面变量会清空已有配置，你确定要导入吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var t=Object(n.ab)(e.pageInfo.page.attributes.customVariable);t?(e.payloads=[],e.handleImportVariable(t)):e.$message.warning("页面未定义自定义变量!")})).catch((function(){}))},handleImportVariable:function(e,t){for(var a in e){var i=e[a],n=t?t+"."+a:a;"object"===Object(r.g)(i)&&this.handleImportVariable(i,n);var o={name:n,value:"${"+n+"}",filter:"",editValue:{type:"variable",static:"",variable:this.getEditValueVariable(n)}};this.payloads.push(o)}},getEditValueVariable:function(e){if(!e)return[];var t=[];return e.split(".").forEach((function(e){t.push(e)})),t},variableOnChange:function(e){this.emitChange()},onNameChange:function(){this.emitChange()},onFilterChanged:function(){this.emitChange()},emitChange:function(){this.$emit("input",this.payloads),this.$emit("change",this.payloads)},openAddGroupDig:function(){this.addGroupOptions.begin=1,this.addGroupOptions.end=this.payloads.length,this.addGroupOptions.visible=!0}},computed:{themeStyles:function(){return{target:"th,td",style:{"border-width":Object(n.nb)("borderWidth"),"border-style":Object(n.nb)("borderStyle"),"border-color":Object(n.nb)("borderColor"),padding:"0 5px"}}},theadStyles:function(){return{"background-color":Object(n.nb)("middleBackgroundColor")}},pageInfo:function(){var e=this.$store.getters.pageEditor;return e.pagesKV[e.pagesActiveName]},newArgs:function(){if(this.args&&this.args.length)return Object(i.a)(this.args);var e=this.getPayloads(this.parent&&this.parent.attributes);return e.length>0?e:(e=this.getPayloads(this.parentParent&&this.parentParent.attributes)).length>0?e:[]},complex:function(){return"complex"===this.filterType},showComplexOptions:function(){var e=this;return function(t){var a=e.payloads[t+1];return a?t!==e.payloads.length-1&&"group"!==a.filterType:t!==e.payloads.length-1}}}},s=(a("6994"),a("2877")),c=Object(s.a)(l,(function(){var e=this,t=e._self._c;return t("div",[e._t("default"),t("table",{directives:[{name:"theme",rawName:"v-theme",value:e.themeStyles,expression:"themeStyles"}],staticClass:"hc-editor-payload-table"},[t("thead",{staticClass:"hc-editor-payload-table-thead",style:e.theadStyles},[t("tr",[t("th",{attrs:{width:e.complex?"17%":"20%"}},[e._v("参数名")]),t("th",{attrs:{width:e.complex?"14%":"20%"}},[e._v("\n          过滤类型\n          "),t("basic-tips",{attrs:{type:"popover",title:"说明",width:600,placement:"bottom-start",iconStyle:{color:"#C9D0D4"},content:""}},[t("ul",{staticClass:"basic-tip-content-ul"},[t("li",[e._v("如果当前类型不满足，可以通过输入框输入并选择来创建额外的过滤类型")]),t("li",[e._v("鼠标悬浮在名称上可以查看当前类型的值")])])])],1),t("th",[e._v("参数值")]),e.complex?t("th",{attrs:{width:"15%"}},[e._v("查询类型")]):e._e(),e.showDescription?t("th",[e._v("描述")]):e._e(),t("th",{attrs:{width:"18%"}},[e._v("操作")])])]),t("tbody",{staticClass:"hc-editor-payload-table-tbody"},[e._l(e.payloads,(function(a,i){return["group"===a.filterType&&e.complex?t("tr",{key:i},[t("td",{attrs:{colspan:e.showDescription?"4":"3"}},[t("el-divider",{attrs:{"content-position":"center"}},[e._v("\n              "+e._s(a.divierName)+"\n              "),t("basic-tips",{attrs:{type:"popover",title:"说明",width:600,placement:"bottom-start",iconStyle:{color:"#C9D0D4"},content:""}},[t("ul",{staticClass:"basic-tip-content-ul"},["begin"===a.divierCode?t("li",[e._v("等价于 '()' 中的左括号 '(' ")]):e._e(),"end"===a.divierCode?t("li",[e._v("等价于 '()' 中的右括号 ')'")]):e._e()])])],1)],1),e.complex?t("td",[0!==i&&i!==e.payloads.length-1&&"begin"!==e.payloads[i+1].divierCode?t("el-radio-group",{style:"position: relative;top: ".concat("end"===e.payloads[i-1].divierCode?"-18px":"0px",";"),on:{change:e.variableOnChange},model:{value:a.divierType,callback:function(t){e.$set(a,"divierType",t)},expression:"param.divierType"}},[t("el-radio",{staticStyle:{"margin-right":"10px"},attrs:{label:"and"}},[e._v("and")]),t("el-radio",{staticStyle:{"margin-right":"0px"},attrs:{label:"or"}},[e._v("or")])],1):e._e()],1):e._e(),t("td",{staticClass:"hc-payload-operation",attrs:{align:"center"}},[t("CommonTableMoveOprate",{attrs:{data:e.payloads,index:i,icon:!1,text:!0,layout:"top, bottom, del"},on:{click:e.handleEvents}})],1)]):e._e(),"group"!==a.filterType?t("tr",{key:i},[t("td",[t("el-input",{attrs:{size:"mini",placeholder:"请输入参数名",clearable:""},on:{blur:e.onNameChange,clear:e.onNameChange},model:{value:a.name,callback:function(t){e.$set(a,"name",t)},expression:"param.name"}})],1),t("td",[t("el-select",{attrs:{size:"mini",filterable:"","allow-create":"","default-first-option":"",placeholder:"请选择"},on:{change:e.onFilterChanged},model:{value:a.logicExp,callback:function(t){e.$set(a,"logicExp",t)},expression:"param.logicExp"}},e._l(e.filterTypes,(function(a){return t("el-option",{key:a.value,attrs:{label:a.label,value:a.value}},[t("span",{staticStyle:{float:"left"},attrs:{title:a.value}},[e._v(e._s(a.label))]),t("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[e._v(e._s(a.mark))])])})),1)],1),t("td",[t("variable-editor-components",{attrs:{compoundItem:e.compoundItem,data:a,args:e.newArgs},on:{change:e.variableOnChange}})],1),e.complex?t("td",[e.showComplexOptions(i)?t("el-radio-group",{staticStyle:{position:"relative",top:"18px"},on:{change:e.variableOnChange},model:{value:a.filterType,callback:function(t){e.$set(a,"filterType",t)},expression:"param.filterType"}},[t("el-radio",{staticStyle:{"margin-right":"10px"},attrs:{label:"and"}},[e._v("and")]),t("el-radio",{staticStyle:{"margin-right":"0px"},attrs:{label:"or"}},[e._v("or")])],1):e._e()],1):e._e(),e.showDescription?t("td",[t("el-input",{attrs:{disabled:!0,size:"mini",placeholder:""},model:{value:a.description,callback:function(t){e.$set(a,"description",t)},expression:"param.description"}})],1):e._e(),t("td",{staticClass:"hc-payload-operation",attrs:{align:"center"}},[t("CommonTableMoveOprate",{attrs:{data:e.payloads,index:i,icon:!1,text:!0},on:{click:e.handleEvents}})],1)]):e._e()]}))],2)]),t("div",{staticClass:"params-add-btn",staticStyle:{display:"flex"}},[t("el-button",{attrs:{title:"新增",icon:"el-icon-plus",plain:""},on:{click:function(t){return e.handleEvents("add")}}},[e._v("添加参数")]),e.complex?t("el-button",{attrs:{title:"添加分组",icon:"el-icon-plus",plain:""},on:{click:e.openAddGroupDig}},[e._v("添加分组")]):e._e()],1),t("el-dialog",{attrs:{title:"分组配置",visible:e.addGroupOptions.visible,"append-to-body":"",width:"500px"},on:{"update:visible":function(t){return e.$set(e.addGroupOptions,"visible",t)}}},[t("div",[t("div",{staticStyle:{"margin-bottom":"15px"}},[t("el-select",{staticStyle:{margin:"0px  15px",width:"300px"},attrs:{placeholder:"请选择"},model:{value:e.addGroupOptions.begin,callback:function(t){e.$set(e.addGroupOptions,"begin",t)},expression:"addGroupOptions.begin"}},e._l(e.payloads,(function(a,i){return t("el-option",{key:i,attrs:{label:e.addGroupOptions.getLabel(a),value:i+1}})})),1),e._v("\n        前插入左括号\n      ")],1),t("div",[t("el-select",{staticStyle:{margin:"0px  15px",width:"300px"},attrs:{placeholder:"请选择"},model:{value:e.addGroupOptions.end,callback:function(t){e.$set(e.addGroupOptions,"end",t)},expression:"addGroupOptions.end"}},e._l(e.payloads,(function(a,i){return t("el-option",{key:i,attrs:{label:e.addGroupOptions.getLabel(a),value:i+1}})})),1),e._v("\n        后插入右括号\n      ")],1)]),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.addGroupOptions.visible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.handleEvents("groupDivier")}}},[e._v("确 定")])],1)])],2)}),[],!1,null,null,null);t.a=c.exports},"8f67":function(e,t,a){},"8fee":function(e,t,a){"use strict";a("3a46")},"900f":function(e,t,a){"use strict";a.r(t),t.default=a.p+"img/placeholder.089e5a23.png"},"904a":function(e,t,a){"use strict";a.r(t);var i=(a("8e6e"),a("456d"),a("20d6"),a("a481"),a("7618")),n=(a("6762"),a("2fdb"),a("28a5"),a("96cf"),a("3b8d")),r=(a("ac6a"),a("7514"),a("75fc")),o=(a("55dd"),a("7f7f"),a("bd86")),l=(a("c5f6"),a("967e")),s=a.n(l),c=a("36f0"),u=a("c276"),d=a("b19c"),p=a("ae83"),h=a("91ff"),f=a("bc2d"),m=a("d8fe"),v=a("2f62"),b=a("c7fd");function g(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function y(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?g(Object(a),!0).forEach((function(t){Object(o.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):g(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var _=function(e){var t={};for(var a in e){var i=e[a];"name"===a?t.name=Object(u.pb)(i.value,i.default):"alias"===a?t.alias=Object(u.pb)(i.value,i.default):"description"===a?t.description=Object(u.pb)(i.value,i.default):"editor"===a&&(t.editor=Object(u.pb)(i.value,i.default))}return t},C={name:"AlarmLinkEditor",command:"alarm-link",alias:"告警信息",mixins:[c.a],components:{controlCommonAlert:p.a,OrderbySetting:h.a,PaginationSetting:f.a,ApiTestPanel:m.a,ParamsSelect:b.a},props:{visible:{type:String,default:function(){return!1}},showInput:{type:String,default:function(){return!0}},iconClass:{type:String,default:function(){return"el-icon-edit"}},data:{type:Object,default:function(){return{alias:"",type:"",default:"",value:"",primitiveLabels:""}}},placeholder:{type:String,default:""},linkType:{type:Number,default:function(){return 1}},handleRulesResult:{type:Function,default:function(){}},handleChangeResult:{type:Function,default:function(){}}},data:function(){var e="alarm";return{collapseValue:"filter",compUid:"",ownSign:e,actionTipTitle:"对象类型是指通过指定对象类型并从该实例返回的内容获取数据，可为请求配置BODY请求体内容、对象标识、筛选项、数据排序等参数配置，可进行请求测试，验证请求有效性和响应字段管理。",configApi:"",totalApi:"/api/alarm/alarm-messages/query-alarm-message-count",configTypes:[{label:"列表",value:"list",api:"/api/alarm/alarm-messages"},{label:"对象",value:"object",api:"/api/alarm/alarm-messages/{id}"}],metaDataKeys:{configType:"list",alarmModel:{type:"static",static:"",value:"",variable:[],useExpression:""},startTime:{type:"static",static:"",value:"",variable:[],useExpression:""},endTime:{type:"static",static:"",value:"",variable:[],useExpression:""},totalOnly:"0",filterArr:[{name:"alarmName",value:"",filter:"eq",editValue:"",logicExp:"eq",description:"名称",config:{filterTypes:[{label:"等于",value:"eq"},{label:"包含",value:"like"}]}},{name:"deviceName",value:"",filter:"eq",editValue:"",logicExp:"eq",description:"设备名称",config:{filterTypes:[{label:"等于",value:"eq"},{label:"包含",value:"like"}]}},{name:"status",value:"",filter:"eq",editValue:"",logicExp:"eq",description:"告警状态",config:{filterTypes:[{label:"等于",value:"eq"}],compoundItem:[{label:"变量选择",value:"variable",formItem:"variable-Panel"},{label:"手动输入",value:"static",formItem:"select",placeholder:"支持字符、${...}、字符与${...}混合三种形式的输入，${...}是对变量的引用，其中...为变量名",tips:"支持字符、${...}、字符与${...}混合三种形式的输入，${...}是对变量的引用，其中...为变量名"},{label:"表达式",value:"useExpression",formItem:"input",placeholder:"支持js表达式语法，支持混合使用变量，${...}是对变量的引用，其中...为变量名",tips:"支持js表达式语法，支持混合使用变量，${...}是对变量的引用，其中...为变量名"}],options:[{label:"产生",value:"1"},{label:"消失",value:"0"}]}},{name:"deviceIdentifier",value:"",filter:"eq",editValue:"",logicExp:"eq",description:"设备标识",config:{filterTypes:[{label:"等于",value:"eq"}]}},{name:"gatewayDeviceIdentifier",value:"",filter:"eq",editValue:"",logicExp:"eq",description:"网关标识",config:{filterTypes:[{label:"等于",value:"eq"}]}},{name:"level",value:"",filter:"eq",editValue:"",logicExp:"eq",description:"告警等级",config:{filterTypes:[{label:"等于",value:"eq"}]}},{name:"eventBusinessType",value:"",filter:"eq",editValue:"",logicExp:"eq",description:"事件业务类型",config:{filterTypes:[{label:"等于",value:"eq"}]}}],orderByArr:[{attr:"createTime",sort:"desc",description:"创建时间"},{attr:"confirmTime",sort:"",description:"确认时间"},{attr:"appearTime",sort:"",description:"产生时间"},{attr:"disappearTime",sort:"",description:"消失时间"}],pagination:{page:"",pageSize:"",enabled:!0},commonLinkSet:{fields:"",containsKey:1,pagination:0},objectIdEditVal:{type:"static",static:"",value:"",variable:[],useExpression:""}},metaData:{configType:"list",alarmModel:{type:"static",static:"",value:"",variable:[],useExpression:""},startTime:{type:"static",static:"",value:"",variable:[],useExpression:""},endTime:{type:"static",static:"",value:"",variable:[],useExpression:""},totalOnly:"0",filterArr:[],orderByArr:[],pagination:{page:"",pageSize:"",enabled:!0},commonLinkSet:{fields:"",containsKey:1,pagination:0},objectIdEditVal:{type:"static",static:"",value:"",variable:[],useExpression:""}},editVal:{url:"",method:"get",exceptionStrategy:"throw",fields:"",containsKey:1,pagination:0,dataType:"",defaultLoad:!0,requestPayload:{},responseSchema:{},variables:[],quickSelect:{},historySelect:[],isQuickSelect:!1,metaData:"{}"},baseEditVal:{accessType:e,linkType:this.linkType,contentType:"application/json",exceptionStrategy:"throw"},jsonValue:"{}",codeJSONOptions:{},showVal:"",dialogVisible:this.visible,showTest:!1,viewMode:1,tempJsonValue:"",paramsArr:[],commonParamsKeys:[],pagination:{page:"",pageSize:"",enabled:!0},configToTest:{},compoundItem:[{label:"变量选择",value:"variable",formItem:"variable-Panel"},{label:"手动输入",value:"static",formItem:"input",placeholder:"支持字符、${...}、字符与${...}混合三种形式的输入，${...}是对变量的引用，其中...为变量名",tips:"支持字符、${...}、字符与${...}混合三种形式的输入，${...}是对变量的引用，其中...为变量名"}],compoundItemDatePicker:[{label:"变量选择",value:"variable",formItem:"variable-Panel"},{label:"手动输入",value:"static",formItem:"date-picker",placeholder:"支持字符、${...}、字符与${...}混合三种形式的输入，${...}是对变量的引用，其中...为变量名",tips:"支持字符、${...}、字符与${...}混合三种形式的输入，${...}是对变量的引用，其中...为变量名"}],compoundItemAlarmModel:[{label:"变量选择",value:"variable",formItem:"variable-Panel"},{label:"手动输入",value:"static",formItem:"multipleSelect",placeholder:"支持字符、${...}、字符与${...}混合三种形式的输入，${...}是对变量的引用，其中...为变量名",tips:"支持字符、${...}、字符与${...}混合三种形式的输入，${...}是对变量的引用，其中...为变量名"}],alarmModelOptions:[{label:"云端告警",value:"1"},{label:"设备告警",value:"2"}],showCloseTips:!1,projectIdentifier:"",intanceList:[],filterString:""}},computed:y(y({},Object(v.a)(["themeConstColor","getLinkTipsOf"])),{},{themeColor:function(){return this.themeConstColor.primary},alarmTipsLoaded:function(){return this.getLinkTipsOf("alarm-link")||{}},paramsSettingItems:function(){return[{label:"筛选项",id:"filter",tips:["限制接口返回与指定字段、过滤类型匹配的数据","联合查询中(complex)，提高查询的优先级请添加分组，分组本质就是添加一对小括号"],count:(this.metaData.filterArr.filter((function(e){return e.name&&e.value}))||[]).length,visible:"list"===this.metaData.configType},{label:"排序",id:"sort",tips:["按照配置顺序以指定字段进行排序，支持升序和降序"],count:(this.metaData.orderByArr.filter((function(e){return e.attr&&e.sort}))||[]).length,visible:"list"===this.metaData.configType&&"1"!==this.metaData.totalOnly}]},newArgs:function(){if(this.args&&this.args.length)return Object(r.a)(this.args);var e=this.getPayloads(this.parent&&this.parent.attributes);return e.length>0?e:(e=this.getPayloads(this.parentParent&&this.parentParent.attributes)).length>0?e:[]},isList:function(){return"list"===this.metaData.configType}}),watch:{"data.value":function(){this.initData()},visible:function(e){this.dialogVisible=e,e&&this.initData()}},created:function(){this.initData()},methods:{totalOnlyChange:function(){var e=this,t=this.configTypes.find((function(t){return t.value===e.metaData.configType}))||this.configTypes[0];this.configApi="1"===this.metaData.totalOnly?this.totalApi:t.api,this.refreshUrl()},getPayloads:function(e){var t=[];if("array"===Object(d.g)(e))e.forEach((function(e){if(!t.length){var a="payload"===e.name?e.attributes:e.payload?e.payload.attributes:null;a&&a.forEach((function(e){var a=_(e);t.push(a)}))}}));else if("object"===Object(d.g)(e))for(var a in e)if("payload"===a){e[a].attributes.forEach((function(e){var a=_(e);t.push(a)}))}return t},initData:function(){this.compUid=this._uid,this.showVal="",this.commonInitData(this.ownSign),this.jsonValueHandler(),this.setMetaData(),this.handleConfigTypeChange(!0),this.initTips(),this.projectIdentifier=Object(d.h)(window.location.href,"projectIdentifier"),this.refreshUrl()},initTips:function(){this.$store.dispatch("setLinkEditorTips","object")},clickSure:function(){this.isCorrectJsonValue()||(this.showTest=!1,this.viewMode=2);var e={};for(var t in this.metaDataKeys)e[t]=this.metaData[t];this.editVal.metaData=JSON.stringify(e),this.commonSureHandler(this.ownSign)},setMetaData:function(){try{var e=JSON.parse(this.editVal.metaData);for(var t in this.metaDataKeys)this.$set(this.metaData,t,e[t]||Object(d.e)(this.metaDataKeys[t]))}catch(e){}},getDeviceList:function(){var e=this;return Object(n.a)(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.isList){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,e.getDeviceListFn();case 4:e.deviceList=t.sent,e.$refs.variableEditorDevice&&e.$refs.variableEditorDevice.setOptions(e.deviceList);case 6:case"end":return t.stop()}}),t)})))()},getDeviceListFn:function(){var e=this;return new Promise((function(t,a){var i={url:"/api/model/instances",params:{pagination:0,lazyLoad:0,$orderBy:"createTime desc",$fields:"id,parentId,name",projectIdentifier:e.projectIdentifier}};e.$util.request(i).then((function(e){t(e)})).catch((function(a){e.$message.error(a.message||"获取实例列表失败"),t([])}))}))},recoverDefaultKey:function(e){for(var t in"string"==typeof e&&(e=e.split(",")),this.metaDataKeys)Array.isArray(e)&&e.length?e.includes(t)&&this.$set(this.metaData,t,Object(d.e)(this.metaDataKeys[t])):this.$set(this.metaData,t,Object(d.e)(this.metaDataKeys[t]))},jsonValueHandler:function(){var e=this,t=Object(d.e)(this.editVal);delete(t=y(y(y(y(y({},t),this.pagination),this.getAllQueryData()),this.commonLinkSet),{},{defaultLoad:this.data.defaultLoad,$page:this.pagination.page,$pageSize:this.pagination.pageSize})).url,delete t.method,delete t.metaData,delete t.requestPayload,delete t.accessType,delete t.contentType,delete t.exceptionStrategy,delete t.responseSchema,delete t.dataType,delete t.variables,delete t.quickSelect,delete t.historySelect,delete t.isQuickSelect,delete t.requestParams,delete t.enabled,delete t.page,delete t.pageSize,this.isList||(t.id=this.metaData.objectIdEditVal.value||"",delete t.$page,delete t.$pageSize,delete t.$orderBy,delete t.$filter),this.jsonValue=Object(d.b)(t),this.tempJsonValue="",this.$nextTick((function(){e.$refs.codeEditorJSON&&e.$refs.codeEditorJSON.initData()}))},codeEditorJSONBlur:function(e){if(this.tempJsonValue=e,this.isCorrectJsonValue(!1)){var t=Object(d.j)(e);this.data.defaultLoad=t.defaultLoad,this.initCommonLinkSet(t),this.isList?this.reverseParams(t):this.metaData.objectIdEditVal.value=t.id,this.refreshUrl()}},isCorrectJsonValue:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];try{var t=JSON.parse(this.tempJsonValue);if(["number"].includes(Object(i.a)(t)))throw new Error("格式不合法");return!0}catch(t){return null===this.tempJsonValue||""===this.tempJsonValue||(e&&this.$message({message:"输入正确格式的JSON数据！",type:"warning"}),!1)}},validate:function(){var e=this.metaData.objectIdEditVal;return"string"==typeof this.editVal||Array.isArray(this.editVal)?"请输入正确的JSON配置！":!(!this.isList&&!e.value)||"请配置告警记录Id"},getHandlerEditVal:function(){var e=Object(d.e)(this.editVal);return e.responseSchema||(e.responseSchema={}),e.requestPayload||(e.requestPayload={}),(e=Object.assign(e,this.baseEditVal)).variables=this.getVariables(e),e},getVariables:function(e){var t=this.getVariableNames(e.url),a=this.getVariableNames(e.requestPayload),i=this.getVariableNames(e.responseSchema);return this.formatVariables([].concat(Object(r.a)(t),Object(r.a)(a),Object(r.a)(i)))},handleIconClick:function(){this.open()},open:function(){this.$setAttr(this.data,"editorDialogVisible",!0),this.dialogVisible=!0},close:function(){this.closeHandler(this.ownSign)},clear:function(){this.clearByType(this.ownSign)},resetData:function(){this.showVal="",this.editVal={url:"",method:"get",exceptionStrategy:"throw",fields:"",containsKey:1,pagination:0,dataType:"",defaultLoad:!0,requestPayload:{},responseSchema:{},variables:[],quickSelect:{},historySelect:[],isQuickSelect:!1,metaData:"{}"},this.commonResetData(this.ownSign),this.setMetaData()},handleConfigTypeChange:function(e){var t=this,a=this.configTypes.find((function(e){return e.value===t.metaData.configType}))||this.configTypes[0];if(this.configApi="1"===this.metaData.totalOnly?this.totalApi:a.api,this.metaData.configType=a.value,this.showTest=!1,this.viewMode=1,this.paramsArr=[],this.intanceList=[],this.collapseValue="filter",this.isList)!0!==e&&this.recoverDefaultKey(["objectIdEditVal"]);else if(!0!==e){this.recoverDefaultKey(["filterArr","orderByArr","pagination"])}},onAlertClose:function(){},handleSwitchViewMode:function(e){if(this.showTest=!1,2===e)this.viewMode=e,this.jsonValueHandler();else if(this.isCorrectJsonValue())this.viewMode=e;else{try{var t,a,i;(null===(t=this.$refs.viewModeRadio)||void 0===t||null===(a=t.$children[0])||void 0===a||null===(i=a.$el)||void 0===i?void 0:i.getElementsByTagName("input")[0]).checked=!1}catch(e){}this.viewMode=2}},getEditValue:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",a=/\$\{(.*?)\}/g,i=a.exec(t);return(null==i?void 0:i[0])===t?{static:"",type:"variable",variable:null===(e=i[1])||void 0===e?void 0:e.split(".")}:{static:t,type:"static",variable:[]}},setCommonParamsKeys:function(e){this.commonParamsKeys=e},getUrlParamsData:function(){var e,t,a,i,n,r,o,l,s,c={};return null!==(e=this.metaData)&&void 0!==e&&null!==(t=e.alarmModel)&&void 0!==t&&null!==(a=t.value)&&void 0!==a&&a.length&&(c.alarmModel=Array.isArray(this.metaData.alarmModel.value)?this.metaData.alarmModel.value.join("::"):this.metaData.alarmModel.value),null!==(i=this.metaData)&&void 0!==i&&null!==(n=i.startTime)&&void 0!==n&&null!==(r=n.value)&&void 0!==r&&r.length&&(c.startTime=this.metaData.startTime.value),null!==(o=this.metaData)&&void 0!==o&&null!==(l=o.endTime)&&void 0!==l&&null!==(s=l.value)&&void 0!==s&&s.length&&(c.endTime=this.metaData.endTime.value),c},refreshUrl:function(e){this.showTest=!1;var t=this.pagination,a=[],i=["fields","containsKey","pagination","dataType","defaultLoad","totalFields"];for(var n in this.commonLinkSet)i.includes(n)?this.editVal[n]=this.commonLinkSet[n]:null!==this.commonLinkSet[n]&&void 0!==this.commonLinkSet[n]&&a.push("".concat(n,"=").concat(this.commonLinkSet[n]));this.projectIdentifier&&a.push("projectIdentifier=".concat(this.projectIdentifier)),"1"!==this.metaData.totalOnly&&(a.push("pagination=".concat(this.commonLinkSet.pagination)),this.commonLinkSet.pagination&&(t.page&&a.push("$page=".concat(t.page)),t.pageSize&&a.push("$pageSize=".concat(t.pageSize))));var r=this.getAllQueryData(!0);if(r&&a.push(r),this.editVal.url=this.configApi+(a.length?"?"+a.join("&"):""),!this.isList){var o=this.metaData.objectIdEditVal.value;o&&(this.editVal.url=this.editVal.url.replace("{id}",o),this.editVal.id=o)}this.showTest||2!==this.viewMode||this.jsonValueHandler()},reverseParams:function(e){var t=this;this.metaData.filterArr=[],this.metaData.orderByArr=[];var a=e.$filter,i=e.$orderBy,n=e.alarmModel,r=e.startTime,o=e.endTime,l=e.$page,s=e.$pageSize,c=e.pagination;(this.metaData.alarmModel=this.getEditValue(n),this.metaData.startTime=this.getEditValue(r),this.metaData.endTime=this.getEditValue(o),this.pagination.page=this.getEditValue(l),this.pagination.pageSize=this.getEditValue(s),this.commonLinkSet.pagination=c,a.length)&&a.split(",").forEach((function(e){var a=t.getFiledByFilterStr(e);a.filter=a.logicExp;var i=t.metaDataKeys.filterArr.find((function(e){return e.name===a.name}));i&&(a.config=Object(d.e)(i.config),a.description=Object(d.e)(i.description),t.metaData.filterArr.push(a))}));if(this.metaDataKeys.filterArr.forEach((function(e){t.metaData.filterArr.findIndex((function(t){return t.name===e.name}))<0&&t.metaData.filterArr.push(Object(d.e)(e))})),i.length){var u=i.split(",").map((function(e){var t=e.trim().split(" ");return{attr:t[0]||"",sort:t[1]||""}})).filter((function(e){var a=t.metaDataKeys.orderByArr.find((function(t){return t.attr===e.attr}));return!!a&&(e.description=a.description,!0)}));this.metaData.orderByArr=u.length?u:[]}this.metaDataKeys.orderByArr.forEach((function(e){t.metaData.orderByArr.findIndex((function(t){return t.attr===e.attr}))<0&&t.metaData.orderByArr.push(Object(d.e)(e))}))},getFilterData:function(){var e="";return this.metaData.filterArr.filter((function(e){return e.name&&e.value&&e.filter})).forEach((function(t,a){var i;e+="".concat(a?",":"").concat(t.name," ").concat(t.filter," ").concat(null!==(i=t.value)&&void 0!==i?i:"")})),{$filter:e}},getOrderData:function(){var e="";return this.metaData.orderByArr.filter((function(e){return e.attr&&e.sort})).forEach((function(t,a){e+="".concat(a?",":"").concat(t.attr," ").concat(t.sort)})),{$orderBy:e}},getAllQueryData:function(e){var t=this.getFilterData(),a="1"!==this.metaData.totalOnly?this.getOrderData():{},i=y(y(y({},this.getUrlParamsData()),t),a);if(e){var n=[];for(var r in i)i[r]&&n.push("".concat(r,"=").concat(i[r]));return n.join("&")}return i},handleTest:function(){if(this.isCorrectJsonValue()){var e=this.getHandlerEditVal();e.requestParams={},this.paramsArr=[];if(this.isList)(this.pagination.page||0===this.pagination.page)&&(e.requestParams.$page=this.pagination.page),(this.pagination.pageSize||0===this.pagination.pageSize)&&(e.requestParams.$pageSize=this.pagination.pageSize);else{var t=this.metaData.objectIdEditVal.value;if(!t)return void this.$message.warning("请配置告警记录id");/\$\{(.*?)\}/g.test(t)&&this.paramsArr.push({name:"id",value:t})}this.configToTest=e,this.showTest=!0}},testChangeField:function(e){this.editVal.fields=e.join(","),this.initCommonLinkSet(this.editVal)},handleTotalColsChange:function(){},beforeTest:function(e,t){return!0},testDialogClose:function(){this.showTest=!1},onParamsChange:function(e){this.refreshUrl()}}},O=(a("4ed8"),a("2877")),T=Object(O.a)(C,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"alarm-link-editor"},[e.showInput?t("el-input",{staticClass:"editor-input",attrs:{placeholder:e.placeholder,value:e.showVal,readonly:"",size:"mini",clearable:""},nativeOn:{click:function(t){return e.handleIconClick.apply(null,arguments)}}},[t("i",{staticClass:"el-input__icon array-editor-icon",class:e.iconClass,attrs:{slot:"suffix"},slot:"suffix"})]):e._e(),t("el-drawer",{ref:"editorDrawer",attrs:{"custom-class":"alarm-link-editor-drawer",size:"1200px",visible:e.dialogVisible,direction:"rtl",wrapperClosable:!1,"append-to-body":!0,"show-close":!1},on:{"update:visible":function(t){e.dialogVisible=t},close:e.close}},[t("div",{staticClass:"editor-drawer-title",attrs:{slot:"title"},slot:"title"},[t("div",{staticClass:"title-text"},[t("iconfont",{attrs:{type:"icon-close"},on:{click:e.close}}),e._v("\n        告警信息配置\n        "),t("a",{directives:[{name:"show",rawName:"v-show",value:e.alarmTipsLoaded&&e.alarmTipsLoaded.description,expression:"alarmTipsLoaded && alarmTipsLoaded.description"}],attrs:{href:e.alarmTipsLoaded.description,target:"_blank"}},[t("i",{staticClass:"el-icon-question"})])],1),t("div",{staticClass:"title-btn"},[t("el-button",{attrs:{size:"small"},on:{click:e.clear}},[e._v(" 清空 ")]),t("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.clickSure}},[e._v("\n          提交\n        ")])],1)]),t("div",{staticClass:"alarm-link-editor-content",attrs:{"comp-uid":e.compUid}},[e.dialogVisible?t("control-common-alert",{staticClass:"api-link-alert",attrs:{show:!e.showCloseTips},on:{showCloseTips:function(t){e.showCloseTips=!0}}},[t("div",{domProps:{innerHTML:e._s(e.alarmTipsLoaded&&e.alarmTipsLoaded.value)}})]):e._e(),t("div",{directives:[{name:"show",rawName:"v-show",value:!e.showTest,expression:"!showTest"}]},[t("el-tabs",{on:{"tab-click":e.handleConfigTypeChange},model:{value:e.metaData.configType,callback:function(t){e.$set(e.metaData,"configType",t)},expression:"metaData.configType"}},e._l(e.configTypes,(function(e){return t("el-tab-pane",{key:e.value,attrs:{label:e.label,name:e.value}})})),1)],1),t("div",{directives:[{name:"show",rawName:"v-show",value:!e.showTest,expression:"!showTest"}],staticClass:"alarm-link-tab-content"},[t("div",{staticClass:"hc-view-switch hc-view-switch-api-link"},[t("div",[t("el-radio-group",{ref:"viewModeRadio",on:{change:e.handleSwitchViewMode},model:{value:e.viewMode,callback:function(t){e.viewMode=t},expression:"viewMode"}},[t("el-radio-button",{attrs:{label:1}},[e._v("普通视图")]),t("el-radio-button",{attrs:{label:2}},[e._v("JSON视图")])],1)],1),t("div",[t("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.showTest,expression:"!showTest"}],attrs:{type:"info"},on:{click:e.handleTest}},[e._v("测 试")])],1)])]),t("div",{staticClass:"editor-content_wrap"},[t("div",{staticClass:"right-content-wrap",class:{"right-content-wrap_full":e.showTest}},[1===e.viewMode?t("div",{directives:[{name:"show",rawName:"v-show",value:!e.showTest,expression:"!showTest"}],staticClass:"hc-view-switch-content"},[e.isList?t("el-collapse",{staticClass:"hc-view-switch-content-collapse",model:{value:e.collapseValue,callback:function(t){e.collapseValue=t},expression:"collapseValue"}},[e._l(e.paramsSettingItems,(function(a){return[!1!==a.visible?t("el-collapse-item",{key:a.id,class:{"filter-collapse-item":"filter"===a.id},attrs:{name:a.id}},[t("template",{slot:"title"},[t("div",{staticClass:"hc-view-switch-content-collapse-title"},[t("div",[t("span",[e._v(" "+e._s(a.label)+" ")]),t("basic-tips",{attrs:{type:"popover",title:"配置说明",width:600,placement:"bottom-start",iconStyle:{color:"#C9D0D4"},content:""}},[t("ul",{staticClass:"basic-tip-content-ul"},e._l(a.tips,(function(a){return t("li",{key:a},[e._v("\n                              "+e._s(a)+"\n                            ")])})),0)])],1),t("div",[e._v("\n                        已配置\n                        "),t("span",{style:{color:e.themeColor}},[e._v(e._s(a.count))]),e._v("\n                        项\n                      ")])])]),"filter"===a.id?t("params-select",{attrs:{showFilterType:"",showDescription:"","operations-layout":"",nameReadonly:"",filterClearable:"",showPublicAdd:!1},on:{change:e.refreshUrl},model:{value:e.metaData.filterArr,callback:function(t){e.$set(e.metaData,"filterArr",t)},expression:"metaData.filterArr"}}):e._e(),"sort"===a.id?t("orderby-setting",{attrs:{attrReadonly:"",sortClearable:"",showDescription:"",descriptionReadonly:"",showPublicAdd:!1,"operations-layout":"top, bottom"},on:{change:e.refreshUrl},model:{value:e.metaData.orderByArr,callback:function(t){e.$set(e.metaData,"orderByArr",t)},expression:"metaData.orderByArr"}}):e._e()],2):e._e()]}))],2):e._e(),t("el-form",{attrs:{"label-width":"120px"}},[e.isList?t("el-form-item",{attrs:{label:"告警模式"}},[t("variable-editor-components",{attrs:{compoundItem:e.compoundItemAlarmModel,options:e.alarmModelOptions,data:e.metaData.alarmModel,args:e.newArgs},on:{change:e.onAlarmModelChange}})],1):e._e(),e.isList?t("el-form-item",{attrs:{label:"开始时间"}},[t("variable-editor-components",{ref:"variableEditor",attrs:{compoundItem:e.compoundItemDatePicker,data:e.metaData.startTime,args:e.newArgs},on:{change:e.onParamsChange}})],1):e._e(),e.isList?t("el-form-item",{attrs:{label:"结束时间"}},[t("variable-editor-components",{ref:"variableEditor",attrs:{compoundItem:e.compoundItemDatePicker,data:e.metaData.endTime,args:e.newArgs},on:{change:e.onParamsChange}})],1):e._e(),e.isList?t("el-form-item",{attrs:{label:"仅查数量"}},[t("label",{attrs:{slot:"label"},slot:"label"},[t("span",[e._v("仅查数量")]),t("basic-tips",{attrs:{type:"popover",title:"配置说明",width:600,placement:"bottom-start",content:""}},[t("ul",{staticClass:"basic-tip-content-ul"},[t("li",[e._v("查询结果仅包含数量信息")]),t("li",[e._v("如开启“返回字段”，则返回{total: 数量}, 否则仅返回数量")])])])],1),t("el-switch",{attrs:{"active-value":"1","inactive-value":"0"},on:{change:e.totalOnlyChange},model:{value:e.metaData.totalOnly,callback:function(t){e.$set(e.metaData,"totalOnly",t)},expression:"metaData.totalOnly"}})],1):e._e(),e.isList?e._e():t("el-form-item",{attrs:{label:"告警记录ID"}},[t("variable-editor-components",{ref:"variableEditor",attrs:{compoundItem:e.compoundItem,data:e.metaData.objectIdEditVal,args:e.newArgs},on:{change:e.onParamsChange}})],1),t("common-link-set",{attrs:{config:e.commonLinkSet,data:e.data,"show-tips":!1,hiddenConfig:{pagination:!e.isList||"1"===e.metaData.totalOnly,containsKey:!e.isList,fields:e.isList&&"1"===e.metaData.totalOnly},emitChangeFiled:["containsKey","defaultLoad","fieldsArr","pagination"]},on:{change:e.refreshUrl}},[t("template",{slot:"pagination"},[t("pagination-setting",{directives:[{name:"show",rawName:"v-show",value:e.commonLinkSet.pagination&&e.isList,expression:"commonLinkSet.pagination && isList"}],ref:"paginationSetting",staticClass:"hc-view-switch-content-pagination",on:{change:e.refreshUrl},model:{value:e.pagination,callback:function(t){e.pagination=t},expression:"pagination"}})],1)],2)],1)],1):e._e(),t("div",{directives:[{name:"show",rawName:"v-show",value:!e.showTest&&2===e.viewMode,expression:"!showTest && viewMode === 2"}],staticClass:"hc-view-switch-content-json"},[t("base-code-editor",{ref:"codeEditorJSON",attrs:{params:e.codeJSONOptions,value:e.jsonValue,height:"100%"},on:{blur:e.codeEditorJSONBlur}})],1),t("div",{staticClass:"api-test-panel-wrap"},[e.showTest?t("api-test-panel",{ref:"apiTestPanel",attrs:{"origin-config":e.configToTest,payload:[],paramsArr:e.paramsArr,filterArr:e.metaData.filterArr,orderByArr:e.metaData.orderByArr,pagination:e.pagination,isPagination:!(!e.commonLinkSet.pagination||!e.isList),fields:e.commonLinkSet.fields,dataType:e.data.type,beforeTest:e.beforeTest},on:{totalColsChange:e.handleTotalColsChange,changeFields:e.testChangeField,close:e.testDialogClose}}):e._e()],1)])])],1)])],1)}),[],!1,null,null,null);t.default=T.exports},"91e4":function(e,t,a){},"91ff":function(e,t,a){"use strict";a("55dd");var i=(a("a481"),a("75fc")),n=(a("28a5"),a("7f7f"),a("ac6a"),a("c276")),r=a("b19c"),o=function(e){var t={};for(var a in e){var i=e[a];"name"===a?t.name=Object(n.pb)(i.value,i.default):"alias"===a?t.alias=Object(n.pb)(i.value,i.default):"description"===a?t.description=Object(n.pb)(i.value,i.default):"editor"===a&&(t.editor=Object(n.pb)(i.value,i.default))}return t},l={name:"OrderbySelect",props:{value:{type:Array,default:function(){return[{attr:"",sort:"",description:""}]}},attrReadonly:{type:Boolean,default:!1},isShowDeleteConfirm:{type:Boolean,default:!1},sortClearable:{type:Boolean,default:!1},showDescription:{type:Boolean,default:!1},descriptionReadonly:{type:Boolean,default:!1},showPublicAdd:{type:Boolean,default:!0},operationsLayout:{type:[Array,String],default:"top, bottom, del, clear"}},created:function(){this.payloads=this.value},watch:{value:function(e,t){this.payloads=this.value}},data:function(){return{changed:!0,filterTypes:[{label:"升序",value:"asc"},{label:"降序",value:"desc"}],payloads:[{attr:"",sort:"asc",description:""}],dialogVisible:!1}},methods:{getPayloads:function(e){var t=[];if("array"===Object(r.g)(e))e.forEach((function(e){if(!t.length){var a="payload"===e.name?e.attributes:e.payload?e.payload.attributes:null;a&&a.forEach((function(e){var a=o(e);t.push(a)}))}}));else if("object"===Object(r.g)(e))for(var a in e)if("payload"===a){e[a].attributes.forEach((function(e){var a=o(e);t.push(a)}))}return t},handleEvents:function(e,t){var a=this,i=this.payloads.length;if("add"===e)return i>n.a.MAX_LENGTH_ADD?void this.$message({message:"最多添加"+n.a.MAX_LENGTH_ADD+"项！",type:"warning"}):(this.payloads.push({name:"",value:"",filter:"",editValue:null,sort:"asc",description:""}),void this.emitChange());if("del"===e)return this.isShowDeleteConfirm&&!this.payloads[t].attr?(this.emitChange(),void this.payloads.splice(t,1)):void this.$confirm("确定要删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){a.emitChange(),a.payloads.splice(t,1)})).catch((function(){}));if("top"===e){if(0===t)return;var r=this.payloads.splice(t,1);return this.payloads.splice(t-1,0,r[0]),void this.emitChange()}if("bottom"===e){if(t===i-1)return;var o=this.payloads.splice(t,1);this.payloads.splice(t+1,0,o[0]),this.emitChange()}"clear"===e&&this.emitChange()},importVariable:function(){var e=this;this.$confirm("导入页面变量会清空已有配置，你确定要导入吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var t=Object(n.ab)(e.pageInfo.page.attributes.customVariable);t?(e.payloads=[],e.handleImportVariable(t)):e.$message.warning("页面未定义自定义变量!")})).catch((function(){}))},handleImportVariable:function(e,t){for(var a in e){var i=e[a],n=t?t+"."+a:a;"object"===Object(r.g)(i)&&this.handleImportVariable(i,n);var o={name:n,value:"${"+n+"}",filter:"",editValue:{type:"variable",static:"",variable:this.getEditValueVariable(n)}};this.payloads.push(o)}},getEditValueVariable:function(e){if(!e)return[];var t=[];return e.split(".").forEach((function(e){t.push(e)})),t},variableOnChange:function(e){this.emitChange()},onNameChange:function(){this.emitChange()},onFilterChanged:function(){this.emitChange()},emitChange:function(){this.$emit("input",this.payloads),this.$emit("change",this.payloads)}},computed:{themeStyles:function(){return{target:"th,td",style:{"border-width":Object(n.nb)("borderWidth"),"border-style":Object(n.nb)("borderStyle"),"border-color":Object(n.nb)("borderColor"),padding:"0 5px"}}},theadStyles:function(){return{"background-color":Object(n.nb)("middleBackgroundColor")}},pageInfo:function(){var e=this.$store.getters.pageEditor;return e.pagesKV[e.pagesActiveName]},newArgs:function(){if(this.args&&this.args.length)return Object(i.a)(this.args);var e=this.getPayloads(this.parent&&this.parent.attributes);return e.length>0?e:(e=this.getPayloads(this.parentParent&&this.parentParent.attributes)).length>0?e:[]},operationsLayout$:function(){var e=this.operationsLayout;return"string"==typeof e&&e&&(e=(e=e.replace(/\s/g,"")).split(",")),e||[]}}},s=(a("4e58"),a("2877")),c=Object(s.a)(l,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"orderby-setting"},[t("table",{directives:[{name:"theme",rawName:"v-theme",value:e.themeStyles,expression:"themeStyles"}],staticClass:"hc-editor-payload-table"},[t("thead",{staticClass:"hc-editor-payload-table-thead",style:e.theadStyles},[t("tr",[t("th",[e._v("参数名")]),t("th",{attrs:{width:"32%"}},[e._v("过滤类型")]),e.showDescription?t("th",{attrs:{width:"20%"}},[e._v("描述")]):e._e(),t("th",{attrs:{width:"20%"}},[e._v("操作")])])]),t("tbody",{staticClass:"hc-editor-payload-table-tbody"},e._l(e.payloads,(function(a,i){return t("tr",{key:i},[t("td",[t("el-input",{class:{readonly:e.attrReadonly},attrs:{size:"mini",readonly:e.attrReadonly,placeholder:"请输入参数名",clearable:""},on:{blur:e.onNameChange},model:{value:a.attr,callback:function(t){e.$set(a,"attr",t)},expression:"param.attr"}})],1),t("td",[t("el-select",{staticStyle:{width:"100%"},attrs:{clearable:e.sortClearable,size:"mini",placeholder:"请选择"},on:{change:e.onFilterChanged},model:{value:a.sort,callback:function(t){e.$set(a,"sort",t)},expression:"param.sort"}},e._l(e.filterTypes,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),e.showDescription?t("td",[t("el-input",{class:{readonly:e.descriptionReadonly},attrs:{readonly:e.descriptionReadonly,size:"mini",placeholder:""},model:{value:a.description,callback:function(t){e.$set(a,"description",t)},expression:"param.description"}})],1):e._e(),t("td",{staticClass:"hc-payload-operation",attrs:{align:"center"}},[t("CommonTableMoveOprate",{attrs:{data:e.payloads,layout:e.operationsLayout$,index:i,icon:!1,text:!0},on:{click:e.handleEvents}})],1)])})),0)]),e.showPublicAdd?t("div",{staticClass:"params-add-btn"},[t("el-button",{attrs:{title:"新增",icon:"el-icon-plus",plain:""},on:{click:function(t){return e.handleEvents("add")}}},[e._v("添加参数")])],1):e._e()])}),[],!1,null,"49625a36",null);t.a=c.exports},9217:function(e,t,a){"use strict";a("bff0")},9224:function(e){e.exports=JSON.parse('{"name":"inovance-webtools-page","version":"1.5.163","private":false,"scripts":{"serve":"vue-cli-service serve","build":"vue-cli-service build","lib":"cross-env webpack --config build/webpack.lib.config.js --mode none","view":"cross-env webpack --config build/webpack.view.config.js --mode production","viewDev":"cross-env BUILD_MODE=dev webpack --config build/webpack.view.config.js --mode none","editor":"cross-env webpack --config build/webpack.editor.config.js --mode production","editor_mvp3":"cross-env webpack --config build/webpack.editor.mvp3.config.js --mode production","editorDev":"cross-env BUILD_MODE=dev webpack --config build/webpack.editor.config.js --mode production","comp-cli":"cross-env webpack --config build/webpack.comp-cli.config.js --mode production"},"main":"lib/index.js","dependencies":{"@riophae/vue-treeselect":"^0.4.0","axios":"^0.18.0","element-ui":"^2.15.9","html2canvas":"^1.4.1","moment":"^2.29.1","url-parse":"^1.5.10","vant":"^2.12.48","vue":"^2.6.10","vue-bus":"^1.2.1","vue-i18n":"^8.7.0","vue-resizable":"^2.0.5","vue-router":"^3.0.1","vuedraggable":"^2.24.3","vuex":"^3.1.1"},"devDependencies":{"@babel/core":"^7.4.5","@babel/plugin-proposal-nullish-coalescing-operator":"^7.14.5","@babel/plugin-proposal-object-rest-spread":"^7.4.4","@babel/plugin-proposal-optional-chaining":"^7.14.5","@babel/plugin-transform-runtime":"^7.4.4","@babel/preset-env":"^7.4.5","@vue/cli-plugin-babel":"^3.1.1","@vue/cli-plugin-eslint":"^3.1.5","@vue/cli-service":"^3.1.4","@vue/eslint-config-standard":"4.0.0","babel-eslint":"^8.2.6","babel-loader":"^8.0.6","babel-polyfill":"^6.26.0","babel-preset-mobx":"^2.0.0","cache-loader":"^4.1.0","classlist-polyfill":"^1.2.0","clean-webpack-plugin":"^4.0.0","cross-env":"^7.0.3","cross-var":"^1.1.0","css-loader":"^0.28.7","eslint":"5.16.0","eslint-config-standard":"4.0.0","eslint-plugin-html":"5.0.0","eslint-plugin-vue":"5.2.3","extract-text-webpack-plugin":"^4.0.0-beta.0","file-loader":"^6.2.0","gulp":"^4.0.2","gulp-zip":"^5.1.0","html-webpack-plugin":"^2.30.1","inovance-platform-framework":"^1.5.42","mini-css-extract-plugin":"^1.6.2","node-gyp":"^5.0.6","node-sass":"^4.14.1","nprogress":"^0.2.0","optimize-css-assets-webpack-plugin":"^6.0.1","portfinder":"^1.0.23","postcss-loader":"^4.2.0","sass-loader":"^7.3.1","sass-resources-loader":"^2.2.1","script-loader":"^0.7.2","style-loader":"^0.19.0","through2":"^4.0.2","vue-codemirror":"^4.0.6","vue-loader":"^15.9.8","vue-style-loader":"^4.1.3","vue-template-compiler":"^2.5.17","webpack":"^4.46.0","webpack-bundle-analyzer":"^3.0.3","webpack-cli":"^4.8.0"},"lint-staged":{"*.js":["vue-cli-service lint","git add"],"*.vue":["vue-cli-service lint","git add"]}}')},9262:function(e,t,a){},"93c5":function(e,t,a){"use strict";a.r(t);var i=(a("ac6a"),a("75fc")),n=(a("c5f6"),a("36f0")),r=a("b19c"),o={name:"ObjectLinkEditor1",visible:function(e){return 2!==e},mixins:[n.a],props:{visible:{type:String,default:function(){return!1}},showInput:{type:String,default:function(){return!0}},iconClass:{type:String,default:function(){return"el-icon-edit"}},data:{type:Object,default:function(){return{alias:"",type:"",default:"",value:"",primitiveLabels:""}}},placeholder:{type:String,default:""},autoSetValue:{type:Boolean,default:!0},linkType:{type:Number,default:function(){return 1}},handleRulesResult:{type:Function,default:function(){}},handleChangeResult:{type:Function,default:function(){}}},data:function(){var e="object";return{profilesFetchOption:{url:"/api/model/profiles",params:{pagination:0,lazyLoad:0,parentId:1,$filter:"classification eq 'default'"}},profilesRootNode:{id:"1",localName:"/"},profilesProps:{label:"localName"},propertyList:[],viewMode:1,showVal:"",collectTime:"",accessType:e,editVal:{accessType:e,linkType:this.linkType,url:"/api/model/instances?",method:"get",contentType:"application/json",objectType:"",profilesId:"",fields:"",isRtData:!1,instanceInfo:{},requestPayload:{instanceId:""},responseSchema:{},exceptionStrategy:"throw"},jsonValue:"{}",codeValue:"{}",responseSchema:"{}",codeOptions:{},codeJSONOptions:{},dialogVisible:this.visible,fetchProps:{value:"id",label:"propertyLocalName"},instanceColumns:[],instanceFetchProps:{value:"id",label:"name"},baseInstanceColumns:[{prop:"name",label:"名称",show:!0,filter:{type:"input",operator:"="}},{prop:"identifier",label:"标识",show:!0,filter:{type:"input",operator:"="}},{prop:"updateUser",label:"修订者",show:!0},{prop:"createTime",label:"修订时间",show:!0}]}},computed:{propertiesColumns:function(){return[{prop:"propertyIdentifier",label:"属性标识",show:!0,filter:{type:"input",operator:"="}},{prop:"propertyName",label:"属性名称",show:!0,width:"200",filter:{type:"input",operator:"="}},{prop:"propertyLocalName",label:"本地名",show:!0},{prop:"createTime",label:"修订者",show:!0},{prop:"updateUser",label:"修订时间",show:!0}]},fetchOption:function(){return{url:"/api/model/profiles/".concat(this.editVal.profilesId,"/properties")}},fetchInfoOption:function(){return{url:"/api/model/profiles/".concat(this.editVal.profilesId,"/properties/").concat(this.editVal.propertyId)}},instanceFetchOption:function(){return{url:"/api/model/instances",params:{objectType:this.editVal.objectType,pagination:1,queryMode:"simple"}}},instanceFetchInfoOption:function(){return{url:"/api/model/instances/".concat(this.editVal.requestPayload.instanceId)}},rules:function(){return{"requestPayload.instanceId":[{required:!0,message:"请选择",trigger:"change"}],profilesId:[{required:!0,message:"请选择",trigger:"blur"}]}}},watch:{"data.value":function(){this.initData()},visible:function(e){this.dialogVisible=e,e&&this.initData()}},created:function(){this.initData(),this.getProfileProperty(),this.getProfilesById()},methods:{changeProfiles:function(){this.getProfileProperty(),this.getProfilesById(),this.editVal.requestPayload.instanceId="",this.editVal.fields=""},getProfilesById:function(){var e=this,t={url:"/api/model/profiles/".concat(this.editVal.profilesId),method:"get"};this.$util.request(t).then((function(t){e.editVal.objectType=t.identifier})).catch((function(e){}))},getProfileProperty:function(){var e=this,t={url:"/api/model/profiles/".concat(this.editVal.profilesId,"/properties?$filter=status eq 1&inherit=custom&pagination=0"),method:"get"};this.$util.request(t).then((function(t){var a=t.filter((function(e){return 1===e.status})),n=[];e.propertyList=a;var r={url:"/api/model/profiles/".concat(e.editVal.profilesId,"/properties?$filter=status eq 1&inherit=extend&pagination=0"),method:"get"};e.$util.request(r).then((function(t){var a=t.filter((function(e){return 1===e.status}));e.propertyList=[].concat(Object(i.a)(e.propertyList),Object(i.a)(a))})),a.forEach((function(e){var t={prop:e.propertyIdentifier,label:e.propertyLocalName,show:!0};n.push(t)})),e.instanceColumns=[].concat(Object(i.a)(e.baseInstanceColumns),n)})).catch((function(e){}))},onPropertyIdChange:function(e,t){this.editVal.requestPayload.instanceId=e,this.editVal.instanceInfo=t},handleSelectorTableBeforeClose:function(){this.$refs.selectorTable&&this.$refs.selectorTable.$refs.filter&&this.$refs.selectorTable.$refs.filter.handleFilterReset()},handleSwitchViewMode:function(e){this.viewMode=e,2===e&&(this.jsonValue=Object(r.b)(this.editVal))},codeEditorBlur:function(e){this.codeValue=e,this.editVal.requestPayload=Object(r.j)(e)},codeEditorJSONBlur:function(e){this.editVal=Object(r.j)(e),this.codeValue=Object(r.b)(this.editVal.requestPayload)},handleSelectorFocus:function(e){this.$refs[e]&&this.$refs[e].onPopoverHide&&this.$refs[e].onPopoverHide()},initData:function(){this.commonInitData(this.accessType)},resetData:function(){this.showVal="",this.editVal={rtDataType:1,accessType:this.accessType,linkType:this.linkType,url:"/api/model/instances?",method:"get",contentType:"application/json",fields:"",dataType:"",requestPayload:{instanceId:""},responseSchema:{},exceptionStrategy:"throw"},this.codeValue="{}",this.jsonValue="{}",this.commonResetData()},focusCodeEditor:function(){this.$refs.codeEditor&&this.$refs.codeEditor.setMethod("focus")},handleIconClick:function(){this.open()},open:function(){this.$setAttr(this.data,"editorDialogVisible",!0),this.dialogVisible=!0},close:function(){this.closeHandler(this.accessType)},clear:function(){this.clearByType(this.accessType)},cancel:function(){this.close()},handleCurrentChange:function(e){this.currentRow=e,this.editVal.url=e.id},getShowVal:function(){return Object(r.b)(this.editVal)},clickSure:function(){var e=this;this.$refs.form.validate((function(t){t&&e.commonSureHandler(e.accessType)}))},getHandlerEditVal:function(){var e=Object(r.e)(this.editVal);if(e.responseSchema||(e.responseSchema={}),this.editVal.isRtData){var t=this.editVal.instanceInfo,a=this.commonLinkSet.fields;e.url="/api/realtimedata/records?instanceId=".concat(t[a],"&queryMode=2")}else e.url="/api/model/instances/".concat(this.editVal.requestPayload.instanceId,"?queryMode=simple");return e.variables=this.getVariables(e),e},getVariables:function(e){var t=this.getVariableNames(e.url),a=this.getVariableNames(e.requestPayload),n=this.getVariableNames(e.responseSchema);return this.formatVariables([].concat(Object(i.a)(t),Object(i.a)(a),Object(i.a)(n)))},validate:function(){return""===this.editVal.profilesId?"请选择对象类型":""!==this.editVal.requestPayload.instanceId||"请选择对象实例"}}},l=(a("e260"),a("2877")),s=Object(l.a)(o,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"rtdata-link-editor"},[e.showInput?t("el-input",{staticClass:"editor-input",attrs:{placeholder:e.placeholder,value:e.showVal,readonly:"",size:"mini",clearable:""},nativeOn:{click:function(t){return e.handleIconClick.apply(null,arguments)}}},[t("i",{staticClass:"el-input__icon array-editor-icon",class:e.iconClass,attrs:{slot:"suffix"},slot:"suffix"})]):e._e(),t("el-dialog",{staticClass:"rtdata-link-editor-dialog",attrs:{visible:e.dialogVisible,"close-on-click-modal":!1,title:"对象数据关联配置",width:"800px","append-to-body":!0},on:{close:e.close}},[t("div",{staticClass:"hc-view-switch-content"},[t("el-form",{ref:"form",attrs:{"label-width":"210px",model:e.editVal,rules:e.rules}},[t("el-form-item",{attrs:{label:"对象类型：",prop:"profilesId"}},[t("selector-tree",{ref:"objectSelectTree",attrs:{fetchOption:e.profilesFetchOption,"root-node":e.profilesRootNode,props:e.profilesProps,placeholder:"请选择"},on:{change:e.changeProfiles},model:{value:e.editVal.profilesId,callback:function(t){e.$set(e.editVal,"profilesId",t)},expression:"editVal.profilesId"}})],1),t("el-form-item",{attrs:{label:"对象实例：",prop:"requestPayload.instanceId"}},[t("selector-table",{ref:"selectorTable",attrs:{title:"请选择",dialogWidth:"1200px",fetchOption:e.instanceFetchOption,fetchInfoOption:e.instanceFetchInfoOption,column:e.instanceColumns,defaultValueSearch:!0,props:e.instanceFetchProps},on:{change:e.onPropertyIdChange,"before-close":e.handleSelectorTableBeforeClose},model:{value:e.editVal.requestPayload.instanceId,callback:function(t){e.$set(e.editVal.requestPayload,"instanceId",t)},expression:"editVal.requestPayload.instanceId"}})],1),t("el-form-item",{attrs:{label:"属性字段："}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.commonLinkSet.fields,callback:function(t){e.$set(e.commonLinkSet,"fields",t)},expression:"commonLinkSet.fields"}},e._l(e.propertyList,(function(e){return t("el-option",{key:e.propertyName,attrs:{label:e.propertyLocalName,value:e.propertyName}})})),1)],1),t("exception-strategy",{model:{value:e.editVal.exceptionStrategy,callback:function(t){e.$set(e.editVal,"exceptionStrategy",t)},expression:"editVal.exceptionStrategy"}}),t("response-schema",{attrs:{visible:e.dialogVisible,value:e.responseSchema},on:{blur:e.responseSchemaBlur}}),t("el-form-item",{attrs:{label:"是否实时数据："}},[t("el-switch",{attrs:{"active-value":1,"inactive-value":0},model:{value:e.editVal.isRtData,callback:function(t){e.$set(e.editVal,"isRtData",t)},expression:"editVal.isRtData"}})],1),t("common-link-set",{attrs:{config:e.commonLinkSet,data:e.data,defaultLoad:e.defaultLoad,hiddenConfig:{fields:!0,containsKey:!0}}})],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"danger"},on:{click:e.clear}},[e._v("清 空")]),t("el-button",{on:{click:e.cancel}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.clickSure}},[e._v("确 定")])],1)])],1)}),[],!1,null,null,null);t.default=s.exports},9400:function(e,t,a){"use strict";a.r(t);var i=(a("ac6a"),a("c276")),n=a("b19c"),r={name:"RowEditor",props:{title:{type:String,default:function(){return"行设置"}},showInput:{type:String,default:function(){return!0}},iconClass:{type:String,default:function(){return"el-icon-edit"}},parentParent:{type:Object,default:function(){return{}}},parent:{type:Object,default:function(){return{}}},data:{type:Object,default:function(){return{}}},placeholder:{type:String,default:""},handleRulesResult:{type:Function,default:function(){}},handleChangeResult:{type:Function,default:function(){}}},watch:{"data.value":function(){this.initData()},dialogVisible:function(e){e&&this.initData()}},data:function(){return{showVal:"",copayEditVal:{type:"row",count:1,row:[{height:1}]},editVal:{type:"row",count:1,row:[{height:1}]},dialogVisible:!1}},computed:{themeStyles:function(){return{target:"th,td",style:{"border-width":Object(i.nb)("borderWidth"),"border-style":Object(i.nb)("borderStyle"),"border-color":Object(i.nb)("borderColor"),padding:"0 5px"}}},theadStyles:function(){return{"background-color":Object(i.nb)("middleBackgroundColor")}},pageInfo:function(){var e=this.$store.getters.pageEditor;return e.pagesKV[e.pagesActiveName]}},created:function(){this.initData()},methods:{initData:function(){var e=Object(i.pb)(this.data.editValue,this.data.default);e&&"row"===e.type&&(this.editVal=Object(n.e)(e),this.copayEditVal=Object(n.e)(this.data.default),this.showVal=this.getShowVal())},handleIconClick:function(){this.open()},handleChangeCount:function(e,t){var a=this,i=this.editVal.row.length;if(e>24)return this.$message({message:"最多添加24项！",type:"warning"}),void(this.editVal.count=t);e!==i&&(e<i?this.$confirm("确定要删减已有设置吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){a.handleDel(e,i-e)})).catch((function(){a.editVal.count=t})):this.handleAdd(i,e-i))},handleEvents:function(e,t){var a=this,i=this.editVal.row,n=i.length;if("add"===e)return n>24?void this.$message({message:"最多添加24项！",type:"warning"}):(this.handleAdd(n,1),void(this.editVal.count=i.length));if("del"!==e)if("top"!==e){if("bottom"===e){if(t===n-1)return;var r=i.splice(t,1);i.splice(t+1,0,r[0])}}else{if(0===t)return;var o=i.splice(t,1);i.splice(t-1,0,o[0])}else this.$confirm("如果该行有子组件将一并删除，确定要删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){a.handleDel(t,1),a.editVal.count=i.length})).catch((function(){}))},handleAdd:function(e,t){for(var a=0;a<t;)this.editVal.row.splice(e,0,{id:Object(i.ob)(),height:1}),a++;this.resetRowItem()},handleDel:function(e,t){this.editVal.row.splice(e,t),this.resetRowItem()},resetRowItem:function(){var e=this;this.editVal.row.forEach((function(t){t.height=100/e.editVal.row.length}))},open:function(){this.dialogVisible=!0},close:function(){this.dialogVisible=!1},cancel:function(){this.close()},clear:function(){var e=this;this.$confirm("确定要清空相关设置吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.showVal="",e.editVal=Object(n.e)(e.copayEditVal),e.$removeAttr(e.data,"value"),e.$removeAttr(e.data,"lastValue"),e.$removeAttr(e.data,"editValue"),e.close()})).catch((function(){}))},getShowVal:function(){return this.editVal.count||1},clickSure:function(){var e=this.validate();!0===e?(this.showVal=this.getShowVal(),!1!==this.handleChangeResult(this.showVal,this.data)?(this.$setAttr(this.data,"value",this.showVal),this.$setAttr(this.data,"lastValue",this.showVal),this.$setAttr(this.data,"editValue",this.getEditValue()),this.$emit("onSure",this.showVal,this.getEditValue(),this.data),this.dialogVisible=!1):this.$setAttr(this.data,"lastValue",this.data.lastValue)):this.$message.warning(e)},getEditValue:function(){return Object(n.e)(this.editVal)},validate:function(){return!0}}},o=(a("3f89"),a("2877")),l=Object(o.a)(r,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"hc-attr-editor hc-attr-editor-row"},[e.showInput?t("el-input",{staticClass:"hc-attr-editor-input",attrs:{placeholder:e.placeholder,value:e.showVal,readonly:"",size:"mini",clearable:""},nativeOn:{click:function(t){return e.handleIconClick.apply(null,arguments)}}},[t("i",{staticClass:"el-input__icon hc-attr-editor-icon",class:e.iconClass,attrs:{slot:"suffix"},slot:"suffix"})]):e._e(),t("el-dialog",{staticClass:"hc-attr-editor-dialog hc-attr-editor-dialog-row",attrs:{draggable:!0,visible:e.dialogVisible,"close-on-click-modal":!1,title:e.title,width:"60%","append-to-body":!0},on:{close:e.close}},[t("div",{staticClass:"hc-attr-editor-content"},[t("el-form",{staticClass:"hc-attr-editor-form",attrs:{"label-width":"110px"},model:{value:e.editVal,callback:function(t){e.editVal=t},expression:"editVal"}},[t("el-form-item",{attrs:{label:"行数"}},[t("el-input-number",{attrs:{size:"mini","controls-position":"right",min:1,max:24},on:{change:e.handleChangeCount},model:{value:e.editVal.count,callback:function(t){e.$set(e.editVal,"count",t)},expression:"editVal.count"}})],1),t("el-form-item",{attrs:{label:"行属性"}},[t("table",{directives:[{name:"theme",rawName:"v-theme",value:e.themeStyles,expression:"themeStyles"}],staticClass:"hc-editor-payload-table"},[t("thead",{staticClass:"hc-editor-payload-table-thead",style:e.theadStyles},[t("tr",[t("th",{attrs:{width:"20%"}},[e._v("行名称")]),t("th",[e._v("行高度 (%)")]),t("th",{attrs:{width:"18%"}},[e._v("操作")])])]),t("tbody",{staticClass:"hc-editor-payload-table-tbody"},e._l(e.editVal.row,(function(a,i){return t("tr",{key:i},[t("td",{attrs:{align:"center"}},[e._v("第"+e._s(i+1)+"行")]),t("td",[t("el-input-number",{staticStyle:{width:"100%"},attrs:{size:"mini","controls-position":"right",min:1,max:100},model:{value:a.height,callback:function(t){e.$set(a,"height",t)},expression:"row.height"}})],1),t("td",{staticClass:"hc-payload-operation",attrs:{align:"center"}},[t("el-button",{attrs:{title:"上移",disabled:0===i,size:"mini",icon:"el-icon-top",plain:""},on:{click:function(t){return e.handleEvents("top",i)}}}),t("el-button",{attrs:{title:"下移",disabled:i===e.editVal.row.length-1,size:"mini",icon:"el-icon-bottom",plain:""},on:{click:function(t){return e.handleEvents("bottom",i)}}}),t("el-button",0===i?{attrs:{title:"新增",size:"mini",icon:"el-icon-plus",plain:""},on:{click:function(t){return e.handleEvents("add",i)}}}:{attrs:{title:"删除",size:"mini",type:"danger",plain:"",icon:"el-icon-minus"},on:{click:function(t){return e.handleEvents("del",i)}}})],1)])})),0)])])],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"danger"},on:{click:e.clear}},[e._v("清 空")]),t("el-button",{on:{click:e.cancel}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.clickSure}},[e._v("确 定")])],1)])],1)}),[],!1,null,null,null);t.default=l.exports},9407:function(e,t,a){"use strict";a("3958")},"973a":function(e,t,a){"use strict";a("0f34")},"975a":function(e,t,a){"use strict";a("5dda")},"981a":function(e,t,a){},9831:function(e,t,a){"use strict";a("b468")},"987c":function(e,t,a){"use strict";a("0d14")},"98b1":function(e,t,a){"use strict";a("49cc")},9921:function(e,t,a){"use strict";a("1ad7")},"997d":function(e,t,a){},"99a8":function(e,t,a){"use strict";a.r(t);var i=(a("7514"),a("ac6a"),a("7f7f"),a("75fc")),n=a("c276"),r=a("b19c"),o=function(e){var t={};for(var a in e){var i=e[a];"name"===a?t.name=Object(n.pb)(i.value,i.default):"alias"===a?t.alias=Object(n.pb)(i.value,i.default):"description"===a?t.description=Object(n.pb)(i.value,i.default):"editor"===a&&(t.editor=Object(n.pb)(i.value,i.default))}return t},l={name:"ScriptEditor",props:{title:{type:String,default:function(){return"执行脚本设置"}},iconClass:{type:String,default:function(){return"el-icon-edit"}},args:{type:Array,default:function(){return[]}},parentParent:{type:Object,default:function(){return{}}},parent:{type:Object,default:function(){return{}}},data:{type:Object,default:function(){return{}}},params:{type:Object,default:function(){return{}}},placeholder:{type:String,default:""},handleRulesResult:{type:Function,default:function(){}},handleChangeResult:{type:Function,default:function(){}}},watch:{"data.value":function(e,t){this.initData()},dialogVisible:function(e){e&&this.initData()}},data:function(){return{codeOptions:{language:"text/javascript"},showVal:"",copayEditVal:{type:"script",content:""},editVal:{type:"script",content:""},dialogVisible:!1,fullscreen:!1,codeDefaultHeight:300,codeHeight:300}},computed:{currentPage:function(){var e=this.$store.getters.pageEditor;return e.pagesKV[e.pagesActiveName]},activeComponent:function(){var e,t,a=null===(e=this.currentPage)||void 0===e?void 0:e.activeComponentFid;return null===(t=this.currentPage)||void 0===t?void 0:t.componentKV[a]},payloads:function(){var e,t,a;null!==(e=this.data)&&void 0!==e&&e.componentFid&&this.data.componentFid!==this.activeComponent.fid&&(t=this.currentPage.componentKV[null===(a=this.data)||void 0===a?void 0:a.componentFid]);var n=this.getCurrentItemVars(t),r=this.getIterationVars(t);if(this.args&&this.args.length)return[].concat(Object(i.a)(this.args),Object(i.a)(r),Object(i.a)(n));if(this.params&&this.params.args&&this.params.args.length)return[].concat(Object(i.a)(this.params.args),Object(i.a)(r),Object(i.a)(n));var o=this.getPayloads(this.parent&&this.parent.attributes);return o.length>0?[].concat(Object(i.a)(o),Object(i.a)(r),Object(i.a)(n)):(o=this.getPayloads(this.parentParent&&this.parentParent.attributes)).length>0?[].concat(Object(i.a)(o),Object(i.a)(r),Object(i.a)(n)):[].concat(Object(i.a)(r),Object(i.a)(n))},payloadNames:function(){return this.payloads&&this.payloads.length?this.payloads.map((function(e){return(null==e?void 0:e.label)||(null==e?void 0:e.name)})).join(", "):""}},created:function(){this.initData()},methods:{getCurrentItemVars:function(e){var t,a,i,n,r=this;if(null!=this&&null!==(t=this.params)&&void 0!==t&&t.isManual)return[];if(!(e=e||this.activeComponent))return[];if("Grid"===e.name){var o,l,s,c,u,d,p=null===(o=e)||void 0===o||null===(l=o.attributes)||void 0===l||null===(s=l.cols)||void 0===s?void 0:s.attributes,h=!1,f=null;if((p||[]).forEach((function(e){var t,a,i,n;if(null!=e&&null!==(t=e.iterationMode)&&void 0!==t&&t.hasOwnProperty("value")?null==e||null===(a=e.iterationMode)||void 0===a?void 0:a.value:null==e||null===(i=e.iterationMode)||void 0===i?void 0:i.default){var o=(e.blockClick.attributes||[]).find((function(e){return e.executionContent===r.data})),l=((null==e||null===(n=e.blockToolbar)||void 0===n?void 0:n.attributes)||[]).find((function(e){return(e.blockToolbarContent.attributes||[]).find((function(e){return e.executionContent===r.data}))}));(o||l)&&(h=!0,f=e)}})),h){var m,v,b,g,y,_,C,O,T=null===(m=f)||void 0===m||null===(v=m.iterationNodeAttr)||void 0===v?void 0:v.value,V=null!==(b=f)&&void 0!==b&&null!==(g=b.span)&&void 0!==g&&g.hasOwnProperty("value")?null===(y=f)||void 0===y||null===(_=y.span)||void 0===_?void 0:_.value:null===(C=f)||void 0===C||null===(O=C.span)||void 0===O?void 0:O.default;return this.getItemVariables(e,T,V)}var w=null===(c=e)||void 0===c||null===(u=c.attributes)||void 0===u||null===(d=u.foreachItemAttr)||void 0===d?void 0:d.value;return w?this.getItemVariables(e,w):[]}var P=null===(a=e)||void 0===a||null===(i=a.attributes)||void 0===i||null===(n=i.foreachItemAttr)||void 0===n?void 0:n.value;return P?this.getItemVariables(e,P):[]},getIterationVars:function(e){var t,a,i;if(null!=this&&null!==(t=this.params)&&void 0!==t&&t.isManual)return[];var n=this.currentPage;if(!e){var r=n.activeComponentFid;e=n.componentKV[r]}var o=null===(a=e)||void 0===a?void 0:a.parentFid;if(!o)return[];var l=n.componentKV[o];if("block"===(null==l?void 0:l.name)){var s,c,u,d,p,h=n.componentKV[l.parentFid],f=null==h||null===(s=h.attributes)||void 0===s||null===(c=s.cols)||void 0===c?void 0:c.attributes;if(!f||!f.length)return this.getIterationVars(l);var m=null==f?void 0:f.find((function(e){return e.colId.value===l.colId&&e.rowId.value===l.rowId}));if(!m)return this.getIterationVars(l);if(null!=m&&null!==(u=m.iterationMode)&&void 0!==u&&u.hasOwnProperty("value")?null==m||null===(d=m.iterationMode)||void 0===d?void 0:d.value:null==m||null===(p=m.iterationMode)||void 0===p?void 0:p.default){var v,b,g,y,_=n.componentKV[l.parentFid],C=null==m||null===(v=m.iterationNodeAttr)||void 0===v?void 0:v.value,O=null!=m&&null!==(b=m.span)&&void 0!==b&&b.hasOwnProperty("value")?null==m||null===(g=m.span)||void 0===g?void 0:g.value:null==m||null===(y=m.span)||void 0===y?void 0:y.default;return this.getItemVariables(_,C,O)}return this.getIterationVars(l)}var T=null==l||null===(i=l.attributes)||void 0===i?void 0:i.foreachItemAttr,V=T.hasOwnProperty("value")?null==T?void 0:T.value:null==T?void 0:T.default;return V?this.getItemVariables(l,V):this.getIterationVars(l)},getItemVariables:function(e,t,a){var i,n,r=null==e||null===(i=e.attributes)||void 0===i||null===(n=i.componentName)||void 0===n?void 0:n.value,o=a?r+"/Col-"+a:r,l={value:"item",label:"item",type:"item",alias:"来自".concat(o,"的迭代变量")},s={value:"itemIndex",label:"itemIndex",type:"itemIndex",alias:"来自".concat(o,"的迭代索引")},c=[];return(t||[]).forEach((function(e){c.push({value:e,label:e,type:"itemAttr",alias:"迭代属性"})})),c.length&&(l.children=c),[l,s]},getPayloads:function(e){var t=[];if("array"===Object(r.g)(e))e.forEach((function(e){if(!t.length){var a="payload"===e.name?e.attributes:e.payload?e.payload.attributes:null;a&&a.forEach((function(e){var a=o(e);t.push(a)}))}}));else if("object"===Object(r.g)(e))for(var a in e)if("payload"===a){e[a].attributes.forEach((function(e){var a=o(e);t.push(a)}))}return t},initData:function(){var e=Object(n.pb)(this.data.value,this.data.default);e&&!this.data.editValue&&(this.data.editValue={type:"script",content:e},this.data.value=Object(r.b)(this.data.editValue)),this.data.editValue&&this.data.editValue.hasOwnProperty("content")&&(this.data.editValue.type="script"),this.data.editValue&&"script"===this.data.editValue.type?(this.editVal=Object(r.e)(this.data.editValue),this.showVal=this.getShowVal()):(this.editVal=Object(r.e)(this.copayEditVal),this.showVal=this.getShowVal())},handleIconClick:function(){this.open()},open:function(){this.dialogVisible=!0},close:function(){this.dialogVisible=!1},cancel:function(){this.close()},clear:function(){var e=this;this.$confirm("确定要清空相关设置吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.showVal="",e.editVal=Object(r.e)(e.copayEditVal),e.$removeAttr(e.data,"value"),e.$removeAttr(e.data,"lastValue"),e.$removeAttr(e.data,"editValue"),e.clearFuncName(),e.close()})).catch((function(){}))},clearFuncName:function(){var e,t=(null==this||null===(e=this.parent)||void 0===e?void 0:e.attributes)||[],a=this.data,i=t.find((function(e){var t;return(null==e||null===(t=e.pageComponentName)||void 0===t?void 0:t.fid)===a.fid}));i&&(this.$removeAttr(i.pageComponentName,"value"),this.$removeAttr(i.pageComponentMethod,"value"),this.$removeAttr(i.pageComponentMethod,"optionsFid"),this.$removeAttr(i.executionTitle,"value"))},codeEditorBlur:function(e){this.editVal.content=e},getShowVal:function(){var e=this.editVal.content;return e?"script: "+(e.length>20?e.substr(0,20)+"...":e):""},clickSure:function(){var e=this.validate();!0===e?(this.showVal=this.getShowVal(),!1!==this.handleChangeResult(this.showVal,this.data)?(this.$setAttr(this.data,"value",this.showVal),this.$setAttr(this.data,"lastValue",this.showVal),this.$setAttr(this.data,"editValue",Object(r.e)(this.editVal)),this.$emit("onSure",this.showVal,Object(r.e)(this.editVal),this.data),this.dialogVisible=!1):this.$setAttr(this.data,"lastValue",this.data.lastValue)):this.$message.warning(e)},validate:function(){var e,t,a;return this.editVal.content?this.editVal.content.length>n.a.SCRIPT_MAX_LENGTH?"脚本字符长度不超过"+n.a.SCRIPT_MAX_LENGTH:!!("function"!=typeof(null===(e=this.$refs)||void 0===e||null===(t=e.codeEditor)||void 0===t?void 0:t.validate)||null!==(a=this.$refs)&&void 0!==a&&a.codeEditor.validate())||"脚本语法错误，请检查您的脚本":"请输入脚本"},compileChecked:function(e){if(!e)return!0;var t=!0;try{var a=this.payloadNames;new Function("Arguments",(a?"const { ".concat(a," } = Arguments; \n"):"")+e)}catch(e){t=!1}return t},fullScreenHandler:function(){this.fullscreen=!this.fullscreen,this.fullscreen?this.codeHeight=window.innerHeight-180:this.codeHeight=this.codeDefaultHeight}}},s=(a("b33b"),a("2877")),c=Object(s.a)(l,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"hc-attr-editor hc-attr-editor-script"},[t("el-input",{staticClass:"hc-attr-editor-input",attrs:{placeholder:e.placeholder,value:e.showVal,readonly:"",size:"mini",clearable:""},nativeOn:{click:function(t){return e.handleIconClick.apply(null,arguments)}}},[t("i",{staticClass:"el-input__icon hc-attr-editor-icon",class:e.iconClass,attrs:{slot:"suffix"},slot:"suffix"})]),t("el-dialog",{staticClass:"hc-attr-editor-dialog hc-attr-editor-dialog-script",attrs:{draggable:!0,visible:e.dialogVisible,"close-on-click-modal":!1,fullscreen:e.fullscreen,title:e.title,width:"56%","append-to-body":!0},on:{close:e.close}},[t("div",{staticClass:"IVA-dialog-header",attrs:{slot:"title"},slot:"title"},[t("div",{staticClass:"el-dialog-title dialog-title"},[e._v("\n        "+e._s(e.title)+"\n      ")]),t("div",{staticClass:"el-dialog-header-menu"},[e.fullscreen?e._e():t("i",{staticClass:"el-dialog__close icon-maximize-alt",attrs:{title:"全屏"},on:{click:e.fullScreenHandler}}),e.fullscreen?t("i",{staticClass:"el-dialog__close icon-minimize-alt",attrs:{title:"退出全屏"},on:{click:e.fullScreenHandler}}):e._e()])]),t("div",{staticClass:"hc-attr-editor-content"},[t("div",{staticClass:"hc-attr-editor-content-fun-start"},[e._v("function ("+e._s(e.payloadNames)+")"),t("el-tooltip",{attrs:{content:"出现同名参数时，按照逻辑顺序从外到内依次增加后缀数字",placement:"top"}},[t("i",{staticClass:"el-icon-question"})]),e._v(" {")],1),e.dialogVisible?t("base-code-editor",{ref:"codeEditor",attrs:{height:e.codeHeight,params:e.codeOptions,value:e.editVal.content,readOnly:e.data.readonly},on:{blur:e.codeEditorBlur}}):e._e(),t("div",{staticClass:"hc-attr-editor-content-fun-end"},[e._v("}")])],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"danger"},on:{click:e.clear}},[e._v("清空")]),t("el-button",{on:{click:e.cancel}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.clickSure}},[e._v("确 定")])],1)])],1)}),[],!1,null,null,null);t.default=c.exports},"9abf":function(e,t,a){"use strict";a.r(t);var i=(a("28a5"),a("75fc")),n=(a("9253"),[{id:1,label:"读"},{id:2,label:"写"},{id:3,label:"执行"},{id:4,label:"审计"}]),r=[{label:"API",value:1},{label:"菜单",value:2},{label:"页面",value:3},{label:"报表",value:4},{label:"脚本",value:5},{label:"流程",value:6}],o=r.reduce((function(e,t){return Reflect.set(e,t.value,t.label),e}),{}),l=n.reduce((function(e,t){return Reflect.set(e,t.id,t.label),e}),{}),s=[{prop:"permissionIdentifier",label:"权限标识",show:!0,width:"200",filter:{type:"input",operator:"like"}},{prop:"moduleName",label:"模块名称",show:!0,filter:{type:"input",operator:"like"}},{prop:"metaPermission",label:"元权限",show:!0,render:function(e,t){return e("span",{},l["".concat(t.metaPermission)])}},{prop:"updateUser",label:"修改人",show:!0},{prop:"updateTime",label:"修改时间",show:!0,sortable:!0,width:150}],c=function(e){return{prop:"moduleType",label:"模块类型",show:!1,filterOnly:!0,filter:{hidden:!0,type:"select",operator:"=",options:r,keep:!0,defaultValue:e}}},u=([].concat([{prop:"permissionIdentifier",label:"权限标识",show:!0,width:"200",filter:{type:"input",operator:"like"}},{prop:"moduleName",label:"模块名称",show:!0,filter:{type:"input",operator:"like"}},{prop:"metaPermission",label:"元权限",show:!0,render:function(e,t){return e("span",{},l["".concat(t.metaPermission)])}},{prop:"moduleType",label:"模块类型",show:!0,render:function(e,t){return e("span",{},o["".concat(t.moduleType)])},filter:{type:"select",operator:"=",options:r}},{prop:"updateUser",label:"修改人",show:!0},{prop:"updateTime",label:"修改时间",show:!0,sortable:!0,width:150}]),[].concat(s,[c(2)]),[].concat(s,[c(3)]),[].concat(s,[c(4)]),a("b19c")),d={name:"PermissionEditor",components:{},props:{iconClass:{type:String,default:function(){return"el-icon-edit"}},isProject:{type:Boolean,default:!1},params:{type:Object,default:function(){return{moduleType:""}}},data:{type:Object,default:function(){return{alias:"",type:"",default:"",value:"",primitiveLabels:""}}},placeholder:{type:String,default:""},handleRulesResult:{type:Function,default:function(){}},handleChangeResult:{type:Function,default:function(){}}},computed:{fetchInfoOption:function(){return{url:this.permissionId&&"id"===this.params.key?"/api/auth/authorization/permissions/".concat(this.permissionId):""}},fetchInfo:function(){return"permissionIdentifier"===this.params.key?{permissionIdentifier:this.permissionId}:{}}},data:function(){return{projectIdentifier:"",permissionColumns:[].concat(Object(i.a)(s),[c(this.params.moduleType||"")]),fetchOption:{url:"/api/auth/authorization/permissions"},fetchProps:{value:this.params.key||"id",label:"permissionIdentifier"},showVal:null,editorVal:{type:"permission",permission:null},dialogVisible:!1,permissionId:""}},watch:{data:{handler:function(){this.initData()},deep:!0}},created:function(){this.projectIdentifier=this.getQueryVariable("projectIdentifier"),this.projectIdentifier&&(this.isProject=!0,this.fetchOption.params={$filter:"permissionIdentifier likeright /".concat(this.projectIdentifier,"/")}),this.initData()},methods:{getQueryVariable:function(e){var t=location.href.split("?");if(t.length>1){for(var a=t[1].split("&"),i=0;i<a.length;i++){var n=a[i].split("=");if(n[0]==e)return n[1]}return""}return""},onValueChange:function(e){!1!==this.handleChangeResult(e,this.data)?(this.$setAttr(this.data,"value",e),this.$setAttr(this.data,"lastValue",e),this.$setAttr(this.data,"editValue",Object(u.e)(this.editorVal))):this.$setAttr(this.data,"lastValue",this.data.lastValue)},reset:function(){},initData:function(){this.data.hasOwnProperty("value")?this.permissionId=this.data.value:this.permissionId=this.data.default},handleSelectorTableBeforeClose:function(){this.$refs.selectorTable&&this.$refs.selectorTable.$refs.filter&&this.$refs.selectorTable.$refs.filter.handleFilterReset()}}},p=(a("d667"),a("2877")),h=Object(p.a)(d,(function(){var e=this;return(0,e._self._c)("selector-table",{ref:"selectorTable",attrs:{title:"请选择",dialogWidth:"1200px",fetchOption:e.fetchOption,fetchInfo:e.fetchInfo,fetchInfoOption:e.fetchInfoOption,column:e.permissionColumns,filterLgSpan:6,defaultValueSearch:!0,props:e.fetchProps},on:{change:e.onValueChange,"before-close":e.handleSelectorTableBeforeClose},model:{value:e.permissionId,callback:function(t){e.permissionId=t},expression:"permissionId"}})}),[],!1,null,null,null);t.default=h.exports},"9af7":function(e,t,a){"use strict";a("7f7f");var i=a("a599"),n=a("45e0"),r={name:"AttrItemContent",props:{data:{type:Object,default:function(){}},handleRulesResult:{type:Function,default:function(){}},handleChangeResult:{type:Function,default:function(){}}},data:function(){return{itemContentStyle:"width:100%;",isEquality:!1,asideWidth:240,paddingStyle:"0px"}},computed:{linkType:function(){return"isCustomVariable"===this.data.customGroupName?2:1},linkTypeList:function(){var e=this;return n.default.map((function(t){return{value:t.command,name:t.alias,visible:"function"!=typeof t.visible||t.visible(e.linkType)}}))}},beforeDestroy:function(){i.a.$off("asideWidth",this.asideWidthEvent)},created:function(){i.a.$on("asideWidth",this.asideWidthEvent),(this.data.type&&(~this.data.type.indexOf("Boolean")||~this.data.type.indexOf("Complex"))||this.data.isEquality)&&(this.isEquality=!0,this.paddingStyle="6px",this.itemContentStyle="width:calc(100% - 106px);"),this.isEquality&&this.data.hasOwnProperty("innerWidth")&&(this.itemContentStyle="width:calc(100% - 46px);")},methods:{asideWidthEvent:function(e){if(e===this.asideWidth)return!1;this.asideWidth=e,e>300?(this.paddingStyle="0px",this.isEquality&&this.data.hasOwnProperty("innerWidth")?this.itemContentStyle="width:calc(100% - 46px);":this.itemContentStyle="width:calc(100% - 106px);"):(this.isEquality&&(this.paddingStyle="6px"),this.itemContentStyle="width:100%;")},getCurrentPage:function(){var e=this.$store.getters.pageEditor,t=e.pagesActiveName;return e.pagesKV[t]},handleClick:function(e){this.data.editor!==e?(this.$setAttr(this.data,"editor",e),this.$setAttr(this.data,"editorDialogVisible",!0)):this.$setAttr(this.data,"editorDialogVisible",!0)}}},o=(a("3237"),a("2877")),l=Object(o.a)(r,(function(){var e=this,t=e._self._c;return t("el-row",{staticClass:"attr-item-content",style:e.itemContentStyle,attrs:{"data-name":e.data.name}},[t("el-col",{style:{paddingRight:e.paddingStyle},attrs:{span:e.data.linkable&&!e.data.hideLink?21:24}},[e._t("default")],2),e.data.linkable&&!e.data.hideLink?t("el-col",{staticStyle:{"text-align":"right"},attrs:{span:3}},[t("el-dropdown",{on:{command:e.handleClick}},[t("span",{staticClass:"el-dropdown-link"},[t("i",{staticClass:"el-icon-more"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e._l(e.linkTypeList,(function(a,i){return[a.visible?t("el-dropdown-item",{key:i,class:e.data.editor===a.value?"hc-el-dropdown-item-selected":"",attrs:{command:a.value}},[e._v(e._s(a.name))]):e._e()]}))],2)],1)],1):e._e()],1)}),[],!1,null,null,null);t.a=l.exports},"9bf6":function(e,t,a){},"9d38":function(e,t,a){"use strict";a("5ba0")},"9df4":function(e,t,a){"use strict";a("8f67")},"9e84":function(e,t,a){"use strict";a("0e93")},"9f02":function(e,t,a){"use strict";a("8e6e"),a("456d"),a("f559");var i=a("bd86"),n=(a("6762"),a("2fdb"),a("ac6a"),a("7f7f"),a("28a5"),a("c276")),r=a("b19c"),o=function(e,t){var a=Object(r.a)(e),i="".concat(a);if(i.includes("__quote:percentage__")){var n=Object(r.a)(e.replaceAll(/__quote:percentage__/g,"([1-9]?[0-9](\\.[0-9])?%)|(100(\\.0)?%)"));if(n&&!n.test(t))return"请输入百分数范围为[0.0%-100.0%]"}if(i.includes("__quote:size__")){var o=Object(r.a)(e.replaceAll(/__quote:size__/g,"([1-9]?[0-9](\\.[0-9])?%)|(100(\\.0)?%)|([1-9]?[0-9]{0,3}px)|(auto)|(calc\\(.*\\))"));if(o&&!o.test(t))return"请输入auto、百分比、数字+px、表达式中的一种"}return""},l=a("a542"),s=a("05bd"),c=a("9af7"),u=a("548e"),d=a("3e19");function p(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function h(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?p(Object(a),!0).forEach((function(t){Object(i.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):p(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var f=function(e){var t=(e+"").split(".");return t.length>1?t[1].length:0},m=function(e,t,a){var i=[],o=function(){var o=e[l];if("methods"!==(o.originGroupName||o.groupName)||!1===o.visible)return 0;var s=o.attributes;if(!s)return 0;var c=function(e){if(e.functionName){var l=e.functionName,s=e.description,c=e.payload,u=c&&c.default,d=Object(n.pb)(l.value,l.default),p=e.content?d?"$_".concat(d):"":d,h=Object(n.pb)(s.value,s.default),f={value:p,label:p};"Page"!==(null==a?void 0:a.name)&&o.componentFid&&o.componentFid!==a.fid&&(f.value=p+"_"+o.componentFid,f.label+="("+(o.alias||"来自引用")+")"),p&&i.push(f),"function"===Object(r.g)(t)&&t(p,h,u,o)}};Array.isArray(s)?s.forEach((function(e){return c(e.customMethodsSetting?e.customMethodsSetting.attributes:e)})):c(s)};for(var l in e)o();return i};t.a={components:{AttrBox:s.a,AttrItemContent:c.a,ComplexBox:u.a,ComplexGroup:d.a},props:{parent:{type:Object},attr:{type:Object}},inject:["isSDC"],render:function(e,t){return this.createAttrBox(e,this.attr,this.parent,null,0)},computed:{attributes:function(){return this.attr&&this.attr.attributes}},methods:{getVal:function(e){return Object(n.pb)(e.value,e.default)},setValue:function(e,t){this.$setAttr(t,"value",e),this.$store.commit("SET_UN_SAVED",!0)},setLastValue:function(e,t){this.$setAttr(t,"lastValue",e)},updateComponentKV:function(e,t){this.$store.dispatch("changeComponentKV",{newKey:e,oldKey:t.lastValue})},createAttrItemContent:function(e,t,a){var i=t.type,n=new l.a(i),r=[];return r.push(a),t.linkable=!1!==t.linkable&&"false"!==t.linkable,t.tips=t.tips||t.alias,e("attr-item-content",{props:{parsedType:n,data:t,handleRulesResult:this.handleRulesResult,handleChangeResult:this.handleChangeResult}},r)},createAttrBox:function(e,t,a,i,n){var o=t.type,s=t.editor,c=new l.a(o),u=c.getBaseType(),d=c.getIsLen();t.fullName=a?a.name+"_attributes_"+t.name:t.name;var p={String:this.createElInput,Number:this.createElInputNumber,Boolean:this.createElCheckbox,Enum:this.createElSelect,Complex:this.createComplex}[u]||this.createElInput;"Complex"!==u&&(s||d)&&(p=this.createEditor);var h=["function"===Object(r.g)(p)?p(e,c,t,a,i,n):null];return e("attr-box",{props:{parsedType:c,data:t},key:"".concat(t.name,"_").concat(t.visible)},h)},createEditor:function(e,t,a,o,l,s){var c=a.editor,u=t.getIsLen();if("color"===c&&!u)return this.createElColorPicker(e,t,a);if("date"===c||"time"===c||"datetime"===c)return this.createElDateTimePicker(e,t,a);if(/^self:+/.test(c))return this.createCustomEditor(e,t,a,o,l,s);var d,p=(("color"===c?"array":c)||"array")+"-editor";if(!this.$options.components[Object(n.Fb)(p)])return this.createElInput(e,t,a);if(["rtdata-link-editor","indicator-link-editor","assets-link-editor","object-link-editor","templates-link-editor"].includes(p)&&Object(n.tb)(null==a||null===(d=a.linkConfig)||void 0===d?void 0:d.origin)){var f,m=null===(f=a.linkConfig.origin)||void 0===f?void 0:f.accessType;p="".concat(m,"-link-editor"),a.editor="".concat(m,"-link");var v=Object(r.e)(a.linkConfig.origin),b=Object(r.e)(a.linkConfig);delete b.origin;var g="indicator"===v.historyType;this.$setAttr(a,"linkConfig",h(h({},v),{},Object(i.a)({},g?"indicatorEditor":"rtEditor",b)))}var y={props:{visible:a.editorDialogVisible,linkType:"Page"===a.componentName&&"isCustomVariable"===a.customGroupName?2:1,data:a,parent:o,parentParent:l,parsedType:t,level:s,params:h(h({},a.editorParams),{isProject:!1}),handleRulesResult:this.handleRulesResult,handleChangeResult:this.handleChangeResult}};return this.createAttrItemContent(e,a,e(p,y,[]))},createCustomEditor:function(e,t,a,i,o,l){var s=this,c=a.editor.split(":")[1],u={props:{size:"mini",clearable:!1,readonly:!0,value:Object(n.pb)(a.value,a.default),placeholder:a.placeholder||""},nativeOn:{click:function(e){var n=s.getComponentInstanceMethod(c);n&&"function"===Object(r.g)(n)&&n({data:a,parent:i,parentParent:o,parsedType:t,visible:a.editorDialogVisible,linkType:"Page"===a.componentName&&"isCustomVariable"===a.customGroupName?2:1,level:l,params:a.editorParams,handleRulesResult:s.handleRulesResult,handleChangeResult:s.handleChangeResult})}}},d=[e("i",{class:["el-input__icon","el-icon-edit"],slot:"suffix",style:{cursor:"pointer"}})];return this.createAttrItemContent(e,a,e("el-input",u,d))},createElInput:function(e,t,a){var i,r=this,o=Object(n.pb)(a.maxlength,n.a.MAX_LENGTH),l=Object(n.pb)(a.minlength,n.a.MIN_LENGTH),s="el-input-"+Object(n.ob)(),c=this.getVal(a),u=a.prepend||(this.isSDC&&"componentName"===a.name&&/^#T-/.test(c)?"#T-":"");u&&(i=function(e){return u+e});var d={attrs:{id:s},props:{size:"mini",clearable:!0,disabled:!!a.readonly||!1===a.editable,value:u?c.slice(3,c.length):c,placeholder:a.placeholder||"",maxlength:o,minlength:l},on:{change:function(e){r.handleAttrEvent("change",i?i(e):e)},focus:function(e){r.handleAttrEvent("focus",i?i(e):e)},blur:function(e){var t=i?i(e.target.value):e.target.value;if(t!==a.lastValue){var n=r.handleRulesResult(t,a);if(n&&!0!==n)return r.$message.warning(n),void r.setValue(a.lastValue,a);!1!==r.handleChangeResult(t,a)?(r.setLastValue(t,a),r.handleAttrEvent("blur",t)):r.setValue(a.lastValue,a)}},clear:function(){var e=document.getElementById(s);e&&e.focus(),r.handleAttrEvent("clear")},input:function(e){r.setValue(i?i(e):e,a)}}},p=[].concat(u?[e("template",{slot:"prepend"},u)]:[]);return this.createAttrItemContent(e,a,e("el-input",d,p))},createElColorPicker:function(e,t,a){var i,r=this,o="el-color-picker-"+Object(n.ob)(),l={ref:o,props:{size:"mini","show-alpha":!0,disabled:!!a.readonly||!1===a.editable,"color-format":n.a.COLOR_FORMAT,value:Object(n.pb)(Object(n.pb)(null==a||null===(i=a.editValue)||void 0===i?void 0:i.themeKey,a.value),a.default),default:a.default,placeholder:Object(n.pb)(a.placeholder,"")},on:{change:function(e){if(!1!==r.handleChangeResult(e,a)){if(e&&!Object(n.sb)(e)){if("string"!=typeof e||!e.startsWith("THEME_")){e=a.lastValue||a.default;var t=r.$refs[o];if(null!=t&&t.color)if(e){var i=e;if("string"==typeof e&&e.startsWith("THEME_")){var l=e.split(".");l.length>1&&(l[0]=Object(n.p)(l[0]||""),i=Object(n.bb)(r.$store.getters,l.join(".")))}t.color.fromString(i)}else t.color.value=e,t.color._alpha=0,t.color._hue=0,t.color._saturation=0,t.color._value=0}r.$setAttr(a,"editValue",{type:"themeColor",sign:e.replaceAll(".","_"),themeKey:e})}else r.$setAttr(a,"editValue",{});r.setValue(e||"",a),r.setLastValue(e||"",a),r.handleAttrEvent("change",e)}else r.setValue(a.lastValue,a)},"active-change":function(e){r.handleAttrEvent("active-change",e)}}};return this.createAttrItemContent(e,a,e("theme-color-picker",l,[]))},createElDateTimePicker:function(e,t,a){var i=this,r=a.editor,o="time"===r?"el-time-select":"el-date-picker",l={props:{size:"mini",type:r,disabled:!!a.readonly||!1===a.editable,format:a.format,"picker-options":a.pickerOptions,"value-format":a.valueFormat,clearable:a.clearable,value:Object(n.pb)(Object(n.L)(a.value||a.default,a.valueFormat),a.default),placeholder:Object(n.pb)(a.placeholder,"")},on:{input:function(e){!1!==i.handleChangeResult(e,a)?(i.setValue(e||void 0,a),i.setLastValue(e||void 0,a),i.handleAttrEvent("change",e||void 0)):i.setValue(a.lastValue,a)},blur:function(e){},focus:function(e){}}};return this.createAttrItemContent(e,a,e(o,l,[]))},createElInputNumber:function(e,t,a){var i=this,r=Object(n.pb)(a.min,n.a.MIN),o=Object(n.pb)(a.max,n.a.MAX),l=Object(n.pb)(a.precision,n.a.NUMBER_PRECISION),s=Object(n.pb)(a.step,n.a.NUMBER_STEP),c={props:{size:"mini","controls-position":"right",min:r,max:o,precision:l,"step-strictly":Object(n.pb)(a["step-strictly"],n.a.NUMBER_STEP_STRICTLY),step:s,disabled:!!a.readonly||!1===a.editable,value:Object(n.pb)(a.value,a.default),placeholder:Object(n.pb)(a.placeholder,"")},on:{change:function(e){if(void 0!==e){var t=Object(n.pb)(e,a.default);!1!==i.handleChangeResult(e,a)?(i.setValue(t,a),i.setLastValue(t,a),i.handleAttrEvent("change",t)):i.setValue(a.lastValue,a)}else{var r=Object(n.pb)(a.lastValue,a.default);i.setValue(r,a)}},focus:function(e){var t=e.target.value;i.handleAttrEvent("focus",t,e)},blur:function(e){var t=e.target.value,n=a.value;""===t&&(e.target.value=n),i.handleAttrEvent("blur",t,e)}}};return this.createAttrItemContent(e,a,e("el-input-number",c,[]))},createElCheckbox:function(e,t,a){var i=this,r=t.getAttach(),o={props:{value:Object(n.pb)(a.value,a.default),disabled:!!a.readonly||!1===a.editable},on:{change:function(e){!1!==i.handleChangeResult(e,a)?(i.setValue(e,a),i.setLastValue(e,a),i.handleAttrEvent("change",e)):i.setValue(a.lastValue,a)}}},l=[];return r&&r.length>0&&l.push(a.value?r[1].label:r[0].label),this.createAttrItemContent(e,a,e("el-switch",o,l))},createElSelect:function(e,t,a,i){var r=this,o=t.getAttach();if(a.options){var l=[],s=this.$store.getters.pageEditor,c=s.pagesKV[s.pagesActiveName];if(!c)return;var u=c.componentKV,d="页面加载前"===(null==i?void 0:i.alias),p="Page"===u[c.activeComponentFid].name;if("pageComponentName"===a.options){(function e(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];for(var r in t){var o=t[r],s=o.attributes;if(s){var u,h=(null==s||null===(u=s.componentName)||void 0===u?void 0:u.value)||("string"==typeof(null==s?void 0:s.componentName)?null==s?void 0:s.componentName:"");if(/^#[a-z0-9]{4}-/.test(h))continue;if("Page"===h){var f=a?"push":"unshift";if(l[f]({value:r,label:"".concat(a).concat(h)}),d&&p&&!i)break}else h&&(d&&(p||i)||l.push({value:r,label:"".concat(a).concat(h)}));if(d&&p)continue;if("Iframe"===o.name&&!i){var m=Object(n.fb)(c.fid,o.fid);e(m,h+"_",!0)}}}})(u),o=l}else{var h=a.optionsFid;if(h){var f,v,b=u[h];if(!b)v=!0,b=Object(n.fb)(c.fid)[h];var g=null===(f=b)||void 0===f?void 0:f.attributes;if(g){var y=m(g,null,b)||[];o=d&&(p||v)?y.filter((function(e){return"script"===e.value})):y}}}}var _={props:{size:"mini",value:Object(n.pb)(a.value,a.default),disabled:!!a.readonly||!1===a.editable,clearable:a.clearable,filterable:!0,placeholder:Object(n.pb)(a.placeholder,"")},ref:"attrSelect",on:{"visible-change":function(e){r.handleAttrEvent("visible-change",e)},"remove-tag":function(e){r.handleAttrEvent("remove-tag",e)},change:function(e){!1!==r.handleChangeResult(e,a,i)?(r.setValue(e,a),r.setLastValue(e,a),r.handleAttrEvent("change",e)):r.setValue(a.lastValue,a)},focus:function(e){r.handleAttrEvent("focus",e)},blur:function(e){r.handleAttrEvent("blur",e)},clear:function(e){r.handleAttrEvent("clear",e)}}},C=o.filter((function(e){return e.label})).map((function(t){return e("el-option",{attrs:{key:t.value,label:t.label,value:t.value}})}));return this.createAttrItemContent(e,a,e("el-select",_,C))},createComplex:function(e,t,a,i,o,l){var s=this,c=a.attributes,u=t.getIsLen(),d=t.getLen();if(a.fullName=i?i.name+"_attributes_"+a.name:a.name,!c)return this.createEditor(e,t,a,i,o,l);void 0!==l&&l++;var p={props:{level:l,data:a,parent:i,attrName:this.attr.name}},f=[],m="complex-group";if(null!=a&&a.default&&!Array.isArray(a.default)){var v=Object(n.k)(a.default),b=!0;for(var g in this.attributes[0])this.attributes[0][g].hasOwnProperty("value")&&(b=!1);if(v.length>0&&b){var y,_=[];v.forEach((function(e,t){var a=Object(r.e)(s.attributes[0]);for(var i in e)a.hasOwnProperty(i)&&(a[i].value=e[i]);_.push(a)})),(y=this.attributes).splice.apply(y,[0,this.attributes.length].concat(_))}}if("array"===Object(r.g)(c))c.forEach((function(t,o){var u;if(null===(u=t.pageComponentName)||void 0===u||!u.hidden){var p=[],v=Object(n.ob)();if(t.hasOwnProperty("pageComponentMethod")&&t.pageComponentName.value&&s.$setAttr(t.pageComponentMethod,"optionsFid",t.pageComponentName.value),t.hasOwnProperty("executionTitle")&&t.pageComponentMethod.value){var b=s.$store.getters.pageEditor,g=h(h({},b.pagesKV[b.pagesActiveName].componentKV),Object(n.fb)(b.pagesActiveName))[t.pageComponentName.value];g&&s.$setAttr(t.executionTitle,"value","".concat(g.name,".").concat(t.pageComponentMethod.value))}for(var y in t.hasOwnProperty("executionContent")&&t.executionContent.value&&t.executionContent.editValue&&"method"===t.executionContent.editValue.type&&(t.pageComponentName.value||(s.setValue(t.executionContent.editValue.fn[0],t.pageComponentName),s.setLastValue(t.executionContent.editValue.fn[0],t.pageComponentName)),t.pageComponentMethod.value||(s.setValue(t.executionContent.editValue.fn[1],t.pageComponentMethod),s.setLastValue(t.executionContent.editValue.fn[1],t.pageComponentMethod))),t){var _=t[y];"object"===Object(r.g)(_)&&(_.fid=v),!1!==_.visible&&p.push(s.createAttrBox(e,_,a,i,l))}f.push(e(m,{props:{level:l,parentParent:i,parent:a,attributes:c,data:t,index:o,len:d,expandable:!0===a.expandable,attrName:s.attr.name}},p))}}));else if("object"===Object(r.g)(c)){var C=[];for(var O in c)if(!1!==c[O].visible)if("methods"===(a.originGroupName||a.groupName)){if("functionName"===O){var T;c[O].alias=a.alias,c[O].linkable=!1;var V=(null===(T=a.attributes)||void 0===T?void 0:T.description.default)||a.alias||"";c[O].tips=V,C.push(this.createAttrBox(e,c[O],a,i,l))}}else if("events"===(a.originGroupName||a.groupName)||"events"===a.editor){if("content"===O){var w;c[O].alias=a.alias,c[O].linkable=!1;var P=(null===(w=a.attributes)||void 0===w?void 0:w.description.default)||a.alias||"";c[O].tips=P,C.push(this.createAttrBox(e,c[O],a,i,l))}}else C.push(this.createAttrBox(e,c[O],a,i,l));f.push(e(m,C))}return u&&!1!==a.inputVisible&&f.unshift(this.createEditor(e,t,a,i,o,l)),e("complex-box",p,f)},getNewVal:function(e){var t=this,a=Object(r.e)(e),i=Object(n.ob)();return function e(a){var n=Object(r.g)(a);if("array"===n)a.forEach((function(t){e(t)}));else if("object"===n)for(var o in a){var l=a[o];l.fid=i,l.customGroupName&&t.setCustomGroupNames(l.customGroupName,l);var s=l.attributes;if(s&&(e(s),Array.isArray(s))){var c=s.every((function(e){return!e.hasOwnProperty("attributes")}));null!=l&&l.readonly||!1===l.editable||!c||null==s||!s.length||s.splice(0,s.length-1)}}}(a),this.commitSetCustomGroupNames(),a},setCustomGroupNames:function(e,t){var a=this.customGroupNames[e];a||(a=this.customGroupNames[e]=[]),a.push(t)},handleBus:function(e,t,a,i,n){var r={returnValue:!0,context:this,index:1,type:e,attr:t,attrs:a,callback:i,attrName:n};return this.$bus.$emit("complexClick",r),r.returnValue},checkComponentName:function(e){var t=this.$store.getters.pageEditor,a=t.pagesKV[t.pagesActiveName];if(!a)return!0;var i=a.componentNames;if(i)for(var n in i)if(n===e)return!1;return!0},handleAttrEvent:function(e,t){},handleRulesResult:function(e,t){var a=Object(n.pb)(t.maxlength,n.a.MAX_LENGTH),i=Object(n.pb)(t.minlength,n.a.MIN_LENGTH),s=Object(n.pb)(t.min,n.a.MIN),c=Object(n.pb)(t.max,n.a.MAX),u=new l.a(t.type),d=u.getBaseType(),p=u.getIsLen();if(t.hasOwnProperty("lastValue")||"Complex"===d||p||this.setLastValue(t.default,t),"componentName"===t.name&&!this.checkComponentName(e,t))return"组件名称不能重复";if(!0===t.required&&""===e)return t.alias+"不能为空";if(!1===t.required&&""===e)return!0;if(e.length>a)return t.alias+"最大长度不能超过"+a+"个字符";if(e.length<i)return t.alias+"最小长度不能小于"+i+"个字符";if(t.percent&&!Object(n.ub)(e))return t.alias+"只允许输入百分数";var h=t.rules;if(h&&"array"===Object(r.g)(h))for(var m=0;m<h.length;m++){var v=h[m],b=v.message,g=Object(r.g)(e),y="string"===g&&v.hasOwnProperty("min"),_="string"===g&&v.hasOwnProperty("max"),C=Object(n.pb)(v.maxlength,n.a.MAX_LENGTH),O=Object(n.pb)(v.minlength,n.a.MIN_LENGTH);if(!0===v.require&&""===e)return b||t.alias+"不能为空";if(!1===v.require&&""===e)return!0;var T=v.type;if(T&&g!==T)return b||t.alias+"只支持"+T+"类型";if((y||"number"===g)&&e<s)return b||t.alias+"最小值不能小于"+s;if((_||"number"===g)&&e>c)return b||t.alias+"最大值不能大于"+c;var V=t.precision;if(V&&f(e)!==V)return b||t.alias+"允许保留小数点"+V+"位";if(e.length<O)return b||t.alias+"最小长度不能小于"+O+"个字符";if(e.length>C)return b||t.alias+"最大长度不能超过"+C+"个字符";try{var w=void 0;try{w=Object(r.a)(v.pattern)}catch(e){w=void 0}if("".concat(w).includes("__quote:")&&""!==e){var P=o(v.pattern,e);if(P)return b||P}else if(w&&!w.test(e))return b}catch(e){return"正则表达式无法正确解析"}if(v.validator)return this.handleMethod(e,v.validator,t)}return"componentName"===t.name&&this.updateComponentKV(e,t),!0},handleChangeResult:function(e,t,a){return this.handleMethod(e,t.changeHandler,t,a)},eventEditingHandleMethod:function(e,t,a){var i=function(e){var t=e.fid,i=e.name;for(var n in a.attributes){var r,o=a.attributes[n];if((null===(r=o[i])||void 0===r?void 0:r.fid)===t)return o}}(t);if("pageComponentName"===t.name){this.$setAttr(t,"value",e),this.$setAttr(i.pageComponentMethod,"optionsFid",i.pageComponentName.value);var r=this.$store.getters.pageEditor,o=h(h({},r.pagesKV[r.pagesActiveName].componentKV),Object(n.fb)(r.pagesActiveName))[e];this.$removeAttr(i.pageComponentMethod,"value"),this.$setAttr(i.executionTitle,"value","".concat(o.name).concat(i.pageComponentMethod.value?"."+i.pageComponentMethod.value:"")),this.$removeAttr(i.executionType,"value"),this.$removeAttr(i.executionContent,"value"),this.$setAttr(i.executionContent,"editor"),this.$removeAttr(i.executionContent,"editValue")}else"pageComponentMethod"===t.name&&("script"===e||"api"===e?(this.$removeAttr(i.executionContent,"value"),this.$removeAttr(i.executionContent,"editValue"),this.$setAttr(i.executionContent,"editor",e),this.$setAttr(i.executionType,"value",e)):(this.$setAttr(i.executionContent,"editor","method"),this.$setAttr(i.executionType,"value","method"),this.$setAttr(i.executionContent,"value","method: ".concat(e)),this.$setAttr(i.executionContent,"lastValue","method: ".concat(e)),this.$setAttr(i.executionContent,"editValue",{fn:[i.pageComponentName.value,e],payloads:[],type:"method"})))},handleMethod:function(e,t,a,i){if(!t)return!0;var n=this.$store.getters.pageEditor,o=n.pagesActiveName,l=n.pagesKV[o];if("Iframe"===l.componentKV[l.activeComponentFid].name&&n.eventEditingComponentFid)return this.eventEditingHandleMethod(e,a,i);var s=this.getComponentInstanceMethod(t);return!s||"function"!==Object(r.g)(s)||s(e,a.lastValue,a,this.getCustomGroupNames(a.componentFid))},getCurrentPage:function(){var e=this.$store.getters.pageEditor,t=e.pagesActiveName;return e.pagesKV[t]},getComponentInstance:function(){var e=this.getCurrentPage();return e?e.componentInstance[e.activeComponentFid]:null},getPageInstance:function(){var e=this.getCurrentPage();return e&&e.page?e.componentInstance[e.page.fid]:null},getBasicComponentInstance:function(){var e=this.getCurrentPage();return e?e.componentInstance.basicComponent:null},getComponentInstanceMethod:function(e){if(e){var t=this.getComponentInstance(),a=this.getBasicComponentInstance(),i=this.getPageInstance();return t&&t[e]||a&&a[e]||i&&i[e]}},getCustomGroupNames:function(e){var t=this.$store.getters.pageEditor,a=t.pagesActiveName,i=t.pagesKV[a];if(!i)return null;if(e=e||i.activeComponentFid,"Iframe"===i.componentKV[e].name&&t.eventEditingComponentFid){var n=this.$store.getters.pageEditorOf(t.eventEditingComponentFid);i=n.pagesKV[n.pagesActiveName]}var r=i.customGroupNames;return r&&r[e]}}}},"9fb0":function(e,t,a){},a077:function(e,t,a){"use strict";a("c75a")},a0a3:function(e,t,a){},a1f7:function(e,t,a){"use strict";a("ee49")},a223:function(e,t,a){"use strict";a("8e6e"),a("ac6a"),a("456d");var i=a("bd86"),n=a("2f0d");function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}var o=[{name:"executionTitle",alias:"名称",type:"String",value:"",default:"",visible:!1,titleVisible:!0,customGroupName:"executionTitleGroup"},{name:"executionType",alias:"类型",type:'Enum("method:方法", "api:API", "script:脚本")',value:"method",isEquality:!0,default:"method",visible:!1,titleVisible:!1,customGroupName:"groupExecutionType",changeHandler:"pageAttrChangeHandler"},{name:"pageComponentName",alias:"组件",type:'Enum("")',options:"pageComponentName",isEquality:!0,innerWidth:40,default:"",changeHandler:"pageComponentNameHandler",customGroupName:"executionComponentName",linkable:!1},{name:"pageComponentMethod",alias:"方法",type:'Enum("")',options:"pageComponentMethod",isEquality:!0,innerWidth:40,default:"",customGroupName:"executionComponentMethod",changeHandler:"pageComponentNameHandler",linkable:!1},{name:"executionContent",alias:"参数",type:"Complex",innerWidth:40,editor:"method",customGroupName:"executionContent",linkable:!1}],l=o.concat([{name:"conditionalContent",alias:"条件",type:"String",innerWidth:40,customGroupName:"conditionalContent",linkable:!1}]),s=[].concat([{name:"timerCycle",alias:"定时器周期(ms)",type:"Number",default:5e3,min:10,max:36e5},{name:"timerName",alias:"定时器名称",type:"String",linkable:!1,rules:[{require:!0,message:"定时器名称不能为空"}]},{name:"isTimeCycle",alias:"循环",type:"Boolean"}],o),c=[].concat([{name:"keyCode",alias:"按键选择",type:'Enum("13: 回车(Enter)", "38: 上( ↑ )", "40: 下( ↓ )", "37: 左( ← )", "39: 右( → )")',default:"13",sort:2013,linkable:!1,rules:[{require:!0,message:"按键不能为空"}]}],o),u='Enum("\'\':无", "required:必填", maxlength:最大长度", minlength:最小长度",max:最大值", min:最小值", "mobile:手机号码", "idCard:身份证码", "email:邮箱", "tel:电话号码", "contact:电话或手机号", "hzsx:汉字字母数字下划线", "szx:数字字母下划线", "number:纯数字", "datetime:时间日期",  "fax:传真号", "zipCode:邮政编码", "inputBox:数字，字母，连接符，下划线，空格组合", "inputBox1:数字，大写字母，连接符，下划线组合", "inputBox2:数字，字母，中文", "letterAndNumber:必须包含数字+字母", "inputLetterOrNumber:仅字母，数字", "specialCharacters:非特殊字符", "ip:ip", "port:端口号", "score:平台密码强度")',d=[{name:"validateType",alias:"校验类型",type:'Enum("default:常用规则", "regex:正则表达式", "script:脚本")',value:"default",default:"default",titleVisible:!0,customGroupName:"validateContentRelated",changeHandler:"pageAttrChangeHandler"},{name:"validateContent",alias:"校验内容",type:u,default:"",validateDefaultType:u,customGroupName:"validateTypeRelated",changeHandler:"pageAttrChangeHandler"},{alias:"最大长度",name:"maxlength",step:1,min:0,max:99999,precision:0,type:"Number",default:"",visible:!1,defaultVisible:!1,customGroupName:"validateMaxlength"},{alias:"最小长度",name:"minlength",type:"Number",min:0,max:99999,step:1,precision:0,default:"",visible:!1,defaultVisible:!1,customGroupName:"validateMinlength"},{alias:"最大值",name:"max",type:"Number",default:1e3,max:9007199254740992,min:-9007199254740992,visible:!1,defaultVisible:!1,customGroupName:"validateMax"},{alias:"最小值",name:"min",type:"Number",default:0,max:9007199254740992,min:-9007199254740992,visible:!1,defaultVisible:!1,customGroupName:"validateMin"},{name:"validateMessage",alias:"提示消息",type:"String",customGroupName:"validateScriptRelated"},{name:"payload",alias:"脚本参数",type:"Complex[1]",visible:!1,defaultVisible:!1,readonly:!0,inputVisible:!1,attributes:"smartAttrs.payload",default:[{name:"value",alias:"输入值"}]}];t.a=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){Object(i.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({variable:[{name:"name",alias:"变量名",type:"String",default:"",titleVisible:!0},{name:"alias",alias:"变量别名",type:"String",default:""},{name:"description",alias:"变量描述",type:"String",default:""},{name:"isObject",alias:"是否为对象",type:"Boolean",default:!0},{name:"objectAttr",alias:"对象属性",type:"Complex[*]",inputVisible:!1,attributes:[{name:"name",alias:"属性名",type:"String",titleVisible:!0},{name:"alias",alias:"属性别名",type:"String",default:""},{name:"description",alias:"属性描述",type:"String"}]}],customVariable:[{name:"name",alias:"变量名",type:"String",default:"",changeHandler:"pageAttrChangeHandler",customGroupName:"customVariableName",rules:[{require:!0,message:"变量名不能为空"},{pattern:/^[\w]+$/g,message:"变量名只能包括英文字母、数字和下划线"}],titleVisible:!0,linkable:!1},{name:"alias",alias:"变量别名",type:"String",default:"",linkable:!1},{name:"description",alias:"变量描述",type:"String",default:"",linkable:!1},{name:"type",alias:"数据类型",type:'Enum("String": "字符串", "Number": "数值", "Boolean": "布尔", "Enum": "数组", "Complex": "对象")',clearable:!0,changeHandler:"pageAttrChangeHandler",default:"",linkable:!0},{name:"value",alias:"变量值",type:"String",default:"",linkable:!0,changeHandler:"pageAttrChangeHandler",customGroupName:"isCustomVariable"},{name:"empty",alias:"空值定义",type:'Enum("undefined": "空")',default:"undefined",linkable:!0,visible:!1,customGroupName:"isCustomVariable"},{customGroupName:"isCustomVariable",name:"isObject",alias:"是否为对象",type:"Boolean",default:!1,visible:!1,changeHandler:"pageAttrChangeHandler",tips:"如果变量值是一个对象，则勾选此选项，并设置对象属性，若非对象，则无需勾选，否则设置无效",linkable:!1},{name:"objectAttr",alias:"对象属性",type:"Complex[*]",customGroupName:"objectAttr",visible:!1,inputVisible:!1,attributes:[{name:"name",alias:"属性名",type:"String",changeHandler:"pageAttrChangeHandler",customGroupName:"isCustomVariableAttrName",titleVisible:!0,linkable:!1},{name:"alias",alias:"属性别名",type:"String",default:"",linkable:!1},{name:"description",alias:"属性描述",type:"String",linkable:!1},{name:"value",alias:"属性值",type:"String",default:"",customGroupName:"isCustomVariable"}]}],scopedVariable:[{name:"name",alias:"变量名",type:"String",default:"",changeHandler:"pageAttrChangeHandler",rules:[{require:!0,message:"变量名不能为空"},{pattern:/^[\w]+$/g,message:"变量名只能包括英文字母、数字和下划线"}],titleVisible:!0,linkable:!1,editable:!1},{name:"alias",alias:"变量别名",type:"String",default:"",linkable:!1,editable:!1},{name:"description",alias:"变量描述",type:"String",default:"",linkable:!1,editable:!1},{name:"type",alias:"数据类型",type:'Enum("String": "字符串", "Number": "数值", "Boolean": "布尔", "Enum": "数组", "Complex": "对象")',clearable:!0,changeHandler:"pageAttrChangeHandler",default:"",linkable:!0,editable:!1},{name:"value",alias:"变量值",type:"String",default:"",linkable:!0,visible:!1,changeHandler:"pageAttrChangeHandler",customGroupName:"isCustomVariable",editable:!1},{name:"empty",alias:"空值定义",type:'Enum("undefined": "空")',default:"undefined",linkable:!0,visible:!1,customGroupName:"isCustomVariable",editable:!1},{customGroupName:"isCustomVariable",name:"isObject",alias:"是否为对象",type:"Boolean",default:!1,visible:!1,changeHandler:"pageAttrChangeHandler",tips:"如果变量值是一个对象，则勾选此选项，并设置对象属性，若非对象，则无需勾选，否则设置无效",linkable:!1,editable:!1},{name:"objectAttr",alias:"对象属性",type:"Complex[*]",customGroupName:"objectAttr",inputVisible:!1,editable:!1,attributes:[{name:"name",alias:"属性名",type:"String",changeHandler:"pageAttrChangeHandler",customGroupName:"isCustomVariableAttrName",titleVisible:!0,linkable:!1,editable:!1},{name:"alias",alias:"属性别名",type:"String",default:"",linkable:!1,editable:!1},{name:"description",alias:"属性描述",type:"String",linkable:!1,editable:!1},{name:"value",alias:"属性值",type:"String",default:"",customGroupName:"isCustomVariable",visible:!1,editable:!1},{name:"type",alias:"数据类型",type:'Enum("String": "字符串", "Number": "数值", "Boolean": "布尔", "Enum": "数组", "Complex": "对象", "DateTime": "日期时间")',clearable:!0,changeHandler:"pageAttrChangeHandler",default:"",linkable:!0,editable:!1},{name:"config",alias:"配置项",type:"Complex[*]",changeHandler:"pageAttrChangeHandler",linkable:!0,editable:!1,inputVisible:!1,attributes:[{name:"name",titleVisible:!0,alias:"属性名",type:"String",default:"",linkable:!1,editable:!1},{name:"alias",alias:"属性别名",type:"String",default:"",linkable:!1,editable:!1},{name:"value",alias:"属性值",type:"String",default:"",linkable:!1,editable:!1}],default:[{name:"暂无",alias:"暂无",value:""}]}]}],payload:[{name:"name",alias:"参数名",type:"String",readonly:!0,titleVisible:!0},{name:"alias",alias:"参数别名",type:"String",default:"",readonly:!0},{name:"description",alias:"参数描述",type:"String",readonly:!0},{name:"default",alias:"参数默认值",type:"String",readonly:!0},{name:"editor",alias:"属性值编辑器",type:"String",readonly:!0},{name:"valueSource",alias:"参数值来源",type:"String",readonly:!0}],eventContent:o,conditionalBranch:l,timerEventContent:s,keypadEventContent:c,validation:d,customMethod:[{name:"functionName",alias:"方法名称",type:"String",rules:[{require:!0,message:"变量名不能为空"},{pattern:/^[\w]+$/g,message:"变量名只能包括英文字母、数字和下划线"}],titleVisible:!0,default:""},{name:"description",alias:"方法描述",type:"String",default:""},{name:"payload",alias:"参数",type:"Complex[4]",inputVisible:!1,customMethod:!0,attributes:"smartAttrs.payload"},{name:"content",alias:"方法体",type:"String",default:""}],tableColumns:[{name:"label",alias:"列名称",type:"String",minlength:1,maxlength:50,default:"姓名",titleVisible:!0},{name:"type",alias:"类型",type:'Enum("selection:多选框","index:序号","text:文本","editInput:文本输入","select:下拉选择","editNumber:数字输入","timePicker:时间选择","link:链接文本", "statusTx:标签", "statusText:标签集", "switch:开关", "progress:进度条", "enumeration:枚举", "operation:操作列")',default:"text",changeHandler:"childTypeColumnsChangeHandler"},{name:"prop",alias:"属性",type:"String",value:"name"},{name:"textColor",alias:"字体颜色",type:"String",default:"",childShowCond:["text"],customGroupName:"childShowCond",visible:!1,linkable:!1,editor:"script",editorParams:{args:[{name:"row",alias:"row"},{name:"col",alias:"col"},{name:"component",alias:"component"}]},tips:"字体颜色设置，可根据条件返回颜色值，如：return row.status=='1'?'blue':'#f44';"},{name:"formatter",alias:"列格式",type:"String",default:"",visible:!1},{name:"width",alias:"宽度",type:"String",step:1,precision:0,min:0,max:1e4,default:150},{name:"fixed",alias:"固定方式",type:'Enum("no:不固定", "left:左固定", "right:右固定")',default:"no"},{name:"isHide",alias:"是否隐藏",type:"Boolean",default:!1},{name:"selectable",type:"String",alias:"禁用函数配置",editor:"script",editValue:{type:"script",content:""},childShowCond:["selection"],customGroupName:"childShowCond",linkable:!1,editorParams:{args:[{name:"row"},{name:"index"}]},tips:"仅对类型为多选框时生效"},{name:"dateType",type:'Enum("year:年", "month:月", "date:日","dates:可选多个日期", "week:周", "datetime:日期时间", "datetimerange:日期时间区间", "daterange:日期区间", "monthrange:月区间")',alias:"日期选择类型",default:"datetime",childShowCond:["timePicker"],customGroupName:"childShowCond",tips:"具体含义可以参考element-ui时间组件"},{name:"format",alias:"时间显示格式",tips:"和 element-ui 日期格式一致",type:"String",default:"yyyy-MM-dd HH:mm:ss",visible:!1,customGroupName:"childShowCond",childShowCond:["timePicker"]},{name:"valueFormat",alias:"时间绑定值格式",tips:"和 element-ui 日期格式一致",type:"String",default:"yyyy-MM-dd HH:mm:ss",visible:!1,customGroupName:"childShowCond",childShowCond:["timePicker"]},{name:"editable",alias:"文本框可输入",type:"Boolean",default:!0,visible:!1,customGroupName:"childShowCond",childShowCond:["timePicker"]},{name:"onlyRead",alias:"是否只读",type:"Boolean",default:!1,visible:!1,customGroupName:"childShowCond",childShowCond:["editInput","timePicker"]},{name:"disabled",alias:"是否禁用",type:"String",default:!1,visible:!1,customGroupName:"childShowCond",childShowCond:["editInput","editNumber","select","timePicker","switch"],tips:"所配置表达式运行结果为true则禁用，或者正常。如：row.status == 0"},{alias:"最大值",name:"mumMax",type:"Number",default:1e3,step:1,max:"Infinity",customGroupName:"childShowCond",childShowCond:["editNumber"],visible:!1,tips:"最大值需要大于最小值"},{alias:"最小值",name:"mumMin",type:"Number",default:0,step:1,max:"Infinity",customGroupName:"childShowCond",childShowCond:["editNumber"],visible:!1,tips:"最小值需要小于最大值"},{alias:"精度",name:"precision",type:"Number",default:0,step:1,min:0,max:"Infinity",customGroupName:"childShowCond",childShowCond:["editNumber"],visible:!1},{alias:"步长",name:"numStep",type:"Number",default:1,step:1,min:0,customGroupName:"childShowCond",childShowCond:["editNumber"],visible:!1},{alias:"选项数据映射",name:"selectMapping",type:"String[2]",customGroupName:"childShowCond",childShowCond:["select"],default:["label","value"],primitiveLabels:["label","value"],visible:!1,tips:"下拉选项数据字段映射。"},{name:"filterable",alias:"是否可搜索",type:"Boolean",default:!1,visible:!1,customGroupName:"childShowCond",childShowCond:["select"]},{name:"options",alias:"下拉选项数据",type:"Complex[*]",editor:"script",linkable:!0,visible:!1,customGroupName:"childShowCond",childShowCond:["select"],editorParams:{args:[{name:"row",alias:"row"},{name:"col",alias:"col"},{name:"component",alias:"component"}]},tips:"下拉选项数据",default:'return [{\n  "value": 1,\n   "label": "标签 1-1"\n }, {\n  "value": 2,\n   "label": "标签  1-2"\n }]'},{name:"dataValidation",alias:"数据校验",type:"Complex[*]",inputVisible:!1,visible:!1,customGroupName:"childShowCond",childShowCond:["editInput","editNumber","select","timePicker"],attributes:"smartAttrs.validation"},{name:"headAlign",alias:"列头对齐",type:'Enum("left:左对齐", "center:居中对齐", "right:右对齐")',default:"left"},{name:"align",alias:"内容对齐",type:'Enum("left:左对齐", "center:居中对齐", "right:右对齐")',default:"left",customGroupName:"childShowCond",childShowCond:["index","text","link","statusTx","statusText","switch","enumeration","operation","selection"]},{name:"display",alias:"进度条显示",type:'Enum("normal:原始值", "percent:百分数")',default:"percent",visible:!1,customGroupName:"childShowCond",childShowCond:["progress"],tips:"仅当该列设置为进度条类型时，控制进度条右侧显示的数值。"},{name:"sortable",alias:"排序",type:"Boolean",default:!1,customGroupName:"childShowCond",childShowCond:["enumeration","text","link","statusTx","statusText"]},{name:"customSortable",alias:"是否远程排序",type:"Boolean",default:!1,customGroupName:"childShowCond",childShowCond:["enumeration","text","link","statusTx","statusText"]},{name:"iconshow",alias:"图标",type:"String",default:"",editor:"icon",editorParams:{withContent:!1},visible:!1,customGroupName:"childShowCond",childShowCond:["text","link"]},{name:"formatScript",alias:"格式化脚本",type:"Boolean",customGroupName:"childShowCond",childShowCond:["text","link"],editor:"script",linkable:!1,editorParams:{args:[{name:"row",alias:"row"},{name:"col",alias:"col"},{name:"component",alias:"component"}]},default:""},{alias:"开关开值类型",name:"activeValueType",type:'Enum("String:字符串", "Number:数字")',default:"String",visible:!1,customGroupName:"childShowCond",childShowCond:["switch"]},{alias:"开关开值",name:"activeValue",type:"String",minlength:0,maxlength:50,default:"",tips:"仅当该列设置为开关类型时生效。当此值设置后，绑定值等于此值时组件将显示为【开】状态，不等于此值时则为【关】状态",visible:!1,customGroupName:"childShowCond",childShowCond:["switch"]},{alias:"开关关值",name:"inactiveValue",type:"String",minlength:0,maxlength:50,default:"",tips:"仅当该列设置为开关类型时生效。当此值设置后，绑定值等于此值时组件将显示为【开】状态，不等于此值时则为【关】状态",visible:!1,customGroupName:"childShowCond",childShowCond:["switch"]},{alias:"输入框点击事件",name:"inputClick",type:"Complex",editor:"events",customGroupName:"childShowCond",childShowCond:["editInput"],visible:!1,attributes:[{name:"content",alias:"执行内容",type:"Complex[*]",inputVisible:!1,attributes:"smartAttrs.eventContent"},{name:"description",alias:"事件描述",type:"String",readonly:!0,editor:"code",visible:!1,default:"输入框点击事件"},{name:"payload",alias:"参数",type:"Complex[1]",readonly:!0,inputVisible:!1,attributes:"smartAttrs.payload",default:[{name:"index",alias:"当前行号"},{name:"row",alias:"当前行"},{name:"column",alias:"当前列"},{name:"columns",alias:"所有列（不包含操作列）"}]}]},{alias:"输入框失焦事件",name:"inputBlur",type:"Complex",editor:"events",customGroupName:"childShowCond",childShowCond:["editInput"],visible:!1,attributes:[{name:"content",alias:"执行内容",type:"Complex[*]",inputVisible:!1,attributes:"smartAttrs.eventContent"},{name:"description",alias:"事件描述",type:"String",readonly:!0,editor:"code",visible:!1,default:"输入框失焦事件"},{name:"payload",alias:"参数",type:"Complex[1]",readonly:!0,inputVisible:!1,attributes:"smartAttrs.payload",default:[{name:"index",alias:"当前行号"},{name:"value",alias:"当前值"},{name:"row",alias:"当前行"},{name:"column",alias:"当前列"},{name:"columns",alias:"所有列（不包含操作列）"}]}]},{alias:"值改变事件",name:"valChange",editor:"events",type:"Complex",customGroupName:"childShowCond",childShowCond:["select","editNumber","timePicker"],attributes:[{name:"content",alias:"执行内容",type:"Complex[*]",inputVisible:!1,attributes:"smartAttrs.eventContent"},{name:"description",alias:"事件描述",type:"String",readonly:!0,editor:"code",visible:!1,default:"值改变事件"},{name:"payload",alias:"参数",type:"Complex[1]",readonly:!0,inputVisible:!1,attributes:"smartAttrs.payload",default:[{name:"value",alias:"当前值"},{name:"row",alias:"当前行"}]}]},{alias:"超链接点击事件",name:"linkClick",type:"Complex",editor:"events",customGroupName:"childShowCond",childShowCond:["link"],visible:!1,attributes:[{name:"content",alias:"执行内容",type:"Complex[*]",inputVisible:!1,attributes:"smartAttrs.eventContent"},{name:"description",alias:"事件描述",type:"String",readonly:!0,editor:"code",visible:!1,default:"超链接点击事件"},{name:"payload",alias:"参数",type:"Complex[1]",readonly:!0,inputVisible:!1,attributes:"smartAttrs.payload",default:[{name:"row",alias:"当前行"},{name:"column",alias:"当前列"},{name:"columns",alias:"所有列（不包含操作列）"}]}]},{alias:"开关事件",name:"switchChange",type:"Complex",editor:"events",visible:!1,customGroupName:"childShowCond",childShowCond:["switch"],attributes:[{name:"content",alias:"事件执行内容",type:"Complex[*]",inputVisible:!1,attributes:"smartAttrs.eventContent"},{name:"description",alias:"事件描述",type:"String",default:"点击开关触发的动作",readonly:!0},{name:"payload",alias:"参数",type:"Complex[2]",readonly:!0,inputVisible:!1,attributes:"smartAttrs.payload",default:[{name:"value",alias:"当前开关值"},{name:"row",alias:"当前行"}]}]},{alias:"悬停事件",name:"mouseHover",type:"Complex",editor:"events",customGroupName:"childShowCond",childShowCond:["text","link"],visible:!1,attributes:[{name:"content",alias:"执行内容",type:"Complex[*]",inputVisible:!1,attributes:"smartAttrs.eventContent"},{name:"description",alias:"事件描述",type:"String",default:"鼠标悬停事件触发的动作",readonly:!0},{name:"payload",alias:"参数",type:"Complex[1]",readonly:!0,inputVisible:!1,attributes:"smartAttrs.payload",default:[{name:"index",alias:"当前行号"},{name:"row",alias:"当前行"},{name:"column",alias:"当前列"},{name:"columns",alias:"所有列（不包含操作列）"}]}]},{alias:"枚举数据映射",name:"enumMapping",type:"String[3]",customGroupName:"childShowCond",childShowCond:["enumeration","statusText","statusTx"],default:["name","value","type"],primitiveLabels:["name","value","type"],visible:!1,tips:"枚举数据字段映射。"},{name:"enumeration",alias:"枚举数据配置",type:"Complex[*]",customGroupName:"childShowCond",childShowCond:["enumeration","statusText","statusTx"],editor:"code",default:[{name:"启用",value:"1"}],visible:!1},{name:"operationList",alias:"操作列按钮配置",type:"String",childShowCond:[],visible:!1,customGroupName:"childShowCond",default:"",tips:"仅当该列设置为操作类型时生效。格式例 ：[{label:'按钮1'}]"},{name:"operationEvents",alias:"操作列按钮配置",type:"Complex[*]",customGroupName:"childShowCond",childShowCond:["operation"],inputVisible:!1,attributes:[{name:"name",alias:"按钮名称",type:"String",titleVisible:!0},{name:"isNameShow",alias:"显示名称",type:"Boolean",default:!0,tips:"选中显示名称，否则隐藏名称，名称作为提示"},{name:"btnType",alias:"按钮类型",type:'Enum("text:文字按钮", "primary:主要按钮", "success:成功按钮", "info:信息按钮", "warning:警告按钮", "danger:危险按钮")',default:"text",tips:"操作按钮的类型"},{name:"textBtnType",alias:"文字按钮类型",type:'Enum("primary:主要", "danger:危险",  "success:成功", "info:信息", "warning:警告")',default:"primary",visible:!0,tips:"文字按钮的类型"},{name:"icon",alias:"图标",type:"String",default:"",editor:"icon",editorParams:{withContent:!1}},{name:"permission",alias:"权限",type:"Complex",attributes:[{name:"permissionId",alias:"关联权限",type:"Complex",editor:"permission",editorParams:{moduleType:2,key:"permissionIdentifier"}}]},{name:"isBtnShow",alias:"隐藏条件",type:"String",default:!1,tips:"所配置表达式运行结果为true则隐藏，或者显示。如：row.status != 0"},{name:"isBtnDisabled",alias:"禁用条件",type:"String",default:!1,tips:"所配置表达式运行结果为true则禁用，或者正常。如：row.status == 0"},{name:"content",alias:"按钮点击事件",type:"Complex[*]",inputVisible:!1,attributes:"smartAttrs.eventContent"},{name:"payload",alias:"参数",type:"Complex[2]",readonly:!0,inputVisible:!1,visible:!1,attributes:"smartAttrs.payload",default:[{name:"btn",alias:"当前按钮配置"},{name:"row",alias:"当前行"},{name:"index",alias:"当前行序号"}]}],tips:"仅当该列设置为操作类型时生效。格式例 ：[{label:'按钮1'}]",visible:!1},{name:"downBtnNum",alias:"下拉按钮个数",type:"Number",min:0,step:1,max:10,customGroupName:"childShowCond",childShowCond:["operation"],default:0,tips:"默认0时表示没有下拉，当值为n(n>0)时下拉展示后面n个按钮。",visible:!1},{name:"moreDownText",alias:"下拉名称",type:"String",customGroupName:"childShowCond",childShowCond:["operation"],tips:"有下拉按钮时，设置下拉名称",default:"更多",visible:!1}]},n.a)},a337:function(e,t,a){"use strict";var i={name:"ConfirmDialog",props:{visible:{type:Boolean,default:!1},content:{type:String,default:""}},methods:{handleClose:function(e){this.$emit("close",e)},handleSubmit:function(e){this.$emit("submit",e)}}},n=(a("0501"),a("2877")),r=Object(n.a)(i,(function(){var e=this,t=e._self._c;return t("el-dialog",{staticClass:"el-message-box__wrapper",attrs:{draggable:!1,visible:e.visible,"close-on-click-modal":!1,"modal-append-to-body":!0,title:"提示",width:"400px","custom-class":"complex-confirm el-message-box","append-to-body":!0},on:{close:e.close}},[t("div",{staticClass:"el-message-box__content"},[t("div",{staticClass:"el-message-box__container"},[t("div",{staticClass:"el-message-box__status el-icon-warning"}),t("div",{staticClass:"el-message-box__message"},[t("p",[e._v(e._s(e.content))])])])]),t("div",{staticClass:"el-message-box__btns",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.handleClose}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.handleSubmit}},[e._v("继续")])],1)])}),[],!1,null,null,null);t.a=r.exports},a525:function(e,t,a){"use strict";a("bb57")},a542:function(e,t,a){"use strict";a("8e6e"),a("ac6a"),a("456d"),a("6b54");var i,n=a("7618"),r=(a("7f7f"),a("7514"),a("a481"),a("28a5"),a("d225")),o=a("b0b4"),l=a("bd86"),s=a("c276"),c=a("b19c");function u(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function d(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?u(Object(a),!0).forEach((function(t){Object(l.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):u(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var p=function(){function e(t){Object(r.a)(this,e),this.str=t,this.result=null,this.init()}return Object(o.a)(e,[{key:"init",value:function(){this.baseType(),this.baseTypeAttach(),this.baseTypeLength(),this.baseTypeAttachLength()}},{key:"baseType",value:function(){var e=/^(Readonly|String|Number|Boolean|Enum|Complex)$/g.exec(this.str);e&&(this.result={type:e[1],attachType:0,attach:[],isLen:!1,len:0})}},{key:"baseTypeAttach",value:function(){var e=/^(Readonly|String|Number|Boolean|Enum|Complex)\((.+)\)$/g.exec(this.str);if(e){var t=e[2].split(",").map((function(e){return e.replace(/^\s+|\s+$/g,"")}));if("*"!==t[0]){var a=this.getAttachObject(t,e[1]);this.result=Object.assign(a,{type:e[1],isLen:!1,len:0})}}}},{key:"getAttachObject",value:function(e,t){return/^('|")(.+)('|")$/g.exec(e[0])?{attachType:1,attach:e.map((function(e,a){var i=e.replace(/'|"/g,"").split(":"),n=(i[1]||"").replace(/%3A/g,":"),r=(i[0]||"").replace(/%3A/g,":");return"Boolean"===t?{value:!!a,label:n||r}:{value:r,label:n||r}}))}:{attachType:2,attach:e}}},{key:"baseTypeLength",value:function(){var e=/^(Readonly|String|Number|Boolean|Enum|Complex)\[([0-9*]+)\]$/g.exec(this.str);e&&(this.result={type:e[1],attachType:0,attach:[],isLen:!0,len:e[2]})}},{key:"baseTypeAttachLength",value:function(){var e=/^(Readonly|String|Number|Boolean|Enum|Complex)\((.+)\)\[([0-9*]+)\]$/g.exec(this.str);if(e){var t=e[2].split(",").map((function(e){return e.replace(/^\s+|\s+$/g,"")}));if("*"!==t[0]){var a=this.getAttachObject(t);this.result=Object.assign(a,{type:e[1],isLen:!0,len:e[2]})}}}},{key:"getBaseType",value:function(){return this.result?this.result.type:""}},{key:"getAttachType",value:function(){return this.result?this.result.attachType:0}},{key:"getAttach",value:function(){return this.result?this.result.attach:[]}},{key:"getIsLen",value:function(){return!!this.result&&this.result.isLen}},{key:"getLen",value:function(){return this.result?this.result.len:0}},{key:"getResult",value:function(){return this.result}},{key:"destroy",value:function(){this.str=null,this.result=null}}],[{key:"getValue",value:function(e){return Object(s.pb)(e.value,e.default)}},{key:"formatValue",value:function(e,t,a){var i,r=this;if(e.length){var o=null;if("string"==typeof t)o=e.find((function(e){return r.getValue(e.name)===t}));else if(Array.isArray(null==t||null===(i=t.linkConfig)||void 0===i?void 0:i.variable)){var l,s=(null==t||null===(l=t.linkConfig)||void 0===l?void 0:l.variable)||[];o=(o=e.find((function(e){return r.getValue(e.name)===(null==s?void 0:s[0])})))&&s.reduce((function(e,t){return"object"===Object(n.a)(e.name)&&r.getValue(e.name)===t?e:"object"===Object(n.a)(null==e?void 0:e.objectAttr)?((null===(a=e.objectAttr)||void 0===a?void 0:a.attributes)||[]).find((function(e){return r.getValue(e.name)===t})):e;var a}),o)}return o?this.formatValueByCustom(o,t,a):a}}},{key:"formatValueByCustom",value:function(e,t,a){var i="object"===Object(n.a)(null==e?void 0:e.type)&&this.getValue(e.type);if(!i)return a;var r=this.formatEmpty(d(d({},e),{},{value:{value:a}}));if(void 0!==r){switch(i){case"String":r=this.toString(r);break;case"Number":r=this.toNumber(r);break;case"Boolean":r=this.toBoolean(r);break;case"Enum":r=this.toEnum(r);break;case"Complex":r=this.toComplex(r)}return r}}},{key:"getEmptyValue",value:function(e){switch(this.getValue(e)){case"undefined":return;case"emptyString":return"";case"emptyArray":return[];case"emptyObject":return{}}}},{key:"formatEmpty",value:function(e){var t=e.empty,a=e.value,i=this.getValue(a);return void 0===i||void 0===i||""===i?this.getEmptyValue(t):i}},{key:"toString",value:function(e){var t=e;try{"string"!=typeof e&&(t=e.toString().valueOf())}catch(e){}return t}},{key:"toNumber",value:function(e){var t=e;try{"number"!=typeof e&&(t=+e,isNaN(t)&&(t=e))}catch(e){}return t}},{key:"toBoolean",value:function(e){var t=e;try{"boolean"!=typeof e&&(t="false"!==e&&!!e)}catch(e){}return t}},{key:"toEnum",value:function(e){var t=e;try{Array.isArray(e)||(t=JSON.parse(e)),Array.isArray(t)||(t=e)}catch(e){}return t}},{key:"toComplex",value:function(e){var t=e;try{"string"==typeof e&&(t=Object(c.a)(e)),"Object"!==Object.prototype.toString.call(t).slice(8,-1)&&(t=e)}catch(e){}return t}}]),e}();i=p,Object(l.a)(p,"BASE_EMPTY",'Enum("undefined": "未定义")'),Object(l.a)(p,"TYPE_MAP",{String:'Enum("undefined": "未定义", "emptyString": "空字符串")',Number:i.BASE_EMPTY,Boolean:i.BASE_EMPTY,Enum:'Enum("undefined": "未定义", "emptyArray": "空数组")',Complex:'Enum("undefined": "未定义", "emptyObject": "空对象")'}),t.a=p},a564:function(e,t,a){},a599:function(e,t,a){"use strict";var i=new(a("2b0e").default);t.a=i},a5bf:function(e,t,a){"use strict";a("8192")},a6a7:function(e,t,a){"use strict";a("b58d")},a797:function(e,t,a){"use strict";a("446d")},a80d:function(e,t,a){"use strict";a("f4ce")},aaa2:function(e,t,a){},ad63:function(e,t,a){"use strict";a("dbc2")},ae7f:function(e,t,a){},ae83:function(e,t,a){"use strict";var i={name:"CommonAlert",props:{title:{type:String,default:""},ellipsis:{type:Boolean,default:!1},show:{type:Boolean,default:!0}},data:function(){return{}},computed:{contentStyle:function(){return this.ellipsis?{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}:{}}},methods:{handleClose:function(){this.show=!1,this.$emit("showCloseTips")}}},n=(a("6e2f"),a("2877")),r=Object(n.a)(i,(function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"show",rawName:"v-show",value:e.show,expression:"show"}],staticClass:"common-alert t-color-primary-light-9__bg"},[t("div",{staticClass:"common-alert-content t-text-regular",style:e.contentStyle},[e._t("default",(function(){return[e._v("\n      "+e._s(e.title)+"\n    ")]}))],2),t("div",{staticClass:"common-alert-opt"},[t("i",{staticClass:"el-icon-close t-text-secondary",on:{click:e.handleClose}})])])}),[],!1,null,"3dcead2c",null);t.a=r.exports},aeb2:function(e,t,a){"use strict";a("7f7f");var i=(a("8e6e"),a("ac6a"),a("456d"),a("bd86"));function n(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}a("c5f6");var r={name:"MoreInfo",props:{list:{type:Array,default:function(){return[]}},span:{type:Number,default:6},prop:{type:Object,default:function(){return{prop:"prop",name:"name",value:"value"}}}},computed:{ownProp:function(){return function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?n(Object(a),!0).forEach((function(t){Object(i.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):n(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({prop:"prop",name:"name",value:"value"},this.prop)}}},o=(a("9217"),a("2877")),l=Object(o.a)(r,(function(){var e=this,t=e._self._c;return t("div",[t("el-row",{attrs:{gutter:12}},e._l(e.list,(function(a){return t("el-col",{key:a[e.ownProp.prop||e.ownProp.name],attrs:{span:e.span}},[t("div",{staticClass:"info-wrapper"},[t("div",{staticClass:"info-name",attrs:{title:a[e.ownProp.name]}},[e._v(e._s(a[e.ownProp.name])+"：")]),t("div",{staticClass:"info-value",attrs:{title:a[e.ownProp.value]}},[e._v(e._s(a[e.ownProp.value]))])])])})),1)],1)}),[],!1,null,"35ac6909",null);t.a=l.exports},aef0:function(e,t,a){"use strict";a("f147")},afcd:function(e,t,a){},b0f5:function(e,t,a){"use strict";a("8c7a")},b16c:function(e,t,a){"use strict";a("572a")},b19c:function(e,t,a){"use strict";a.d(t,"g",(function(){return l})),a.d(t,"e",(function(){return s})),a.d(t,"j",(function(){return c})),a.d(t,"b",(function(){return u})),a.d(t,"f",(function(){return d})),a.d(t,"d",(function(){return p})),a.d(t,"c",(function(){return h})),a.d(t,"h",(function(){return f})),a.d(t,"a",(function(){return m})),a.d(t,"i",(function(){return v})),a("8e6e"),a("ac6a"),a("456d"),a("9253"),a("28a5"),a("386d");var i=a("bd86"),n=a("7618");function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){Object(i.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}a("6b54");var l=function(e){var t=Object.prototype.toString;return e instanceof Element?"element":{"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object AsyncFunction]":"asyncFunction","[object Array]":"array","[object Date]":"date","[object RegExp]":"regExp","[object Undefined]":"undefined","[object Null]":"null","[object Object]":"object"}[t.call(e)]},s=function e(t){var a,i=l(t);if("array"===i)a=[];else{if("object"!==i)return t;a={}}if("array"===i)for(var n=0,r=t.length;n<r;n++)a.push(e(t[n]));else if("object"===i)for(var o in t)a[o]=e(t[o]);return a},c=function(e){try{e=JSON.parse(e)}catch(e){}return e},u=function(e,t,a){if(t=t||null,a=a||0,"object"!==Object(n.a)(e))return e;try{e=JSON.stringify(e,t,a)}catch(e){}return e};function d(e,t,a){var i=a?new Blob([t],{type:a}):new Blob([t]),n=document.createElement("a");n.download=e,n.href=URL.createObjectURL(i),document.body.appendChild(n),n.click(),document.body.removeChild(n)}var p=function(e){var t,a,i=null===(t=window)||void 0===t||null===(a=t.$common)||void 0===a?void 0:a.$util;return i?i.base64Encode(e):e},h=function(e){var t,a,i=null===(t=window)||void 0===t||null===(a=t.$common)||void 0===a?void 0:a.$util;return i?i.base64Decode(e):e},f=function(e,t){if("object"===l(e)){var a=e.args?h(e.args):null;return o(o({},e),a)}var i=window.location.search.substring(1);e&&(i=e.substring(e.indexOf("?")+1));for(var n=i.split("&"),r={},s=0;s<n.length;s++){var c=n[s].split("=");2===c.length&&Reflect.set(r,c[0],window.decodeURIComponent(c[1]))}return t?r.hasOwnProperty(t)?r[t]:void 0:r},m=function(e){var t=Function;try{return new t("return "+e)()}catch(a){return new t(e)()}};function v(e,t){var a=!0,i=function e(t,i){if(Object(n.a)(t)!==Object(n.a)(i))return a=!1,!1;if("object"!==Object(n.a)(t)&&"object"!==Object(n.a)(i)&&t!==i)return a=!1,!1;if(t instanceof Array&&i instanceof Array&&r(t,i),t instanceof Object&&i instanceof Object){var o=Object.getOwnPropertyNames(t).filter((function(e){return"__ob__"!==e})),l=Object.getOwnPropertyNames(i).filter((function(e){return"__ob__"!==e}));if(o.length!==l.length)return a=!1,!1;for(var s=0;s<o.length;s++){var c=o[s];e(t[c],i[c])}}},r=function(e,t){if(e.length!==t.length)return a=!1,!1;for(var n=0;n<e.length;n++){var r=n,o=e[r],l=t[r];i(o,l)}};return i(e,t),a}},b216:function(e,t,a){"use strict";a("d7ab")},b33b:function(e,t,a){"use strict";a("c17c")},b468:function(e,t,a){},b4af:function(e,t,a){},b523:function(e,t,a){"use strict";a("e38e")},b542:function(e,t,a){"use strict";a("4f5d")},b58d:function(e,t,a){},b68b:function(e,t,a){},b93f:function(e,t,a){},b996:function(e,t,a){"use strict";a("708f")},b9f2:function(e,t,a){"use strict";a("4c93")},bb50:function(e,t,a){"use strict";a("21c7")},bb57:function(e,t,a){},bc20:function(e,t,a){},bc2d:function(e,t,a){"use strict";var i=(a("8e6e"),a("456d"),a("75fc")),n=(a("28a5"),a("7f7f"),a("ac6a"),a("7514"),a("bd86")),r=a("b19c"),o=a("c276");function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){Object(n.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var c=function(e){var t={};for(var a in e){var i=e[a];"name"===a?t.name=Object(o.pb)(i.value,i.default):"alias"===a?t.alias=Object(o.pb)(i.value,i.default):"description"===a?t.description=Object(o.pb)(i.value,i.default):"editor"===a&&(t.editor=Object(o.pb)(i.value,i.default))}return t},u={name:"PaginationSetting",props:{value:{type:Object,default:function(){return{enabled:1,page:"",pageSize:""}}}},watch:{"value.page":{handler:function(e){if(""!==e){var t=this.getEditValue(e);this.pageParam=s(s({},this.pageParam),{},{editValue:t}),this.updateParamComp("pageParam",t)}},immediate:!0},"value.pageSize":{handler:function(e){if(""!==e){var t=this.getEditValue(e);this.pageSizeParam=s(s({},this.pageSizeParam),{},{editValue:t}),this.updateParamComp("pageSizeParam",t)}},immediate:!0}},methods:{resetParams:function(){var e={static:"",type:"variable",variable:[]};this.pageParam={name:"",value:"",filter:"",editValue:e},this.pageSizeParam={name:"",value:"",filter:"",editValue:e},this.updateParamComp("pageParam",e),this.updateParamComp("pageSizeParam",e)},updateParamComp:function(e,t){var a=this;e&&this.$refs[e]&&this.$nextTick((function(){a.$refs[e].initData(),a.$refs[e].editValType=t.type,a.$refs[e].editValStaticVar="static"===t.type?t.static:(null==t?void 0:t.variable.length)>0?"${".concat(null==t?void 0:t.variable.join("."),"}"):"",a.$refs[e].selectLabel=a.compoundItem.find((function(e){return e.value===t.type}))}))},getPayloads:function(e){var t=[];if("array"===Object(r.g)(e))e.forEach((function(e){if(!t.length){var a="payload"===e.name?e.attributes:e.payload?e.payload.attributes:null;a&&a.forEach((function(e){var a=c(e);t.push(a)}))}}));else if("object"===Object(r.g)(e))for(var a in e)if("payload"===a){e[a].attributes.forEach((function(e){var a=c(e);t.push(a)}))}return t},onChange:function(){this.$emit("change",this.value)},pageOnChange:function(e){this.value.page=e,this.$emit("change",this.value)},pageSizeOnChange:function(e){this.value.pageSize=e,this.$emit("change",this.value)},getEditValue:function(e){var t,a=/\$\{(.*?)\}/g.exec(e);return(null==a?void 0:a[0])===e?{static:"",type:"variable",variable:null===(t=a[1])||void 0===t?void 0:t.split(".")}:{static:e,type:"static",variable:[]}}},data:function(){return{compoundItem:[{label:"变量选择",value:"variable",formItem:"variable-Panel"},{label:"手动输入",value:"static",formItem:"input",tips:"支持字符、${...}、字符与${...}混合三种形式的输入，${...}是对变量的引用，其中...为变量名"}],pageParam:{name:"",value:"",filter:"",editValue:{type:"variable",static:null,variable:[],useExpression:!1}},pageSizeParam:{name:"",value:"",filter:"",editValue:{type:"variable",static:null,variable:[],useExpression:!1}}}},computed:{newArgs:function(){if(this.args&&this.args.length)return Object(i.a)(this.args);var e=this.getPayloads(this.parent&&this.parent.attributes);return e.length>0?e:(e=this.getPayloads(this.parentParent&&this.parentParent.attributes)).length>0?e:[]}}},d=(a("b523"),a("2877")),p=Object(d.a)(u,(function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"setting-row"},[t("div",{staticClass:"setting-content"},[t("variable-editor-components",{ref:"pageSizeParam",attrs:{compoundItem:e.compoundItem,data:e.pageSizeParam,args:e.newArgs},on:{change:e.pageSizeOnChange}})],1),t("div",{staticClass:"setting-title"},[e._v("条（单页）")])]),t("div",{staticClass:"setting-row"},[t("div",{staticClass:"setting-content"},[t("variable-editor-components",{ref:"pageParam",attrs:{compoundItem:e.compoundItem,data:e.pageParam,args:e.newArgs},on:{change:e.pageOnChange}})],1),t("div",{staticClass:"setting-title"},[e._v("页")])])])}),[],!1,null,"e755c2e0",null);t.a=p.exports},bc7a:function(e,t,a){},bcdb:function(e,t,a){},bd0e:function(e,t,a){"use strict";a("f5a7")},bd66:function(e,t,a){},bd89:function(e,t,a){"use strict";a("9fb0")},bd9c:function(e,t,a){},be37:function(e,t,a){"use strict";a("9262")},be66:function(e,t,a){"use strict";a("54ca")},bed3:function(e,t,a){"use strict";a("b4af")},bf78:function(e,t,a){"use strict";a("e0ff")},bff0:function(e,t,a){},c16a:function(e,t,a){"use strict";a.r(t);var i=(a("386d"),a("7f7f"),a("9253"),a("b19c")),n={name:"ReportEditor",components:{},props:{iconClass:{type:String,default:function(){return"el-icon-edit"}},data:{type:Object,default:function(){return{alias:"",type:"",default:"",value:"",primitiveLabels:""}}},placeholder:{type:String,default:""},handleRulesResult:{type:Function,default:function(){}},handleChangeResult:{type:Function,default:function(){}}},computed:{fetchOption:function(){return{url:"/api/report/reports",params:this.filterData}},tableColumn:function(){var e=this;return[{prop:"name",label:"名称",show:!0,filter:{type:"input",operator:"like"}},{prop:"templateFilter",label:"是否模板",show:!1,filterOnly:!0,filter:{type:"select",operator:"=",keep:!0,options:this.templateOptions,defaultValue:this.fetchInfo?this.fetchInfo.templateFilter:0,clearable:!1}},{prop:"reportType",label:"报表类型",show:!0,filter:{type:"select",options:this.typeOptions,operator:"="},render:function(t,a){return t("span",{props:{text:"text"}},e.typeMap["".concat(a.type)])}}]}},data:function(){var e=[{label:"数据报表",value:"datainfo"},{label:"图形报表",value:"chartinfo"},{label:"打印设计",value:"printinfo"}],t=e.reduce((function(e,t){return Reflect.set(e,t.value,t.label),e}),{});return{fetchInfo:{templateFilter:0,id:"",name:""},fetchProps:{label:"name"},templateOptions:[{label:"是",value:1},{label:"否",value:0}],typeOptions:e,typeMap:t,showVal:null,editorVal:{},dialogVisible:!1,reportId:"",filterData:{templateFilter:0,name:""}}},watch:{data:{handler:function(){this.initData()},deep:!0}},created:function(){this.initData()},methods:{filterDataChange:function(e){this.filterData=e,e&&e.reportType?this.$set(this.filterData,"reportType",e.reportType):delete this.filterData.reportType},onValueChange:function(e,t){var a={name:t.name,id:t.id,templateFilter:t.template||0};!1!==this.handleChangeResult(a,this.data)?(this.$setAttr(this.data,"value",a),this.$setAttr(this.data,"lastValue",a)):this.$setAttr(this.data,"lastValue",this.data.lastValue)},reset:function(e){setTimeout((function(){e&&e.search()}),100)},formatterDate:function(e){return(0,window.$lib.moment)(e).format("YYYY-MM-DD HH:mm:ss")},initData:function(){var e,t=this;e=this.data.hasOwnProperty("value")?Object(i.e)(this.data.value):Object(i.e)(this.data.default),this.reportId=e&&e.id,this.fetchInfo=e,setTimeout((function(){t.$refs.selectorTable&&t.$refs.selectorTable.init()}),0)},handleSelectorTableBeforeClose:function(){this.$refs.selectorTable&&this.$refs.selectorTable.$refs.filter&&this.$refs.selectorTable.$refs.filter.handleFilterReset()}}},r=(a("1a85"),a("2877")),o=Object(r.a)(n,(function(){var e=this,t=e._self._c;return t("div",[t("selector-table",{ref:"selectorTable",attrs:{title:"请选择报表",dialogWidth:"1200px",fetchOption:e.fetchOption,fetchInfo:e.fetchInfo,column:e.tableColumn,filterLgSpan:6,defaultValueSearch:!0,clearable:!1,props:e.fetchProps},on:{change:e.onValueChange,reset:e.reset,filterDataChange:e.filterDataChange,"before-close":e.handleSelectorTableBeforeClose},model:{value:e.reportId,callback:function(t){e.reportId=t},expression:"reportId"}})],1)}),[],!1,null,null,null);t.default=o.exports},c17c:function(e,t,a){},c1a8:function(e,t,a){"use strict";a("997d")},c276:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return CONST})),__webpack_require__.d(__webpack_exports__,"f",(function(){return LAYOUT_COM_CONST})),__webpack_require__.d(__webpack_exports__,"c",(function(){return DATA_CONTAINER_TYPES_CONST})),__webpack_require__.d(__webpack_exports__,"b",(function(){return CONTAINER_TYPES_CONST})),__webpack_require__.d(__webpack_exports__,"g",(function(){return LAZY_COMPONENTS_CONST})),__webpack_require__.d(__webpack_exports__,"d",(function(){return EXP_SUFFIX_UID})),__webpack_require__.d(__webpack_exports__,"j",(function(){return REG_VARIBALE_ATTR})),__webpack_require__.d(__webpack_exports__,"h",(function(){return REG_SDC_INNER_COMP_NAME})),__webpack_require__.d(__webpack_exports__,"i",(function(){return REG_VARIABLE_STR})),__webpack_require__.d(__webpack_exports__,"e",(function(){return FORMAT_EXTENDS_DATA_TYPES})),__webpack_require__.d(__webpack_exports__,"ob",(function(){return getUid})),__webpack_require__.d(__webpack_exports__,"jb",(function(){return getSign})),__webpack_require__.d(__webpack_exports__,"W",(function(){return getConvertedComponent})),__webpack_require__.d(__webpack_exports__,"xb",(function(){return mergeDataByValueData})),__webpack_require__.d(__webpack_exports__,"w",(function(){return concatFromPageEvents})),__webpack_require__.d(__webpack_exports__,"T",(function(){return getComponentKV})),__webpack_require__.d(__webpack_exports__,"U",(function(){return getComponentPageData})),__webpack_require__.d(__webpack_exports__,"Q",(function(){return getComponentData})),__webpack_require__.d(__webpack_exports__,"kb",(function(){return getSmartAttrs})),__webpack_require__.d(__webpack_exports__,"K",(function(){return forEachAttrs})),__webpack_require__.d(__webpack_exports__,"o",(function(){return autoBindDataContainerChild})),__webpack_require__.d(__webpack_exports__,"Bb",(function(){return replaceComponentAttrScopedVars})),__webpack_require__.d(__webpack_exports__,"P",(function(){return getComponentCopyData})),__webpack_require__.d(__webpack_exports__,"Db",(function(){return setCustomGroupNames})),__webpack_require__.d(__webpack_exports__,"Cb",(function(){return resetChildAttrs})),__webpack_require__.d(__webpack_exports__,"A",(function(){return convertedComponentData})),__webpack_require__.d(__webpack_exports__,"rb",(function(){return isBlank})),__webpack_require__.d(__webpack_exports__,"lb",(function(){return getTabsChildrenIndex})),__webpack_require__.d(__webpack_exports__,"nb",(function(){return getThemeValueByName})),__webpack_require__.d(__webpack_exports__,"pb",(function(){return getValueByDefault})),__webpack_require__.d(__webpack_exports__,"Fb",(function(){return transformHump})),__webpack_require__.d(__webpack_exports__,"L",(function(){return formatDateValue})),__webpack_require__.d(__webpack_exports__,"ub",(function(){return isPercent})),__webpack_require__.d(__webpack_exports__,"sb",(function(){return isColor})),__webpack_require__.d(__webpack_exports__,"R",(function(){return getComponentInstance})),__webpack_require__.d(__webpack_exports__,"S",(function(){return getComponentInstanceMethod})),__webpack_require__.d(__webpack_exports__,"Y",(function(){return getCustomGroupNames})),__webpack_require__.d(__webpack_exports__,"qb",(function(){return getValueByObjectKey})),__webpack_require__.d(__webpack_exports__,"yb",(function(){return pageLogInfo})),__webpack_require__.d(__webpack_exports__,"ib",(function(){return getReplacedMessage})),__webpack_require__.d(__webpack_exports__,"x",(function(){return convertDataType})),__webpack_require__.d(__webpack_exports__,"hb",(function(){return getPageVariables})),__webpack_require__.d(__webpack_exports__,"ab",(function(){return getCustomVariables})),__webpack_require__.d(__webpack_exports__,"H",(function(){return filterScript})),__webpack_require__.d(__webpack_exports__,"tb",(function(){return isObject})),__webpack_require__.d(__webpack_exports__,"l",(function(){return addLocalComponents})),__webpack_require__.d(__webpack_exports__,"F",(function(){return deleteComponentByFid})),__webpack_require__.d(__webpack_exports__,"I",(function(){return findComponentByFid})),__webpack_require__.d(__webpack_exports__,"E",(function(){return defaultGroup})),__webpack_require__.d(__webpack_exports__,"eb",(function(){return getNewUnrepeatedKeyInObj})),__webpack_require__.d(__webpack_exports__,"cb",(function(){return getDeepConstByStr})),__webpack_require__.d(__webpack_exports__,"p",(function(){return camelCase})),__webpack_require__.d(__webpack_exports__,"M",(function(){return formatPayloads})),__webpack_require__.d(__webpack_exports__,"vb",(function(){return listToTree})),__webpack_require__.d(__webpack_exports__,"z",(function(){return convertTree})),__webpack_require__.d(__webpack_exports__,"X",(function(){return getCopyNameByNextSibling})),__webpack_require__.d(__webpack_exports__,"O",(function(){return getAllChildComponentFids})),__webpack_require__.d(__webpack_exports__,"t",(function(){return clipboardCopy})),__webpack_require__.d(__webpack_exports__,"u",(function(){return clipboardPaste})),__webpack_require__.d(__webpack_exports__,"v",(function(){return complex2NormalData})),__webpack_require__.d(__webpack_exports__,"Eb",(function(){return sleepWait})),__webpack_require__.d(__webpack_exports__,"bb",(function(){return getDeepComplexValue})),__webpack_require__.d(__webpack_exports__,"gb",(function(){return getPageIframesPageKV})),__webpack_require__.d(__webpack_exports__,"fb",(function(){return getPageIframesComponentKV})),__webpack_require__.d(__webpack_exports__,"Ab",(function(){return reloadAttrsOfGroup})),__webpack_require__.d(__webpack_exports__,"mb",(function(){return getTempPageParserStartPageId})),__webpack_require__.d(__webpack_exports__,"wb",(function(){return loadPageParser})),__webpack_require__.d(__webpack_exports__,"G",(function(){return deletePageParserInstance})),__webpack_require__.d(__webpack_exports__,"r",(function(){return checkPageIdAndFid})),__webpack_require__.d(__webpack_exports__,"q",(function(){return checkComponentName})),__webpack_require__.d(__webpack_exports__,"db",(function(){return getIframeNamesFromLinkIdAttrs})),__webpack_require__.d(__webpack_exports__,"k",(function(){return StringToArray})),__webpack_require__.d(__webpack_exports__,"zb",(function(){return parseUrlQuery})),__webpack_require__.d(__webpack_exports__,"Gb",(function(){return transformSnippet})),__webpack_require__.d(__webpack_exports__,"V",(function(){return getComponentTipsList})),__webpack_require__.d(__webpack_exports__,"Z",(function(){return getCustomMethodFunction})),__webpack_require__.d(__webpack_exports__,"y",(function(){return convertSDCData})),__webpack_require__.d(__webpack_exports__,"B",(function(){return dealImportAttrs})),__webpack_require__.d(__webpack_exports__,"N",(function(){return formatSDCComponent})),__webpack_require__.d(__webpack_exports__,"C",(function(){return decomposeSDCComponent})),__webpack_require__.d(__webpack_exports__,"s",(function(){return checkUpdateSDCBatch})),__webpack_require__.d(__webpack_exports__,"J",(function(){return findTopSDCComponentByFid})),__webpack_require__.d(__webpack_exports__,"n",(function(){return arrayTo2dByLength})),__webpack_require__.d(__webpack_exports__,"m",(function(){return array2dToArray}));var core_js_modules_es7_symbol_async_iterator__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("ac4d"),core_js_modules_es7_symbol_async_iterator__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(core_js_modules_es7_symbol_async_iterator__WEBPACK_IMPORTED_MODULE_0__),core_js_modules_es6_symbol__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("8a81"),core_js_modules_es6_symbol__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(core_js_modules_es6_symbol__WEBPACK_IMPORTED_MODULE_1__),core_js_modules_es6_string_iterator__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("5df3"),core_js_modules_es6_string_iterator__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(core_js_modules_es6_string_iterator__WEBPACK_IMPORTED_MODULE_2__),core_js_modules_es6_array_from__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("1c4c"),core_js_modules_es6_array_from__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(core_js_modules_es6_array_from__WEBPACK_IMPORTED_MODULE_3__),core_js_modules_es7_object_get_own_property_descriptors__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("8e6e"),core_js_modules_es7_object_get_own_property_descriptors__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(core_js_modules_es7_object_get_own_property_descriptors__WEBPACK_IMPORTED_MODULE_4__),_Users_yinhao_Workspace_frontend_page_webtools_page_node_modules_babel_runtime_corejs2_helpers_esm_typeof_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("7618"),regenerator_runtime_runtime__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("96cf"),regenerator_runtime_runtime__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(regenerator_runtime_runtime__WEBPACK_IMPORTED_MODULE_6__),_Users_yinhao_Workspace_frontend_page_webtools_page_node_modules_babel_runtime_corejs2_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("3b8d"),core_js_modules_es6_regexp_match__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("4917"),core_js_modules_es6_regexp_match__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(core_js_modules_es6_regexp_match__WEBPACK_IMPORTED_MODULE_8__),core_js_modules_es7_object_values__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("8615"),core_js_modules_es7_object_values__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(core_js_modules_es7_object_values__WEBPACK_IMPORTED_MODULE_9__),_Users_yinhao_Workspace_frontend_page_webtools_page_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("bd86"),core_js_modules_es6_string_starts_with__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("f559"),core_js_modules_es6_string_starts_with__WEBPACK_IMPORTED_MODULE_11___default=__webpack_require__.n(core_js_modules_es6_string_starts_with__WEBPACK_IMPORTED_MODULE_11__),core_js_modules_es6_regexp_constructor__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("3b2b"),core_js_modules_es6_regexp_constructor__WEBPACK_IMPORTED_MODULE_12___default=__webpack_require__.n(core_js_modules_es6_regexp_constructor__WEBPACK_IMPORTED_MODULE_12__),core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("28a5"),core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_13___default=__webpack_require__.n(core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_13__),core_js_modules_es6_array_sort__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("55dd"),core_js_modules_es6_array_sort__WEBPACK_IMPORTED_MODULE_14___default=__webpack_require__.n(core_js_modules_es6_array_sort__WEBPACK_IMPORTED_MODULE_14__),core_js_modules_es6_string_includes__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("2fdb"),core_js_modules_es6_string_includes__WEBPACK_IMPORTED_MODULE_15___default=__webpack_require__.n(core_js_modules_es6_string_includes__WEBPACK_IMPORTED_MODULE_15__),core_js_modules_es7_array_includes__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__("6762"),core_js_modules_es7_array_includes__WEBPACK_IMPORTED_MODULE_16___default=__webpack_require__.n(core_js_modules_es7_array_includes__WEBPACK_IMPORTED_MODULE_16__),core_js_modules_es6_array_find__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__("7514"),core_js_modules_es6_array_find__WEBPACK_IMPORTED_MODULE_17___default=__webpack_require__.n(core_js_modules_es6_array_find__WEBPACK_IMPORTED_MODULE_17__),_Users_yinhao_Workspace_frontend_page_webtools_page_node_modules_babel_runtime_corejs2_helpers_esm_toConsumableArray_js__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__("75fc"),core_js_modules_es6_object_keys__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__("456d"),core_js_modules_es6_object_keys__WEBPACK_IMPORTED_MODULE_19___default=__webpack_require__.n(core_js_modules_es6_object_keys__WEBPACK_IMPORTED_MODULE_19__),core_js_modules_es6_regexp_to_string__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__("6b54"),core_js_modules_es6_regexp_to_string__WEBPACK_IMPORTED_MODULE_20___default=__webpack_require__.n(core_js_modules_es6_regexp_to_string__WEBPACK_IMPORTED_MODULE_20__),core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__("a481"),core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_21___default=__webpack_require__.n(core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_21__),core_js_modules_es6_number_constructor__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__("c5f6"),core_js_modules_es6_number_constructor__WEBPACK_IMPORTED_MODULE_22___default=__webpack_require__.n(core_js_modules_es6_number_constructor__WEBPACK_IMPORTED_MODULE_22__),core_js_modules_es6_number_max_safe_integer__WEBPACK_IMPORTED_MODULE_23__=__webpack_require__("87f3"),core_js_modules_es6_number_max_safe_integer__WEBPACK_IMPORTED_MODULE_23___default=__webpack_require__.n(core_js_modules_es6_number_max_safe_integer__WEBPACK_IMPORTED_MODULE_23__),core_js_modules_es6_array_find_index__WEBPACK_IMPORTED_MODULE_24__=__webpack_require__("20d6"),core_js_modules_es6_array_find_index__WEBPACK_IMPORTED_MODULE_24___default=__webpack_require__.n(core_js_modules_es6_array_find_index__WEBPACK_IMPORTED_MODULE_24__),core_js_modules_es6_function_name__WEBPACK_IMPORTED_MODULE_25__=__webpack_require__("7f7f"),core_js_modules_es6_function_name__WEBPACK_IMPORTED_MODULE_25___default=__webpack_require__.n(core_js_modules_es6_function_name__WEBPACK_IMPORTED_MODULE_25__),core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_26__=__webpack_require__("ac6a"),core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_26___default=__webpack_require__.n(core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_26__),_babel_runtime_corejs2_regenerator__WEBPACK_IMPORTED_MODULE_27__=__webpack_require__("967e"),_babel_runtime_corejs2_regenerator__WEBPACK_IMPORTED_MODULE_27___default=__webpack_require__.n(_babel_runtime_corejs2_regenerator__WEBPACK_IMPORTED_MODULE_27__),_page_attrs_json__WEBPACK_IMPORTED_MODULE_28__=__webpack_require__("6a5b"),_page_attrs_json__WEBPACK_IMPORTED_MODULE_28___namespace=__webpack_require__.t("6a5b",1),_base_attrs_json__WEBPACK_IMPORTED_MODULE_29__=__webpack_require__("f5cd"),_base_attrs_json__WEBPACK_IMPORTED_MODULE_29___namespace=__webpack_require__.t("f5cd",1),_smart_attrs__WEBPACK_IMPORTED_MODULE_30__=__webpack_require__("a223"),_type_parser__WEBPACK_IMPORTED_MODULE_31__=__webpack_require__("a542"),_base_util__WEBPACK_IMPORTED_MODULE_32__=__webpack_require__("b19c"),_cacheManager__WEBPACK_IMPORTED_MODULE_33__=__webpack_require__("6fa7"),_page_parser__WEBPACK_IMPORTED_MODULE_34__=__webpack_require__("1a80"),_hash_sum__WEBPACK_IMPORTED_MODULE_35__=__webpack_require__("23c2");function _createForOfIteratorHelper(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,l=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return o=e.done,e},e:function(e){l=!0,r=e},f:function(){try{o||null==a.return||a.return()}finally{if(l)throw r}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=new Array(t);a<t;a++)i[a]=e[a];return i}function ownKeys(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(a),!0).forEach((function(t){Object(_Users_yinhao_Workspace_frontend_page_webtools_page_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_10__.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ownKeys(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function handleTestDataType(){"1"!==localStorage.getItem("__testDataType__")&&_page_attrs_json__WEBPACK_IMPORTED_MODULE_28__.forEach((function(e){if("methods"===e.name){var t=e.attributes.findIndex((function(e){return"$testDataType"===e.name}));t>-1&&e.attributes.splice(t,1)}}))}handleTestDataType();var CONST={MAX:Number.MAX_SAFE_INTEGER,MIN:-Number.MAX_SAFE_INTEGER,NUMBER_PRECISION:0,NUMBER_STEP:1,NUMBER_STEP_STRICTLY:!1,MAX_LENGTH:99999,MIN_LENGTH:0,MAX_LENGTH_ADD:50,COLOR_FORMAT:"rgb",URL_MAX_LENGTH:2e3,SCRIPT_MAX_LENGTH:15e3,PAYLOAD_NAME_MAX_LENGTH:500},LAYOUT_COM_CONST=["CarouselLayout","Tabs","Collapse","Mobiletab"],BASE_LAYOUT_COM_CONST=[].concat(LAYOUT_COM_CONST,["Grid","Flow","LoadRefresh"]),DATA_CONTAINER_TYPES_CONST=["ContainerArray","ContainerObject","ContainerPoint"],CONTAINER_TYPES_CONST=DATA_CONTAINER_TYPES_CONST.concat(["ContainerSDC"]),LAZY_COMPONENTS_CONST=["ContainerSDC"],EXP_SUFFIX_UID="_([a-z0-9]{8}-([a-z0-9]{4}-){3}[a-z0-9]{12})$",REG_VARIBALE_ATTR="^\\$V_.*",REG_SDC_INNER_COMP_NAME="^#\\w{4}-.*",REG_VARIABLE_STR="\\$\\{(.*?)\\}",FORMAT_EXTENDS_DATA_TYPES={String:"String",Number:"Number",Boolean:"Boolean",Enum:"Enum",DateTime:"DateTime",string:"String",number:"Number",int:"Number",double:"Number",boolean:"Boolean",bool:"Boolean",enum:"Enum",dictenum:"Enum",datetime:"DateTime"},smart={smartAttrs:_smart_attrs__WEBPACK_IMPORTED_MODULE_30__.a},getUid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},getSign=function(){var e=window.$common.$util.uuid(32);return Object(_hash_sum__WEBPACK_IMPORTED_MODULE_35__.a)(e)},getComponentList=function(){return Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.e)([])},getFid=function(e){return e+"-"+(new Date).getTime()},getConvertedComponent=function(e,t){if(!e||0===e.length)return[];var a=[];return function e(i,n){i.forEach((function(i){var r=null;if("function"===Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.g)(t))if(r=t(i,n),n){n.children=n.children||[];var o=n.children.findIndex((function(e){return e.fid===r.fid}));-1!==o?n.children.splice(o,1,r):n.children.push(r)}else a.push(r);var l=i.children;l&&l.length>0&&e(l,r)}))}(e,null),a},mergeDataByValueData=function(e,t){if(!t)return e;var a=t.attributes;if(!a||0===a.length)return e;return function e(t,a){if(a){var i="array"===Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.g)(a)?Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.e)(a[0]):null;t.forEach((function(t,n){if("array"===Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.g)(t)){if(!t.length)return;var r=Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.e)(i);return t.forEach((function(t,a){var i=t.name,n=r[i];if(n){var o=t.attributes;for(var l in o&&o.length>0&&e(o,n.attributes),t)"name"!==l&&"attributes"!==l&&(n[l]=t[l],"value"===l&&(n.lastValue=t[l]),"visible"===l&&(n.visibleChanged=!0),"editor"===l&&(n.editorChanged=!0),"readonly"===l&&(n.readonlyChanged=!0),"type"===l&&(n.typeChanged=!0))}})),void a.splice(n,1,r)}var o=a[t.name];if(o){for(var l in t)"name"!==l&&"attributes"!==l&&(o[l]=t[l],"value"===l&&(o.lastValue=t[l]),"visible"===l&&(o.visibleChanged=!0),"editor"===l&&(o.editorChanged=!0),"readonly"===l&&(o.readonlyChanged=!0),"type"===l&&(o.typeChanged=!0));var s=t.attributes;s&&s.length>0&&e(s,o.attributes)}}))}}(a,e.attributes),e},concatFromPageEvents=function(e,t){if(Object.keys(e).length&&t)for(var a in t.attributes)if(e.hasOwnProperty(a)){var i,n=t.attributes[a].attributes.content.attributes;n.length?(i=n).splice.apply(i,[n.length,0].concat(Object(_Users_yinhao_Workspace_frontend_page_webtools_page_node_modules_babel_runtime_corejs2_helpers_esm_toConsumableArray_js__WEBPACK_IMPORTED_MODULE_18__.a)(e[a]))):n=e[a]}},getComponentKV=function(e,t,a){t="array"!==Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.g)(t)?[]:t;var i={};return function e(n){n.forEach((function(n){t.find((function(e){return e===n.name}))||(i[n.fid]=n,"function"==typeof a&&a(n),n.children&&n.children.length>0&&e(n.children))}))}(e),i},formatSDCPageAttrs=function(e){var t=["general","variable","methods"];return e.forEach((function(e){"variable"===e.name?e.attributes.forEach((function(e){"pageVariable"!==e.name&&(e.visible=!1)})):"methods"===e.name?e.attributes.forEach((function(e){"customMethods"===e.name&&(e.visible=!1)})):"general"===e.name&&e.attributes.forEach((function(e){"pageTitle"===e.name&&(e.visible=!1)})),t.includes(e.name)||(e.visible=!1)}))},initPageVariables=function(e){if("COMMON"===getProjectIdentifier()){var t,a,i=(null==e||null===(t=e.attributes)||void 0===t||null===(a=t.pageVariable)||void 0===a?void 0:a.attributes)||[],n=i.findIndex((function(e){var t;return"projectIdentifier"===(null==e||null===(t=e.name)||void 0===t?void 0:t.default)}));n>-1&&i.splice(n,1)}},getComponentPageData=function(e,t,a){var i=Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.e)(_page_attrs_json__WEBPACK_IMPORTED_MODULE_28__);a&&formatSDCPageAttrs(i);var n=getComponentMergeAttrData(i,[],t,e),r={attributes:n.attributes},o=mergeDataByValueData(r,e);return initPageVariables(o),{converted:o.attributes,attrGroup:n.group}},getComponentData=function(e,t,a,i){var n=i&&i.fid,r=i&&i.componentId,o=Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.e)(e),l=Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.e)(_base_attrs_json__WEBPACK_IMPORTED_MODULE_29__),s=n||getUid(),c=r||(t||function(e){return e})(o.name),u=getComponentMergeAttrData(l,o.attributes,a,i||{fid:s,componentId:c,name:o.name});return o.attributes=u.attributes,o.attributes.componentName.value=c,o.attributes.componentName.lastValue=c,o.attributes.componentType.value=e.alias,o.fid=s,i&&i.hasOwnProperty("tabIndex")&&(o.tabIndex=i.tabIndex),(["quickLayout","layout","dataContainer"].includes(e.groupName)||e.isCurrentTopSDC)&&(o.children=[]),{converted:o,attrGroup:u.group,customGroupNames:u.customGroupNames}},getConcatAttrData=function(e,t){return(t||[]).forEach((function(t){var a=e.findIndex((function(e){return e.name===t.name}));if(-1===a)return t.hasOwnProperty("sort")||(t.sort=310),void e.push(t);var i=e[a],n=function(){if("attributes"!==r)t.hasOwnProperty(r)&&(i[r]=t[r]);else{var e=getSmartAttrs(t.attributes)||[],a=getSmartAttrs(i.attributes)||[];e.forEach((function(e){var t=a.findIndex((function(t){return t.name===e.name}));-1!==t?Object.assign(a[t],e):a.push(e)}))}};for(var r in t)n()})),e},getComponentMergeAttrData=function(e,t,a,i){var n=getConcatAttrData(e,t),r=a||[],o={},l={};return n.forEach((function(e){if(e.type&&(e.groupName="others",e.groupAlias="其它",i&&(e.componentFid=i.fid,e.componentName=i.componentId,e.componentType=i.name),e.hasOwnProperty("editor")&&(e.editorDefined=e.editor),o[e.name]=e,e.attributes&&(e.attributes=getSmartAttrs(e.attributes),resetChildAttrs(e,e.readonly,(function(e){i&&(e.componentFid=i.fid,e.componentName=i.componentId,e.componentType=i.name),e.customGroupName&&setCustomGroupNames(e.customGroupName,e,l)}))),e.customGroupName&&setCustomGroupNames(e.customGroupName,e,l)),e.attributes&&(e.attributes=getSmartAttrs(e.attributes),e.attributes.sort((function(e,t){return e.sort-t.sort})),e.attributes.forEach((function(t){t.groupName=e.name,t.groupAlias=e.alias,i&&(t.componentFid=i.fid,t.componentName=i.componentId,t.componentType=i.name),!0===e.readonly&&(t.readonly=!0),t.hasOwnProperty("editor")&&(t.editorDefined=t.editor),t.attributes&&(t.attributes=getSmartAttrs(t.attributes),resetChildAttrs(t,t.readonly,(function(e){i&&(e.componentFid=i.fid,e.componentName=i.componentId,e.componentType=i.name),e.customGroupName&&setCustomGroupNames(e.customGroupName,e,l)}))),o[t.name]=t,t.customGroupName&&setCustomGroupNames(t.customGroupName,t,l)}))),!a||0===a.length){var t=r.findIndex((function(t){return t.name===e.name}));-1!==t&&r.splice(t,1),delete e.attributes,r.push(e),r.sort((function(e,t){return e.sort-t.sort}))}})),{group:r,attributes:o,customGroupNames:l}},getSmartAttrs=function(e){if("string"===Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.g)(e)){var t=e.split("."),a=null;return t.forEach((function(e,t){a=0===t?smart&&smart[e]:a&&a[e]})),a?Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.e)(a):e}return e},forEachAttrs=function e(t,a){var i=Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.g)(t);if("object"!==i)"array"===i&&t.forEach((function(t){if("function"===Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.g)(a)&&!1===a(t))return;e(t,a);var i=t.attributes;i&&e(i,a)}));else for(var n in t){var r=t[n];if("function"===Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.g)(a))if(!1===a(r))return;var o=r.attributes;o&&e(o,a)}},autoBindDataContainerChild=function(e){var t,a=e.parentFid;if(a){var i=window.$VUE_ROOT.$store.getters.pageEditor.pagesKV[window.$VUE_ROOT.$store.getters.pageEditor.pagesActiveName].componentInstance[a]||{};if("dataContainer"===(null===(t=i.data)||void 0===t?void 0:t.groupName)){var n=i.autoBindComponent;"function"==typeof n&&n.call(i,e)}}},replaceComponentAttrScopedVars=function(e,t){var a="",i=Object.keys(t);if(null!=i&&i.length){a=function(e){return"(^|[^\\w-])(\\${)?(".concat((e||[]).join("|"),")(\\.[\\w-]+)*($|[^\\w-])")}(i);!function i(n,r,o){var l=Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.g)(n);if("array"===l)n.forEach((function(e,t){i(e,n,t)}));else if("object"===l)Object.keys(n).forEach((function(e){i(n[e],n,e)}));else if("string"===l){var s=new RegExp(a,"g");r[o]=r[o].replace(s,(function(){var a=(arguments.length<=2?void 0:arguments[2])||"",i=(arguments.length<=3?void 0:arguments[3])||"",n=(arguments.length<=4?void 0:arguments[4])||"",r=(arguments.length<=5?void 0:arguments[5])||"";if(t.hasOwnProperty(i)){var o=t[i];return o?a+o+n+r:(e.linkable=!1,setTimeout((function(){delete e.value,delete e.linkConfig,delete e.editor,e.hasOwnProperty("editorDefined")&&(e.editor=e.editorDefined),e.linkable=!0})),"")}return arguments.length<=0?void 0:arguments[0]}))}}(e)}},getComponentCopyData=function e(t,a,i,n,r,o,l){var s,c,u,d,p,h,f=arguments.length>7&&void 0!==arguments[7]?arguments[7]:{},m=arguments.length>8?arguments[8]:void 0,v=arguments.length>9?arguments[9]:void 0,b=o?t:Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.e)(t);v||(v={fids:{},uuidsNames:{},SDCNames:{}});var g,y=b.fid;n=n||getUid(),v.fids[y]=n,r=r||b.parentFid,"block"===b.name&&(b.colId=getUid()),b.fid=n,b.parentFid=r;var _=a||function(e){return e},C="ContainerSDC"===b.name;if(C){var O=n.split("-")[1];v.uuidsNames[b.attributes.uuid.value]={__newUuid__:O},b.attributes.uuid.lastValue=O,b.attributes.uuid.value=O}var T=null===(s=b)||void 0===s||null===(c=s.attributes)||void 0===c||null===(u=c.componentName)||void 0===u?void 0:u.value;if(C&&!m){var V=T,w=/.+-[0-9]+$/.test(b.attributes.componentName.value)?b.attributes.componentName.value.replace(/-([0-9]+)$/,""):b.attributes.componentName.value;w.startsWith("#T-")&&(w=w.slice(3)),g=_(w,T),v.SDCNames[V]=g}else if(m){if(g=T){var P=Object.keys(v.uuidsNames).find((function(e){return g.startsWith("#"+e)}));P&&(v.uuidsNames[P][g]=g.replace(P,v.uuidsNames[P].__newUuid__))}}else g=_(b.name,T),b.attributes&&(b.attributes.componentName.value=g,b.attributes.componentName.lastValue=g);"dataContainer"===b.groupName&&(f[T]=g),b.children&&b.children.forEach((function(t){e(t,_,i,"",n,!0,!(o||!C)||l,Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.e)(f),m||C,v)}));var x=null===(d=b)||void 0===d||null===(p=d.attributes)||void 0===p||null===(h=p.cols)||void 0===h?void 0:h.attributes;if("array"===Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.g)(x)){var S,j=(null===(S=b)||void 0===S?void 0:S.children)||[];x.forEach((function(e,t){var a=j[t];e.colId.value=a.colId}))}if(!o){var E=_objectSpread(_objectSpread(_objectSpread({},v.fids),v.SDCNames),Object.values(v.uuidsNames).reduce((function(e,t){return _objectSpread(_objectSpread({},e),t)}),{}));Object.keys(E).length&&(delete E.__newUuid__,b=JSON.parse(replaceAllByKV(JSON.stringify(b),E)));var k=function e(t,a){var r,o="ContainerSDC"===t.name;t.children&&t.children.forEach((function(t){e(t,o||a)}));var l=(null===(r=Object.keys(f||{}))||void 0===r?void 0:r.length)&&!a;!n&&o&&convertSDCData(t),forEachAttrs(t.attributes,(function(e){e.hasOwnProperty("componentFid")&&(e.componentFid=t.fid),e.hasOwnProperty("componentName")&&(e.componentName=t.attributes.componentName.value),"function"===Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.g)(i)&&i(e),l&&replaceComponentAttrScopedVars(e,f)})),i(t.fid,t)};k(b)}return b},setCustomGroupNames=function(e,t,a){var i=a[e];i||(i=a[e]=[]),i.push(t)},commitSetCustomGroupNames=function(e,t){window.$VUE_ROOT.$store.commit("SET_CUSTOM_GROUP_NAMES",{fid:t,data:e})},getAttrByName=function(e,t){return""},resetChildAttrs=function e(t,a,i){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=t.attributes;if("array"!==Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.g)(r)||0===r.length)return null;var o={};r.sort((function(e,t){return e.sort-t.sort}));var l=getUid();r.forEach((function(r){!0===a&&(r.readonly=!0),r.hasOwnProperty("editor")&&(r.editorDefined=r.editor),r.fid=l,o[r.name]=r,"function"===Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.g)(i)&&i(r),r.attributes&&(r.default=r.default||t.default,r.attributes=getSmartAttrs(r.attributes),e(r,r.readonly,i,n))})),t.attributes=getDefaultValueAttrs(o,t,n)},getDefaultValueAttrs=function e(t,a){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=new _type_parser__WEBPACK_IMPORTED_MODULE_31__.a(a.type),r=n.getResult();if("Complex"===r.type&&r.isLen){var o=[],l=a.default;if(l&&"array"===Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.g)(l)){var s=getUid();l.forEach((function(a){var n=Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.e)(t);for(var r in n){var l=n[r];if(a.hasOwnProperty(r)){var c=a[r];if(l.default=c,i&&(l.value=c),"editor"===r&&(l.editorDefined=c),l.attributes){var u=l.attributes;l.attributes=e(u[0],l,i)}}l.fid=s}o.push(n)}))}else o.push(t);return n.destroy(),o}return n.destroy(),t},setAttrVisibleByGroupName=function(e,t,a){if(e)for(var i in e){var n=e[i];n.groupName===t&&(n.visible=a)}},batchSetAttrVisible=function(e,t,a){("string"===Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.g)(t)?[t]:t).forEach((function(t){e.hasOwnProperty(t)&&e[t].visible!==!!a&&(e[t].visible=!!a)}))},batchSetAttrValue=function(e,t,a){("string"===Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.g)(t)?[t]:t).forEach((function(t){e.hasOwnProperty(t)&&(e[t].value=a)}))},batchSetAttrEditValue=function(e,t,a){("string"===Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.g)(t)?[t]:t).forEach((function(t){e.hasOwnProperty(t)&&(e[t].editValue=a)}))},batchSetAttrDefault=function(e,t,a){("string"===Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.g)(t)?[t]:t).forEach((function(t){e.hasOwnProperty(t)&&(e[t].default=a)}))},batchRemoveAttrValue=function(e,t){("string"===Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.g)(t)?[t]:t).forEach((function(t){e.hasOwnProperty(t)&&(delete e[t].lastValue,delete e[t].value)}))},convertedComponentData=function(e,t){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=e.name,n=e.groupName,r=["Grid","Tabs","block","CarouselLayout"],o=["dataContainer"];if(o.includes(n))return e;if("form"===n?(setAttrVisibleByGroupName(e.attributes,"labelConfig",!0),batchSetAttrDefault(e.attributes,["margin"],[0,0,20,0]),!a&&batchRemoveAttrValue(e.attributes,["margin","padding"])):setAttrVisibleByGroupName(e.attributes,"labelConfig",!1),"layout"===n&&batchSetAttrVisible(e.attributes,["padding","blockPadding"],!1),"ContainerSDC"===(t=e.parentName||t)&&(t=""),t){if(batchSetAttrVisible(e.attributes,["blockPadding"],!1),"Grid"===i){var l,s;batchSetAttrVisible(e.attributes,["borderVisible","border-style","border-color"],!1);var c=null===(l=e.attributes)||void 0===l||null===(s=l.cols)||void 0===s?void 0:s.attributes,u=c?c[0]:null;u&&(batchSetAttrDefault(u,["borderVisible","isBorderRadius"],!1),batchSetAttrVisible(u,["border-style","border-color","blockPadding","border-radius"],!1),batchSetAttrDefault(u,["border-style"],getThemeValueByName("blockBorderStyle")),!a&&batchRemoveAttrValue(u,["blockPadding"]))}return"Flow"!==i&&"Tabs"!==i||(batchSetAttrDefault(e.attributes,["borderVisible","isBorderRadius"],!1),batchSetAttrVisible(e.attributes,["border-style","border-color","border-radius"],!1),batchSetAttrDefault(e.attributes,["border-style"],getThemeValueByName("blockBorderStyle")),batchSetAttrDefault(e.attributes,["blockPadding"],getThemeValueByName("blockPaddingNormal"))),r.includes(t)?(batchSetAttrVisible(e.attributes,["width","float"],!1),batchSetAttrVisible(e.attributes,["span","sm","xs","lg"],!0),batchSetAttrDefault(e.attributes,["span","lg"],24),"form"!==n&&"ContainerSDC"!==i&&batchSetAttrDefault(e.attributes,["height"],"100%"),e):"Flow"===t?(batchSetAttrVisible(e.attributes,["width","float"],!0),batchSetAttrVisible(e.attributes,["span","sm","xs","lg"],!1),"form"!==n&&"ContainerSDC"!==i&&batchSetAttrDefault(e.attributes,["height"],"100%"),e):"Free"===t?(batchSetAttrVisible(e.attributes,["width"],!0),batchSetAttrVisible(e.attributes,["span","sm","xs","float","lg"],!1),e):e}if("Collapse"!==i&&batchSetAttrDefault(e.attributes,["span","lg"],24),batchSetAttrVisible(e.attributes,["width","float"],!1),batchSetAttrVisible(e.attributes,["span","sm","xs","lg"],!0),"form"!==n&&!a&&batchRemoveAttrValue(e.attributes,["height"]),"Grid"===i){var d,p;batchSetAttrVisible(e.attributes,["borderVisible","border-style","border-color"],!1);var h=null===(d=e.attributes)||void 0===d||null===(p=d.cols)||void 0===p?void 0:p.attributes,f=h?h[0]:null;f&&(batchSetAttrDefault(f,["borderVisible","isBorderRadius"],!0),batchSetAttrVisible(f,["border-style","border-color","blockPadding","border-radius"],!0),batchSetAttrDefault(f,["border-style"],["none","none","none","none"]),!a&&batchRemoveAttrValue(f,["blockPadding"]))}return"Flow"!==i&&"Tabs"!==i||(batchSetAttrDefault(e.attributes,["borderVisible","isBorderRadius"],!0),batchSetAttrVisible(e.attributes,["border-style","border-color","border-radius"],!0),batchSetAttrDefault(e.attributes,["border-style"],["none","none","none","none"])),"Flow"===i&&(batchSetAttrVisible(e.attributes,["blockPadding"],!0),batchSetAttrDefault(e.attributes,["blockPadding"],getThemeValueByName("blockPaddingNormal"))),e},isBlank=function(e){return!e&&0!==e&&!1!==e},getTabsChildrenIndex=function(e,t,a,i){var n=a.findIndex((function(e){return!e.hasOwnProperty("tabIndex")}));return-1===n&&i?a.findIndex((function(e){return e.fid===i})):n},getLayoutChildrenIndex=function(e,t,a){var i=a.filter((function(e){return e.tabIndex===t}));if(!i.length)return a.length;var n=e>=i.length?i[i.length-1]:i[e];return a.findIndex((function(e){return e.fid===n.fid}))},getThemeValueByName=function(e){var t,a,i,n=window.$VUE_ROOT.$store,r=n.getters.themeConstColor,o=n.getters.themeConstBasic,l=n.getters.themeLayoutColor,s=n.getters.themePageColor,c=n.getters.themePageBasic,u=null==c?void 0:c.blockPaddingLarge,d=null==c?void 0:c.blockPaddingNormal,p=null==c?void 0:c.blockPaddingMini,h=null==c||null===(t=c.blockBorder)||void 0===t?void 0:t.width,f=null==c||null===(a=c.blockBorder)||void 0===a?void 0:a.style,m=null==c||null===(i=c.blockBorder)||void 0===i?void 0:i.color,v=null==c?void 0:c.blockBackground,b=null==c?void 0:c.blockShadow,g=null==c?void 0:c.blockRadius,y=null==c?void 0:c.editorPadding,_=~~parseInt(o.margin),C=~~parseInt(o.padding),O=~~parseInt(o.paddingLarge),T=~~parseInt(o.borderWidth),V=o.borderStyle,w=r.border,P=~~parseInt(o.borderRadius);return{color:r.textRegular,"font-size":o.fontSize,padding:[C,C,C,C],paddingLarge:[O,O,O,O],margin:[_,_,_,_],"border-width":[T,T,T,T],"border-style":[V,V,V,V],"border-color":[w,w,w,w],"border-radius":[P,P,P,P],borderRadius:o.borderRadius,"box-shadow":o.boxShadow,headerBgColor:r.primary,paddingMedium:o.paddingMedium,borderColor:w,borderStyle:V,borderWidth:o.borderWidth,middleBackgroundColor:s.titleBackground,"background-color":l.sidebarBgColor,blockPaddingLarge:u,blockPaddingNormal:d,blockPaddingMini:p,blockBorderWidth:h,blockBorderStyle:f,blockBorderColor:m,blockBackground:v,blockShadow:b,blockRadius:g,mainContentBgColor:l.mainContentBgColor,editorPadding:y}[e]},getValueByDefault=function(e,t,a){"array"===Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.g)(e)&&e.forEach((function(t,a){null===t&&(e[a]=void 0)}));var i=void 0===e?null===t?void 0:t:e;if(isBlank(a))return i;var n=new _type_parser__WEBPACK_IMPORTED_MODULE_31__.a(a),r=n.getResult();return"Complex"===r.type||r.isLen?(n.destroy(),Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.j)(i)):(n.destroy(),i)},transformHump=function(e){if(e){var t=e.split("-"),a="";return t.forEach((function(e){var t=e.substr(0,1);t&&(a+=e.replace(t,t.toUpperCase()))})),a}};function formatDateValue(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0,a={"yyyy-MM-dd":"YYYY-MM-DD","yyyy年MM月dd日":"YYYY年MM月DD日","yyyy-MM-dd HH:mm:ss":"YYYY-MM-DD HH:mm:ss","yyyy-MM-dd HH:mm":"YYYY-MM-DD HH:mm","yyyy年MM月dd日 HH时mm分ss秒":"YYYY年MM月DD日 HH时mm分ss秒","yyyy年MM月dd日 HH时mm分":"YYYY年MM月DD日 HH时mm分"},i="";i=~e.indexOf("分")&&!~e.indexOf("秒")?e.replace(/年|月/g,"-").replace(/时/g,":").replace(/日|分/g,""):e.replace(/年|月/g,"-").replace(/时|分/g,":").replace(/日|秒/g,"");var n=window.$lib.moment;return n(new Date(i)).format(a[t])}var convertPercent=function(e){var t=e,a=Number(e);return isNaN(a)||(t=100*a+"%"),t},isPercent=function(e){if("string"!==Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.g)(e))return!1;return/^-?\d+(\.\d+)?%$/.test(e)},isNonNegativeInt=function(e){return/^\d+$/.test(e)},isCssSizeString=function(e){if("string"!==Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.g)(e))return!1;return/^-?\d+(\.\d+)?(px|rem|%|em)$|^auto$/.test(e)},isColor=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if("string"!=typeof e)return!1;if("transparent"===e)return!0;var t=/^#([0-9a-fA-F]{6}|[0-9a-fA-F]{3})$/;return!!e.match(t)||(t=/^[rR][gG][Bb][Aa]?[\\(]([\s]*(2[0-4][0-9]|25[0-5]|[01]?[0-9][0-9]?),){2}[\s]*(2[0-4][0-9]|25[0-5]|[01]?[0-9][0-9]?),?[\s]*(0\.\d{1,2}|1|0)?[\\)]{1}$/g,null!==e.match(t))},getCurrentPage=function(){var e=window.$VUE_ROOT.$store.getters.pageEditor,t=e.pagesActiveName;return e.pagesKV[t]},getComponentInstance=function(e){var t=getCurrentPage();return t?t.componentInstance[e||t.activeComponentFid]:null},getBasicComponentInstance=function(){var e=getCurrentPage();return e?e.componentInstance.basicComponent:null},getComponentInstanceMethod=function(e,t){if(e){var a=getComponentInstance(t),i=getBasicComponentInstance();return a&&a[e]||i&&i[e]}},getCustomGroupNames=function(e){var t=getCurrentPage();if(!t)return null;var a=t.customGroupNames;return a&&a[e||t.activeComponentFid]},getValueByObjectKey=function(e,t){if(!t)return e;var a=convertDataType(e),i=Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.g)(a);if("object"!==i&&"array"!==i)return e;var n=t.split("."),r="array"===i?[]:null;return"array"===i?a.forEach((function(e){var t=null;n.forEach((function(a,i){t=0===i?e&&e[a]:t&&t[a]})),r.push(t)})):n.forEach((function(e,t){r=0===t?a&&a[e]:r&&r[e]})),r},pageLogInfo=function(e){if(e&&"object"===Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.g)(e)){var t="",a=Object.keys(e);for(var i in e)t+=i+":"+e[i]+(i===a[a.length-1]?"":", ");return t}},getReplacedMessage=function(e,t){if("string"!==Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.g)(e)||!e)return"";var a=e.match(/\$\{(.*?)\}/g);if(!a||!a.length)return e;var i=e;return a.forEach((function(e){var a=/^\${(.+)}$/g.exec(e),n=a&&a[1];n&&(i=i.replace(e,t&&t[n]))})),i},convertDataType=function(e){if("string"!==Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.g)(e))return e;var t=e.replace(/(^\s*)|(\s*$)/g,"");return/^(\{).*(\})|(\[.*\])$/g.test(t)?Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.j)(t):t},getVariables=function e(t,a){var i=a?{}:void 0;return t.forEach((function(t){var n=t.name.value;if(n){var r=!1;t.isObject&&(r=getValueByDefault(t.isObject.value,t.isObject.default));var o=null;t.isObject&&(o=t.objectAttr.attributes),a?i[n]=r&&o?e(o,!0):t.value.value:i=r&&o?e(o,!0):t.value.value}})),i},getProjectIdentifier=function(){var e=window.$VUE_ROOT.$util.getQueryVariable("projectIdentifier");if(!e){var t=window.$VUE_ROOT.$getStore({name:"portalInfo"})||{};e=t.isManagement?"COMMON":t.nameEn}return e},getPageVariables=function(e,t){if(e){var a={},i=e.default,n=window.$VUE_ROOT.$store.getters,r=getProjectIdentifier();return"array"===Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.g)(i)&&i.forEach((function(e){var i=e.mapping||e.name;a[e.name]=n[i]||t[i]})),!a.projectIdentifier&&(a.projectIdentifier=r),a}},getCustomVariables=function(e){if(e){var t={},a=e.attributes;return"array"===Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.g)(a)&&a.forEach((function(e){var a=e.name,i=a&&a.value,n=e.value,r=n&&n.value;if(i){var o=e.isObject,l=o&&getValueByDefault(o.value,o.default),s=e.objectAttr,c=s&&s.attributes;if(l&&c.length>0){var u=getVariables(c,!0);t[i]=_type_parser__WEBPACK_IMPORTED_MODULE_31__.a.formatValueByCustom(e,i,u),1!==c.length||""!==c[0].name.value&&c[0].name.hasOwnProperty("value")||(t[i]=_type_parser__WEBPACK_IMPORTED_MODULE_31__.a.getEmptyValue(e.empty))}else t[i]=_type_parser__WEBPACK_IMPORTED_MODULE_31__.a.formatValueByCustom(e,i,r)}})),t}},filterScript=function(e){return"string"!==Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.g)(e)?e:e.replace(/(^|[^\w])debugger([^\w]|$)/g,"")};function isObject(e){return"Object"===Object.prototype.toString.call(e).slice(8,-1)}var addLocalComponents=function(e,t,a){var i=null==t?void 0:t.localComponent;return(i="object"===Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.g)(i)?[i]:i).forEach((function(t){if(t){var i=t.json||t.attrs;if(i){var n=t.component||t,r=n.name,o=e.findIndex((function(e){return e.name===r}));-1!==o?e.splice(o,1,i):e.push(i),(a=a||window.Vue)&&(a.options.components[r]&&delete a.options.components[r],a.component(r,n))}}})),e},deleteComponentByFid=function e(t,a){if(!t||!a||!a.length)return null;var i=null;return a.forEach((function(n,r){if(n.fid!==t){var o=n.children;o&&o.length&&(i=e(t,o))}else i=a.splice(r,1)[0]})),i},findComponentByFid=function e(t,a){if(!t||!a||!a.length)return null;var i=null;return a.forEach((function(a,n){if(a.fid!==t){var r=a.children;if(r&&r.length){var o=e(t,r);o&&(i=o)}}else i=a})),i},defaultGroup=[{name:"quickLayout",alias:"常用布局",order:1},{name:"dataContainer",alias:"数据容器",order:2},{name:"layout",alias:"布局",order:3},{name:"basic",alias:"基础组件",order:4},{name:"form",alias:"表单组件",order:5},{name:"specialty",alias:"专业组件",order:6},{name:"chart",alias:"图表",order:7}],getNewUnrepeatedKeyInObj=function e(t,a){if(null==a?void 0:a[t]){var i=1;for(var n in a){var r=n.split(t)[1];Number(r)&&(i=Math.max(Number(r)+1,i))}return e("".concat(t).concat(i),a)}return t},getNewUnrepeatedKeyInObjForObj=function e(t,a){var i=[];for(var n in t)i.push({key:n,value:t[n]});var r={};return i.forEach((function(t,i){if(null==a?void 0:a[t.key]){var n=1;for(var o in a){var l=o.split(t.key)[1];Number(l)&&(n=Math.max(Number(l)+1,n))}var s=e(Object(_Users_yinhao_Workspace_frontend_page_webtools_page_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_10__.a)({},"".concat(t.key).concat(n),t.value),a);r=_objectSpread(_objectSpread({},r),s)}else r=_objectSpread(_objectSpread({},r),t)})),r},getNewUnrepeatedKeyInObjForArray=function e(t,a){var i=Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.e)(t),n=Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.e)(a);return i.forEach((function(t,a){if(-1!==n.findIndex((function(e){return e.name===t.name}))){var i=1;n.forEach((function(e){var a=e.name.split(t.name)[1];Number(a)&&(i=Math.max(Number(a)+1,i))}));var r=[_objectSpread(_objectSpread({},t),{},{name:"".concat(t.name).concat(i)})];n=e(r,n)}else n=[].concat(Object(_Users_yinhao_Workspace_frontend_page_webtools_page_node_modules_babel_runtime_corejs2_helpers_esm_toConsumableArray_js__WEBPACK_IMPORTED_MODULE_18__.a)(n),[t])})),n};function getDeepConstByStr(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window,a=arguments.length>2?arguments[2]:void 0;if(e=e||"","string"!==Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.g)(e))return e;if(isColor(e))return e;var i=e.split(".");if(i&&i.length>0)for(var n=0;n<i.length&&(t=a&&"function"==typeof a?t[a(i,n)]||t[i[n]]||"":t[i[n]]);n++);return t&&"string"==typeof t?t:e}function upperFirst(e){var t;if(null!==(t=e=(e||"").toLowerCase())&&void 0!==t&&t.length){var a,i,n=null===(a=e)||void 0===a||null===(i=a.charAt(0))||void 0===i?void 0:i.toUpperCase(),r=e.slice(1);return"".concat(n).concat(r)}return e}function camelCase(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"_",a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=e=e||"",n=e.split(t);return null!=n&&n.length&&(i=n.reduce((function(e,t,i){return"".concat(e).concat(i||a?upperFirst(t):(t||"").toLowerCase())}),"")),i}function formatPayloads(e){var t=Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.g)(e);if("array"===t)e.forEach((function(e){formatPayloads(e)}));else if("object"===t)for(var a in e){var i=e[a];null!=i||delete e[a],"string"===Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.g)(i)&&(e[a]=i.trim())}else if(e instanceof FormData){var n,r=_createForOfIteratorHelper(e.entries());try{for(r.s();!(n=r.n()).done;){var o=n.value,l=e.get(o[0]);"undefined"!==l&&"null"!==l?"string"===Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.g)(l)&&e.set(o[0],l.trim()):e.delete(o[0])}}catch(e){r.e(e)}finally{r.f()}}return e}var listToTree=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"id",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"parentId",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"children",n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:-1;i=i||"children";var r=[],o={};return e&&e.length>0&&(e.forEach((function(e){o[e[t]]=e})),e.forEach((function(e){var t={label:e.name,value:e},l=o[e[a]];if(!l)return null!=n&&""!==n?String(e[a])===String(n)?void r.push(t):void 0:void r.push(t);l[i]||(l[i]=[]),l[i].push(t)}))),r},convertTree=function e(t){return t.map((function(t){var a,i,n;return _objectSpread(_objectSpread({},t),{},{children:null!==(a=t.value)&&void 0!==a&&a.children?e(t.value.children):null,value:_objectSpread(_objectSpread({},t.value),{},{children:null}),disabled:null===(i=t.value)||void 0===i?void 0:i.disabled,id:null===(n=t.value)||void 0===n?void 0:n.id})}))},getThemeColor=function(e){var t=window.$VUE_ROOT.$store,a=null==t?void 0:t.getters;return _objectSpread(_objectSpread(_objectSpread({},a.themeConstColor),a.themeLayoutColor),a.themeInfoMap.palette)[e]||""};function getCopyNameByNextSibling(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"_",i=new RegExp("(".concat(a,")\\d+$")),n=t.match(i);n&&(t=t.substring(0,n.index));var r=[];if(e.forEach((function(e){if(new RegExp("^".concat(t).concat(a)).test(e.name)){var i=new RegExp("\\d+$"),n=e.name.match(i);if(null!=n&&n.length){var o=n[0];isNaN(+o)||r.push(+o)}}})),null!=r&&r.length){var o=r.sort((function(e,t){return t-e}))[0];return"".concat(t).concat(a).concat(o+1)}return"".concat(t).concat(a,"1")}function getAllChildComponentFids(e){var t=[e.fid];return e.children&&e.children.length&&e.children.forEach((function(e){t=t.concat(getAllChildComponentFids(e))})),t}function clipboardCopy(e){var t,a,i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"复制成功",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"复制失败";return null!==(t=window)&&void 0!==t&&null!==(a=t.$VUE_ROOT)&&void 0!==a&&null!==(i=a.$util)&&void 0!==i&&i.browser&&window.$VUE_ROOT.$util.browser(),window.$VUE_ROOT.$util.setStore({name:"clipboard",content:e}),new Promise((function(t,a){window.$VUE_ROOT.$copyText(e).then((function(){window.$VUE_ROOT.$message.success(n),t(e)})).catch((function(e){window.$VUE_ROOT.$message.error(r),a(new Error(e))}))}))}function clipboardPaste(){return new Promise((function(e,t){var a,i;if(null!==(a=navigator)&&void 0!==a&&null!==(i=a.clipboard)&&void 0!==i&&i.readText)navigator.clipboard.readText().then((function(t){e(t)})).catch((function(a){var i=window.$VUE_ROOT.$util.getStore({name:"clipboard"});i?e(i):t(new Error("空"))}));else{var n=window.$VUE_ROOT.$util.getStore({name:"clipboard"});n?e(n):t(new Error("空"))}}))}function convertData(e){var t={};return Array.isArray(e)&&e.forEach((function(e){for(var a in e)t.hasOwnProperty(a)||(t[a]=[]),t[a].push(e[a])})),t}function complex2NormalData(e,t,a){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=[],r={result:[],pageInfo:{}};if(t&&!t.hasOwnProperty("pagination"))return convertData(e);var o=(null==t?void 0:t.fields)||"",l=n=o?o.split(","):[],s=[];return Array.isArray(e)&&t&&(null!=t&&t.containsKey&&t.pagination?(n=e[0],s=e[1],e=e.slice(2,e.length)):null!=t&&t.containsKey&&!t.pagination?(n=e[0],e=e.slice(1,e.length)):null!=t&&t.pagination&&!t.containsKey&&(s=e[0],e=e.slice(1,e.length)),(s&&Array.isArray(s)&&s.length||a)&&(r.pageInfo={page:s[0]||1,pageSize:s[1]||10,total:i?s[2]:s[2]||e.length})),null!=l&&l.length&&(Array.isArray(n)&&n.length?r.dynamicFields=n.filter((function(e){return!l.includes(e)})).map((function(e){return{label:e,prop:e}})):r.dynamicFields=[]),Array.isArray(e)&&Array.isArray(n)&&n.length?e.forEach((function(e){if(Array.isArray(e)){e.length>n.length&&(e=e.slice(0,n.length));var t={};e.forEach((function(e,a){var i=n[a];t[i]=e})),r.result.push(t)}else{var a={};n.forEach((function(t){a[t]=e[t]})),r.result.push(a)}})):Array.isArray(e)&&Array.isArray(n)&&!e.length?r.result=[]:r.result=convertData(e),r}function convert2dLinkData(e,t,a){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=[],r={result:[],pageInfo:{}};if(t&&!t.hasOwnProperty("pagination"))return convertData(e);var o=(null==t?void 0:t.fields)||"";n=o?o.split(","):[];var l=[];if(Array.isArray(e)&&t&&(null!=t&&t.containsKey&&t.pagination?(n=e[0],l=e[1],e=e.slice(2,e.length)):null!=t&&t.containsKey&&!t.pagination?(n=e[0],e=e.slice(1,e.length)):null!=t&&t.pagination&&!t.containsKey&&(l=e[0],e=e.slice(1,e.length)),(l&&Array.isArray(l)&&l.length||a)&&(r.pageInfo={page:l[0]||1,pageSize:l[1]||10,total:i?l[2]:l[2]||e.length})),Array.isArray(e)&&Array.isArray(n)&&n.length){var s={};return e.forEach((function(e){Array.isArray(e)&&(e.length>n.length&&(e=e.slice(0,n.length)),e.forEach((function(e,t){var a=n[t];s.hasOwnProperty(a)||(s[a]=[]),s[a].push(e)})))})),s}return convertData(e)}function sleepWait(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2e3;return new Promise((function(i,n){try{var r="function"==typeof e,o=0,l=setInterval(Object(_Users_yinhao_Workspace_frontend_page_webtools_page_node_modules_babel_runtime_corejs2_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_7__.a)(_babel_runtime_corejs2_regenerator__WEBPACK_IMPORTED_MODULE_27___default.a.mark((function n(){var s;return _babel_runtime_corejs2_regenerator__WEBPACK_IMPORTED_MODULE_27___default.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:!(s=r?e(t):null==e?void 0:e[t])&&o<a/50?o++:(clearInterval(l),i(s||void 0));case 2:case"end":return n.stop()}}),n)}))),50)}catch(e){i(new Error(e))}}))}function getDeepComplexValue(e,t){if(!t||"string"!=typeof t)return e;if(e&&"object"===Object(_Users_yinhao_Workspace_frontend_page_webtools_page_node_modules_babel_runtime_corejs2_helpers_esm_typeof_js__WEBPACK_IMPORTED_MODULE_5__.a)(e)){var a=t.split(".");try{return a.reduce((function(e,t){return e[t]||!e.hasOwnProperty(t)&&e.attributes&&e.attributes[t]}),e)}catch(e){return}}return e}function getPageIframesPageKV(e,t){var a=window.$VUE_ROOT.$store.getters.pageEditor,i=a.pagesKV[e||a.pagesActiveName],n=(null==i?void 0:i.componentKV)||{},r={};for(var o in n){var l,s,c,u,d=n[o],p=a.othersPage[d.fid],h=(null===(l=d.attributes)||void 0===l||null===(s=l.componentName)||void 0===s?void 0:s.value)||("string"==typeof(null===(c=d.attributes)||void 0===c?void 0:c.componentName)?null===(u=d.attributes)||void 0===u?void 0:u.componentName:"");if("Iframe"===d.name&&(!t||t===d.fid||t===h)){var f=null==p?void 0:p.pagesKV[null==p?void 0:p.pagesActiveName];f&&(r[h]=f)}}return r}function getPageIframesComponentKV(e,t){var a=window.$VUE_ROOT.$store.getters.pageEditor,i=a.pagesKV[e||a.pagesActiveName],n=(null==i?void 0:i.componentKV)||{},r={};for(var o in n){var l,s,c,u,d=n[o],p=a.othersPage[d.fid],h=(null===(l=d.attributes)||void 0===l||null===(s=l.componentName)||void 0===s?void 0:s.value)||("string"==typeof(null===(c=d.attributes)||void 0===c?void 0:c.componentName)?null===(u=d.attributes)||void 0===u?void 0:u.componentName:"");if("Iframe"===d.name&&(!t||t===d.fid||t===h)){var f=a.othersPage&&(null==p?void 0:p.pagesKV[null==p?void 0:p.pagesActiveName]),m=(null==f?void 0:f.componentPageKV)||{};r=_objectSpread(_objectSpread({},r),m)}}return r}function reloadAttrsOfGroup(e){var t=window.$VUE_ROOT.$store.getters.pageEditor,a=t.pagesKV[t.pagesActiveName];for(var i in a.currentAttrs){var n,r,o=a.currentAttrs[i];if(!e||o.groupName===e)((null===(n=o.__ob__)||void 0===n||null===(r=n.dep)||void 0===r?void 0:r.subs)||[]).forEach((function(e){e.update()}))}}function getTempPageParserStartPageId(e){var t=window.$VUE_ROOT.$store.getters.pageViewStore.pageParserInstanceKV;for(var a in t)if(a.startsWith(e)){var i=t[a];if(i.isTemp)return i}}var createPageParser=(e=Object(_Users_yinhao_Workspace_frontend_page_webtools_page_node_modules_babel_runtime_corejs2_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_7__.a)(_babel_runtime_corejs2_regenerator__WEBPACK_IMPORTED_MODULE_27___default.a.mark((function e(t,a,i){var n;return _babel_runtime_corejs2_regenerator__WEBPACK_IMPORTED_MODULE_27___default.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=getTempPageParserStartPageId(t.pageId))){e.next=3;break}return e.abrupt("return",n);case 3:return e.abrupt("return",new Promise((function(e,r){try{n=new _page_parser__WEBPACK_IMPORTED_MODULE_34__.a({isTemp:!0,pageInfo:t,pageId:t.pageId,pagePath:t.pageId||a,fromPageId:i,foreachAttrCallback:function(){},onbeforeload:function(){},onload:function(){e(n)}})}catch(e){r(e)}})));case 4:case"end":return e.stop()}}),e)}))),function(t,a,i){return e.apply(this,arguments)}),e;function loadPageParser(e,t,a){return _loadPageParser.apply(this,arguments)}function _loadPageParser(){return(_loadPageParser=Object(_Users_yinhao_Workspace_frontend_page_webtools_page_node_modules_babel_runtime_corejs2_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_7__.a)(_babel_runtime_corejs2_regenerator__WEBPACK_IMPORTED_MODULE_27___default.a.mark((function e(t,a,i){var n,r,o,l;return _babel_runtime_corejs2_regenerator__WEBPACK_IMPORTED_MODULE_27___default.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_cacheManager__WEBPACK_IMPORTED_MODULE_33__.a.getValue(t);case 2:if(n=e.sent){e.next=10;break}return o={url:"/api/page/published-pages",method:"get",params:{targetType:null!=i?i:1,pageId:t}},l=window.$VUE_ROOT,e.next=8,l.$util.request(o).then(function(){var e=Object(_Users_yinhao_Workspace_frontend_page_webtools_page_node_modules_babel_runtime_corejs2_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_7__.a)(_babel_runtime_corejs2_regenerator__WEBPACK_IMPORTED_MODULE_27___default.a.mark((function e(i){return _babel_runtime_corejs2_regenerator__WEBPACK_IMPORTED_MODULE_27___default.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_cacheManager__WEBPACK_IMPORTED_MODULE_33__.a.addValue(t,i);case 2:return e.next=4,createPageParser(i,t,a);case 4:r=e.sent;case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 8:e.next=13;break;case 10:return e.next=12,createPageParser(n,t,a);case 12:r=e.sent;case 13:return e.abrupt("return",r);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function deletePageParserInstance(e){window.$VUE_ROOT.$store.dispatch("deletePageParserInstance",e)}function checkPageIdAndFid(e){var t=window.$VUE_ROOT.$store.getters.getComponentInstanceByComponentName;return"function"===Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.g)(t)?t(e):null}function checkComponentName(e,t){var a=window.$VUE_ROOT.$store,i=a.getters.getPageParserInstanceByPageId;if("function"===Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.g)(i)){var n=a.getters.getComponentInstanceByPageId;if("function"===Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.g)(n)){var r=a.getters.getPageParserInstanceByIframeNameInPageId;if("function"===Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.g)(r)){var o=i(t);if(o){var l;if(o.fromPageId)l=n(o.fromPageId)[e];return r(l?o.fromPageId:t,e)}}}}}function getIframeNamesFromLinkIdAttrs(e){if(("array"!==Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.g)(e)||e.length)&&e){var t,a=[],i=_createForOfIteratorHelper(e);try{for(i.s();!(t=i.n()).done;){var n=t.value,r=null==n?void 0:n.linkConfig;if(!r||r.hasOwnProperty("variables")){var o,l=_createForOfIteratorHelper(null==r?void 0:r.variables);try{for(l.s();!(o=l.n()).done;){var s=o.value;s.indexOf(":")>-1&&a.push(s.slice(0,s.indexOf(":")))}}catch(e){l.e(e)}finally{l.f()}}}}catch(e){i.e(e)}finally{i.f()}return a}}var getComponentFromAttrsByComponentName=function(e,t){var a=e.data.componentKV;for(var i in a){var n,r,o=a[i];if((null===(n=o.attributes)||void 0===n||null===(r=n.componentName)||void 0===r?void 0:r.value)===t)return o}};function getIframeNamesFromScript(e){if("string"===Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.g)(e)){var t,a=[],i=_createForOfIteratorHelper(e.matchAll(/\$getComponent\(['|"]([^\)]*)['|"]\)/g));try{for(i.s();!(t=i.n()).done;){var n=t.value[1];if(n){var r,o,l,s,c=getComponentFromAttrsByComponentName(this,n);if("Iframe"===(null==c?void 0:c.name))((null===(r=c.attributes)||void 0===r||null===(o=r.defaultLoad)||void 0===o?void 0:o.value)||(null===(l=c.attributes)||void 0===l||null===(s=l.defaultLoad)||void 0===s?void 0:s.default))&&a.push(n)}}}catch(e){i.e(e)}finally{i.f()}return a}}function StringToArray(arrString){if(Array.isArray(arrString))return arrString;if(isObject(arrString))return[];try{return eval(arrString)}catch(e){return[]}}function logout(){window.$VUE_ROOT.$store.dispatch("LogOut")}function parseUrlQuery(e){var t={pathname:"",query:{}};if("string"!=typeof e||e.length<=0)return t;var a={path:function(e){e&&(t.pathname=e)},key:function(e){e&&(t.query[e]="")},value:function(e,a){a&&e&&(t.query[a]=e)}},i="path",n="",r="",o=function(){a[i](r,n),n=r,r=""};try{var l,s=_createForOfIteratorHelper(e);try{for(s.s();!(l=s.n()).done;){var c=l.value;["?","&"].includes(c)?(o(),i="key"):"="===c?(o(),i="value"):r+=c}}catch(e){s.e(e)}finally{s.f()}o()}catch(e){}return t}function transformSnippet(e){return(e||"").replace(/＆nbsp;＜/g,"<br>＜").replace(/＆nbsp;/g," ").replace(/＜/g,"<").replace(/＞/g,">").replace(/＆lt;/g,"＜").replace(/＆gt;/g,"＞").replace(/＆amp;/g,"&").replace(/＆quot;/g,'"').replace(/＆apos;/g,"'")}function getComponentTipsList(e,t,a){new Promise((function(t){var a={url:"/api/model/instances?objectType=DOCUMENT&$pagination=0&$filter=identifier eq ".concat(e),method:"get"};window.$common.$util.request(a).then((function(e){var a;t(null===(a=e.result[0])||void 0===a?void 0:a.id)}))})).then((function(e){(function(e){return new Promise((function(t){var a={url:"/api/model/instances?objectType=CHAPTER&$pagination=0&$filter=docId eq ".concat(e),method:"get"};window.$common.$util.request(a).then((function(e){var a=e.result;t(a)}))}))})(e).then((function(e){window.$VUE_ROOT.$set(a.attrTips,t,{}),window.$VUE_ROOT.$set(a.attrTips[t],"status",1),null==e||e.forEach((function(e){window.$VUE_ROOT.$set(a.attrTips[t],e.name,{}),window.$VUE_ROOT.$set(a.attrTips[t][e.name],"status",1),window.$VUE_ROOT.$set(a.attrTips[t][e.name],"value","")}))}))}))}function setEventNormalMethodValue(e,t,a,i){var n,r,o,l;if(e&&t){var s=window.$VUE_ROOT;s.$setAttr(e.pageComponentName,"lastValue",t.fid),s.$setAttr(e.pageComponentName,"value",t.fid),s.$setAttr(e.pageComponentMethod,"optionsFid",t.fid),s.$setAttr(e.pageComponentMethod,"lastValue",a),s.$setAttr(e.pageComponentMethod,"value",a),s.$setAttr(e.pageComponentMethod,"optionsFid",t.fid),s.$setAttr(e.pageComponentMethod,"lastValue",a),s.$setAttr(e.pageComponentMethod,"value",a),s.$setAttr(e.executionTitle,"lastValue","".concat((null==t?void 0:t.name)||(null==t||null===(n=t.attributes)||void 0===n||null===(r=n.componentName)||void 0===r?void 0:r.componentType),".").concat(a)),s.$setAttr(e.executionTitle,"value","".concat((null==t?void 0:t.name)||(null==t||null===(o=t.attributes)||void 0===o||null===(l=o.componentName)||void 0===l?void 0:l.componentType),".").concat(a)),s.$setAttr(e.executionContent,"editValue",{fn:[t.fid,"refreshData"],payloads:"function"==typeof i&&i()||[]}),s.$setAttr(e.executionContent,"editorChanged",!0),s.$setAttr(e.executionContent,"lastValue","method: ".concat(a)),s.$setAttr(e.executionContent,"value","method: ".concat(a))}}function getNewAttr(e,t){var a=window.$VUE_ROOT;e=t?Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.e)(e):e;var i=getUid(),n={};return function e(r){var o=Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.g)(r);if("array"===o)r.forEach((function(t){e(t)}));else if("object"===o)for(var l in r){var s=r[l];if(s.fid=i,!t){if(a.$removeAttr(s,"value"),a.$removeAttr(s,"editValue"),a.$removeAttr(s,"lastValue"),a.$removeAttr(s,"editorChanged"),a.$removeAttr(s,"visibleChanged"),a.$removeAttr(s,"readonlyChanged"),a.$removeAttr(s,"typeChanged"),a.$removeAttr(s,"linkConfig"),"executionContent"===l){var c=r.executionType,u=c&&c.default;s.editor=u||s.editor}r.hasOwnProperty("validateType")&&(s.hasOwnProperty("defaultVisible")?a.$setAttr(s,"visible",s.defaultVisible):a.$removeAttr(s,"visible"),s.hasOwnProperty("validateDefaultType")&&(a.$setAttr(s,"type",s.validateDefaultType),a.$removeAttr(s,"editor")))}s.customGroupName&&setCustomGroupNames(s.customGroupName,s,n);var d=s.attributes;if(d&&(e(d),Array.isArray(d))){var p=d.every((function(e){return!e.hasOwnProperty("attributes")}));null!=s&&s.readonly||!p||null==d||!d.length||d.splice(0,d.length-1)}}}(e),commitSetCustomGroupNames(n,e.componentFid),e}function getCustomMethodFunction(e,t){var a,i=this,n={};((null==e||null===(a=e.payload)||void 0===a?void 0:a.attributes)||[]).forEach((function(e){var t=getValueByDefault(e.name.value,e.name.default);t&&(n[t]=getValueByDefault(e.default.value,e.default.default))}));var r,o=Object.keys(n),l=o.join(","),s="const { ".concat(l," } = Arguments; \n"),c=(o.length?s:"")+getValueByDefault(e.content.value,e.content.default);try{var u=new Function("Arguments",c);u._paramKeys=o,r=function(){for(var e=arguments.length,a=new Array(e),n=0;n<e;n++)a[n]=arguments[n];var r={};return(u._paramKeys||[]).forEach((function(e,t){r[e]=a[t]})),u.call(t||i,r)}}catch(e){r=function(){}}return r}function convertSDCData(e){var t,a,i,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=null==e||null===(t=e.attributes)||void 0===t?void 0:t.scopedVariable;null!=r&&r.attributes.length&&(r.attributes.forEach((function(t,a){var i,n,o,l,s,c,u;if(null!==(i=t.name)&&void 0!==i&&i.value){var d="$V_"+t.name.value,p=((null===(n=t.alias)||void 0===n?void 0:n.value)||"[来自变量]")+" (".concat(null===(o=t.name)||void 0===o?void 0:o.value,")"),h=(null===(l=t.type)||void 0===l?void 0:l.value)||(null===(s=t.type)||void 0===s?void 0:s.default)||"String",f=null!==(c=t.value)&&void 0!==c&&c.linkConfig||null===(u=t.value)||void 0===u||!u.value?t.value.default:t.value.value;e.attributes[d]=Object.assign({alias:p,changeHandler:"customsChangeHandler",componentFid:r.componentFid,componentName:r.componentName,componentType:r.componentType,groupAlias:"自定义属性",groupName:"customs",name:d,sort:a,type:h,default:f},["Enum","Complex"].includes(h)?{editor:"code",editorDefined:"code",type:"Enum"===h?"Complex[*]":h,default:"Complex"===h?f||function(e){var t="";return((null==e?void 0:e.attributes)||[]).forEach((function(e){var a,i=null===(a=e.name)||void 0===a?void 0:a.value;if(i){var n,r=null!==(n=e.value)&&void 0!==n&&n.linkConfig?e.value.default:e.value.value;t+=(t?',\n  "':'\n  "')+i+'": '+(r?'"'+r+'"':"null")}})),"{"+t+"\n}"}(t.objectAttr):f}:{})}})),r.visible=!1);var o=null==e||null===(a=e.attributes)||void 0===a?void 0:a.customMethods;return null!=o&&null!==(i=o.attributes)&&void 0!==i&&i.length&&(o.attributes.forEach((function(t,a){var i,n,r=Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.e)(t.customMethodsSetting),o=null==r?void 0:r.attributes;if(null!=o&&null!==(i=o.functionName)&&void 0!==i&&i.value){var l="$_"+(null==o||null===(n=o.functionName)||void 0===n?void 0:n.value);o.functionName.readonly=!0,o.functionName.lastValue=l,o.functionName.value=l,delete o.content,e.attributes[l]={alias:o.description.value||"[自定义方法]",attributes:o,componentFid:r.componentFid,componentName:r.componentName,componentType:r.componentType,groupAlias:"方法",groupName:"methods",name:l,readonly:!0,sort:a,type:"Complex"}}})),o.visible=!1),Object.keys((null==e?void 0:e.attributes)||{}).forEach((function(t){separateAttrContent(e.attributes[t],n)})),e}var getNewVal=function(e){var t,a=Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.e)(e),i=getUid(),n={};return function e(a){var r=Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.g)(a);if("array"===r)a.forEach((function(t){e(t)}));else if("object"===r)for(var o in a){var l=a[o];if(l.fid=i,window.$VUE_ROOT.$removeAttr(l,"value"),window.$VUE_ROOT.$removeAttr(l,"editValue"),window.$VUE_ROOT.$removeAttr(l,"lastValue"),window.$VUE_ROOT.$removeAttr(l,"editorChanged"),window.$VUE_ROOT.$removeAttr(l,"visibleChanged"),window.$VUE_ROOT.$removeAttr(l,"readonlyChanged"),window.$VUE_ROOT.$removeAttr(l,"typeChanged"),window.$VUE_ROOT.$removeAttr(l,"linkConfig"),window.$VUE_ROOT.$removeAttr(l,"hidden"),"executionContent"===o){var s=a.executionType,c=s&&s.default;l.editor=c||l.editor}if(l.customGroupName){t=null==l?void 0:l.componentFid;var u=n[l.customGroupName];u||(u=n[l.customGroupName]=[]),u.push(l)}a.hasOwnProperty("validateType")&&(l.hasOwnProperty("defaultVisible")?window.$VUE_ROOT.$setAttr(l,"visible",l.defaultVisible):window.$VUE_ROOT.$removeAttr(l,"visible"),l.hasOwnProperty("validateDefaultType")&&(window.$VUE_ROOT.$setAttr(l,"type",l.validateDefaultType),window.$VUE_ROOT.$removeAttr(l,"editor")));var d=l.attributes;if(d&&(e(d),Array.isArray(d))){var p=d.every((function(e){return!e.hasOwnProperty("attributes")}));null!=l&&l.readonly||!p||null==d||!d.length||d.splice(0,d.length-1)}}}(a),t&&window.$VUE_ROOT.$store.commit("SET_CUSTOM_GROUP_NAMES",{fid:t,data:n}),a};function separateAttrContent(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("events"===e.originGroupName||"events"===e.groupName){var a,i,n=null==e||null===(a=e.attributes)||void 0===a||null===(i=a.content)||void 0===i?void 0:i.attributes;null!=n&&n.some((function(e){var t;return null===(t=e.executionContent)||void 0===t?void 0:t.value}))&&(t&&n.forEach((function(e){e.pageComponentName.hidden=!0})),null!=n&&n.every((function(e){return e.pageComponentName.hidden}))&&n.push(getNewVal(n[0])))}}function dealImportAttrs(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];try{var i=function(e,t){return e};Object.keys(e||{}).forEach((function(n){var r=e[n],o=t[n];if(o){var l=Object.keys(r||{})||[],s=4e3;l.forEach((function(e){var n=t[e];n&&(Object.keys(r[e]||{})||[]).forEach((function(t){if(n.attributes[t]){/^\$I_/.test(t)&&(n=i(n,t));var l="$I_"+n.fid+"_"+t,c=s;s++;var u=new Proxy(n.attributes[t],{get:function(a,i,n){return"alias"===i?r[e][t]:"groupAlias"===i?"引用":"groupName"===i?"imports":"originGroupAlias"===i?o.groupAlias:"originGroupName"===i?a.groupName:"name"===i?a[i]:"sort"===i?c:a[i]}});separateAttrContent(u,a),window.$VUE_ROOT.$set(o.attributes,l,u)}}))}))}}))}catch(e){}}function formatSDCComponent(e){var t,a,i,n=e.component,r=getUid().split("-")[1],o=window.$VUE_ROOT.$store.getters.getCount(e.SDCName),l={},s=null===(t=e.page)||void 0===t?void 0:t.fid,c=null===(a=window.$VUE_ROOT.$store.getters)||void 0===a?void 0:a.pageEditor,u=null==c?void 0:c.pagesKV[null==c?void 0:c.pagesActiveName],d=null==u||null===(i=u.page)||void 0===i?void 0:i.fid;l[s]=d;var p=new RegExp("(((#T-)(".concat(e.SDCName,'|[^",;.:}\\$]+)))|([a-z0-9]{8}-([a-z0-9]{4}-){3}[a-z0-9]{12})'),"g"),h=JSON.stringify(n).replace(p,(function(){var t=arguments.length<=3?void 0:arguments[3];if("#T-"===t){var a=arguments.length<=4?void 0:arguments[4],i=a===e.SDCName;if(i)return o;var n="#".concat(r,"-");return"".concat(n).concat(a)}var s=arguments.length<=0?void 0:arguments[0];return l[s]||(l[s]=getUid()),l[s]}));return{componentData:Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.j)(h),info:{uuid:r,sourceVersion:e.sourceVersion,sourceId:e.sourceId,sourceName:e.sourceName,sourcePath:e.sourcePath}}}function decomposeSDCComponent(e){var t=e.children,a=e.attributes.scopedVariable,i=window.$VUE_ROOT.$store.getters.pageEditor.pagesKV[window.$VUE_ROOT.$store.getters.pageEditor.pagesActiveName],n=function e(t){var a={};return Object.keys(t).forEach((function(i){a[i]=t[i],"array"===Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.g)(t[i])?a[i]=t[i].map((function(t){return e(t)})):"object"===Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.g)(t[i])&&(a[i]=e(t[i]))})),a.hasOwnProperty("componentFid")&&(a.componentFid=i.page.fid,a.componentName="Page",a.componentType="Page"),a},r=JSON.parse(JSON.stringify(a.attributes||[])).map((function(e){if(e.name.value)return e.name.lastValue=e.name.componentName+"_"+e.name.value,e.name.value=e.name.lastValue,n(e)})),o=i.page.attributes.customVariable.attributes;o.splice.apply(o,[o.length,0].concat(Object(_Users_yinhao_Workspace_frontend_page_webtools_page_node_modules_babel_runtime_corejs2_helpers_esm_toConsumableArray_js__WEBPACK_IMPORTED_MODULE_18__.a)((r||[]).filter((function(e){return!!e})))));var l={},s=e.attributes.customMethods,c=JSON.parse(JSON.stringify(s.attributes||[])).map((function(e){var t,a,i,r,o=e.customMethodsSetting.attributes.functionName.value;if(o){var s=o+"(".concat(e.name.componentName,")");l[o]=s,e.name.default="$_".concat(s),e.customMethodsSetting.attributes.functionName.lastValue=s,e.customMethodsSetting.attributes.functionName.value=s,e.customMethodsSetting.editValue.functionName=s,e.customMethodsSetting.lastValue="method: $_".concat(s),e.customMethodsSetting.value="method: $_".concat(s);var c={content:null===(t=e.customMethodsSetting.attributes.content)||void 0===t?void 0:t.value,description:null===(a=e.customMethodsSetting.attributes.description)||void 0===a?void 0:a.value,functionName:null===(i=e.customMethodsSetting.attributes.functionName)||void 0===i?void 0:i.value,payload:((null===(r=e.customMethodsSetting.attributes.payload)||void 0===r?void 0:r.attributes)||[]).map((function(e){var t,a;return{alias:null===(t=e.alias)||void 0===t?void 0:t.value,name:null===(a=e.name)||void 0===a?void 0:a.value}}))};return window.$VUE_ROOT.$store.dispatch("addCustomMethods",c),n(e)}})),u=i.page.attributes.customMethods.attributes;u.splice.apply(u,[u.length,0].concat(Object(_Users_yinhao_Workspace_frontend_page_webtools_page_node_modules_babel_runtime_corejs2_helpers_esm_toConsumableArray_js__WEBPACK_IMPORTED_MODULE_18__.a)((c||[]).filter((function(e){return!!e})))));var d=Object.keys(e.attributes).filter((function(t){return t.startsWith("$I_")&&"methods"===e.attributes[t].originGroupName})),p={};d.forEach((function(t){var a=e.attributes[t],i=t.replace("$I_".concat(a.componentFid,"_"),"");p[i+"_"+a.componentFid]={name:i,fid:a.componentFid,componentName:a.componentType}}));var h=function(t){(Array.isArray(t)?t:[t]).forEach((function(t){getValueByDefault(t.executionType.value,t.executionType.default);var a,n,r,o,s=Object.keys(l).find((function(e){return t.pageComponentMethod.value==="$_".concat(e)}));if(s)if(window.$VUE_ROOT.$store.getters.pageEditor.isSDCEditor){var c=i.component[0];a="$_".concat(l[s]),n=c.fid,r=c.name}else a="$_".concat(l[s]),n=i.page.fid,r="Page";else p[t.pageComponentMethod.value]&&(a=p[t.pageComponentMethod.value].name,n=p[t.pageComponentMethod.value].fid,r=p[t.pageComponentMethod.value].componentName);t.pageComponentName.value===e.fid&&a&&(t.pageComponentName.lastValue=n,t.pageComponentName.value=n,t.pageComponentMethod.lastValue=a,t.pageComponentMethod.value=a,t.executionTitle.lastValue="".concat(r,".").concat(a),t.executionTitle.value="".concat(r,".").concat(a),t.executionContent.lastValue="method: ".concat(a),t.executionContent.value="method: ".concat(a),(o=t.executionContent.editValue.fn).splice.apply(o,[0,2].concat([n,a])))}))};(function e(t){(t||[]).forEach((function(t){var a;"block"!==t.name?(null!==(a=t.children)&&void 0!==a&&a.length&&e(t.children),function e(t){"object"===Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.g)(t)?t.attributes?e(t.attributes):Object.keys(t).forEach((function(a){e(t[a])})):"array"===Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.g)(t)&&t.forEach((function(t){t.hasOwnProperty("executionContent")?h(t):e(t)}))}(t.attributes)):e(t.children)}))})(i.component),t.forEach((function(t){t.parentFid=e.parentFid}));var f=e.attributes.componentName.value,m=e.attributes.uuid.value,v=new RegExp("#".concat(m,"-"),"g"),b=JSON.stringify(t).replace(v,(function(){return f+"-"}));return Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.j)(b)}function checkUpdateSDCBatch(e,t,a){return _checkUpdateSDCBatch.apply(this,arguments)}function _checkUpdateSDCBatch(){return(_checkUpdateSDCBatch=Object(_Users_yinhao_Workspace_frontend_page_webtools_page_node_modules_babel_runtime_corejs2_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_7__.a)(_babel_runtime_corejs2_regenerator__WEBPACK_IMPORTED_MODULE_27___default.a.mark((function e(t,a,i){var n,r,o;return _babel_runtime_corejs2_regenerator__WEBPACK_IMPORTED_MODULE_27___default.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=[],r=[],Object.keys(t||{}).forEach((function(e){e.indexOf("/")>-1?r.push(e):n.push(e)})),o=[],e.t0=n.length||r.length,!e.t0){e.next=8;break}return e.next=8,window.$VUE_ROOT.$store.dispatch("fetchSDCComponent",{pageIds:n,pagePaths:r}).then(function(){var e=Object(_Users_yinhao_Workspace_frontend_page_webtools_page_node_modules_babel_runtime_corejs2_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_7__.a)(_babel_runtime_corejs2_regenerator__WEBPACK_IMPORTED_MODULE_27___default.a.mark((function e(n){var r;return _babel_runtime_corejs2_regenerator__WEBPACK_IMPORTED_MODULE_27___default.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(null!=n&&n.pageIds.length||null!=n&&n.pagePaths.length)&&(r=function(){var e=Object(_Users_yinhao_Workspace_frontend_page_webtools_page_node_modules_babel_runtime_corejs2_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_7__.a)(_babel_runtime_corejs2_regenerator__WEBPACK_IMPORTED_MODULE_27___default.a.mark((function e(){var r,l,s,c,u,d;return _babel_runtime_corejs2_regenerator__WEBPACK_IMPORTED_MODULE_27___default.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=function(e,t,n,r){var o,l,s,c=e.component,u=c[0],d=getUid(),p=r||d.split("-")[1],h={},f=null===(o=e.page)||void 0===o?void 0:o.fid,m=null===(l=a.page)||void 0===l?void 0:l.fid;h[f]=m;var v=i[n],b=null===(s=u.attributes.find((function(e){return"importsManager"===e.name})))||void 0===s?void 0:s.value,g={};v&&b&&Object.keys(b||{}).forEach((function(e){var t=Object.keys(v).find((function(t){return JSON.stringify(v[t])===JSON.stringify(b[e])}));t&&(g[e]=t)}));var y=new RegExp("(((#T-)(".concat(e.SDCName,'|[^",;.]+)))|([a-z0-9]{8}-([a-z0-9]{4}-){3}[a-z0-9]{12})'),"g"),_=JSON.stringify(c).replace(y,(function(){var a=arguments.length<=3?void 0:arguments[3];if("#T-"===a){var i=arguments.length<=4?void 0:arguments[4],r=i===e.SDCName;if(r)return t;var o="#".concat(p,"-");return"".concat(o).concat(i)}var l=arguments.length<=0?void 0:arguments[0];return l===u.fid?n:g[l]?g[l]:(h[l]||(h[l]=getUid()),h[l])}));return{componentData:Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.j)(_),info:{uuid:p,sourceVersion:e.sourceVersion,sourceId:e.sourceId,sourceName:e.sourceName,sourcePath:e.sourcePath}}},l=function(){var e=Object(_Users_yinhao_Workspace_frontend_page_webtools_page_node_modules_babel_runtime_corejs2_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_7__.a)(_babel_runtime_corejs2_regenerator__WEBPACK_IMPORTED_MODULE_27___default.a.mark((function e(t,i){var n,l,s;return _babel_runtime_corejs2_regenerator__WEBPACK_IMPORTED_MODULE_27___default.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==t||!t.editContent||!i){e.next=15;break}(n=Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.j)(t.editContent)||{}).SDCName=t.componentName,n.sourceId=t.id,n.sourceName=t.name,n.sourcePath=t.path,n.sourceVersion=t.version,window.$VUE_ROOT.$store.state.pageEditor.SDCComponentsCache[t.id]=n,l=_babel_runtime_corejs2_regenerator__WEBPACK_IMPORTED_MODULE_27___default.a.mark((function e(){var n,l,c,u,d;return _babel_runtime_corejs2_regenerator__WEBPACK_IMPORTED_MODULE_27___default.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i[s],l=a.componentKV[n.compFid],c=l.parentFid?a.componentKV[l.parentFid]:null,u=l.parentFid?c.children:a.component,d=null==u?void 0:u.findIndex((function(e){return e.fid===l.fid})),e.next=7,window.$VUE_ROOT.$store.dispatch("removeComponent",{fid:l.fid,keepSaved:!0});case 7:return e.next=9,window.$VUE_ROOT.$store.dispatch("getSDCComponent",_objectSpread({SDCName:t.componentName,sourceId:t.id,replaceFn:function(e){var t;return r(e,l.attributes.componentName.value,l.fid,null===(t=l.attributes.uuid)||void 0===t?void 0:t.value)}},c||{})).then((function(e){var t=e.importAttrs;if(delete e.importAttrs,e.parentFid=l.parentFid,d>-1){var i=(null==u?void 0:u.findIndex((function(e){return e.fid===l.fid})))>-1;u.splice(d,i?1:0,e)}else u.push(e);dealImportAttrs(t,a.componentKV,!0),o.push(e)}));case 9:case"end":return e.stop()}}),e)})),s=0;case 10:if(!(s<(null==i?void 0:i.length))){e.next=15;break}return e.delegateYield(l(),"t0",12);case 12:s++,e.next=10;break;case 15:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),s=_babel_runtime_corejs2_regenerator__WEBPACK_IMPORTED_MODULE_27___default.a.mark((function e(){var a,i,r;return _babel_runtime_corejs2_regenerator__WEBPACK_IMPORTED_MODULE_27___default.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=n.pageIds[c],r=null===(a=t[i.id])||void 0===a?void 0:a.filter((function(e){return+i.version>+e.sourceVersion})),e.next=4,l(i,r);case 4:case"end":return e.stop()}}),e)})),c=0;case 4:if(!(c<((null==n?void 0:n.pageIds)||[]).length)){e.next=9;break}return e.delegateYield(s(),"t0",6);case 6:c++,e.next=4;break;case 9:u=_babel_runtime_corejs2_regenerator__WEBPACK_IMPORTED_MODULE_27___default.a.mark((function e(){var a,i,r;return _babel_runtime_corejs2_regenerator__WEBPACK_IMPORTED_MODULE_27___default.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=n.pagePaths[d],r=null===(a=t[i.path])||void 0===a?void 0:a.filter((function(e){return+i.version>+e.sourceVersion})),e.next=4,l(i,r);case 4:case"end":return e.stop()}}),e)})),d=0;case 11:if(!(d<((null==n?void 0:n.pagePaths)||[]).length)){e.next=16;break}return e.delegateYield(u(),"t1",13);case 13:d++,e.next=11;break;case 16:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),((n.pageIds||[]).some((function(e){var a,i;return(null==e?void 0:e.editContent)&&(null===(a=t[e.id])||void 0===a||null===(i=a.filter((function(t){return+e.version>+t.sourceVersion})))||void 0===i?void 0:i.length)}))||(n.pagePaths||[]).some((function(e){var a,i;return(null==e?void 0:e.editContent)&&(null===(a=t[e.path])||void 0===a||null===(i=a.filter((function(t){return+e.version>+t.sourceVersion})))||void 0===i?void 0:i.length)})))&&window.$VUE_ROOT.$confirm("当前页面使用的二开组件存在更新，点击确定更新后，对二开组件配置的个性内容将还原为初始状态?","是否更新",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){r()})).catch((function(){})).finally((function(){})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){}));case 8:return e.abrupt("return",o);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function checkUpdateSDCRuntime(e,t,a,i){return _checkUpdateSDCRuntime.apply(this,arguments)}function _checkUpdateSDCRuntime(){return(_checkUpdateSDCRuntime=Object(_Users_yinhao_Workspace_frontend_page_webtools_page_node_modules_babel_runtime_corejs2_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_7__.a)(_babel_runtime_corejs2_regenerator__WEBPACK_IMPORTED_MODULE_27___default.a.mark((function e(t,a,i,n){var r;return _babel_runtime_corejs2_regenerator__WEBPACK_IMPORTED_MODULE_27___default.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Object.keys(t||{}),e.abrupt("return",r.length&&window.$VUE_ROOT.$store.dispatch("fetchPublishedPage",{pageIds:r}).then((function(e){if(e.length){var r=function(e,t,n,r){var o,l,s,c=e.component,u=c[0],d=u.componentId.replace("#T-",""),p=getUid(),h=r||p.split("-")[1],f={},m=null===(o=e.page)||void 0===o?void 0:o.fid,v=null===(l=a.page)||void 0===l?void 0:l.fid;f[m]=v;var b=i[n],g=null===(s=u.attributes.find((function(e){return"importsManager"===e.name})))||void 0===s?void 0:s.value,y={};b&&g&&Object.keys(g||{}).forEach((function(e){var t=Object.keys(b).find((function(t){return JSON.stringify(b[t])===JSON.stringify(g[e])}));t&&(y[e]=t)}));var _=new RegExp("(((#T-)(".concat(d,'|[^",;.]+)))|([a-z0-9]{8}-([a-z0-9]{4}-){3}[a-z0-9]{12})'),"g"),C=JSON.stringify(c).replace(_,(function(){var e=arguments.length<=3?void 0:arguments[3];if("#T-"===e){var a=arguments.length<=4?void 0:arguments[4],i=a===d;if(i)return t;var r="#".concat(h,"-");return"".concat(r).concat(a)}var o=arguments.length<=0?void 0:arguments[0];return o===u.fid?n:y[o]?y[o]:(f[o]||(f[o]=getUid()),f[o])}));return{componentData:Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.j)(C),info:{uuid:h}}},o=function(e,t,a){return getConvertedComponent(e,(function(e,r){var o,l,s,c,u,d,p,h;if(DATA_CONTAINER_TYPES_CONST.includes(e.name)&&e.attributes.some((function(e){return"keepValue"===e.name&&!(e.visible&&e.value)}))){var f=e.attributes.findIndex((function(e){return"value"===e.name&&!(e.visible&&e.value)}));e.attributes.splice(f,1)}r||(r=a);var m,v=("block"===(null===(o=r)||void 0===o?void 0:o.name)||["dataContainer"].includes(null===(l=r)||void 0===l?void 0:l.groupName)?null===(s=r)||void 0===s?void 0:s.componentType:null===(c=r)||void 0===c?void 0:c.name)||(null===(u=r)||void 0===u?void 0:u.componentType),b=e.name,g="ContainerSDC"===b,y=n[b];if(!y)return e.pageId=t.pageId,e.pageVersion=t.pageVersion,e.parentFid=null===(m=r)||void 0===m?void 0:m.fid,e;["dataContainer"].includes(y.groupName)&&(y.componentType=v);var _,C,O,T=getComponentData(y,null,null,e);return T.converted=convertedComponentData(T.converted,v),T.converted.pageId=t.pageId,T.converted.pageVersion=t.pageVersion,T.converted.parentFid=null===(d=r)||void 0===d?void 0:d.fid,g?(_=mergeDataByValueData(T.converted,_objectSpread(_objectSpread({},e),{},{attributes:e.attributes.filter((function(e){return!e.name.startsWith("$V_")}))})),T.converted=convertSDCData(T.converted),_=mergeDataByValueData(T.converted,_objectSpread(_objectSpread({},e),{},{attributes:e.attributes.filter((function(e){return e.name.startsWith("$V_")}))}))):_=mergeDataByValueData(T.converted,e),g&&null!==(p=_.attributes)&&void 0!==p&&null!==(h=p.importsManager)&&void 0!==h&&h.value&&(i[_.fid]=null===(C=_.attributes)||void 0===C||null===(O=C.importsManager)||void 0===O?void 0:O.value),_}))};e.forEach(function(){var e=Object(_Users_yinhao_Workspace_frontend_page_webtools_page_node_modules_babel_runtime_corejs2_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_7__.a)(_babel_runtime_corejs2_regenerator__WEBPACK_IMPORTED_MODULE_27___default.a.mark((function e(i){var n,l,s;return _babel_runtime_corejs2_regenerator__WEBPACK_IMPORTED_MODULE_27___default.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:l=null===(n=t[i.pageId])||void 0===n?void 0:n.filter((function(e){return+i.version>+e.sourceVersion})),null!=i&&i.pageData&&l&&(s=Object(_base_util__WEBPACK_IMPORTED_MODULE_32__.j)(i.pageData)||{},l.forEach((function(e){var t,i=a.componentKV[e.compFid],n=i.parentFid?a.componentKV[i.parentFid]:a.page,l=i.parentFid?n.children:a.component,c=l.findIndex((function(e){return e.fid===i.fid})),u=r(s,i.attributes.componentName.value,i.fid,null===(t=i.attributes.uuid)||void 0===t?void 0:t.value),d=o(u.componentData,i,i.parentFid?n:null);d.length&&(d[0].parentFid=i.parentFid,a.componentKV[d[0].fid]=d[0],l.splice(c,1,d[0]))})));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}})).catch((function(e){})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var findTopSDCComponentByFid=function(e){var t,a,i,n,r,o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],l=null===(t=window.$VUE_ROOT)||void 0===t||null===(a=t.$store)||void 0===a||null===(i=a.getters)||void 0===i?void 0:i.pageEditor,s=l.pagesKV[l.pagesActiveName],c=null==s?void 0:s.componentKV,u=e,d=c[e];if(new RegExp(REG_SDC_INNER_COMP_NAME).test(null===(n=d.attributes)||void 0===n||null===(r=n.componentName)||void 0===r?void 0:r.value)){var p=function e(t){var a=c[t];("ContainerSDC"!==a.name||(u=t,o))&&null!=a&&a.parentFid&&e(a.parentFid)};p(d.parentFid)}return u},replaceAllByKV=function(e,t){var a=new RegExp("".concat(Object.keys(t).join("|")),"g");return e.replace(a,(function(){for(var e=arguments.length,a=new Array(e),i=0;i<e;i++)a[i]=arguments[i];return"".concat(t[a[0]])}))},arrayTo2dByLength=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30;if(!Array.isArray(e)||isNaN(Number(t))&&t>0)return e;var a=[],i=0;return e.forEach((function(e,n){n===(i+1)*t&&(i++,a.push([])),Array.isArray(a[i])||(a[i]=[]),a[i].push(e)})),a},array2dToArray=function(e){return Array.isArray(e)?e.reduce((function(e,t){return[].concat(Object(_Users_yinhao_Workspace_frontend_page_webtools_page_node_modules_babel_runtime_corejs2_helpers_esm_toConsumableArray_js__WEBPACK_IMPORTED_MODULE_18__.a)(e),Object(_Users_yinhao_Workspace_frontend_page_webtools_page_node_modules_babel_runtime_corejs2_helpers_esm_toConsumableArray_js__WEBPACK_IMPORTED_MODULE_18__.a)(Array.isArray(t)?t:[]))}),[]):e};__webpack_exports__.D={CONST:CONST,getUid:getUid,getSmartAttrs:getSmartAttrs,forEachAttrs:forEachAttrs,isBlank:isBlank,getThemeValueByName:getThemeValueByName,getValueByDefault:getValueByDefault,transformHump:transformHump,formatDateValue:formatDateValue,getValueByObjectKey:getValueByObjectKey,pageLogInfo:pageLogInfo,getReplacedMessage:getReplacedMessage,getPageVariables:getPageVariables,getCustomVariables:getCustomVariables,filterScript:filterScript,getComponentCopyData:getComponentCopyData,listToTree:listToTree,convertTree:convertTree,getThemeColor:getThemeColor,convert2dLinkData:convert2dLinkData,sleepWait:sleepWait,setEventNormalMethodValue:setEventNormalMethodValue,getNewAttr:getNewAttr,arrayTo2dByLength:arrayTo2dByLength,array2dToArray:array2dToArray}},c66e:function(e,t,a){"use strict";a("028d")},c68f:function(e,t,a){},c74f:function(e,t,a){},c75a:function(e,t,a){},c792:function(e,t,a){"use strict";a("d2fc")},c7fd:function(e,t,a){"use strict";a("7f7f");var i=(a("a481"),a("75fc")),n=(a("28a5"),a("ac6a"),a("c276")),r=a("b19c"),o=function(e){var t={};for(var a in e){var i=e[a];"name"===a?t.name=Object(n.pb)(i.value,i.default):"alias"===a?t.alias=Object(n.pb)(i.value,i.default):"description"===a?t.description=Object(n.pb)(i.value,i.default):"editor"===a&&(t.editor=Object(n.pb)(i.value,i.default))}return t},l={name:"ParamsSelect",props:{value:{type:Array,default:function(){return[{name:"",value:"",filter:"",editValue:null,config:{}}]}},showFilterType:{type:Boolean,default:!1},showDescription:{type:Boolean,default:!1},descriptionReadonly:{type:Boolean,default:!0},nameReadonly:{type:Boolean,default:!1},filterClearable:{type:Boolean,default:!1},showPublicAdd:{type:Boolean,default:!0},operationsLayout:{type:[Array,String],default:"top, bottom, del, clear"}},created:function(){this.payloads=this.value},watch:{value:function(e,t){this.payloads=this.value}},data:function(){return{compoundItem:[{label:"变量选择",value:"variable",formItem:"variable-Panel"},{label:"手动输入",value:"static",formItem:"input",placeholder:"支持字符、${...}、字符与${...}混合三种形式的输入，${...}是对变量的引用，其中...为变量名",tips:"支持字符、${...}、字符与${...}混合三种形式的输入，${...}是对变量的引用，其中...为变量名"},{label:"表达式",value:"useExpression",formItem:"input",placeholder:"支持js表达式语法，支持混合使用变量，${...}是对变量的引用，其中...为变量名",tips:"支持js表达式语法，支持混合使用变量，${...}是对变量的引用，其中...为变量名"}],changed:!0,filterTypes:[{label:"无",value:""},{label:"等于",value:"eq"},{label:"不等于",value:"ne"},{label:"大于",value:"gt"},{label:"大于等于",value:"gte"},{label:"小于",value:"lt"},{label:"小于等于",value:"lte"},{label:"逻辑与",value:"and"},{label:"逻辑或",value:"or"},{label:"逻辑非",value:"not"}],payloads:[{name:"",value:"",filter:"",editValue:null,config:{}}],dialogVisible:!1}},methods:{formatCompoundItem:function(e){var t,a;return null!=e&&null!==(t=e.config)&&void 0!==t&&null!==(a=t.compoundItem)&&void 0!==a&&a.length?e.config.compoundItem:this.compoundItem},getPayloads:function(e){var t=[];if("array"===Object(r.g)(e))e.forEach((function(e){if(!t.length){var a="payload"===e.name?e.attributes:e.payload?e.payload.attributes:null;a&&a.forEach((function(e){var a=o(e);t.push(a)}))}}));else if("object"===Object(r.g)(e))for(var a in e)if("payload"===a){e[a].attributes.forEach((function(e){var a=o(e);t.push(a)}))}return t},handleEvents:function(e,t){var a=this,i=this.payloads.length;if("add"===e)return i>n.a.MAX_LENGTH_ADD?void this.$message({message:"最多添加"+n.a.MAX_LENGTH_ADD+"项！",type:"warning"}):(this.payloads.push({name:"",value:"",filter:"",editValue:null,config:{}}),void this.emitChange());if("del"!==e){if("top"===e){if(0===t)return;var r=this.payloads.splice(t,1);return this.payloads.splice(t-1,0,r[0]),void this.emitChange()}if("bottom"===e){if(t===i-1)return;var o=this.payloads.splice(t,1);this.payloads.splice(t+1,0,o[0]),this.emitChange()}"clear"===e&&this.emitChange()}else this.$confirm("确定要删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){a.payloads.splice(t,1),a.emitChange()})).catch((function(){}))},importVariable:function(){var e=this;this.$confirm("导入页面变量会清空已有配置，你确定要导入吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var t=Object(n.ab)(e.pageInfo.page.attributes.customVariable);t?(e.payloads=[],e.handleImportVariable(t)):e.$message.warning("页面未定义自定义变量!")})).catch((function(){}))},handleImportVariable:function(e,t){for(var a in e){var i=e[a],n=t?t+"."+a:a;"object"===Object(r.g)(i)&&this.handleImportVariable(i,n);var o={name:n,value:"${"+n+"}",filter:"",editValue:{type:"variable",static:"",variable:this.getEditValueVariable(n)}};this.payloads.push(o)}},getEditValueVariable:function(e){if(!e)return[];var t=[];return e.split(".").forEach((function(e){t.push(e)})),t},variableOnChange:function(e){this.emitChange()},onNameChange:function(){this.emitChange()},onFilterChanged:function(){this.emitChange()},emitChange:function(){this.$emit("input",this.payloads),this.$emit("change",this.payloads)}},computed:{themeStyles:function(){return{target:"th,td",style:{"border-width":Object(n.nb)("borderWidth"),"border-style":Object(n.nb)("borderStyle"),"border-color":Object(n.nb)("borderColor"),padding:"0 5px"}}},theadStyles:function(){return{"background-color":Object(n.nb)("middleBackgroundColor")}},pageInfo:function(){var e=this.$store.getters.pageEditor;return e.pagesKV[e.pagesActiveName]},newArgs:function(){if(this.args&&this.args.length)return Object(i.a)(this.args);var e=this.getPayloads(this.parent&&this.parent.attributes);return e.length>0?e:(e=this.getPayloads(this.parentParent&&this.parentParent.attributes)).length>0?e:[]},operationsLayout$:function(){var e=this.operationsLayout;return"string"==typeof e&&e&&(e=(e=e.replace(/\s/g,"")).split(",")),e||[]}}},s=(a("73bb"),a("2877")),c=Object(s.a)(l,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"params-select"},[t("table",{directives:[{name:"theme",rawName:"v-theme",value:e.themeStyles,expression:"themeStyles"}],staticClass:"hc-editor-payload-table"},[t("thead",{staticClass:"hc-editor-payload-table-thead",style:e.theadStyles},[t("tr",[t("th",{attrs:{width:"30%"}},[e._v("参数名")]),t("th",[e._v("参数值")]),e.showFilterType?t("th",{attrs:{width:"12%"}},[e._v("过滤类型")]):e._e(),e.showDescription?t("th",{attrs:{width:"18%"}},[e._v("描述")]):e._e(),e.operationsLayout$&&e.operationsLayout$.length>0?t("th",{attrs:{width:"18%"}},[e._v("操作")]):e._e()])]),t("tbody",{staticClass:"hc-editor-payload-table-tbody"},e._l(e.payloads,(function(a,i){return t("tr",{key:i},[t("td",[t("el-input",{class:{readonly:e.nameReadonly},attrs:{readonly:e.nameReadonly,size:"mini",placeholder:"请输入参数名",clearable:""},on:{blur:e.onNameChange},model:{value:a.name,callback:function(t){e.$set(a,"name",t)},expression:"param.name"}})],1),t("td",[t("variable-editor-components",{attrs:{compoundItem:e.formatCompoundItem(a),options:a.config&&a.config.options||[],data:a,args:e.newArgs},on:{change:e.variableOnChange}})],1),e.showFilterType?t("td",[t("el-select",{attrs:{clearable:e.filterClearable,size:"mini",placeholder:"请选择"},on:{change:e.onFilterChanged},model:{value:a.filter,callback:function(t){e.$set(a,"filter",t)},expression:"param.filter"}},e._l(a.config&&a.config.filterTypes||e.filterTypes,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1):e._e(),e.showDescription?t("td",[t("el-input",{class:{readonly:e.descriptionReadonly},attrs:{readonly:e.descriptionReadonly,size:"mini",placeholder:""},model:{value:a.description,callback:function(t){e.$set(a,"description",t)},expression:"param.description"}})],1):e._e(),e.operationsLayout$&&e.operationsLayout$.length>0?t("td",{staticClass:"hc-payload-operation",attrs:{align:"center"}},[t("CommonTableMoveOprate",{attrs:{data:e.payloads,index:i,icon:!1,text:!0,layout:e.operationsLayout$,defaultValue:a.config&&a.config.defaultValue||{}},on:{click:e.handleEvents}})],1):e._e()])})),0)]),e.showPublicAdd?t("div",{staticClass:"params-add-btn"},[t("el-button",{attrs:{title:"新增",icon:"el-icon-plus",plain:""},on:{click:function(t){return e.handleEvents("add")}}},[e._v("添加参数")])],1):e._e()])}),[],!1,null,"35f3aa9b",null);t.a=c.exports},c840:function(e,t,a){},c986:function(e,t,a){},c9a8:function(e,t,a){"use strict";a("0791")},cab9:function(e,t,a){"use strict";a("e9b4")},caeb:function(e,t,a){"use strict";a("2385")},cbd9:function(e,t,a){"use strict";a.r(t),a("6762"),a("2fdb");var i=(a("ac4d"),a("8a81"),a("5df3"),a("1c4c"),a("6b54"),a("8e6e"),a("456d"),a("7618")),n=(a("7514"),a("ac6a"),a("75fc")),r=a("bd86"),o=(a("7f7f"),a("a8db")),l=a("04c8"),s=a("c276"),c=a("b19c"),u=(a("542c"),function(){var e=this,t=e._self._c;return t("el-select",{ref:"treeSelect",staticClass:"variable-tree-select-single",attrs:{value:e.currentName,"value-key":e.value,clearable:"",filterable:"",disabled:e.disabled,placeholder:e.placeholder,"filter-method":e.handleSelectFilter},on:{clear:e.handleSelectClear}},[t("el-option",{attrs:{hidden:"",value:e.value,id:"tree-option",created:""}}),t("el-tree",{ref:"tree",attrs:{"expand-on-click-node":!1,"current-node-key":e.value,nodeKey:"id","highlight-current":e.value,props:e.treeProps,data:e.treeData,"default-expanded-keys":e.defaultExpandedKeys,"filter-node-method":e.filterNode},on:{"node-click":e.onTreeSelectClick}})],1)}),d=(a("c5f6"),{name:"VariableTreeSelectSingle",model:{prop:"value",event:"change"},props:{value:{type:[String,Number],default:void 0},placeholder:{type:String,default:"请选择"},treeData:{type:Array,default:function(){return[]}},disabled:{type:Boolean,default:!1},treeProps:{type:Object,default:function(){return{label:"label",value:"id"}}}},data:function(){return{currentNode:{}}},computed:{currentName:function(){var e;return null===(e=this.currentNode)||void 0===e?void 0:e.label},defaultExpandedKeys:function(){var e=["-1"];return this.value&&e.push(this.value),e}},watch:{treeData:{handler:function(e){var t=this.getCurrentNode(this.value,e);this.currentNode=t||{}},deep:!0,immediate:!0},filterText:function(e){this.$refs.tree.filter(e)}},methods:{getCurrentNode:function(e,t){var a=null;return function t(i){i&&i.forEach((function(i){var n;i.id===e?a=i:null!=i&&null!==(n=i.children)&&void 0!==n&&n.length&&t(i.children)}))}(t),a},filterNode:function(e,t){return!e||-1!==t.label.indexOf(e)},handleSelectClear:function(){this.currentNode={},this.onValueChange(void 0)},onTreeSelectClick:function(e){this.onValueChange(e.id,e),this.currentNode=e,this.$refs.treeSelect.blur()},onValueChange:function(e,t){this.$emit("change",e,t)},handleSelectFilter:function(e){return this.$refs.tree&&this.$refs.tree.filter(e),!1}}}),p=(a("4cd5"),a("7c59"),a("2877")),h=Object(p.a)(d,u,[],!1,null,"7f8d2efd",null).exports,f=a("dd8a"),m=a("d98f"),v=["name","type","alias","lastValue","editValue"];function b(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return g(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?g(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,l=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return o=e.done,e},e:function(e){l=!0,r=e},f:function(){try{o||null==a.return||a.return()}finally{if(l)throw r}}}}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=new Array(t);a<t;a++)i[a]=e[a];return i}function y(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function _(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?y(Object(a),!0).forEach((function(t){Object(r.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):y(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var C={name:"VariableEditorComponents",components:{VariablePanel:l.a,VariableTreeSelectSingle:h,CodeEditor:f.default,VirtualSelect:m.default},model:{prop:"value",event:"change"},props:{compoundItem:{type:Array,default:function(){return[{label:"变量选择",value:"variable",formItem:"variable-Panel"},{label:"手动输入",value:"static",formItem:"treeselect"}]}},value:{type:String,default:""},onlyName:{type:Boolean,default:function(){return!1}},args:{type:Array,default:function(){return[]}},data:{type:Object,default:function(){return{alias:"",type:"",default:"",value:"",primitiveLabels:""}}},disabled:{type:Boolean,default:function(){return!1}},placeholder:{type:String,default:""},params:{type:Object,default:function(){return{}}},handleRulesResult:{type:Function,default:function(){}},handleChangeResult:{type:Function,default:function(){}},valueFormat:{type:String,default:"yyyyMMddHHmmss"},staticType:{type:String,default:"static"},selectProps:{type:Object,default:function(){return{}}},options:{type:Array,default:function(){return[]}},target:{type:Object,default:function(){return{}}}},computed:{excludes:function(){var e=this.$store.getters.pageEditor,t=e&&e.pagesKV[e.pagesActiveName];return["Page","Arguments","pageVariable","customVariable","Response","Request",t?t.page.fid:""]},inputPlaceholder:function(){return"variable"===this.editValType?"点击选择":"请输入内容"},compProps:function(){var e=this.data,t=(e.name,e.type,e.alias,e.lastValue,e.editValue,Object(o.a)(e,v));return void 0===this.data.default||t.hasOwnProperty("value")||(t.value=this.data.default),t},showCodeEdit:function(){return["Array","Object"].includes(this.staticType)},optionProps:function(){var e=this.data.props||{};return _(_(_({checkStrictly:!0,emitPath:!1},this.defaultSelectProps),this.selectProps),e)},mergeOptions:function(){var e=[].concat(Object(n.a)(this.options),Object(n.a)(this.asyncOptions)),t=this.optionProps.value,a=[],i={};return e.forEach((function(e){var n=void 0!==e[t]?e[t]:e.value;i[n]||(a.push(e),i[n]=!0)})),a}},data:function(){return{selectLabel:{label:"变量选择",value:"variable",formItem:"variable-Panel"},showVal:"",editVal:{type:"variable",static:null,variable:[],useExpression:!1},popoverVisible:!1,editValType:"variable",editValStaticVar:"",asyncOptions:[],defaultSelectProps:{label:"name",value:"id"}}},watch:{"data.value":function(e){this.initData()},"data.type":function(e){this.initData()},popoverVisible:function(e){var t=this;e&&this.$nextTick((function(){var e=document.querySelectorAll(".variablePopper"),a=e[e.length-1],i={threshold:1,root:document};new IntersectionObserver((function(e,a){e.forEach((function(e){e.intersectionRatio<1&&setTimeout((function(){t.$refs.variablePopper.updatePopper()}),200)}))}),i).observe(a)}))}},created:function(){var e=this;this.initData(),this.$nextTick((function(){"variable"===e.editVal.type?(e.editValType=e.editVal.type,e.editValStaticVar=e.editVal.variable.length>0?"${".concat(e.editVal.variable.join("."),"}"):""):(e.editValType=e.editVal.useExpression?"useExpression":"static",e.editValStaticVar=e.editVal.static),e.selectLabel=e.compoundItem.find((function(t){return t.value===e.editValType})),"switch"===e.selectLabel.formItem&&"boolean"!=typeof e.editVal.static&&(e.editVal.static=!(!e.editVal.static||["0","false",0].includes(e.editVal.static)))}))},methods:{clearVariable:function(){this.editVal.static=null,this.editVal[this.staticType]=null,this.editVal.variable=[],this.editVal.useExpression=!1,this.popoverVisible=!1,this.editValStaticVar="",this.showVal=this.getShowVal(),this.$removeAttr(this.data,"value"),this.$removeAttr(this.data,"lastValue"),this.$removeAttr(this.data,"editValue"),this.$emit("change","")},changeVariable:function(e){var t=this;this.popoverVisible=!1,e.length<1||(this.clickSure(),this.$nextTick((function(){t.editValStaticVar=t.getShowVal()})))},changetype:function(e){this.editVal.useExpression="useExpression"===e,this.selectLabel=this.compoundItem.find((function(t){return t.value===e})),"variable"===e?(this.editVal.type=e,this.editValStaticVar="",this.editVal.static=null,this.clickSure()):(this.editVal.type=this.staticType,this.editVal.variable=[],this.editValStaticVar=null,"switch"===this.selectLabel.formItem&&"boolean"!=typeof this.editVal.static?this.editVal.static=!(!this.editVal.static||["0","false",0].includes(this.editVal.static)):(this.editVal[this.editVal.type]=null,this.editVal.static=null),this.clickSure())},onValueChange:function(e,t){this.$emit("change",e,t)},initData:function(){var e=this,t=Object(s.pb)(this.data.value,this.data.default);this.editVal=Object(c.e)(this.data.editValue||{type:this.data.type||"variable",static:null,variable:[],useExpression:!1}),"variable"!==this.editVal.type&&(this.editVal.type=this.staticType),this.editVal.variable&&this.editVal.variable.length&&(this.editVal.variable=this.compatible(this.editVal.variable)),t&&"object"!==Object(i.a)(t)&&!this.data.hasOwnProperty("editValue")&&(this.editVal.type=this.staticType,this.editVal[this.staticType]=t),"variable"===this.params.type&&this.params.hasOwnProperty("useOnlyName")&&!this.editVal.hasOwnProperty("useOnlyName")&&this.$set(this.editVal,"useOnlyName",this.params.useOnlyName),"variable"===this.params.type&&this.params.hasOwnProperty("useLastName")&&!this.editVal.hasOwnProperty("useLastName")&&(this.editVal.useLastName=this.params.useLastName),this.editValType="variable"===this.editVal.type?"variable":this.editVal.useExpression?"useExpression":"static",this.selectLabel=this.compoundItem.find((function(t){return t.value===e.editValType})),this.showVal=this.getShowVal()},setOptions:function(e){Array.isArray(e)&&(this.asyncOptions=e)},compatible:function(e){var t=this,a=[];return e.forEach((function(e){t.excludes.find((function(t){return t===e}))||a.push(e)})),a},clear:function(){var e=this;this.$confirm("确定要清空相关设置吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.showVal="",e.showValOut="",e.editVal={type:"variable",static:null,variable:[],useExpression:!1},e.editValStaticVar="",e.clearData(),e.$emit("change",""),e.close()})).catch((function(){}))},clearData:function(){this.$removeAttr(this.data,"value"),this.$removeAttr(this.data,"lastValue"),this.$removeAttr(this.data,"editValue"),this.$setAttr(this.editVal,"static",null),this.$setAttr(this.editVal,this.staticType,null)},getShowVal:function(){return"variable"!==this.editVal.type?this.editVal.hasOwnProperty(this.staticType)?this.editVal[this.staticType]:this.editVal.static:this.editVal.variable&&this.editVal.variable.length?!0===this.editVal.useLastName?this.editVal.variable[this.editVal.variable.length-1]:!0===this.editVal.useOnlyName?this.editVal.variable.join("."):"${"+this.editVal.variable.join(".")+"}":""},formatValueToLabel:function(e,t){if(null==e||!e.length)return t;var a,i,n=b(e);try{for(n.s();!(i=n.n()).done;){var r=i.value;if(r.value.id===t){a=r.label;break}if(r.children&&r.children.length){var o=this.formatValueToLabel(r.children,t);if(o){a=o;break}}}}catch(e){n.e(e)}finally{n.f()}return a},clickSure:function(e,t){"variable"===this.editVal.type?(this.editVal.static=null,this.$set(this.params,"useOnlyName",this.editVal.useOnlyName)):this.editVal.variable=[],this.showVal=this.getShowVal(),!1!==this.handleChangeResult(this.showVal,this.data)?(this.$setAttr(this.editVal,"static",this.showVal),this.$setAttr(this.data,"value",this.showVal),this.$setAttr(this.data,"lastValue",this.showVal),this.$setAttr(this.data,"editValue",Object(c.e)(this.editVal)),this.$emit("onSure",this.showVal,Object(c.e)(this.editVal),this.data),this.onValueChange(this.showVal,t)):this.$setAttr(this.data,"lastValue",this.data.lastValue)},validate:function(){var e=this.editVal.type;return"String"===e&&(e="static"),"variable"===this.editVal.type&&0===this.editVal.variable.length?"请选择变量":"static"!==e||this.editVal.static?!("static"===e&&this.editVal.static.length>s.a.PAYLOAD_NAME_MAX_LENGTH)||"字符的长度不能超过"+s.a.PAYLOAD_NAME_MAX_LENGTH:"请手动输入"},codeEditorOpen:function(){this.editVal.alias=this.data.alias||"";var e=this.editVal.type||"static";this.editVal.value=this.editVal[e]||this.editVal.value||{Array:[],Object:{}}[this.staticType]},codeEditorClose:function(){var e=this.editVal.type||this.staticType||"static";this.editVal[e]=this.editVal.value,this.clickSure()},codeEditorValidate:function(e){if(null===e||""===e)return!0;var t={Array:"数组",Object:"对象"};try{return e=JSON.parse(e),Object(c.g)(e)===this.staticType.toLocaleLowerCase()||(this.$message.warning("请输入".concat(t[this.staticType])),!1)}catch(e){return this.$message.warning("请输入".concat(t[this.staticType])),!1}}}},O=(a("37b7"),a("ec2f"),Object(p.a)(C,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"hc-attr-editor hc-attr-editor-variable variable-link-editor"},[t("div",{staticClass:"compoundInputBox"},[t("el-select",{staticClass:"selectLabel",attrs:{slot:"prepend",placeholder:"请选择",disabled:e.disabled},on:{change:e.changetype,focus:function(t){e.popoverVisible=!1}},slot:"prepend",model:{value:e.editValType,callback:function(t){e.editValType=t},expression:"editValType"}},e._l(e.compoundItem,(function(e,a){return t("el-option",{key:a,attrs:{label:e.label,value:e.value}})})),1),"variable-Panel"===e.selectLabel.formItem?t("el-popover",{ref:"variablePopper",attrs:{"popper-class":"variablePopper",width:"600",trigger:"click",placement:"bottom",disabled:e.disabled},model:{value:e.popoverVisible,callback:function(t){e.popoverVisible=t},expression:"popoverVisible"}},[t("variable-panel",{attrs:{args:e.args,editVal:e.editVal,target:e.target,variableType:e.params.variableType},on:{change:e.changeVariable},model:{value:e.editVal.variable,callback:function(t){e.$set(e.editVal,"variable",t)},expression:"editVal.variable"}}),e.editVal.hasOwnProperty("useOnlyName")?t("el-checkbox",{staticClass:"checkbox",on:{change:e.clickSure},model:{value:e.editVal.useOnlyName,callback:function(t){e.$set(e.editVal,"useOnlyName",t)},expression:"editVal.useOnlyName"}},[e._v("仅使用变量名称")]):e._e(),t("el-input",{staticClass:"selectLabelKey",attrs:{slot:"reference",placeholder:e.inputPlaceholder,readonly:"variable"===e.editValType},slot:"reference",model:{value:e.showVal,callback:function(t){e.showVal=t},expression:"showVal"}},[e.editValStaticVar&&0!==e.editValStaticVar.length?t("i",{staticClass:"el-input__icon el-icon-close",attrs:{slot:"suffix"},on:{click:function(t){return t.stopPropagation(),e.clearVariable.apply(null,arguments)}},slot:"suffix"}):e._e()])],1):"treeselect"===e.selectLabel.formItem?t("variable-tree-select-single",{ref:"variableTreeSelect",attrs:{disabled:e.disabled,"tree-data":e.options,placeholder:"请选择"},on:{change:e.clickSure},model:{value:e.editVal.static,callback:function(t){e.$set(e.editVal,"static",t)},expression:"editVal.static"}}):["multipleSelect","select"].includes(e.selectLabel.formItem)?t("el-select",{staticClass:"selectLabelKey",attrs:{placeholder:e.selectLabel.placeholder||"请选择",clearable:"",multiple:"multipleSelect"===e.selectLabel.formItem,disabled:e.disabled},on:{change:e.clickSure},model:{value:e.editVal.static,callback:function(t){e.$set(e.editVal,"static",t)},expression:"editVal.static"}},e._l(e.options,(function(e,a){return t("el-option",{key:a,attrs:{label:e.label,value:e.value}})})),1):"date-picker"===e.selectLabel.formItem?t("el-date-picker",{staticClass:"selectLabelKey",attrs:{"value-format":e.valueFormat,placeholder:e.selectLabel.placeholder||"请选择日期时间",type:"datetime",clearable:"",disabled:e.disabled},on:{change:e.clickSure},model:{value:e.editVal.static,callback:function(t){e.$set(e.editVal,"static",t)},expression:"editVal.static"}}):"switch"===e.selectLabel.formItem?t("span",[t("el-switch",{staticClass:"selectLabelKey",attrs:{size:"small","active-text":"是","inactive-text":"否"},on:{change:e.clickSure},model:{value:e.editVal.static,callback:function(t){e.$set(e.editVal,"static",t)},expression:"editVal.static"}})],1):t("span",[e.editVal.useExpression?[e.selectLabel.tips?t("el-tooltip",{attrs:{"open-delay":2e3,content:e.selectLabel.tips,placement:"top"}},[t("el-input",{staticClass:"selectLabelKey",attrs:{placeholder:e.selectLabel.placeholder||"请输入内容",disabled:e.disabled,clearable:""},on:{change:e.clickSure},model:{value:e.editVal[e.staticType],callback:function(t){e.$set(e.editVal,e.staticType,t)},expression:"editVal[staticType]"}})],1):t("el-input",{staticClass:"selectLabelKey",attrs:{placeholder:e.selectLabel.placeholder||"请输入内容",disabled:e.disabled,clearable:""},on:{change:e.clickSure},model:{value:e.editVal[e.staticType],callback:function(t){e.$set(e.editVal,e.staticType,t)},expression:"editVal[staticType]"}})]:["virtualSelect"===e.staticType?t("VirtualSelect",e._b({attrs:{options:e.mergeOptions,"data-key":e.optionProps.value,"extra-props":{optionProps:e.optionProps}},on:{change:e.clickSure},model:{value:e.editVal[e.staticType],callback:function(t){e.$set(e.editVal,e.staticType,t)},expression:"editVal[staticType]"}},"VirtualSelect",e.compProps,!1)):e._e(),"select"===e.staticType?t("el-select",e._b({staticClass:"selectLabelKey",attrs:{placeholder:"请选择",clearable:"",disabled:e.disabled},on:{change:e.clickSure},model:{value:e.editVal[e.staticType],callback:function(t){e.$set(e.editVal,e.staticType,t)},expression:"editVal[staticType]"}},"el-select",e.compProps,!1),e._l(e.mergeOptions,(function(a,i){return t("el-option",{key:i,attrs:{label:a[e.optionProps.label],value:a[e.optionProps.value]}})})),1):"date-picker"===e.staticType?t("el-date-picker",e._b({staticClass:"selectLabelKey",attrs:{"value-format":e.valueFormat,placeholder:"请选择日期时间",type:"datetime",clearable:"",disabled:e.disabled},on:{change:e.clickSure},model:{value:e.editVal[e.staticType],callback:function(t){e.$set(e.editVal,e.staticType,t)},expression:"editVal[staticType]"}},"el-date-picker",e.compProps,!1)):"switch"===e.staticType||"Boolean"===e.staticType?t("span",[t("el-switch",e._b({staticClass:"selectLabelKey",attrs:{size:"small","active-text":"是","inactive-text":"否"},on:{change:e.clickSure},model:{value:e.editVal[e.staticType],callback:function(t){e.$set(e.editVal,e.staticType,t)},expression:"editVal[staticType]"}},"el-switch",e.compProps,!1))],1):e.showCodeEdit?t("code-editor",{attrs:{data:e.editVal,appendToBody:!0,open:e.codeEditorOpen,customValidate:e.codeEditorValidate},on:{change:e.codeEditorClose}}):"Number"===e.staticType?t("el-input-number",e._b({staticClass:"selectLabelKey",attrs:{disabled:e.disabled,"controls-position":"right"},on:{change:e.clickSure},model:{value:e.editVal[e.staticType],callback:function(t){e.$set(e.editVal,e.staticType,t)},expression:"editVal[staticType]"}},"el-input-number",e.compProps,!1)):"String"===e.staticType||"static"===e.staticType?[e.selectLabel.tips?t("el-tooltip",{attrs:{"open-delay":2e3,content:e.selectLabel.tips,placement:"top"}},[t("el-input",e._b({staticClass:"selectLabelKey",attrs:{placeholder:e.selectLabel.placeholder||"请输入内容",disabled:e.disabled,clearable:""},on:{change:e.clickSure},model:{value:e.editVal[e.staticType],callback:function(t){e.$set(e.editVal,e.staticType,t)},expression:"editVal[staticType]"}},"el-input",e.compProps,!1))],1):t("el-input",e._b({staticClass:"selectLabelKey",attrs:{placeholder:e.selectLabel.placeholder||"请输入内容",disabled:e.disabled,clearable:""},on:{change:e.clickSure},model:{value:e.editVal[e.staticType],callback:function(t){e.$set(e.editVal,e.staticType,t)},expression:"editVal[staticType]"}},"el-input",e.compProps,!1))]:"cascader"===e.staticType?t("el-cascader",e._b({staticClass:"selectLabelKey",attrs:{options:e.mergeOptions,"show-all-levels":!1,props:e.optionProps,clearable:"",filterable:""},on:{change:e.clickSure},model:{value:e.editVal[e.staticType],callback:function(t){e.$set(e.editVal,e.staticType,t)},expression:"editVal[staticType]"}},"el-cascader",e.compProps,!1)):e._e()]],2)],1)])}),[],!1,null,"6d9e6c18",null));t.default=O.exports},cef0:function(e,t,a){},cfc7:function(e,t,a){"use strict";a("7bb4")},cff2:function(e,t,a){"use strict";a("2caf")},d2fc:function(e,t,a){},d374:function(e,t,a){"use strict";a.d(t,"b",(function(){return l})),a.d(t,"a",(function(){return s})),a.d(t,"c",(function(){return c})),a("8e6e"),a("ffc1");var i=a("bd86"),n=(a("456d"),a("7f7f"),a("9253"),a("ac6a"),a("c276"));function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){Object(i.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e){var t=this,a={};return Array.isArray(e)&&e.forEach((function(e){var i,n=t.propertyTypeMap[e.propertyType];a.hasOwnProperty(n)&&Array.isArray(a[n])||Reflect.set(a,n,[]),a[n].push({id:e.id,businessId:null!==(i=e.indicatorId)&&void 0!==i?i:e.id,name:e.name,updateTime:e.updateTime,value:e.value,identifier:e.identifier,indicatorId:e.indicatorId,propertyType:e.propertyType,indicatorIdentifier:e.indicatorIdentifier})})),a}function s(e){var t=[];return Object(n.tb)(e)&&Object.keys(e).forEach((function(a){Array.isArray(e[a])&&e[a].forEach((function(e){t.push(o(o({},e),{},{type:a}))}))})),t}function c(e){if(Object(n.tb)(e)){var t={};return Object.entries(e).forEach((function(e){void 0!==e[1]&&Reflect.set(t,"".concat(e[1]),e[0])})),t}return e}},d45e:function(e,t,a){"use strict";a("7f7f");var i=(a("8e6e"),a("456d"),a("28a5"),a("6762"),a("2fdb"),a("ac6a"),a("bd86")),n=a("c276"),r=a("4702"),o=a("2f62");function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){Object(i.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var c={name:"TemplateIndicatorTable",components:{MeasIndicatorDefine:r.a},props:{list:{type:Array,default:function(){return[]}},updateList:{type:Function,default:function(){}}},inject:["isProjectPage","isTemplatePage"],data:function(){return{desc:[],options:[],indicatorProps:{label:"name",children:"children"},rules:[],extraObjectTypes:[],rootNode:{id:"-1",label:"/",name:"/"},compoundItem:[{label:"变量选择",value:"variable",formItem:"variable-Panel"},{label:"手动输入",value:"static",formItem:"select"}],compoundItemTreeselect:[{label:"变量选择",value:"variable",formItem:"variable-Panel"},{label:"手动输入",value:"static",formItem:"treeselect"}],measIndicatorDefineVisible:!1,currentIndicator:{}}},watch:{list:{immediate:!0,handler:function(e){this.initDynamicMap()}}},computed:s(s({},Object(o.a)(["measureOptions","themeConstColor"])),{},{theadStyles:function(){return{"background-color":Object(n.nb)("middleBackgroundColor")}},fetchOption:function(){var e=this.extraObjectTypes.filter((function(e){return e.checked})).map((function(e){return e.name})).join(",");return{url:"/api/model/instances",params:{objectType:"HR_COMPANY,HR_DEPARTMENT,SYS_ASSET,SYS_EQUIPMENT".concat(e?",".concat(e):""),queryMode:"simple",pagination:0,lazyLoad:0,$orderBy:"createTime desc"}}}}),methods:{initDynamicMap:function(){var e=this;this.list.forEach((function(t){var a=e.changeIndicator(t.rowInfo);e.handleCollapse(null==t?void 0:t.id,!0),e.$set(t,"selected",a.map((function(e){return e.name}))),e.$set(t,"dynamicOptions",a)})),this.$nextTick((function(){e.list.forEach((function(t,a){t.dynamicOptions.forEach((function(t,i){e.$refs["variableEditor".concat(a).concat(i)]&&e.$refs["variableEditor".concat(a).concat(i)].length&&e.$refs["variableEditor".concat(a).concat(i)][0].setOptions(t.options)}))}))}))},changeIndicator:function(e){var t=this;return(this.isProjectPage||this.isTemplatePage?this.measureOptions.measureIndicatorDictOptions:this.measureOptions.measureIndicatorExpandsDicts).map((function(a){return{name:a.displayName,display:a.dictKeyName,options:a.options.map((function(e){return{label:e.name,value:e.value}})),type:"select",selected:!0,paramType:"dynamic",value:a.displayName,dataValue:{editValue:t.getEditValue(e[a.displayName]||"")}}}))},collapseStyle:function(e){return{target:".el-collapse-item__wrap",style:this.trStyle(e)}},trStyle:function(e){var t=e.id;return{backgroundColor:this.desc.includes(t)?this.themeConstColor.headerColor:"",transition:"all .3s"}},handleSelectedChange:function(e,t){var a=t.id;this.handleCollapse(null==t?void 0:t.id,!0),e.length?this.desc.includes(a)||this.desc.push(a):this.desc.includes(a)&&(this.desc=this.desc.filter((function(e){return e!==a})))},onMeasIndicatorDefineClose:function(e){this.measIndicatorDefineVisible=!1,e&&"function"==typeof this.updateList&&this.updateList()},handleIndicatorSetting:function(e){this.currentIndicator=e.rowInfo,this.measIndicatorDefineVisible=!0},handleIndicatorDel:function(e){var t=this;this.$confirm("确定要删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){1===t.list.length?t.list.splice(e,1,{id:t.$util.uuid(),rowInfo:{},isDynamic:!1,selected:[]}):t.list.splice(e,1),t.$emit("indicatorChange")})).catch((function(){}))},handleDynamicDel:function(){},changeVariable:function(e,t,a){this.list[a].rowInfo[t]=e},getEditValue:function(e){var t,a=/\$\{(.*?)\}/g.exec(e);return(null==a?void 0:a[0])===e?{static:"",type:"variable",variable:null===(t=a[1])||void 0===t?void 0:t.split(".")}:{static:e,type:"static",variable:[]}},indicatorChange:function(){this.$emit("indicatorChange")},handleIndicatorChange:function(e,t){this.list[t].rowInfo=e;var a=this.changeIndicator(null!=e?e:{});this.$set(this.list[t],"selected",a.map((function(e){return e.name}))),this.$set(this.list[t],"dynamicOptions",a),this.$emit("indicatorChange")},collapseIcon:function(e){return this.desc.includes(e)?"el-icon-arrow-up":"el-icon-arrow-down"},handleCollapse:function(e,t){if(this.desc.includes(e)){if(t)return;this.desc=this.desc.filter((function(t){return t!==e}))}else this.desc.push(e)}}},u=(a("27d0"),a("d867"),a("2877")),d=Object(u.a)(c,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"template-indicator-table-box"},[t("table",{staticClass:"template-indicator-table"},[t("thead",{staticClass:"table-thead",style:e.theadStyles},[e._m(0)]),t("tbody",{staticClass:"table-tbody"},[e._l(e.list,(function(a,i){return[t("tr",{key:i,staticClass:"table-tr",style:e.trStyle(a)},[t("td",[t("span",[e._v(e._s(a.name))])]),t("td",[t("el-switch",{model:{value:a.isDynamic,callback:function(t){e.$set(a,"isDynamic",t)},expression:"item.isDynamic"}})],1),t("td",[t("el-select",{staticStyle:{width:"100%"},attrs:{disabled:"",multiple:"",placeholder:"请选择"},on:{change:function(t){return e.handleSelectedChange(t,a)}},model:{value:a.selected,callback:function(t){e.$set(a,"selected",t)},expression:"item.selected"}},e._l(a.dynamicOptions,(function(e){return t("el-option",{key:e.name,attrs:{label:e.display,value:e.name}})})),1)],1)]),t("tr",{key:"".concat(a.id,"_desc"),style:e.trStyle(a)},[t("td",{attrs:{colspan:"4"}},[a.selected&&a.selected.length?t("el-form",{ref:"form",refInFor:!0,attrs:{"label-width":"120px",model:a.selected}},e._l(a.dynamicOptions,(function(n,r){return t("el-form-item",{key:n.name,attrs:{label:n.display}},[t("variable-editor-components",{ref:"variableEditor".concat(i).concat(r),refInFor:!0,staticClass:"filters-item-input",attrs:{compoundItem:"treeselect"===n.type?e.compoundItemTreeselect:e.compoundItem,options:n.options,title:"设置参数值",placeholder:"请设置参数值",data:n.dataValue,disabled:!a.isDynamic},on:{change:function(t){return e.changeVariable(t,n.name,i)}}})],1)})),1):t("div",{staticClass:"desc-collapse-empty t-text-secondary"},[e._v("暂无动态维度")])],1)])]}))],2)]),e.measIndicatorDefineVisible?t("meas-indicator-define",{attrs:{defaultIndicator:e.currentIndicator,updateStore:""},on:{close:e.onMeasIndicatorDefineClose}}):e._e()],1)}),[function(){var e=this,t=e._self._c;return t("tr",[t("th",{attrs:{width:"25%"}},[e._v("指标")]),t("th",{attrs:{width:"15%"}},[e._v("动态指标")]),t("th",[e._v("动态维度")])])}],!1,null,"d6e7549a",null);t.a=d.exports},d45f:function(e,t,a){"use strict";a.r(t),a("7f7f");var i=(a("8e6e"),a("456d"),a("7618")),n=(a("a481"),a("ac6a"),a("bd86")),r=(a("9253"),a("20d6"),a("386d"),a("75fc")),o=a("2f62"),l=a("b19c");function s(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function c(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?s(Object(a),!0).forEach((function(t){Object(n.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):s(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var u={name:"FileManage",props:{mode:{type:String,default:"full"},type:{type:String,default:""},multiple:{type:Boolean,default:!1},editorVal:{type:[Object,Array],default:function(){}}},computed:c(c({},Object(o.a)(["portalInfo"])),{},{projectIdentifier:function(){return Object(l.h)(window.location.href,"projectIdentifier")},treeFetchOption:function(){return{url:"/api/file/files",payload:{filters:[{k:"type",o:"=",v:1}].concat(Object(r.a)(this.projectIdentifier?[{k:"realPath",o:"likeright",v:"/".concat(this.projectIdentifier,"/")}]:[]))},params:{pagination:0}}}}),data:function(){return{showTree:!1,tree:{isDone:!1,highlightCurrent:!0,currentNode:{id:"0",name:"/"},loading:!1,searchName:"",treeProps:{label:"name",isLeaf:function(e){return 2===e.type},handler:{edit:{label:"修改",event:this.handleEdit},del:{label:"删除",event:this.handleDel}}},fetchOption:{url:"/api/file/files",payload:{filters:[{k:"type",o:"=",v:1}]},params:{pagination:0}},rootNode:{id:"0",label:"/",name:"/"},disabled:!1},selectorTree:{treeProps:{label:"name",isLeaf:function(e){return 2===e.type}},fetchOption:{url:"/api/file/files",payload:{filters:[{k:"type",o:"=",v:1}]},params:{pagination:0}},rootNode:{id:"0",label:"/",name:"/"}},filter:{mdSpan:8,lgSpan:8,filters:[{k:"type",o:"=",v:2,keep:!0},{k:"parentId",o:"=",v:"0",keep:!0},{k:"classification",o:"=",v:this.type,keep:!0}],filterColumn:[{prop:"name",label:"文件名称",type:"input",operator:"like",mdSpan:16,lgSpan:16},{prop:"type",hidden:!0,operator:"=",keep:!0},{prop:"parentId",hidden:!0,operator:"=",keep:!0},{prop:"classification",hidden:!0,operator:"=",keep:!0}]},grid:{showToolbarRight:!1,highlightCurrentRow:!0,height:"300px",fetchOption:{url:"/api/file/files",params:{pagination:1}}},operations:{delbtnDisabled:!0},form:{width:"600px",modalAppendToBody:!0,loading:!1,visible:!1,currentId:"",data:{id:"",name:"",path:"",description:"",parentId:"0",pageType:2},rules:{name:[{required:!0,message:"请输入页面名称",trigger:"blur"},{max:50,message:"长度在 1 到 50 个字符",trigger:"blur"}],parentId:[{required:!0,message:"请选择所属分组",trigger:"blur"}],path:[{required:!0,message:"请输入页面路径",trigger:"blur"}],description:[{message:"超过允许的最大长度500",maxlength:500,trigger:"blur"}]}},formGroup:{width:"600px",modalAppendToBody:!0,loading:!1,visible:!1,data:{id:"",name:"",path:"",description:"",parentId:"0",pageType:1},rules:{name:[{required:!0,message:"请输入分组名称",trigger:"blur"}],parentId:[{required:!0,message:"请选择所属分组",trigger:"blur"}]}}}},created:function(){var e=this;this.initFormData(),this.projectIdentifier?this.$util.request({url:"/api/file/files",method:"get",params:{orgPermission:0,withChildNodes:2,$filter:"type eq 1,realPath eq /".concat(this.projectIdentifier)}}).then((function(t){if(1===t.length){var a=t[0];e.tree.currentNode={id:null==a?void 0:a.id,name:null==a?void 0:a.name},e.tree.rootNode={id:null==a?void 0:a.id,label:null==a?void 0:a.name,name:null==a?void 0:a.name},e.setTableFilters("parentId",null==a?void 0:a.id),e.showTree=!0}})):this.showTree=!0},watch:{searchName:function(e){e||(this.searchState=!1)},mode:{handler:function(e){this.setData(e)},immediate:!0}},methods:{setData:function(e){var t={edit:{label:"修改",event:this.handleEdit},del:{label:"删除",event:this.handleDel}};"full"===e?this.$setAttr(this.tree.treeProps,"handler",c({},t)):this.$setAttr(this.tree.treeProps,"handler",null)},initFormData:function(){var e=this.form.data;e.id="",e.name="",e.path="",e.description="",e.parentId=this.tree.currentNode.id},setTreeCurrentKey:function(e){},handleTreeSearch:function(){this.$refs.tree&&this.tree.isDone&&this.$refs.tree.filter(this.tree.searchName)},handleTreeAdd:function(){this.formGroup.visible=!0},handleTreeDone:function(){this.tree.isDone=!0,this.setTreeCurrentKey(this.tree.currentNode.id)},handleGridDone:function(e){var t=this;e.forEach((function(e){return e.path=e.relativePath}));var a=e.filter((function(e){return e.id===t.form.currentId}));a&&a.length&&this.setCurrentRowTable(a[0])},handleSelectorTreeFocus:function(){},handleSelectorTreeDone:function(){},handleCurrentRowChange:function(e){this.$emit("current-change",e)},handleCurrentChange:function(e){this.tree.currentNode.id=e.id,this.tree.currentNode.name=e.name,this.form.data.parentId=e.id,this.formGroup.data.parentId=e.id,this.setTableFilters("parentId",e.id),this.refreshGrid()},handleCheckedChange:function(e,t){},refreshGrid:function(){this.$refs.grid.search()},setCurrentRowTable:function(e){this.$refs.table.setCurrentRow(e)},setTableFilters:function(e,t){var a=this.filter.filters,i=a.findIndex((function(e){return"parentId"===e.k}));-1===i?a.push({k:e,o:"=",v:t}):a[i].v=t},pageCreateHandle:function(e,t){},pageDeleteHandle:function(e,t,a){},handleAdd:function(){this.initFormData(),this.form.visible=!0},handleEdit:function(e){if("0"!==e.id){var t=1===e.pageType?this.formGroup:this.form,a=t.data;a.id=e.id,a.name=e.name,a.path=e.path,a.description=e.description||"",a.pageType=e.pageType,a.permissionId=e.permissionId,a.orgId=e.orgId,a.parentId=e.parentId,t.visible=!0}else this.$message.warning("根节点不允许修改！")},handleDel:function(e){var t=this;"0"!==e.id?this.$confirm("你确定要删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var a=e.pageType,i=[e.id];t.pageDeleteHandle(i,(function(i){1!==a?t.refreshGrid():t.removeNode(e)}))})):this.$message.warning("根节点不允许删除！")},handleFilterSearch:function(){this.refreshGrid()},handleFormDialogClose:function(){},handleFormLoading:function(e){Reflect.set(this,"loading",{beforeLoginPage:e,afterLoginPage:e,theme:e,menu:e})},handleFormSubmit:function(e){var t=this;e.data.path=e.data.name,this.pageCreateHandle(e,(function(a){var i=e.data.pageType,n=a.data.id;if(t.form.currentId=n,1===i){return t.appendNode(c(c({},e.data),{},{id:n,isLeaf:!0})),void(e.visible=!1)}e.visible=!1,t.refreshGrid()}))},appendNode:function(e){var t=this.$refs.tree.getTreeContext();t&&t.append(e,e.parentId)},removeNode:function(e){var t=this.$refs.tree.getTreeContext();t&&t.remove(e);var a=e.id;a&&[this.form,this.formGroup].forEach((function(e){e.data.parentId===a&&(e.data.parentId="0")}))},resetTree:function(){this.tree.searchName="",this.handleTreeSearch(this.tree.searchName)},resetFilter:function(){this.$refs.filter&&this.$refs.filter.handleFilterReset()},reset:function(){this.resetTree(),this.resetFilter(),this.refreshGrid()}}},d=(a("b9f2"),a("df8e"),a("2877"));function p(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function h(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?p(Object(a),!0).forEach((function(t){Object(n.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):p(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var f={name:"FileEditor",components:{FileManage:Object(d.a)(u,(function(){var e=this,t=e._self._c;return t("el-row",{staticClass:"hc-image-manage"},[t("el-col",{staticClass:"hc-group-tree",style:{height:"full"===e.mode?"457px":"425px"},attrs:{span:6}},[t("basic-container",{staticStyle:{"padding-top":"0","padding-bottom":"0"},attrs:{loading:e.tree.loading}},[t("div",{staticClass:"hc-group-tree-header"},[t("el-row",{attrs:{gutter:5}},[t("el-col",{attrs:{span:"full"===e.mode?16:24}},[t("el-input",{attrs:{placeholder:"输入分组名称",clearable:!0},on:{clear:e.handleTreeSearch},model:{value:e.tree.searchName,callback:function(t){e.$set(e.tree,"searchName",t)},expression:"tree.searchName"}},[t("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.handleTreeSearch},slot:"append"})],1)],1),"full"===e.mode?t("el-col",{staticStyle:{"text-align":"right"},attrs:{span:8}},[t("el-button",{attrs:{type:"success",icon:"el-icon-plus"},on:{click:e.handleTreeAdd}},[e._v("新增分组")])],1):e._e()],1)],1),t("div",{staticClass:"hc-group-tree-content"},[e.showTree?t("selector-async",{ref:"tree",attrs:{fetchOption:e.tree.fetchOption,props:e.tree.treeProps,nodeKey:e.tree.nodeKey,rootNode:e.tree.rootNode,highlightCurrent:e.tree.highlightCurrent,expandOnClickNode:e.tree.expandOnClickNode},on:{"current-change":e.handleCurrentChange,done:e.handleTreeDone}}):e._e()],1)])],1),t("el-col",{staticClass:"hc-main-content",attrs:{span:18}},[t("basic-container",{staticStyle:{"padding-top":"0","padding-bottom":"0"}},[t("basic-filter",{ref:"filter",attrs:{mdSpan:e.filter.mdSpan,lgSpan:e.filter.lgSpan,columns:e.filter.filterColumn},on:{search:e.handleFilterSearch},model:{value:e.filter.filters,callback:function(t){e.$set(e.filter,"filters",t)},expression:"filter.filters"}}),e.showTree?t("basic-grid",{ref:"grid",attrs:{filters:e.filter.filters,fetchOption:e.grid.fetchOption,height:e.grid.height,showToolbarRight:e.grid.showToolbarRight,highlightCurrentRow:e.grid.highlightCurrentRow,multiple:e.multiple,"editor-val":e.editorVal,displayKey:"relativePath"},on:{"current-change":e.handleCurrentRowChange,done:e.handleGridDone}},["full"===e.mode?t("template",{slot:"handler"},[t("el-button",{attrs:{type:"success",icon:"el-icon-plus"},on:{click:e.handleAdd}},[e._v("\n            新增文件\n          ")])],1):e._e()],2):e._e(),"full"===e.mode?t("basic-form",{attrs:{width:e.form.width,modalAppendToBody:e.form.modalAppendToBody,loading:e.form.loading,formData:e.form.data,rules:e.form.rules,title:"页面"},on:{submit:function(t){return e.handleFormSubmit(e.form)},close:e.handleFormDialogClose},model:{value:e.form.visible,callback:function(t){e.$set(e.form,"visible",t)},expression:"form.visible"}},[t("el-form-item",{attrs:{label:"页面名称",prop:"name"}},[t("el-input",{attrs:{placeholder:"请输入页面名称"},model:{value:e.form.data.name,callback:function(t){e.$set(e.form.data,"name",t)},expression:"form.data.name"}})],1),t("el-form-item",{attrs:{label:"所属分组",prop:"parentId"}},[t("selector-tree",{ref:"pageGroup",attrs:{fetchOption:e.selectorTree.fetchOption,"root-node":e.selectorTree.rootNode,props:e.selectorTree.treeProps,placeholder:"请选择所属分组"},on:{focus:function(){return e.handleSelectorTreeFocus("afterLoginPage")},done:e.handleSelectorTreeDone},model:{value:e.form.data.parentId,callback:function(t){e.$set(e.form.data,"parentId",t)},expression:"form.data.parentId"}})],1),t("el-form-item",{attrs:{label:"页面描述",prop:"description"}},[t("el-input",{attrs:{type:"textarea",rows:5,placeholder:"请输入页面描述"},model:{value:e.form.data.description,callback:function(t){e.$set(e.form.data,"description",t)},expression:"form.data.description"}})],1)],1):e._e(),"full"===e.mode?t("basic-form",{attrs:{width:e.formGroup.width,modalAppendToBody:e.formGroup.modalAppendToBody,loading:e.formGroup.loading,formData:e.formGroup.data,rules:e.formGroup.rules,title:"分组"},on:{submit:function(t){return e.handleFormSubmit(e.formGroup)},close:e.handleFormDialogClose},model:{value:e.formGroup.visible,callback:function(t){e.$set(e.formGroup,"visible",t)},expression:"formGroup.visible"}},[t("el-form-item",{attrs:{label:"分组名称",prop:"name"}},[t("el-input",{attrs:{placeholder:"分组名称"},model:{value:e.formGroup.data.name,callback:function(t){e.$set(e.formGroup.data,"name",t)},expression:"formGroup.data.name"}})],1),t("el-form-item",{attrs:{label:"所属分组",prop:"parentId"}},[t("selector-tree",{ref:"pageGroup",attrs:{fetchOption:e.selectorTree.fetchOption,"root-node":e.selectorTree.rootNode,props:e.selectorTree.treeProps,placeholder:"请选择所属分组"},on:{focus:function(){return e.handleSelectorTreeFocus("afterLoginPage")},done:e.handleSelectorTreeDone},model:{value:e.formGroup.data.parentId,callback:function(t){e.$set(e.formGroup.data,"parentId",t)},expression:"formGroup.data.parentId"}})],1)],1):e._e()],1)],1)],1)}),[],!1,null,"ba83839c",null).exports},props:{iconClass:{type:String,default:function(){return"el-icon-edit"}},parent:{type:Object,default:function(){return{}}},settings:{type:Object,default:function(){return{title:"",width:"70%",className:"page-editor-dialog",showInput:!0}}},data:{type:Object,default:function(){return{}}},params:{type:Object,default:function(){return{type:"",multiple:!1}}},placeholder:{type:String,default:""},handleRulesResult:{type:Function,default:function(){}},handleChangeResult:{type:Function,default:function(){}}},data:function(){return{editorOrgVal:{source:1,id:"",name:"",path:"",parentId:"0",webUrl:""},editorVal:{source:1,id:"",name:"",path:"",parentId:"0",webUrl:""},editorCacheVal:{},dialogVisible:!1,source:1,names:""}},computed:{inputValue:function(){var e,t,a,i,n;return 1===(null===(e=this.data)||void 0===e||null===(t=e.editValue)||void 0===t?void 0:t.source)?(null===(a=this.data)||void 0===a||null===(i=a.editValue)||void 0===i?void 0:i.name)||"":(null===(n=this.data)||void 0===n?void 0:n.value)||""}},watch:{"data.value":function(){this.initData()},dialogVisible:function(e){e&&this.initData()}},methods:{initData:function(){this.names="",this.editorCacheVal={};var e=this.data.editorSettings;if(e&&3===e.type)this.resetData();else{var t=this.data.editValue||this.data.editorSettings;this.params.multiple?this.isEmpty(t)?(this.editorVal=[],this.editorOrgVal=[],this.source=1):(this.editorVal=t,this.source=this.editorVal[0].source,this.editorOrgVal=[],this.names=this.getShowVal()):this.isEmpty(t)?(this.source=1,this.resetData()):(this.editorVal=h(h({},this.editorVal),t),this.source=this.editorVal.source,this.names=this.editorVal.name)}},handleIconClick:function(){this.open()},handleChange:function(e){if(this.params.multiple)this.$setAttr(this,"editorVal",e),this.names=this.getShowVal();else{if(!e||!e.name||!e.id)return void this.$setAttr(this,"editorVal",h({},this.editorOrgVal));this.names=e.name,this.$setAttr(this,"editorVal",h(h({},this.editorVal),e))}},open:function(){this.dialogVisible=!0},close:function(){this.dialogVisible=!1},cancel:function(){this.close()},clear:function(){var e=this;this.$confirm("确定要清除配置吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.resetData(),e.dialogVisible=!1})).catch((function(){})).finally((function(){e.$emit("onClear")}))},resetData:function(){this.editorVal=this.editorOrgVal,this.editorVal.webUrl="",this.$removeAttr(this.data,"value"),this.$removeAttr(this.data,"editValue"),this.$removeAttr(this.data,"editorSettings")},getShowVal:function(){var e=this;if(this.params.multiple){if(1===this.source){var t="";return this.editorVal.forEach((function(a,i){a.source=1,i===e.editorVal.length-1?t+=a.name:t+=a.name+"、"})),t}if(2===this.source){var a="";return this.editorVal.forEach((function(t,i){t.source=2,t.name=t.webUrl.replace(/(.*\/)*([^.]+).*/gi,"$2"),i===e.editorVal.length-1?a+=t.name:a+=t.name+"、"})),a}}else{if(1===this.source)return this.editorVal.source=1,this.editorVal.path;if(2===this.source)return this.editorVal.source=2,this.editorVal.webUrl}return""},clickSure:function(){var e=this.params.multiple?this.editorVal[this.editorVal.length-1].webUrl:this.editorVal.webUrl;if(2!==this.source||this.isVideoWebUrl(e)){var t=this.getShowVal();!1!==this.handleChangeResult(t,this.data)?(this.$setAttr(this.data,"value",t),this.params.multiple?this.$setAttr(this.data,"lastValue",this.editorVal):this.$setAttr(this.data,"lastValue",t),this.$setAttr(this.data,"editValue",this.editorVal),this.$emit("onSure",this.editorVal),this.dialogVisible=!1):this.$setAttr(this.data,"lastValue",this.data.lastValue)}else this.$message({message:"请先填写正确的网络路径",type:"warning"})},handleAddWebUrl:function(){this.isVideoWebUrl(this.editorVal[this.editorVal.length-1].webUrl)?this.editorVal.push({webUrl:""}):this.$message({message:"请先填写正确的网络路径",type:"warning"})},handleReduceWebUrl:function(e){this.$delete(this.editorVal,e)},handleRadioChange:function(e){if(this.source=e,this.isEmpty(this.editorCacheVal))this.editorCacheVal=this.editorVal,this.params.multiple?1===e?this.$setAttr(this,"editorVal",this.editorOrgVal):2===e&&this.$setAttr(this,"editorVal",[{webUrl:""}]):this.$setAttr(this,"editorVal",this.editorOrgVal);else{var t=this.editorVal;this.$setAttr(this,"editorVal",this.editorCacheVal),this.editorCacheVal=t}this.names=this.getShowVal()},isEmpty:function(e){switch(Object(i.a)(e)){case"undefined":return!0;case"string":if(0===e.replace(/(^[ \t\n\r]*)|([ \t\n\r]*$)/g,"").length)return!0;break;case"object":if(null===e||0===e.length)return!0;for(var t in e)return!1;return!0}return!1},isVideoWebUrl:function(e){return!!/http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w-.\/?%&=]*)?/.test(e)}}},m=(a("e086"),Object(d.a)(f,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"image-editor"},[t("el-input",{staticClass:"editor-input",attrs:{placeholder:e.placeholder,value:e.inputValue,readonly:"",size:"mini",clearable:""},nativeOn:{click:function(t){return e.handleIconClick.apply(null,arguments)}}},[t("i",{staticClass:"el-input__icon image-editor-icon",class:e.iconClass,attrs:{slot:"suffix"},slot:"suffix"})]),t("el-dialog",{staticClass:"page-editor-dialog",attrs:{draggable:!0,visible:e.dialogVisible,"close-on-click-modal":!1,title:e.params.title||e.settings.title||"设置"+(e.data.alias||e.data.name),width:"70%","append-to-body":!0,top:"4vh"},on:{close:e.close}},[t("div",{staticClass:"pic-source"},[t("span",[e._v("来源：")]),t("el-radio-group",{on:{change:e.handleRadioChange},model:{value:e.source,callback:function(t){e.source=t},expression:"source"}},[t("el-radio",{attrs:{label:1}},[e._v("本地路径")]),t("el-radio",{attrs:{label:2}},[e._v("网络路径")])],1)],1),e.dialogVisible?t("file-manage",{directives:[{name:"show",rawName:"v-show",value:1===e.source,expression:"source === 1"}],ref:"fileMange",attrs:{type:e.params.type,multiple:e.params.multiple,mode:"open","editor-val":e.editorVal},on:{"current-change":e.handleChange}}):e._e(),t("div",{directives:[{name:"show",rawName:"v-show",value:2===e.source,expression:"source === 2"}],staticClass:"file-source-web"},[e.params.multiple?e._l(e.editorVal,(function(a,i){return t("div",{key:i,staticClass:"list"},[t("el-input",{attrs:{placeholder:"请输入网络路径"},model:{value:e.editorVal[i].webUrl,callback:function(t){e.$set(e.editorVal[i],"webUrl",t)},expression:"editorVal[index].webUrl"}}),t("el-button",0===i?{staticClass:"btn",attrs:{type:"success",icon:"el-icon-plus",circle:""},on:{click:function(t){return e.handleAddWebUrl()}}}:{staticClass:"btn",attrs:{type:"danger",icon:"el-icon-minus",circle:""},on:{click:function(t){return e.handleReduceWebUrl(i)}}})],1)})):[e.dialogVisible?t("el-input",{attrs:{placeholder:"请输入网络路径"},model:{value:e.editorVal.webUrl,callback:function(t){e.$set(e.editorVal,"webUrl",t)},expression:"editorVal.webUrl"}}):e._e()]],2),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-row",[t("el-col",{staticClass:"dialog-footer-tips",attrs:{span:16}},[1===e.source?[e.isEmpty(e.names)?[e._v("\n              请选择文件\n            ")]:[e._v("\n              当前已选文件："+e._s(e.names)+"\n            ")]]:2!==e.editorVal.source||e.params.multiple?e._e():[e.editorVal.webUrl?e._e():[e._v("\n              请输入文件路径\n            ")]]],2),t("el-col",{staticClass:"dialog-footer-buttons",attrs:{span:8}},[t("el-button",{attrs:{type:"danger"},on:{click:e.clear}},[e._v("清 除")]),t("el-button",{on:{click:e.cancel}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.clickSure}},[e._v("确 定")])],1)],1)],1)],1)],1)}),[],!1,null,null,null));t.default=m.exports},d4a8:function(e,t,a){},d587:function(e,t,a){"use strict";a("0f95")},d647:function(e,t,a){},d663:function(e,t,a){"use strict";a("a0a3")},d667:function(e,t,a){"use strict";a("10b2")},d66b:function(e,t,a){},d787:function(e,t,a){"use strict";a("f75b")},d7ab:function(e,t,a){},d867:function(e,t,a){"use strict";a("05b5")},d8b4:function(e,t,a){},d8eb:function(e,t,a){},d8fe:function(e,t,a){"use strict";a("6762"),a("2fdb"),a("28a5");var i=(a("8e6e"),a("5df3"),a("4f7f"),a("75fc")),n=(a("ac6a"),a("456d"),a("7f7f"),a("7514"),a("4917"),a("a481"),a("96cf"),a("3b8d")),r=a("bd86"),o=a("967e"),l=a.n(o),s=a("b19c"),c=(a("55dd"),function(){var e=this,t=e._self._c;return t("div",[t("table",{directives:[{name:"theme",rawName:"v-theme",value:e.themeStyles,expression:"themeStyles"}],staticClass:"hc-editor-payload-table"},[t("thead",{staticClass:"hc-editor-payload-table-thead",style:e.theadStyles},[t("tr",[t("th",{attrs:{width:"80px",align:"left"}},[e._v("类型")]),t("th",{attrs:{width:"120px",align:"left"}},[e._v("参数名")]),t("th",{attrs:{width:"120px",align:"left"}},[e._v("参数值")]),t("th",{attrs:{width:"120px",align:"left"}},[e._v("\n          使用表达式\n          "),t("basic-tips",{attrs:{type:"popover",title:"配置说明",width:600,placement:"bottom-start",iconStyle:{color:"#C9D0D4"},content:""}},[t("ul",[t("li",[e._v("仅支持标准表达式字符输入")]),t("li",[e._v("不支持使用变量，URL参数不支持对象结构数据")])])])],1),t("th",[e._v("测试值")])])]),t("tbody",{staticClass:"hc-editor-payload-table-tbody"},[e._l(e.payload,(function(a,i){return t("tr",{key:i},[t("td",[e._v("BODY")]),t("td",[e._v(e._s(a.name))]),t("td",[e._v(e._s(a.value))]),t("td",[e.isVariables(a.value)?[e._l(e.payloads,(function(i,n){return[i.name===a.value?t("el-switch",{key:n,model:{value:i.useExpression,callback:function(t){e.$set(i,"useExpression",t)},expression:"p.useExpression"}}):e._e()]}))]:[e._v("-")]],2),t("td",[e.isVariables(a.value)?[e._l(e.payloads,(function(i,n){return[i.name===a.value?t("el-input",{key:n,attrs:{size:"mini",placeholder:"请输入测试值",disabled:a.isConst},model:{value:i.value,callback:function(t){e.$set(i,"value",t)},expression:"p.value"}}):e._e()]}))]:t("el-input",{attrs:{size:"mini",placeholder:"请输入测试值",disabled:!0},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"param.value"}})],2)])})),e._l(e.paramsArr,(function(a,i){return t("tr",{key:i},[t("td",[e._v("URL")]),t("td",[e._v(e._s(a.name))]),t("td",[e._v(e._s(a.value))]),t("td",[e.isVariables(a.value)?[e._l(e.payloads,(function(i,n){return[i.name===a.value?t("el-switch",{key:n,model:{value:i.useExpression,callback:function(t){e.$set(i,"useExpression",t)},expression:"p.useExpression"}}):e._e()]}))]:[e._v("-")]],2),t("td",[e.isVariables(a.value)?[e._l(e.payloads,(function(i,n){return[i.name===a.value?t("el-input",{key:n,attrs:{size:"mini",placeholder:"请输入测试值"},model:{value:i.value,callback:function(t){e.$set(i,"value",t)},expression:"p.value"}}):e._e()]}))]:t("el-input",{attrs:{value:a.value,size:"mini",placeholder:"请输入测试值",disabled:!0}})],2)])})),e._l(e.filterArr,(function(a,i){return t("tr",{key:i},[t("td",[e._v("筛选项")]),t("td",[e._v(e._s(a.name))]),t("td",[e._v(e._s(a.value))]),t("td",[e.isVariables(a.value)?[e._l(e.payloads,(function(i,n){return[i.name===a.value?t("el-switch",{key:n,model:{value:i.useExpression,callback:function(t){e.$set(i,"useExpression",t)},expression:"p.useExpression"}}):e._e()]}))]:[e._v("-")]],2),t("td",[e.isVariables(a.value)?[e._l(e.payloads,(function(i,n){return[i.name===a.value?t("el-input",{key:n,attrs:{size:"mini",placeholder:"请输入测试值"},model:{value:i.value,callback:function(t){e.$set(i,"value",t)},expression:"p.value"}}):e._e()]}))]:t("el-input",{attrs:{value:a.value,size:"mini",placeholder:"请输入测试值",disabled:!0}})],2)])})),e._l(e.orderByArr,(function(a,i){return t("tr",{key:i},[t("td",[e._v("排序")]),t("td",[e._v(e._s(a.attr))]),t("td",[e._v(e._s(a.sort))]),t("td",[e._v("-")]),t("td",[t("el-input",{attrs:{value:a.value,size:"mini",placeholder:"请输入测试值",disabled:!e.isVariables(a.sort)}})],1)])})),e._l(e.pagination,(function(a,i){return["pageSize"!==i&&"page"!==i||!e.isPagination?e._e():t("tr",{key:i},[t("td",[e._v("分页")]),t("td",[e._v(e._s(i))]),t("td",[e._v(e._s(a))]),t("td",[e.isVariables(a)?[e._l(e.payloads,(function(i,n){return[i.name===a?t("el-switch",{key:n,model:{value:i.useExpression,callback:function(t){e.$set(i,"useExpression",t)},expression:"p.useExpression"}}):e._e()]}))]:[e._v("-")]],2),t("td",[e.isVariables(a)?[e._l(e.payloads,(function(i,n){return[i.name===a?t("el-input",{key:n,attrs:{size:"mini",placeholder:"请输入测试值"},model:{value:i.value,callback:function(t){e.$set(i,"value",t)},expression:"p.value"}}):e._e()]}))]:t("el-input",{attrs:{value:a,size:"mini",placeholder:"请输入测试值",disabled:!0}})],2)])]}))],2)])])}),u=a("c276"),d={name:"ApiTestParams",model:{prop:"value",event:"change"},props:{value:{type:Array,default:function(){return[{name:"",value:"",useExpression:!1}]}},payload:{type:Object,default:function(){return[]}},paramsArr:{type:Object,default:function(){return[]}},filterArr:{type:Object,default:function(){return[]}},orderByArr:{type:Object,default:function(){return[]}},isPagination:{type:Boolean,default:!1},pagination:{type:Object,default:function(){}}},data:function(){return{payloads:[]}},watch:{value:{deep:!0,immediate:!0,handler:function(e){this.payloads=e}},payloads:{deep:!0,handler:function(e){this.$emit("change",e)}}},computed:{themeStyles:function(){return{target:"th,td",style:{"border-width":Object(u.nb)("borderWidth"),"border-style":Object(u.nb)("borderStyle"),"border-color":Object(u.nb)("borderColor"),padding:"0 5px"}}},theadStyles:function(){return{"background-color":Object(u.nb)("middleBackgroundColor")}}},methods:{isVariables:function(e){return/\$\{(.+?)\}/g.test(e)}}},p=(a("aef0"),a("2877")),h=Object(p.a)(d,c,[],!1,null,null,null).exports,f=a("2f62");function m(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function v(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?m(Object(a),!0).forEach((function(t){Object(r.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):m(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var b={name:"ApiTestPanel",components:{ApiTestParams:h},props:{originConfig:{type:Object,default:function(){}},payload:{type:Object,default:function(){return[]}},paramsArr:{type:Object,default:function(){return[]}},filterArr:{type:Object,default:function(){return[]}},orderByArr:{type:Object,default:function(){return[]}},pagination:{type:Object,default:function(){}},isPagination:{type:Boolean,default:!1},cancelText:{type:String,default:"返回配置"},dataType:{type:String,default:"Complex[*]"},apiTestDataType:{type:String,default:"Complex[*]"},fields:{type:String,default:""},beforeTest:{type:Function,default:function(){return!0}}},computed:v(v({},Object(f.a)(["themeConstColor"])),{},{themeColor:function(){return this.themeConstColor.primary},customParamsTotal:function(){var e=this.customPayloads.length+this.customParamsArr.length+this.customFilterArr.length+this.customOrderByArr.length;return(this.pagination.page||this.pagination.pageSize)&&(e+=2),e}}),created:function(){this.initCustomParams()},data:function(){return{customParams:[],customOrderByArr:[],customFilterArr:[],customParamsArr:[],customPayloads:[],testResult:[{name:"a",valid:"2"}],testResultObject:"",totalCols:["name","valid"],selectedCols:[],requestState:0,errMsg:"",activeTab:"1",resultBoxHeight:"auto",responseType:1}},methods:{setResultBoxHeight:function(){var e=this;this.$nextTick((function(){var t=e.$refs.panelContent;if(t){var a=t.querySelector(".api-test-panel-content-box>.el-tabs>.el-tabs__content"),i=t.getElementsByClassName("api-test-panel-content-fields-content")[0];e.resultBoxHeight=t.clientHeight+t.offsetTop-a.offsetTop-i.offsetTop-48}}))},test:function(){var e=this;return Object(n.a)(l.a.mark((function t(){var a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("function"!=typeof e.beforeTest){t.next=4;break}if(!1!==e.beforeTest(e.originConfig,e.customParams)){t.next=4;break}return t.abrupt("return");case 4:if(e.validateUrl()){t.next=7;break}return e.$message.warning("请填写请求地址中的变量值"),t.abrupt("return");case 7:return e.activeTab="2",e.resetSelectedCols(),"object"===(a=e.replaceCustomParams()).accessType&&0===a.pagination&&(a.url=a.url.replace("pagination=0","pagination=1&$page=1&$pageSize=10")),t.next=13,e.doTest(a);case 13:e.setResultBoxHeight();case 14:case"end":return t.stop()}}),t)})))()},validateUrl:function(){var e=this,t=this.originConfig.url.split("?")[0].match(/\$\{(.*?)\}/g);return!t||t.every((function(t){var a=e.customParams.find((function(e){return e.name===t}));return!a||a.value}))},doTest:function(e){var t=this;return Object(n.a)(l.a.mark((function a(){var i,n,r;return l.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return i=t.apiTestDataType,n={content:v(v({},e),{},{fields:"",dataType:i}),params:{}},r={url:"/api/compdata/apis/debug",method:"post",data:n},a.abrupt("return",t.$util.request(r).then((function(e){var a,i=e.error||(null===(a=e.data)||void 0===a?void 0:a.error);if(i)return t.errMsg=(null==i?void 0:i.message)+"  "+(null==i?void 0:i.moreInfo),void(t.requestState=2);if(t.responseType=e.data.length?1:2,1===t.responseType){var n=t.parseData(e.data,t.originConfig.pagination),r=n.result,o=n.cols;t.testResult=r,t.totalCols=o}else t.testResult=e.data,t.totalCols=Object.keys(e.data||{}),t.testResultObject=Object(s.b)(e.data||{});t.totalColsChange(),t.requestState=1})).catch((function(e){t.requestState=2})));case 4:case"end":return a.stop()}}),a)})))()},formatJsonEdit:function(){var e=this;setTimeout((function(){e.$refs.codeEditorJSON&&e.$refs.codeEditorJSON.initData()}),300)},totalColsChange:function(){this.$emit("totalColsChange",this.totalCols)},parseData:function(e,t){var a=[],i=e[0],n=1;return t&&(n=2),e.forEach((function(e,t){if(Array.isArray(e)){if(t>=n){var r={};e.forEach((function(e,t){r[i[t]]=e})),a.push(r)}}else a.push(e),0===t&&(i=Object.keys(e))})),{result:a,cols:i}},resetSelectedCols:function(){this.totalCols=[],this.selectedCols=[],this.requestState=0},replaceCustomParams:function(){var e=this,t=Object(s.e)(this.originConfig);delete t.quickSelect,delete t.historySelect,delete t.isQuickSelect,delete t.totalFields,"get"===t.method&&(t.requestPayload={});var a=(null==t?void 0:t.requestPayload)||{};Object.keys(a).forEach((function(t){e.customParams.forEach((function(i){a[t].indexOf(i.name)>-1&&i.useExpression&&(a[t]=e.useExpressionValue(a[t].replaceAll(i.name,i.value)))})),a[t]=e.useExpressionValue(a[t])}));var i=(null==t?void 0:t.requestParams)||[];Object.keys(i).forEach((function(a){var n=i[a];if("string"==typeof n){var r,o,l=e.customParams.find((function(e){return n.indexOf(e.name)>-1}));(null==l?void 0:l.name)&&(n=n.replace(l.name,l.value));var s=null===(r=JSON.stringify(null!==(o=e.useExpressionValue(n))&&void 0!==o?o:""))||void 0===r?void 0:r.replaceAll('"',"");t.url=t.url.replace("?".concat(a,"=").concat(i[a]),s?"?".concat(a,"=").concat(s):"").replace("&".concat(a,"=").concat(i[a]),s?"&".concat(a,"=").concat(s):"")}}));var n=JSON.stringify(t);return this.customParams.forEach((function(t){var a,i,r=null!==(a=t.useExpression?JSON.stringify(null!==(i=e.useExpressionValue(t.value))&&void 0!==i?i:""):t.value)&&void 0!==a?a:"",o="function"==typeof r.replaceAll?r.replaceAll('"',"'"):r;n=n.replaceAll(t.name,o)})),JSON.parse(n)},useExpressionValue:function(e){try{return new Function("return ".concat(e)).call(this)}catch(t){return e}},initCustomParams:function(){var e=Object(s.e)(this.originConfig);"get"===e.method&&(e.requestPayload={});var t=JSON.stringify(e).match(/\$\{(.+?)\}/g),a=Object(i.a)(new Set(t));this.$set(this,"customParams",a.map((function(e){return{name:e,value:"",useExpression:!1}}))),this.$set(this,"customPayloads",this.payload.filter((function(e){return""!==e.name}))),this.$set(this,"customParamsArr",this.paramsArr.filter((function(e){return""!==e.name}))),this.$set(this,"customFilterArr",this.filterArr.filter((function(e){return""!==e.name}))),this.$set(this,"customOrderByArr",this.orderByArr.filter((function(e){return""!==e.attr}))),this.resetSelectedCols()},headerClick:function(e){var t=e.label,a=this.selectedCols.indexOf(t);-1===a?this.selectedCols.push(t):this.selectedCols.splice(a,1)},renderHeader:function(e,t){var a=t.column,i="#111";return this.selectedCols.indexOf(a.label)>=0&&(i="red"),e("div",[e("span",{style:"color: ".concat(i)},a.label)])},handleClose:function(){this.clickSure(),this.$emit("close")},clickSure:function(){this.selectedCols.length&&this.$emit("changeFields",this.selectedCols)}}},g=(a("52e2"),Object(p.a)(b,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"api-test-panel"},[t("div",{staticClass:"api-test-panel-header"},[t("div",{staticClass:"api-test-panel-header-left"},[t("span",{staticClass:"api-test-panel-header-left-back",on:{click:e.handleClose}},[t("i",{staticClass:"el-icon-arrow-left"},[e._v(e._s(e.cancelText))])])]),t("div",{staticClass:"api-test-panel-header-right"},[1===e.requestState?t("i",{staticClass:"el-icon-success"},[t("span",[e._v("执行成功")])]):2===e.requestState?t("i",{staticClass:"el-icon-error"},[t("span",[e._v("执行失败")])]):e._e(),t("el-button",{attrs:{type:"primary"},on:{click:e.test}},[e._v("执行")])],1)]),t("div",{ref:"panelContent",staticClass:"api-test-panel-content"},[t("div",{staticClass:"api-test-panel-content-box"},[t("el-tabs",{model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},[t("el-tab-pane",{attrs:{name:"1",label:"参数配置"}},[t("div",{staticClass:"api-test-panel-content-url"},[t("span",[e._v("请求地址：")]),t("span",[e._v(e._s(e.originConfig.url.split("?")[0]))])]),e.customParamsTotal?t("el-collapse",{staticClass:"api-test-panel-content-collapse",attrs:{value:"1"}},[t("el-collapse-item",{attrs:{name:"1"}},[t("template",{slot:"title"},[t("div",{staticClass:"api-test-panel-content-collapse-title"},[t("div",[t("span",[e._v("配置参数测试值")])]),t("div",[e._v("\n                    共\n                    "),t("span",{style:{color:e.themeColor}},[e._v(e._s(e.customParamsTotal))]),e._v("\n                    项\n                  ")])])]),t("api-test-params",{attrs:{payload:e.customPayloads,paramsArr:e.customParamsArr,filterArr:e.customFilterArr,orderByArr:e.customOrderByArr,isPagination:e.isPagination,pagination:e.pagination},model:{value:e.customParams,callback:function(t){e.customParams=t},expression:"customParams"}})],2)],1):e._e(),e.customParamsTotal?t("div",{staticClass:"api-test-panel-content-tip"},[t("i",{staticClass:"el-icon-info"}),t("span",[e._v("\n              输入测试值后，点击\n            ")]),t("el-button",{attrs:{type:"text"},on:{click:e.test}},[e._v("执行")]),t("span",[e._v("查看测试结果。")])],1):e._e()],1),t("el-tab-pane",{attrs:{name:"2",label:"测试结果"}},[t("div",{staticClass:"api-test-panel-content-fields"},[1===e.requestState?t("el-collapse",{attrs:{value:"1"}},[t("el-collapse-item",{attrs:{title:"响应字段",name:"1"}},[t("template",{slot:"title"},[t("div",{staticClass:"api-test-panel-content-fields-header"},[t("div",{staticClass:"api-test-panel-content-fields-header-left"},[t("span",[e._v("响应字段")]),t("i",{staticClass:"el-icon-info"},[t("span",[e._v("选择需要回显的字段后，在配置页面显示，")]),t("el-button",{attrs:{type:"text"},on:{click:function(t){return t.stopPropagation(),e.handleClose.apply(null,arguments)}}},[e._v("返回查看")]),t("span",[e._v("。")])],1)]),t("div",{staticClass:"api-test-panel-content-fields-header-right"},[e._v("\n                      已选\n                      "),t("span",{style:{color:e.themeColor}},[e._v(e._s(e.selectedCols.length))]),e._v("\n                      项\n                    ")])])]),t("el-checkbox-group",{model:{value:e.selectedCols,callback:function(t){e.selectedCols=t},expression:"selectedCols"}},e._l(e.totalCols,(function(a){return t("el-tooltip",{key:a,attrs:{effect:"dark",content:a,placement:"left",enterable:!1}},[t("el-checkbox",{staticClass:"api-test-panel-content-fields-checkbox",attrs:{label:a,checked:e.fields.indexOf(a)>-1}})],1)})),1)],2)],1):e._e(),1===e.requestState?t("div",{staticClass:"api-test-panel-content-fields-header"},[t("div",{staticClass:"api-test-panel-content-fields-header-left"},[t("span",[e._v("结果列表")]),["object","api","alarm"].includes(e.originConfig.accessType)&&0===e.originConfig.pagination?t("i",{staticClass:"el-icon-info"},[t("span",[e._v("不开启分页配置时，测试结果最多展示10条数据。")])]):e._e()])]):e._e(),1===e.requestState?t("div",{staticClass:"api-test-panel-content-fields-content"},[t("div",{style:"height: ".concat(e.resultBoxHeight,"px; overflow: auto")},[t("div",[1===e.responseType?t("el-table",{ref:"table",attrs:{"max-height":e.resultBoxHeight,data:e.testResult},on:{"header-click":e.headerClick}},e._l(e.totalCols,(function(a){return t("el-table-column",{key:a,attrs:{width:120,prop:a,label:a,"show-overflow-tooltip":"","render-header":e.renderHeader},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                        "+e._s(t.row[a])+"\n                      ")]}}],null,!0)})})),1):e._e(),2===e.responseType?t("base-code-editor",{ref:"codeEditorJSON",attrs:{readOnly:"",value:e.testResultObject,height:e.resultBoxHeight}}):e._e()],1)])]):e._e(),2===e.requestState?t("div",{staticClass:"api-test-panel-content-fields-errMsg"},[e._v("\n              接口返回错误：\n              "),t("br"),e._v("\n              "+e._s(e.errMsg)+"\n            ")]):e._e()],1)])],1)],1)])])}),[],!1,null,"389b2f61",null));t.a=g.exports},d98f:function(e,t,a){"use strict";a.r(t);var i=(a("20d6"),a("75fc")),n=(a("6762"),a("2fdb"),function(){var e=this,t=e._self._c;return t("li",{directives:[{name:"show",rawName:"v-show",value:e.visible,expression:"visible"}],key:e.value,staticClass:"el-select-dropdown__item",class:{selected:e.itemSelected,"is-disabled":e.disabled||e.groupDisabled||e.limitReached,hover:e.hover},on:{mouseenter:e.__hoverItem,click:function(t){return t.stopPropagation(),e.__selectOptionClick.apply(null,arguments)}}},[e._t("default",(function(){return[t("span",[e._v(e._s(e.currentLabel))])]}))],2)}),r=(a("3b2b"),a("7618")),o=(a("6b54"),a("28a5"),a("a481"),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return String(e).replace(/[|\\{}()[\]^$+*?.]/g,"\\$&")}),l=function(e,t){for(var a=(t=t||"").split("."),i=e,n=null,r=0,o=a.length;r<o;r++){var l=a[r];if(!i)break;if(r===o-1){n=i[l];break}i=i[l]}return n},s={nmae:"virtualItem",props:{source:{type:Object,default:function(){return{}}},optionProps:{type:Object,default:function(){return{}}},created:Boolean,disabled:{type:Boolean,default:!1},select:{type:Object,default:function(){return{}}}},data:function(){return{index:-1,groupDisabled:!1,visible:!0,hitState:!1,hover:!1,label:"",value:""}},created:function(){this.label=this.source[this.optionProps.label],this.value=this.source[this.optionProps.value],this.select.options.push(this),this.select.cachedOptions.push(this),this.select.optionsCount++,this.select.filteredOptionsCount++,this.$on("queryChange",this.queryChange),this.$on("handleGroupDisabled",this.handleGroupDisabled)},computed:{isObject:function(){return"[object object]"===Object.prototype.toString.call(this.value).toLowerCase()},currentLabel:function(){return this.label||(this.isObject?"":this.value)},currentValue:function(){return this.value||this.label||""},itemSelected:function(){return this.select.multiple?this.contains(this.select.value,this.value):this.isEqual(this.value,this.select.value)},limitReached:function(){return!!this.select.multiple&&!this.itemSelected&&(this.select.value||[]).length>=this.select.multipleLimit&&this.select.multipleLimit>0}},watch:{currentLabel:function(){this.created||this.select.remote||this.select.setSelected()},value:function(e,t){var a=this.select,i=a.remote,n=a.valueKey;if(!this.created&&!i){if(n&&"object"===Object(r.a)(e)&&"object"===Object(r.a)(t)&&e[n]===t[n])return;this.select.setSelected()}}},methods:{isEqual:function(e,t){if(this.isObject){var a=this.select.valueKey;return l(e,a)===l(t,a)}return e===t},contains:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;if(this.isObject){var a=this.select.valueKey;return e&&e.some((function(e){return l(e,a)===l(t,a)}))}return e&&e.indexOf(t)>-1},handleGroupDisabled:function(e){this.groupDisabled=e},__hoverItem:function(){this.disabled||this.groupDisabled||(this.select.hoverIndex=this.select.options.indexOf(this))},__selectOptionClick:function(){!0!==this.disabled&&!0!==this.groupDisabled&&this.select.handleOptionSelect(this,!0)},queryChange:function(e){this.visible=new RegExp(o(e),"i").test(this.currentLabel)||this.created,this.visible||this.select.filteredOptionsCount--}},beforeDestroy:function(){var e=this.select,t=e.selected,a=e.multiple?t:[t],i=this.select.cachedOptions.indexOf(this),n=a.indexOf(this);i>-1&&n<0&&this.select.cachedOptions.splice(i,1),this.select.onOptionDestroy(this.select.options.indexOf(this))}},c=a("2877"),u=Object(c.a)(s,n,[],!1,null,null,null).exports,d={name:"VirtualSelect",components:{},props:{options:{type:Array,default:function(){return[]}}},data:function(){return{selectRef:null,itemComponent:u,virtualListPropKey:["data-key","data-sources","data-component","keeps","extra-props","estimate-size"],dataSource:[],optionsVisible:!1}},computed:{innerProps:function(){var e={},t={};for(var a in this.$attrs)this.virtualListPropKey.includes(a)?e[a]=this.$attrs[a]:t[a]=this.$attrs[a];return e["extra-props"]||(e["extra-props"]={}),e["extra-props"].select=this.selectRef,{virtualListProp:e,selectProps:t}},optionProps:function(){return this.$attrs["extra-props"].optionProps},__label:function(){return function(e){return e.item[e.scope.optionProps.label]}},__value:function(){return function(e){return e.item[e.scope.optionProps.value]}}},watch:{options:{handler:function(){this.dataSource=this.options},deep:!0,immediate:!0}},mounted:function(){this.selectRef=this.$refs.selectRef},methods:{aaa:function(e){},filterMethod:function(e){var t=this.optionProps,a=t.value,i=t.label;this.dataSource=this.options.filter((function(t){var n=String(t[i]),r=String(t[a]);return n.includes(e)||r.includes(e)}))},visibleChange:function(e){this.optionsVisible=e,e&&(this.dataSource=Object(i.a)(this.options),this.goToStart())},goToStart:function(){var e=this;setTimeout((function(){var t=e.optionProps.value,a=e.dataSource.findIndex((function(a){return a[t]===e.$attrs.value})),i=e.$refs.virtualList;i&&(a>-1?i.scrollToIndex(a-3):i.scrollToIndex(0))}),100)},handleChange:function(e){this.$emit("change",e)},handleInput:function(e){this.$emit("input",e)},emitChange:function(e){this.$emit("input",e),this.$emit("change",e)}}},p=Object(c.a)(d,(function(){var e=this,t=e._self._c;return t("el-select",e._b({ref:"selectRef",staticClass:"selectLabelKey",attrs:{placeholder:"请选择",filterable:"",clearable:"","filter-method":e.filterMethod},on:{change:e.handleChange,input:e.handleInput,"visible-change":e.visibleChange}},"el-select",e.innerProps.selectProps,!1),e._l(e.dataSource,(function(a){return t("el-option",{key:a[e.optionProps.value],attrs:{label:a[e.optionProps.label],value:a[e.optionProps.value]}})})),1)}),[],!1,null,null,null);t.default=p.exports},dabe:function(e,t,a){"use strict";a("9bf6")},dbc2:function(e,t,a){},dc46:function(e,t,a){"use strict";a.r(t),a("ac6a"),a("456d"),a("7f7f");var i=(a("8e6e"),a("3b2b"),a("55dd"),a("4f7f"),a("1c4c"),a("4917"),a("5df3"),a("28a5"),a("20d6"),a("75fc")),n=(a("6762"),a("2fdb"),a("96cf"),a("3b8d")),r=(a("a481"),a("7514"),a("7618")),o=a("bd86"),l=(a("c5f6"),a("967e")),s=a.n(l),c=a("b19c"),u=a("2f62");function d(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function p(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?d(Object(a),!0).forEach((function(t){Object(o.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):d(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var h={name:"ModelSvg",props:{type:{type:String,default:"default"},icon:{type:String,default:"thingModel"},right:{type:[String,Number],default:0},currentNode:{type:Object,default:function(){return{}}}},computed:p(p({},Object(u.a)(["themeConstColor"])),{},{themeColor:function(){return this.themeConstColor.primary},style:function(){return{marginRight:"number"==typeof this.right?"".concat(this.right,"px"):this.right}}}),methods:{getColor:function(e){return"isColor"===e?"color"===this.type?"#FF7214":"fill"===this.type?this.themeColor:"#C9D0D4":"color"===this.type||"fill"===this.type?this.themeColor:"#C9D0D4"}}},f=a("2877"),m=Object(f.a)(h,(function(){var e,t=this,a=t._self._c;return"thingModel"!==t.icon||t.currentNode.isReport||t.currentNode.propertyType&&"5"==t.currentNode.propertyType?"table"===t.icon||"thingModel"===t.icon&&"5"===(null===(e=t.currentNode)||void 0===e?void 0:e.propertyType)||"thingModel"===t.icon&&t.currentNode.isReport?a("svg",{style:t.style,attrs:{width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[a("path",{attrs:{d:"M7.01969 1.68896H12.311C12.9149 1.68896 13.125 1.89904 13.125 2.48988V11.4968C13.125 12.1008 12.9281 12.3109 12.3241 12.3109H1.66278C1.0982 12.3109 0.875 12.1008 0.875 11.5362V2.43736C0.875 1.89904 1.0982 1.68896 1.64965 1.68896H7.01969ZM4.70887 9.47487H1.67591V11.5231H4.722V9.47487H4.70887ZM8.51648 11.5362V9.488H5.48352V11.5362H8.51648ZM9.278 11.51H12.3241V9.47487H9.278V11.51ZM1.67591 6.73077V8.76587H4.70887V6.73077H1.67591ZM9.278 8.779H12.1928C12.2453 8.779 12.3372 8.68709 12.3372 8.63457C12.3503 8.00435 12.3503 7.36099 12.3503 6.73077H9.278V8.779ZM5.47039 8.75274H8.51648V6.73077H5.47039V8.75274ZM4.70887 6.03489V3.98666H1.64965C1.64965 4.61689 1.64965 5.23398 1.66278 5.83795C1.66278 5.9036 1.79408 6.02176 1.85973 6.02176C2.79193 6.03489 3.73727 6.03489 4.70887 6.03489ZM5.48352 5.9955H8.50335V3.98666H5.48352V5.9955ZM12.3241 6.00863V3.97353H9.278V6.00863H12.3241Z",fill:t.getColor()}}),a("path",{attrs:{d:"M7.01969 1.68896H12.311C12.9149 1.68896 13.125 1.89904 13.125 2.48988V2.74684C13.125 3.35081 13.125 3.06598 13.125 3.50348H1.64965C1.08508 3.50348 1.43213 3.50348 0.875 3.50348V2.43736C0.875 1.89904 1.0982 1.68896 1.64965 1.68896H7.01969Z",fill:t.getColor("isColor")}})]):t._e():a("svg",{style:t.style,attrs:{width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[a("g",{attrs:{clipPath:"url(#clip0_3348_61281)"}},[a("path",{attrs:{d:"M6.44387 13.4951L1.74652 10.8364C1.17973 10.5118 0.875 10.1812 0.875 9.3158V4.58187C0.875 4.4097 0.887189 4.26953 0.919185 4.14307L6.58405 7.36859V13.5591C6.53225 13.5454 6.48806 13.521 6.44387 13.4951Z",fill:t.getColor()}}),a("path",{attrs:{d:"M13.0806 4.14307L7.4234 7.3686V13.5591C7.4752 13.5454 7.5133 13.521 7.56358 13.4951L12.2594 10.8364C12.8262 10.5118 13.1248 10.1812 13.1248 9.3158V4.58187C13.1248 4.4097 13.1126 4.27105 13.0806 4.14307Z",fill:t.getColor()}}),a("path",{attrs:{d:"M1.65812 3.16974C1.52404 3.23983 1.40977 3.31601 1.31378 3.412L7.00302 6.62534L12.6938 3.412C12.5978 3.31601 12.4835 3.23983 12.3494 3.16365L8.1107 0.765452C7.74198 0.55519 7.36565 0.440918 7.00302 0.440918C6.6343 0.440918 6.26559 0.55519 5.89687 0.765452L1.65812 3.16974Z",fill:t.getColor("isColor")}})])])}),[],!1,null,"20850e94",null).exports,v={name:"APIAlert",props:{title:{type:String,default:""},ellipsis:{type:Boolean,default:!1}},data:function(){return{show:!0}},computed:{contentStyle:function(){return this.ellipsis?{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}:{}}},methods:{handleClose:function(){this.show=!1,this.$emit("close")}}},b=(a("be37"),Object(f.a)(v,(function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"show",rawName:"v-show",value:e.show,expression:"show"}],staticClass:"api-alert t-color-primary-light-9__bg"},[t("div",{staticClass:"api-alert-content t-text-regular",style:e.contentStyle},[e._v(e._s(e.title))]),t("div",{staticClass:"api-alert-opt"},[t("i",{staticClass:"el-icon-close t-text-secondary",on:{click:e.handleClose}})])])}),[],!1,null,"738be21f",null)).exports,g=a("c276");function y(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function _(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?y(Object(a),!0).forEach((function(t){Object(o.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):y(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var C=function(e){var t={};for(var a in e){var i=e[a];"name"===a?t.name=Object(g.pb)(i.value,i.default):"alias"===a?t.alias=Object(g.pb)(i.value,i.default):"description"===a?t.description=Object(g.pb)(i.value,i.default):"editor"===a&&(t.editor=Object(g.pb)(i.value,i.default))}return t},O={name:"FiltersSelect",props:{value:{type:Array,default:function(){return[{parentId:"",alias:"",name:"",type:"",value:"",configs:{},filter:"",editValue:""}]}},showFilterType:{type:Boolean,default:!1},showDescription:{type:Boolean,default:!1},allowEmpty:{type:Boolean,default:!1},paramNames:{type:Array,default:function(){return[]}}},created:function(){this.payloads=this.value},watch:{value:function(e,t){this.payloads=this.value}},data:function(){return{types:{String:"文本",Number:"数字",Enum:"枚举",DateTime:"时间",Boolean:"布尔"},compoundItem:[{label:"变量选择",value:"variable",formItem:"variable-Panel"},{label:"手动输入",value:"static",formItem:"input",placeholder:"支持字符、${...}、字符与${...}混合三种形式的输入，${...}是对变量的引用，其中...为变量名",tips:"支持字符、${...}、字符与${...}混合三种形式的输入，${...}是对变量的引用，其中...为变量名"}],changed:!0,payloads:[],dialogVisible:!1}},methods:{getConfigShowVal:function(e){var t="";return Object.keys(e||{}).forEach((function(a){t+="".concat(a,"：").concat(e[a],",")})),t.slice(0,t.length-1)||"暂无"},getPayloads:function(e){var t=[];if("array"===Object(c.g)(e))e.forEach((function(e){if(!t.length){var a="payload"===e.name?e.attributes:e.payload?e.payload.attributes:null;a&&a.forEach((function(e){var a=C(e);t.push(a)}))}}));else if("object"===Object(c.g)(e))for(var a in e)if("payload"===a){e[a].attributes.forEach((function(e){var a=C(e);t.push(a)}))}return t},handleEvents:function(e,t){var a=this,i=this.payloads.length;if("add"===e)return i>g.a.MAX_LENGTH_ADD?void this.$message({message:"最多添加"+g.a.MAX_LENGTH_ADD+"项！",type:"warning"}):(this.payloads.push({name:"",value:"",filter:"",editValue:null}),void this.emitChange());if("del"!==e){if("top"===e){if(0===t)return;var n=this.payloads.splice(t,1);return this.payloads.splice(t-1,0,n[0]),void this.emitChange()}if("bottom"===e){if(t===i-1)return;var r=this.payloads.splice(t,1);this.payloads.splice(t+1,0,r[0]),this.emitChange()}}else this.$confirm("确定要删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){a.payloads.splice(t,1),a.emitChange()})).catch((function(){}))},importVariable:function(){var e=this;this.$confirm("导入页面变量会清空已有配置，你确定要导入吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var t=Object(g.ab)(e.pageInfo.page.attributes.customVariable);t?(e.payloads=[],e.handleImportVariable(t)):e.$message.warning("页面未定义自定义变量!")})).catch((function(){}))},handleImportVariable:function(e,t){for(var a in e){var i=e[a],n=t?t+"."+a:a;"object"===Object(c.g)(i)&&this.handleImportVariable(i,n);var r={name:n,value:"${"+n+"}",filter:"",editValue:{type:"variable",static:"",variable:this.getEditValueVariable(n)}};this.payloads.push(r)}},getEditValueVariable:function(e){if(!e)return[];var t=[];return e.split(".").forEach((function(e){t.push(e)})),t},variableOnChange:function(e,t){t.value=e,this.emitChange()},onNameChange:function(){this.emitChange()},onFilterChanged:function(){this.emitChange()},emitChange:function(){this.$emit("input",this.payloads),this.$emit("change",this.payloads)}},computed:_(_({},Object(u.a)(["pageEditor"])),{},{themeStyles:function(){return{target:"th,td",style:{"border-width":Object(g.nb)("borderWidth"),"border-style":Object(g.nb)("borderStyle"),"border-color":Object(g.nb)("borderColor"),padding:"0 5px"}}},theadStyles:function(){return{"background-color":Object(g.nb)("middleBackgroundColor")}},pageInfo:function(){var e=this.$store.getters.pageEditor;return e.pagesKV[e.pagesActiveName]},newArgs:function(){if(this.args&&this.args.length)return Object(i.a)(this.args);var e=this.getPayloads(this.parent&&this.parent.attributes);return e.length>0?e:(e=this.getPayloads(this.parentParent&&this.parentParent.attributes)).length>0?e:[]},filterTypes:function(){return(this.pageEditor.dataLinkFilterTypes||[]).map((function(e){return{label:e.name,value:e.symbol}}))}})},T=(a("c792"),Object(f.a)(O,(function(){var e=this,t=e._self._c;return t("div",[t("table",{directives:[{name:"theme",rawName:"v-theme",value:e.themeStyles,expression:"themeStyles"}],staticClass:"hc-editor-payload-table"},[t("thead",{staticClass:"hc-editor-payload-table-thead",style:e.theadStyles},[e._m(0)]),t("tbody",{staticClass:"hc-editor-payload-table-tbody"},e._l(e.payloads,(function(a,i){return t("tr",{key:i},[t("td",{staticStyle:{"max-width":"60px"},attrs:{title:"".concat(a.alias,"(").concat(a.name,")")}},[e._v(e._s(a.alias))]),t("td",{staticStyle:{"max-width":"60px","text-align":"center"}},[t("div",{class:"tag-types tag-".concat(e.types.hasOwnProperty(a.type)?a.type:"String")},[e._v(e._s(e.types[a.type]||"文本"))])]),t("td",{staticStyle:{"max-width":"60px"}},[t("el-popover",{attrs:{placement:"bottom-start",title:"约束说明",trigger:"hover",disabled:!Object.keys(a.configs||{}).length,width:300}},[t("ul",e._l(a.configs,(function(a,i){return t("li",{key:i},[e._v(e._s(i)+"："+e._s(a))])})),0),t("div",{staticClass:"filter-configs",attrs:{slot:"reference"},slot:"reference"},[e._v("\n              "+e._s(e.getConfigShowVal(a.configs))+"\n            ")])])],1),t("td",[t("el-select",{attrs:{disabled:e.paramNames.includes(a.name),size:"mini",placeholder:"请选择"},on:{change:e.onFilterChanged},model:{value:a.filter,callback:function(t){e.$set(a,"filter",t)},expression:"param.filter"}},e._l(e.filterTypes,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("td",[t("variable-editor-components",{attrs:{compoundItem:e.compoundItem,data:a,args:e.newArgs},on:{change:function(t){return e.variableOnChange(t,a)}}})],1),t("td",{staticClass:"hc-payload-operation",attrs:{align:"center"}},[t("el-button",{staticClass:"delete-button",attrs:{title:"删除",size:"mini",type:"danger",disabled:!e.allowEmpty&&e.payloads.length<=1},on:{click:function(t){return e.handleEvents("del",i)}}},[e._v("删除")])],1)])})),0)])])}),[function(){var e=this,t=e._self._c;return t("tr",[t("th",{staticStyle:{width:"100px"}},[e._v("筛选字段")]),t("th",{staticStyle:{width:"68px"}},[e._v("数据类型")]),t("th",{staticStyle:{width:"60px"}},[e._v("约束")]),t("th",{staticStyle:{width:"100px"}},[e._v("筛选条件")]),t("th",[e._v("参数值")]),t("th",{staticStyle:{width:"60px"}},[e._v("操作")])])}],!1,null,"57da834c",null)).exports,V=a("91ff");function w(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function P(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?w(Object(a),!0).forEach((function(t){Object(o.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):w(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var x=function(e){var t={};for(var a in e){var i=e[a];"name"===a?t.name=Object(g.pb)(i.value,i.default):"alias"===a?t.alias=Object(g.pb)(i.value,i.default):"description"===a?t.description=Object(g.pb)(i.value,i.default):"editor"===a&&(t.editor=Object(g.pb)(i.value,i.default))}return t},S={name:"FieldsCompsSelect",props:{value:{type:Array,default:function(){return[{checked:!1,parentId:"",alias:"",name:"",type:"String",value:"",configs:[]}]}},showFilterType:{type:Boolean,default:!1},showDescription:{type:Boolean,default:!1},allowEmpty:{type:Boolean,default:!1},compOptions:{type:Array,default:function(){return[]}}},created:function(){this.payloads=this.value},watch:{value:function(e,t){this.payloads=this.value}},data:function(){return{types:{String:"文本",Number:"数字",Enum:"枚举",DateTime:"时间",Boolean:"布尔"},changed:!0,payloads:[],dialogVisible:!1,searchType:"",searchName:"",searchChecked:!1}},computed:P(P({},Object(u.a)(["pageEditor"])),{},{themeStyles:function(){return{target:"th,td",style:{"border-width":Object(g.nb)("borderWidth"),"border-style":Object(g.nb)("borderStyle"),"border-color":Object(g.nb)("borderColor"),padding:"0 5px"}}},theadStyles:function(){return{"background-color":Object(g.nb)("middleBackgroundColor")}},pageInfo:function(){var e=this.$store.getters.pageEditor;return e.pagesKV[e.pagesActiveName]},isIndeterminate:function(){for(var e,t,a=0;a<(this.payloads.length||0);)this.payloads[a].checked?e=1:t=1,a++;return e&&t},searchTypeOptions:function(){var e=this;return[{name:"全部",value:""}].concat(Object(i.a)(Object.keys(this.types).map((function(t){return{name:e.types[t],value:t}}))))}}),methods:{checkSearch:function(e){var t;return(!this.searchName||(null===(t=e.alias)||void 0===t?void 0:t.indexOf(this.searchName))>-1)&&(!this.searchType||e.type===this.searchType)&&(!this.searchChecked||e.checked)},handleChecked:function(e,t,a){a?(t.forEach((function(t){t.checked=e})),this.isIndeterminate=!1):(t.checked=e,this.isIndeterminate=this.payloads.some((function(t){return t.checked===!e})))},getConfigShowVal:function(e){var t="";return Object.keys(e||{}).forEach((function(a){t+="".concat(a,"：").concat(e[a],",")})),t.slice(0,t.length-1)||"暂无"},getPayloads:function(e){var t=[];if("array"===Object(c.g)(e))e.forEach((function(e){if(!t.length){var a="payload"===e.name?e.attributes:e.payload?e.payload.attributes:null;a&&a.forEach((function(e){var a=x(e);t.push(a)}))}}));else if("object"===Object(c.g)(e))for(var a in e)if("payload"===a){e[a].attributes.forEach((function(e){var a=x(e);t.push(a)}))}return t},handleEvents:function(e,t){var a=this,i=this.payloads.length;if("add"===e)return i>g.a.MAX_LENGTH_ADD?void this.$message({message:"最多添加"+g.a.MAX_LENGTH_ADD+"项！",type:"warning"}):(this.payloads.push({name:"",value:"",filter:"",editValue:null}),void this.emitChange());if("del"!==e){if("top"===e){if(0===t)return;var n=this.payloads.splice(t,1);return this.payloads.splice(t-1,0,n[0]),void this.emitChange()}if("bottom"===e){if(t===i-1)return;var r=this.payloads.splice(t,1);this.payloads.splice(t+1,0,r[0]),this.emitChange()}}else this.$confirm("确定要删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){a.payloads.splice(t,1),a.emitChange()})).catch((function(){}))},importVariable:function(){var e=this;this.$confirm("导入页面变量会清空已有配置，你确定要导入吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var t=Object(g.ab)(e.pageInfo.page.attributes.customVariable);t?(e.payloads=[],e.handleImportVariable(t)):e.$message.warning("页面未定义自定义变量!")})).catch((function(){}))},handleImportVariable:function(e,t){for(var a in e){var i=e[a],n=t?t+"."+a:a;"object"===Object(c.g)(i)&&this.handleImportVariable(i,n);var r={name:n,value:"${"+n+"}",filter:"",editValue:{type:"variable",static:"",variable:this.getEditValueVariable(n)}};this.payloads.push(r)}},getEditValueVariable:function(e){if(!e)return[];var t=[];return e.split(".").forEach((function(e){t.push(e)})),t},onNameChange:function(){this.emitChange()},onCompChanged:function(){this.emitChange()},emitChange:function(){this.$emit("input",this.payloads),this.$emit("change",this.payloads)}}},j=(a("7f0e"),Object(f.a)(S,(function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"fields-comps-select-search"},[t("div",{staticClass:"fields-comps-select-search-left"},[t("div",{staticClass:"fcs-label"},[e._v("类型")]),t("el-select",{staticClass:"fcs-type",model:{value:e.searchType,callback:function(t){e.searchType=t},expression:"searchType"}},e._l(e.searchTypeOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.name,value:e.value}})})),1),t("el-input",{staticClass:"fcs-name",attrs:{placeholder:"请输入字段名称","suffix-icon":"el-icon-search"},model:{value:e.searchName,callback:function(t){e.searchName=t},expression:"searchName"}})],1),t("div",{staticClass:"fields-comps-select-search-right"},[t("el-checkbox",{model:{value:e.searchChecked,callback:function(t){e.searchChecked=t},expression:"searchChecked"}},[e._v("只显示已选")])],1)]),t("table",{directives:[{name:"theme",rawName:"v-theme",value:e.themeStyles,expression:"themeStyles"}],staticClass:"hc-editor-payload-table"},[t("thead",{staticClass:"hc-editor-payload-table-thead",style:e.theadStyles},[t("tr",[t("th",{staticStyle:{width:"60px"}},[t("el-checkbox",{attrs:{indeterminate:e.isIndeterminate,value:!e.payloads.some((function(e){return!e.checked}))},on:{change:function(t){return e.handleChecked(t,e.payloads,!0)}}})],1),t("th",{staticStyle:{width:"120px"}},[e._v("字段")]),t("th",{staticStyle:{width:"80px"}},[e._v("数据类型")]),t("th",{staticStyle:{width:"80px"}},[e._v("约束")]),t("th",[e._v("呈现组件")])])]),t("tbody",{staticClass:"hc-editor-payload-table-tbody"},e._l(e.payloads,(function(a,i){return t("tr",{directives:[{name:"show",rawName:"v-show",value:e.checkSearch(a),expression:"checkSearch(param)"}],key:i},[t("td",{staticStyle:{"text-align":"center"}},[t("el-checkbox",{attrs:{value:a.checked},on:{change:function(t){return e.handleChecked(t,a)}}})],1),t("td",{staticStyle:{"max-width":"60px"},attrs:{title:"".concat(a.alias,"(").concat(a.name,")")}},[e._v(e._s(a.alias))]),t("td",{staticStyle:{"max-width":"60px","text-align":"center"}},[t("div",{class:"tag-types tag-".concat(e.types.hasOwnProperty(a.type)?a.type:"other"),attrs:{title:a.type}},[e._v(e._s(e.types[a.type]||"其他"))])]),t("td",{staticStyle:{"max-width":"60px"}},[t("el-popover",{attrs:{placement:"bottom-start",title:"约束说明",trigger:"hover",disabled:!Object.keys(a.configs||{}).length,width:300}},[t("ul",e._l(a.configs,(function(a,i){return t("li",{key:i},[e._v(e._s(i)+"："+e._s(a))])})),0),t("div",{staticClass:"filter-configs",attrs:{slot:"reference"},slot:"reference"},[e._v("\n              "+e._s(e.getConfigShowVal(a.configs))+"\n            ")])])],1),t("td",[t("el-select",{attrs:{size:"mini",placeholder:"不填充",clearable:""},on:{change:e.onCompChanged},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"param.value"}},e._l(e.compOptions,(function(e){return t("el-option",{key:e.name,attrs:{label:e.alias,value:e.name}})})),1)],1)])})),0)])])}),[],!1,null,"b3b94700",null)).exports,E=function(e){var t={};for(var a in e){var i=e[a];"name"===a?t.name=Object(g.pb)(i.value,i.default):"alias"===a?t.alias=Object(g.pb)(i.value,i.default):"description"===a?t.description=Object(g.pb)(i.value,i.default):"editor"===a&&(t.editor=Object(g.pb)(i.value,i.default))}return t},k={name:"OrderbySelect",props:{value:{type:Array,default:function(){return[{attr:"",aggregationType:"",description:""}]}},attrReadonly:{type:Boolean,default:!1},typeClearable:{type:Boolean,default:!1},showDescription:{type:Boolean,default:!1},descriptionReadonly:{type:Boolean,default:!1},showPublicAdd:{type:Boolean,default:!0},operationsLayout:{type:[Array,String],default:"del, clear"},nameOptions:{type:Array,default:function(){return[]}}},created:function(){this.payloads=this.value,this.initFetchData()},watch:{value:function(e,t){this.payloads=this.value}},data:function(){return{changed:!0,aggregationTypes:[{label:"求和",value:"sum"},{label:"平均值",value:"avg"},{label:"最大值",value:"max"},{label:"最小值",value:"min"},{label:"乘积",value:"pro"},{label:"累计次数",value:"count"}],payloads:[{attr:"",aggregationType:"",description:""}],dialogVisible:!1}},methods:{initFetchData:function(){var e=this;return Object(n.a)(s.a.mark((function t(){var a;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getOperators([2]);case 2:a=t.sent,e.aggregationTypes=a.map((function(e){return{label:e.name,value:e.symbol}}));case 4:case"end":return t.stop()}}),t)})))()},getOperators:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[2];return Object(n.a)(s.a.mark((function a(){var i,n;return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return i={url:"/api/compdata/operators",method:"post",data:{types:t}},n=[],a.next=4,e.$util.request(i).then((function(e){n=e})).catch((function(e){}));case 4:return a.abrupt("return",n);case 5:case"end":return a.stop()}}),a)})))()},getPayloads:function(e){var t=[];if("array"===Object(c.g)(e))e.forEach((function(e){if(!t.length){var a="payload"===e.name?e.attributes:e.payload?e.payload.attributes:null;a&&a.forEach((function(e){var a=E(e);t.push(a)}))}}));else if("object"===Object(c.g)(e))for(var a in e)if("payload"===a){e[a].attributes.forEach((function(e){var a=E(e);t.push(a)}))}return t},handleEvents:function(e,t){var a=this,i=this.payloads.length;if("add"===e)return i>g.a.MAX_LENGTH_ADD?void this.$message({message:"最多添加"+g.a.MAX_LENGTH_ADD+"项！",type:"warning"}):(this.payloads.push({name:"",value:"",filter:"",editValue:null,aggregationType:"",description:""}),void this.emitChange());if("del"!==e){if("top"===e){if(0===t)return;var n=this.payloads.splice(t,1);return this.payloads.splice(t-1,0,n[0]),void this.emitChange()}if("bottom"===e){if(t===i-1)return;var r=this.payloads.splice(t,1);this.payloads.splice(t+1,0,r[0]),this.emitChange()}"clear"===e&&this.emitChange()}else this.$confirm("确定要删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){a.emitChange(),a.payloads.splice(t,1)})).catch((function(){}))},getEditValueVariable:function(e){if(!e)return[];var t=[];return e.split(".").forEach((function(e){t.push(e)})),t},variableOnChange:function(e){this.emitChange()},onNameChange:function(){this.emitChange()},onTypeChanged:function(){this.emitChange()},emitChange:function(){this.$emit("input",this.payloads),this.$emit("change",this.payloads)}},computed:{themeStyles:function(){return{target:"th,td",style:{"border-width":Object(g.nb)("borderWidth"),"border-style":Object(g.nb)("borderStyle"),"border-color":Object(g.nb)("borderColor"),padding:"0 5px"}}},theadStyles:function(){return{"background-color":Object(g.nb)("middleBackgroundColor")}},pageInfo:function(){var e=this.$store.getters.pageEditor;return e.pagesKV[e.pagesActiveName]},newArgs:function(){if(this.args&&this.args.length)return Object(i.a)(this.args);var e=this.getPayloads(this.parent&&this.parent.attributes);return e.length>0?e:(e=this.getPayloads(this.parentParent&&this.parentParent.attributes)).length>0?e:[]},operationsLayout$:function(){var e=this.operationsLayout;return"string"==typeof e&&e&&(e=(e=e.replace(/\s/g,"")).split(",")),e||[]}}},I=(a("570a"),Object(f.a)(k,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"orderby-setting"},[t("table",{directives:[{name:"theme",rawName:"v-theme",value:e.themeStyles,expression:"themeStyles"}],staticClass:"hc-editor-payload-table"},[t("thead",{staticClass:"hc-editor-payload-table-thead",style:e.theadStyles},[t("tr",[t("th",[e._v("参数名")]),t("th",{attrs:{width:"32%"}},[e._v("类型")]),e.showDescription?t("th",{attrs:{width:"20%"}},[e._v("描述")]):e._e(),t("th",{attrs:{width:"20%"}},[e._v("操作")])])]),t("tbody",{staticClass:"hc-editor-payload-table-tbody"},e._l(e.payloads,(function(a,i){return t("tr",{key:i},[t("td",[e.nameOptions&&e.nameOptions.length?t("el-select",{class:{readonly:e.attrReadonly},staticStyle:{width:"100%"},attrs:{readonly:e.attrReadonly,clearable:"",size:"mini",placeholder:"请选择"},on:{change:e.onNameChange},model:{value:a.attr,callback:function(t){e.$set(a,"attr",t)},expression:"param.attr"}},e._l(e.nameOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1):t("el-input",{class:{readonly:e.attrReadonly},attrs:{size:"mini",readonly:e.attrReadonly,placeholder:"请输入参数名",clearable:""},on:{blur:e.onNameChange},model:{value:a.attr,callback:function(t){e.$set(a,"attr",t)},expression:"param.attr"}})],1),t("td",[t("el-select",{staticStyle:{width:"100%"},attrs:{clearable:e.typeClearable,size:"mini",placeholder:"请选择"},on:{change:e.onTypeChanged},model:{value:a.aggregationType,callback:function(t){e.$set(a,"aggregationType",t)},expression:"param.aggregationType"}},e._l(e.aggregationTypes,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),e.showDescription?t("td",[t("el-input",{class:{readonly:e.descriptionReadonly},attrs:{readonly:e.descriptionReadonly,size:"mini",placeholder:""},model:{value:a.description,callback:function(t){e.$set(a,"description",t)},expression:"param.description"}})],1):e._e(),t("td",{staticClass:"hc-payload-operation",attrs:{align:"center"}},[t("CommonTableMoveOprate",{attrs:{data:e.payloads,layout:e.operationsLayout$,index:i,icon:!1,text:!0},on:{click:e.handleEvents}})],1)])})),0)]),e.showPublicAdd?t("div",{staticClass:"params-add-btn"},[t("el-button",{attrs:{title:"新增",icon:"el-icon-plus",plain:""},on:{click:function(t){return e.handleEvents("add")}}},[e._v("添加参数")])],1):e._e()])}),[],!1,null,"1dd9c403",null)).exports,A=(a("f559"),a("36f0")),D=a("88da"),N=a("314f"),$={name:"AssetsTable",props:{data:{type:Array,default:function(){return[]}},types:{type:Object,default:function(){return{}}},propertyTypeMap:{type:Object,default:function(){return{}}},pagination:{type:Object,default:function(){return{page:1,pageSize:10,total:0}}},multipleSelection:{type:Array,default:function(){return[]}},isSingleSelect:{type:Boolean,default:!1}},data:function(){return{pageSizes:[10,20,50,100],tagType:{collect:"",calculate:"success",indicator:"warning",manual:"danger",measuringPoint:"info"}}},methods:{handleSelected:function(e){var t=this;return Object(n.a)(s.a.mark((function a(){return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.$refs.table.$nextTick();case 2:t.data.forEach((function(a){e.some((function(e){return e.id===a.id||e.identifier===a.identifier}))&&(t.isSingleSelect?t.$refs.table.setCurrentRow(a):t.$refs.table.toggleRowSelection(a))}));case 3:case"end":return a.stop()}}),a)})))()},typeFormat:function(e){return this.types[this.propertyTypeMap[e]]||e},handleSelectChange:function(e){var t=this;if(e){this.isSingleSelect&&(e=Array.isArray(e)?e:[e]),this.multipleSelection||(this.multipleSelection=[]);for(var a,n,r=0,o=function(){var e=t.multipleSelection[r];t.data.some((function(t){return t.id===e.id}))?t.multipleSelection.splice(r,1):r++};r<((null===(l=this.multipleSelection)||void 0===l?void 0:l.length)||0);){var l;o()}this.isSingleSelect?(a=this.multipleSelection).splice.apply(a,[0,this.multipleSelection.length].concat(Object(i.a)(e))):(n=this.multipleSelection).splice.apply(n,[this.multipleSelection.length,0].concat(Object(i.a)(e))),this.$emit("selectionChange",this.multipleSelection)}},handleSizeChange:function(e){this.pagination.pageSize=e,this.$emit("paginationChange",this.pagination)},handleCurrentChange:function(e){this.pagination.page=e,this.$emit("paginationChange",this.pagination)},clearSelection:function(){var e;null!==(e=this.$refs)&&void 0!==e&&e.table&&(this.isSingleSelect?this.$refs.table.setCurrentRow():this.$refs.table.clearSelection())}}},L=(a("37f8"),a("1b99"),Object(f.a)($,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"assets-table"},[t("el-table",{ref:"table",staticStyle:{width:"100%"},attrs:{data:e.data,"highlight-current-row":e.isSingleSelect},on:{select:e.handleSelectChange,"select-all":e.handleSelectChange,"current-change":e.handleSelectChange}},[e.isSingleSelect?e._e():t("el-table-column",{attrs:{type:"selection",width:"70"}}),t("el-table-column",{attrs:{prop:"propertyType",label:"类型",width:"100"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tag",{attrs:{type:e.tagType[e.propertyTypeMap[a.row.propertyType]],size:"mini"}},[e._v(e._s(e.typeFormat(a.row.propertyType)))])]}}])}),t("el-table-column",{attrs:{prop:"name",label:"名称",width:"180"}}),t("el-table-column",{attrs:{prop:"identifier",label:"标识"}})],1),(e.pagination.total||e.data.length)>10?t("el-pagination",{staticClass:"assets-pagination",attrs:{size:"small","current-page":e.pagination.page,"page-sizes":e.pageSizes,"page-size":e.pagination.pageSize,layout:"prev, pager, next","pager-count":5,total:e.pagination.total||e.data.length},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}):e._e()],1)}),[],!1,null,"c8d4bfd8",null)).exports,M=a("f246"),q=a("65d4"),B=a("0338");function F(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function R(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?F(Object(a),!0).forEach((function(t){Object(o.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):F(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var K={name:"HistorySetting",props:{editVal:{type:Object,default:function(){return{}}},hideQuerySize:{type:Boolean,default:!1},queryTypesShow:{type:Number,default:7}},data:function(){return{compoundItem:[{label:"变量选择",value:"variable",formItem:"variable-Panel"},{label:"手动输入",value:"static",formItem:"date-picker"}],rtDataTypes:[{label:"实时数据",value:1},{label:"历史数据",value:2}],queryDirections:[{label:"小于等于采集/归档时间",value:1},{label:"大于等于采集/归档时间",value:2},{label:"小于采集/归档时间",value:3},{label:"大于采集/归档时间",value:4}],queryTypes:[{label:"采集时间",value:1},{label:"归档时间",value:2},{label:"时间区间",value:4}],recordTypes:[{label:"历史记录",value:1},{label:"按天归档的数据",value:2},{label:"按小时归档的数据",value:3},{label:"按分钟归档的数据",value:4}]}},computed:{orders:function(){return 1===this.editVal.requestPayload.recordType?[{label:"升序",value:"collectTime asc"},{label:"降序",value:"collectTime desc"}]:[{label:"升序",value:"archiveDate asc"},{label:"降序",value:"archiveDate desc"}]},queryTypes$:function(){var e=this;return this.queryTypes.filter((function(t){return t.value&e.queryTypesShow}))}},methods:{changeVariable:function(e,t){var a,i="collectTime"===t?this.editVal.variableEditData[t+"Data"]:null,n="static"===(null==i||null===(a=i.editValue)||void 0===a?void 0:a.type)?+new Date(e):e;this.editVal.requestPayload[t]=isNaN(n)?e:n},handleTypeChange:function(e){2===e&&(this.editVal.requestPayload=R(R({},this.editVal.requestPayload),this.requestPayloadBak),this.editVal.variableEditData=R(R({},this.editVal.variableEditData),this.variableEditDataBak),this.changeRecordType(this.editVal.requestPayload.recordType))},handleDataTypeChange:function(e){4===e&&(this.editVal.requestPayload.querySize=this.hideQuerySize?1:1e3)},changeRecordType:function(e){var t=this.editVal.requestPayload.$orderBy.split(" ");t.length&&(t[0]=1===e?"collectTime":"archiveDate",this.editVal.requestPayload.$orderBy=t.join(" "))}}},U=Object(f.a)(K,(function(){var e=this,t=e._self._c;return t("div",[t("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{label:"数据类型："}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},on:{change:e.handleTypeChange},model:{value:e.editVal.rtDataType,callback:function(t){e.$set(e.editVal,"rtDataType",t)},expression:"editVal.rtDataType"}},e._l(e.rtDataTypes,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),2===e.editVal.rtDataType?t("el-form-item",{attrs:{label:"查询类型："}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},on:{change:e.handleDataTypeChange},model:{value:e.editVal.requestPayload.queryType,callback:function(t){e.$set(e.editVal.requestPayload,"queryType",t)},expression:"editVal.requestPayload.queryType"}},e._l(e.queryTypes$,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1):e._e(),2===e.editVal.rtDataType?t("el-form-item",{attrs:{label:"记录类型："}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},on:{change:e.changeRecordType},model:{value:e.editVal.requestPayload.recordType,callback:function(t){e.$set(e.editVal.requestPayload,"recordType",t)},expression:"editVal.requestPayload.recordType"}},e._l(e.recordTypes,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1):e._e(),2===e.editVal.rtDataType&&4!==e.editVal.requestPayload.queryType?t("div",[t("el-form-item",{attrs:{label:"查询范围："}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.editVal.requestPayload.queryDirection,callback:function(t){e.$set(e.editVal.requestPayload,"queryDirection",t)},expression:"editVal.requestPayload.queryDirection"}},e._l(e.queryDirections,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!e.hideQuerySize,expression:"!hideQuerySize"}],attrs:{label:"查询条数："}},[t("el-input-number",{attrs:{size:"mini",min:1,max:1e3,step:1,"step-strictly":""},on:{blur:e.onQuerySizeBlur},model:{value:e.editVal.requestPayload.querySize,callback:function(t){e.$set(e.editVal.requestPayload,"querySize",t)},expression:"editVal.requestPayload.querySize"}})],1),t("el-form-item",{attrs:{label:"排序："}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.editVal.requestPayload.$orderBy,callback:function(t){e.$set(e.editVal.requestPayload,"$orderBy",t)},expression:"editVal.requestPayload.$orderBy"}},e._l(e.orders,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1):e._e(),2===e.editVal.rtDataType&&4!==e.editVal.requestPayload.queryType?t("div",[t("el-form-item",{attrs:{label:"".concat(1===e.editVal.requestPayload.queryType?"采集":"归档","时间："),prop:"requestPayload.collectTime"}},[t("variable-editor-components",{key:"collectTime",attrs:{compoundItem:e.compoundItem,"value-format":"timestamp",data:e.editVal.variableEditData.collectTimeData},on:{change:function(t){return e.changeVariable(t,"collectTime")}}})],1)],1):e._e(),2===e.editVal.rtDataType&&4===e.editVal.requestPayload.queryType?t("div",[t("el-form-item",{attrs:{label:"开始时间：",prop:"requestPayload.beginTime"}},[t("variable-editor-components",{key:"beginTime",attrs:{compoundItem:e.compoundItem,"value-format":"timestamp",data:e.editVal.variableEditData.beginTimeData},on:{change:function(t){return e.changeVariable(t,"beginTime")}}})],1),t("el-form-item",{attrs:{label:"结束时间：",prop:"requestPayload.endTime"}},[t("variable-editor-components",{key:"endTime",attrs:{compoundItem:e.compoundItem,"value-format":"timestamp",data:e.editVal.variableEditData.endTimeData},on:{change:function(t){return e.changeVariable(t,"endTime")}}})],1)],1):e._e()],1)}),[],!1,null,"5fed61a4",null).exports,z=a("d374"),G={name:"AssetsHeader",components:{MoreInfo:a("aeb2").a},props:{activeView:{type:String,default:""},currentNode:{type:Object,default:function(){return{}}},profileProperties:{type:Array,default:function(){return[]}},profileInfo:{type:Object,default:function(){return{}}},deviceName:{type:String,default:""},queryType:{type:String,default:""},actualTimeType:{type:String,default:""},historyType:{type:String,default:""},selectedLength:{type:Number,default:0},types:{type:Object,default:function(){return{}}},editVal:{type:Object,default:function(){return{}}}},data:function(){return{collapse:!0,moreInfoProp:{},actualTimeTypes:[{key:"static",value:"静态"},{key:"dynamic",value:"动态"}]}},computed:{isDevice:function(){return"device"===this.activeView},isUnDevice:function(){return"unDevice"===this.activeView},currentAssetClass:function(){return["assets-header-title",{"t-text-placeholder":!this.currentNode.name,"t-text-primary":this.currentNode.name}]},moreInfoClass:function(){return this.collapse?"el-icon-arrow-down":"el-icon-arrow-up"},historyTypes:function(){var e=this;return Object.keys(this.types).filter((function(e){return["collect","calculate","indicator"].includes(e)})).map((function(t){return{key:t,value:e.types[t]}}))}},filters:{assetTitle:function(e){return e||"请选择资产"},deviceStatus:function(e){return e?"在线":"离线"}},methods:{handleMoreInfoClick:function(){this.collapse=!this.collapse},handleViewChange:function(e){this.$emit("view-change",e)},handleTabClick:function(e){this.$emit("tab-click",e)},handleHistoryTypeChange:function(e){this.$emit("history-type-change",e)},handleActualTimeTypeChange:function(e){this.$emit("actualTime-type-change",e)}}},H=(a("fe08"),a("7cda"),Object(f.a)(G,(function(){var e=this,t=e._self._c;return t("div",[e.isUnDevice?[t("div",{staticClass:"assets-property-header"},[t("div",{staticClass:"header-title"},[t("div",{staticClass:"assets-header-wrapper"},[t("span",{class:e.currentAssetClass},[e._v(e._s(e._f("assetTitle")(e.currentNode.name)))]),e._e()],1),e.currentNode.name?t("div",{staticClass:"assets-header-description t-text-regular"},[t("span",[e._v("【"+e._s(e.profileInfo.identifier)+"】")])]):e._e()]),!e.deviceName||"history"===e.queryType&&"indicator"===e.historyType?e._e():t("div",{staticClass:"header-device-select t-text-regular"},[e._v("已选择"),t("em",{staticClass:"t-color-primary"},[e._v(e._s(e.selectedLength))]),e._v("条内置测点")]),!e.deviceName||"history"===e.queryType&&"indicator"===e.historyType?e._e():t("div",{staticClass:"header-device t-border",on:{click:function(t){return e.handleViewChange("device")}}},[t("el-tag",{attrs:{size:"mini","disable-transitions":!0,type:e.currentNode.isOnline?"success":"info"}},[e._v(e._s(e._f("deviceStatus")(e.currentNode.isOnline)))]),t("span",{staticClass:"t-color-primary",staticStyle:{margin:"0 6px 0 4px"}},[e._v(e._s(e.deviceName))]),t("i",{staticClass:"el-icon-arrow-right"})],1)]),e.collapse?e._e():t("div",[t("more-info",{staticClass:"assets-more-info",attrs:{list:e.profileProperties,prop:e.moreInfoProp,span:8}})],1),t("el-tabs",{on:{"tab-click":e.handleTabClick},model:{value:e.queryType,callback:function(t){e.queryType=t},expression:"queryType"}},[t("el-tab-pane",{attrs:{label:"实时数据",name:"actualTime"}},[t("el-radio-group",{staticClass:"assets-history-type",attrs:{size:"mini"},on:{input:e.handleActualTimeTypeChange},model:{value:e.actualTimeType,callback:function(t){e.actualTimeType=t},expression:"actualTimeType"}},e._l(e.actualTimeTypes,(function(a){return t("el-radio-button",{key:a.key,attrs:{label:a.key}},[e._v(e._s(a.value))])})),1)],1),t("el-tab-pane",{attrs:{label:"历史数据",name:"history"}},[t("el-radio-group",{staticClass:"assets-history-type",attrs:{size:"mini"},on:{input:e.handleHistoryTypeChange},model:{value:e.historyType,callback:function(t){e.historyType=t},expression:"historyType"}},e._l(e.historyTypes,(function(a){return t("el-radio-button",{key:a.key,attrs:{label:a.key}},[e._v(e._s(a.value))])})),1)],1)],1)]:e._e(),e.isDevice?[t("div",{staticClass:"assets-device-title",on:{click:function(t){return e.handleViewChange("unDevice")}}},[t("el-icon",{staticClass:"el-icon-arrow-left title-icon"}),t("span",{staticClass:"title-name"},[e._v(e._s(e._f("assetTitle")(e.currentNode.name))+" / "+e._s(e.deviceName))]),t("el-tag",{attrs:{size:"mini","disable-transitions":!0,type:e.currentNode.isOnline?"success":"info"}},[e._v(e._s(e._f("deviceStatus")(e.currentNode.isOnline)))])],1)]:e._e()],2)}),[],!1,null,"64f811c2",null)).exports,W=a("e13a");function J(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function Y(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?J(Object(a),!0).forEach((function(t){Object(o.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):J(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var Z={name:"Assets",alias:"资产",command:"assets-link",mixins:[A.a],components:{AssetsDynamic:W.a,AssetsHeader:H,HistorySetting:U,AssetsTable:L,AssetsCollapse:N.a,AssetsIndicatorTable:M.a,EditorCollapse:D.a,ParamSetting:q.a,FilterSetting:B.a},props:{visible:{type:String,default:function(){return!1}},linkType:{type:Number,default:function(){return 1}},handleChangeResult:{type:Function,default:function(){}},data:{type:Object,default:function(){return{alias:"",type:"",default:"",value:""}}}},data:function(){return{showCloseTips:JSON.parse(localStorage.getItem("link-tips-assets")),searchName:"",dialogVisible:this.visible,projectName:"",deviceName:"",activeView:"unDevice",currentNode:{},currentNodeId:"",syncIndicatorLoading:!1,originEditor:{accessType:"assets",linkType:this.linkType,url:"/api/indicator/values/aggregation",method:"post",contentType:"application/json",pagination:0,defaultLoad:!0},propSelected:[],indicatorFields:[],editVal:{},defaultProps:{children:"children",label:"name"},types:{collect:"采集",indicator:"指标",calculate:"计算",manual:"自定义点",measuringPoint:"内置测点"},propertyTypeMap:{1:"collect",2:"calculate",3:"indicator",4:"manual",5:"measuringPoint"},assetsList:[],tableData:[],tablePagination:{page:1,pageSize:10},hasIndicator:!1,profileInfo:{},profileProperties:[],historyTypeParams:{name:"",identifier:"",propertyType:"",labels:""}}},watch:{showCloseTips:function(e){localStorage.setItem("link-tips-assets",e)},responseFields:{immediate:!0,handler:function(e){this.emitFieldsSelect()}},"propSelected.length":{handler:function(e){this.hasIndicator=this.propSelected.some((function(e){return 3==+(null==e?void 0:e.propertyType)}))}},hasIndicator:function(){}},computed:Y(Y({},Object(u.a)(["getLinkTipsOf"])),{},{assetsTipsLoaded:function(){this.getLinkTipsOf("assets-link")},assetsData:function(){var e=this,t=[],a=this.assetsList,i={},n=function(t){var a;return~(null==t||null===(a=t.name)||void 0===a?void 0:a.toLowerCase().indexOf(e.searchName))};return this.isProjectPage?(i={id:this.property},this.listToTree(a,t,i,n),t):(i=a.find((function(t){return t.id===e.assetsId||t.identifier===e.assetsIdentifier})))?(this.listToTree(a,t,i,n),n(i)?[Y(Y({},i),{},{children:t})]:t):[]},selectedLength:function(){var e,t,a,i;return null===(e=this.editVal)||void 0===e||null===(t=e.measuringSelected)||void 0===t||null===(a=t[null===(i=this.currentNode)||void 0===i?void 0:i.id])||void 0===a?void 0:a.length},responseFields:function(){return"actualTime"===this.editVal.queryType?[{identifier:"id",name:"唯一标识"},{identifier:"name",name:"名称"},{identifier:"type",name:"类型"},{identifier:"updateTime",name:"更新时间",type:"DateTime"},{identifier:"value",name:"值"},{identifier:"identifier",name:"标识符"}]:this.isIndicatorEditor?this.indicatorFields.map((function(e){return{identifier:e,name:e}})):[{identifier:"id",name:"唯一标识"},{identifier:"instanceId",name:"测点ID"},{identifier:"collectTime",name:"采集时间",type:"DateTime"},{identifier:"collectTimeFormat",name:"格式化采集时间",type:"DateTime"},{identifier:"dataIdentifier",name:"数据标识"},{identifier:"dataValue",name:"测点值"},{identifier:"deviceIdentifier",name:"设备标识"},{identifier:"ruleIdentifier",name:"采集规则标识"},{identifier:"groupIdentifier",name:"分组标识"},{identifier:"archiveDate",name:"归档时间",type:"DateTime"},{identifier:"archiveDateFormat",name:"格式化归档时间",type:"DateTime"},{identifier:"quality",name:"数据品质"}]},responseDescription:function(){return this.isIndicatorEditor?"响应数据字段可使用函数过滤，例timeFormat(updateTime::year::1)，字段列表如下：":""},formData:function(){return this.isRTEditor?this.editVal.rtEditor:this.isIndicatorEditor?this.editVal.indicatorEditor:this.editVal},hiddenConfig:function(){return{pagination:!0}},measuringSelected:function(){return this.editVal.measuringSelected||{}},projectId:function(){return Object(c.h)(window.location.href,"projectId")},assetsId:function(){return Object(c.h)(window.location.href,"assetsId")},isProjectPage:function(){return Object(c.h)(window.location.href,"isProjectPage")},projectIdentifier:function(){return Object(c.h)(window.location.href,"projectIdentifier")},assetsIdentifier:function(){return Object(c.h)(window.location.href,"assetsIdentifier")},property:function(){return Object(c.h)(window.location.href,"property")},isDevice:function(){return"device"===this.activeView},isUnDevice:function(){return"unDevice"===this.activeView},isStatic:function(){return"static"===this.editVal.actualTimeType},isDynamic:function(){return"dynamic"===this.editVal.actualTimeType},isRTEditor:function(){return"history"===this.editVal.queryType&&["collect","calculate","manual"].includes(this.editVal.historyType)},indicatorList:function(){var e,t,a;return this.isIndicatorEditor||this.propSelected.some((function(e){return 3==+(null==e?void 0:e.propertyType)}))?null===(e=this.editVal)||void 0===e||null===(t=e.indicatorEditor)||void 0===t||null===(a=t.assistAttr)||void 0===a?void 0:a.tableData:[]},isIndicatorEditor:function(){return"history"===this.editVal.queryType&&"indicator"===this.editVal.historyType},isComplexArray:function(){return this.data.type.toLowerCase().indexOf("complex[")>-1},indicatorTypeItemVisible:function(){return this.isComplexArray?[1,2,4,5]:[3]}}),created:function(){},methods:{emitFieldsSelect:function(){this.$emit("fieldsChange",this.responseFields)},initData:function(){var e=this;return Object(n.a)(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=3,e.$store.dispatch("initDictOptions");case 3:return t.next=5,e.$store.dispatch("setLinkEditorTips","assets");case 5:return e.resetEditorVal(),e.commonInitData("assets"),t.next=9,e.getAssetsData();case 9:return t.next=11,e.formatData();case 11:case"end":return t.stop()}}),t)})))()},formatData:function(){var e=this;return Object(n.a)(s.a.mark((function t(){var a,i,n,r,o,l,c;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null!=(a=e.data.linkConfig)&&a.queryType&&(e.handleTabClick({name:a.queryType},!0),"history"===a.queryType&&null!=a&&a.historyType&&e.handleHistoryTypeChange(a.historyType,!1,!0)),null==a||!a.requestPayload){t.next=11;break}if(i=a.requestPayload,n=i.assetId,r=i.identifier,o=i.properties,!(l=e.assetsList.find((function(e){return e.id===n||e.identifier===r})))){t.next=11;break}return t.next=8,e.handleNodeClick(l,!0);case 8:return c=Object(z.a)(o),t.next=11,e.initSelected(c);case 11:case"end":return t.stop()}}),t)})))()},initSelected:function(e){var t=this;return Object(n.a)(s.a.mark((function a(){return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return t.propSelected=e.filter((function(e){return"measuringPoint"!==e.type})),a.next=3,t.doPropertySelected(t.propSelected);case 3:case"end":return a.stop()}}),a)})))()},doPropertySelected:function(e){var t=this;return Object(n.a)(s.a.mark((function a(){var i;return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(!(i=t.$refs.assetsTable)){a.next=6;break}return a.next=4,i.$nextTick();case 4:return a.next=6,i.handleSelected(e);case 6:case"end":return a.stop()}}),a)})))()},refreshIndicators:function(){this.syncIndicator(this.propSelected)},syncIndicator:function(e){var t=this;return Object(n.a)(s.a.mark((function a(){var i,n;return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return t.syncIndicatorLoading=!0,a.next=3,t.fetchIndicators(e.map((function(e){return e.indicatorIdentifier})));case 3:i=a.sent,t.syncIndicatorLoading=!1,n=i.map((function(e){var a,i;return{id:e.id,name:e.name,rowInfo:e,isDynamic:!(null===(a=(t.editVal.indicatorEditor.assistAttr.tableData||[]).find((function(t){return t.id===e.id})))||void 0===a||!a.isDynamic),selected:(null===(i=(t.editVal.indicatorEditor.assistAttr.tableData||[]).find((function(t){return t.id===e.id})))||void 0===i?void 0:i.selected)||[]}})),t.editVal.indicatorEditor.assistAttr.tableData=n,t.onIndicatorChange(n);case 8:case"end":return a.stop()}}),a)})))()},onIndicatorChange:function(e){var t,a,i,n=e||(null==this||null===(t=this.editVal)||void 0===t||null===(a=t.indicatorEditor)||void 0===a||null===(i=a.assistAttr)||void 0===i?void 0:i.tableData)||[],r=[];n.forEach((function(e){Object.keys((null==e?void 0:e.rowInfo)||{}).forEach((function(e){e.startsWith("expands.")||r.push(e)}))}));var o=r.length?["value"].concat(r):r;this.indicatorFields=Array.from(new Set(o))},onPropSelectedChange:function(e){if(this.isDevice){var t=this.currentNode.id;this.isComplexArray?this.editVal.measuringSelected=Y(Y({},this.measuringSelected),{},Object(o.a)({},t,e)):(this.propSelected=[],this.isIndicatorEditor&&this.syncIndicator([]),this.editVal.measuringSelected[t]=e)}else this.editVal.measuringSelected={},this.propSelected=e,this.isIndicatorEditor?this.syncIndicator(e):e.some((function(e){return 3==+(null==e?void 0:e.propertyType)}))&&this.syncIndicator(e.filter((function(e){return 3==+(null==e?void 0:e.propertyType)}))||[],!0)},handlePropertiesChange:function(e){this.editVal.requestPayload.properties=e},handleViewChange:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Object(n.a)(s.a.mark((function i(){var n;return s.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(a||(t.tablePagination.page=1),t.activeView=e,"device"!==e){i.next=9;break}return i.next=5,t.getAssetsInnerData(t.currentNode);case 5:return i.next=7,t.doPropertySelected(t.measuringSelected[null===(n=t.currentNode)||void 0===n?void 0:n.id]||[]);case 7:i.next=13;break;case 9:return i.next=11,t.getAssetPropData(t.currentNode);case 11:return i.next=13,t.doPropertySelected(t.propSelected);case 13:case"end":return i.stop()}}),i)})))()},handleHistoryTypeChange:function(e){var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.editVal.historyType=e,t||this.onPropSelectedChange([]),this.getAssetHistoryData(this.currentNode)},handleActualTimeTypeChange:function(e){this.editVal.actualTimeType=e,"static"===e?this.handlePropertiesChange([{id:"",type:"",name:""}]):this.onPropSelectedChange([])},onPaginationChange:function(e){this.tablePagination.page=e.page,this.tablePagination.pageSize=e.pageSize,this.handleViewChange(this.activeView,!0)},getAssetPropData:function(e){var t=this;return Object(n.a)(s.a.mark((function a(){var i;return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.fetchProperty(null==e?void 0:e.identifier);case 2:i=a.sent,t.tableData=(null==i?void 0:i.result)||[],(null==i?void 0:i.pageInfo)&&(t.tablePagination=i.pageInfo);case 5:case"end":return a.stop()}}),a)})))()},handleHistoryParamsChange:function(e){this.historyTypeParams=Y(Y({},this.historyTypeParams),e)},resetHistoryParams:function(){this.historyTypeParams={name:"",identifier:"",propertyType:"",labels:""}},getAssetHistoryData:function(e){var t=this;return Object(n.a)(s.a.mark((function a(){var i;return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return t.handleHistoryParamsChange({propertyType:t.editVal.historyType}),a.next=3,t.fetchProperty(e.identifier);case 3:i=a.sent,t.tableData=(null==i?void 0:i.result)||[],(null==i?void 0:i.pageInfo)&&(t.tablePagination=i.pageInfo);case 6:case"end":return a.stop()}}),a)})))()},getAssetsInnerData:function(e){var t=this;return Object(n.a)(s.a.mark((function a(){var i;return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(null!=e&&e.regCodeIdentifier){a.next=3;break}return t.tableData=[],a.abrupt("return");case 3:return a.next=5,t.fetchProperty(null==e?void 0:e.regCodeIdentifier,{name:"",identifier:"",propertyType:"",labels:""});case 5:i=a.sent,t.tableData=((null==i?void 0:i.result)||[]).map((function(e){return Y(Y({},e),{},{propertyType:"5"})})),(null==i?void 0:i.pageInfo)&&(t.tablePagination=i.pageInfo);case 8:case"end":return a.stop()}}),a)})))()},ranNum:function(e,t){return Math.floor(Math.random()*(t-e+1)+e)},handleTabClick:function(e){var t=e.name,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.editVal.queryType=t,"history"===t?(this.editVal.actualTimeType="static",this.handleHistoryTypeChange(this.editVal.historyType,!1,a)):(this.resetHistoryParams(),this.onPropSelectedChange([])),this.getAssetPropData(this.currentNode)},clearProperties:function(){delete this.measuringSelected[this.currentNodeId],this.propSelected=[]},handleNodeClick:function(e,t){var a=this;return Object(n.a)(s.a.mark((function i(){var n;return s.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(!0!==t&&a.currentNodeId!==e.id&&a.clearProperties(),a.currentNodeId=e.id,a.currentNode=e,a.deviceName=e["regCode.name"]||"",!a.isUnDevice){i.next=11;break}return i.next=7,a.getProfileProperties(e);case 7:return i.next=9,a.getAssetPropData(e);case 9:i.next=15;break;case 11:return i.next=13,a.getAssetsInnerData(a.currentNode);case 13:return i.next=15,a.doPropertySelected(a.measuringSelected[null===(n=a.currentNode)||void 0===n?void 0:n.id]||[]);case 15:case"end":return i.stop()}}),i)})))()},clearValidate:function(e){null!=e&&e.length?this.$refs.form.clearValidate(e):this.$refs.form.clearValidate()},setProfileInfo:function(e,t){this.profileInfo={identifier:e.identifier,company:e.identifier,description:e.description},this.profileProperties=t.map((function(t){return{name:t.propertyLocalName,prop:t.propertyName,value:e[t.propertyName]}}))},getProfileProperties:function(e){var t=this;return Object(n.a)(s.a.mark((function a(){var i,n,r,o;return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.fetchProfiles(e.objectType);case 2:if(i=a.sent,1!==(null==(n=null==i?void 0:i.result)?void 0:n.length)){a.next=10;break}return r=n[0],a.next=8,t.fetchProfileProperties(null==r?void 0:r.id);case 8:o=a.sent,t.setProfileInfo(e,o);case 10:case"end":return a.stop()}}),a)})))()},getEdgeDevice:function(e){return[{"icon-suffix-online":e.isOnline,"icon-suffix-offline":!e.isOnline}]},getAssetsData:function(){var e=this;return Object(n.a)(s.a.mark((function t(){var a,i,n,r;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.fetchProjectInfo();case 2:if(null==(a=t.sent)||!a.id){t.next=13;break}return e.projectName=null==a?void 0:a.name,t.next=7,e.fetchModels();case 7:return i=t.sent,n=i.map((function(e){return e.identifier})),t.next=11,e.fetchAssets(n.join(","));case 11:r=t.sent,e.assetsList=r.map((function(e){return Y(Y({},e),{},{isOnline:1===e.onlineStatus,regCode:!!e.regCode})}));case 13:case"end":return t.stop()}}),t)})))()},listToTree:function(e,t,a,i){var n=this;e.forEach((function(r){if(r.parentId===a.id){var o=Y(Y({},r),{},{children:[]});n.listToTree(e,o.children,r),o.children.length<=0&&delete o.children,"function"==typeof i?i(o)&&t.push(o):t.push(o)}}))},fetchIndicators:function(e){var t=this;return Object(n.a)(s.a.mark((function a(){var i;return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(i=[],null==e||!e.length){a.next=4;break}return a.next=4,t.$util.request({url:"/api/model/instances",method:"get",params:{objectType:"MEAS_INDICATOR",queryMode:"simple",pagination:0,$orderBy:"createTime desc",$filter:"identifier eq ".concat(e.join("::")),projectIdentifier:"".concat(t.projectIdentifier)}}).then((function(e){i=e})).catch((function(e){}));case 4:return a.abrupt("return",i);case 5:case"end":return a.stop()}}),a)})))()},fetchProjectInfo:function(){var e=this;return Object(n.a)(s.a.mark((function t(){var a;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a={},!e.projectId){t.next=4;break}return t.next=4,e.$util.request({url:"/api/model/instances/".concat(e.projectId),method:"get"}).then((function(e){a=e})).catch((function(e){}));case 4:return t.abrupt("return",a);case 5:case"end":return t.stop()}}),t)})))()},fetchResourceInfo:function(e){var t=this;return Object(n.a)(s.a.mark((function a(){var i;return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(i={},!e){a.next=4;break}return a.next=4,t.$util.request({url:"/api/resource-tree/projects/".concat(e),method:"get"}).then((function(e){i=e})).catch((function(e){}));case 4:return a.abrupt("return",i);case 5:case"end":return a.stop()}}),a)})))()},fetchModels:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"IOT_MODEL",a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2?arguments[2]:void 0;return Object(n.a)(s.a.mark((function n(){var r;return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=[],!t){n.next=4;break}return n.next=4,e.$util.request({url:"/api/model/instances",method:"get",params:{objectType:t,$filter:"pathName leftlike ".concat(a).concat(i?",status ne ".concat(i):""),pagination:0,$orderBy:"createTime desc"}}).then((function(e){r=e})).catch((function(e){}));case 4:return n.abrupt("return",r);case 5:case"end":return n.stop()}}),n)})))()},fetchAssets:function(e,t){var a=this;return Object(n.a)(s.a.mark((function i(){var n,r,o,l;return s.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(n=[],!e){i.next=10;break}return i.next=4,a.$util.request({url:"/api/thing-model/instances/query-profiles",method:"post",data:{objectTypeList:e.split(",")}});case 4:return r=i.sent,o=Object(g.n)((r||[]).map((function(e){return e.identifier}))),l=[],o.forEach((function(e){l.push(new Promise((function(i,n){var r=e.join(",");a.$util.request({url:"/api/model/instances",method:"get",params:null!=t?t:{objectType:r,pagination:0,$filter:"status eq 1",$orderBy:"updateTime desc",accessMethod:"foreign_key",relationProperties:"name"}}).then((function(e){i(e)})).catch((function(){i([])}))})))})),i.next=10,Promise.all(l).then((function(e){n=Object(g.m)(e)}));case 10:return i.abrupt("return",n);case 11:case"end":return i.stop()}}),i)})))()},fetchProfiles:function(e){var t=this;return Object(n.a)(s.a.mark((function a(){var i;return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(i=[],!e){a.next=4;break}return a.next=4,t.$util.request({url:"/api/model/profiles",method:"get",params:{$filter:"identifier eq ".concat(e)}}).then((function(e){i=e})).catch((function(e){}));case 4:return a.abrupt("return",i);case 5:case"end":return a.stop()}}),a)})))()},fetchProfileProperties:function(e){var t=this;return Object(n.a)(s.a.mark((function a(){var i;return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(i=[],!e){a.next=4;break}return a.next=4,t.$util.request({url:"/api/model/profiles/".concat(e,"/properties"),method:"get",params:{$filter:"status eq 1",pagination:0,inherit:"custom",$orderBy:"createTime desc"}}).then((function(e){i=e})).catch((function(e){}));case 4:return a.abrupt("return",i);case 5:case"end":return a.stop()}}),a)})))()},fetchProperty:function(e,t){var a=this;return Object(n.a)(s.a.mark((function i(){var n,r,o,l,c,u,d,p,h,f,m,v,b;return s.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(n={},!e){i.next=8;break}return o=t||a.historyTypeParams,l=o.name,c=void 0===l?"":l,u=o.identifier,d=void 0===u?"":u,p=o.propertyType,h=void 0===p?"":p,f=o.labels,m=void 0===f?"":f,v=Object(z.c)(a.propertyTypeMap),b=null!==(r=v[h])&&void 0!==r?r:"","history"!==a.editVal.queryType&&(b=Object.keys(a.propertyTypeMap).filter((function(e){return"5"!==e})).join("::")),i.next=8,a.$util.request({url:"/api/thing-model/instances/".concat(e,"/properties"),method:"get",params:{$page:a.tablePagination.page,$pageSize:a.tablePagination.pageSize,$filter:"name eq ".concat(c,",identifier eq ").concat(d,",propertyType eq ").concat(b,",labels em ").concat(m,",configFlag eq 1")}}).then((function(e){n=e})).catch((function(e){}));case 8:return i.abrupt("return",n);case 9:case"end":return i.stop()}}),i)})))()},handleAssetsClick:function(){this.$setAttr(this.data,"editorDialogVisible",!0),this.dialogVisible=!0},onClose:function(){var e;this.closeHandler("assets"),null===(e=this.$refs.assetsTable)||void 0===e||e.clearSelection()},handleClear:function(){this.clearByType("assets")},resetEditorVal:function(){this.editVal={accessType:"assets",linkType:this.linkType,url:"/api/indicator/values/aggregation",method:"post",contentType:"application/json",pagination:0,defaultLoad:!0,fields:"",historyType:"collect",queryType:"actualTime",actualTimeType:"static",measuringSelected:{},requestPayload:{assetId:"",deviceId:"",properties:[{id:"",type:"",name:""}]},rtEditor:{accessType:"rtdata",linkType:this.linkType,url:"/api/realtimedata/records",method:"get",contentType:"application/json",objectType:"",rtDataType:2,requestPayload:{instanceId:"",queryDirection:1,querySize:this.isComplexArray?1e3:1,$orderBy:"collectTime asc",collectTime:"",queryMode:1,$filter:"",objectType:"",queryType:1,beginTime:"",endTime:"",recordType:1},variableEditData:{instanceIdData:{name:"instanceId",value:"",editValue:null},collectTimeData:{name:"collectTime",value:"",editValue:null},beginTimeData:{name:"beginTime",value:"",editValue:null},endTimeData:{name:"endTime",value:"",editValue:null}},responseSchema:{},exceptionStrategy:"throw",showIdTable:!0,filterItems:[{name:"",value:"",filter:"",editValue:""}],tableData:[]},indicatorEditor:{accessType:"indicator",linkType:this.linkType,url:"/api/indicator/values/aggregation",method:"post",contentType:"application/json",fields:"",dataType:"",requestPayload:{indicatorIds:"",queryLatest:1,timeRangeType:"fixed",queryType:"",updateTimeBegin:"",updateTimeEnd:"",relativeTime:"",dimensionTime:"",aggOperation:"",sortOperation:"",cmpOperation:"",precision:"",filters:"",valueFilter:""},variableEditData:{indicatorIdsData:{name:"indicatorIds",value:"",editValue:null},updateTimeBeginData:{name:"updateTimeBegin",value:"",editValue:null},updateTimeEndData:{name:"updateTimeEnd",value:"",editValue:null},dimensionTimeData:{name:"dimensionTime",value:"",editValue:null},compareTimeData:{name:" compareTime",value:"",editValue:null},parentIdData:{name:" parentId",value:"",editValue:null},timeDimensionData:{name:" timeDimension",value:"",editValue:null},projectData:{name:"project",value:"",editValue:null},valueData:{name:"value",value:"",editValue:null}},assistAttr:{relativeType:"current",relativeNumber:1,timeDimension:"",orderNumber:1,orderType:"asc",compareType:"M2M",compareNumber:1,isNow:!1,compareTime:"",tableData:[{id:this.$util.uuid(),rowInfo:{},isDynamic:!1,selected:[]}],extraFilter:"",timeDimensionFilter:"",parentIdFilter:"",projectFilter:"",dimensionTimeFilter:"",valueFilterOperator:"",valueFilter:""},responseSchema:{},exceptionStrategy:"throw"},variableEditData:{properties:{name:"properties",value:"",editValue:null}}}},resetData:function(){this.resetEditorVal(),this.commonResetData()},validate:function(){return!0},getHandlerEditVal:function(){var e,t,a,n=Object(c.e)(this.editVal),r=this.propSelected,o=null==n?void 0:n.measuringSelected[this.currentNode.id];null!=o&&o.length&&(r=[].concat(Object(i.a)(r),Object(i.a)(o.map((function(e){return Y(Y({},e),{},{propertyType:"5"})})))));var l=z.b.call(this,r),s="dynamic"===n.actualTimeType;return n.requestPayload={assetId:this.currentNode.id,identifier:this.currentNode.identifier,deviceId:this.currentNode.edgeCode,filters:(null==n||null===(e=n.requestPayload)||void 0===e?void 0:e.filters)||"",properties:s?null==n||null===(t=n.variableEditData)||void 0===t||null===(a=t.properties)||void 0===a?void 0:a.value:l},n},syncTableToProps:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.indicatorList||[],a=[],i=[],n={};for(var r in t.forEach((function(e){e.isDynamic?((null==e?void 0:e.selected)||[]).forEach((function(t){n[t]?n[t].push(e.rowInfo[t]):n[t]=[e.rowInfo[t]]})):a.push(e.rowInfo.id)})),n){var o=n[r].join("::");o&&i.push("".concat(r," eq ").concat(o))}var l=a.join(","),s=i.length?"$filter="+i.join(","):"";e?(this.editVal.indicatorEditor.requestPayload.indicatorIds=l,this.editVal.indicatorEditor.requestPayload.filters=s):this.editVal.requestPayload.filters=s},refreshEditValPayload:function(){var e,t;"current"===this.editVal.indicatorEditor.assistAttr.relativeType&&(this.editVal.indicatorEditor.assistAttr.relativeNumber=1);var a=this.editVal.indicatorEditor.assistAttr,i=a.relativeType,n=a.relativeNumber,r=a.timeDimension,o=a.orderNumber,l=a.orderType,s=a.compareType,c=a.compareNumber,u=a.isNow,d=a.compareTime,p=a.dimensionTimeFilter,h=i?"".concat(i,":").concat(n,":").concat(r):"";this.editVal.indicatorEditor.requestPayload.relativeTime=h;var f=o?"".concat(o,":").concat(l):"";this.editVal.indicatorEditor.requestPayload.sortOperation=f;var m=u?"now":d,v=s?"".concat(s,":").concat(c,":").concat(m):"";this.editVal.indicatorEditor.requestPayload.cmpOperation=v;var b=this.editVal.indicatorEditor.variableEditData,g=b.updateTimeBeginData,y=b.updateTimeEndData;this.editVal.indicatorEditor.requestPayload.dimensionTime=p,this.editVal.indicatorEditor.requestPayload.updateTimeBegin=null!==(e=g.value)&&void 0!==e?e:"",this.editVal.indicatorEditor.requestPayload.updateTimeEnd=null!==(t=y.value)&&void 0!==t?t:"","fixed"===this.editVal.indicatorEditor.requestPayload.timeRangeType?this.editVal.indicatorEditor.requestPayload.relativeTime="":"relative"===this.editVal.indicatorEditor.requestPayload.timeRangeType&&(this.editVal.indicatorEditor.requestPayload.dimensionTime="",this.editVal.indicatorEditor.requestPayload.updateTimeBegin="",this.editVal.indicatorEditor.requestPayload.updateTimeEnd="")},additionalFilter:function(){var e=this.editVal.indicatorEditor.assistAttr.extraFilter;e&&(this.editVal.indicatorEditor.requestPayload.filters?this.editVal.indicatorEditor.requestPayload.filters=this.editVal.indicatorEditor.requestPayload.filters+","+e:this.editVal.indicatorEditor.requestPayload.filters="$filter=".concat(e))},staticParamFilter:function(){var e=this,t=this.editVal.indicatorEditor.assistAttr;[{name:"parentId",value:t.parentIdFilter},{name:"timeDimension",value:t.timeDimensionFilter},{name:"indicatorItemId",value:t.projectFilter}].forEach((function(t){t&&null!=t&&t.value&&(e.editVal.indicatorEditor.requestPayload.filters?e.editVal.indicatorEditor.requestPayload.filters=e.editVal.indicatorEditor.requestPayload.filters+","+"".concat(t.name," eq ").concat(t.value):e.editVal.indicatorEditor.requestPayload.filters="$filter=".concat(t.name," eq ").concat(t.value))}))},cleanData:function(){var e=this.editVal.requestPayload,t=e.queryType,a=e.timeRangeType;switch(t){case"1":this.editVal.requestPayload.aggOperation="",this.editVal.requestPayload.sortOperation="",this.editVal.requestPayload.cmpOperation="",this.editVal.requestPayload.updateTimeBegin="",this.editVal.requestPayload.updateTimeEnd="","fixed"===a?this.editVal.requestPayload.relativeTime="":"relative"===a&&(this.editVal.requestPayload.dimensionTime="");break;case"2":this.editVal.requestPayload.aggOperation="",this.editVal.requestPayload.sortOperation="",this.editVal.requestPayload.cmpOperation="",this.editVal.requestPayload.dimensionTime="","fixed"===a?this.editVal.requestPayload.relativeTime="":"relative"===a&&(this.editVal.requestPayload.updateTimeBegin="",this.editVal.requestPayload.updateTimeEnd="");break;case"3":this.editVal.requestPayload.sortOperation="",this.editVal.requestPayload.cmpOperation="",this.editVal.requestPayload.dimensionTime="","fixed"===a?this.editVal.requestPayload.relativeTime="":"relative"===a&&(this.editVal.requestPayload.updateTimeBegin="",this.editVal.requestPayload.updateTimeEnd="");break;case"4":this.editVal.requestPayload.aggOperation="",this.editVal.requestPayload.cmpOperation="",this.editVal.requestPayload.dimensionTime="","fixed"===a?this.editVal.requestPayload.relativeTime="":"relative"===a&&(this.editVal.requestPayload.updateTimeBegin="",this.editVal.requestPayload.updateTimeEnd="");break;case"5":this.editVal.requestPayload.aggOperation="",this.editVal.requestPayload.sortOperation="",this.editVal.requestPayload.dimensionTime="",this.editVal.requestPayload.updateTimeBegin="",this.editVal.requestPayload.updateTimeEnd=""}},getTimeStamp:function(e){return new Date(e).valueOf()},handleSubmit:function(){var e=this;return Object(n.a)(s.a.mark((function t(){var a;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.isIndicatorEditor||void 0!==e.editVal.indicatorEditor.requestPayload.queryType&&""!==e.editVal.indicatorEditor.requestPayload.queryType){t.next=3;break}return e.$message.warning("请配置查询配置"),t.abrupt("return",!1);case 3:return t.next=5,e.$refs.form.validate((function(t){if(t){if("history"===e.editVal.queryType&&"indicator"===e.editVal.historyType){if(e.syncTableToProps(),e.refreshEditValPayload(),e.additionalFilter(),e.staticParamFilter(),e.cleanData(),e.editVal.indicatorEditor.requestPayload.updateTimeEnd&&e.editVal.indicatorEditor.requestPayload.updateTimeBegin){var i=e.getTimeStamp(e.editVal.indicatorEditor.requestPayload.updateTimeEnd),n=e.getTimeStamp(e.editVal.indicatorEditor.requestPayload.updateTimeBegin);if("number"==typeof i&&"number"==typeof n&&!window.isNaN(i)&&!window.isNaN(n)&&n>i)return void e.$message({type:"error",message:"开始时间需要早于结束时间"})}if(!e.editVal.indicatorEditor.requestPayload.queryType)return void e.$message({type:"error",message:"请设置“查询配置”"})}a=e.commonSureHandlerCustom("assets")}}));case 5:return t.abrupt("return",a);case 6:case"end":return t.stop()}}),t)})))()},commonSureHandlerCustom:function(e){var t=this.validate();if(!0===t){var a=this.getHandlerEditVal();return this.commonLinkSet.fields=this.commonLinkSet.fields.replaceAll("，",","),this.commonLinkSet.fields=this.commonLinkSet.fields.replaceAll(" ",""),a=Y(Y({},a),this.commonLinkSet)}this.$message.warning(t)}}},Q=(a("dfcf"),a("b0f5"),Object(f.a)(Z,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"assets-link-editor"},[t("assets-header",{attrs:{activeView:e.activeView,profileInfo:e.profileInfo,profileProperties:e.profileProperties,currentNode:e.currentNode,queryType:e.editVal.queryType,historyType:e.editVal.historyType,deviceName:e.deviceName,actualTimeType:e.editVal.actualTimeType,types:e.types,editVal:e.editVal,selectedLength:e.selectedLength},on:{"tab-click":e.handleTabClick,"view-change":e.handleViewChange,"history-type-change":e.handleHistoryTypeChange,"actualTime-type-change":e.handleActualTimeTypeChange}}),t("el-collapse",{staticClass:"assets-table-collapse t-border",attrs:{value:"table",accordion:""}},[t("el-collapse-item",{attrs:{name:"table"}},[t("template",{slot:"title"},[t("div",{staticClass:"data-source-editor-collapse-title"},[t("div",[t("span",[e._v("测点配置")]),t("basic-tips",{attrs:{type:"popover",title:"配置说明",width:600,placement:"bottom-start",iconStyle:{color:"#C9D0D4"},content:""}},[t("div",[t("div",[e._v("配置使用测点")])])])],1)])]),e.isStatic?t("assets-table",{ref:"assetsTable",attrs:{"multiple-selection":e.isDevice?e.measuringSelected[e.currentNodeId]:e.propSelected,data:e.tableData,pagination:e.tablePagination,types:e.types,propertyTypeMap:e.propertyTypeMap,deviceName:e.deviceName,isSingleSelect:!e.isComplexArray},on:{selectionChange:e.onPropSelectedChange,paginationChange:e.onPaginationChange}}):e._e(),e.isDynamic?t("assets-dynamic",{staticClass:"assets-dynamic",attrs:{editVal:e.editVal},on:{"properties-change":e.handlePropertiesChange}}):e._e()],2)],1),e._e(),t("el-form",{ref:"form",attrs:{"label-width":"150px",model:e.formData}},[e.isRTEditor?t("editor-collapse",{staticClass:"link-editor-collapse",attrs:{title:"历史数据"}},[t("history-setting",{attrs:{editVal:e.editVal.rtEditor,hideQuerySize:!e.isComplexArray,"query-types-show":e.isComplexArray?7:3}})],1):e._e(),e.isIndicatorEditor||this.hasIndicator?[t("editor-collapse",{staticClass:"link-editor-collapse",attrs:{title:"指标配置"}},[t("assets-indicator-table",{directives:[{name:"loading",rawName:"v-loading",value:e.syncIndicatorLoading,expression:"syncIndicatorLoading"}],attrs:{list:e.indicatorList,updateList:e.refreshIndicators},on:{indicatorChange:e.onIndicatorChange}}),e.indicatorList.length?e._e():t("div",{staticClass:"assets-indicator-empty t-text-placeholder t-border__top"},[e._v("请先选择资产属性")])],1),e.isIndicatorEditor?t("editor-collapse",{staticClass:"link-editor-collapse",attrs:{title:"查询配置"}},[t("param-setting",{attrs:{editVal:e.editVal.indicatorEditor,listItemVisible:e.indicatorTypeItemVisible},on:{clearValidate:e.clearValidate}})],1):e._e(),e.isIndicatorEditor?t("editor-collapse",{staticClass:"link-editor-collapse",attrs:{title:"筛选项"}},[t("filter-setting",{attrs:{editVal:e.editVal.indicatorEditor}})],1):e._e()]:e._e()],2)],1)}),[],!1,null,"60128722",null)).exports,X=a("56b1"),ee=a("643b"),te=a("d45e"),ae=a("8b41"),ie=a("2401"),ne={name:"TemplateHeader",components:{MoreInfo:a("5b6c").a},props:{activeView:{type:String,default:""},currentNode:{type:Object,default:function(){return{}}},profileProperties:{type:Array,default:function(){return[]}},profileInfo:{type:Object,default:function(){return{}}},deviceName:{type:String,default:""},queryType:{type:String,default:""},actualTimeType:{type:String,default:""},historyType:{type:String,default:""},selectedLength:{type:Number,default:0},types:{type:Object,default:function(){return{}}},editVal:{type:Object,default:function(){return{}}}},data:function(){return{collapse:!0,moreInfoProp:{},actualTimeTypes:[{key:"static",value:"静态"},{key:"indicator",value:"指标"},{key:"dynamic",value:"动态"}]}},computed:{isDevice:function(){return"device"===this.activeView},isUnDevice:function(){return"unDevice"===this.activeView},currentAssetClass:function(){return["template-header-title",{"t-text-placeholder":!this.currentNode.name,"t-text-primary":this.currentNode.name}]},moreInfoClass:function(){return this.collapse?"el-icon-arrow-down":"el-icon-arrow-up"},historyTypes:function(){var e=this;return Object.keys(this.types).filter((function(e){return["collect","calculate","indicator"].includes(e)})).map((function(t){return{key:t,value:e.types[t]}}))}},filters:{templateTitle:function(e){return e||"请选择模板"},deviceStatus:function(e){return e?"在线":"离线"}},methods:{handleMoreInfoClick:function(){this.collapse=!this.collapse},handleViewChange:function(e){this.$emit("view-change",e)},handleTabClick:function(e){this.$emit("tab-click",e)},handleHistoryTypeChange:function(e){this.$emit("history-type-change",e)},handleActualTimeTypeChange:function(e){this.$emit("actualTime-type-change",e)}}},re=(a("a6a7"),a("8e41"),Object(f.a)(ne,(function(){var e=this,t=e._self._c;return t("div",[e.isUnDevice?[t("div",{staticClass:"template-property-header"},[t("div",{staticClass:"header-title"},[t("div",{staticClass:"template-header-wrapper"},[t("span",{class:e.currentAssetClass},[e._v(e._s(e._f("templateTitle")(e.currentNode.name)))]),e._e()],1),e.currentNode.name?t("div",{staticClass:"template-header-description t-text-regular"},[t("span",[e._v("【"+e._s(e.currentNode.identifier)+"】")])]):e._e()]),!e.deviceName||"history"===e.queryType&&"indicator"===e.historyType?e._e():t("div",{staticClass:"header-device-select t-text-regular"},[e._v("已选择"),t("em",{staticClass:"t-color-primary"},[e._v(e._s(e.selectedLength))]),e._v("条内置测点")]),!e.deviceName||"history"===e.queryType&&"indicator"===e.historyType?e._e():t("div",{staticClass:"header-device t-border",on:{click:function(t){return e.handleViewChange("device")}}},[t("el-tag",{attrs:{size:"mini","disable-transitions":!0,type:e.currentNode.isOnline?"success":"info"}},[e._v(e._s(e._f("deviceStatus")(e.currentNode.isOnline)))]),t("span",{staticClass:"t-color-primary",staticStyle:{margin:"0 6px 0 4px"}},[e._v(e._s(e.deviceName))]),t("i",{staticClass:"el-icon-arrow-right"})],1)]),e.collapse?e._e():t("div",[t("more-info",{staticClass:"template-more-info",attrs:{list:e.profileProperties,prop:e.moreInfoProp,span:8}})],1),t("el-tabs",{on:{"tab-click":e.handleTabClick},model:{value:e.queryType,callback:function(t){e.queryType=t},expression:"queryType"}},[t("el-tab-pane",{attrs:{label:"实时数据",name:"actualTime"}},[t("el-radio-group",{staticClass:"template-history-type",attrs:{size:"mini"},on:{input:e.handleActualTimeTypeChange},model:{value:e.actualTimeType,callback:function(t){e.actualTimeType=t},expression:"actualTimeType"}},e._l(e.actualTimeTypes,(function(a){return t("el-radio-button",{key:a.key,attrs:{label:a.key}},[e._v(e._s(a.value))])})),1)],1),t("el-tab-pane",{attrs:{label:"历史数据",name:"history"}},[t("el-radio-group",{staticClass:"template-history-type",attrs:{size:"mini"},on:{input:e.handleHistoryTypeChange},model:{value:e.historyType,callback:function(t){e.historyType=t},expression:"historyType"}},e._l(e.historyTypes,(function(a){return t("el-radio-button",{key:a.key,attrs:{label:a.key}},[e._v(e._s(a.value))])})),1)],1)],1)]:e._e(),e.isDevice?[t("div",{staticClass:"template-device-title",on:{click:function(t){return e.handleViewChange("unDevice")}}},[t("el-icon",{staticClass:"el-icon-arrow-left title-icon"}),t("span",{staticClass:"title-name"},[e._v(e._s(e._f("templateTitle")(e.currentNode.name))+" / "+e._s(e.deviceName))]),t("el-tag",{attrs:{size:"mini","disable-transitions":!0,type:e.currentNode.isOnline?"success":"info"}},[e._v(e._s(e._f("deviceStatus")(e.currentNode.isOnline)))])],1)]:e._e()],2)}),[],!1,null,"f12d1f72",null)).exports,oe=a("e021");function le(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function se(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?le(Object(a),!0).forEach((function(t){Object(o.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):le(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var ce={name:"TemplatesThingModel",alias:"模板",command:"templates-link",mixins:[A.a],components:{TemplateDynamic:oe.a,TemplateHeader:re,HistorySetting:ae.a,TemplateTable:ee.a,TemplateCollapse:X.a,TemplateIndicatorTable:te.a,EditorCollapse:D.a,ParamSetting:q.a,FilterSetting:B.a},props:{visible:{type:String,default:function(){return!1}},linkType:{type:Number,default:function(){return 1}},handleChangeResult:{type:Function,default:function(){}},data:{type:Object,default:function(){return{alias:"",type:"",default:"",value:""}}}},data:function(){return{showVal:"",showCloseTips:JSON.parse(localStorage.getItem("link-tips-templates")),searchName:"",dialogVisible:this.visible,projectName:"",deviceName:"",activeView:"unDevice",currentNode:{},currentNodeId:"",syncIndicatorLoading:!1,originEditor:{accessType:"templates",linkType:this.linkType,url:"/api/indicator/values/aggregation",method:"post",contentType:"application/json",pagination:0,defaultLoad:!0},propSelected:[],indicatorFields:[],editVal:{},defaultProps:{children:"children",label:"name"},types:{collect:"采集",indicator:"指标",calculate:"计算",manual:"自定义点",measuringPoint:"内置测点"},propertyTypeMap:{1:"collect",2:"calculate",3:"indicator",4:"manual",5:"measuringPoint"},templateList:[],tableData:[],tablePagination:{page:1,pageSize:10},profileInfo:{},profileProperties:[],historyTypeParams:{name:"",identifier:"",propertyType:"",labels:""}}},watch:{showCloseTips:function(e){localStorage.setItem("link-tips-templates",e)},responseFields:{immediate:!0,handler:function(e){this.emitFieldsSelect()}}},computed:se(se({},Object(u.a)(["getLinkTipsOf"])),{},{templateTipsLoaded:function(){return this.getLinkTipsOf("templates-link")},templateData:function(){var e=this,t=[],a=this.templateList,i=a.find((function(t){return t.id===e.templateId||t.identifier===e.templateIdentifier})),n=function(t){var a;return~(null==t||null===(a=t.name)||void 0===a?void 0:a.toLowerCase().indexOf(e.searchName))};return i?(this.listToTree(a,t,i,n),n(i)?[se(se({},i),{},{children:t})]:t):[]},selectedLength:function(){var e,t,a,i;return null===(e=this.editVal)||void 0===e||null===(t=e.measuringSelected)||void 0===t||null===(a=t[null===(i=this.currentNode)||void 0===i?void 0:i.id])||void 0===a?void 0:a.length},responseFields:function(){return"actualTime"===this.editVal.queryType?[{identifier:"id",name:"唯一标识"},{identifier:"name",name:"名称"},{identifier:"type",name:"类型"},{identifier:"updateTime",name:"更新时间",type:"DateTime"},{identifier:"value",name:"值"},{identifier:"identifier",name:"标识符"}]:this.isIndicatorEditor?this.indicatorFields.map((function(e){return{identifier:e,name:e}})):[{identifier:"id",name:"唯一标识"},{identifier:"instanceId",name:"测点ID"},{identifier:"collectTime",name:"采集时间",type:"DateTime"},{identifier:"collectTimeFormat",name:"格式化采集时间",type:"DateTime"},{identifier:"dataIdentifier",name:"数据标识"},{identifier:"dataValue",name:"测点值"},{identifier:"deviceIdentifier",name:"设备标识"},{identifier:"ruleIdentifier",name:"采集规则标识"},{identifier:"groupIdentifier",name:"分组标识"},{identifier:"archiveDate",name:"归档时间",type:"DateTime"},{identifier:"archiveDateFormat",name:"格式化归档时间",type:"DateTime"},{identifier:"quality",name:"数据品质"}]},responseDescription:function(){return this.isIndicatorEditor?"响应数据字段可使用函数过滤，例timeFormat(updateTime::year::1)，字段列表如下：":""},formData:function(){return this.isRTEditor?this.editVal.rtEditor:this.isIndicatorEditor?this.editVal.indicatorEditor:this.editVal},hiddenConfig:function(){return{pagination:!0}},measuringSelected:function(){return this.editVal.measuringSelected||{}},projectId:function(){return Object(c.h)(window.location.href,"projectId")},templateId:function(){return Object(c.h)(window.location.href,"templateId")},templateIdentifier:function(){return Object(c.h)(window.location.href,"templateIdentifier")},modelTemplateTreeIdentifier:function(){return Object(c.h)(window.location.href,"modelTemplateTreeIdentifier")},isDevice:function(){return"device"===this.activeView},isUnDevice:function(){return"unDevice"===this.activeView},isStatic:function(){return"static"===this.editVal.actualTimeType},isDynamic:function(){return"dynamic"===this.editVal.actualTimeType},indicatorList:function(){var e,t,a;return(null===(e=this.editVal)||void 0===e||null===(t=e.indicatorEditor)||void 0===t||null===(a=t.assistAttr)||void 0===a?void 0:a.tableData)||[]},isRTEditor:function(){return"history"===this.editVal.queryType&&["collect","calculate","manual"].includes(this.editVal.historyType)},isIndicatorEditor:function(){return"history"===this.editVal.queryType&&"indicator"===this.editVal.historyType},isMixEditor:function(){return"actualTime"===this.editVal.queryType&&"indicator"===this.editVal.actualTimeType}}),created:function(){},methods:{emitFieldsSelect:function(){this.$emit("fieldsChange",this.responseFields)},initData:function(){var e=this;return Object(n.a)(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$store.dispatch("initDictOptions");case 2:if(e.$store.dispatch("setLinkEditorTips","templates"),e.resetEditorVal(),e.commonInitData("templates"),!e.dialogVisible){t.next=10;break}return t.next=8,e.getTemplateTree();case 8:return t.next=10,e.formatData();case 10:case"end":return t.stop()}}),t)})))()},formatData:function(){var e=this;return Object(n.a)(s.a.mark((function t(){var a,i,n,r,o,l,c;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null!=(a=e.data.linkConfig)&&a.queryType&&(e.handleTabClick({name:a.queryType},!0),"history"===a.queryType&&null!=a&&a.historyType&&e.handleHistoryTypeChange(a.historyType,!1,!0)),null==a||!a.requestPayload){t.next=14;break}if(i=a.requestPayload,n=i.templateId,r=i.identifier,o=i.properties,!(l=e.templateList.find((function(e){return e.id===n||e.identifier===r})))){t.next=14;break}return t.next=8,e.handleNodeClick(l,!0);case 8:return c=Object(ie.a)(o),t.next=11,e.$refs.templateTree.$nextTick();case 11:return e.$refs.templateTree.setCurrentKey(l.id||n),t.next=14,e.initSelected(c);case 14:case"end":return t.stop()}}),t)})))()},initSelected:function(e){var t=this;return Object(n.a)(s.a.mark((function a(){return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return t.propSelected=e.filter((function(e){return"measuringPoint"!==e.type})),a.next=3,t.doPropertySelected(t.propSelected);case 3:case"end":return a.stop()}}),a)})))()},doPropertySelected:function(e){var t=this;return Object(n.a)(s.a.mark((function a(){var i;return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(!(i=t.$refs.templateTable)){a.next=6;break}return a.next=4,i.$nextTick();case 4:return a.next=6,i.handleSelected(e);case 6:case"end":return a.stop()}}),a)})))()},refreshIndicators:function(){this.syncIndicator(this.propSelected)},syncIndicator:function(e){var t=this;return Object(n.a)(s.a.mark((function a(){var i;return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:t.syncIndicatorLoading=!0,t.syncIndicatorLoading=!1,i=e.map((function(e){var a,i;return{id:e.id,name:e.name,rowInfo:e,isDynamic:!(null===(a=(t.editVal.indicatorEditor.assistAttr.tableData||[]).find((function(t){return t.id===e.id})))||void 0===a||!a.isDynamic),selected:(null===(i=(t.editVal.indicatorEditor.assistAttr.tableData||[]).find((function(t){return t.id===e.id})))||void 0===i?void 0:i.selected)||[]}})),t.editVal.indicatorEditor.assistAttr.tableData=i,t.onIndicatorChange(i);case 5:case"end":return a.stop()}}),a)})))()},onIndicatorChange:function(e){var t,a,i,n=e||(null==this||null===(t=this.editVal)||void 0===t||null===(a=t.indicatorEditor)||void 0===a||null===(i=a.assistAttr)||void 0===i?void 0:i.tableData)||[],r=[];n.forEach((function(e){Object.keys((null==e?void 0:e.rowInfo)||{}).forEach((function(e){e.startsWith("expands.")||r.push(e)}))}));var o=r.length?["value"].concat(r):r;this.indicatorFields=Array.from(new Set(o))},onPropSelectedChange:function(e){if(this.isDevice&&!this.isMixEditor){var t=this.currentNode.id;this.editVal.measuringSelected=se(se({},this.measuringSelected),{},Object(o.a)({},t,e))}else this.propSelected=e,(this.isIndicatorEditor||this.isMixEditor)&&this.syncIndicator(e)},handlePropertiesChange:function(e){this.editVal.requestPayload.properties=e},handleViewChange:function(e){var t=this;return Object(n.a)(s.a.mark((function a(){var i;return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(t.activeView=e,"device"!==e){a.next=8;break}return a.next=4,t.getTemplateInnerData(t.currentNode);case 4:return a.next=6,t.doPropertySelected(t.measuringSelected[null===(i=t.currentNode)||void 0===i?void 0:i.id]||[]);case 6:a.next=12;break;case 8:return a.next=10,t.getTemplatePropData(t.currentNode);case 10:return a.next=12,t.doPropertySelected(t.propSelected);case 12:case"end":return a.stop()}}),a)})))()},handleHistoryTypeChange:function(e){var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.editVal.historyType=e,t||this.onPropSelectedChange([]),this.getTemplateHistoryData(this.currentNode)},handleActualTimeTypeChange:function(e){this.editVal.actualTimeType=e,"static"===e?this.handlePropertiesChange([{id:"",type:"",name:""}]):this.onPropSelectedChange([]),"dynamic"!==e&&this.getTemplatePropData(this.currentNode)},onPaginationChange:function(e){this.tablePagination.page=e.page,this.tablePagination.pageSize=e.pageSize,this.handleViewChange(this.activeView)},getTemplatePropData:function(e){var t=this;return Object(n.a)(s.a.mark((function a(){var i;return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return t.tableData=[],a.next=3,t.fetchProperty(null==e?void 0:e.identifier);case 3:i=a.sent,t.tableData=(null==i?void 0:i.result)||[],(null==i?void 0:i.pageInfo)&&(t.tablePagination=i.pageInfo);case 6:case"end":return a.stop()}}),a)})))()},handleHistoryParamsChange:function(e){this.historyTypeParams=se(se({},this.historyTypeParams),e)},resetHistoryParams:function(){this.historyTypeParams={name:"",identifier:"",propertyType:"",labels:""}},getTemplateHistoryData:function(e){var t=this;return Object(n.a)(s.a.mark((function a(){var i;return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return t.handleHistoryParamsChange({propertyType:t.editVal.historyType}),t.tableData=[],a.next=4,t.fetchProperty(e.identifier);case 4:i=a.sent,t.tableData=(null==i?void 0:i.result)||[],(null==i?void 0:i.pageInfo)&&(t.tablePagination=i.pageInfo);case 7:case"end":return a.stop()}}),a)})))()},getTemplateInnerData:function(e){var t=this;return Object(n.a)(s.a.mark((function a(){var i;return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(null!=e&&e.regCodeIdentifier){a.next=3;break}return t.tableData=[],a.abrupt("return");case 3:return t.tableData=[],a.next=6,t.fetchProperty(null==e?void 0:e.regCodeIdentifier,{name:"",identifier:"",propertyType:"",labels:""});case 6:i=a.sent,t.tableData=((null==i?void 0:i.result)||[]).map((function(e){return se(se({},e),{},{propertyType:"5"})})),(null==i?void 0:i.pageInfo)&&(t.tablePagination=i.pageInfo);case 9:case"end":return a.stop()}}),a)})))()},ranNum:function(e,t){return Math.floor(Math.random()*(t-e+1)+e)},handleTabClick:function(e){var t=e.name,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.editVal.queryType=t,"history"===t?(this.editVal.actualTimeType="static",this.handleHistoryTypeChange(this.editVal.historyType,!1,a)):this.resetHistoryParams(),this.getTemplatePropData(this.currentNode)},clearProperties:function(){delete this.measuringSelected[this.currentNodeId],this.propSelected=[]},handleNodeClick:function(e,t){var a=this;return Object(n.a)(s.a.mark((function i(){var n;return s.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(!0!==t&&a.currentNodeId!==e.id&&a.clearProperties(),a.currentNodeId=e.id,a.currentNode=e,a.deviceName=e["regCode.name"]||"",!a.isUnDevice){i.next=11;break}return i.next=7,a.getProfileProperties(e);case 7:return i.next=9,a.getTemplatePropData(e);case 9:i.next=15;break;case 11:return i.next=13,a.getTemplateInnerData(a.currentNode);case 13:return i.next=15,a.doPropertySelected(a.measuringSelected[null===(n=a.currentNode)||void 0===n?void 0:n.id]||[]);case 15:case"end":return i.stop()}}),i)})))()},clearValidate:function(e){null!=e&&e.length?this.$refs.form.clearValidate(e):this.$refs.form.clearValidate()},setProfileInfo:function(e,t){this.profileInfo={identifier:e.identifier,company:e.identifier,description:e.description},this.profileProperties=t.map((function(t){return{name:t.propertyLocalName,prop:t.propertyName,value:e[t.propertyName]}}))},getProfileProperties:function(e){var t=this;return Object(n.a)(s.a.mark((function a(){var i,n,r,o;return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.fetchProfiles(e.objectType);case 2:if(i=a.sent,1!==(null==(n=null==i?void 0:i.result)?void 0:n.length)){a.next=10;break}return r=n[0],a.next=8,t.fetchProfileProperties(null==r?void 0:r.id);case 8:o=a.sent,t.setProfileInfo(e,o);case 10:case"end":return a.stop()}}),a)})))()},getTemplateTree:function(){var e=this;return Object(n.a)(s.a.mark((function t(){var a;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.fetchTemplateTree();case 2:(a=t.sent).length&&(e.templateList=a);case 4:case"end":return t.stop()}}),t)})))()},listToTree:function(e,t,a,i){var n=this;e.forEach((function(r){if(r.parentIdentifier===a.identifier){var o=se(se({},r),{},{children:[]});n.listToTree(e,o.children,r),o.children.length<=0&&delete o.children,"function"==typeof i?i(o)&&t.push(o):t.push(o)}}))},fetchIndicators:function(e){var t=this;return Object(n.a)(s.a.mark((function a(){var i;return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(i=[],null==e||!e.length){a.next=4;break}return a.next=4,t.$util.request({url:"/api/model/instances",method:"get",params:{objectType:"MEAS_INDICATOR",queryMode:"simple",pagination:0,$orderBy:"createTime desc",$filter:"id eq ".concat(e.join("::"))}}).then((function(e){i=e})).catch((function(e){}));case 4:return a.abrupt("return",i);case 5:case"end":return a.stop()}}),a)})))()},fetchTemplateTree:function(){var e=this;return Object(n.a)(s.a.mark((function t(){var a;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a={},t.next=3,e.$util.request({url:"/api/thing-model/model-template?pagination=0&$filter=modelTemplateTreeIdentifier eq ".concat(e.modelTemplateTreeIdentifier,"&$orderBy=createTime desc"),method:"get"}).then((function(e){a=e})).catch((function(e){}));case 3:return t.abrupt("return",a);case 4:case"end":return t.stop()}}),t)})))()},fetchResourceInfo:function(e){var t=this;return Object(n.a)(s.a.mark((function a(){var i;return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(i={},!e){a.next=4;break}return a.next=4,t.$util.request({url:"/api/resource-tree/projects/".concat(e),method:"get"}).then((function(e){i=e})).catch((function(e){}));case 4:return a.abrupt("return",i);case 5:case"end":return a.stop()}}),a)})))()},fetchTemplate:function(e){var t=this;return Object(n.a)(s.a.mark((function a(){var i;return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(i=[],!e){a.next=4;break}return a.next=4,t.$util.request({url:"/api/model/instances",method:"get",params:{objectType:e,pagination:0,$orderBy:"updateTime desc",accessMethod:"foreign_key",relationProperties:"name"}}).then((function(e){i=e})).catch((function(e){}));case 4:return a.abrupt("return",i);case 5:case"end":return a.stop()}}),a)})))()},fetchProfiles:function(e){var t=this;return Object(n.a)(s.a.mark((function a(){var i;return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(i=[],!e){a.next=4;break}return a.next=4,t.$util.request({url:"/api/model/profiles",method:"get",params:{$filter:"identifier eq ".concat(e)}}).then((function(e){i=e})).catch((function(e){}));case 4:return a.abrupt("return",i);case 5:case"end":return a.stop()}}),a)})))()},fetchProfileProperties:function(e){var t=this;return Object(n.a)(s.a.mark((function a(){var i;return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(i=[],!e){a.next=4;break}return a.next=4,t.$util.request({url:"/api/model/profiles/".concat(e,"/properties"),method:"get",params:{$filter:"status eq 1",pagination:0,inherit:"custom",$orderBy:"createTime desc"}}).then((function(e){i=e})).catch((function(e){}));case 4:return a.abrupt("return",i);case 5:case"end":return a.stop()}}),a)})))()},fetchProperty:function(e,t){var a=this;return Object(n.a)(s.a.mark((function i(){var n,r,o,l,c,u,d,p,h,f,m,v,b;return s.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(n={},!e){i.next=7;break}return o=t||a.historyTypeParams,l=o.name,c=void 0===l?"":l,u=o.identifier,d=void 0===u?"":u,p=o.propertyType,h=void 0===p?"":p,f=o.labels,m=void 0===f?"":f,v=Object(ie.c)(a.propertyTypeMap),b=a.isMixEditor?v.indicator:null!==(r=v[h])&&void 0!==r?r:"",i.next=7,a.$util.request({url:"/api/thing-model/model-template/".concat(e,"/property"),method:"get",params:{$page:a.tablePagination.page,$pageSize:a.tablePagination.pageSize,$filter:"name eq ".concat(c,",identifierAlias eq ").concat(d,",propertyType eq ").concat(b,",labels em ").concat(m)}}).then((function(e){n=e})).catch((function(e){}));case 7:return i.abrupt("return",n);case 8:case"end":return i.stop()}}),i)})))()},handleTemplateClick:function(){this.$setAttr(this.data,"editorDialogVisible",!0),this.dialogVisible=!0},onClose:function(){var e,t;this.closeHandler("templates"),null===(e=this.$refs)||void 0===e||null===(t=e.templateTable)||void 0===t||t.clearSelection()},handleClear:function(){this.clearByType("templates")},resetEditorVal:function(){this.editVal={accessType:"templates",linkType:this.linkType,url:"/api/indicator/values/aggregation",method:"post",contentType:"application/json",pagination:0,defaultLoad:!0,fields:"",historyType:"collect",queryType:"actualTime",actualTimeType:"static",measuringSelected:{},requestPayload:{templateId:"",deviceId:"",properties:[{id:"",type:"",name:""}]},rtEditor:{accessType:"rtdata",linkType:this.linkType,url:"/api/realtimedata/records",method:"get",contentType:"application/json",objectType:"",rtDataType:2,requestPayload:{instanceId:"",queryDirection:1,querySize:1e3,$orderBy:"collectTime asc",collectTime:"",queryMode:1,$filter:"",objectType:"",queryType:1,beginTime:"",endTime:"",recordType:1},variableEditData:{instanceIdData:{name:"instanceId",value:"",editValue:null},collectTimeData:{name:"collectTime",value:"",editValue:null},beginTimeData:{name:"beginTime",value:"",editValue:null},endTimeData:{name:"endTime",value:"",editValue:null}},responseSchema:{},exceptionStrategy:"throw",showIdTable:!0,filterItems:[{name:"",value:"",filter:"",editValue:""}],tableData:[]},indicatorEditor:{accessType:"indicator",linkType:this.linkType,url:"/api/indicator/values/aggregation",method:"post",contentType:"application/json",fields:"",dataType:"",requestPayload:{indicatorIds:"",queryLatest:1,timeRangeType:"fixed",queryType:"",updateTimeBegin:"",updateTimeEnd:"",relativeTime:"",dimensionTime:"",aggOperation:"",sortOperation:"",cmpOperation:"",precision:"",filters:"",valueFilter:""},variableEditData:{indicatorIdsData:{name:"indicatorIds",value:"",editValue:null},updateTimeBeginData:{name:"updateTimeBegin",value:"",editValue:null},updateTimeEndData:{name:"updateTimeEnd",value:"",editValue:null},dimensionTimeData:{name:"dimensionTime",value:"",editValue:null},compareTimeData:{name:" compareTime",value:"",editValue:null},parentIdData:{name:" parentId",value:"",editValue:null},timeDimensionData:{name:" timeDimension",value:"",editValue:null},projectData:{name:"project",value:"",editValue:null},valueData:{name:"value",value:"",editValue:null}},assistAttr:{relativeType:"current",relativeNumber:1,timeDimension:"",orderNumber:1,orderType:"asc",compareType:"M2M",compareNumber:1,isNow:!1,compareTime:"",tableData:[{id:this.$util.uuid(),rowInfo:{},isDynamic:!1,selected:[]}],extraFilter:"",timeDimensionFilter:"",parentIdFilter:"",projectFilter:"",dimensionTimeFilter:"",valueFilterOperator:"",valueFilter:""},responseSchema:{},exceptionStrategy:"throw"},variableEditData:{properties:{name:"properties",value:"",editValue:null}}}},resetData:function(){this.showVal="",this.resetEditorVal(),this.commonResetData()},validate:function(){return!0},getHandlerEditVal:function(){var e,t,a=Object(c.e)(this.editVal),n=this.propSelected,r=null==a?void 0:a.measuringSelected[this.currentNode.id];null!=r&&r.length&&(n=[].concat(Object(i.a)(n),Object(i.a)(r.map((function(e){return se(se({},e),{},{propertyType:"5"})})))));var o=ie.b.call(this,n),l="dynamic"===a.actualTimeType;return a.requestPayload={templateId:this.currentNode.id,identifier:this.currentNode.identifier,deviceId:this.currentNode.edgeCode,properties:l?null==a||null===(e=a.variableEditData)||void 0===e||null===(t=e.properties)||void 0===t?void 0:t.value:o},a},syncTableToProps:function(){var e=this.indicatorList||[],t=[],a=[],i={};for(var n in e.forEach((function(e){e.isDynamic?((null==e?void 0:e.selected)||[]).forEach((function(t){i[t]?i[t].push(e.rowInfo[t]):i[t]=[e.rowInfo[t]]})):t.push(e.rowInfo.id)})),i){var r=i[n].join("::");a.push("".concat(n," eq ").concat(r))}var o=t.join(","),l=a.length?"$filter="+a.join(","):"";this.editVal.indicatorEditor.requestPayload.indicatorIds=o,this.editVal.indicatorEditor.requestPayload.filters=l},refreshEditValPayload:function(){var e,t;"current"===this.editVal.indicatorEditor.assistAttr.relativeType&&(this.editVal.indicatorEditor.assistAttr.relativeNumber=1);var a=this.editVal.indicatorEditor.assistAttr,i=a.relativeType,n=a.relativeNumber,r=a.timeDimension,o=a.orderNumber,l=a.orderType,s=a.compareType,c=a.compareNumber,u=a.isNow,d=a.compareTime,p=a.dimensionTimeFilter,h=i?"".concat(i,":").concat(n,":").concat(r):"";this.editVal.indicatorEditor.requestPayload.relativeTime=h;var f=o?"".concat(o,":").concat(l):"";this.editVal.indicatorEditor.requestPayload.sortOperation=f;var m=u?"now":d,v=s?"".concat(s,":").concat(c,":").concat(m):"";this.editVal.indicatorEditor.requestPayload.cmpOperation=v;var b=this.editVal.indicatorEditor.variableEditData,g=b.updateTimeBeginData,y=b.updateTimeEndData;this.editVal.indicatorEditor.requestPayload.dimensionTime=p,this.editVal.indicatorEditor.requestPayload.updateTimeBegin=null!==(e=g.value)&&void 0!==e?e:"",this.editVal.indicatorEditor.requestPayload.updateTimeEnd=null!==(t=y.value)&&void 0!==t?t:""},additionalFilter:function(){var e=this.editVal.indicatorEditor.assistAttr.extraFilter;e&&(this.editVal.indicatorEditor.requestPayload.filters?this.editVal.indicatorEditor.requestPayload.filters=this.editVal.indicatorEditor.requestPayload.filters+","+e:this.editVal.indicatorEditor.requestPayload.filters="$filter=".concat(e))},staticParamFilter:function(){var e=this,t=this.editVal.indicatorEditor.assistAttr;[{name:"parentId",value:t.parentIdFilter},{name:"timeDimension",value:t.timeDimensionFilter},{name:"indicatorItemId",value:t.projectFilter}].forEach((function(t){t&&null!=t&&t.value&&(e.editVal.indicatorEditor.requestPayload.filters?e.editVal.indicatorEditor.requestPayload.filters=e.editVal.indicatorEditor.requestPayload.filters+","+"".concat(t.name," eq ").concat(t.value):e.editVal.indicatorEditor.requestPayload.filters="$filter=".concat(t.name," eq ").concat(t.value))}))},cleanData:function(){var e=this.editVal.requestPayload,t=e.queryType,a=e.timeRangeType;switch(t){case"1":this.editVal.requestPayload.aggOperation="",this.editVal.requestPayload.sortOperation="",this.editVal.requestPayload.cmpOperation="",this.editVal.requestPayload.updateTimeBegin="",this.editVal.requestPayload.updateTimeEnd="","fixed"===a?this.editVal.requestPayload.relativeTime="":"relative"===a&&(this.editVal.requestPayload.dimensionTime="");break;case"2":this.editVal.requestPayload.aggOperation="",this.editVal.requestPayload.sortOperation="",this.editVal.requestPayload.cmpOperation="",this.editVal.requestPayload.dimensionTime="","fixed"===a?this.editVal.requestPayload.relativeTime="":"relative"===a&&(this.editVal.requestPayload.updateTimeBegin="",this.editVal.requestPayload.updateTimeEnd="");break;case"3":this.editVal.requestPayload.sortOperation="",this.editVal.requestPayload.cmpOperation="",this.editVal.requestPayload.dimensionTime="","fixed"===a?this.editVal.requestPayload.relativeTime="":"relative"===a&&(this.editVal.requestPayload.updateTimeBegin="",this.editVal.requestPayload.updateTimeEnd="");break;case"4":this.editVal.requestPayload.aggOperation="",this.editVal.requestPayload.cmpOperation="",this.editVal.requestPayload.dimensionTime="","fixed"===a?this.editVal.requestPayload.relativeTime="":"relative"===a&&(this.editVal.requestPayload.updateTimeBegin="",this.editVal.requestPayload.updateTimeEnd="");break;case"5":this.editVal.requestPayload.aggOperation="",this.editVal.requestPayload.sortOperation="",this.editVal.requestPayload.dimensionTime="",this.editVal.requestPayload.updateTimeBegin="",this.editVal.requestPayload.updateTimeEnd=""}},getTimeStamp:function(e){return new Date(e).valueOf()},handleSubmit:function(){var e=this;return Object(n.a)(s.a.mark((function t(){var a;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.isIndicatorEditor||void 0!==e.editVal.indicatorEditor.requestPayload.queryType&&""!==e.editVal.indicatorEditor.requestPayload.queryType){t.next=3;break}return e.$message.warning("请配置查询配置"),t.abrupt("return",!1);case 3:return t.next=5,e.$refs.form.validate((function(t){if(t){if("history"===e.editVal.queryType&&"indicator"===e.editVal.historyType){if(e.syncTableToProps(),e.refreshEditValPayload(),e.additionalFilter(),e.staticParamFilter(),e.cleanData(),e.editVal.indicatorEditor.requestPayload.updateTimeEnd&&e.editVal.indicatorEditor.requestPayload.updateTimeBegin){var i=e.getTimeStamp(e.editVal.indicatorEditor.requestPayload.updateTimeEnd),n=e.getTimeStamp(e.editVal.indicatorEditor.requestPayload.updateTimeBegin);if("number"==typeof i&&"number"==typeof n&&!window.isNaN(i)&&!window.isNaN(n)&&n>i)return void e.$message({type:"error",message:"开始时间需要早于结束时间"})}if(!e.editVal.indicatorEditor.requestPayload.queryType)return void e.$message({type:"error",message:"请设置“查询配置”"})}a=e.commonSureHandlerCustom("templates")}}));case 5:return t.abrupt("return",a);case 6:case"end":return t.stop()}}),t)})))()},commonSureHandlerCustom:function(e){var t=this.validate();if(!0===t){var a=this.getHandlerEditVal();return this.commonLinkSet.fields=this.commonLinkSet.fields.replaceAll("，",","),this.commonLinkSet.fields=this.commonLinkSet.fields.replaceAll(" ",""),a=se(se({},a),this.commonLinkSet)}this.$message.warning(t)}}};function ue(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function de(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ue(Object(a),!0).forEach((function(t){Object(o.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ue(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var pe={name:"DataSourceEditor",components:{FiltersSelect:T,FieldsCompsSelect:j,Assets:Q,TemplateThingModel:(a("dabe"),a("7af2"),Object(f.a)(ce,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"template-link-editor"},[t("template-header",{attrs:{activeView:e.activeView,profileInfo:e.profileInfo,profileProperties:e.profileProperties,currentNode:e.currentNode,queryType:e.editVal.queryType,historyType:e.editVal.historyType,deviceName:e.deviceName,actualTimeType:e.editVal.actualTimeType,types:e.types,editVal:e.editVal,selectedLength:e.selectedLength},on:{"tab-click":e.handleTabClick,"view-change":e.handleViewChange,"history-type-change":e.handleHistoryTypeChange,"actualTime-type-change":e.handleActualTimeTypeChange}}),t("el-collapse",{staticClass:"assets-table-collapse t-border",attrs:{value:"table",accordion:""}},[t("el-collapse-item",{attrs:{name:"table"}},[t("template",{slot:"title"},[t("div",{staticClass:"data-source-editor-collapse-title"},[t("div",[t("span",[e._v("测点配置")]),t("basic-tips",{attrs:{type:"popover",title:"配置说明",width:600,placement:"bottom-start",iconStyle:{color:"#C9D0D4"},content:""}},[t("div",[t("div",[e._v("配置使用测点")])])])],1)])]),e.isStatic||e.isMixEditor?t("template-table",{ref:"templateTable",attrs:{"multiple-selection":e.isDevice?e.measuringSelected[e.currentNodeId]:e.propSelected,data:e.tableData,pagination:e.tablePagination,types:e.types,propertyTypeMap:e.propertyTypeMap,deviceName:e.deviceName},on:{selectionChange:e.onPropSelectedChange,paginationChange:e.onPaginationChange}}):e._e(),e.isDynamic?t("template-dynamic",{staticClass:"template-dynamic",attrs:{editVal:e.editVal},on:{"properties-change":e.handlePropertiesChange}}):e._e()],2)],1),e._e(),t("el-form",{ref:"form",attrs:{"label-width":"150px",model:e.formData}},[e.isRTEditor?t("editor-collapse",{staticClass:"link-editor-collapse",attrs:{title:"历史数据"}},[t("history-setting",{attrs:{editVal:e.editVal.rtEditor}})],1):e._e(),e.isIndicatorEditor||e.isMixEditor?t("editor-collapse",{staticClass:"link-editor-collapse",attrs:{title:"指标配置"}},[t("template-indicator-table",{directives:[{name:"loading",rawName:"v-loading",value:e.syncIndicatorLoading,expression:"syncIndicatorLoading"}],attrs:{list:e.indicatorList,updateList:e.refreshIndicators},on:{indicatorChange:e.onIndicatorChange}}),e.indicatorList.length?e._e():t("div",{staticClass:"template-indicator-empty t-text-placeholder t-border__top"},[e._v("请先选择模板属性")])],1):e._e(),e.isIndicatorEditor?[t("editor-collapse",{staticClass:"link-editor-collapse",attrs:{title:"查询配置"}},[t("param-setting",{attrs:{editVal:e.editVal.indicatorEditor},on:{clearValidate:e.clearValidate}})],1),t("editor-collapse",{staticClass:"link-editor-collapse",attrs:{title:"筛选项"}},[t("filter-setting",{attrs:{editVal:e.editVal.indicatorEditor}})],1)]:e._e()],2)],1)}),[],!1,null,"1b8cc48d",null)).exports,ApiAlert:b,ModelSvg:m,OrderbySetting:V.a,AggregationSetting:I},props:{visible:{type:String,default:function(){return!1}},showInput:{type:String,default:function(){return!0}},iconClass:{type:String,default:function(){return"el-icon-edit"}},data:{type:Object,default:function(){return{alias:"",type:"",default:"",value:"",primitiveLabels:""}}},placeholder:{type:String,default:""},linkType:{type:Number,default:function(){return 1}},params:{type:[String,Number,Boolean,Array,Object],default:function(){return{}}},handleRulesResult:{type:Function,default:function(){}},handleChangeResult:{type:Function,default:function(){}}},inject:["isProjectPage","isTemplatePage"],data:function(){return{REPORT_PROPERTY_TYPE:"5",commitLoading:!1,loadingTree:!1,showVal:"",compUid:"",compOptions:[],editVal:{url:"",linkType:1,contentType:"application/json",accessType:"api",method:"post",exceptionStrategy:"throw",fields:"",containsKey:1,pagination:0,dataType:"",requestPayload:{},responseSchema:{},variables:[],quickSelect:{},historySelect:[],isQuickSelect:!1,totalFields:[],editValue:{complexFieldsConfigs:[],treeId:"",treeParentId:"",filtersArr:[],pagination:{page:"",pageSize:""},functionIdentifier:[],rowField:"",rowValue:"",groupList:[],orderByArr:[{attr:"",sort:"asc"}],aggregationArr:[{attr:"",aggregationType:""}]}},dialogVisible:this.visible,filterArr:[],orderByArr:[{attr:"",sort:"asc"}],aggregationArr:[{attr:"",aggregationType:""}],pageSizeOptions:[10,20,50,100],commonLinkSet:{fields:[],functionIdentifier:[],rowField:"",rowValue:"",groupList:[],defaultLoad:1,commonFlag:!0,containsKey:1,pagination:1,pageSize:10},activeModel:"model",treeList:[],treeProps:{model:{children:"children",label:"localName"},thingModel:{children:"children",label:"name"}},currentNodeId:"",currentNodeIdentifier:"",currentNodeParentId:"",currentNodeParentIdentifier:"",currentNode:{},searchName:"",attrsKV:{},defaultExpandedKeys:{},loadingItems:{},autoBindComp:{},assetsFieldsSelect:[],fieldsForSelectComplex:[],autoBindOldCompIndex:-1,autoBindCompType:0,functionList:[],functionCascaderProps:{value:"identifier",label:"name"},functionCommonProjectIdentifier:"common"}},computed:de(de({},Object(u.a)(["themeConstColor","pageEditor"])),{},{themeColor:function(){return this.themeConstColor.primary},isComplexArray:function(){return this.data.type.toLowerCase().indexOf("complex[")>-1},isComplex:function(){return!this.isComplexArray&&this.data.type.toLowerCase().indexOf("complex")>-1},isPoint:function(){return!this.isComplexArray&&!this.isComplex},currentPage:function(){return this.pageEditor.pagesKV[this.pageEditor.pagesActiveName]},autoFillComponents:function(){return"object"===Object(r.a)(this.params)&&this.params.autoFillComponents},modelTypes:function(){return[{id:"model",icon:"table",name:"数据建模",content:"来自建模管理中的对象类型和对象属性，从建模中加载实例数据",isActive:!0}].concat(this.isProjectPage||this.isTemplatePage?[{id:"thingModel",icon:"thingModel",name:"物模型",content:"来自物模型的资产，获取来自设备的归档数据",isActive:!1}]:[])},treeData:function(){var e,t,a=this,i=[],n=[],r=this.treeList;switch(this.activeModel){case"model":t={id:"1"},i=n;break;case"thingModel":var o="thingModel"===this.activeModel&&this.isTemplatePage?this.templateId:this.assetsId,l="thingModel"===this.activeModel&&this.isTemplatePage?this.templateIdentifier:this.assetsIdentifier;this.isProjectPageUrl?(t={id:this.property||this.assetsId},i=n):(t=r.find((function(e){return e.id===o||e.identifier===l})),i.push(de(de({},t),{},{children:n})))}var s=(null===(e=this.treeProps[this.activeModel])||void 0===e?void 0:e.label)||"localName";if(r.length&&t){var c={};return this.listToTree(r,n,t,(function(e){var t,i,n,r;return~(null===(t=e[s])||void 0===t?void 0:t.toLowerCase().indexOf(null===(i=a.searchName)||void 0===i?void 0:i.toLowerCase()))||~(null==e||null===(n=e.__parentName__)||void 0===n?void 0:n.toLowerCase().indexOf(null===(r=a.searchName)||void 0===r?void 0:r.toLowerCase()))&&e.isProperty}),c),c=null,i}return[]},pageEditor:function(){return this.$store.getters.pageEditor},currentComponent:function(){return this.currentPage.componentInstance[this.data.componentFid]||{}},projectId:function(){return Object(c.h)(window.location.href,"projectId")},assetsId:function(){return Object(c.h)(window.location.href,"assetsId")},assetsIdentifier:function(){return Object(c.h)(window.location.href,"assetsIdentifier")},isProjectPageUrl:function(){return Object(c.h)(window.location.href,"isProjectPage")},projectIdentifier:function(){return Object(c.h)(window.location.href,"projectIdentifier")},isProject:function(){var e=this.$store.getters.portalInfo;return this.projectIdentifier||(e.isManagement?"":e.nameEn)},property:function(){return Object(c.h)(window.location.href,"property")},templateId:function(){return Object(c.h)(window.location.href,"templateId")},templateIdentifier:function(){return Object(c.h)(window.location.href,"templateIdentifier")},modelTemplateTreeIdentifier:function(){return Object(c.h)(window.location.href,"modelTemplateTreeIdentifier")},fieldsForSelect:function(){var e=this;return this.isThingModelAndNotReport?this.assetsFieldsSelect:(this.attrsKV[this.currentNodeId]||[]).filter((function(t){return!t.propertyType||t.propertyType!==e.REPORT_PROPERTY_TYPE}))},isThingModelAndNotReport:function(){var e;return"thingModel"===this.activeModel&&(null===(e=this.currentNode)||void 0===e?void 0:e.propertyType)!==this.REPORT_PROPERTY_TYPE},isThingModelAndReport:function(){var e;return this.isComplexArray&&"thingModel"===this.activeModel&&(null===(e=this.currentNode)||void 0===e?void 0:e.propertyType)===this.REPORT_PROPERTY_TYPE},isAssets:function(){return this.isProjectPage&&this.isThingModelAndNotReport},isTemplateThingModels:function(){return this.isTemplatePage&&this.isThingModelAndNotReport},defaultTypeComp:function(){var e,t={};if(null!==(e=this.params)&&void 0!==e&&e.getDefaultTypesFn){var a=this.currentComponent[this.params.getDefaultTypesFn];t="function"==typeof a?a():{}}return t},fieldsForSelectComplexChecked:function(){var e=(this.fieldsForSelectComplex||[]).filter((function(e){return e.checked}));return e.length?e:this.fieldsForSelectComplex||[]},paramNames:function(){return this.isComplexArray?[]:["id"]},queriesTips:function(){return this.isComplexArray?"二维组件呈现的形态说明：以下已勾选的字段将会作为返回字段使用，提供的变量数组内的对象由这些字段组成。呈现字段可拖拽排序，勾选的呈现字段及顺序将体现在受支持的呈现组件中":this.isComplex?"列表组件呈现的形态说明：以下已勾选的字段将会作为返回字段使用，提供的变量对象内的属性这些字段组成。":this.isPoint?"点数据组件呈现的形态说明：以下已选中的字段将会作为返回字段使用，提供的变量即由该字段提供。":""},groupAggregationTips:function(){return"使用聚合配置时需要配置分组字段，否则不生效；分组可以单独使用"},pageName:function(){return"__page_".concat((this.data.componentFid||"").replace(/-/g,""),"__")},pageSizeName:function(){return"__pageSize_".concat((this.data.componentFid||"").replace(/-/g,""),"__")},orderByOperations:function(){return this.isThingModelAndReport?"clear":"top, bottom, del, clear"},currentAttrsLV:function(){return(this.attrsKV[this.currentNodeId]||[]).map((function(e){return{label:e.propertyLocalName,value:e.propertyName}}))}}),watch:{visible:function(e){this.dialogVisible=e,e&&this.initData()},fieldsForSelect:{immediate:!0,handler:function(e){var t=this;this.isComplex&&(this.fieldsForSelectComplex=(this.fieldsForSelect||[]).map((function(e){var a,i,n,r=g.e[null!=e&&null!==(a=e.dataType)&&void 0!==a&&a.array?"Array":(null===(i=e.dataType)||void 0===i?void 0:i.type)||e.type||"String"],o=t.editVal.editValue.complexFieldsConfigs.find((function(t){return t.fieldName===(e.propertyName||e.identifier)})),l=Array.isArray(t.defaultTypeComp[r])?t.defaultTypeComp[r][0]:t.defaultTypeComp[r];return{checked:!(null==o||!o.checked),parentId:e.parentId,alias:e.propertyLocalName||e.name,name:e.propertyName||e.identifier,type:r,value:(null==o?void 0:o.fillCompName)||l,configs:(null===(n=e.dataType)||void 0===n?void 0:n.expands)||[]}})))}},isThingModelAndReport:{immediate:!0,handler:function(e,t){var a;!e||t||null!==(a=this.functionList)&&void 0!==a&&a.length||this.fetchFunctionList()}}},created:function(){this.initData(!0)},methods:{getIcon:function(e){var t=this;return this.modelTypes.find((function(e){return e.id===t.activeModel})).icon},fetchFunctionList:function(){var e=this;return Object(n.a)(s.a.mark((function t(){var a,i;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=[],i={url:"/api/archive-calculate/function/category/all",method:"get",params:{projectIdentifier:e.projectIdentifier}},t.next=4,e.$util.request(i).then(function(){var t=Object(n.a)(s.a.mark((function t(i){var n;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i.forEach((function(e){return e.identifier=e.identifier||e.id})),n={url:"/api/archive-calculate/function/all",method:"get",params:{$filter:"functionType eq 2,projectIdentifier in ".concat(e.functionCommonProjectIdentifier,"::").concat(e.projectIdentifier)}},t.next=4,e.$util.request(n).then((function(t){e.functionListWithoutGroup=t.map((function(e){return de(de({},e),{},{identifier:e.identifier||e.id})})),e.functionList=a=e.listToGroupByGroupList(t,i)}));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 4:return t.abrupt("return",a);case 5:case"end":return t.stop()}}),t)})))()},listToGroupByGroupList:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"categoryId",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"id",n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{name:"未分类",id:"others",children:[]},r=[],o={};return e.forEach((function(e){var l=e[a],s=o[e[a]];s||((s=t.find((function(t){return t[i]===e[a]})))&&l?(o[e[a]]=s,s.children||(s.children=[]),r.push(s)):(s=o.others)||(s=o.others=n,r.push(s))),s.children.push(e)})),r},checkRowToCol:function(e){return[].concat(Object(i.a)(this.commonLinkSet.rowField?[this.commonLinkSet.rowField]:[]),Object(i.a)(this.commonLinkSet.rowValue?[this.commonLinkSet.rowValue]:[])).includes(e.propertyName||e.identifier)},handleCompEvent:function(e,t){switch(e){case"start":break;case"end":if(this.isThingModelAndNotReport)this.assetsFieldsSelect.splice(t.newIndex,0,this.assetsFieldsSelect.splice(t.oldIndex,1)[0]);else{var a=this.fieldsForSelect[t.oldIndex],i=this.fieldsForSelect[t.newIndex],n=this.attrsKV[this.currentNodeId]||[],r=n.findIndex((function(e){return(e.propertyName||e.identifier)===(a.propertyName||a.identifier)})),o=n.findIndex((function(e){return(e.propertyName||e.identifier)===(i.propertyName||i.identifier)}));n.splice(o,0,n.splice(r,1)[0])}}},clearInvalidateLink:function(){var e=this.data.linkConfig;null!=e&&e.projectIdentifier&&(null==e?void 0:e.projectIdentifier)!==this.projectIdentifier&&(this.resetData(),this.clearData())},getCompGroups:function(){var e,t=[];if(null!==(e=this.params)&&void 0!==e&&e.getDefaultCompsFn){var a=this.currentComponent[this.params.getDefaultCompsFn];t="function"==typeof a?a():[]}var i=this.data.type.toLowerCase(),n="String";i.indexOf("complex[")>-1?n="Array":i.indexOf("complex")>-1&&(n="Object");var r=this.pageEditor.components,o=["layout","quickLayout","dataContainer","container","mobile"];this.compOptions=r.reduce((function(e,a){return o.includes(a.groupName)||(e=e.concat(a.children.filter((function(e){return t.includes(e.name)||(null==e?void 0:e.dataType)===n||(e.attributes||[]).some((function(e){return"dataType"===e.name&&e.value===n}))})))),e}),[])},checkIsReportNode:function(e){return"thingModel"===this.activeModel&&(null==e?void 0:e.propertyType)===this.REPORT_PROPERTY_TYPE},handleCompClick:function(e){this.autoBindComp.name===e.name?this.autoBindComp={}:this.autoBindComp=e,this.isComplexArray&&this.initAutoBindCompType()},initAutoBindCompType:function(){var e,t,a=this,i=((null===(e=this.currentComponent)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.children)||[]).findIndex((function(e){return e.name===a.autoBindComp.name}));this.autoBindCompType=i>-1?1:0,this.autoBindOldCompIndex=i},rowFieldChange:function(e){this.commonLinkSet.fields.includes(e)&&this.commonLinkSet.fields.splice(this.commonLinkSet.fields.findIndex((function(t){return t===e})),1)},rowValueChange:function(e){this.commonLinkSet.fields.includes(e)&&this.commonLinkSet.fields.splice(this.commonLinkSet.fields.findIndex((function(t){return t===e})),1)},groupListChange:function(e){},handleNodeExpand:function(e,t,a){this.defaultExpandedKeys[e.id]=void 0},handleNodeCollapse:function(e,t,a){delete this.defaultExpandedKeys[e.id]},addAttrToFilters:function(e){this.filterArr.some((function(t){return t.parentId===e.parentId}))||this.filterArr.splice(0,this.filterArr.length),"thingModel"===this.activeModel?this.filterArr.push({parentId:e.parentId,alias:e.propertyLocalName,name:e.propertyName,type:g.e[e.dataType.type],value:"",configs:e.dataType.expands,filter:"eq",editValue:"",dataType:e.dataType}):this.filterArr.push({parentId:e.parentId,alias:e.propertyLocalName,name:e.propertyName,type:g.e[e.dataType.type],value:"",configs:e.dataType.expands,filter:"eq",editValue:""})},listToTree:function(e,t,a,i){var n=this,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};e.forEach((function(o){if(!o.hideInTree&&(n.isTemplateThingModels?o.parentIdentifier===a.identifier:o.parentId===a.id)&&!r[o.id+o.identifier+o.parentId]){var l,s=de(de({},o),{},{children:[]});r[o.id+o.identifier+o.parentId]=1,n.listToTree(e,s.children,o,i,r),s.children.length<=0&&delete s.children,"function"==typeof i?(i(s)||(null===(l=s.children)||void 0===l?void 0:l.length))&&t.push(s):t.push(s)}}))},fetchModelByObjType:function(e){var t=this;return Object(n.a)(s.a.mark((function a(){var i,n;return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return n={url:"/api/model/profiles/".concat(e,"/byIdentifier"),method:"get",params:{}},a.next=3,t.$util.request(n).then((function(e){i=e})).finally((function(){}));case 3:return a.abrupt("return",i);case 4:case"end":return a.stop()}}),a)})))()},fetchAttrsData:function(e,t){var a=this;return Object(n.a)(s.a.mark((function n(){var r,o,l,c;return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!a.attrsKV[e.id]){n.next=2;break}return n.abrupt("return");case 2:if(a.$set(a.loadingItems,e.id,1),r={url:"",method:"get",params:{}},o=a.checkIsReportNode(e),"model"!==a.activeModel&&!o){n.next=16;break}if(l=e.id,!o){n.next=12;break}return n.next=10,a.fetchModelByObjType(e.objectType);case 10:c=n.sent,l=c.id;case 12:r.url="/api/model/profiles/".concat(l,"/properties?$pagination=0&inherit=custom&$filter=status eq 1&$orderBy=updateTime desc"),a.$util.request(r).then((function(n){var r={url:"/api/model/profiles/".concat(l,"/properties?inherit=extend"),method:"get",params:{}};a.$util.request(r).then((function(r){var l,s;a.$set(a.attrsKV,e.id,(n.concat(r)||[]).map((function(t){var i,n=de(de({},t),{},{parentId:e.id,id:t.propertyId,isProperty:1,isReport:!0,localName:t.propertyLocalName,__parentName__:e[(null===(i=a.treeProps[a.activeModel])||void 0===i?void 0:i.label)||"localName"]});return o&&(n.name=n.localName),n}))),(l=a.treeList).splice.apply(l,[(null===(s=a.treeList)||void 0===s?void 0:s.length)||0,0].concat(Object(i.a)(a.attrsKV[e.id]))),a.handleNodeExpand({id:e.id}),"function"==typeof t&&t()})).finally((function(){delete a.loadingItems[e.id]}))})).finally((function(){delete a.loadingItems[e.id]})),n.next=19;break;case 16:r.params={$filter:"status eq 1,configFlag eq 1"+(a.isComplexArray?"":",propertyType ne 5"),pagination:0,$orderBy:"createTime desc"},a.isAssets?r.url="/api/thing-model/instances/".concat(e.identifier,"/properties"):a.isTemplateThingModels&&(r.url="/api/thing-model/model-template/".concat(e.identifier,"/property"),delete r.params.$filter),a.$util.request(r).then((function(n){var r,o;a.$set(a.attrsKV,e.id,(n||[]).map((function(t){return t.propertyType,a.REPORT_PROPERTY_TYPE,de(de({},t),{},{parentId:e.id,isProperty:t.propertyType!==a.REPORT_PROPERTY_TYPE,hideInTree:t.propertyType!==a.REPORT_PROPERTY_TYPE,localName:t.name})}))),(r=a.treeList).splice.apply(r,[(null===(o=a.treeList)||void 0===o?void 0:o.length)||0,0].concat(Object(i.a)(a.attrsKV[e.id]))),a.handleNodeExpand({id:e.id}),"function"==typeof t&&t()})).finally((function(){a.loadingItems[e.id]=0,delete a.loadingItems[e.id]}));case 19:case"end":return n.stop()}}),n)})))()},handleFieldsChange:function(e){var t;(t=this.assetsFieldsSelect).splice.apply(t,[0,this.assetsFieldsSelect.length].concat(Object(i.a)(e)))},handleNodeClick:function(e,t){var a=this;if(null==e||!e.isProperty){var i=this.checkIsReportNode(e);this.currentNodeParentId=i?e.parentId:"",!i&&(this.currentNodeParentIdentifier=e.identifier),this.currentNodeId=e.id,this.currentNodeIdentifier=e.identifier;var r=!this.isThingModelAndNotReport;this.currentNode=e,this.fetchAttrsData(e),this.isThingModelAndNotReport&&this.$nextTick(Object(n.a)(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!r||!a.isThingModelAndNotReport){t.next=3;break}return t.next=3,a.initAssetsPanel();case 3:a.isAssets?a.$refs.assetsIns&&a.$refs.assetsIns.handleNodeClick(e):a.isTemplateThingModels&&a.$refs.templateModelIns&&a.$refs.templateModelIns.handleNodeClick(e);case 4:case"end":return t.stop()}}),t)}))))}},fetchModelTreeData:function(){var e=this;return Object(n.a)(s.a.mark((function t(){var a,i,n,r,o,l;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=e.$store.getters.portalInfo,!(n=e.projectIdentifier||(i.isManagement?"":i.nameEn))){t.next=9;break}return o={url:"/api/thing-model/thing-models/query-model-tree-info",method:"post",data:{projectIdentifier:n}},t.next=6,e.$util.request(o).then((function(e){l=e.modelTreeIdentifier}));case 6:r={url:"/api/thing-model/thing-models/query-model-profile",method:"post",data:{orderBy:"createTime desc",filter:"modelTreeIdentifier eq COMMON::IOT::".concat(l)}},t.next=10;break;case 9:r={url:"/api/model/profiles?pagination=0&lazyLoad=0&$orderBy= createTime desc",method:"get"};case 10:return t.next=12,e.$util.request(r).then((function(t){e.treeList=a=t}));case 12:return t.abrupt("return",a);case 13:case"end":return t.stop()}}),t)})))()},fetchAssets:function(e,t){var a=this;return Object(n.a)(s.a.mark((function e(){var i,n,r,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.length){e.next=9;break}return e.next=3,a.$util.request({url:"/api/thing-model/instances/query-profiles",method:"post",data:{objectTypeList:t.split(",")}});case 3:return n=e.sent,r=Object(g.n)((n||[]).map((function(e){return e.identifier}))),o=[],r.forEach((function(e){o.push(new Promise((function(t,i){var n={url:"/api/model/instances",method:"get",params:{objectType:e.join(","),pagination:0,$filter:"status eq 1",$orderBy:"updateTime desc",accessMethod:"foreign_key",relationProperties:"name"}};a.$util.request(n).then((function(e){t(e)})).catch((function(){t([])}))})))})),e.next=9,Promise.all(o).then((function(e){a.treeList=i=Object(g.m)(e)}));case 9:return e.abrupt("return",i);case 10:case"end":return e.stop()}}),e)})))()},fetchThingModelTree:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"IOT_MODEL",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=arguments.length>3?arguments[3]:void 0;return Object(n.a)(s.a.mark((function o(){var l,c;return s.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(l=[],!a){o.next=5;break}return t.isAssets?c={url:"/api/model/instances",method:"get",params:{objectType:a,$filter:"pathName leftlike ".concat(i).concat(r?",status ne ".concat(r):""),pagination:0,$orderBy:"createTime desc"}}:t.isTemplateThingModels&&(c={url:"/api/thing-model/model-template",method:"get",params:{$filter:"modelTemplateTreeIdentifier eq ".concat(t.modelTemplateTreeIdentifier),pagination:0,$orderBy:"createTime desc"}}),o.next=5,t.$util.request(c).then(function(){var a=Object(n.a)(s.a.mark((function a(i){var n,r;return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(!t.isAssets){a.next=7;break}return r=null===(n=(i||[]).map((function(e){return e.identifier})))||void 0===n?void 0:n.join(","),a.next=4,t.fetchAssets(e,r);case 4:l=a.sent,a.next=8;break;case 7:t.isTemplateThingModels&&(t.treeList=l=i);case 8:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}()).catch((function(e){}));case 5:return o.abrupt("return",l);case 6:case"end":return o.stop()}}),o)})))()},fetchTreeData:function(e){var t=this;return Object(n.a)(s.a.mark((function a(){var i,n;return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if("model"!==t.activeModel){a.next=5;break}return a.next=3,t.fetchModelTreeData(e);case 3:a.next=8;break;case 5:if("thingModel"!==t.activeModel){a.next=8;break}return a.next=8,t.fetchThingModelTree(e);case 8:!t.currentNodeParentId&&!t.currentNodeId||e||(i=function(){var e;t.currentNode=t.treeList.find((function(e){return e.id===t.currentNodeId||e.identifier===t.currentNodeIdentifier})),t.currentNodeId=(null===(e=t.currentNode)||void 0===e?void 0:e.id)||t.currentNodeId,t.$refs.modelsTree.setCurrentKey(t.currentNodeId),t.currentNode&&t.handleNodeClick(t.currentNode,!0)},t.currentNodeParentId?(n=t.treeList.find((function(e){return e.id===t.currentNodeParentId||e.identifier===t.currentNodeParentIdentifier})))&&t.fetchAttrsData(n,i):i());case 9:case"end":return a.stop()}}),a)})))()},initAssetsPanel:function(){var e=this;return Object(n.a)(s.a.mark((function t(){var a,i,n,r,l;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.isAssets){t.next=8;break}if(Object(g.tb)(null===(a=e.data)||void 0===a||null===(i=a.linkConfig)||void 0===i?void 0:i.origin)&&(n=Object(c.e)(e.data.linkConfig.origin),delete(r=Object(c.e)(e.data.linkConfig)).origin,l="indicator"===n.historyType,e.$setAttr(e.data,"linkConfig",de(de({},n),{},Object(o.a)({},l?"indicatorEditor":"rtEditor",r)))),t.t0=e.$refs.assetsIns,!t.t0){t.next=6;break}return t.next=6,e.$refs.assetsIns.initData();case 6:t.next=13;break;case 8:if(!e.isTemplateThingModels){t.next=13;break}if(t.t1=e.$refs.templateModelIns,!t.t1){t.next=13;break}return t.next=13,e.$refs.templateModelIns.initData();case 13:case"end":return t.stop()}}),t)})))()},handleModelTypeClick:function(e,t){var a=this;(null==e?void 0:e.id)!==this.activeModel&&(null!=e&&e.id&&this.resetData(),this.activeModel=(null==e?void 0:e.id)||this.activeModel,this.loadingTree=!0,this.$nextTick((function(){a.loadingTree=!1,a.initAssetsPanel()})),this.fetchTreeData())},resetNormalConfigs:function(){this.attrsKV={},this.isComplexArray||(this.filterArr=[{alias:"唯一标识",name:"id",type:"String",value:"",configs:{},filter:"eq",editValue:""}])},initData:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return Object(n.a)(s.a.mark((function a(){return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return e.clearInvalidateLink(),e.compUid=e._uid,e.resetNormalConfigs(),e.backupData(),a.next=6,e.fetchTreeData(t);case 6:t||e.$nextTick((function(){e.initAssetsPanel()})),e.getCompGroups();case 8:case"end":return a.stop()}}),a)})))()},backupData:function(){var e,t,a,n,r,o,l,s,u,d,p,h,f,m,v,b,g,y,_,C,O,T,V,w,P,x,S,j,E,k,I,A,D,N,$,L;(j="history"===(null===(e=this.data.linkConfig)||void 0===e||null===(t=e.origin)||void 0===t?void 0:t.queryType)?Object(c.e)(this.data.linkConfig.origin||this.data.linkConfig):Object(c.e)(this.data.linkConfig),this.activeModel=(null===(a=j)||void 0===a||null===(n=a.editValue)||void 0===n?void 0:n.activeModel)||"model",this.showVal=this.data.value,this.currentNodeId=null===(r=j)||void 0===r||null===(o=r.editValue)||void 0===o?void 0:o.treeId,this.currentNodeIdentifier=null===(l=j)||void 0===l||null===(s=l.editValue)||void 0===s?void 0:s.treeIdentifier,this.currentNodeParentId=null===(u=j)||void 0===u||null===(d=u.editValue)||void 0===d?void 0:d.treeParentId,this.currentNodeParentIdentifier=null===(p=j)||void 0===p||null===(h=p.editValue)||void 0===h?void 0:h.treeParentIdentifier,null!==(f=j)&&void 0!==f&&null!==(m=f.editValue)&&void 0!==m&&null!==(v=m.filtersArr)&&void 0!==v&&v.length&&(E=this.filterArr).splice.apply(E,[0,this.filterArr.length].concat(Object(i.a)(j.editValue.filtersArr))),null!==(b=j)&&void 0!==b&&null!==(g=b.editValue)&&void 0!==g&&null!==(y=g.orderByArr)&&void 0!==y&&y.length&&(k=this.orderByArr).splice.apply(k,[0,this.orderByArr.length].concat(Object(i.a)(j.editValue.orderByArr))),null!==(_=j)&&void 0!==_&&null!==(C=_.editValue)&&void 0!==C&&null!==(O=C.aggregationArr)&&void 0!==O&&O.length&&(I=this.aggregationArr).splice.apply(I,[0,this.aggregationArr.length].concat(Object(i.a)(j.editValue.aggregationArr))),null!==(T=j)&&void 0!==T&&null!==(V=T.editValue)&&void 0!==V&&null!==(w=V.complexFieldsConfigs)&&void 0!==w&&w.length&&(this.editVal.editValue.complexFieldsConfigs=null===(A=j)||void 0===A||null===(D=A.editValue)||void 0===D?void 0:D.complexFieldsConfigs),null!==(P=j)&&void 0!==P&&null!==(x=P.editValue)&&void 0!==x&&null!==(S=x.pagination)&&void 0!==S&&S.pageSize)&&(this.isComplex||(N=this.commonLinkSet.fields).splice.apply(N,[0,this.commonLinkSet.fields.length].concat(Object(i.a)((null===($=j)||void 0===$||null===(L=$.editValue)||void 0===L?void 0:L.fields)||[]))),this.commonLinkSet.defaultLoad=this.data.defaultLoad?1:0,this.commonLinkSet.rowField=j.editValue.rowField,this.commonLinkSet.rowValue=j.editValue.rowValue,this.commonLinkSet.functionIdentifier=j.editValue.functionIdentifier,this.commonLinkSet.groupList=j.editValue.groupList,this.commonLinkSet.pagination=j.pagination,this.commonLinkSet.commonFlag=j.commonFlag,this.commonLinkSet.pageSize=j.editValue.pagination.pageSize)},resetData:function(){this.editVal={url:"",linkType:1,contentType:"application/json",accessType:"api",method:"post",exceptionStrategy:"throw",fields:"",containsKey:1,pagination:0,dataType:"",requestPayload:{},responseSchema:{},variables:[],quickSelect:{},historySelect:[],isQuickSelect:!1,totalFields:[],editValue:{fields:[],complexFieldsConfigs:[],treeId:"",treeParentId:"",filtersArr:[],orderByArr:[{attr:"",sort:"asc"}],aggregationArr:[{attr:"",aggregationType:""}],functionIdentifier:[],rowField:"",rowValue:"",groupList:[],pagination:{page:"",pageSize:""}}},this.commonLinkSet={fields:[],functionIdentifier:[],rowField:"",rowValue:"",groupList:[],defaultLoad:1,commonFlag:!0,containsKey:1,pagination:1,pageSize:10},this.searchName="",this.treeList.splice(0,this.treeList.length),this.currentNodeId="",this.currentNodeIdentifier="",this.currentNodeParentId="",this.currentNodeParentIdentifier="",this.currentNode={},this.filterArr.splice(0,this.filterArr.length),this.orderByArr.splice(0,this.orderByArr.length,{attr:"",sort:"asc"}),this.aggregationArr.splice(0,this.aggregationArr.length,{attr:"",aggregationType:""}),this.activeModel="model",this.resetNormalConfigs(),this.autoBindComp={},this.autoBindOldCompIndex=-1,this.autoBindCompType=0},handleIconClick:function(){this.open()},open:function(){this.$setAttr(this.data,"editorDialogVisible",!0),this.dialogVisible=!0},clearData:function(){this.showVal="",this.$setAttr(this.data,"defaultArgs",""),this.$setAttr(this.data,"defaultLoad",!1),this.$removeAttr(this.data,"linkConfig"),this.$removeAttr(this.data,"lastValue"),this.$removeAttr(this.data,"value")},close:function(){this.commitLoading||(this.resetData(),this.$setAttr(this.data,"editorDialogVisible",!1),this.$setAttr(this.data,"editor","data-source"),this.dialogVisible=!1,this.$emit("onClose"))},clear:function(){var e=this;if(!this.commitLoading){this.data.linkConfig?this.$confirm("确定要清空数据配置吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.clearData(),e.dialogVisible=!1})).catch((function(){})).finally((function(){e.$emit("onClear")})):this.clearData()}},cancel:function(){this.close()},getShowVal:function(){return this.activeModel+": "+(this.currentNode.identifier||"")},getVariableNames:function(e){if(!e)return[];var t=Object(c.g)(e),a=[];if("string"===t){var n=e.match(/\$\{(.*?)\}/g)||[];a=[].concat(Object(i.a)(a),Object(i.a)(n))}else if("object"===t)for(var r in e){var o=e[r],l=this.getVariableNames(o);a=[].concat(Object(i.a)(a),Object(i.a)(l))}return a},formatVariables:function(e){return Array.from(new Set(e)).map((function(e){var t=/^\${(.+)}$/g.exec(e);if(!t)return e;var a=t[1];return a?a.replace(/(^\s*)|(\s*$)/g,""):e}))},getVariables:function(e){var t=this,a=this.getVariableNames(e.url);if("thingModel"===this.activeModel){var n=e.requestPayload.filterList.reduce((function(e,a){return[].concat(Object(i.a)(e),Object(i.a)(t.getVariableNames(a.fieldValue)))}),[]).filter((function(e){return""!==e}));a.push.apply(a,Object(i.a)(n))}return this.formatVariables(a)},getFilter:function(e){if(!e.length)return{};var t={$filter:"$filter="};return e.forEach((function(e){e.name&&e.value&&(t.$filter+="".concat("$filter="===t.$filter?"":",").concat(e.name," ").concat(e.filter," ").concat(e.value))})),t},getOrderBy:function(e){if(!e.length)return{};var t="$orderBy=";return e.forEach((function(e){e.attr&&e.sort?t+="".concat("$orderBy="===t?"":",").concat(e.attr," ").concat(e.sort):new RegExp(g.i).test(e.attr||"")&&(t+="".concat("$orderBy="===t?"":",").concat(e.attr))})),t},setEditValue:function(e){e.projectIdentifier=this.propertyIdentifier||"",e.editValue.activeModel=this.activeModel,e.editValue.filtersArr=Object(c.e)(this.filterArr),e.editValue.orderByArr=Object(c.e)(this.orderByArr),e.editValue.aggregationArr=Object(c.e)(this.aggregationArr),e.editValue.treeId=this.currentNodeId,e.editValue.treeIdentifier=this.currentNodeIdentifier,e.editValue.treeParentId=this.currentNodeParentId,e.editValue.treeParentIdentifier=this.currentNodeParentIdentifier,e.editValue.pagination.pageSize=this.commonLinkSet.pageSize,e.editValue.rowField=this.commonLinkSet.rowField,e.editValue.rowValue=this.commonLinkSet.rowValue,e.editValue.functionIdentifier=this.commonLinkSet.functionIdentifier,e.editValue.groupList=this.commonLinkSet.groupList,e.editValue.fields=this.commonLinkSet.fields,this.isComplex&&(e.editValue.complexFieldsConfigs=(this.fieldsForSelectComplexChecked.length?this.fieldsForSelectComplexChecked:this.fieldsForSelectComplex).map((function(e){return{fieldName:e.name,checked:e.checked,fillCompName:e.value}})))},getFields:function(){var e,t=this,a=[];return this.isComplex?a=this.fieldsForSelectComplexChecked.map((function(e){return e.name})):a=((a=null!==(e=this.commonLinkSet.fields)&&void 0!==e&&e.length?this.commonLinkSet.fields:this.fieldsForSelect.map((function(e){return e.propertyName||e.identifier})))||[]).filter((function(e){return![].concat(Object(i.a)(t.commonLinkSet.rowField?[t.commonLinkSet.rowField]:[]),Object(i.a)(t.commonLinkSet.rowValue?[t.commonLinkSet.rowValue]:[])).includes(e)})),(a||[]).join(",")},getAggregationList:function(){return(this.aggregationArr||[]).filter((function(e){return new RegExp(g.i).test(e.attr)||e.attr&&e.aggregationType})).map((function(e){return{fieldName:e.attr,type:e.aggregationType}}))},setLinkConfig:function(){this.data.type.indexOf("Enum")>-1?this.editVal.dataType="String":this.editVal.dataType=this.data.type,this.editVal.pagination=this.isComplexArray?this.commonLinkSet.pagination:0,this.editVal.commonFlag=this.commonLinkSet.commonFlag;var e=[];if(this.editVal.fields=this.getFields(),"model"===this.activeModel){var t=this.getFilter(this.filterArr);this.editVal.method="get";var a=this.currentNode.identifier;if(this.isComplexArray?this.editVal.url="/api/model/instances?objectType=".concat(a,"&pagination=").concat(this.editVal.pagination):this.editVal.url="/api/model/instances?objectType=".concat(a,"&pagination=0"),t.$filter&&(this.editVal.url+="".concat(this.editVal.url.indexOf("?")>-1?"&":"?").concat(t.$filter)),this.isComplexArray){var n=this.getOrderBy(this.orderByArr);this.editVal.url+="".concat(this.editVal.url.indexOf("?")>-1?"&":"?").concat(n)}this.editVal.pagination&&(this.editVal.url+="".concat(this.editVal.url.indexOf("?")>-1?"&":"?","$page=${").concat(this.pageName,"}&$pageSize=${").concat(this.pageSizeName,"}")),this.editVal.url+="&projectIdentifier=".concat(this.projectIdentifier)}else{if(this.checkIsReportNode(this.currentNode)){var r,o,l,s;this.editVal.url="/api/thing-model/instances/properties/query-report",this.editVal.method="post";var u=Array.isArray(this.commonLinkSet.functionIdentifier)&&(null===(r=this.commonLinkSet.functionIdentifier)||void 0===r?void 0:r.length)>1&&this.commonLinkSet.functionIdentifier[this.commonLinkSet.functionIdentifier.length-1]||"",d=(null===(o=this.orderByArr)||void 0===o?void 0:o.length)>0?this.orderByArr.map((function(e){return{fieldName:e.attr,type:e.sort}}))[0]:{},p=this.commonLinkSet.groupList.map((function(e){return{fieldName:e}})),h=null!=p&&p.length?this.getAggregationList():[];this.editVal.requestPayload={filterList:this.filterArr.map((function(e){return{fieldName:e.name,fieldValue:e.value,type:e.filter,dataType:e.dataType.type}})),sortMap:d,aggregationList:h,fields:(this.editVal.fields||"").split(","),rowField:this.commonLinkSet.rowField,rowValue:this.commonLinkSet.rowValue,functionIdentifier:u,functionId:null===(l=(this.functionListWithoutGroup||[]).find((function(e){return e.identifier===u})))||void 0===l?void 0:l.id,functionProjectIdentifier:(null===(s=(this.functionListWithoutGroup||[]).find((function(e){return e.identifier===u})))||void 0===s?void 0:s.projectIdentifier)||this.functionCommonProjectIdentifier,groupList:p,propertyIdentifier:this.currentNode.identifier,type:this.isProjectPage?2:1,page:"${".concat(this.pageName,"}"),pageSize:"${".concat(this.pageSizeName,"}"),pagination:this.editVal.pagination},this.editVal.fieldFlag=!!(this.commonLinkSet.rowField&&this.commonLinkSet.rowValue&&u)}}this.editVal.pagination&&(e=[this.pageName,this.pageSizeName]),this.setEditValue(this.editVal),this.editVal.variables=[].concat(Object(i.a)(e),Object(i.a)(this.getVariables(this.editVal))),this.$setAttr(this.data,"linkConfig",Object(c.e)(this.editVal))},setValue:function(){if(this.$setAttr(this.data,"defaultLoad",!!this.commonLinkSet.defaultLoad),this.isComplexArray&&!this.isComplex){var e,t=Object(c.b)((e={},Object(o.a)(e,this.pageName,1),Object(o.a)(e,this.pageSizeName,this.commonLinkSet.pageSize),e));this.$setAttr(this.data,"defaultArgs",t)}this.showVal=this.getShowVal(),this.$setAttr(this.data,"lastValue",this.showVal),this.$setAttr(this.data,"value",this.showVal)},setAssetsLinkConfig:function(){var e=this;return Object(n.a)(s.a.mark((function t(){var a;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.isAssets){t.next=6;break}return t.next=3,e.$refs.assetsIns.handleSubmit();case 3:a=t.sent,t.next=10;break;case 6:if(!e.isTemplateThingModels){t.next=10;break}return t.next=9,e.$refs.templateModelIns.handleSubmit();case 9:a=t.sent;case 10:e.data.type.indexOf("Enum")>-1?a.dataType="String":a.dataType=e.data.type,a.containsKey=1,a.pagination=0,a.fields=e.commonLinkSet.fields.join(","),a.editValue={treeId:"",treeParentId:"",filtersArr:[],pagination:{page:"",pageSize:""}},e.setEditValue(a),e.$setAttr(e.data,"linkConfig",Object(c.e)(a));case 17:case"end":return t.stop()}}),t)})))()},checkIfNeedAutoFill:function(){return this.isComplex?this.fieldsForSelectComplexChecked.some((function(e){return e.value})):Object.keys(this.autoBindComp||{}).length},clickSure:function(){var e=this;return Object(n.a)(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!0===e.validate()){t.next=2;break}return t.abrupt("return");case 2:if(!e.isThingModelAndNotReport){t.next=7;break}return t.next=5,e.setAssetsLinkConfig();case 5:t.next=8;break;case 7:e.setLinkConfig();case 8:e.setValue(),e.setScopedVariables(),e.autoFillComponents&&e.checkIfNeedAutoFill()?(e.commitLoading=!0,setTimeout((function(){e.doAutoFillComponent(),e.commitLoading=!1,e.close()}),0)):e.close();case 11:case"end":return t.stop()}}),t)})))()},getHandlerEditVal:function(){var e=Object(c.e)(this.editVal);return e.responseSchema||(e.responseSchema={}),e.requestPayload||(e.requestPayload={}),(e=Object.assign(e,this.baseEditVal)).variables=this.getVariables(e),e},validate:function(){var e;return this.isComplexArray||this.isAssets||this.isTemplateThingModels,this.isPoint&&!this.commonLinkSet.fields[0]&&(e="请选择呈现字段！"),e&&this.$message({message:e,type:"warning"}),!e},payloadsChange:function(e){this.refreshUrl();var t=this.payloadArrayToString(e);this.editVal.requestPayload=Object(c.j)(t)},payloadArrayToString:function(e){var t={};return e.forEach((function(e){t[e.name]=e.value})),JSON.stringify(t)},getEditValue:function(e){var t,a=/\$\{(.*?)\}/g.exec(e);return(null==a?void 0:a[0])===e?{static:"",type:"variable",variable:null===(t=a[1])||void 0===t?void 0:t.split(".")}:{static:e,type:"static",variable:[]}},getFieldsConfigs:function(){var e,t=this,a=function(e){var t,a,i=(null==e?void 0:e.configs)||(null==e||null===(t=e.dataType)||void 0===t?void 0:t.expands);if(!i)return[];var n=g.e[(null===(a=e.dataType)||void 0===a?void 0:a.type)||e.type||"String"],r=[],o={String:function(e){},Number:function(e){e.hasOwnProperty("intMin")?r.push({name:"min",alias:"最小值",value:e.intMin}):e.hasOwnProperty("doubleMin")&&r.push({name:"min",alias:"最小值",value:e.doubleMin}),e.hasOwnProperty("intMax")?r.push({name:"max",alias:"最大值",value:e.intMax}):e.hasOwnProperty("doubleMax")&&r.push({name:"max",alias:"最大值",value:e.doubleMax}),e.hasOwnProperty("intStep")?r.push({name:"step",alias:"步长",value:e.intStep}):e.hasOwnProperty("doubleStep")&&r.push({name:"step",alias:"步长",value:e.doubleStep}),e.hasOwnProperty("doubleDigits")&&r.push({name:"digits",alias:"精度",value:e.doubleDigits})},Boolean:function(e){e.hasOwnProperty("trueValue")&&r.push({name:"activeValue",alias:"确定值",value:e.trueValue}),e.hasOwnProperty("falseValue")&&r.push({name:"inactiveValue",alias:"否定值",value:e.falseValue})},Enum:function(e){Array.isArray(e.elements)&&(r=e.elements.map((function(e){return{name:e.text,alias:e.text,value:e.value}})))},DateTime:function(e){e.hasOwnProperty("format")&&(r=[{name:"format",alias:"格式",value:e.format}])}};return"function"==typeof o[n]&&o[n](i),r};this.isComplex?e=this.fieldsForSelectComplexChecked:e=((this.isThingModelAndNotReport?this.assetsFieldsSelect:this.attrsKV[this.currentNodeId])||[]).filter((function(e){return!t.commonLinkSet.fields.length||t.commonLinkSet.fields.includes(e.propertyName||e.identifier)}));return e.map((function(e){var i;return{name:t.isComplex?e.name:e.propertyName||e.identifier,alias:t.isComplex?e.alias:e.propertyLocalName||e.name,type:g.e[(null===(i=e.dataType)||void 0===i?void 0:i.type)||e.type||"String"],config:a(e)||[]}}))},setScopedVariables:function(){var e,t,a=this,i=(null===(e=this.currentComponent)||void 0===e?void 0:e.data)||this.currentPage.componentKV[this.data.componentFid||this.currentPage.activeComponentFid],n=null==i||null===(t=i.attributes)||void 0===t?void 0:t.scopedVariable;if(n){var r=this.getFieldsConfigs();n.default[0].objectAttr=r,n.attributes=Object(g.kb)("smartAttrs.scopedVariable"),Object(g.Cb)(n,n.readonly,(function(e){e.componentFid=a.data.componentFid,e.componentName=a.data.componentName,e.componentType=a.data.componentType}),!0)}},doAutoFillComponent:function(){try{var e={};this.isComplex?this.fieldsForSelectComplexChecked.filter((function(e){return e.value})).forEach((function(t){e[t.name]=t.value})):this.isPoint?this.commonLinkSet.fields.length&&(e[this.commonLinkSet.fields[0]]=this.autoBindComp.name):e=this.autoBindComp;var t=this.currentComponent.autoFillComponents;"function"==typeof t&&t(e,this.autoBindCompType?this.autoBindOldCompIndex:-1)}catch(e){}}}},he=(a("98b1"),Object(f.a)(pe,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"data-source-editor"},[e.showInput?t("el-input",{staticClass:"editor-input",attrs:{placeholder:e.placeholder,value:e.showVal,readonly:"",size:"mini",clearable:""},nativeOn:{click:function(t){return e.handleIconClick.apply(null,arguments)}}},[t("i",{staticClass:"el-input__icon array-editor-icon",class:e.iconClass,attrs:{slot:"suffix"},slot:"suffix"})]):e._e(),t("el-drawer",{ref:"editorDrawer",style:"--themeColor: ".concat(e.themeColor),attrs:{"custom-class":"data-source-editor-drawer",size:"1000px",visible:e.dialogVisible,direction:"rtl",wrapperClosable:!1,"append-to-body":!0,"show-close":!1},on:{"update:visible":function(t){e.dialogVisible=t},close:e.close}},[t("div",{staticClass:"editor-drawer-title",attrs:{slot:"title"},slot:"title"},[t("div",{staticClass:"title-text"},[t("iconfont",{attrs:{type:"icon-close"},on:{click:e.close}}),e._v("\n        数据配置\n      ")],1),t("div",{staticClass:"title-btn"},[t("el-button",{attrs:{size:"small"},on:{click:e.clear}},[e._v("\n          清空\n        ")]),t("el-button",{attrs:{type:"primary",size:"small",loading:e.commitLoading},on:{click:e.clickSure}},[e._v("\n          "+e._s(e.commitLoading?"正在填充组件...":"提交")+"\n        ")])],1)]),t("div",{staticClass:"data-source-editor-container",attrs:{"comp-uid":e.compUid}},[t("api-alert",{staticClass:"data-source-alert",attrs:{title:"用于配置数据来源，将数据来源加载的数据填充至数据容器的变量，具体步骤是：首先选择数据模型，在数据模型中选择数据模型实例，再配置筛选字段，最后选择承载数据的组件/二开组件"}}),t("div",{staticClass:"data-source-editor-type"},e._l(e.modelTypes,(function(a){return t("div",{key:a.id,class:["data-source-editor-type-card",{active:a.id===e.activeModel}],on:{click:function(t){return e.handleModelTypeClick(a,t)}}},[a.id===e.activeModel?t("div",{staticClass:"data-source-editor-type-card-active"},[t("iconfont",{style:{color:"#FFF"},attrs:{type:"icon-ic20-check"}})],1):e._e(),t("div",{staticClass:"data-source-editor-type-card-title"},[t("ModelSvg",{staticClass:"data-source-editor-type-card-icon",attrs:{right:6,type:a.id===e.activeModel?"fill":"default",icon:a.icon}}),t("span",[e._v(e._s(a.name))])],1),t("div",{staticClass:"data-source-editor-type-card-content"},[e._v("\n            "+e._s(a.content)+"\n          ")])])})),0),t("div",{staticClass:"data-source-editor-box"},[t("div",{staticClass:"data-source-editor-tree"},[t("el-input",{attrs:{placeholder:"请输入需检索的名称","suffix-icon":"el-icon-search"},model:{value:e.searchName,callback:function(t){e.searchName=t},expression:"searchName"}}),e.loadingTree?e._e():t("el-tree",{ref:"modelsTree",staticClass:"models-tree",attrs:{data:e.treeData,props:e.treeProps[e.activeModel],"highlight-current":!0,"current-node-key":e.currentNodeId,"default-expanded-keys":Object.keys(e.defaultExpandedKeys),"node-key":"id","expand-on-click-node":!1,"auto-expand-parent":""},on:{"node-click":e.handleNodeClick,"node-expand":e.handleNodeExpand,"node-collapse":e.handleNodeCollapse},scopedSlots:e._u([{key:"default",fn:function(a){var i=a.node,n=a.data;return t("div",{staticClass:"models-tree-node"},[t("ModelSvg",{staticClass:"icon-prefix",attrs:{right:6,currentNode:n,type:n.isProperty?"color":"fill",icon:e.getIcon(e.item)}}),t("span",{staticClass:"tree-title"},[e._v(e._s(i.label))]),e.isComplexArray&&n.isProperty&&!n.noAddable?t("iconfont",{staticClass:"icon-suffix property-add-icon",attrs:{type:"icon-ic24-plus",right:8},on:{click:function(t){return t.stopPropagation(),e.addAttrToFilters(n)}}}):e._e(),e.loadingItems[n.id]&&!n.isProperty?t("i",{staticClass:"icon-suffix el-icon-loading"}):e._e()],1)}}],null,!1,3877250521)})],1),t("div",{staticClass:"data-source-editor-content"},[t("div",{staticClass:"data-source-editor-colbox data-source-editor-filters"},[e.isAssets?t("assets",{ref:"assetsIns",attrs:{data:e.data},on:{fieldsChange:e.handleFieldsChange}}):e.isTemplateThingModels?t("template-thing-model",{ref:"templateModelIns",attrs:{data:e.data},on:{fieldsChange:e.handleFieldsChange}}):t("el-collapse",{staticClass:"data-source-editor-collapse t-border",attrs:{value:"filters",accordion:""}},[t("el-collapse-item",{attrs:{name:"filters"}},[t("template",{slot:"title"},[t("div",{staticClass:"data-source-editor-collapse-title"},[t("div",[t("span",[e._v("筛选字段")]),t("basic-tips",{attrs:{type:"popover",title:"配置说明",width:600,placement:"bottom-start",iconStyle:{color:"#C9D0D4"},content:""}},[t("div",[t("div",[e._v("用于约束数据模型实例数据，可配置动态参数值")])])])],1)])]),e.filterArr.length?t("filters-select",{staticClass:"data-source-editor-filters-table",attrs:{allowEmpty:e.isComplexArray,"param-names":e.paramNames,value:e.filterArr}}):t("div",{staticClass:"data-source-editor-empty-list"},[t("empty-list",{attrs:{width:100}},[e._v("\n                    暂无筛选字段，从左侧模型树中添加筛选字段\n                  ")])],1)],2)],1)],1),e.isThingModelAndReport||e.isComplexArray&&"model"===e.activeModel?t("div",{staticClass:"data-source-editor-colbox data-source-editor-orderby"},[t("el-collapse",{staticClass:"data-source-editor-collapse t-border",attrs:{value:"orderBy",accordion:""}},[t("el-collapse-item",{attrs:{name:"orderBy"}},[t("template",{slot:"title"},[t("div",{staticClass:"data-source-editor-collapse-title"},[t("div",[t("span",[e._v("排序")])])])]),t("orderby-setting",{attrs:{sortClearable:"",operationsLayout:e.orderByOperations,showPublicAdd:!e.isThingModelAndReport||e.orderByArr.length<1},model:{value:e.orderByArr,callback:function(t){e.orderByArr=t},expression:"orderByArr"}})],2)],1)],1):e._e(),e.currentNodeId&&e.isThingModelAndReport?t("div",{staticClass:"data-source-editor-colbox data-source-editor-row_col"},[t("el-collapse",{staticClass:"data-source-editor-collapse t-border",attrs:{accordion:""}},[t("el-collapse-item",{attrs:{name:"default"}},[t("template",{slot:"title"},[t("div",{staticClass:"data-source-editor-collapse-title"},[t("div",[t("span",[e._v("行转列")])])])]),t("el-form",{attrs:{model:e.commonLinkSet,"label-width":"110px"}},[t("el-form-item",{attrs:{prop:"rowField"}},[t("template",{slot:"label"},[t("span",[e._v("列字段")]),t("basic-tips",{attrs:{type:"popover",title:"配置说明",width:600,placement:"bottom-start",iconStyle:{color:"#C9D0D4"},content:""}},[t("div",[t("div",[e._v("选中字段后，容器提供的变量对象中额外增加变量属性rowField")]),t("div",[e._v("rowField值为选中字段的值集合")]),t("div",[e._v('例如：选中字段为姓名，则值为[{"label": \'张三\'， "prop": "张三"},...]')])])]),t("span",[e._v("：")])],1),t("el-select",{attrs:{clearable:""},on:{change:e.rowFieldChange},model:{value:e.commonLinkSet.rowField,callback:function(t){e.$set(e.commonLinkSet,"rowField",t)},expression:"commonLinkSet.rowField"}},e._l(e.attrsKV[e.currentNodeId],(function(e){return t("el-option",{key:e.propertyName,attrs:{label:e.propertyLocalName,value:e.propertyName}})})),1)],2),t("el-form-item",{attrs:{prop:"rowValue"}},[t("template",{slot:"label"},[t("span",[e._v("值字段")]),t("basic-tips",{attrs:{type:"popover",title:"配置说明",width:600,placement:"bottom-start",iconStyle:{color:"#C9D0D4"},content:""}},[t("div",[t("div",[e._v("该字段将作为“列字段”所对应的显示值，即接口中返回的“列字段”的数据来源字段")])])]),t("span",[e._v("：")])],1),t("el-select",{attrs:{clearable:""},on:{change:e.rowValueChange},model:{value:e.commonLinkSet.rowValue,callback:function(t){e.$set(e.commonLinkSet,"rowValue",t)},expression:"commonLinkSet.rowValue"}},e._l(e.attrsKV[e.currentNodeId],(function(e){return t("el-option",{key:e.propertyName,attrs:{label:e.propertyLocalName,value:e.propertyName}})})),1)],2),t("el-form-item",{attrs:{prop:"functionIdentifier"}},[t("template",{slot:"label"},[t("span",[e._v("处理函数")]),t("span",[e._v("：")])]),t("el-cascader",{staticStyle:{width:"100%"},attrs:{"show-all-levels":!1,options:e.functionList,props:e.functionCascaderProps,clearable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.node;return t.data,[e._v("\n                        "+e._s(a.label)+"\n                      ")]}}],null,!1,3848430462),model:{value:e.commonLinkSet.functionIdentifier,callback:function(t){e.$set(e.commonLinkSet,"functionIdentifier",t)},expression:"commonLinkSet.functionIdentifier"}})],2)],1)],2)],1)],1):e._e(),e.currentNodeId&&e.isThingModelAndReport?t("div",{staticClass:"data-source-editor-colbox data-source-editor-group_aggregation"},[t("el-collapse",{staticClass:"data-source-editor-collapse t-border",attrs:{accordion:""}},[t("el-collapse-item",{attrs:{name:"default"}},[t("template",{slot:"title"},[t("div",{staticClass:"data-source-editor-collapse-title"},[t("div",[t("span",[e._v("分组&聚合")])])])]),t("div",{staticClass:"data-source-editor-group_aggregation-tips"},[t("i",{staticClass:"el-icon-info"}),e._v("\n                  "+e._s(e.groupAggregationTips)+"\n                ")]),t("el-form",{attrs:{model:e.commonLinkSet,"label-width":"110px"}},[t("el-form-item",{attrs:{prop:"groupList"}},[t("template",{slot:"label"},[t("span",[e._v("分组字段")]),t("span",[e._v("：")])]),t("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",multiple:""},on:{change:e.groupListChange},model:{value:e.commonLinkSet.groupList,callback:function(t){e.$set(e.commonLinkSet,"groupList",t)},expression:"commonLinkSet.groupList"}},e._l(e.attrsKV[e.currentNodeId],(function(e){return t("el-option",{key:e.propertyName,attrs:{label:e.propertyLocalName,value:e.propertyName}})})),1)],2),t("el-form-item",{attrs:{prop:"groupList"}},[t("template",{slot:"label"},[t("span",[e._v("聚合配置")]),t("span",[e._v("：")])]),t("aggregation-setting",{attrs:{typeClearable:"",nameOptions:e.currentAttrsLV},model:{value:e.aggregationArr,callback:function(t){e.aggregationArr=t},expression:"aggregationArr"}})],2)],1)],2)],1)],1):e._e(),t("div",{staticClass:"data-source-editor-queries"},[t("el-collapse",{staticClass:"data-source-editor-queries t-border data-source-editor-collapse",attrs:{value:"filters",accordion:""}},[t("el-collapse-item",{attrs:{name:"filters"}},[t("template",{slot:"title"},[t("div",{staticClass:"data-source-editor-collapse-title"},[t("div",[t("span",[e._v("呈现数据"+e._s(e.currentNode.localName?"【".concat(e.currentNode.localName,"】"):""))]),t("basic-tips",{attrs:{type:"popover",title:"配置说明",width:600,placement:"bottom-start",iconStyle:{color:"#C9D0D4"},content:""}},[t("div",[t("div",[e._v("用于配置勾选字段、自动填充至数据容器内的组件、分页等")])])])],1)])]),t("div",{staticClass:"data-source-editor-queries-content"},[t("div",{staticClass:"data-source-editor-queries-tips"},[t("i",{staticClass:"el-icon-info"}),e._v("\n                    "+e._s(e.queriesTips)+"\n                  ")]),e.currentNodeId?t("el-form",{attrs:{model:e.commonLinkSet,"label-width":"110px"}},[e.isComplex?e._e():t("el-form-item",{attrs:{label:"呈现字段：",prop:"fields",required:e.isPoint}},[e.isComplexArray?t("el-checkbox-group",{model:{value:e.commonLinkSet.fields,callback:function(t){e.$set(e.commonLinkSet,"fields",t)},expression:"commonLinkSet.fields"}},[t("draggable",{on:{start:function(t){return t.stopPropagation(),e.handleCompEvent("start",t)},end:function(t){return t.stopPropagation(),e.handleCompEvent("end",t)}}},e._l(e.fieldsForSelect,(function(a){return t("el-checkbox",{key:a.propertyName||a.identifier,staticClass:"queries-fields-checkbox",attrs:{title:"".concat(a.propertyLocalName||a.name,"(").concat(a.propertyName||a.identifier,")"),label:a.propertyName||a.identifier,disabled:e.checkRowToCol(a)}},[e._v(e._s(a.propertyLocalName||a.name))])})),1)],1):t("el-radio-group",{model:{value:e.commonLinkSet.fields[0],callback:function(t){e.$set(e.commonLinkSet.fields,0,t)},expression:"commonLinkSet.fields[0]"}},e._l(e.fieldsForSelect,(function(a){return t("el-radio",{key:a.propertyName||a.identifier,staticClass:"queries-fields-checkbox",attrs:{label:a.propertyName||a.identifier}},[e._v(e._s(a.propertyLocalName||a.name))])})),1)],1),e.isComplex?e._e():t("el-form-item",{attrs:{label:"呈现组件："}},[t("div",{staticClass:"comps-box"},e._l(e.compOptions,(function(a){return t("div",{key:a.name,class:["comps-card",{active:e.autoBindComp.name===a.name}],attrs:{title:"".concat(a.alias,"(").concat(a.name,")")},on:{click:function(t){return e.handleCompClick(a)}}},[t("iconfont",{staticClass:"comps-icon",attrs:{type:"icon-ic24-view-lp"}}),t("div",{staticClass:"comps-name"},[e._v("\n                            "+e._s(a.alias)+"\n                          ")])],1)})),0)]),e.autoBindOldCompIndex>-1?t("el-form-item",{attrs:{label:"呈现方式：",prop:"defaultLoad"}},[t("el-switch",{attrs:{"active-value":1,"active-text":"保留并更新","inactive-value":0,"inactive-color":e.themeConstColor.danger,"inactive-text":"清空再填充"},model:{value:e.autoBindCompType,callback:function(t){e.autoBindCompType=t},expression:"autoBindCompType"}})],1):e._e(),e.isComplex?t("div",[e.fieldsForSelectComplex.length?t("fields-comps-select",{staticClass:"data-source-editor-fields-comps-table",attrs:{value:e.fieldsForSelectComplex,compOptions:e.compOptions}}):e._e()],1):e._e(),t("el-form-item",{attrs:{label:"默认加载：",prop:"defaultLoad"}},[t("el-switch",{attrs:{"active-value":1,"inactive-value":0},model:{value:e.commonLinkSet.defaultLoad,callback:function(t){e.$set(e.commonLinkSet,"defaultLoad",t)},expression:"commonLinkSet.defaultLoad"}})],1),e.isComplexArray&&!e.isThingModelAndNotReport?t("el-form-item",{attrs:{label:"分页：",prop:"pagination"}},[t("el-switch",{attrs:{"active-value":1,"inactive-value":0},model:{value:e.commonLinkSet.pagination,callback:function(t){e.$set(e.commonLinkSet,"pagination",t)},expression:"commonLinkSet.pagination"}})],1):e._e(),e.isComplexArray&&!e.isThingModelAndNotReport&&e.commonLinkSet.defaultLoad&&e.commonLinkSet.pagination?t("el-form-item",{attrs:{label:"分页数量：",prop:"pageSize"}},[t("el-select",{model:{value:e.commonLinkSet.pageSize,callback:function(t){e.$set(e.commonLinkSet,"pageSize",t)},expression:"commonLinkSet.pageSize"}},e._l(e.pageSizeOptions,(function(e){return t("el-option",{key:e,attrs:{label:e+"条/页",value:e}})})),1)],1):e._e(),"model"===e.activeModel&&e.isProject?t("el-form-item",{attrs:{label:"包含公共数据：",prop:"commonFlag"}},[t("el-switch",{model:{value:e.commonLinkSet.commonFlag,callback:function(t){e.$set(e.commonLinkSet,"commonFlag",t)},expression:"commonLinkSet.commonFlag"}})],1):e._e()],1):e._e()],1)],2)],1)],1)])])],1)])],1)}),[],!1,null,null,null));t.default=he.exports},dd81:function(e,t,a){},dd8a:function(e,t,a){"use strict";a.r(t);var i=a("7618"),n=(a("6762"),a("2fdb"),a("7f7f"),a("c276")),r=a("b19c"),o="application/json",l="htmlmixed",s={name:"CodeEditor",props:{iconClass:{type:String,default:function(){return"el-icon-edit"}},params:{type:Object,default:function(){return{language:"json"}}},data:{type:Object,default:function(){return{alias:"",type:"",default:"",value:"",primitiveLabels:""}}},placeholder:{type:String,default:""},handleRulesResult:{type:Function,default:function(){}},handleChangeResult:{type:Function,default:function(){}},open:{type:Function,default:function(){}},close:{type:Function,default:function(){}},appendToBody:{type:Boolean,default:!1},customValidate:{type:Function,default:function(){}}},data:function(){return{attrType:"String",dataLength:0,primitiveLabels:"",showVal:null,editorVal:null,dialogVisible:!1,parsedTypeResult:null,mode:{json:o,html:l},codeParams:{language:o},language:""}},watch:{data:{handler:function(){this.initData()},deep:!0},dialogVisible:function(e){e&&this.initData()}},created:function(){this.initData()},methods:{getVal:function(e){return e.linkable&&e.linkConfig?e.linkConfig:Object(n.pb)(e.value,e.default||Object(n.nb)(e.name))},initData:function(){this.language=this.mode[this.params.language]||o,this.codeParams.language=this.language;var e=this.getVal(this.data);this.language===o?(this.editorVal=Object(r.b)(Object(r.e)(e))||"",this.showVal=Object(r.b)(e)):this.language===l&&(this.editorVal="".concat(Object(r.c)(e)||e||""),this.showVal="".concat(Object(r.c)(e)||e||""))},handleIconClick:function(){"function"==typeof this.open&&this.open(),this.dialogVisible=!0},cancel:function(){"function"==typeof this.close&&this.close(),this.dialogVisible=!1,this.initData()},clickSure:function(){try{var e,t,a;if("function"==typeof this.customValidate)if(!1===this.customValidate(this.editorVal))return;if("function"==typeof(null===(e=this.$refs)||void 0===e||null===(t=e.codeEditor)||void 0===t?void 0:t.validate)&&(null===(a=this.$refs)||void 0===a||!a.codeEditor.validate()))return;if(!1===this.handleChangeResult(this.editorVal,this.data))return void this.$setAttr(this.data,"lastValue",this.data.lastValue);if(this.language===o){var n=JSON.parse(this.editorVal);if(["number"].includes(Object(i.a)(n)))throw new Error("格式不合法");this.$setAttr(this.data,"value",n),this.$setAttr(this.data,"lastValue",n),this.$emit("change",n)}else this.language===l?(this.$setAttr(this.data,"value",Object(r.d)(this.editorVal)),this.$setAttr(this.data,"lastValue",Object(r.d)(this.editorVal)),this.$emit("change",Object(r.d)(this.editorVal))):this.$emit("change",this.editorVal);this.showVal=this.editorVal,this.cancel()}catch(e){if(null===this.editorVal||""===this.editorVal)this.$setAttr(this.data,"value",this.editorVal),this.$setAttr(this.data,"lastValue",this.editorVal),this.showVal=this.editorVal,this.cancel(),this.$emit("change",null);else{var s=this.params.language?this.params.language:"json";this.$message({message:"输入正确格式的".concat(s,"数据！"),type:"warning"})}}},codeEditorBlur:function(e){this.editorVal=e},clear:function(){this.editorVal=""},dialogOpened:function(){this.$refs.codeEditor&&"function"==typeof this.$refs.codeEditor.initData&&this.$refs.codeEditor.initData()}}},c=(a("71d3"),a("2877")),u=Object(c.a)(s,(function(){var e=this,t=e._self._c;return t("div",[t("el-input",{staticClass:"array-editor-input",attrs:{title:e.showVal,readonly:"",size:"mini",placeholder:e.placeholder,value:e.showVal},nativeOn:{click:function(t){return e.handleIconClick.apply(null,arguments)}}},[t("i",{staticClass:"el-input__icon array-editor-icon",class:e.iconClass,attrs:{slot:"suffix"},slot:"suffix"})]),t("el-dialog",{staticClass:"code-editor-dialog",attrs:{"append-to-body":e.appendToBody,draggable:!0,visible:e.dialogVisible,"close-on-click-modal":!1,title:"编辑"+e.data.alias,width:"40%"},on:{close:e.cancel,opened:e.dialogOpened}},[t("base-code-editor",{ref:"codeEditor",attrs:{value:e.editorVal,readOnly:e.data.readonly,params:e.codeParams},on:{blur:e.codeEditorBlur}}),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"danger"},on:{click:e.clear}},[e._v("清 空")]),t("el-button",{on:{click:e.cancel}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.clickSure}},[e._v("确 定")])],1)],1)],1)}),[],!1,null,null,null);t.default=u.exports},ddab:function(e,t,a){"use strict";a.r(t);var i=(a("7f7f"),a("c276")),n=a("b19c"),r={name:"OrganizationEditor",components:{},props:{iconClass:{type:String,default:function(){return"el-icon-edit"}},data:{type:Object,default:function(){return{alias:"",type:"",default:"",value:"",primitiveLabels:""}}},placeholder:{type:String,default:"请选择"},handleRulesResult:{type:Function,default:function(){}},handleChangeResult:{type:Function,default:function(){}}},data:function(){return{attrType:"String",currentNodeKey:"",dataLength:0,primitiveLabels:"",showVal:null,editorVal:"",orgId:"",dialogVisible:!1,parsedTypeResult:null,treeProps:{label:"name"},rootNode:{id:"-1",label:"/",name:"/"}}},watch:{data:{handler:function(){this.initData()},deep:!0}},computed:{fetchOption:function(){return{url:"/api/model/instances",params:{objectType:this.$store.getters.website.organizationProfileIdentifier,queryMode:"simple",pagination:0,lazyLoad:0,orderBy:"identifier asc"},meta:{hideMessage:!0}}}},created:function(){this.initData()},methods:{getOrgInfo:function(e){var t=this;e?this.$util.request({url:"/api/model/instances/".concat(e),method:"get",params:{objectType:"organization",queryMode:"simple"}}).then((function(e){t.showVal=e.name})):this.showVal=""},getVal:function(e){return e.linkable&&e.linkConfig?e.linkConfig:Object(i.pb)(e.value,e.default||Object(i.nb)(e.name))||e},initData:function(){var e=this.getVal(this.data);this.editorVal=Object(n.e)(e)||""},handleIconClick:function(){this.dialogVisible=!0},cancel:function(){this.dialogVisible=!1,this.initData()},handleCurrentChange:function(e){this.editorVal=e,this.showVal=e.name},handleTreeDone:function(){},clickSure:function(){if(this.editorVal){if(!1===this.handleChangeResult(this.editorVal,this.data))return void this.$setAttr(this.data,"lastValue",this.data.lastValue);this.$setAttr(this.data,"value",this.editorVal),this.$setAttr(this.data,"lastValue",this.editorVal),this.$emit("change",this.editorVal),this.dialogVisible=!1}else this.$message({message:"请选择一个机构！",type:"warning"})}}},o=(a("3380"),a("2877")),l=Object(o.a)(r,(function(){var e=this,t=e._self._c;return t("div",[t("selector-tree",{ref:"defaultMenu",attrs:{fetchOption:e.fetchOption,placeholder:"请选择机构","root-node":e.rootNode,"show-icon":!0,props:e.treeProps,clearable:!0},model:{value:e.data.value,callback:function(t){e.$set(e.data,"value",t)},expression:"data.value"}})],1)}),[],!1,null,null,null);t.default=l.exports},ddac:function(e,t,a){},ddb8:function(e,t,a){"use strict";a.r(t),a("7f7f");var i=(a("5df3"),a("4f7f"),a("75fc")),n=(a("6762"),a("ac6a"),a("6c7b"),a("a542")),r=a("c276"),o=a("b19c"),l={name:"ArrayEditor",props:{iconClass:{type:String,default:function(){return"el-icon-edit"}},data:{type:Object,default:function(){return{alias:"",type:"",default:"",value:"",primitiveLabels:""}}},handleRulesResult:{type:Function,default:function(){}},handleChangeResult:{type:Function,default:function(){}},placeholder:{type:String,default:""}},data:function(){return{attrType:"String",dataLength:0,primitiveLabels:"",showVal:null,editorVal:null,dialogVisible:!1,parsedTypeResult:null,rulesResult:null}},watch:{data:{handler:function(){this.initData()},deep:!0},dialogVisible:function(e){e&&this.initData()}},created:function(){this.initData()},beforeDestroy:function(){this.parsedType.destroy()},methods:{onInputNumberBlur:function(e){var t;!1===this.data.required||void 0!==this.editorVal[e]&&void 0!==this.editorVal[e]||this.$setAttr(this.editorVal,e,(null==this||null===(t=this.data)||void 0===t?void 0:t.default[e])||0)},getValueByDefault:function(e,t){return"maxlength"===t?Object(r.pb)(e,r.a.MAX_LENGTH):"minlength"===t?Object(r.pb)(e,r.a.MIN_LENGTH):"max"===t?Object(r.pb)(e,r.a.MAX):"min"===t?Object(r.pb)(e,r.a.MIN):"precision"===t?Object(r.pb)(e,r.a.NUMBER_PRECISION):"step"===t?Object(r.pb)(e,r.a.NUMBER_STEP):"stepStrictly"===t?Object(r.pb)(e,r.a.NUMBER_STEP_STRICTLY):e},initData:function(){this.primitiveLabels=this.data.primitiveLabels||"",this.parsedType=new n.a(this.data.type),this.parsedTypeResult=this.parsedType.getResult(),this.attrType=this.parsedTypeResult.type,this.dataLength=this.parsedType.getLen();var e=Object(r.pb)(this.data.value,this.data.default||Object(r.nb)(this.data.name));if(this.editorVal=Object(o.e)(e),this.showVal=this.getShowContent(e),"*"!==this.dataLength&&(this.dataLength=1*this.dataLength),"array"!==Object(o.g)(this.editorVal))"*"===this.dataLength?this.editorVal=[void 0]:this.editorVal=new Array(this.dataLength).fill(void 0);else{if("*"!==this.dataLength&&this.editorVal.length<this.dataLength){var t=new Array(this.dataLength).fill(void 0);this.editorVal=this.editorVal.concat(t),this.editorVal=this.editorVal.slice(0,this.dataLength)}e.length||(this.editorVal=[void 0])}},getShowContent:function(e){if("Enum"===this.attrType){var t=this.parsedTypeResult.attach,a=[];return e.forEach((function(e){var i=t.filter((function(t){return t.value===e}));a.push(i[0].label)})),a}return e},handleIconClick:function(){this.dialogVisible=!0},cancel:function(){this.dialogVisible=!1},close:function(){this.dialogVisible=!1},reset:function(){var e=this;this.$confirm("确定要恢复默认值吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.$removeAttr(e.data,"value"),e.$removeAttr(e.data,"lastValue"),e.close()})).catch((function(){}))},clickSure:function(){var e=this,t=this.rulesResult;if(t&&!0!==t)this.rulesResult=null;else{var a=this.editorVal.filter((function(e){return void 0!==e})),n=this.editorVal.filter((function(e){return void 0===e}));if(!1!==this.handleChangeResult(this.editorVal,this.data)){if(n.length&&n.length<this.editorVal.length?this.editorVal.forEach((function(t,a){void 0===t&&(e.editorVal[a]=null)})):a&&!a.length&&(this.editorVal=void 0),void 0===this.editorVal)return this.editorVal=[void 0],void this.$message({type:"error",message:"请至少输入一行值"});if(["iterateKeys","foreachItemAttr"].includes(this.data.name)&&Array.isArray(this.editorVal))if(Object(i.a)(new Set(this.editorVal)).length<this.editorVal.length)return void this.$message({type:"error",message:"请勿输入重复值"});this.$setAttr(this.data,"value",this.editorVal),this.$setAttr(this.data,"lastValue",this.editorVal),this.showVal=this.editorVal,this.dialogVisible=!1}else this.$setAttr(this.data,"lastValue",this.data.lastValue)}},addItem:function(){var e=this.data.maxItemLength||r.a.MAX_LENGTH_ADD;this.editorVal.length<e?this.editorVal.push(""):this.$message({message:"最多添加"+e+"项！",type:"warning"})},deleteItem:function(e){this.editorVal.splice(e,1)},blurInput:function(e,t){var a=this.rulesResult=this.handleRulesResult(e,this.data);a&&!0!==a&&(this.$message.warning(a),this.$setAttr(this.editorVal,t,this.showVal[t]))}}},s=(a("5a6b"),a("2877")),c=Object(s.a)(l,(function(){var e=this,t=e._self._c;return t("div",[t("el-input",{staticClass:"array-editor-input",attrs:{title:e.showVal,readonly:"",placeholder:e.placeholder,value:e.showVal,size:"mini"},nativeOn:{click:function(t){return e.handleIconClick.apply(null,arguments)}}},[t("i",{staticClass:"el-input__icon array-editor-icon",class:e.iconClass,attrs:{slot:"suffix"},slot:"suffix"})]),t("el-dialog",{staticClass:"array-editor-dialog",attrs:{draggable:!0,visible:e.dialogVisible,"close-on-click-modal":!1,title:"编辑"+e.data.alias,width:"400px","append-to-body":!0},on:{close:e.cancel}},[t("el-form",{staticClass:"array-editor-form",staticStyle:{width:"80%"},attrs:{"label-width":"80px"}},e._l(e.editorVal,(function(a,i){return t("el-form-item",{key:i,attrs:{label:e.primitiveLabels?e.primitiveLabels[i]:"第".concat(i+1,"项")}},["color"===e.data.editor?t("color-picker",{ref:e.data.name+"-"+i,refInFor:!0,attrs:{"show-alpha":"",width:"70%","color-format":e.data.colorFormat},model:{value:e.editorVal[i],callback:function(t){e.$set(e.editorVal,i,t)},expression:"editorVal[index]"}}):"String"===e.attrType?t("el-input",{attrs:{width:"70%",maxlength:e.getValueByDefault(e.data.maxlength,"maxlength"),minlength:e.getValueByDefault(e.data.minlength,"minlength")},on:{blur:function(t){return e.blurInput(a,i)}},model:{value:e.editorVal[i],callback:function(t){e.$set(e.editorVal,i,t)},expression:"editorVal[index]"}}):"Number"===e.attrType?t("el-input-number",{attrs:{width:"70%","controls-position":"right",min:e.getValueByDefault(e.data.min,"min"),max:e.getValueByDefault(e.data.max,"max"),precision:e.getValueByDefault(e.data.precision,"precision"),step:e.getValueByDefault(e.data.step,"step"),"step-strictly":e.getValueByDefault(e.data["step-strictly"],"stepStrictly")},on:{blur:function(){return e.onInputNumberBlur(i)}},model:{value:e.editorVal[i],callback:function(t){e.$set(e.editorVal,i,t)},expression:"editorVal[index]"}}):"Boolean"===e.attrType?t("el-switch",{attrs:{width:"70%","active-color":"#13ce66","inactive-color":"#ff4949"},model:{value:e.editorVal[i],callback:function(t){e.$set(e.editorVal,i,t)},expression:"editorVal[index]"}}):"Enum"===e.attrType?t("el-select",{attrs:{placeholder:"请选择"},model:{value:e.editorVal[i],callback:function(t){e.$set(e.editorVal,i,t)},expression:"editorVal[index]"}},e._l(e.parsedTypeResult.attach,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1):e._e(),"*"===e.dataLength&&0===i?t("el-button",{staticClass:"opt-btn",attrs:{size:"mini",type:"success",icon:"el-icon-plus",circle:""},on:{click:e.addItem}}):"*"===e.dataLength&&0!==i?t("el-button",{staticClass:"opt-btn",attrs:{size:"mini",type:"danger",icon:"el-icon-minus",circle:""},on:{click:function(t){return e.deleteItem(i)}}}):e._e()],1)})),1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.reset}},[e._v("恢复默认")]),t("el-button",{on:{click:e.cancel}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.clickSure}},[e._v("确 定")])],1)],1)],1)}),[],!1,null,null,null);t.default=c.exports},df4b:function(e,t,a){},df8e:function(e,t,a){"use strict";a("488c")},dfcf:function(e,t,a){"use strict";a("491d")},e011:function(e,t,a){},e021:function(e,t,a){"use strict";var i=(a("7f7f"),a("ac6a"),a("75fc")),n=a("b19c"),r=a("c276"),o=function(e){var t={};for(var a in e){var i=e[a];"name"===a?t.name=Object(r.pb)(i.value,i.default):"alias"===a?t.alias=Object(r.pb)(i.value,i.default):"description"===a?t.description=Object(r.pb)(i.value,i.default):"editor"===a&&(t.editor=Object(r.pb)(i.value,i.default))}return t},l={name:"TemplateDynamic",props:{editVal:{type:Object,default:function(){return{}}}},data:function(){return{valueFilterCompoundItem:[{label:"变量选择",value:"variable",formItem:"variable-Panel"}]}},computed:{newArgs:function(){if(this.args&&this.args.length)return Object(i.a)(this.args);var e=this.getPayloads(this.parent&&this.parent.attributes);return e.length>0?e:(e=this.getPayloads(this.parentParent&&this.parentParent.attributes)).length>0?e:[]}},methods:{handlePropertiesChange:function(e){this.$emit("properties-change",e)},getPayloads:function(e){var t=[];if("array"===Object(n.g)(e))e.forEach((function(e){if(!t.length){var a="payload"===e.name?e.attributes:e.payload?e.payload.attributes:null;a&&a.forEach((function(e){var a=o(e);t.push(a)}))}}));else if("object"===Object(n.g)(e))for(var a in e)if("payload"===a){e[a].attributes.forEach((function(e){var a=o(e);t.push(a)}))}return t}}},s=a("2877"),c=Object(s.a)(l,(function(){var e=this;return(0,e._self._c)("variable-editor-components",{attrs:{compoundItem:e.valueFilterCompoundItem,disableExpression:!0,title:"属性点列表",placeholder:"请选择变量",args:e.newArgs,data:e.editVal.variableEditData.properties},on:{change:e.handlePropertiesChange}})}),[],!1,null,"68d10d56",null);t.a=c.exports},e086:function(e,t,a){"use strict";a("6ea7")},e0ff:function(e,t,a){},e122:function(e,t,a){"use strict";a.r(t);var i=(a("6762"),a("2fdb"),{name:"IconEditor",props:{iconClass:{type:String,default:function(){return"el-icon-edit"}},data:{type:Object,default:function(){return{alias:"",type:"",default:"",value:"",primitiveLabels:""}}},placeholder:{type:String,default:""},handleRulesResult:{type:Function,default:function(){}},handleChangeResult:{type:Function,default:function(){}},params:{type:Object,default:function(){return{withContent:!1,group:void 0}}}},data:function(){return{editorVal:""}},computed:{list:function(){var e,t=this.params.group;return t&&Array.isArray(t)&&(e=(window.$iconList||[]).filter((function(e){return t.includes(e.label)}))),e}},watch:{editorVal:{handler:function(e){!1!==this.handleChangeResult(e,this.data)?this.$setAttr(this.data,"value",e):this.$setAttr(this.data,"lastValue",this.data.lastValue)},deep:!0},"data.value":function(){this.initData()}},created:function(){this.initData()},methods:{change:function(e){this.$setAttr(this.data,"value",e)},clear:function(){this.$setAttr(this.data,"value","")},initData:function(){this.data.hasOwnProperty("value")?this.editorVal=this.data.value:this.editorVal=this.data.default}}}),n=(a("03ee"),a("2877")),r=Object(n.a)(i,(function(){var e=this;return(0,e._self._c)("icon-select",{ref:"iconSelect",attrs:{"with-content":e.params.withContent,placeholder:"请选择图标",data:e.list},on:{clear:e.clear,change:e.change},model:{value:e.editorVal,callback:function(t){e.editorVal=t},expression:"editorVal"}})}),[],!1,null,null,null);t.default=r.exports},e13a:function(e,t,a){"use strict";var i=(a("7f7f"),a("ac6a"),a("75fc")),n=a("b19c"),r=a("c276"),o=function(e){var t={};for(var a in e){var i=e[a];"name"===a?t.name=Object(r.pb)(i.value,i.default):"alias"===a?t.alias=Object(r.pb)(i.value,i.default):"description"===a?t.description=Object(r.pb)(i.value,i.default):"editor"===a&&(t.editor=Object(r.pb)(i.value,i.default))}return t},l={name:"AssetsDynamic",props:{editVal:{type:Object,default:function(){return{}}}},data:function(){return{valueFilterCompoundItem:[{label:"变量选择",value:"variable",formItem:"variable-Panel"}]}},computed:{newArgs:function(){if(this.args&&this.args.length)return Object(i.a)(this.args);var e=this.getPayloads(this.parent&&this.parent.attributes);return e.length>0?e:(e=this.getPayloads(this.parentParent&&this.parentParent.attributes)).length>0?e:[]}},methods:{handlePropertiesChange:function(e){this.$emit("properties-change",e)},getPayloads:function(e){var t=[];if("array"===Object(n.g)(e))e.forEach((function(e){if(!t.length){var a="payload"===e.name?e.attributes:e.payload?e.payload.attributes:null;a&&a.forEach((function(e){var a=o(e);t.push(a)}))}}));else if("object"===Object(n.g)(e))for(var a in e)if("payload"===a){e[a].attributes.forEach((function(e){var a=o(e);t.push(a)}))}return t}}},s=a("2877"),c=Object(s.a)(l,(function(){var e=this;return(0,e._self._c)("variable-editor-components",{attrs:{compoundItem:e.valueFilterCompoundItem,disableExpression:!0,title:"属性点列表",placeholder:"请选择变量",args:e.newArgs,data:e.editVal.variableEditData.properties},on:{change:e.handlePropertiesChange}})}),[],!1,null,"7412e3cd",null);t.a=c.exports},e173:function(e,t,a){"use strict";a("d8b4")},e181:function(e,t,a){},e1e0:function(e,t,a){},e23e:function(e,t,a){},e260:function(e,t,a){"use strict";a("d647")},e289:function(e,t,a){},e2e1:function(e,t,a){"use strict";a.r(t);var i=a("75fc"),n=(a("7f7f"),function(){var e=this,t=e._self._c;return t("div",{staticClass:"hc-attr-editor hc-attr-editor-method"},[e.showInput?t("el-input",{staticClass:"hc-attr-editor-input",attrs:{placeholder:e.placeholder,value:e.showVal,readonly:"",size:"mini",clearable:""},nativeOn:{click:function(t){return e.handleIconClick.apply(null,arguments)}}},[t("i",{staticClass:"el-input__icon hc-attr-editor-icon",class:e.iconClass,attrs:{slot:"suffix"},slot:"suffix"})]):e._e(),t("el-dialog",{staticClass:"hc-attr-editor-dialog hc-attr-editor-dialog-method",attrs:{draggable:!0,visible:e.dialogVisible,"close-on-click-modal":!1,title:e.title,width:"56%","custom-class":"hc-attr-editor-method-warp","append-to-body":!0,"modal-append-to-body":!0},on:{close:e.close}},[t("div",{staticClass:"hc-attr-editor-content"},[e.dialogVisible?t("el-form",{staticClass:"event-editor-form",attrs:{"label-width":"120px"},model:{value:e.editVal,callback:function(t){e.editVal=t},expression:"editVal"}},[t("el-form-item",{attrs:{label:"方法名称"}},[t("el-cascader",{staticStyle:{width:"100%"},attrs:{options:e.functions,separator:"."},on:{change:e.handleChange},model:{value:e.editVal.fn,callback:function(t){e.$set(e.editVal,"fn",t)},expression:"editVal.fn"}})],1),e.payloads&&e.payloads.length>0&&e.hasParams&&e.hasNotCallback?t("el-form-item",{attrs:{label:"参数"}},[t("table",{directives:[{name:"theme",rawName:"v-theme",value:e.themeStyles,expression:"themeStyles"}],staticClass:"hc-editor-payload-table"},[t("thead",{staticClass:"hc-editor-payload-table-thead",style:e.theadStyles},[t("tr",[t("th",{attrs:{width:"30%"}},[e._v("参数名")]),t("th",{attrs:{width:"30%"}},[e._v("参数别名")]),t("th",{attrs:{width:"40%"}},[e._v("参数值")])])]),t("tbody",{staticClass:"hc-editor-payload-table-tbody"},[e._l(e.editVal.payloads.payload||e.editVal.payloads,(function(a,i){return[!a.isCallback&&e.paramVisible(a)?t("tr",{key:i},[t("td",{attrs:{align:"left"}},[e._v(e._s(a.name))]),t("td",{attrs:{align:"center"}},[t("span",[e._v(e._s(a.alias||a.description))]),a.tips?t("basic-tips",{attrs:{type:"popover",title:"配置说明",width:600,placement:"bottom-start",iconStyle:{color:"#C9D0D4"},content:a.tips}},[Array.isArray(a.tips)?[t("ul",{staticStyle:{"list-style-type":"none"}},e._l(a.tips,(function(a,i){return t("li",{key:i},[e._v("\n                            "+e._s(a)+"\n                          ")])})),0)]:e._e()],2):e._e(),"attrName"===a.name&&e.hasReturnValueInfo(e.editVal)?t("el-popover",{attrs:{placement:"bottom-end",title:"返回值明细",width:"418",trigger:"hover","popper-class":"hc-methods-return-popover"}},[t("iconfont",{staticClass:"hc-methods-return-icon",attrs:{slot:"reference",left:5,type:"el-icon-info"},slot:"reference"}),t("return-value-list",{attrs:{value:e.getReturnValueInfo(e.editVal)}})],1):e._e()],1),t("td",{attrs:{align:"center"}},[t("div",{staticClass:"value-form-item-group"},[e.changed?t("create-input-item",{attrs:{attr:a,data:e.data,args:e.newArgs}}):e._e()],1)])]):e._e()]}))],2)])]):e._e(),e.output?t("el-form-item",{attrs:{label:"返回值类型"}},[t("div",{staticClass:"method-output t-border"},[t("el-tag",{attrs:{size:"mini"}},[e._v(e._s(e._f("formatType")(e.outputType)))]),t("span",{staticStyle:{"margin-left":"5px"}},[e._v(e._s(e._f("formatDesc")(e.outputDescription)))])],1),e.outputDefault&&e.outputDefault.length?t("table",{directives:[{name:"theme",rawName:"v-theme",value:e.themeStyles,expression:"themeStyles"}],staticClass:"hc-editor-payload-table",staticStyle:{"margin-top":"10px"}},[t("thead",{staticClass:"hc-editor-payload-table-thead",style:e.theadStyles},[t("tr",[t("th",{attrs:{width:"30%"}},[e._v("返回值名称")]),t("th",{attrs:{width:"50%"}},[e._v("返回值别名")]),t("th",{attrs:{width:"20%"}},[e._v("返回值类型")])])]),t("tbody",{staticClass:"hc-editor-payload-table-tbody"},[e._l(e.outputDefault,(function(a,i){return[t("tr",{key:i},[t("td",{attrs:{align:"left"}},[e._v(e._s(a.name))]),t("td",{attrs:{align:"left"}},[e._v(e._s(a.alias))]),t("td",{attrs:{align:"center"}},[t("el-tag",{attrs:{size:"mini"}},[e._v(e._s(e._f("formatType")(a.type)))])],1)])]}))],2)]):e._e()]):e._e(),e.hasCallback?[e._l(e.editVal.payloads.payload||e.editVal.payloads,(function(a,n){return[a.isCallback&&e.checkVisible(a)?t("el-form-item",{key:n,attrs:{label:a.alias}},[t("callback-content",{attrs:{args:[].concat(Object(i.a)(a.args||[]),Object(i.a)(e.newArgs))},model:{value:a.callbacks,callback:function(t){e.$set(a,"callbacks",t)},expression:"param.callbacks"}})],1):e._e()]}))]:e._e(),e.hasConditionalBranches?[t("el-form-item",{key:"conditionalBranch"},[t("div",{attrs:{slot:"label",title:"执行条件结果转换为布尔型值为true时执行对应内容"},slot:"label"},[e._v("\n              条件分支\n            ")]),t("conditional-branch-content",{attrs:{args:[].concat(Object(i.a)((e.editVal.payloads.payload||e.editVal.payloads).reduce((function(e,t){return[].concat(Object(i.a)(e),Object(i.a)(t.args))}),[])||[]),Object(i.a)(e.newArgs))},model:{value:e.editVal.conditionalBranches,callback:function(t){e.$set(e.editVal,"conditionalBranches",t)},expression:"editVal.conditionalBranches"}})],1)]:e._e(),e.hasAssets?[t("el-form-item",{key:"assets"},[t("div",{attrs:{slot:"label",title:"配置资产方法"},slot:"label"},[e._v("\n              资产\n            ")]),t("assets-method-select",{staticClass:"assets-method-select-panel",attrs:{args:[].concat(Object(i.a)((e.editVal.payloads.payload||e.editVal.payloads).reduce((function(e,t){return[].concat(Object(i.a)(e),Object(i.a)(t.args))}),[])||[]),Object(i.a)(e.newArgs))},model:{value:e.editVal.assets,callback:function(t){e.$set(e.editVal,"assets",t)},expression:"editVal.assets"}})],1)]:e._e()],2):e._e()],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"danger"},on:{click:e.clear}},[e._v("清 空")]),t("el-button",{on:{click:e.cancel}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.clickSure}},[e._v("确 定")])],1)])],1)}),r=(a("3b2b"),a("6762"),a("2fdb"),a("7514"),a("28a5"),a("6b54"),a("ac6a"),a("8615"),a("c276")),o=(a("8e6e"),a("456d"),a("bd86")),l=(a("a481"),a("f559"),a("96cf"),a("3b8d")),s=a("967e"),c=a.n(s),u=a("a542"),d=a("548e"),p=a("3e19"),h=a("05bd"),f=a("9af7"),m=a("b19c");function v(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function b(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?v(Object(a),!0).forEach((function(t){Object(o.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):v(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var g={components:{ComplexBox:d.a,ComplexGroup:p.a,AttrBox:h.a,AttrItemContent:f.a},props:{parent:{type:Object},attr:{type:Object},args:{type:Object,default:function(){return[]}},data:{type:Object,default:function(){return{}}}},render:function(e,t){return this.attr.isObject&&this.attr.objectAttr&&!this.attr.editor&&(this.attr.editor="variable"),this.createAttrBox(e,this.attr,this.parent,null,0)},methods:{getVal:function(e){return Object(r.pb)(e.value,e.default)},setValue:function(e,t){this.$setAttr(t,"value",e)},setLastValue:function(e,t){this.$setAttr(t,"lastValue",e)},createAttrItemContent:function(e,t,a){var i=t.type,n=new u.a(i),r=[];return r.push(a),e("attr-item-content",{props:{parsedType:n,data:t,handleRulesResult:this.handleRulesResult,handleChangeResult:this.handleChangeResult}},r)},createAttrBox:function(e,t,a,i,n){var r=t.type,o=t.editor,l=new u.a(r),s=l.getBaseType(),c=l.getIsLen(),d="Complex"===s?"attr-box":"div",p={String:this.createElInput,Number:this.createElInputNumber,Boolean:this.createElSwitch,Enum:this.createElSelect,Complex:this.createComplex}[s]||this.createElInput;return(o||"Complex"!==s&&c)&&(p=this.createEditor),e(d,{props:{parsedType:l,data:t}},["function"===Object(m.g)(p)?p(e,l,t,a,i,n):null])},createEditor:function(e,t,a,i,n,o){var l=this,s=t.getBaseType(),c=t.getIsLen(),u="Complex"!==s&&c?"array":a.editor;if("none"===u)return this.createElInput(e,t,a);if("color"===u)return this.createElColorPicker(e,t,a);if("date"===u||"time"===u||"datetime"===u)return this.createElDateTimePicker(e,t,a);if(/^self:+/.test(u))return this.createCustomEditor(e,t,a,i,n,o);var d;if(d="variable"===u?"variable-editor-components":u+"-editor",!this.$options.components[Object(r.Fb)(d)])return this.createElInput(e,t,a);var p={ref:d,props:{args:this.args,visible:a.editorDialogVisible,linkType:"Page"===a.componentName&&"isCustomVariable"===a.customGroupName?2:1,data:a,staticType:a.type||"static",selectProps:a.selectProps,parent:i,parentParent:n,parsedType:t,level:o,params:a.editorParams,target:this.data,handleRulesResult:this.handleRulesResult,handleChangeResult:this.handleChangeResult}};"variable"===u&&(p.props.compoundItem=[{label:"变量选择",value:"variable",formItem:"variable-Panel"},{label:"手动输入",value:"static",formItem:"input",placeholder:"支持字符、${...}、字符与${...}混合三种形式的输入，${...}是对变量的引用，其中...为变量名",tips:"支持字符、${...}、字符与${...}混合三种形式的输入，${...}是对变量的引用，其中...为变量名"},{label:"表达式",value:"useExpression",formItem:"input",placeholder:"支持js表达式语法，支持混合使用变量，${...}是对变量的引用，其中...为变量名",tips:"支持js表达式语法，支持混合使用变量，${...}是对变量的引用，其中...为变量名"}]),["cascader","select","treeselect"].includes(a.type)&&this.getTargetOptions(a).then((function(e){l.$nextTick((function(){l.$refs[d]&&l.$refs[d].setOptions(e)}))}));return e(d,p,[])},getTargetOptions:function(e){var t=this;return new Promise(function(){var a=Object(l.a)(c.a.mark((function a(i){var n,r;return c.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(e.type,n=e.options,!Array.isArray(n)){a.next=5;break}i(n),a.next=20;break;case 5:if("object"!==Object(m.g)(n)){a.next=9;break}i([n]),a.next=20;break;case 9:if("string"!==Object(m.g)(n)){a.next=19;break}if(!n.startsWith("Enum(")){a.next=13;break}a.next=17;break;case 13:return a.next=15,t.getOptionsByApi(e);case 15:r=a.sent,["cascader","treeselect"].includes(e.type)?i(t.$util.listToTree(r,"id","parentId")):i(r);case 17:a.next=20;break;case 19:i([]);case 20:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}())},getOptionsByApi:function(e){var t=this;return new Promise((function(a,i){var n=e.options,r=e.params,o=void 0===r?{}:r,l=e.method,s=void 0===l?"get":l,c=e.dataKey,u=void 0===c?"":c,d={$orderBy:"createTime desc",pagination:0,lazyLoad:0},p={method:s};n.startsWith("api:")?p.url=n.replace("api:",""):n.startsWith("objectType:")?(p.url="/api/model/instances",p.objectType=n.replace("objectType:","")):"objectType"===n?(p.url="/api/model/profiles",d.fields="id,parentId,Identifier,name"):a([]),d=b(b({},d),o),p["get"===s?"params":"data"]=d,t.$util.request(p).then((function(t){var i=t;u?u.split(".").forEach((function(e){"object"===Object(m.g)(i)&&(i=i[e])})):i=Array.isArray(t)?t:Array.isArray(t.data)?t.data:"object"===Object(m.g)(t.data)&&Array.isArray(t.data.result)?t.data.result:[];var n=e.selectProps||{},r=n.label,o=void 0===r?"name":r,l=n.value,s=void 0===l?"id":l;i.forEach((function(e){e["$_"+o]=e[o],e[o]="".concat(e[o],"（").concat(e[s],"）")})),a(i)})).catch((function(e){a([])}))}))},createCustomEditor:function(e,t,a,i,n){var o=this,l=a.editor.split(":")[1],s={props:{size:"mini",clearable:!1,readonly:!0,value:Object(r.pb)(a.value,a.default),placeholder:a.placeholder||""},nativeOn:{click:function(e){var r=o.getComponentInstanceMethod(l);r&&"function"===Object(m.g)(r)&&r({data:a,parent:i,parentParent:n,parsedType:t,params:a.editorParams,handleRulesResult:o.handleRulesResult,handleChangeResult:o.handleChangeResult})}}},c=[e("i",{class:["el-input__icon","el-icon-edit"],slot:"suffix",style:{cursor:"pointer"}})];return e("el-input",s,c)},createElInput:function(e,t,a){var i=this,n=Object(r.pb)(a.maxlength,r.a.MAX_LENGTH),o=Object(r.pb)(a.minlength,r.a.MIN_LENGTH),l="el-input-"+Object(r.ob)(),s={attrs:{id:l},props:{size:"mini",clearable:!0,disabled:!!a.readonly,value:this.getVal(a),placeholder:a.placeholder||"",maxlength:n,minlength:o},on:{change:function(e){i.handleAttrEvent("change",e)},focus:function(e){i.handleAttrEvent("focus",e)},blur:function(e){var t=e.target.value;if(t!==a.lastValue){var n=i.handleRulesResult(t,a);if(n&&!0!==n)return i.$message.warning(n),void i.setValue(a.lastValue,a);!1!==i.handleChangeResult(t,a)?(i.setLastValue(t,a),i.handleAttrEvent("blur",t)):i.setValue(a.lastValue,a)}},clear:function(){var e=document.getElementById(l);e&&e.focus(),i.handleAttrEvent("clear")},input:function(e){i.setValue(e,a)}}};return e("el-input",s,[])},createElColorPicker:function(e,t,a){var i,n=this,o={ref:"el-color-picker-"+Object(r.ob)(),props:{size:"mini","show-alpha":!0,disabled:!!a.readonly,"color-format":r.a.COLOR_FORMAT,value:Object(r.pb)(Object(r.pb)(null==a||null===(i=a.editValue)||void 0===i?void 0:i.themeKey,a.value),a.default),default:a.default,placeholder:Object(r.pb)(a.placeholder,"")},on:{change:function(e){!1!==n.handleChangeResult(e,a)?(e&&!Object(r.sb)(e)?n.$setAttr(a,"editValue",{type:"themeColor",sign:e.replaceAll(".","_"),themeKey:e}):n.$setAttr(a,"editValue",{}),n.setValue(e||"",a),n.setLastValue(e||"",a),n.handleAttrEvent("change",e)):n.setValue(a.lastValue,a)},"active-change":function(e){n.handleAttrEvent("active-change",e)}}};return e("theme-color-picker",o,[])},createElDateTimePicker:function(e,t,a){var i=this,n=a.editor;return e("time"===n?"el-time-select":"el-date-picker",{props:{size:"mini",type:n,disabled:!!a.readonly,format:a.format,"picker-options":a.pickerOptions,"value-format":a.valueFormat,clearable:a.clearable,value:Object(r.pb)(Object(r.L)(a.value||a.default,a.valueFormat),a.default),placeholder:Object(r.pb)(a.placeholder,"")},on:{input:function(e){!1!==i.handleChangeResult(e,a)?(i.setValue(e||void 0,a),i.setLastValue(e||void 0,a),i.handleAttrEvent("change",e||void 0)):i.setValue(a.lastValue,a)},blur:function(e){},focus:function(e){}}},[])},createElInputNumber:function(e,t,a){var i=this,n=Object(r.pb)(a.min,r.a.MIN),o=Object(r.pb)(a.max,r.a.MAX),l=Object(r.pb)(a.precision,r.a.NUMBER_PRECISION),s=Object(r.pb)(a.step,r.a.NUMBER_STEP),c={props:{size:"mini","controls-position":"right",min:n,max:o,precision:l,"step-strictly":Object(r.pb)(a["step-strictly"],r.a.NUMBER_STEP_STRICTLY),step:s,disabled:!!a.readonly,value:Object(r.pb)(a.value,a.default),placeholder:Object(r.pb)(a.placeholder,"")},on:{change:function(e){if(void 0!==e){var t=Object(r.pb)(e,a.default);!1!==i.handleChangeResult(e,a)?(i.setValue(t,a),i.setLastValue(t,a),i.handleAttrEvent("change",t)):i.setValue(a.lastValue,a)}else{var n=Object(r.pb)(a.lastValue,a.default);i.setValue(n,a)}},focus:function(e){var t=e.target.value;i.handleAttrEvent("focus",t,e)},blur:function(e){var t=e.target.value,n=a.value;""===t&&(e.target.value=n),i.handleAttrEvent("blur",t,e)}}};return e("el-input-number",c,[])},createElCheckbox:function(e,t,a){var i=this,n=t.getAttach(),o={props:{value:Object(r.pb)(a.value,a.default),disabled:!!a.readonly},on:{change:function(e){!1!==i.handleChangeResult(e,a)?(i.setValue(e,a),i.setLastValue(e,a),i.handleAttrEvent("change",e)):i.setValue(a.lastValue,a)}}},l=[];return n&&n.length>0&&l.push(a.value?n[1].label:n[0].label),e("el-checkbox",o,l)},createElSwitch:function(e,t,a){var i=this,n=t.getAttach(),o={props:{value:Object(r.pb)(a.value,a.default),disabled:!!a.readonly},on:{change:function(e){!1!==i.handleChangeResult(e,a)?(i.setValue(e,a),i.setLastValue(e,a),i.handleAttrEvent("change",e)):i.setValue(a.lastValue,a)}}},l=[];return n&&n.length>0&&l.push(a.value?n[1].label:n[0].label),e("el-switch",o,l)},createElSelect:function(e,t,a){var i=this,n=t.getAttach(),o={style:{width:"100%"},props:{size:"mini",value:Object(r.pb)(a.value,a.default),disabled:!!a.readonly,clearable:a.clearable,placeholder:Object(r.pb)(a.placeholder,"")},on:{"visible-change":function(e){i.handleAttrEvent("visible-change",e)},"remove-tag":function(e){i.handleAttrEvent("remove-tag",e)},change:function(e){!1!==i.handleChangeResult(e,a)?(i.setValue(e,a),i.setLastValue(e,a),i.handleAttrEvent("change",e)):i.setValue(a.lastValue,a)},focus:function(e){i.handleAttrEvent("focus",e)},blur:function(e){i.handleAttrEvent("blur",e)},clear:function(e){i.handleAttrEvent("clear",e)}}},l=n.map((function(t){return e("el-option",{attrs:{key:t.value,label:t.label,value:t.value}})}));return e("el-select",o,l)},createComplex:function(e,t,a,i,n,o){var l=this,s=a.attributes,c=t.getIsLen(),u=t.getLen();if(!s)return this.createElInput(e,t,a);var d={props:{level:++o,data:a,parent:i}},p=[],h="complex-group";if("array"===Object(m.g)(s))s.forEach((function(t,n){var c=[],d=Object(r.ob)();for(var f in t){var v=t[f];"object"===Object(m.g)(v)&&(v.fid=d),!1!==v.visible&&c.push(l.createAttrBox(e,v,a,i,o))}p.push(e(h,{props:{level:o,parentParent:i,parent:a,attributes:s,data:t,index:n,len:u,expandable:!0===a.expandable}},c))}));else if("object"===Object(m.g)(s)){var f=[];for(var v in s)!1!==s[v].visible&&f.push(this.createAttrBox(e,s[v],a,i,o));p.push(e(h,f))}return c&&!1!==a.inputVisible&&p.unshift(this.createElInput(e,t,a)),this.createAttrItemContent(e,a,e("complex-box",d,p))},checkComponentName:function(e){var t=this.$store.getters.pageEditor,a=t.pagesKV[t.pagesActiveName];if(!a)return!0;var i=a.componentNames;if(i)for(var n in i)if(n===e)return!1;return!0},handleAttrEvent:function(e,t){},handleRulesResult:function(e,t){var a=Object(r.pb)(t.maxlength,r.a.MAX_LENGTH),i=Object(r.pb)(t.minlength,r.a.MIN_LENGTH),n=Object(r.pb)(t.min,r.a.MIN),o=Object(r.pb)(t.max,r.a.MAX);if(t.hasOwnProperty("lastValue")||this.setLastValue(t.default,t),!0===t.required&&""===e)return t.alias+"不能为空";if(e.length>a)return t.alias+"最大长度不能超过"+a+"个字符";if(e.length<i)return t.alias+"最小长度不能小于"+i+"个字符";if(t.percent&&!Object(r.ub)(e))return t.alias+"只允许输入百分数";var l=t.rules;if(l&&"array"===Object(m.g)(l))for(var s=0;s<l.length;s++){var c=l[s],u=c.message,d=Object(m.g)(e),p="string"===d&&c.hasOwnProperty("min"),h="string"===d&&c.hasOwnProperty("max");if(!0===c.require&&""===e)return u||t.alias+"不能为空";var f=c.type;if(f&&d!==f)return u||t.alias+"只支持"+f+"类型";if((p||"number"===d)&&e<n)return u||t.alias+"最小值不能小于"+n;if((h||"number"===d)&&e>o)return u||t.alias+"最大值不能大于"+o;if(e.length<i)return u||t.alias+"最小长度不能小于"+i+"个字符";if(e.length>a)return u||t.alias+"最大长度不能超过"+a+"个字符";try{var v=Object(m.a)(c.pattern);if(v&&!v.test(e))return u}catch(e){return"正则表达式无法正确解析"}return this.handleMethod(e,c.validator,t)}return!0},handleChangeResult:function(e,t){return this.handleMethod(e,t.changeHandler,t)},handleMethod:function(e,t,a){if(!t)return!0;var i=this.getComponentInstanceMethod(t);return i?"function"!==Object(m.g)(i)||i(e,a.lastValue,a,this.getCustomGroupNames(a.componentFid)):(t(e,a.lastValue,a),!0)},getCurrentPage:function(){var e=this.$store.getters.pageEditor,t=e.pagesActiveName;return e.pagesKV[t]},getComponentInstance:function(){var e=this.getCurrentPage();return e?e.componentInstance[e.activeComponentFid]:null},getPageInstance:function(){var e=this.getCurrentPage();return e&&e.page?e.componentInstance[e.page.fid]:null},getBasicComponentInstance:function(){var e=this.getCurrentPage();return e?e.componentInstance.basicComponent:null},getComponentInstanceMethod:function(e){if(e){var t=this.getComponentInstance(),a=this.getBasicComponentInstance(),i=this.getPageInstance();return t&&t[e]||a&&a[e]||i&&i[e]}},getCustomGroupNames:function(e){var t=this.$store.getters.pageEditor,a=t.pagesActiveName,i=t.pagesKV[a];if(!i)return null;e=e||i.activeComponentFid;var n=i.customGroupNames;return n&&n[e]}}},y=a("0d35"),_=a("a223"),C=a("2f62");function O(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function T(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?O(Object(a),!0).forEach((function(t){Object(o.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):O(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function V(){var e={};return _.a.conditionalBranch.forEach((function(t){e[t.name]=Object(m.e)(t)})),e}var w={name:"ConditionalBranchContent",model:{props:"value",event:"change"},props:{value:{type:Array,default:function(){return[]}},args:{type:Array,default:function(){return[]}}},data:function(){return{changed:!0,parsedType:null}},computed:T(T({},Object(C.a)(["currentPage"])),{},{themeStyles:function(){return{target:"th,td",style:{"border-width":Object(r.nb)("borderWidth"),"border-style":Object(r.nb)("borderStyle"),"border-color":Object(r.nb)("borderColor"),padding:"0 5px"}}},theadStyles:function(){return{"background-color":Object(r.nb)("middleBackgroundColor")}}}),created:function(){this.init()},methods:{init:function(){this.value&&"array"===Object(m.g)(this.value)&&this.value.length||this.$emit("change",[V()])},getEventTypes:function(e){var t=new u.a(e),a=Object(m.e)(t.getAttach());return t.destroy(),a},getComponentName:function(e){return(e.editor||"method")+"-editor"},handleEventTypeChange:function(e,t){var a=this;this.changed=!1,this.$nextTick((function(){a.changed=!0,e.executionContent.editor=t}))},handleEventContent:function(e,t){var a=this,i=this.value.length;if("add"===e)return i>r.a.MAX_LENGTH_ADD?void this.$message({message:"最多添加"+r.a.MAX_LENGTH_ADD+"项！",type:"warning"}):void this.value.push(V());if("del"!==e)if("top"!==e){if("bottom"===e){if(t===i-1)return;var n=this.value.splice(t,1);this.value.splice(t+1,0,n[0])}if("copy"===e){var o,l={id:null==this||null===(o=this.currentPage)||void 0===o?void 0:o.pageId,data:this.value[t]},s="";try{s=JSON.stringify(l)}catch(e){this.$message.error("复制失败！")}if(!s)return;Object(r.t)(s)}if("paste"===e){var c,u=null==this||null===(c=this.currentPage)||void 0===c?void 0:c.pageId;Object(r.u)().then((function(e){var i,n,r,o=[];try{o=JSON.parse(e)}catch(e){a.$message.error("粘贴失败")}null!==(i=o)&&void 0!==i&&i.id&&null!==(n=o)&&void 0!==n&&null!==(r=n.data)&&void 0!==r&&r.executionType?u===o.id?(a.value.splice(t,1,o.data),a.$message.success("粘贴成功")):a.$message.warning("暂不支持跨页面复制"):a.$message.error("粘贴失败")}))}}else{if(0===t)return;var d=this.value.splice(t,1);this.value.splice(t-1,0,d[0])}else this.$confirm("确定要删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){a.value.splice(t,1)})).catch((function(){}))}}},P=(a("4d68"),a("2877")),x=Object(P.a)(w,(function(){var e=this,t=e._self._c;return t("table",{directives:[{name:"theme",rawName:"v-theme",value:e.themeStyles,expression:"themeStyles"}],staticClass:"hc-editor-payload-table"},[t("thead",{staticClass:"hc-editor-payload-table-thead",style:e.theadStyles},[e._m(0)]),t("tbody",{staticClass:"hc-editor-payload-table-tbody"},e._l(e.value,(function(a,i){return t("tr",{key:i},[t("td",[t("el-input",{attrs:{placeholder:"请输入表达式",title:"支持js表达式语法，支持混合使用变量，${...}是对变量的引用，其中...为变量名，变量值为空字符串、undefined时将解析成null"},model:{value:a.conditionalContent.value,callback:function(t){e.$set(a.conditionalContent,"value",t)},expression:"param.conditionalContent.value"}})],1),t("td",[t("el-select",{staticStyle:{width:"100%"},attrs:{size:"mini",placeholder:"请选择"},on:{change:function(t){return e.handleEventTypeChange(a,t)}},model:{value:a.executionType.value,callback:function(t){e.$set(a.executionType,"value",t)},expression:"param.executionType.value"}},e._l(e.getEventTypes(a.executionType.type),(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("td",[e.changed?t(e.getComponentName(a.executionContent),{tag:"component",attrs:{data:a.executionContent}}):e._e()],1),t("td",[t("el-input",{model:{value:a.executionDescription,callback:function(t){e.$set(a,"executionDescription",t)},expression:"param.executionDescription"}})],1),t("td",{staticClass:"hc-payload-operation",attrs:{align:"center"}},[t("CommonTableMoveOprate",{attrs:{data:e.value,index:i,plain:!0,layout:"top,bottom,add,del,copy,paste"},on:{click:e.handleEventContent}})],1)])})),0)])}),[function(){var e=this,t=e._self._c;return t("tr",[t("th",{attrs:{width:"20%"}},[e._v("执行条件")]),t("th",{attrs:{width:"20%"}},[e._v("执行类型")]),t("th",[e._v("执行内容")]),t("th",[e._v("备注")]),t("th",{attrs:{width:"200px"}},[e._v("操作")])])}],!1,null,null,null).exports;function S(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function j(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?S(Object(a),!0).forEach((function(t){Object(o.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):S(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var E={name:"AssetsMethodSelect",components:{CreateInputItem:g},model:{props:"value",event:"change"},props:{value:{type:Object,default:function(){return{assetIdentifier:"",methodIdentifier:"",payloads:[{name:"",value:"",editValue:null}]}}},args:{type:Array,default:function(){return[]}}},data:function(){return{innerValue:{assetIdentifier:"",regCode:"",methodIdentifier:"",payloads:[{name:"",value:"",editValue:null}]},defaultProps:{children:"children",label:"name"},defaultMethodProps:{label:"name"},assetsList:[],methodsData:[],currentMethodNodeIdentifier:"",currentMethodNode:{},methodParams:null,changed:!0,searchName:""}},computed:{projectId:function(){return Object(m.h)(window.location.href,"projectId")},assetsId:function(){return Object(m.h)(window.location.href,"assetsId")},themeStyles:function(){return{target:"th,td",style:{"border-width":Object(r.nb)("borderWidth"),"border-style":Object(r.nb)("borderStyle"),"border-color":Object(r.nb)("borderColor"),padding:"0 5px"}}},theadStyles:function(){return{"background-color":Object(r.nb)("middleBackgroundColor")}},assetsData:function(){var e=this,t=[],a=this.assetsList,i=a.find((function(t){return t.id===e.assetsId})),n=function(t){var a;return~(null==t||null===(a=t.name)||void 0===a?void 0:a.toLowerCase().indexOf(e.searchName))};return i?(this.listToTree(a,t,i,n),n(i)?[j(j({},i),{},{children:t})]:t):[]},isPayloadsEmpty:function(){return!(this.innerValue.payloads||[]).filter((function(e){return e.name})).length}},created:function(){this.init()},methods:{init:function(){this.innerValue.assetIdentifier=this.value.assetIdentifier||"",this.innerValue.regCode=this.value.regCode||"",this.innerValue.methodIdentifier=this.value.methodIdentifier||"",this.innerValue.payloads=this.value.payloads||[],this.getAssetsData()},handleChange:function(){this.$emit("change",this.innerValue)},handleNodeClick:function(e,t){var a=this;return Object(l.a)(c.a.mark((function i(){return c.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return"init"!==t&&(a.innerValue.assetIdentifier=e.identifier,a.innerValue.regCode=e.regCodeIdentifier,e.regCode||a.$message.info("该资产未绑定设备，方法可能无法正常调用"),a.handleChange(),a.innerValue.methodIdentifier="",a.methodParams=[],a.setPayloads(a.methodParams)),a.currentNode=e,a.projectName=e.name,a.deviceName=e["regCode.name"]||"",i.next=6,a.getAssetPropData(e);case 6:case"end":return i.stop()}}),i)})))()},handleMethodClick:function(e,t){var a=this;return Object(l.a)(c.a.mark((function i(){var n,r;return c.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return"init"!==t&&(a.innerValue.methodIdentifier=e.identifier,a.handleChange()),a.currentMethodNode=e,i.next=4,a.fetchMethodInfo(a.innerValue.assetIdentifier,e.identifier);case 4:r=i.sent,a.methodParams=(null==r||null===(n=r.configData)||void 0===n?void 0:n.paramRules)||[],a.setPayloads(a.methodParams,"init"===t);case 7:case"end":return i.stop()}}),i)})))()},setPayloads:function(e){var t,a=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=Object(m.e)(e)||[];null===(t=this.innerValue.payloads)||void 0===t||t.splice.apply(t,[0,this.innerValue.payloads.length].concat(Object(i.a)(r.map((function(e){var t,i,r,o;return n&&(o=(a.innerValue.payloads||[]).find((function(t){return t.name===e.key}))),{name:e.key,value:(null===(t=o)||void 0===t?void 0:t.value)||e.defaultValue||"",lastValue:(null===(i=o)||void 0===i?void 0:i.value)||e.defaultValue||"",editValue:(null===(r=o)||void 0===r?void 0:r.editValue)||{static:e.defaultValue,type:"static",useExpression:!1,variable:[]},editor:"variable",changeHandler:a.handleChange}})))))},getAssetPropData:function(e){var t=this;return Object(l.a)(c.a.mark((function a(){var i;return c.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.fetchMethods(e.identifier);case 2:i=a.sent,t.methodsData=(null==i?void 0:i.result)||[];case 4:case"end":return a.stop()}}),a)})))()},fetchMethods:function(e){var t=this;return Object(l.a)(c.a.mark((function a(){var i,n,r,o,l,s;return c.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(i={},!e){a.next=6;break}return o=void 0===(r=(n={}).name)?"":r,s=void 0===(l=n.identifier)?"":l,a.next=6,t.$util.request({url:"/api/thing-model/instances/".concat(e,"/methods"),method:"get",params:{$filter:"name eq ".concat(o,",identifier eq ").concat(s)}}).then((function(e){if(i=e,t.innerValue.methodIdentifier){var a,n,r=null===(a=i)||void 0===a||null===(n=a.result)||void 0===n?void 0:n.find((function(e){return e.identifier===t.innerValue.methodIdentifier}));r&&(t.$refs.assetsMethodsTree.setCurrentKey(t.innerValue.methodIdentifier),t.handleMethodClick(r,"init"))}})).catch((function(e){}));case 6:return a.abrupt("return",i);case 7:case"end":return a.stop()}}),a)})))()},fetchMethodInfo:function(e,t){var a=this;return Object(l.a)(c.a.mark((function i(){var n;return c.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(n={},!e||!t){i.next=4;break}return i.next=4,a.$util.request({url:"/api/thing-model/instances/".concat(e,"/methods/").concat(t),method:"get"}).then((function(e){n=e})).catch((function(e){}));case 4:return i.abrupt("return",n);case 5:case"end":return i.stop()}}),i)})))()},getEdgeDevice:function(e){return[{"icon-suffix-online":e.isOnline,"icon-suffix-offline":!e.isOnline}]},getAssetsData:function(){var e=this;return Object(l.a)(c.a.mark((function t(){var a,i,n,r,o;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.fetchProjectInfo();case 2:if(null==(a=t.sent)||!a.id){t.next=13;break}return t.next=6,e.fetchModels();case 6:return i=t.sent,n=i.map((function(e){return e.identifier})),t.next=10,e.fetchAssets(n.join(","));case 10:r=t.sent,e.assetsList=r.map((function(e){return j(j({},e),{},{isOnline:1===e.onlineStatus,regCode:e.regCode})})),e.innerValue.assetIdentifier&&((o=r.find((function(t){return t.identifier===e.innerValue.assetIdentifier})))&&(e.$refs.assetsTree.setCurrentKey(e.innerValue.assetIdentifier),e.handleNodeClick(o,"init")));case 13:case"end":return t.stop()}}),t)})))()},listToTree:function(e,t,a,i){var n=this;e.forEach((function(r){if(r.parentId===a.id){var o=j(j({},r),{},{children:[]});n.listToTree(e,o.children,r),o.children.length<=0&&delete o.children,"function"==typeof i?i(o)&&t.push(o):t.push(o)}}))},fetchProjectInfo:function(){var e=this;return Object(l.a)(c.a.mark((function t(){var a;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a={},!e.projectId){t.next=4;break}return t.next=4,e.$util.request({url:"/api/model/instances/".concat(e.projectId),method:"get"}).then((function(e){a=e})).catch((function(e){}));case 4:return t.abrupt("return",a);case 5:case"end":return t.stop()}}),t)})))()},fetchModels:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"IOT_MODEL";return Object(l.a)(c.a.mark((function a(){var i;return c.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(i=[],!t){a.next=4;break}return a.next=4,e.$util.request({url:"/api/model/instances",method:"get",params:{objectType:t,$filter:"pathName leftlike ",pagination:0,$orderBy:"createTime desc"}}).then((function(e){i=e})).catch((function(e){}));case 4:return a.abrupt("return",i);case 5:case"end":return a.stop()}}),a)})))()},fetchAssets:function(e){var t=this;return Object(l.a)(c.a.mark((function a(){var i;return c.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(i=[],!e){a.next=4;break}return a.next=4,t.$util.request({url:"/api/model/instances",method:"get",params:{objectType:e,pagination:0,$orderBy:"updateTime desc",accessMethod:"foreign_key",relationProperties:"name"}}).then((function(e){i=e})).catch((function(e){}));case 4:return a.abrupt("return",i);case 5:case"end":return a.stop()}}),a)})))()}}},k=(a("c66e"),Object(P.a)(E,(function(){var e=this,t=e._self._c;return t("el-row",{staticClass:"assets-method-select",attrs:{gutter:10}},[t("el-col",{staticStyle:{"border-right":"1px solid #F2F5F7"},attrs:{span:8}},[t("el-input",{attrs:{placeholder:"搜索资产","suffix-icon":"el-icon-search"},model:{value:e.searchName,callback:function(t){e.searchName=t},expression:"searchName"}}),t("el-tree",{ref:"assetsTree",staticClass:"assets-tree",attrs:{data:e.assetsData,props:e.defaultProps,"highlight-current":!0,"current-node-key":e.innerValue.assetIdentifier,"node-key":"identifier","default-expand-all":"","expand-on-click-node":!1},on:{"node-click":e.handleNodeClick},scopedSlots:e._u([{key:"default",fn:function(a){var i=a.node,n=a.data;return t("div",{staticClass:"assets-tree-node"},[t("i",{class:[n.icon||"icon-module","icon-prefix","t-color-primary"]}),t("span",{staticClass:"tree-title"},[e._v(e._s(i.label))]),n.regCode?t("svg",{staticStyle:{margin:"0 5px"},attrs:{width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[t("path",{class:e.getEdgeDevice(n),attrs:{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M10.991 5.69215C11.1209 5.79946 11.2942 5.85312 11.4782 5.85312C11.8572 5.85312 12.1712 5.59557 12.1712 5.27364C12.1712 3.7391 11.1967 2.33333 9.60504 1.57143C8.01336 0.809524 6.03189 0.809524 4.44021 1.57143C2.83771 2.33333 1.85238 3.74983 1.85238 5.28437C1.85238 5.59557 2.16639 5.85312 2.54536 5.85312C2.92433 5.85312 3.23833 5.59557 3.23833 5.28437C3.23833 4.15761 3.95296 3.12743 5.12236 2.56942C6.29175 2.0114 7.73184 2.0114 8.90124 2.56942C10.0706 3.12743 10.7853 4.15761 10.7853 5.28437C10.7853 5.43461 10.8611 5.57411 10.991 5.69215ZM2.29632 7.89202H11.7056C12.0738 7.89202 12.3769 8.24614 12.3769 8.68612V12.2059C12.3769 12.6459 12.0738 13 11.7056 13H2.29632C1.92818 13 1.625 12.6351 1.625 12.2059V8.68612C1.625 8.24614 1.92818 7.89202 2.29632 7.89202ZM3.54151 10.9933C3.68227 10.9933 3.83386 10.9289 3.95296 10.8216C4.06124 10.7036 4.12621 10.5533 4.13703 10.4031C4.13703 10.0812 3.86634 9.81288 3.54151 9.81288C3.21668 9.81288 2.94598 10.0812 2.94598 10.4031C2.94598 10.725 3.21668 10.9933 3.54151 10.9933ZM5.33891 10.9933C5.47967 10.9933 5.63126 10.9289 5.75037 10.8216C5.85864 10.7036 5.92361 10.5533 5.93444 10.4031C5.93444 10.0812 5.67457 9.81288 5.33891 9.81288C5.01408 9.81288 4.74339 10.0812 4.74339 10.4031C4.74339 10.725 5.00325 10.9933 5.33891 10.9933ZM7.1688 10.9933C7.30956 10.9933 7.46115 10.9289 7.58025 10.8216C7.69936 10.7036 7.76432 10.5533 7.76432 10.4031C7.76432 10.0812 7.50446 9.81288 7.1688 9.81288C6.84397 9.81288 6.57327 10.0812 6.57327 10.4031C6.57327 10.725 6.83314 10.9933 7.1688 10.9933ZM6.99555 7.45205C6.56245 7.45205 6.21596 7.11938 6.21596 6.70087C6.21596 6.29309 6.56245 5.96043 6.99555 5.9497C7.42866 5.9497 7.77515 6.28236 7.77515 6.70087C7.77515 7.11938 7.42866 7.45205 6.99555 7.45205ZM8.85667 6.25035C8.9866 6.35766 9.15984 6.41131 9.34391 6.41131C9.72289 6.41131 10.0369 6.15377 10.0261 5.8533C10.0261 4.46899 8.65094 3.3315 6.98347 3.3315C5.316 3.3315 3.9517 4.44753 3.9517 5.84257C3.9517 6.05719 4.09246 6.23961 4.30902 6.34692C4.52557 6.45424 4.77461 6.45424 5.00199 6.34692C5.22938 6.23961 5.35931 6.05719 5.35931 5.84257C5.35931 5.08066 6.0956 4.46899 7.00512 4.46899C7.90383 4.46899 8.65094 5.08066 8.65094 5.84257C8.65094 5.9928 8.72673 6.14303 8.85667 6.25035Z",fill:"#00B864"}})]):e._e()])}}])})],1),t("el-col",{staticClass:"assets-method-select-right",attrs:{span:16}},[t("div",{staticClass:"assets-method-select-methods"},[t("el-tree",{ref:"assetsMethodsTree",staticClass:"assets-methods-tree",attrs:{data:e.methodsData,props:e.defaultMethodProps,"highlight-current":!0,"current-node-key":e.innerValue.methodIdentifier,"node-key":"identifier","default-expand-all":"","expand-on-click-node":!1},on:{"node-click":e.handleMethodClick},scopedSlots:e._u([{key:"default",fn:function(a){var i=a.node,n=a.data;return t("div",{staticClass:"assets-methods-tree-node"},[t("i",{class:[n.icon||"icon-tool","icon-prefix","t-color-primary"]}),t("span",{staticClass:"tree-title"},[e._v(e._s(i.label))])])}}])})],1),e.innerValue.methodIdentifier&&!e.isPayloadsEmpty?t("div",{staticClass:"assets-method-select-payloads"},[e.changed?t("table",{directives:[{name:"theme",rawName:"v-theme",value:e.themeStyles,expression:"themeStyles"}],staticClass:"hc-editor-payload-table"},[t("thead",{staticClass:"hc-editor-payload-table-thead",style:e.theadStyles},[t("tr",[t("th",{attrs:{width:"40%"}},[e._v("参数名")]),t("th",[e._v("参数值")])])]),t("tbody",{staticClass:"hc-editor-payload-table-tbody"},[e._l(e.innerValue.payloads,(function(a){return[a.name?t("tr",{key:a.name},[t("td",{attrs:{align:"left"}},[e._v(e._s(a.name))]),t("td",{attrs:{align:"center"}},[t("div",{staticClass:"value-form-item-group"},[t("create-input-item",{attrs:{attr:a,args:e.args}})],1)])]):e._e()]}))],2)]):e._e(),e.isPayloadsEmpty?t("div",{staticClass:"assets-method-select-payloads-table-empty"},[e._v("\n        该方法没有参数\n      ")]):e._e()]):e._e()])],1)}),[],!1,null,null,null)).exports,I=function(e){var t={};for(var a in e){var i=e[a];"name"===a?t.name=Object(r.pb)(i.value,i.default):"alias"===a?t.alias=Object(r.pb)(i.value,i.default):"description"===a?t.description=Object(r.pb)(i.value,i.default):"editor"===a&&(t.editor=Object(r.pb)(i.value,i.default))}return t},A={name:"MethodEditor",components:{CreateInputItem:g,CallbackContent:y.a,ConditionalBranchContent:x,AssetsMethodSelect:k,ReturnValueList:{props:{value:{type:Object,default:function(){return{}}}},computed:{attributes:function(){return this.value.attributes&&this.isObject(this.value.attributes)&&Object.values(this.value.attributes).length?this.value.attributes:null}},methods:{getAttributes:function(e,t){var a=this,i=this.$createElement;e&&this.isObject(e)&&Object.values(e).length&&Object.values(e).forEach((function(e){if(e.attributes){var n=[];a.getAttributes(e.attributes,n),t.push(i("ul",n))}else t.push(function(e){return i("li",[i("strong",e.alias||"未命名"),i("span",e.name)])}(e))}))},isObject:function(e){return"Object"===Object.prototype.toString.call(e).slice(8,-1)}},render:function(e){var t=[];return this.getAttributes(this.attributes,t),this.attributes?e("ul",t):null}}},props:{title:{type:String,default:function(){return"执行方法设置"}},showInput:{type:Boolean,default:function(){return!0}},iconClass:{type:String,default:function(){return"el-icon-edit"}},parentParent:{type:Object,default:function(){return{}}},parent:{type:Object,default:function(){return{}}},data:{type:Object,default:function(){return{}}},args:{type:Array,default:function(){return[]}},placeholder:{type:String,default:""},handleRulesResult:{type:Function,default:function(){}},handleChangeResult:{type:Function,default:function(){}}},watch:{"data.value":function(){this.initData()},dialogVisible:function(e){e&&this.initData()}},filters:{formatType:function(e){if(!e)return"";var t=e.split("|");return t.reduce((function(e,t,a){return e="".concat(e).concat(a?" / ":"").concat(function(e){return"String"===e?"字符串型":"Number"===e?"数值型":"Boolean"===e?"布尔型":"Enum"===e?"枚举型":"Any"===e?"任意型":/^Complex.*/.test(e)?"复合型":e}(t))}),"")},formatDesc:function(e){return e||"暂无描述"}},computed:{hasConditionalBranches:function(){var e;return null===(e=this.editVal)||void 0===e?void 0:e.conditionalBranches},hasAssets:function(){var e;return null===(e=this.editVal)||void 0===e?void 0:e.assets},output:function(){var e;return null===(e=this.editVal)||void 0===e?void 0:e.outputs},outputType:function(){var e;return null===(e=this.output)||void 0===e?void 0:e.type},outputDescription:function(){var e;return null===(e=this.output)||void 0===e?void 0:e.description},outputDefault:function(){var e;return null===(e=this.output)||void 0===e?void 0:e.default},pageEditor:function(){return this.$store.getters.pageEditor},currentPage:function(){var e=this.pageEditor;return null==e?void 0:e.pagesKV[null==e?void 0:e.pagesActiveName]},activeComponent:function(){var e,t,a=null===(e=this.currentPage)||void 0===e?void 0:e.activeComponentFid;return null===(t=this.currentPage)||void 0===t?void 0:t.componentKV[a]},themeStyles:function(){return{target:"th,td",style:{"border-width":Object(r.nb)("borderWidth"),"border-style":Object(r.nb)("borderStyle"),"border-color":Object(r.nb)("borderColor"),padding:"0 5px"}}},theadStyles:function(){return{"background-color":Object(r.nb)("middleBackgroundColor")}},payloads:function(){var e;if("array"===Object(m.g)(this.editVal.fn)){var t=this.getFormatFn(this.editVal.fn).join(".");return(null===(e=this.payloadsKV[t])||void 0===e?void 0:e.payload)||this.payloadsKV[t]}},hasParams:function(){var e=this.payloads;return!(null==e||!e.length)&&e.some((function(e){return e.name}))},hasNotCallback:function(){if(this.payloads)return void 0!==(this.payloads.payload||this.payloads).find((function(e){return!0!==e.isCallback}))},hasCallback:function(){if(this.payloads)return void 0!==(this.payloads.payload||this.payloads).find((function(e){return!0===e.isCallback}))},callbackPayloads:function(){if(this.payloads)return(this.payloads.payload||this.payloads).filter((function(e){return e.isCallback}))},newArgs:function(){var e=this.getCurrentItemVars(),t=this.getPayloads(this.parent&&this.parent.attributes);return t.length>0?[].concat(Object(i.a)(t),Object(i.a)(this.args),Object(i.a)(e)):(t=this.getPayloads(this.parentParent&&this.parentParent.attributes)).length>0?[].concat(Object(i.a)(t),Object(i.a)(this.args),Object(i.a)(e)):[].concat(Object(i.a)(this.args),Object(i.a)(e))},payloadValues:function(){var e=this.editVal.payloads.payload||this.editVal.payloads,t={};return e.forEach((function(e){var a=null;if(e.editValue&&"variable"!==e.editValue.type){var i=e.editValue.type||"static";a=e.editValue[i]}else a=e.hasOwnProperty("value")?e.value:e.default;t[e.name]=a})),t},paramVisible:function(){var e=this;return function(t){var a=t.visible,i=e.payloadValues,n=!0;if("boolean"===Object(m.g)(a))n=a;else if("object"===Object(m.g)(a)){for(var r in a)if(Array.isArray(a[r])){if(!a[r].includes(i[r])){n=!1;break}}else if(i[r]!==a[r]){n=!1;break}}else if("string"===Object(m.g)(a)){var o=new Function("payload","return ".concat(a));try{n=!1!==o(i)}catch(e){n=!1}}return!1===n&&e.clearData(t),n}}},data:function(){return{payloadsKV:{},outputsKV:{},conditionalBranchesKV:{},assetsKV:{},functions:[],showVal:"",originVal:null,changed:!0,methodsMap:{},copayEditVal:{type:"method",fn:[],payloads:[{name:"",value:"",editValue:null}]},editVal:{type:"method",fn:[],payloads:[{name:"",value:"",editValue:null}]},dialogVisible:!1}},created:function(){this.initData()},methods:{checkVisible:function(e){var t,a,i;if(void 0===(null==e?void 0:e.visible))return!0;var n=e.visible||[],o=(null==this||null===(t=this.editVal)||void 0===t||null===(a=t.payloads)||void 0===a?void 0:a.payload)||(null==this||null===(i=this.editVal)||void 0===i?void 0:i.payloads);return n.every((function(e){var t=function(e){return o.find((function(t){return t.name===e}))}(e.target);return!t||new RegExp(e.reg).test(Object(r.pb)(t.value,t.default))}))},clearData:function(e){this.$removeAttr(e,"value"),this.$removeAttr(e,"lastValue"),this.$removeAttr(e,"editValue"),this.$setAttr(e,"static",null),this.$setAttr(e,e.type,null)},getCurrentItemVars:function(){var e=this;if(!this.activeComponent)return[];if("Grid"===this.activeComponent.name){if(this.data.colFid){var t,a,i,n=null===(t=this.activeComponent)||void 0===t||null===(a=t.attributes)||void 0===a||null===(i=a.cols)||void 0===i?void 0:i.attributes,r=!1,o=null;if((n||[]).forEach((function(t){var a,i,n,l;if(null!=t&&null!==(a=t.iterationMode)&&void 0!==a&&a.hasOwnProperty("value")?null==t||null===(i=t.iterationMode)||void 0===i?void 0:i.value:null==t||null===(n=t.iterationMode)||void 0===n?void 0:n.default){var s=(t.blockClick.attributes||[]).find((function(t){return t.executionContent===e.data})),c=((null==t||null===(l=t.blockToolbar)||void 0===l?void 0:l.attributes)||[]).find((function(t){return(t.blockToolbarContent.attributes||[]).find((function(t){return t.executionContent===e.data}))}));(s||c)&&(r=!0,o=t)}})),r){var l,s,c,u,d,p,h,f,m=null===(l=o)||void 0===l||null===(s=l.iterationNodeAttr)||void 0===s?void 0:s.value,v=null!==(c=o)&&void 0!==c&&null!==(u=c.span)&&void 0!==u&&u.hasOwnProperty("value")?null===(d=o)||void 0===d||null===(p=d.span)||void 0===p?void 0:p.value:null===(h=o)||void 0===h||null===(f=h.span)||void 0===f?void 0:f.default;return this.getItemVariables(this.activeComponent,m,v)}}return[]}return[]},getItemVariables:function(e,t,a){var i,n,r=null==e||null===(i=e.attributes)||void 0===i||null===(n=i.componentName)||void 0===n?void 0:n.value,o=a?r+"/Col-"+a:r,l={value:"item",label:"item",type:"item",alias:"来自".concat(o,"的迭代变量")},s={value:"itemIndex",label:"itemIndex",type:"itemIndex",alias:"来自".concat(o,"的迭代索引")},c=[];return(t||[]).forEach((function(e){c.push({value:e,label:e,type:"itemAttr",alias:"迭代属性"})})),c.length&&(l.children=c),[l,s]},getReturnValueInfo:function(e){if(e.fn&&e.fn.length){var t,a,i=e.fn[0];if(this.methodsMap[i])return(null===(t=this.methodsMap[i])||void 0===t||null===(a=t.attributes)||void 0===a?void 0:a.returnValueInfo)||{}}return{}},hasReturnValueInfo:function(e){if(e.fn&&e.fn.length){var t,a,i=e.fn[0];if(this.methodsMap[i])return!(null===(t=this.methodsMap[i])||void 0===t||null===(a=t.attributes)||void 0===a||!a.returnValueInfo)}return!1},getFns:function(e,t,a){var i=this,n=[],o=function(){var o=e[l];if("methods"!==(o.originGroupName||o.groupName)||!1===o.visible)return 0;var s=o.attributes;if(!s)return 0;var c=function(e){var l,s;if(e.functionName){i.$set(i.methodsMap,o.componentFid,o);var c=e.functionName,u=e.description,d=e.payload,p=e.output,h=e.hasOwnProperty("conditionalBranch")?(null===(l=e.conditionalBranch)||void 0===l?void 0:l.default)||[]:void 0,f=e.hasOwnProperty("assets")?(null===(s=e.assets)||void 0===s?void 0:s.default)||[]:void 0,v=d&&d.default;if(null!=d&&d.customMethod){var b=[];((null==d?void 0:d.attributes)||[]).forEach((function(e){b.push({name:Object(r.pb)(e.name.value,e.name.default),alias:Object(r.pb)(e.alias.value,e.alias.default),editor:"variable"})})),v=b}var g=Object(r.pb)(c.value,c.default),y=e.content?g?"$_".concat(g):"":g,_=Object(r.pb)(u.value,u.default),C={value:y,label:y+"(".concat(o.alias,")")};"Page"!==(null==a?void 0:a.name)&&o.componentFid&&o.componentFid!==a.fid&&(C.value=y+"_"+o.componentFid),y&&n.push(C),"function"===Object(m.g)(t)&&t(y,_,v,p,o,h,f)}};Array.isArray(s)?s.forEach((function(e){return c(e.customMethodsSetting?e.customMethodsSetting.attributes:e)})):c(s)};for(var l in e)o();return n},getPayloads:function(e){var t=[];if("array"===Object(m.g)(e))e.forEach((function(e){if(!t.length){var a="payload"===e.name?e.attributes:e.payload?e.payload.attributes:null;a&&a.forEach((function(e){var a=I(e);t.push(a)}))}}));else if("object"===Object(m.g)(e))for(var a in e)if("payload"===a){e[a].attributes.forEach((function(e){var a=I(e);t.push(a)}))}return t},getFormatFn:function(e){if(!e.length)return e;var t=e,a=(null==e?void 0:e.length)>=2?e[1]:"";if(a&&new RegExp(r.d).test(a)){var i=a.lastIndexOf("_"),n=a.slice(0,i);t=[a.slice(i+1,a.length),n]}return t},initData:function(){var e=Object(r.pb)(this.data.value,this.data.default);"object"===Object(m.g)(e)&&(e.type="method",this.data.editValue=e,this.data.value=Object(m.b)(e)),this.data.editValue&&("method"===this.data.editValue.type||this.data.editValue.fn)?(this.data.editValue.type="method",e=Object(r.pb)(this.data.value,this.data.default),this.data.editValue.payloads=this.resetPayloads(this.data.editValue.payloads),this.originVal=this.data.editValue,this.editVal=Object(m.e)(this.data.editValue),this.showVal=this.getShowVal()):(this.editVal=Object(m.e)(this.copayEditVal),this.showVal=this.getShowVal()),this.initFunctions();var t=this.getFormatFn(this.editVal.fn);t&&this.setEditVal(t.join("."))},resetPayloads:function(e){var t=this,a=[];return e.forEach((function(e){if(e.isObject&&e.objectAttr){var n=t.resetPayloads(e.objectAttr);a=[].concat(Object(i.a)(a),Object(i.a)(n))}else a.push(e)})),a},handleIconClick:function(){this.open()},open:function(){this.dialogVisible=!0},close:function(){this.dialogVisible=!1},cancel:function(){this.close()},clear:function(){var e=this;this.$confirm("确定要清空相关设置吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.showVal="",e.editVal=Object(m.e)(e.copayEditVal),e.originVal=null,e.$removeAttr(e.data,"value"),e.$removeAttr(e.data,"lastValue"),e.$removeAttr(e.data,"editValue"),e.clearFuncName(),e.close()})).catch((function(){}))},clearFuncName:function(){var e,t=(null==this||null===(e=this.parent)||void 0===e?void 0:e.attributes)||[],a=this.data,i=t.find((function(e){var t;return(null==e||null===(t=e.pageComponentName)||void 0===t?void 0:t.fid)===a.fid}));i&&(this.$removeAttr(i.pageComponentName,"value"),this.$removeAttr(i.pageComponentMethod,"value"),this.$removeAttr(i.pageComponentMethod,"optionsFid"),this.$removeAttr(i.executionTitle,"value"))},initFunctions:function(){var e=this;this.functions=[];var t=this.$store.getters.pageEditor,a=t.pagesKV[t.pagesActiveName];if(a){!function t(i){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=function(o){var l=i[o];if(l&&"block"===l.name)return 0;var s=l.attributes,c=s.componentName.value,u=e.getFns(s,(function(t,a,i,n,r,l,s){var c=o+"."+t;e.setPayloadKV(c,i,r),e.setOutputsKV(c,n),e.setConditionalBranchesKV(c,l),e.setAssetsKV(c,s)}),l);if(!u||0===u.length)return 0;if(/^#[a-z0-9]{4}-/.test(c))return 0;if("Page"===c)u=u.filter((function(e){return"api(API)"!==e.label&&"script(script)"!==e.label})),e.functions.unshift({value:o,label:"".concat(n).concat(c),children:u});else if(e.functions.push({value:o,label:"".concat(n).concat(c),children:u}),"Iframe"===l.name){var d=Object(r.fb)(a.fid,l.fid);t(d,c+"_")}};for(var l in i)o(l)}(a.componentKV)}},setOutputsKV:function(e,t){t&&(this.outputsKV[e]=t)},setConditionalBranchesKV:function(e,t){t&&(this.conditionalBranchesKV[e]=t)},setAssetsKV:function(e,t){t&&(this.assetsKV[e]=t)},setPayloadKV:function(e,t,a){var i=Object(m.e)(t);a.returnValue&&(i?(i.push({name:"variableName",alias:"接收返回值的变量名",editor:"variable",editorParams:{type:"variable",useOnlyName:!0},returnValue:!0}),i.push({name:"attrName",alias:"返回值的属性名",editor:"variable",editorParams:{type:"variable",useOnlyName:!0,useLastName:!0}})):(i=[{name:"variableName",alias:"接收返回值的变量名",editor:"variable",editorParams:{type:"variable",useOnlyName:!0},returnValue:!0}]).push({name:"attrName",alias:"返回值的属性名",editor:"variable",editorParams:{type:"variable",useOnlyName:!0,useLastName:!0}})),this.payloadsKV[e]=i},payloadForEach:function(e,t,a){var i=this;e.forEach((function(e){var n=(t?t+".":"")+e.name;e.objectAttr&&i.payloadForEach(e.objectAttr,n,a),a(n,e)}))},setEditVal:function(e){var t=Object(m.e)(this.payloadsKV[e])||[],a=Object(m.e)(this.outputsKV[e]),i=Object(m.e)(this.conditionalBranchesKV[e]),n=Object(m.e)(this.assetsKV[e]);if(e!==(this.originVal&&this.originVal.fn&&this.getFormatFn(this.originVal.fn).join(".")))return this.$set(this.editVal,"payloads",t),this.$set(this.editVal,"outputs",a),this.$set(this.editVal,"conditionalBranches",i),void this.$set(this.editVal,"assets",n);var r=Object(m.e)(this.originVal.payloads);r||(this.$set(this.editVal,"payloads",t),this.$set(this.editVal,"outputs",a),this.$set(this.editVal,"conditionalBranches",i),this.$set(this.editVal,"assets",n)),t&&0!==t.length||(this.$set(this.editVal,"payloads",t),this.$set(this.editVal,"outputs",a),this.$set(this.editVal,"conditionalBranches",i),this.$set(this.editVal,"assets",n));var o={};this.payloadForEach(r,"",(function(e,t){o[e]=t})),this.payloadForEach(t.payload||t,"",(function(e,t){var a=o[e];if(a)for(var i in a)"name"!==i&&"alias"!==i&&"editor"!==i&&"default"!==i&&"objectAttr"!==i&&"type"!==i&&(t[i]=a[i])})),i=Object(m.e)(this.originVal.conditionalBranches||i),n=Object(m.e)(this.originVal.assets||n),this.$set(this.editVal,"payloads",t),this.$set(this.editVal,"outputs",a),this.$set(this.editVal,"conditionalBranches",i),this.$set(this.editVal,"assets",n)},handleChange:function(e){var t=this;this.changed=!1,setTimeout((function(){var a=t.getFormatFn(e||[]).join(".");t.setEditVal(a),t.changed=!0}),0)},getShowVal:function(){if(!this.editVal.fn||!this.editVal.fn.length)return"";var e=this.getFormatFn(this.editVal.fn);return"method: "+e[e.length-1]},getCustomGroupNames:function(e){var t=this.$store.getters.pageEditor,a=t.pagesActiveName,i=t.pagesKV[a];if(!i)return null;e=e||i.activeComponentFid;var n=i.customGroupNames;return n&&n[e]},findAttrTargetFromParent:function(e){var t=e.fid,a=e.name;for(var i in(null===(n=this.parent)||void 0===n?void 0:n.attributes)||{}){var n,r,o=this.parent.attributes[i];if((null===(r=o[a])||void 0===r?void 0:r.fid)===t)return o}},clickSure:function(){if(this.editVal.fn&&0!==this.editVal.fn.length)if(this.showVal=this.getShowVal(),!1!==this.handleChangeResult(this.showVal,this.data)){if(this.$setAttr(this.data,"value",this.showVal),this.$setAttr(this.data,"lastValue",this.showVal),this.$setAttr(this.data,"editValue",Object(m.e)(this.editVal)),this.$emit("onSure",this.showVal,Object(m.e)(this.editVal),this.data),this.dialogVisible=!1,"executionContent"===this.data.name){var e=this.data;if(e.value){if("Iframe"===this.activeComponent.name&&this.pageEditor.eventEditingComponentFid){var t=this.findAttrTargetFromParent(e);return this.$setAttr(t.pageComponentName,"value",e.editValue.fn[0]),this.$setAttr(t.pageComponentMethod,"value",e.editValue.fn[1]),void this.$setAttr(t.pageComponentMethod,"lastValue",e.editValue.fn[1])}var a=this.getCustomGroupNames(e.componentFid),i=a.executionComponentName.find((function(t){return t.fid===e.fid})),n=a.executionComponentMethod.find((function(t){return t.fid===e.fid}));this.$setAttr(i,"value",e.editValue.fn[0]),this.$setAttr(n,"value",e.editValue.fn[1]),this.$setAttr(n,"lastValue",e.editValue.fn[1])}}}else this.$setAttr(this.data,"lastValue",this.data.lastValue);else this.$message.warning("请选择方法")}}},D=(a("6f0d"),Object(P.a)(A,n,[],!1,null,null,null));t.default=D.exports},e38e:function(e,t,a){},e418:function(e,t,a){},e457:function(e,t,a){},e4b1:function(e,t,a){"use strict";a("85fd")},e611:function(module,__webpack_exports__,__webpack_require__){"use strict";var core_js_modules_es7_object_get_own_property_descriptors__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("8e6e"),core_js_modules_es7_object_get_own_property_descriptors__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(core_js_modules_es7_object_get_own_property_descriptors__WEBPACK_IMPORTED_MODULE_0__),core_js_modules_es6_object_keys__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("456d"),core_js_modules_es6_object_keys__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(core_js_modules_es6_object_keys__WEBPACK_IMPORTED_MODULE_1__),_Users_yinhao_Workspace_frontend_page_webtools_page_node_modules_babel_runtime_corejs2_helpers_esm_toConsumableArray_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("75fc"),core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("a481"),core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_3__),core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("28a5"),core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_4__),core_js_modules_es6_regexp_search__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("386d"),core_js_modules_es6_regexp_search__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(core_js_modules_es6_regexp_search__WEBPACK_IMPORTED_MODULE_5__),core_js_modules_es6_array_find__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("7514"),core_js_modules_es6_array_find__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(core_js_modules_es6_array_find__WEBPACK_IMPORTED_MODULE_6__),core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("ac6a"),core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_7__),core_js_modules_es6_array_find_index__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("20d6"),core_js_modules_es6_array_find_index__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(core_js_modules_es6_array_find_index__WEBPACK_IMPORTED_MODULE_8__),core_js_modules_es6_function_name__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("7f7f"),core_js_modules_es6_function_name__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(core_js_modules_es6_function_name__WEBPACK_IMPORTED_MODULE_9__),_Users_yinhao_Workspace_frontend_page_webtools_page_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("bd86"),core_js_modules_es6_regexp_to_string__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("6b54"),core_js_modules_es6_regexp_to_string__WEBPACK_IMPORTED_MODULE_11___default=__webpack_require__.n(core_js_modules_es6_regexp_to_string__WEBPACK_IMPORTED_MODULE_11__),core_js_modules_es6_string_includes__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("2fdb"),core_js_modules_es6_string_includes__WEBPACK_IMPORTED_MODULE_12___default=__webpack_require__.n(core_js_modules_es6_string_includes__WEBPACK_IMPORTED_MODULE_12__),core_js_modules_es7_array_includes__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("6762"),core_js_modules_es7_array_includes__WEBPACK_IMPORTED_MODULE_13___default=__webpack_require__.n(core_js_modules_es7_array_includes__WEBPACK_IMPORTED_MODULE_13__),_component_box_wrapper__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("5c68"),_libs_type_parser__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("a542"),_libs_util__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__("c276"),_component_render__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__("eae8"),_libs_base_util__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__("b19c"),vuex__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__("2f62");function ownKeys(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(a),!0).forEach((function(t){Object(_Users_yinhao_Workspace_frontend_page_webtools_page_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_10__.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ownKeys(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var styleExcludes=["width","height","float","display","visibility","left","right","top","bottom","position","z-index","border-style","border-color","margin"],innerStyles=["color","font-size","font-style","font-weight","letter-spacing","line-height","text-align","text-decoration","heightFilled","padding","overflow"];__webpack_exports__.a={name:"ComponentBox",components:{ComponentBoxWrapper:_component_box_wrapper__WEBPACK_IMPORTED_MODULE_14__.a,ComponentRender:_component_render__WEBPACK_IMPORTED_MODULE_17__.a},inject:["isSDC"],props:{parentComponentName:{type:String,default:""},runtime:{type:Boolean,default:!1},parent:{type:Array,default:function(){return[]}},data:{type:Object,default:function(){}},pageId:{type:String,default:""},hasBorder:{type:Boolean,default:!1},clickStop:{type:Boolean,default:!0}},data:function(){return{bakAttributes:[],attributes:[]}},watch:{foreachData:{handler:function(e,t){var a,i,n,r,o,l,s,c;if(e&&this.runtime&&(void 0!==t||"array"!==this.$util.getObjType(e)||0!==e.length)){var u=this.pageParser.getParentComponent(null===(a=this.data)||void 0===a?void 0:a.fid,!0),d=e;if(["api-link","indicator-link","new-indicator-link","assets-link","object-link","alarm-link"].includes(null==this||null===(i=this.data)||void 0===i||null===(n=i.attributes)||void 0===n||null===(r=n.foreachData)||void 0===r?void 0:r.editor)){var p,h,f=(null==this||null===(p=this.data)||void 0===p||null===(h=p.attributes)||void 0===h?void 0:h.foreachData)||{},m=f.linkConfig,v=f.value;d=this.$convert2dLinkData(v,m,null==m?void 0:m.pagination)}var b="Page"===(null==u||null===(o=u.page)||void 0===o||null===(l=o.attributes)||void 0===l||null===(s=l.componentName)||void 0===s?void 0:s.value)?null==u?void 0:u.component:null==u?void 0:u.children,g=null===(c=this.data)||void 0===c?void 0:c.fid;this.getCopyComponents(d,b,g)}},immediate:!0,deep:!0},height:{handler:function(e){if(!this.runtime){var t,a,i=null==this||null===(t=this.currentPage)||void 0===t?void 0:t.componentKV[this.data.parentFid];if(["dataContainer"].includes(null==i?void 0:i.groupName))(null===(a=i.children)||void 0===a?void 0:a.some((function(e){var t=e.attributes.height;return t&&(!(null!=t&&t.hasOwnProperty("visible"))||(null==t?void 0:t.visible))&&((null==t?void 0:t.value)||(null==t?void 0:t.default)||"").toString().indexOf("%")>0})))?this.$setAttr(i.attributes.height,"value","100%"):this.$setAttr(i.attributes.height,"value","auto")}},immediate:!0}},computed:_objectSpread(_objectSpread({},Object(vuex__WEBPACK_IMPORTED_MODULE_19__.a)(["portalInfo","themeConstColor"])),{},{themeConstColor:function(){var e,t,a,i;return(null===(e=window)||void 0===e||null===(t=e.$VUE_ROOT)||void 0===t||null===(a=t.$store)||void 0===a||null===(i=a.getters)||void 0===i?void 0:i.themeConstColor)||{}},fid:function(){var e;return null===(e=this.data)||void 0===e?void 0:e.fid},parentId:function(){var e;return null===(e=this.data)||void 0===e?void 0:e.parentId},className:function(){if(!this.runtime){var e=[];return e.push("hc-block-component-edit"),this.data.fid,this.activeComponentFid,e}},classNameInner:function(){var e=[];return this.runtime||["quickLayout","layout","dataContainer"].includes(this.data.groupName)||this.isSDC&&!this.data.parentFid||e.push("hc-block-component-mask"),e},componentName:function(){var e=this.data;return e&&e.attributes&&e.attributes.componentName&&e.attributes.componentName.value},componentType:function(){var e,t;return(null===(e=this.data)||void 0===e?void 0:e.name)||(null===(t=this.data)||void 0===t?void 0:t.componentType)},currentPage:function(){var e=this.$store.getters.pageEditor;return e&&e.pagesKV[e.pagesActiveName]},activeComponentFid:function(){var e=this.currentPage;return e&&e.activeComponentFid},showEditorToolbar:function(){return!this.runtime&&this.data.fid===this.activeComponentFid},span:function(){var e=this.data.attributes;return e&&e.span&&!1!==e.span.visible?(null===e.span.value&&(e.span.value=void 0),this.getValue(e.span)):24},xs:function(){var e=this.data.attributes;return e&&e.xs&&!1!==e.xs.visible?this.getValue(e.xs):24},sm:function(){var e=this.data.attributes;return e&&e.sm&&!1!==e.sm.visible?this.getValue(e.sm):24},lg:function(){var e=this.data.attributes;return e&&e.lg&&!1!==e.lg.visible?this.getValue(e.lg):24},offset:function(){var e=this.data.attributes;return e&&e.offset&&!1!==e.offset.visible?this.getValue(e.offset):0},blockTitle:function(){var e=this.data.attributes;return e&&e.blockTitle&&!1!==e.blockTitle.visible?this.getValue(e.blockTitle):""},titleStyle:function(){return{fontSize:this.blockTitleFontSize,color:this.blockTitleColor,margin:this.blockTitleMargin,padding:this.blockTitlePadding,height:this.blockTitleHeight,icon:this.blockTitleIcon}},blockTitleFontSize:function(){var e=this.data.attributes;return e&&e.blockTitleFontSize&&!1!==e.blockTitleFontSize.visible?this.getValue(e.blockTitleFontSize):16},blockTitleColor:function(){var e=this.data.attributes;return e&&e.blockTitleColor&&!1!==e.blockTitleColor.visible?this.getValue(e.blockTitleColor):""},blockTitleMargin:function(){var e=this.data.attributes;return e&&e.blockTitleMargin&&!1!==e.blockTitleMargin.visible?this.getValue(e.blockTitleMargin):[0,0,0,0]},blockTitlePadding:function(){var e=this.data.attributes;return e&&e.blockTitlePadding&&!1!==e.blockTitlePadding.visible?this.getValue(e.blockTitlePadding):[0,5,0,5]},blockTitleHeight:function(){var e=this.data.attributes;return e&&e.blockTitleHeight&&!1!==e.blockTitleHeight.visible?this.getValue(e.blockTitleHeight):"40px"},blockTitleIcon:function(){var e=this.data.attributes;return e&&e.blockTitleIcon&&!1!==e.blockTitleIcon.visible?this.getValue(e.blockTitleIcon):""},blockToolbarShowType:function(){var e=this.data.attributes;return e&&e.blockToolbarShowType&&!1!==e.blockToolbarShowType.visible?this.getValue(e.blockToolbarShowType):"none"},blockToolbars:function(){var e=this.data.attributes;return e&&e.blockToolbar&&!1!==e.blockToolbar.visible?this.getValue(e.blockToolbar.attributes,!0):[]},pageContentHeight:function(){return this.runtime?this.$store.getters.pageViewStore.pageContentHeight:this.$store.getters.pageEditor.pageContentHeight},borderVisible:function(){var e=this.data.attributes;return!(!e||!e.borderVisible||!1===e.borderVisible.visible)&&Object(_libs_util__WEBPACK_IMPORTED_MODULE_16__.pb)(e.borderVisible)},isBorderRadius:function(){var e=this.data.attributes,t=e&&e.isBorderRadius;return!!t&&this.getValue(t)},borderRadius:function(){var e=this.data.attributes,t=e&&e["border-radius"],a=t?this.getValue(t,!1,this.$util.getThemeValueByName("blockBorderRadius")):null;return"array"===Object(_libs_base_util__WEBPACK_IMPORTED_MODULE_18__.g)(a)?a.map((function(e,t){return e+"px"})).join(" "):a||""},isBoxShadow:function(){var e=this.data.attributes,t=e&&e["box-shadow"];return!!t&&this.getValue(t)},boxShadow:function(){return this.$util.getThemeValueByName("blockShadow")},blockBackground:function(){return this.$util.getThemeValueByName("blockBackground")},blockBorderWidth:function(){var e=this,t=this.$util.getThemeValueByName("blockBorderWidth");return"array"===Object(_libs_base_util__WEBPACK_IMPORTED_MODULE_18__.g)(t)?t.map((function(t,a){return 0===t&&e.hasBorder&&!e.runtime?"1px":t+"px"})).join(" "):t||""},blockBorderStyle:function(){var e=this,t=this.data.attributes,a=t&&t["border-style"],i=a?this.getValue(a,!1,this.$util.getThemeValueByName("blockBorderStyle")):null;return"array"===Object(_libs_base_util__WEBPACK_IMPORTED_MODULE_18__.g)(i)?i.map((function(t,a){return"none"===t&&e.hasBorder&&!e.runtime?"dashed":t})).join(" "):i||""},blockBorderColor:function blockBorderColor(){var _this3=this,_value2,attributes=this.data.attributes,attr=attributes&&attributes["border-color"],value=attr?this.getValue(attr,!1,this.$util.getThemeValueByName("blockBorderColor")):null,getValue=function(e){return e.map((function(e,t){return""!==e&&"transparent"!==e||!_this3.hasBorder||_this3.runtime?""===e||void 0===e||void 0===e?"transparent":e:"#ddd"})).join(" ")},_value;if("array"===Object(_libs_base_util__WEBPACK_IMPORTED_MODULE_18__.g)(value))return getValue(value);try{var tmp=eval(value);Array.isArray(tmp)&&(_value=tmp)}catch(e){}return null!==(_value2=_value)&&void 0!==_value2&&_value2.length?getValue(_value):value||""},stylesInner:function(){var e=this,t=this.data.attributes,a={height:"100%"},i={appearance:!0,layout:!0,quickLayout:!0},n=function(){var n=t[r];if(!1===n.visible)return 0;if("position"===n.name)return 0;if(i[n.groupName]){var o=new _libs_type_parser__WEBPACK_IMPORTED_MODULE_15__.a(n.type),l=o.getBaseType(),s=o.getIsLen();-1!==innerStyles.findIndex((function(e){return n.name===e}))&&(a[n.name]=e.getConvertedValue(n,l,s)),o.destroy()}};for(var r in t)n();return a},styles:function(){var e=this,t=this.data.attributes,a={},i={appearance:!0,layout:!0,quickLayout:!0},n=function(){var n,o,l=t[r];if(null!=l&&null!==(n=l.attributes)&&void 0!==n&&n.length&&Array.isArray(l.attributes)&&l.attributes.forEach((function(t){for(var a in t){var i=t[a];"color"===i.editor&&e.onChangeThemeColorValue(i)}})),Object(_libs_util__WEBPACK_IMPORTED_MODULE_16__.tb)(l.attributes))for(var s in l.attributes){var c=l.attributes[s];"color"===c.editor&&e.onChangeThemeColorValue(c)}if(("color"===l.editor&&e.onChangeThemeColorValue(l),"file"===l.editor)&&1===(null==l||null===(o=l.editValue)||void 0===o?void 0:o.source)){var u,d=null==l||null===(u=l.editValue)||void 0===u?void 0:u.relativePath,p=e.$util.getFileFullPath(d);d?(e.$setAttr(l,"lastValue",p),e.$setAttr(l,"value",p)):l.value||e.$removeAttr(l,"value")}if(!1===l.visible||styleExcludes.find((function(e){return e===l.name}))||-1!==innerStyles.findIndex((function(e){return l.name===e})))return 0;if(i[l.groupName]){if("background-image"===l.name&&!e.getValue(l))return 0;if("background-color"===l.name&&"Grid"===e.componentType){var h=e.getValue(l);return h&&(a["background-color"]=h),0}if("borderVisible"===l.name){if("Grid"===e.componentType)return 0;if(!0===e.getValue(l))-1!==e.blockBorderStyle.search("double")||(a["border-width"]=e.blockBorderWidth),a["border-style"]=e.blockBorderStyle,a["border-color"]=e.blockBorderColor;else e.hasBorder&&!e.runtime&&(a.border="1px dashed #ddd");return 0}if("box-shadow"===l.name)return"Grid"===e.componentType||(!0===e.getValue(l)?a["box-shadow"]=e.boxShadow:delete a["box-shadow"]),0;if("isBorderRadius"===l.name)return"Grid"===e.componentType||"Tabs"===e.componentType||(!0===e.getValue(l)?a["border-radius"]=e.borderRadius:delete a["border-radius"]),0;if("auto"!==e.getValue(l)){var f=new _libs_type_parser__WEBPACK_IMPORTED_MODULE_15__.a(l.type),m=f.getBaseType(),v=f.getIsLen();a[l.name]=e.getConvertedValue(l,m,v),f.destroy()}}};for(var r in t)n();return"Grid"!==this.componentType||this.runtime||(a.border="0"),a},headerStyle:function(){var e={};if(this.stylesInner){var t=(this.stylesInner.padding||"").split(" ");e["padding-left"]=t[3],e["padding-right"]=t[1],e.color=this.stylesInner.color,e["font-size"]=this.stylesInner["font-size"]}if(this.styles){var a=(this.styles["border-width"]||"").split(" "),i=(this.styles["border-style"]||"").split(" "),n=(this.styles["border-color"]||"").split(" ");e["border-bottom-width"]=a[0],e["border-bottom-style"]=i[0],e["border-bottom-color"]=n[0]}return e},autoHeight:function(){return this.runtime?this.$store.getters.pageViewStore.pageContentHeight:this.$store.getters.pageEditor.pageContentHeight},foreachData:function(){var e,t,a;return null===(e=this.data)||void 0===e||null===(t=e.attributes)||void 0===t||null===(a=t.foreachData)||void 0===a?void 0:a.value},foreachItemAttr:function(){var e,t,a;return null===(e=this.data)||void 0===e||null===(t=e.attributes)||void 0===t||null===(a=t.foreachItemAttr)||void 0===a?void 0:a.value},foreachItemName:function(){var e,t,a;return null===(e=this.data)||void 0===e||null===(t=e.attributes)||void 0===t||null===(a=t.foreachItemName)||void 0===a?void 0:a.value},pageParser:function(){return this.$getPageParser()},isContainer:function(){return["dataContainer"].includes(this.data.groupName)},height:function(){var e,t,a,i;return(null===(e=this.data.attributes)||void 0===e||null===(t=e.height)||void 0===t?void 0:t.value)||(null===(a=this.data.attributes)||void 0===a||null===(i=a.height)||void 0===i?void 0:i.default)},isEmptyContainer:function(){return this.isContainer&&this.runtime&&this.fid}}),created:function(){this.register(),this.init()},methods:{getValue:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2?arguments[2]:void 0;if(t)return Object(_libs_util__WEBPACK_IMPORTED_MODULE_16__.pb)(e);if(this.runtime)return Object(_libs_util__WEBPACK_IMPORTED_MODULE_16__.pb)(null==e?void 0:e.value,(null==e?void 0:e.default)||a);var i=null==e?void 0:e.linkConfig;return i?(null==e?void 0:e.default)||a:Object(_libs_util__WEBPACK_IMPORTED_MODULE_16__.pb)(null==e?void 0:e.value,(null==e?void 0:e.default)||a)},compatibleData:function(){var e,t,a=this.data.attributes;null!==(e=this.data)&&void 0!==e&&null!==(t=e.compatibleConfig)&&void 0!==t&&t.addLgCol||(a.lg&&!a.lg.hasOwnProperty("value")&&(a.span.hasOwnProperty("value")?this.$setAttr(a.lg,"value",a.span.value):this.$setAttr(a.lg,"default",a.span.default)),this.data.compatibleConfig||(this.data.compatibleConfig={}),this.data.compatibleConfig.addLgCol=!0)},compilerColor:function(e){return Object(_libs_util__WEBPACK_IMPORTED_MODULE_16__.cb)(e,this.$store.getters||{},(function(e,t){return t?e[t]:Object(_libs_util__WEBPACK_IMPORTED_MODULE_16__.p)(e[t])||e[t]}))},onChangeThemeColorValue:function(e){var t=this;if(e.value)if(Array.isArray(e.value)){var a=e.value.map((function(e){var a;return t.compilerColor((null==e||null===(a=e.editValue)||void 0===a?void 0:a.themeKey)||e)}));if(JSON.stringify(a)===JSON.stringify(e.value))return;this.$setAttr(e,"value",a)}else{var i,n=this.compilerColor((null==e||null===(i=e.editValue)||void 0===i?void 0:i.themeKey)||e.value);if(JSON.stringify(n)===JSON.stringify(e.value))return;this.$setAttr(e,"value",n)}},register:function(){if(this.runtime){var e=this.pageId;if(!e)return;this.$store.commit("SET_COMPONENT_INSTANCE_BY_PAGE_ID",{pageId:e,componentName:"basicComponent",fid:"basicComponent",componentInstance:this})}else this.$store.dispatch("registerComponentInstance",{componentName:"basicComponent",fid:"basicComponent",componentInstance:this})},init:function(){var e,t;if(this.compatibleData(),!this.data.pageVersion){var a=this.data.groupName;this.parentComponentName||"form"!==a||(this.$removeAttr(this.data.attributes.margin,"value"),this.$removeAttr(this.data.attributes.padding,"value"));var i=null===(e=this.data)||void 0===e||null===(t=e.attributes)||void 0===t?void 0:t.borderVisible;if(i)this.getValue(i)||(this.$setAttr(this.data.attributes["border-style"],"visible",!1),this.$setAttr(this.data.attributes["border-color"],"visible",!1))}},getCalcHeight:function(e){var t=this.getValue(e);return t.indexOf("%")>-1&&(t=t.replace("%","")*this.pageContentHeight/100-2+"px"),t},getConvertedValue:function(e,t,a){if("background-image"===e.name)return'url("'+this.getValue(e,!1,Object(_libs_util__WEBPACK_IMPORTED_MODULE_16__.nb)(e.name))+'")';if("display"===e.name)return this.getValue(e)?"":"none";if("margin"===e.name||"padding"===e.name){var i=this.getValue(e,!1,Object(_libs_util__WEBPACK_IMPORTED_MODULE_16__.nb)(e.name),e.type);return"array"===Object(_libs_base_util__WEBPACK_IMPORTED_MODULE_18__.g)(i)?i.map((function(e,t){return e+"px"})).join(" "):i}if("border-style"===e.name){if(this.hasBorder&&!this.borderVisible)return"dashed";var n=this.getValue(e,!1,Object(_libs_util__WEBPACK_IMPORTED_MODULE_16__.nb)("blockBorderStyle"),e.type);return"array"===Object(_libs_base_util__WEBPACK_IMPORTED_MODULE_18__.g)(n)?n.join(" "):n}if("border-color"===e.name){var r=this.getValue(e,!1,Object(_libs_util__WEBPACK_IMPORTED_MODULE_16__.nb)("blockBorderColor"),e.type);return"array"===Object(_libs_base_util__WEBPACK_IMPORTED_MODULE_18__.g)(r)?r.map((function(e,t){return e||"transparent"})).join(" "):r}if("border-radius"===e.name){var o=this.getValue(e,!1,Object(_libs_util__WEBPACK_IMPORTED_MODULE_16__.nb)("blockRadius"),e.type);return"array"===Object(_libs_base_util__WEBPACK_IMPORTED_MODULE_18__.g)(o)?o.map((function(e,t){return e?e+"px":"0px"})).join(" "):o}if("color"===e.editor){var l=["quickLayout","layout","dataContainer"].includes(this.data.groupName)||"background-color"!==e.name?Object(_libs_util__WEBPACK_IMPORTED_MODULE_16__.nb)(e.name):"transparent",s=this.getValue(e,!1,l,e.type)||"transparent";return a&&"array"===Object(_libs_base_util__WEBPACK_IMPORTED_MODULE_18__.g)(s)?s.map((function(e){return Object(_libs_util__WEBPACK_IMPORTED_MODULE_16__.cb)(e)})).join(" "):Object(_libs_util__WEBPACK_IMPORTED_MODULE_16__.cb)(s)}var c=this.getValue(e,!1,Object(_libs_util__WEBPACK_IMPORTED_MODULE_16__.nb)(e.name))+("Number"===t&&"z-index"!==e.name?"px":"");return"height"===e.name&&"string"===Object(_libs_base_util__WEBPACK_IMPORTED_MODULE_18__.g)(c)&&-1!==c.indexOf("calc(")?"100%":c},basicChangeHandler:function(e,t,a,i){return"blockToolbarShowType"===a.name?this.handleBlockToolbar(e,t,a,i):"heightFilled"===a.name?this.handleChangeHeightFilled(e,t,a,i):"borderVisible"===a.name?this.handleChangeIsBorderVisible(e,t,a,i):"isBorderRadius"===a.name?this.handleChangeIsBorderRadius(e,t,a,i):"position"===a.name?this.handleChangePosition(e,t,a,i):void 0},handleBlockToolbar:function(e,t,a,i){var n=this,r=i&&i.blockToolbar||[],o=a.fid;"none"===e?r.forEach((function(e){a.hasOwnProperty("fid")?e.fid===o&&n.$setAttr(e,"visible",!1):n.$setAttr(e,"visible",!1)})):r.forEach((function(e){a.hasOwnProperty("fid")?e.fid===o&&n.$setAttr(e,"visible",!0):n.$setAttr(e,"visible",!0)}))},handleChangeHeightFilled:function(e,t,a,i){var n=this,r=i&&i.filledHeight||[];!1===e?r.forEach((function(e){"height"!==e.name?"offsetTop"===e.name&&n.$setAttr(e,"visible",!1):n.$setAttr(e,"visible",!0)})):r.forEach((function(e){"height"!==e.name?"offsetTop"===e.name&&n.$setAttr(e,"visible",!0):n.$setAttr(e,"visible",!1)}))},handleChangeIsBorderVisible:function(e,t,a,i){var n,r=this,o=i&&i.borderVisibleRelated||[],l=a.fid,s=this.activeComponentFid,c=null==this||null===(n=this.currentPage)||void 0===n?void 0:n.componentKV[s],u=["Flow","Grid"].includes(null==c?void 0:c.name);o.forEach((function(t){"blockPadding"!==t.name||u?a.hasOwnProperty("fid")?t.fid===l&&r.$setAttr(t,"visible",e):r.$setAttr(t,"visible",e):r.$setAttr(t,"visible",!1)}))},handleChangeIsBorder:function(e,t,a,i){var n=this,r=i&&i.isBorderRelated||[],o=a.fid;r.forEach((function(t){a.hasOwnProperty("fid")?t.fid===o&&n.$setAttr(t,"visible",e):n.$setAttr(t,"visible",e)}))},handleChangeIsBorderRadius:function(e,t,a,i){var n=this,r=i&&i.borderRadiusRelated||[],o=a.fid;r.forEach((function(t){a.hasOwnProperty("fid")?t.fid===o&&n.$setAttr(t,"visible",e):n.$setAttr(t,"visible",e)}))},handleChangePosition:function(e,t,a,i){var n=this;(i&&i.position||[]).forEach((function(t){"none"!==e?n.$setAttr(t,"visible",!0):n.$setAttr(t,"visible",!1)}))},handleToolbarChange:function(e,t){this.runtime&&this.$eventContentParse(t.blockToolbarContent)},handleSelect:function(e,t){this.runtime?this.clickStop&&t.stopPropagation():(this.$store.dispatch("updateActiveComponent",e),t.stopPropagation())},handleCopy:function(e){this.data.hasOwnProperty("author")&&this.$store.dispatch("copyComponent",{fid:e,data:this.data,target:this.parent})},handleCopyOnly:function(){var e=Object(_libs_base_util__WEBPACK_IMPORTED_MODULE_18__.e)(this.data);localStorage.setItem("inovance-webtools-page-clip",JSON.stringify(e)),this.$message({message:"拷贝成功",type:"success"})},handlePasteOnly:function(e){var t=this,a=localStorage.getItem("inovance-webtools-page-clip");if(a)try{var i=JSON.parse(a);if(!this.data.parentFid&&"layout"!==i.groupName)return void this.$message({message:"不可复制在页面最外层",type:"warning"});i.pageId=this.pageId,i.parentFid=this.data.parentFid;var n={componentName:i.attributes.componentName.value,componentType:i.attributes.componentType.value,componentFid:i.fid};for(var r in i.attributes)i.attributes[r].componentName||(i.attributes[r].componentName=n.componentName),i.attributes[r].componentType||(i.attributes[r].componentType=n.componentType),i.attributes[r].componentFid||(i.attributes[r].componentFid=n.componentFid);this.$store.dispatch("copyComponent",{fid:e,data:i,target:this.parent}),this.$message({message:"粘贴成功! ",type:"success",duration:3e3}),setTimeout((function(){t.$message({message:"该功能不会自动将关联组件带入，如果事件或脚本中使用了组件方法，将可能失效，须重新配置。",type:"info",duration:2e3})}),100)}catch(e){this.$message({message:"组件格式错误，不可粘贴",type:"warning"})}else this.$message({message:"暂无可粘贴组件",type:"warning"})},handleRemove:function(e){var t=this;this.$confirm("确定要删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.$store.dispatch("removeComponent",e)})).catch((function(){}))},getCopyComponents:function(e,t,a){var i=this.pageParser.getCopyComponentFids(a);return i&&i.length?this.getLoopedChildren(t,e,a,i):this.getFirstLoopChildren(t,e,a)},getLoopedChildren:function(e,t,a,i){var n=this,r=Object(_Users_yinhao_Workspace_frontend_page_webtools_page_node_modules_babel_runtime_corejs2_helpers_esm_toConsumableArray_js__WEBPACK_IMPORTED_MODULE_2__.a)(i),o=Object(_Users_yinhao_Workspace_frontend_page_webtools_page_node_modules_babel_runtime_corejs2_helpers_esm_toConsumableArray_js__WEBPACK_IMPORTED_MODULE_2__.a)(i),l=r.length,s=t.length,c=[];if(!s)return r.forEach((function(e){var t,a=n.pageParser.getComponentByFid(e);null!=a&&null!==(t=a.attributes)&&void 0!==t&&t.visibility&&n.$set(a.attributes.visibility,"value","none")})),e;if(this.pageParser.setForeachKeyData(a,t),t.forEach((function(e,t){var i,o,l=r.shift();if(!l){var s,u,d=n.$util.getUid(),p=n.pageParser.getCopyComponentOrigin(a),h=n.pageParser.getCopyComponent(p,d,a);return n.$delete(null==h?void 0:h.attributes,"foreachData"),n.$delete(null==h?void 0:h.attributes,"foreachItemAttr"),"none"===(null==h||null===(s=h.attributes)||void 0===s||null===(u=s.visibility)||void 0===u?void 0:u.value)&&n.$delete(h.attributes.visibility,"value"),n.pageParser.setForeachItemKey(d,a),n.pageParser.setForeachItemData(d,e),n.pageParser.setCopyItemLinkData(e,d),void c.push(h)}var f=n.pageParser.getComponentByFid(l);"none"===(null==f||null===(i=f.attributes)||void 0===i||null===(o=i.visibility)||void 0===o?void 0:o.value)&&n.$delete(f.attributes.visibility,"value"),n.pageParser.setForeachItemData(l,e),n.pageParser.setCopyItemLinkData(e,f.fid)})),s===l)return e;if(c.length){var u=o[o.length-1],d=e.findIndex((function(e){return e.fid===u}));e.splice.apply(e,[d+1,0].concat(c))}return s<l&&r.forEach((function(e){var t,a=n.pageParser.getComponentByFid(e);null!=a&&null!==(t=a.attributes)&&void 0!==t&&t.visibility&&n.$set(a.attributes.visibility,"value","none")})),e},getFirstLoopChildren:function(e,t,a){var i=this;if(!e||!e.length||"array"!==this.$util.getObjType(e))return e;var n=[],r={};return this.pageParser.setForeachKeyData(a,t),e.forEach((function(o){var l;o.fid===a&&((o.children||[]).forEach((function(e){i.delCopyChild(e)})),n.push(o.fid),r[o.fid]=[],t.forEach((function(t,n){var l,s,c=null==e?void 0:e.find((function(e){var n=i.pageParser.getForeachItemData(e.fid),r=i.pageParser.getForeachItemKey(e.fid);return t===n&&r===a}));if(c)i.pageParser.setCopyItemLinkData(t,c.fid);else{var u=i.$util.getUid(),d=i.pageParser.getCopyComponent(o,u,a);i.$delete(null==d?void 0:d.attributes,"foreachData"),i.$delete(null==d?void 0:d.attributes,"foreachItemAttr"),"none"===(null==d||null===(l=d.attributes)||void 0===l||null===(s=l.visibility)||void 0===s?void 0:s.value)&&i.$delete(d.attributes.visibility,"value"),i.pageParser.setForeachItemKey(u,a),i.pageParser.setForeachItemData(u,t),i.pageParser.setCopyItemLinkData(t,u),r[o.fid].push(d)}})),null!=o&&null!==(l=o.attributes)&&void 0!==l&&l.visibility&&i.$set(o.attributes.visibility,"value","none"))})),n.forEach((function(t){var a=e.findIndex((function(e){return e.fid===t})),i=r[t];e.splice.apply(e,[a+1,0].concat(Object(_Users_yinhao_Workspace_frontend_page_webtools_page_node_modules_babel_runtime_corejs2_helpers_esm_toConsumableArray_js__WEBPACK_IMPORTED_MODULE_2__.a)(i)))})),e},delCopyChild:function(e){if(e.hasOwnProperty("children")&&!((null==e?void 0:e.children.length)<1)){var t=(e.children||[]).filter((function(e){var t=e.attributes;return!(null!=t&&t.hasOwnProperty("foreachItemName")&&(null==t||!t.hasOwnProperty("foreachData")))}));e.children=Object(_Users_yinhao_Workspace_frontend_page_webtools_page_node_modules_babel_runtime_corejs2_helpers_esm_toConsumableArray_js__WEBPACK_IMPORTED_MODULE_2__.a)(t),this.delCopyChild(t)}}}}},e7fb:function(e,t,a){"use strict";a("0eea")},e8a7:function(e,t,a){"use strict";a.r(t),t.default=a.p+"img/no-publish.a1d55533.png"},e8ad:function(e,t,a){"use strict";a("cef0")},e9b4:function(e,t,a){},ea9c:function(e,t,a){"use strict";a("62bd")},eab8:function(e,t,a){"use strict";a("50e8")},eae8:function(e,t,a){"use strict";a("7514"),a("7f7f"),a("f559"),a("6762"),a("2fdb"),a("c5f6"),a("28a5"),a("456d"),a("ac6a");var i={name:"ComponentNotfound",props:{runtime:{type:Boolean,default:!1},data:{type:Object,default:function(){}}},data:function(){return{message:"组件未注册或正在升级,请刷新重试!"}},created:function(){this.setMessage()},methods:{setMessage:function(){var e=this;(this.runtime?this.$store.getters.pageViewStore.disableComponents:this.$store.getters.pageEditor.disableComponents).find((function(t){return t===e.data.name}))&&(this.message="该组件已被停用!")}}},n=(a("bd0e"),a("2877")),r=Object(n.a)(i,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"component-notfound"},[t("p",[e._v(e._s(e.message))]),t("p",[e._v("组件名称："+e._s(e.data.name))])])}),[],!1,null,"01f756fb",null).exports,o=a("c276");t.a={components:{ComponentNotfound:r},props:["data","parent","runtime","pageId","pageContentHeight","hasBorder","isSelected"],data:function(){return{vm:null,proxyData:{},originMap:{}}},render:function(e,t){var a={props:{data:this.data,proxy:this.proxyData,parent:this.parent,runtime:this.runtime,pageId:this.pageId,pageContentHeight:this.pageContentHeight,hasBorder:this.hasBorder,isSelected:this.isSelected}},i=e(this.getTagName(),a,[]);return this.vm=i,i},watch:{"vm.componentInstance":function(e,t){this.setCustomMethods(),this.register()}},computed:{customMethods:function(){var e=this,t={};if(this.runtime){var a=this.data.attributes.customMethods;((null==a?void 0:a.attributes)||[]).forEach((function(a){var i,n=a.customMethodsSetting.attributes;t[Object(o.pb)(n.functionName.value,n.functionName.default)]=Object(o.Z)(n,null===(i=e.vm)||void 0===i?void 0:i.componentInstance)}))}return t}},created:function(){this.parseData(this.data,this.proxyData,this.originMap)},beforeDestroy:function(){this.$store.dispatch("deleteComponentInstance",{pageId:this.pageId,fid:this.data.fid}),this.vm=null},methods:{setCustomMethods:function(){var e=this;this.runtime&&Object.keys(this.customMethods).forEach((function(t){e.vm.componentInstance["$_"+t]=e.customMethods[t]}))},parseData:function(e,t,a){var i=this,n=e.attributes,r=this,l={};try{var s=function(e,a,i,s,c,u){if("__originValue__"===a){var d=c?".".concat(c):"",p="".concat(u).concat(d);!function e(a){if(!Object(o.bb)(t,a)){var i=a.indexOf(".")>-1,l=a,s="";i&&(l=a.slice(0,a.lastIndexOf(".")),s=a.slice(a.lastIndexOf(".")+1,a.length));var d=(c||"").split(".").reduce((function(e,t){return"".concat(e?"".concat(e,"."):"").concat(t&&!isNaN(t)?"attributes.".concat(t):t)}),""),p=function(){var e={};return Object.defineProperties(e,{setPropAttr:{value:function(e,t,a){var i=Object(o.bb)(n,d),l=i&&(i[e]||!i.hasOwnProperty(e)&&i.attributes&&i.attributes[e]);l&&JSON.stringify(a)!==JSON.stringify(l[t])&&r.$setAttr(l,t,a)}},getPropAttr:{value:function(e,t){var a=Object(o.bb)(n,d),i=a&&(a[e]||!a.hasOwnProperty(e)&&a.attributes&&a.attributes[e]);return i&&i[t]}}}),e};if(s&&!isNaN(s)){Object(o.bb)(t,l)||(i&&e(l),r.$set(i?Object(o.bb)(t,l.slice(0,l.lastIndexOf("."))):t,i?l.slice(l.lastIndexOf(".")+1,l.length):u,[]));for(var h=Object(o.bb)(t,l),f=0;f<=Number(s);f++)h.length>f||h.push(p())}else i&&e(l),r.$set(i?Object(o.bb)(t,l):t,i?s:u,p())}}(p);var h=p+s;"function"==typeof l[h]&&l[h](),JSON.stringify(i)!==JSON.stringify(Object(o.bb)(t,p)[s])&&r.$set(Object(o.bb)(t,p),s,i),l[h]=r.$watch((function(){return Object(o.bb)(t,p)[s]}),(function(e){var t=(c||"").split(".").reduce((function(e,t){return"".concat(e?"".concat(e,"."):"").concat(t&&!isNaN(t)?"attributes.".concat(t):t)}),""),a=Object(o.bb)(n,t)[s];a&&e!==(a.hasOwnProperty("value")?null==a?void 0:a.value:null==a?void 0:a.default)&&r.$setAttr(Object(o.bb)(n,t)[s],"value",e)}))}};!function e(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0,r=function(r){var o=t[r];if(["methods","events"].includes(n||o.originGroupName||o.groupName))return 1;if((o.type||"").startsWith("Complex")&&o.hasOwnProperty("attributes")){var l=o.attributes;null!=l&&l.length?l.forEach((function(t,i){e(t,"".concat(a?a+".":"").concat(r,".").concat(i),n||o.groupName)})):e(l,"".concat(a?a+".":"").concat(r),n||o.groupName)}else{var c;s(0,"__originValue__",null!==(c=null==o?void 0:o.value)&&void 0!==c?c:null==o?void 0:o.default,r,a,n||o.groupName),i.$set(t[r],"__originDefault__",t[r].default),i.$set(t[r],"__originValue__",t[r].value),Object.defineProperty(t[r],"__isProxy__",{value:"Proxy",enumerable:!1,configurable:!0}),Object.defineProperty(t[r],"__originDefault__",{configurable:!0,enumerable:!0,get:function(){var e=Object.getOwnPropertyDescriptor(t[r],"default")||{};return e.hasOwnProperty("get")?e.get():e.value},set:function(e){return t[r].hasOwnProperty("value")||s(t[r],"__originValue__",e,r,a,n||o.groupName),!0}}),Object.defineProperty(t[r],"__originValue__",{configurable:!0,enumerable:!0,get:function(){var e=Object.getOwnPropertyDescriptor(t[r],"value")||{};return e.hasOwnProperty("get")?e.get():e.value},set:function(e){return s(t[r],"__originValue__","__delete__"===e?t[r].default:e,r,a,n||o.groupName),!0}})}};for(var o in t)r(o)}(n)}catch(e){this.$sendLog({logData:{message:e.message,info:"数据解析出错"}})}},register:function(){var e=this,t=this.data.attributes,a=t&&t.componentName&&t.componentName.value;if(this.runtime){var i,n=this.pageId;if(!n)return;if(this.$store.commit("SET_COMPONENT_INSTANCE_BY_PAGE_ID",{pageId:n,componentName:a,fid:this.data.fid,componentInstance:this.vm.componentInstance}),"Grid"===this.data.name)((null===(i=this.data)||void 0===i?void 0:i.children)||[]).forEach((function(t){e.$store.commit("SET_COMPONENT_INSTANCE_BY_PAGE_ID",{pageId:n,componentName:a,fid:t.fid,componentInstance:e.vm.componentInstance})}))}else this.$store.dispatch("registerComponentInstance",{componentName:a,fid:this.data.fid,componentInstance:this.vm.componentInstance})},getStore:function(){var e=this.$store.getters;return this.runtime?null==e?void 0:e.pageViewStore:null==e?void 0:e.pageEditor},getTagName:function(){var e,t,a=this.data.name||this.data.componentType,i=this.getStore();return(null===(e=window.Vue)||void 0===e||null===(t=e.options)||void 0===t?void 0:t.components[a])?(null==i?void 0:i.disableComponents).find((function(e){return e===a}))?"component-notfound":a:"component-notfound"},getTagNameBack:function(){var e=this.data.name||this.data.componentType,t=this.$options.components[e];if(!this.runtime){var a,i=((null===(a=this.$store.getters.pageEditor)||void 0===a?void 0:a.originComponents)||[]).find((function(t){return t.name===e}));null!=i&&i.status&&(t=!0)}return t?e:"component-notfound"}}}},ebea:function(e,t,a){"use strict";a("aaa2")},ec2f:function(e,t,a){"use strict";a("278e")},ec82:function(e,t,a){},ed60:function(e,t,a){},ed9e:function(e,t,a){"use strict";a.r(t),a("7f7f");var i=(a("8e6e"),a("456d"),a("28a5"),a("ac6a"),a("7514"),a("75fc")),n=a("bd86"),r=a("c276"),o=a("0d35"),l=a("b19c"),s=(a("c5f6"),function e(t,a){if(a.some((function(e){return(null==e?void 0:e.name)===t}))){var i=1;return a.forEach((function(e){var a=e.name.split(t)[1];Number(a)&&(i=Math.max(Number(a)+1,i))})),e("".concat(t).concat(i),a)}return t}),c=a("2f62");function u(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function d(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?u(Object(a),!0).forEach((function(t){Object(n.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):u(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var p=function(e){var t={};for(var a in e){var i=e[a];"name"===a?t.name=Object(r.pb)(i.value,i.default):"alias"===a?t.alias=Object(r.pb)(i.value,i.default):"description"===a?t.description=Object(r.pb)(i.value,i.default):"editor"===a&&(t.editor=Object(r.pb)(i.value,i.default))}return t},h={name:"ApiEditor",components:{CallbackContent:o.a},props:{title:{type:String,default:function(){return"执行API设置"}},showInput:{type:String,default:function(){return!0}},iconClass:{type:String,default:function(){return"el-icon-edit"}},parentParent:{type:Object,default:function(){return{}}},parent:{type:Object,default:function(){return{}}},data:{type:Object,default:function(){return{}}},args:{type:Array,default:function(){return[]}},hasCallback:{type:Boolean,default:function(){return!0}},placeholder:{type:String,default:""},handleRulesResult:{type:Function,default:function(){}},handleChangeResult:{type:Function,default:function(){}}},watch:{"data.value":function(){this.initData()},dialogVisible:function(e){e&&this.initData()}},data:function(){return{isPageEvent:!1,changed:!0,filterTypes:[{label:"无",value:""},{label:"等于",value:"eq"},{label:"不等于",value:"ne"},{label:"大于",value:"gt"},{label:"大于等于",value:"gte"},{label:"小于",value:"lt"},{label:"小于等于",value:"lte"}],queryTypes:[{label:"POST",value:"post"},{label:"GET",value:"get"},{label:"PATCH",value:"patch"},{label:"DELETE",value:"delete"}],responseTypes:[{label:"默认",value:""},{label:"Blob对象",value:"blob"},{label:"Document对象",value:"document"}],contentTypes:[{label:"application/json",value:"application/json"},{label:"multipart/form-data",value:"multipart/form-data"}],showVal:"",copayEditVal:{type:"api",url:"",method:"POST",responseType:"",contentType:"application/json",isValidation:!this.isPageEvent,payloads:[{name:"",value:"",filter:"",editValue:null}],beforeEvents:[],callbacks:[],errorCallbacks:[],errorValidator:[{errorId:"",message:""}]},editVal:{type:"api",url:"",method:"POST",responseType:"",contentType:"application/json",isValidation:!this.isPageEvent,payloads:[{name:"",value:"",filter:"",editValue:null}],beforeEvents:[],callbacks:[],errorCallbacks:[],errorValidator:[{errorId:"",message:""}]},dialogVisible:!1,compoundItem:[{label:"变量选择",value:"variable",formItem:"variable-Panel"},{label:"手动输入",value:"static",formItem:"input",placeholder:"支持字符、${...}、字符与${...}混合三种形式的输入，${...}是对变量的引用，其中...为变量名",tips:"支持字符、${...}、字符与${...}混合三种形式的输入，${...}是对变量的引用，其中...为变量名"},{label:"表达式",value:"useExpression",formItem:"input",placeholder:"支持js表达式语法，支持混合使用变量，${...}是对变量的引用，其中...为变量名",tips:"支持js表达式语法，支持混合使用变量，${...}是对变量的引用，其中...为变量名"}]}},computed:d(d({},Object(c.a)(["currentPage"])),{},{themeStyles:function(){return{target:"th,td",style:{"border-width":Object(r.nb)("borderWidth"),"border-style":Object(r.nb)("borderStyle"),"border-color":Object(r.nb)("borderColor"),padding:"0 5px"}}},theadStyles:function(){return{"background-color":Object(r.nb)("middleBackgroundColor")}},pageInfo:function(){var e=this.$store.getters.pageEditor;return e.pagesKV[e.pagesActiveName]},eventContentArgs:function(){return[{name:s("result",this.newArgs),alias:"响应结果",type:"Response",description:"接口返回的响应结果"}].concat(Object(i.a)(this.newArgs))},errorEventContentArgs:function(){return[{name:s("error",this.newArgs),alias:"响应结果",type:"Response",description:"接口返回的响应结果"}].concat(Object(i.a)(this.newArgs))},beforeEventsArgs:function(){return[{name:s("options",this.newArgs),alias:"请求参数",type:"Request",description:"可对请求参数对象直接改写"}].concat(Object(i.a)(this.newArgs))},newArgs:function(){if(this.args&&this.args.length)return Object(i.a)(this.args);var e=this.getPayloads(this.parent&&this.parent.attributes);return e.length>0?e:(e=this.getPayloads(this.parentParent&&this.parentParent.attributes)).length>0?e:[]}}),created:function(){this.setIsPageEvent(),this.initData()},methods:{copyEvents:function(e){var t,a={id:null==this||null===(t=this.currentPage)||void 0===t?void 0:t.pageId,data:e},i="";try{i=JSON.stringify(a)}catch(e){this.$message.error("复制失败！")}i&&Object(r.t)(i)},pasteEvents:function(e){var t,a=this,n=null==this||null===(t=this.currentPage)||void 0===t?void 0:t.pageId;Object(r.u)().then((function(t){var r,o,l,s,c=[];try{c=JSON.parse(t)}catch(e){a.$message.error("粘贴失败")}null!==(r=c)&&void 0!==r&&r.id&&null!==(o=c)&&void 0!==o&&o.data&&Array.isArray(c.data)&&null!==(l=c)&&void 0!==l&&null!==(s=l.data)&&void 0!==s&&s.length&&c.data.every((function(e){return e.executionType}))?n===c.id?(a.editVal[e]=[].concat(Object(i.a)(a.editVal[e]||[]),Object(i.a)(c.data)),a.$message.success("粘贴成功")):a.$message.warning("暂不支持跨页面复制"):a.$message.error("粘贴失败")}))},setIsPageEvent:function(){var e=this,t=["onbeforeload","onload","beforeunload"].find((function(t){var a;return t===(null===(a=e.parentParent)||void 0===a?void 0:a.name)}));this.isPageEvent=!!t,this.copayEditVal.isValidation=!this.isPageEvent,this.editVal.isValidation=!this.isPageEvent},getPayloads:function(e){var t=[];if("array"===Object(l.g)(e))e.forEach((function(e){if(!t.length){var a="payload"===e.name?e.attributes:e.payload?e.payload.attributes:null;a&&a.forEach((function(e){var a=p(e);t.push(a)}))}}));else if("object"===Object(l.g)(e))for(var a in e)if("payload"===a){e[a].attributes.forEach((function(e){var a=p(e);t.push(a)}))}return t},initData:function(){var e=Object(r.pb)(this.data.value,this.data.default);"object"===Object(l.g)(e)&&(e.method=e.type,e.type="api",this.data.editValue=e,this.data.value=Object(l.b)(e)),this.data.editValue&&"api"===this.data.editValue.type?(this.editVal=Object(l.e)(this.data.editValue),this.editVal.hasOwnProperty("isValidation")||this.isPageEvent||this.$set(this.editVal,"isValidation",!0),this.showVal=this.getShowVal()):(this.editVal=Object(l.e)(this.copayEditVal),this.showVal=this.getShowVal()),this.editVal.payloads&&this.editVal.payloads.length||(this.editVal.payloads=[{name:"",value:"",filter:"",editValue:null}]),this.editVal.errorValidator&&this.editVal.errorValidator.length||(this.editVal.errorValidator=[{errorId:"",message:""}]),this.editVal.contentType||(this.editVal.contentType="application/json"),this.editVal.hasOwnProperty("responseType")||this.$set(this.editVal,"responseType","")},handleIconClick:function(){this.open()},handleErrorEvents:function(e,t){this.handleEvents(e,t,"errorValidator")},handleEvents:function(e,t){var a=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"payloads",n=this.editVal[i].length;if("add"!==e)if("del"!==e)if("top"!==e){if("bottom"===e){if(t===n-1)return;var o=this.editVal[i].splice(t,1);this.editVal[i].splice(t+1,0,o[0])}}else{if(0===t)return;var s=this.editVal[i].splice(t,1);this.editVal[i].splice(t-1,0,s[0])}else this.$confirm("确定要删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){a.editVal[i].splice(t,1)})).catch((function(){}));else{if(n>r.a.MAX_LENGTH_ADD)return void this.$message({message:"最多添加"+r.a.MAX_LENGTH_ADD+"项！",type:"warning"});var c=Object(l.e)(this.copayEditVal[i][0]);this.editVal[i].push(c)}},importVariable:function(){var e=this;this.$confirm("导入页面变量会清空已有配置，你确定要导入吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var t=Object(r.ab)(e.pageInfo.page.attributes.customVariable);t?(e.editVal.payloads=[],e.handleImportVariable(t)):e.$message.warning("页面未定义自定义变量!")})).catch((function(){}))},handleImportVariable:function(e,t){for(var a in e){var i=e[a],n=t?t+"."+a:a;"object"===Object(l.g)(i)&&this.handleImportVariable(i,n);var r={name:n,value:"${"+n+"}",filter:"",editValue:{type:"variable",static:"",variable:this.getEditValueVariable(n)}};this.editVal.payloads.push(r)}},getEditValueVariable:function(e){if(!e)return[];var t=[];return e.split(".").forEach((function(e){t.push(e)})),t},open:function(){this.dialogVisible=!0},close:function(){this.dialogVisible=!1},cancel:function(){this.close()},clear:function(){var e=this;this.$confirm("确定要清空相关设置吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.showVal="",e.editVal=Object(l.e)(e.copayEditVal),e.$removeAttr(e.data,"value"),e.$removeAttr(e.data,"lastValue"),e.$removeAttr(e.data,"editValue"),e.clearFuncName(),e.close()})).catch((function(){}))},clearFuncName:function(){var e,t=(null==this||null===(e=this.parent)||void 0===e?void 0:e.attributes)||[],a=this.data,i=t.find((function(e){var t;return(null==e||null===(t=e.pageComponentName)||void 0===t?void 0:t.fid)===a.fid}));i&&(this.$removeAttr(i.pageComponentName,"value"),this.$removeAttr(i.pageComponentMethod,"value"),this.$removeAttr(i.pageComponentMethod,"optionsFid"),this.$removeAttr(i.executionTitle,"value"))},getShowVal:function(){return this.editVal.url?"api: "+this.editVal.url:""},clickSure:function(){var e=this.validate();!0!==e&&this.$message.warning(e),this.showVal=this.getShowVal(),!1===this.handleChangeResult(this.showVal,this.data)&&this.$setAttr(this.data,"lastValue",this.data.lastValue),this.$setAttr(this.data,"value",this.showVal),this.$setAttr(this.data,"lastValue",this.showVal),this.$setAttr(this.data,"editValue",this.getEditValue()),this.$emit("onSure",this.showVal,this.getEditValue(),this.data),this.dialogVisible=!1},getEditValue:function(){var e=Object(l.e)(this.editVal),t=e.payloads.filter((function(e){return e.name}));e.payloads=t;var a=e.callbacks.filter((function(e){return e.executionType.value&&e.executionContent.value}));e.callbacks=a;var i=e.errorCallbacks.filter((function(e){return e.executionType.value&&e.executionContent.value}));e.errorCallbacks=i;var n=e.beforeEvents.filter((function(e){return e.executionType.value&&e.executionContent.value}));return e.beforeEvents=n,e},validate:function(){if(!this.editVal.url)return"请输入请求地址";if(this.editVal.url.length>r.a.URL_MAX_LENGTH)return"请求地址长度不能超过"+r.a.URL_MAX_LENGTH;if(!this.editVal.method)return"请选择请求类型";if("multipart/form-data"===this.editVal.contentType&&"get"===this.editVal.method)return"内容格式为multipart/form-data时，请求类型不能为GET";if(!1===this.validateArr(this.editVal.payloads,"name","value"))return"请求参数配置不完整";if(this.editVal.payloads&&this.editVal.payloads.length){var e={},t="";if(this.editVal.payloads.forEach((function(a,i){var n=a.name,o=a.value;!t&&n&&e.hasOwnProperty(n)&&!0===e[n]?t="请求参数第"+(i+1)+"项，参数名不能重复":t||n||!o?!t&&n.length>r.a.PAYLOAD_NAME_MAX_LENGTH?t="请求参数第"+(i+1)+"项，参数名长度不能超过"+r.a.PAYLOAD_NAME_MAX_LENGTH:e[n]=!0:t="请求参数第"+(i+1)+"项，参数名不能为空"})),t)return t}return!0},validateArr:function(e){for(var t=arguments.length,a=new Array(t>1?t-1:0),i=1;i<t;i++)a[i-1]=arguments[i];if(!Array.isArray(e))return!0;if(a.length>1){var n=e.some((function(e){var t=null;return a.some((function(a){var i=!!e[a];if(0===e[a]&&(i=!i),null!==t)return t!==i;t=i}))}));return!n}return!0}}},f=(a("4f6f"),a("2877")),m=Object(f.a)(h,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"hc-attr-editor hc-attr-editor-api"},[e.showInput?t("el-input",{staticClass:"hc-attr-editor-input",attrs:{placeholder:e.placeholder,value:e.showVal,readonly:"",size:"mini",clearable:""},nativeOn:{click:function(t){return e.handleIconClick.apply(null,arguments)}}},[t("i",{staticClass:"el-input__icon hc-attr-editor-icon",class:e.iconClass,attrs:{slot:"suffix"},slot:"suffix"})]):e._e(),t("el-dialog",{staticClass:"hc-attr-editor-dialog hc-attr-editor-dialog-api",attrs:{draggable:!0,visible:e.dialogVisible,"close-on-click-modal":!1,title:e.title,width:"1100px",top:"auto","append-to-body":!0},on:{close:e.close}},[t("div",{staticClass:"hc-attr-editor-content"},[t("el-form",{staticClass:"event-editor-form",attrs:{"label-width":"110px"},model:{value:e.editVal,callback:function(t){e.editVal=t},expression:"editVal"}},[t("el-form-item",{attrs:{label:"请求地址"}},[t("el-input",{attrs:{size:"mini",placeholder:"请输入API地址",clearable:""},model:{value:e.editVal.url,callback:function(t){e.$set(e.editVal,"url",t)},expression:"editVal.url"}})],1),t("el-form-item",{attrs:{label:"请求类型"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{size:"mini",placeholder:"请选择"},model:{value:e.editVal.method,callback:function(t){e.$set(e.editVal,"method",t)},expression:"editVal.method"}},e._l(e.queryTypes,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"响应类型"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{size:"mini",placeholder:"请选择"},model:{value:e.editVal.responseType,callback:function(t){e.$set(e.editVal,"responseType",t)},expression:"editVal.responseType"}},e._l(e.responseTypes,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"内容格式"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{size:"mini",placeholder:"请选择"},model:{value:e.editVal.contentType,callback:function(t){e.$set(e.editVal,"contentType",t)},expression:"editVal.contentType"}},e._l(e.contentTypes,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",[t("div",{attrs:{slot:"label"},slot:"label"},[t("div",[e._v("请求参数")]),t("el-tooltip",{attrs:{content:"导入页面变量",placement:"top"}},[t("el-button",{staticStyle:{padding:"6px"},attrs:{size:"mini",icon:"el-icon-bottom-right",plain:""},on:{click:e.importVariable}})],1)],1),t("table",{directives:[{name:"theme",rawName:"v-theme",value:e.themeStyles,expression:"themeStyles"}],staticClass:"hc-editor-payload-table"},[t("thead",{staticClass:"hc-editor-payload-table-thead",style:e.theadStyles},[t("tr",[t("th",{attrs:{width:"30%"}},[e._v("参数名")]),t("th",[e._v("参数值")]),t("th",{attrs:{width:"20%"}},[e._v("过滤类型")]),t("th",{attrs:{width:"18%"}},[e._v("操作")])])]),t("tbody",{staticClass:"hc-editor-payload-table-tbody"},e._l(e.editVal.payloads,(function(a,i){return t("tr",{key:i},[t("td",[t("el-input",{attrs:{size:"mini",placeholder:"请输入参数名",clearable:""},model:{value:a.name,callback:function(t){e.$set(a,"name",t)},expression:"param.name"}})],1),t("td",[t("variable-editor-components",{attrs:{compoundItem:e.compoundItem,data:a,args:e.newArgs,contentType:e.editVal.contentType}})],1),t("td",[t("el-select",{attrs:{size:"mini",placeholder:"请选择"},model:{value:a.filter,callback:function(t){e.$set(a,"filter",t)},expression:"param.filter"}},e._l(e.filterTypes,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("td",{staticClass:"hc-payload-operation",attrs:{align:"center"}},[t("CommonTableMoveOprate",{attrs:{data:e.editVal.payloads,index:i,plain:!0,layout:"top,bottom,add,del,clear"},on:{click:e.handleEvents}})],1)])})),0)])]),t("el-form-item",[t("el-checkbox",{attrs:{size:"mini"},model:{value:e.editVal.isValidation,callback:function(t){e.$set(e.editVal,"isValidation",t)},expression:"editVal.isValidation"}},[e._v("页面输入校验")])],1),t("el-form-item",{attrs:{label:"请求前事件"}},[t("div",{attrs:{slot:"label"},slot:"label"},[t("div",[e._v("请求前事件")]),e._e(),e._e()],1),e.dialogVisible?t("callback-content",{attrs:{args:e.beforeEventsArgs},model:{value:e.editVal.beforeEvents,callback:function(t){e.$set(e.editVal,"beforeEvents",t)},expression:"editVal.beforeEvents"}}):e._e()],1),e.hasCallback?t("el-form-item",[t("div",{attrs:{slot:"label"},slot:"label"},[t("div",[e._v("成功响应事件")]),e._e(),e._e()],1),e.dialogVisible?t("callback-content",{attrs:{args:e.eventContentArgs},model:{value:e.editVal.callbacks,callback:function(t){e.$set(e.editVal,"callbacks",t)},expression:"editVal.callbacks"}}):e._e()],1):e._e(),e.hasCallback?t("el-form-item",[t("div",{attrs:{slot:"label"},slot:"label"},[t("div",[e._v("失败响应事件")]),e._e(),e._e()],1),e.dialogVisible?t("callback-content",{attrs:{args:e.errorEventContentArgs},model:{value:e.editVal.errorCallbacks,callback:function(t){e.$set(e.editVal,"errorCallbacks",t)},expression:"editVal.errorCallbacks"}}):e._e()],1):e._e(),t("el-form-item",{attrs:{label:"自定义错误响应"}},[t("table",{directives:[{name:"theme",rawName:"v-theme",value:e.themeStyles,expression:"themeStyles"}],staticClass:"hc-editor-payload-table"},[t("thead",{staticClass:"hc-editor-payload-table-thead",style:e.theadStyles},[t("tr",[t("th",{attrs:{width:"30%"}},[e._v("错误标识(errorId)")]),t("th",[e._v("提示信息")]),t("th",{attrs:{width:"18%"}},[e._v("操作")])])]),t("tbody",{staticClass:"hc-editor-payload-table-tbody"},e._l(e.editVal.errorValidator,(function(a,i){return t("tr",{key:i},[t("td",[t("el-input",{attrs:{size:"mini",placeholder:"请输入错误标识(errorId)",clearable:""},model:{value:a.errorId,callback:function(t){e.$set(a,"errorId",t)},expression:"param.errorId"}})],1),t("td",[t("el-input",{attrs:{size:"mini",placeholder:"请输入提示信息",clearable:""},model:{value:a.message,callback:function(t){e.$set(a,"message",t)},expression:"param.message"}})],1),t("td",{staticClass:"hc-payload-operation",attrs:{align:"center"}},[t("CommonTableMoveOprate",{attrs:{data:e.editVal.errorValidator,index:i,plain:!0,layout:"top,bottom,add,del,clear"},on:{click:e.handleErrorEvents}})],1)])})),0)])])],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"danger"},on:{click:e.clear}},[e._v("清 空")]),t("el-button",{on:{click:e.cancel}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.clickSure}},[e._v("确 定")])],1)])],1)}),[],!1,null,null,null);t.default=m.exports},ee40:function(e,t,a){},ee49:function(e,t,a){},f147:function(e,t,a){},f14d:function(e,t,a){"use strict";a("8b46")},f246:function(e,t,a){"use strict";a("6762"),a("2fdb"),a("7f7f");var i=(a("8e6e"),a("456d"),a("28a5"),a("ac6a"),a("bd86")),n=a("c276"),r=(a("96cf"),a("3b8d")),o=(a("5df3"),a("967e")),l=a.n(o);function s(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function c(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?s(Object(a),!0).forEach((function(t){Object(i.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):s(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var u={props:{type:{type:String,default:""},commonParams:{type:Object,default:function(){}},formData:{type:Object,default:function(){}},projectIdentifier:{type:String,default:""}},data:function(){return{dialogVisible:!0,form:{identifier:"",name:"",value:"",description:""},rules:{identifier:[{required:!0,message:"请输入标识",trigger:"blur"},{max:31,message:"长度最多31个字符",trigger:"blur"},{pattern:/^[0-9A-Z_-]{1,}$/,message:"只允许输入数字、大写字母、下划线和分隔符的组合",trigger:"blur"}],name:[{required:!0,message:"请输入名称",trigger:"blur"},{max:50,message:"长度最多50个字符",trigger:"blur"},{pattern:/^[a-zA-Z0-9_\u4e00-\u9fa5]+$/,message:"只允许输入汉字、字母、数字和下划线",trigger:"blur"}],value:[{max:50,message:"长度最多50个字符",trigger:"blur"}]}}},methods:{initData:function(){"add"===this.type?this.form={identifier:"",name:"",value:"",description:""}:this.form=c({},this.formData)},updateForm:function(e){var t=this,a="/api/model/instances/".concat(this.formData.id,"?projectIdentifier=").concat(this.projectIdentifier);this.$axiosRequest({url:a,method:"patch",params:e}).then((function(e){t.$message.success("操作成功"),t.$emit("onClose","list")})).catch((function(e){t.$message.error(e.message)}))},addForm:function(e){var t=this,a="/api/model/instances?projectIdentifier=".concat(this.projectIdentifier),i="input";""!=this.form.identifier&&null!=this.form.identifier||(i="DICTION:timestamp");var n=c(c({},e),{},{identifier:this.projectIdentifier+this.form.identifier,identifierRule:i,expand:"project"});this.$axiosRequest({url:a,method:"post",params:n}).then((function(e){t.$message.success("操作成功"),t.$emit("onClose","tree")})).catch((function(e){t.$message.error(e.message)}))},onSubmit:function(){var e=this;this.$refs.form.validate((function(t){if(!t)return!1;var a=c({identifier:e.form.identifier,name:e.form.name,value:e.form.value,description:e.form.description},e.commonParams);e.form.id?e.updateForm(a):e.addForm(a)}))},onClose:function(){this.$emit("onClose")}},mounted:function(){this.initData()}},d=(a("0552"),a("2877")),p=Object(d.a)(u,(function(){var e=this,t=e._self._c;return t("div",{},[t("el-drawer",{staticClass:"assets-project-form",attrs:{size:"576px",visible:e.dialogVisible,wrapperClosable:!1,"append-to-body":!0},on:{"update:visible":function(t){e.dialogVisible=t},close:e.onClose}},[t("el-form",{ref:"form",attrs:{model:e.form,size:"small",rules:e.rules,"label-width":"120px","label-position":"top"}},["add"!=e.type?t("el-form-item",{attrs:{label:"标识",prop:"identifier"}},[t("el-input",{attrs:{disabled:""},model:{value:e.form.identifier,callback:function(t){e.$set(e.form,"identifier","string"==typeof t?t.trim():t)},expression:"form.identifier"}})],1):e._e(),"add"==e.type?t("el-form-item",{attrs:{label:"标识",prop:"identifier"}},[t("el-input",{attrs:{disabled:"edit"==e.type},model:{value:e.form.identifier,callback:function(t){e.$set(e.form,"identifier","string"==typeof t?t.trim():t)},expression:"form.identifier"}},[t("template",{slot:"prepend"},[e._v(e._s(e.projectIdentifier))])],2)],1):e._e(),t("el-form-item",{attrs:{label:"名称",prop:"name"}},[t("el-input",{attrs:{placeholder:"请输入名称"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name","string"==typeof t?t.trim():t)},expression:"form.name"}})],1),t("el-form-item",{attrs:{label:"字典值",prop:"value"}},[t("el-input",{attrs:{placeholder:"请输入字典值"},model:{value:e.form.value,callback:function(t){e.$set(e.form,"value","string"==typeof t?t.trim():t)},expression:"form.value"}})],1),t("el-form-item",{attrs:{label:"备注说明"}},[t("el-input",{attrs:{type:"textarea",maxlength:"255",autosize:{minRows:2,maxRows:3},placeholder:"请输入"},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1)],1),t("section",{staticClass:"drawer-footer"},[t("el-button",{on:{click:e.onClose}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("确 定")])],1)],1)],1)}),[],!1,null,null,null).exports,h=a("b19c");function f(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function m(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?f(Object(a),!0).forEach((function(t){Object(i.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):f(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var v={components:{assetsForm:p},data:function(){return{defaultProps:{children:"children",label:"label"},treeData:[],filterText:"",currentNodekey:"",updateStore:!1,loading:!1,visible:!0,isShowForm:!1,projectIdentifier:"",type:"add",formData:{},tableData:[],parentId:"",indicatorId:"",objectType:"COM_CODEDICTIONARY",commonParams:{},params:{searchName:"",identifier:"",contactName:"",customerManagerId:"",employeeId:"",organizationIds:[],labelIds:[]},page:{size:10,sizes:[10,20,30,40,50,100],current:1,total:0}}},watch:{filterText:function(e){this.$refs.tree.filter(e)}},methods:{filterNode:function(e,t){return!e||-1!==t.label.indexOf(e)},handleNodeClick:function(e){this.parentId!==e.id?(this.parentId=e.id,this.searchReset()):(this.parentId=e.id,this.initData())},handleClose:function(){var e=this;this.updateStore?this.$store.dispatch("initDictOptions",{forceUpdate:function(){e.closeEvent(!0)}}):this.closeEvent(!1)},closeEvent:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;this.$emit("close","boolean"==typeof e&&e,t)},searchChange:function(){this.page.current=1,this.initData()},searchReset:function(){this.params.identifier="",this.params.searchName="",this.page.current=1,this.initData()},handleSizeChange:function(e){this.page.current=1,this.page.size=e,this.initData()},handleCurrentChange:function(e){this.page.current=e,this.initData()},count:function(e){return(this.page.current-1)*this.page.size+e+1},listToTree:function(e,t,a,i,n){i=i||"children";var r=[],o={};return e&&e.length>0&&(e.forEach((function(e){o[e[t]]=e})),e.forEach((function(e){var t=m(m({},e),{},{label:e.name}),l=o[e[a]];if(!l)return null!=n&&""!==n?String(e[a])===String(n)?void r.push(t):void 0:void r.push(t);l[i]||(l[i]=[]),l[i].push(t)}))),r},getTreeData:function(){var e=this,t=this,a=this.projectIdentifier;Promise.all([function(){var i="".concat(a,"::COMMON");return e.$axiosRequest({url:"/api/model/instances?objectType=".concat(t.objectType,"&pagination=0&queryMode=simple&lazyLoad=0&projectIdentifier=").concat(i,"&$filter=pathName leftlike /IOT/INDICATOR_EXPAND&$orderBy=createTime desc"),method:"get"})}()]).then((function(a){var i;i=a[0]||[],t.indicatorId?(t.treeData=e.listToTree(i,"id","parentId","children",t.indicatorId),t.$nextTick((function(){var a=t.parentId;if(a)e.$refs.tree.setCurrentKey(a),t.initData();else{var i=t.treeData[0].id||"-1";e.$refs.tree.setCurrentKey(i),e.parentId=i,t.initData()}}))):t.treeData=[]}))},initData:function(){var e=this,t={objectType:"COM_CODEDICTIONARY",queryMode:"simple",projectIdentifier:"".concat(this.projectIdentifier,"::COMMON"),parentId:this.parentId},a=this.page.current,i=this.page.size,n=this.params.identifier,r=this.params.searchName,o={url:"/api/model/instances?$filter=identifier like ".concat(n,",name like ").concat(r,"&$page=").concat(a,"&$pageSize=").concat(i),method:"get",params:t};this.loading=!0,this.$axiosRequest(o).then((function(t){e.tableData=t.result||[],e.page.total=t.pageInfo.total||0,e.loading=!1})).catch((function(t){e.loading=!1,e.$message.error(t.message)}))},getIndicatorId:function(){var e=this;return new Promise((function(t,a){e.$axiosRequest({url:"/api/model/instances?objectType=".concat(e.objectType,"&queryMode=simple&pagination=0&$filter=name eq 指标量"),method:"get"}).then((function(a){e.indicatorId=a[0].parentId||"",t()}))}))},openDrawer:function(e,t){this.type=e,this.formData="add"===e?{}:t,this.commonParams={parentId:this.parentId,objectType:this.objectType},this.isShowForm=!0},onClose:function(e){this.isShowForm=!1,e&&(this.updateStore=!0,"list"===e?this.initData():this.getTreeData())},getProjectIdentifier:function(){this.projectIdentifier=Object(h.h)(window.location.href,"projectIdentifier")},handleDelete:function(e){var t=this;this.$confirm("删除后数据将无法恢复，若是系统内部使用到的字典数据，则会导致部分功能无法正常使用","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var a={url:"/api/model/instances/delete?projectIdentifier=".concat(t.projectIdentifier),method:"post",params:{id:e.id}};t.$axiosRequest(a).then((function(e){t.$message.success("操作成功"),t.page.current=1,t.updateStore=!0,t.parentId="",t.getTreeData()})).catch((function(e){t.$message.error(e.message)}))})).catch((function(){return!1}))}},mounted:function(){var e=this;return Object(r.a)(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.getProjectIdentifier(),t.next=3,e.getIndicatorId();case 3:e.getTreeData();case 4:case"end":return t.stop()}}),t)})))()}},b=(a("c9a8"),Object(d.a)(v,(function(){var e=this,t=e._self._c;return t("div",{},[t("el-dialog",{attrs:{title:"编辑指标扩展维度",visible:e.visible,width:"1200px","modal-append-to-body":"","append-to-body":"","destroy-on-close":!0,"custom-class":"assets-project-dialog"},on:{"update:visible":function(t){e.visible=t},closed:e.handleClose}},[t("div",{staticClass:"assets-project-dialog-content"},[t("div",{staticClass:"content_left"},[t("div",{staticClass:"content_left_search"},[t("el-input",{attrs:{size:"small",placeholder:"请输入组织搜索",clearable:""},model:{value:e.filterText,callback:function(t){e.filterText="string"==typeof t?t.trim():t},expression:"filterText"}},[t("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"suffix"},slot:"suffix"})])],1),t("div",{staticClass:"content_left_tree"},[t("el-tree",{ref:"tree",attrs:{data:e.treeData,props:e.defaultProps,"node-key":"id","default-expand-all":"","expand-on-click-node":!1,"highlight-current":!0,"current-node-key":e.currentNodekey,"filter-node-method":e.filterNode},on:{"node-click":e.handleNodeClick}})],1)]),t("div",{staticClass:"content_right"},[t("div",{staticClass:"search"},[t("div",{staticClass:"search_left"},[t("div",{staticClass:"hui_input"},[t("span",{staticClass:"label"},[e._v("标识")]),t("el-input",{attrs:{clearable:"",placeholder:"请输入"},on:{clear:e.searchChange},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.searchChange.apply(null,arguments)}},model:{value:e.params.identifier,callback:function(t){e.$set(e.params,"identifier","string"==typeof t?t.trim():t)},expression:"params.identifier"}})],1),t("div",{staticClass:"hui_input"},[t("span",{staticClass:"label"},[e._v("名称")]),t("el-input",{attrs:{clearable:"",placeholder:"请输入"},on:{clear:e.searchChange},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.searchChange.apply(null,arguments)}},model:{value:e.params.searchName,callback:function(t){e.$set(e.params,"searchName","string"==typeof t?t.trim():t)},expression:"params.searchName"}})],1)]),t("div",{staticClass:"search_right"},[t("el-button",{attrs:{title:"搜索",type:"primary"},on:{click:e.searchChange}},[e._v("查询")]),t("el-button",{attrs:{title:"重置"},on:{click:e.searchReset}},[e._v("重置")])],1)]),t("div",{staticClass:"add_button"},[t("el-button",{attrs:{title:"新增",type:"primary",icon:"el-icon-plus"},on:{click:function(t){return e.openDrawer("add")}}},[e._v("新增")])],1),t("div",{staticClass:"hc_table"},[t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",staticStyle:{width:"100%"},attrs:{data:e.tableData,align:"center","row-key":e.getRowKeys,"header-cell-style":{background:"#F4F5F7FF"}},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{type:"index",label:"序号",align:"center",index:e.count,width:"60"}}),t("el-table-column",{attrs:{prop:"identifier",label:"标识",width:"150","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"name",label:"名称",width:"150","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"value",label:"字典值",width:"150","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"projectIdentifier",label:"工程标识",width:"150","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"updateUser",label:"修订人","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"updateTime",label:"修订时间","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"操作",align:"center",width:"100"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"text",size:"mini",disabled:a.row.projectIdentifier!==e.projectIdentifier},on:{click:function(t){return e.openDrawer("edit",a.row)}}},[e._v("编辑")]),t("el-button",{attrs:{type:"text",size:"mini",disabled:a.row.projectIdentifier!==e.projectIdentifier},on:{click:function(t){return e.handleDelete(a.row)}}},[e._v("删除")])]}}])})],1)],1),t("div",{staticClass:"hc_pagination"},[t("el-pagination",{attrs:{"current-page":e.page.current,"page-sizes":e.page.sizes,"page-size":e.page.size,layout:"total, sizes, prev, pager, next, jumper",total:e.page.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)])])]),e.isShowForm?t("assetsForm",{attrs:{type:e.type,projectIdentifier:e.projectIdentifier,formData:e.formData,commonParams:e.commonParams},on:{onClose:e.onClose}}):e._e()],1)}),[],!1,null,null,null)).exports,g=a("2f62");function y(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function _(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?y(Object(a),!0).forEach((function(t){Object(i.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):y(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var C={name:"AssetsIndicatorTable",components:{IndicatorList:b},props:{list:{type:Array,default:function(){return[]}},updateList:{type:Function,default:function(){}}},inject:["isProjectPage","isTemplatePage"],data:function(){return{desc:[],options:[],indicatorProps:{label:"name",children:"children"},rules:[],extraObjectTypes:[],dynamicMap:{},rootNode:{id:"-1",label:"/",name:"/"},compoundItem:[{label:"变量选择",value:"variable",formItem:"variable-Panel"},{label:"手动输入",value:"static",formItem:"select"}],compoundItemTreeselect:[{label:"变量选择",value:"variable",formItem:"variable-Panel"},{label:"手动输入",value:"static",formItem:"treeselect"}],measIndicatorDefineVisible:!1,currentIndicator:{}}},computed:_(_({},Object(g.a)(["measureOptions","themeConstColor"])),{},{theadStyles:function(){return{"background-color":Object(n.nb)("middleBackgroundColor")}},fetchOption:function(){var e=this.extraObjectTypes.filter((function(e){return e.checked})).map((function(e){return e.name})).join(",");return{url:"/api/model/instances",params:{objectType:"HR_COMPANY,HR_DEPARTMENT,SYS_ASSET,SYS_EQUIPMENT".concat(e?",".concat(e):""),queryMode:"simple",pagination:0,lazyLoad:0,$orderBy:"createTime desc"}}}}),watch:{list:{immediate:!0,handler:function(e){this.initDynamicMap()}}},methods:{collapseStyle:function(e){return{target:".el-collapse-item__wrap",style:this.trStyle(e)}},trStyle:function(e){var t=e.id;return{backgroundColor:this.desc.includes(t)?this.themeConstColor.headerColor:"",transition:"all .3s"}},handleSelectedChange:function(e,t){var a=t.id;this.handleCollapse(null==t?void 0:t.id,!0),e.length?this.desc.includes(a)||this.desc.push(a):this.desc.includes(a)&&(this.desc=this.desc.filter((function(e){return e!==a})))},onMeasIndicatorDefineClose:function(e){this.measIndicatorDefineVisible=!1,e&&"function"==typeof this.updateList&&this.updateList()},handleIndicatorSetting:function(e){this.currentIndicator=e.rowInfo,this.measIndicatorDefineVisible=!0},initDynamicMap:function(){var e=this;this.list.forEach((function(t){var a=e.changeIndicator(t.rowInfo);e.$set(e.dynamicMap,null==t?void 0:t.id,a)}))},handleIndicatorDel:function(e){var t=this;this.$confirm("确定要删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){1===t.list.length?t.list.splice(e,1,{id:t.$util.uuid(),rowInfo:{},isDynamic:!1,selected:[]}):t.list.splice(e,1),t.$emit("indicatorChange")})).catch((function(){}))},handleDynamicDel:function(){},changeVariable:function(e,t,a){this.list[a].rowInfo[t]=e},getEditValue:function(e){var t,a=/\$\{(.*?)\}/g.exec(e);return(null==a?void 0:a[0])===e?{static:"",type:"variable",variable:null===(t=a[1])||void 0===t?void 0:t.split(".")}:{static:e,type:"static",variable:[]}},changeIndicator:function(e){var t=this;return(this.isProjectPage||this.isTemplatePage?this.measureOptions.measureIndicatorDictOptions:this.measureOptions.measureIndicatorExpandsDicts).map((function(a){return{name:a.displayName,display:a.dictKeyName,options:a.options.map((function(e){return{label:e.name,value:e.value}})),type:"select",selected:!0,paramType:"dynamic",value:e[a.displayName],dataValue:{editValue:t.getEditValue(e[a.displayName]||"")}}}))},indicatorChange:function(){this.$emit("indicatorChange")},handleIndicatorChange:function(e,t){var a;this.list[t].rowInfo=e;var i=this.changeIndicator(null!=e?e:{});this.$set(this.dynamicMap,null===(a=this.list[t])||void 0===a?void 0:a.id,i),this.$emit("indicatorChange")},collapseIcon:function(e){return this.desc.includes(e)?"el-icon-arrow-up":"el-icon-arrow-down"},handleCollapse:function(e,t){if(this.desc.includes(e)){if(t)return;this.desc=this.desc.filter((function(t){return t!==e}))}else this.desc.push(e)}}},O=(a("58de"),a("a5bf"),Object(d.a)(C,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"assets-indicator-table-box"},[t("table",{staticClass:"assets-indicator-table"},[t("thead",{staticClass:"table-thead",style:e.theadStyles},[e._m(0)]),t("tbody",{staticClass:"table-tbody"},[e._l(e.list,(function(a,i){return[t("tr",{key:i,staticClass:"table-tr",style:e.trStyle(a)},[t("td",[t("span",[e._v(e._s(a.name))])]),t("td",[t("el-switch",{model:{value:a.isDynamic,callback:function(t){e.$set(a,"isDynamic",t)},expression:"item.isDynamic"}})],1),t("td",[t("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",placeholder:"请选择",disabled:!a.isDynamic},on:{change:function(t){return e.handleSelectedChange(t,a)}},model:{value:a.selected,callback:function(t){e.$set(a,"selected",t)},expression:"item.selected"}},e._l(e.dynamicMap[a.id]||[],(function(e){return t("el-option",{key:e.name,attrs:{label:e.display,value:e.name}})})),1)],1),t("td",[t("el-button",{staticClass:"indicator-btn",attrs:{type:"text"},on:{click:function(t){return e.handleIndicatorSetting(a)}}},[e._v("\n              配置\n            ")]),t("el-button",{staticClass:"indicator-btn",staticStyle:{"margin-left":"5px !important"},attrs:{type:"text",disabled:e.list.length<=1},on:{click:function(t){return e.handleIndicatorDel(i)}}},[e._v("\n              删除\n            ")]),t("el-button",{staticClass:"indicator-btn indicator-opt",staticStyle:{"margin-left":"5px !important"},attrs:{icon:e.collapseIcon(a.id),type:"text"},on:{click:function(t){return t.stopPropagation(),function(){return e.handleCollapse(a.id)}.apply(null,arguments)}}})],1)]),t("tr",{key:"".concat(a.id,"_desc"),style:e.trStyle(a)},[t("td",{attrs:{colspan:"4"}},[t("el-collapse",{staticClass:"desc-collapse",attrs:{value:e.desc}},[t("el-collapse-item",{directives:[{name:"theme",rawName:"v-theme",value:e.collapseStyle(a),expression:"collapseStyle(item)"}],attrs:{name:a.id}},[a.selected.length?t("el-form",{ref:"form",refInFor:!0,attrs:{"label-width":"120px",model:a.selected}},e._l(e.dynamicMap[a.id]||[],(function(n){return t("el-form-item",{directives:[{name:"show",rawName:"v-show",value:a.selected.includes(n.name),expression:"item.selected.includes(dynamic.name)"}],key:n.name,attrs:{label:n.display}},[t("variable-editor-components",{staticClass:"filters-item-input",attrs:{compoundItem:"treeselect"===n.type?e.compoundItemTreeselect:e.compoundItem,options:n.options,title:"设置参数值",placeholder:"请设置参数值",data:n.dataValue,disabled:!a.isDynamic},on:{change:function(t){return e.changeVariable(t,n.name,i)}}})],1)})),1):t("div",{staticClass:"desc-collapse-empty t-text-secondary"},[e._v("暂无动态维度")])],1)],1)],1)])]}))],2)]),e.measIndicatorDefineVisible?t("IndicatorList",{attrs:{updateStore:""},on:{close:e.onMeasIndicatorDefineClose}}):e._e()],1)}),[function(){var e=this,t=e._self._c;return t("tr",[t("th",{attrs:{width:"25%"}},[e._v("指标")]),t("th",{attrs:{width:"15%"}},[e._v("动态指标")]),t("th",[e._v("动态维度")]),t("th",{attrs:{width:"18%"}},[e._v("操作")])])}],!1,null,"e92168bc",null));t.a=O.exports},f4ce:function(e,t,a){},f5a6:function(e,t,a){"use strict";a("f911")},f5a7:function(e,t,a){},f5be:function(e,t,a){},f5cd:function(e){e.exports=JSON.parse('[{"name":"general","alias":"通用","sort":100,"attributes":[{"name":"componentType","alias":"组件类型","type":"String","readonly":true,"default":"","sort":1001,"linkable":false},{"name":"componentName","alias":"组件名称","type":"String","default":"","sort":1002,"maxlength":50,"required":true,"linkable":false}]},{"name":"appearance","alias":"外观","sort":200,"attributes":[{"name":"font-size","alias":"字体大小","type":"Number","precision":0,"min":8,"default":14,"sort":2001},{"name":"color","alias":"字体颜色","type":"String","editor":"color","sort":2002},{"name":"font-weight","alias":"字体粗细","type":"Enum(\\"normal:正常\\", \\"bold:加粗\\")","default":"normal","sort":2003},{"name":"font-style","alias":"字体风格","type":"Enum(\\"normal:正常\\", \\"italic:斜体\\")","default":"normal","sort":2004},{"name":"line-height","alias":"字体行高","type":"Number","default":24,"min":0,"precision":0,"sort":2005},{"name":"text-align","alias":"水平对齐","type":"Enum(\\"left:居左\\", \\"center:居中\\", \\"right:居右\\")","default":"left","sort":2006},{"name":"letter-spacing","alias":"文字间距","type":"Number","default":"","precision":0,"sort":2007},{"name":"text-decoration","alias":"文本修饰","type":"Enum(\\"none:无\\", \\"underline:下划线\\", \\"overline:上划线\\", \\"line-through:中划线\\")","default":"none","sort":2008},{"name":"background-color","alias":"背景颜色","type":"String","default":"","editor":"color","sort":2009},{"name":"background-image","alias":"背景图片","type":"String","default":"","editor":"file","editorParams":{"type":"picture","title":"选择图片"},"sort":2010},{"name":"background-repeat","alias":"背景图像平铺","type":"Enum(\\"no-repeat:不平铺\\", \\"repeat-x:水平平铺\\", \\"repeat-y:垂直平铺\\", \\"repeat:平铺\\")","default":"no-repeat","sort":2011},{"name":"background-size","alias":"背景图片尺寸","type":"String","default":"100%","sort":2012,"tips":"允许六种类型值：1、缩小图片适应元素尺寸:contain；2、扩展图片填满元素:cover；3、指定大小数值+px:100px 100px；4、指定大小百分比:50% 50%；5、3和4的混合:100px 100%；6、空字符","rules":[{"require":false},{"pattern":"/^((__quote:percentage__)(((\\\\s(__quote:percentage__))?)|((\\\\s([1-9]?[0-9]{0,3}px))?))|([1-9]?[0-9]{0,3}px)(((\\\\s([1-9]?[0-9]{0,3}px))?)|((\\\\s(__quote:percentage__))?))|(contain)|(cover))$/","message":"请输入contain、cover、百分比、数字+px、空字符中的一种"}]},{"name":"background-position","alias":"背景图片定位","type":"Enum(\\"left top:左上角\\", \\"center top:顶部居中\\", \\"right top:右上角\\", \\"center center:居中\\", \\"left bottom:左下角\\", \\"center bottom:底部居中\\", \\"right bottom:右下角\\")","default":"left top","sort":2013}]},{"name":"labelConfig","alias":"标签属性","sort":220,"attributes":[{"name":"enableLabel","alias":"开启","type":"Boolean","default":true,"visible":false,"sort":2201},{"name":"labelContent","alias":"标签文本","type":"String","linkable":true,"default":"标签名称","visible":false,"minlength":0,"maxlength":50,"sort":2202},{"name":"labelWidth","alias":"标签宽度","type":"Number","min":0,"max":9999,"default":80,"visible":false,"sort":2203},{"name":"labelPosition","alias":"标签文本对齐方式","type":"Enum(\\"left:左对齐\\",\\"right:右对齐\\",\\"top:顶部对齐\\")","default":"right","visible":false,"sort":2204},{"name":"labelRequired","alias":"必填","type":"Boolean","linkable":true,"default":false,"visible":false,"tips":"是否必填，如不设置，则会根据校验规则自动生成。此配置仅用来决定红色星号是否显示，不做必填校验。","sort":2205},{"name":"labelNoWrap","alias":"超出宽度换行","type":"Boolean","default":false,"visible":false,"tips":"默认当字符数大于标签宽度时，不会自动换行，系统将字符进行截取处理。如果开启本配置，会自动换行","sort":2206},{"name":"hideRequiredAsterisk","alias":"隐藏红色星号","type":"Boolean","default":false,"visible":false,"tips":"是否隐藏必填字段的标签旁边的红色星号","sort":2207},{"name":"labelSuffixIcon","alias":"后缀图标","type":"String","editor":"icon","default":"","visible":false,"sort":2208},{"name":"suffixIconColor","alias":"后缀图标颜色","type":"String","editor":"color","default":"","visible":false,"sort":2209},{"name":"suffixIconTooltip","alias":"后缀图标提示信息","type":"String","default":"","editor":"code","editorParams":{"language":"html"},"visible":false,"tips":"配置提示信息","sort":2210},{"name":"suffixIconEffect","alias":"后缀图标提示信息背景颜色","type":"Enum(\\"light:浅色\\",\\"dark:深色\\")","default":"dark","visible":false,"sort":2211}]},{"name":"chartConfig","alias":"图表属性","sort":230,"attributes":[{"name":"enableRender","alias":"默认渲染","type":"Boolean","default":true,"visible":false,"sort":2301}]},{"name":"layout","alias":"布局","sort":300,"attributes":[{"name":"visibility","alias":"可见类型","type":"Enum(\\"inherit:可见\\", \\"hidden:不可见\\", \\"none:隐藏\\")","tips":"当类型为隐藏时，该组件将不占用位置","default":"inherit","sort":3001},{"name":"display","alias":"是否可见","type":"Boolean","default":true,"visible":false,"sort":3001},{"name":"lg","alias":"栅格数量","type":"Number","default":8,"min":1,"max":24,"precision":0,"tips":"屏幕分辨率中，宽度≥1200px 响应式栅格数，栅格布局将一行分为24列，栅格数量则为栅格占据的列数","sort":3001},{"name":"span","alias":"栅格数量md","type":"Number","default":8,"min":1,"max":24,"precision":0,"tips":"屏幕分辨率中，992px≤宽度<1200px 响应式栅格数，栅格布局将一行分为24列，栅格数量则为栅格占据的列数","sort":3002},{"name":"sm","alias":"栅格数量sm","type":"Number","default":24,"min":1,"max":24,"precision":0,"tips":"屏幕分辨率中，768px≤宽度<992px 响应式栅格数，栅格布局将一行分为24列，栅格数量则为栅格占据的列数","sort":3003},{"name":"xs","alias":"栅格数量xs","type":"Number","default":24,"min":1,"max":24,"precision":0,"tips":"屏幕分辨率中,宽度<768px 响应式栅格数，栅格布局将一行分为24列，栅格数量则为栅格占据的列数","sort":3004},{"name":"offset","alias":"栅格偏移量","type":"Number","default":0,"min":0,"max":23,"sort":3005,"visible":false},{"name":"float","alias":"浮动","type":"Enum(\\"none:无\\", \\"left:向左浮动\\", \\"right:向右浮动\\")","default":"left","visible":false,"sort":3100},{"name":"width","alias":"宽度","type":"String","default":"auto","visible":false,"tips":"允许四种值：1.自动:auto；2.数字+px:300px；3.百分比:50%；4.表达式:calc(100% - 140px)","sort":3200,"rules":[{"pattern":"/^(__quote:percentage__|([1-9]?[0-9]{0,3}px)|(auto)|(calc\\\\(.*\\\\)))$/","message":"请输入auto、百分比、数字+px、表达式中的一种"}]},{"name":"heightFilled","alias":"高度充满页面","type":"Boolean","default":false,"sort":3201,"visible":false,"changeHandler":"basicChangeHandler"},{"name":"offsetTop","alias":"距离顶部高度","type":"Number","min":0,"default":0,"sort":3202,"visible":false,"customGroupName":"filledHeight"},{"name":"height","alias":"高度","type":"String","default":"auto","tips":"允许四种值：1.自动:auto；2.数字+px:300px；3.百分比:50%；4.表达式:calc(100% - 140px)","sort":3203,"customGroupName":"filledHeight","rules":[{"pattern":"/^(__quote:percentage__|([1-9]?[0-9]{0,3}px)|(auto)|(calc\\\\(.*\\\\)))$/","message":"请输入auto、百分比、数字+px、表达式中的一种"}]},{"name":"min-width","alias":"最小宽度","type":"Number","default":300,"visible":false,"sort":3204},{"name":"min-height","alias":"最小高度","type":"Number","default":300,"visible":false,"sort":3205},{"name":"position","alias":"定位类型","type":"Enum(\\"none:无\\", \\"relative:相对定位\\", \\"absolute:绝对定位\\", \\"fixed:固定定位\\")","changeHandler":"basicChangeHandler","visible":false,"default":"none","sort":3300},{"name":"z-index","alias":"层级","type":"Number","default":10,"visible":false,"customGroupName":"position","sort":3301},{"name":"left","alias":"左偏移量","type":"String","default":"","visible":false,"customGroupName":"position","sort":3302,"tips":"允许的两种格式：数字+px、百分比、0，支持负数","rules":[{"pattern":"/^$|^0$|^((-?(__quote:percentage__))|(-?[1-9]?[0-9]{0,3}px))$/","message":"请输入数字+px、百分比或0，支持负数"}]},{"name":"right","alias":"右偏移量","type":"String","default":"","visible":false,"customGroupName":"position","sort":3303,"tips":"允许的两种格式：数字+px、百分比、0，支持负数","rules":[{"pattern":"/^$|^0$|^((-?(__quote:percentage__))|(-?[1-9]?[0-9]{0,3}px))$/","message":"请输入数字+px、百分比或0，支持负数"}]},{"name":"top","alias":"上偏移量","type":"String","default":"","visible":false,"customGroupName":"position","sort":3304,"tips":"允许的两种格式：数字+px、百分比、0，支持负数","rules":[{"pattern":"/^$|^0$|^((-?(__quote:percentage__))|(-?[1-9]?[0-9]{0,3}px))$/","message":"请输入数字+px、百分比或0，支持负数"}]},{"name":"bottom","alias":"下偏移量","type":"String","default":"","visible":false,"customGroupName":"position","sort":3305,"tips":"允许的两种格式：数字+px、百分比、0，支持负数","rules":[{"pattern":"/^$|^0$|^((-?(__quote:percentage__))|(-?[1-9]?[0-9]{0,3}px))$/","message":"请输入数字+px、百分比或0，支持负数"}]},{"name":"margin","alias":"外边距","type":"Number[4]","default":[0,0,0,0],"min":-9999,"max":9999,"precision":0,"primitiveLabels":["上","右","下","左"],"sort":3400,"customGroupName":"margin"},{"name":"padding","alias":"内边距","type":"Number[4]","default":[0,0,0,0],"min":0,"max":9999,"precision":0,"primitiveLabels":["上","右","下","左"],"sort":3401,"customGroupName":"padding"},{"name":"borderVisible","alias":"边框显示","type":"Boolean","default":false,"sort":3500,"changeHandler":"basicChangeHandler"},{"name":"border-color","alias":"边框颜色","type":"String[4]","editor":"color","primitiveLabels":["上","右","下","左"],"customGroupName":"borderVisibleRelated","sort":3501,"visible":false},{"name":"border-style","alias":"边框样式","type":"Enum(\\"none:无\\", \\"solid:实线\\", \\"dashed:虚线\\", \\"dotted:点状\\", \\"double:双线\\")[4]","primitiveLabels":["上","右","下","左"],"customGroupName":"borderVisibleRelated","sort":3502,"visible":false},{"name":"blockPadding","alias":"内边距","type":"Number[4]","min":0,"max":9999,"precision":0,"primitiveLabels":["上","右","下","左"],"sort":3503,"customGroupName":"borderVisibleRelated","visible":false},{"name":"isBorderRadius","alias":"边框圆角","type":"Boolean","default":false,"sort":3504,"changeHandler":"basicChangeHandler","visible":false},{"name":"border-radius","alias":"边框圆角大小","type":"Number[4]","min":0,"precision":0,"customGroupName":"borderRadiusRelated","primitiveLabels":["左上角","右上角","右下角","左下角"],"visible":false,"sort":3505},{"name":"box-shadow","alias":"边框阴影","type":"Boolean","default":false,"sort":3506,"visible":false},{"name":"contentGutter","alias":"内容间隔","type":"Number","default":10,"min":0,"max":100,"sort":3507,"visible":false},{"name":"blockTitle","alias":"标题","type":"String","default":"","sort":3600,"visible":false,"maxlength":50},{"name":"blockTitleFontSize","alias":"标题字体大小","type":"Number","precision":0,"min":8,"max":100,"default":16,"sort":3601,"visible":false},{"name":"blockTitleColor","alias":"标题颜色","type":"String","default":"","editor":"color","sort":3602,"visible":false},{"name":"blockTitleMargin","alias":"标题外边距","type":"Number[4]","default":[0,0,0,0],"precision":0,"primitiveLabels":["上","右","下","左"],"sort":3603,"visible":false},{"name":"blockTitlePadding","alias":"标题内边距","type":"Number[4]","default":[0,5,0,5],"min":0,"precision":0,"primitiveLabels":["上","右","下","左"],"sort":3604,"visible":false},{"name":"blockTitleHeight","alias":"标题高度","type":"String","default":"40px","tips":"允许三种值：1.自动:auto；2.数字+px:40px；3.百分比:50%(只在自由布局时生效)","sort":3605,"customGroupName":"filledHeight","rules":[{"pattern":"/^(__quote:percentage__|([1-9]?[0-9]{0,3}px)|(auto)|(calc\\\\(.*\\\\)))$/","message":"请输入auto、百分比、数字+px中的一种"}],"visible":false},{"name":"blockTitleIcon","alias":"标题前缀图标","type":"String","editor":"icon","default":"","sort":3606,"visible":false},{"name":"blockToolbarShowType","alias":"工具栏显示方式","type":"Enum(\\"none:不显示\\", \\"grid:网格\\", \\"list:列表\\")","default":"none","changeHandler":"basicChangeHandler","sort":3607,"visible":false},{"name":"blockToolbar","alias":"工具栏功能设置","type":"Complex[*]","sort":3608,"visible":false,"inputVisible":false,"customGroupName":"blockToolbar","attributes":[{"name":"blockToolbarName","alias":"功能名称","type":"String","maxlength":50,"titleVisible":true},{"name":"blockToolbarContent","alias":"事件执行内容","type":"Complex[*]","inputVisible":false,"attributes":"smartAttrs.eventContent"}]}]},{"name":"foreach","alias":"循环","sort":700,"attributes":[{"name":"foreachData","alias":"循环数据","type":"Complex[*]","editor":"code","sort":7001},{"name":"foreachItemAttr","alias":"迭代属性","type":"String[*]","linkable":false,"tips":"设置了循环项属性可方便的作为变量使用","sort":7002},{"name":"foreachItemName","alias":"迭代变量名","type":"String","default":"item","visible":false,"sort":7003}]},{"name":"events","alias":"事件","sort":800,"attributes":[]},{"name":"methods","alias":"方法","sort":900,"attributes":[{"name":"show","alias":"显示组件","type":"Complex","readonly":true,"sort":9001,"attributes":[{"name":"functionName","alias":"方法名称","type":"String","default":"show"},{"name":"description","alias":"方法描述","type":"String","default":"显示组件"}]},{"name":"hide","alias":"隐藏组件","type":"Complex","readonly":true,"sort":9002,"attributes":[{"name":"functionName","alias":"方法名称","type":"String","default":"hide"},{"name":"description","alias":"方法描述","type":"String","default":"隐藏组件"},{"name":"payload","alias":"参数","type":"Complex[1]","inputVisible":false,"attributes":"smartAttrs.payload","default":[{"name":"placeholder","alias":"是否占位","type":"Boolean","default":false}]}]}]}]')},f75b:function(e,t,a){},f85b:function(e,t,a){"use strict";a("7e77")},f877:function(e,t,a){"use strict";a("3909")},f903:function(e,t,a){"use strict";a("df4b")},f911:function(e,t,a){},f96a:function(e,t,a){"use strict";a("33a0")},fb42:function(e,t,a){"use strict";a("ff5b")},fcc0:function(e,t,a){"use strict";a.r(t);var i=(a("8e6e"),a("75fc")),n=(a("456d"),a("7f7f"),a("ac6a"),a("28a5"),a("bd86")),r=(a("c5f6"),a("36f0")),o=a("b19c");function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){Object(n.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}a("7514");var c={name:"SelectIndicatorId",props:{dialogVisible:{type:Boolean,default:function(){return!1}},value:{type:Object,default:function(){return{}}},disabled:{type:Boolean,default:function(){return!1}},showInput:{type:Boolean,default:function(){return!0}},placeholder:{type:String,default:""},iconClass:{type:String,default:function(){return"el-icon-edit"}}},data:function(){return{treeData:[],selectedTreeId:"0",tableData:[],totalDimensions:[],treeProps:{children:"children",label:"name",isLeaf:"_leaf"},rootNode:[{id:"-1",name:"/"}],searchName:"",searchCode:"",page:1,pageSize:10,total:0,dimensionDisc:{},productId:"",productObj:{},currentRow:{},orangeDevice:[],currentSubDevice:{}}},created:function(){this.productId=this.getQueryVariable("productId")},mounted:function(){},methods:{loadNode:function(e,t){var a=e.level,i=e.data;if(0===a)return t(this.rootNode);if(1===a&&this.$util.request({url:"/api/model/instances",method:"get",params:{accessMethod:"foreign_key",relationProperties:"id,name,identifier,versionNum",objectType:"GATEWAY_DEVICE",$filter:"type eq IoTModule",$orderBy:"updateTime desc",pagination:0}}).then((function(e){t(e)})).catch((function(e){t([])})),a>1){var n=i.collectTemplate,r=i.id;this.$util.request({url:"/api/model/instances",method:"get",params:{objectType:"SUB_DEVICE",queryMode:"simple",$filter:"collectTemplate eq ".concat(n,", gatewayDevice eq ").concat(r),$orderBy:"updateTime desc",pagination:0}}).then((function(e){t(e.map((function(e){return s(s({},e),{},{_leaf:!0})})))})).catch((function(e){t([])}))}},getMeasData:function(){var e=this,t=this.currentSubDevice.id;this.$util.request({url:"/api/model/instances",method:"get",params:{objectType:"MEAS_ANALOG,MEAS_STRINGMEASUREMENT,MEAS_DISCRETE,MEAS_ACCUMULATOR",parentId:t,$filter:"groupIdentifier eq ,name like ".concat(this.searchName),$page:this.page,$pageSize:this.pageSize,$orderBy:"createTime asc"}}).then((function(t){t.result.map((function(t){(-1!==t.identifier.indexOf("CONNECT_STATUS")||"R"===t.variable.rwType||"r"===t.variable.rwType||1!==e.$getVariable("selectedRowStatus")?t.canW=!1:t.canW=!0,3===t.variable.showFormat&&t.variable.enumText)&&JSON.parse(t.variable.enumText).forEach((function(e){e.key===t.dataValue&&(t.dataValue=e.value)}));return t})),e.tableData=t.result,e.page=t.pageInfo.page,e.pageSize=t.pageInfo.pageSize,e.total=t.pageInfo.total})).catch((function(e){}))},handleTreeNodeClick:function(e){e._leaf&&(this.currentSubDevice=e,this.page=1,this.getMeasData())},close:function(){this.$parent.dialogVisible=!1},setCurrentTreeKey:function(e){var t=this.orangeDevice.find((function(t){return t["subDevice.id"]===e}));t&&this.$refs.deviceTree.setCurrentKey(t.id)},refreshTree:function(){var e=this;this.$util.request({url:"/api/model/instances?objectType=DEVICE&accessMethod=foreign_key&relationProperties=id,identifier,name,localName,defaultConfiguration,location,configurationFolder,onlineStatus&pagination=0&$filter=subDevice notnull"}).then((function(t){var a=Object(i.a)(t);a.forEach((function(e){e.productName="",e["productModel.name"]&&(e.productName=e["productModel.name"])})),e.orangeDevice=Object(o.e)(a);var n=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"id",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"parentId",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"children",n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:-1;i=i||"children";var r=[],o={};return e&&e.length>0&&(e.forEach((function(e){o[e[t]]=e})),e.forEach((function(e){var t={label:e.name,value:e,id:e.id},l=o[e[a]];if(!l)return null!=n&&""!==n?String(e[a])===String(n)?void r.push(t):void 0:void r.push(t);l[i]||(l[i]=[]),l[i].push(t)}))),r}(a,"id","parentId","children",null),r=function e(t){return t.map((function(t){var a;return s(s({},t),{},{children:null!==(a=t.value)&&void 0!==a&&a.children?e(t.value.children):null,value:s(s({},t.value),{},{children:null})})}))}(Object(o.e)(n));e.treeData=[{id:"-1",parentId:"-1",label:"/",children:r}],e.refreshTable()}))},refreshTable:function(){var e=this,t="/api/model/instances?objectType=MEAS_ANALOG,MEAS_STRINGMEASUREMENT,MEAS_INDICATOR,MEAS_DISCRETE,MEAS_ACCUMULATOR&parentId=".concat(this.selectedTreeId,"&$filter=name like ").concat(this.searchName,"&$page=").concat(this.page,"&$pageSize=").concat(this.pageSize,"&$orderBy=createTime%20asc");this.$util.request({url:t}).then((function(t){e.tableData=t.result,e.page=t.pageInfo.page,e.total=t.pageInfo.total}))},handleCurrentChange:function(e){this.currentRow=e},handlePageChange:function(e){this.page=e,this.getMeasData()},handlePageSizeChange:function(e){this.pageSize=e,this.getMeasData()},getRowKey:function(e){return e.id},cancel:function(){this.dialogVisible=!1},clickSure:function(){var e;null!==(e=this.currentRow)&&void 0!==e&&e.id?(this.$emit("changeCurrent",this.currentRow),this.dialogVisible=!1):this.$message({type:"warning",message:"请选择测点"})},productNameTrans:function(e){var t;return null!==(t=e.value)&&void 0!==t&&t.productName?"【".concat(e.value.productName):""},clear:function(){this.dialogVisible=!1,this.$parent.clear()},getQueryVariable:function(e){for(var t=window.location.href,a=t.substring(t.indexOf("?")+1).split("&"),i=0;i<a.length;i++){var n=a[i].split("=");if(n[0]===e)return n[1]}return!1}}},u=(a("9407"),a("2877")),d=Object(u.a)(c,(function(){var e=this,t=e._self._c;return t("el-dialog",{staticClass:"indicator-link-editor-dialog",attrs:{visible:e.dialogVisible,"close-on-click-modal":!1,title:"选择设备变量",width:"1300px","append-to-body":!0},on:{close:e.cancel}},[t("el-row",{staticStyle:{height:"530px",position:"relative"},attrs:{gutter:10}},[t("el-row"),t("el-col",{staticStyle:{height:"100%",position:"relative"},attrs:{span:"6"}},[t("div",{staticStyle:{height:"calc(100% - 50px)",overflow:"auto"}},[e.dialogVisible?t("el-tree",{ref:"deviceTree",staticStyle:{height:"auto"},attrs:{"default-expanded-keys":["-1"],"highlight-current":!0,load:e.loadNode,lazy:"","node-key":"id",props:e.treeProps},on:{"node-click":e.handleTreeNodeClick},scopedSlots:e._u([{key:"default",fn:function(a){var i=a.node;return a.data,t("span",{staticClass:"custom-tree-node"},[t("span",{staticClass:"over3str"},[e._v(e._s(i.label))]),t("span",{staticClass:"over3str"},[e._v(e._s(e.productNameTrans(i.data)))]),t("span",[e._v(e._s(e.productNameTrans(i.data)?"】":""))])])}}],null,!1,557578564)}):e._e()],1)]),t("el-col",{attrs:{span:"18"}},[t("div",{staticClass:"filters"},[t("div",{staticClass:"filter-item"},[t("div",{staticClass:"filter-label"},[e._v("名称")]),t("div",{staticClass:"filter-value"},[t("el-input",{model:{value:e.searchName,callback:function(t){e.searchName=t},expression:"searchName"}})],1)]),t("div",{staticClass:"filter-item"},[t("el-button",{attrs:{type:"primary"},on:{click:e.getMeasData}},[e._v("搜索")])],1)]),t("div",[t("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.tableData,height:"450","tooltip-effect":"dark","highlight-current-row":!0,"row-key":e.getRowKey},on:{"current-change":e.handleCurrentChange}},[t("el-table-column",{attrs:{prop:"name",width:"200",label:"变量名称"}}),t("el-table-column",{attrs:{prop:"identifier",label:"变量标识"}}),t("el-table-column",{attrs:{prop:"updateTime",width:"200",label:"修改时间"}})],1),t("el-pagination",{staticStyle:{float:"right","margin-top":"10px"},attrs:{"current-page":e.page,"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"current-change":e.handlePageChange,"size-change":e.handlePageSizeChange,"update:currentPage":function(t){e.page=t},"update:current-page":function(t){e.page=t}}})],1)])],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-row",[t("el-col",{attrs:{span:24}},[t("el-button",{attrs:{type:"danger"},on:{click:e.clear}},[e._v("清 空")]),t("el-button",{on:{click:e.cancel}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.clickSure}},[e._v("确 定")])],1)],1)],1)],1)}),[],!1,null,"236c1fc8",null).exports;function p(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function h(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?p(Object(a),!0).forEach((function(t){Object(n.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):p(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var f={name:"DeviceLinkEditor",components:{ApiFiltersSelect:a("8e8a").a,SelectIndicatorId:d},alias:"设备测点",command:"device-link",mixins:[r.a],props:{visible:{type:String,default:function(){return!1}},showInput:{type:String,default:function(){return!0}},iconClass:{type:String,default:function(){return"el-icon-edit"}},data:{type:Object,default:function(){return{alias:"",type:"",default:"",value:"",primitiveLabels:""}}},placeholder:{type:String,default:""},autoSetValue:{type:Boolean,default:!0},linkType:{type:Number,default:function(){return 1}},handleRulesResult:{type:Function,default:function(){}},handleChangeResult:{type:Function,default:function(){}}},data:function(){return{compoundItem:[{label:"变量选择",value:"variable",formItem:"variable-Panel"},{label:"手动输入",value:"static",formItem:"date-picker"}],requestPayloadBak:{collectTime:"",beginTime:"",endTime:"",recordType:1},variableEditDataBak:{instanceIdData:{name:"instanceId",value:"",editValue:null},collectTimeData:{name:"collectTime",value:"",editValue:null},beginTimeData:{name:"beginTime",value:"",editValue:null},endTimeData:{name:"endTime",value:"",editValue:null}},rtDataTypes:[{label:"实时数据",value:1},{label:"历史数据",value:2}],queryDirections:[{label:"小于等于采集/归档时间",value:1},{label:"大于等于采集/归档时间",value:2},{label:"小于采集/归档时间",value:3},{label:"大于采集/归档时间",value:4}],queryTypes:[{label:"采集时间",value:1},{label:"归档时间",value:2},{label:"时间区间",value:4}],recordTypes:[{label:"历史记录",value:1},{label:"按天归档的数据",value:2},{label:"按小时归档的数据",value:3},{label:"按分钟归档的数据",value:4}],viewMode:1,showVal:"",collectTime:"",editVal:{accessType:"rtdata",linkType:this.linkType,url:"/api/realtimedata/multi-snapshot",method:"post",contentType:"application/json",objectType:"",rtDataType:1,requestPayload:{instanceId:"",queryDirection:1,querySize:10,$orderBy:"collectTime asc",collectTime:"",queryMode:1,$filter:"",objectType:"",queryType:1,beginTime:"",endTime:"",recordType:1},variableEditData:{instanceIdData:{name:"instanceId",value:"",editValue:null},collectTimeData:{name:"collectTime",value:"",editValue:null},beginTimeData:{name:"beginTime",value:"",editValue:null},endTimeData:{name:"endTime",value:"",editValue:null}},responseSchema:{},exceptionStrategy:"throw",showIdTable:!0,filterItems:[{name:"",value:"",filter:"",editValue:""}],tableData:[]},jsonValue:"{}",codeValue:"{}",responseSchema:"{}",codeOptions:{},codeJSONOptions:{},dialogVisible:this.visible,fetchOption:{url:"/api/model/instances"},fetchProps:{value:"id",label:"name"},fetchOptionForTree:{url:"/api/model/instances?objectType=HR_COMPANY,HR_DEPARTMENT,SYS_ASSET,SYS_EQUIPMENT&queryMode=simple&pagination=0&lazyLoad=0&$orderBy=createTime desc"}}},computed:{instanceColumns:function(){return[{prop:"objectType",label:"量测量分类",filterOnly:!0,filter:{isParam:!0,type:"select",keep:!0,options:[{label:"全部",value:"MEAS_ANALOG,MEAS_DISCRETE,MEAS_ACCUMULATOR,MEAS_STRINGMEASUREMENT"},{label:"模拟量",value:"MEAS_ANALOG"},{label:"离散量",value:"MEAS_DISCRETE"},{label:"累积量",value:"MEAS_ACCUMULATOR"},{label:"字符串量",value:"MEAS_STRINGMEASUREMENT"}],defaultValue:"MEAS_ANALOG,MEAS_DISCRETE,MEAS_ACCUMULATOR,MEAS_STRINGMEASUREMENT"}},{prop:"identifier",label:"实例标识",show:!0,width:"200",filter:{type:"input",operator:"like"}},{prop:"name",label:"实例名称",show:!0,filter:{type:"input",operator:"like"}},{prop:"createTime",label:"创建时间",show:!0},{prop:"updateTime",label:"更新时间",show:!0}]},fetchInfoOption:function(){return{url:"/api/model/instances/".concat(this.editVal.requestPayload.instanceId)}},rules:function(){var e=this,t=function(t,a,i){4!==e.editVal.requestPayload.queryType||a?i():i(new Error("时间必填!"))};return{"requestPayload.instanceId":[{required:!0,message:"请选择",trigger:"change"}],"requestPayload.collectTimeBegin":[{required:!0,message:"请选择",trigger:"change"}],"requestPayload.collectTimeEnd":[{required:!0,message:"请选择",trigger:"change"}],"requestPayload.beginTime":[{validator:t,trigger:"change"}],"requestPayload.endTime":[{validator:t,trigger:"change"}]}},orders:function(){return 1===this.editVal.requestPayload.recordType?[{label:"升序",value:"collectTime asc"},{label:"降序",value:"collectTime desc"}]:[{label:"升序",value:"archiveDate asc"},{label:"降序",value:"archiveDate desc"}]}},watch:{"data.value":function(){this.initData()},visible:function(e){this.dialogVisible=e,e&&this.initData()}},created:function(){this.initData()},methods:{handleTypeChange:function(e){2===e&&(this.editVal.requestPayload=h(h({},this.editVal.requestPayload),this.requestPayloadBak),this.editVal.variableEditData=h(h({},this.editVal.variableEditData),this.variableEditDataBak))},onQuerySizeBlur:function(e){var t,a=null==e||null===(t=e.target)||void 0===t?void 0:t.value;""!==a&&null!=a&&void 0!==a||(this.editVal.requestPayload.querySize=10)},changeRecordType:function(e){var t=this.editVal.requestPayload.$orderBy.split(" ");t.length&&(t[0]=1===e?"collectTime":"archiveDate",this.editVal.requestPayload.$orderBy=t.join(" "))},refreshData:function(){var e=this.editVal,t=e.showIdTable,a=e.rtDataType;t?(this.editVal.requestPayload.objectType="",this.editVal.filterItems=[{name:"",value:"",filter:"",editValue:""}]):this.editVal.tableData=[],this.editVal.requestPayload.instanceId=this.getInstanceIds(),this.editVal.requestPayload.instanceIds=this.getInstanceIds().split(","),this.editVal.requestPayload.$filter=this.getFilterUrl(),1===a&&(this.requestPayloadBak=Object(o.e)({collectTime:this.editVal.requestPayload.collectTime,beginTime:this.editVal.requestPayload.beginTime,endTime:this.editVal.requestPayload.endTime,recordType:this.editVal.requestPayload.recordType}),this.variableEditDataBak=Object(o.e)(this.editVal.variableEditData),this.editVal.requestPayload.collectTime="",this.editVal.requestPayload.beginTime="",this.editVal.requestPayload.endTime="",this.editVal.requestPayload.recordType="",this.editVal.variableEditData={instanceIdData:{name:"instanceId",value:"",editValue:null},collectTimeData:{name:"collectTime",value:"",editValue:null},beginTimeData:{name:"beginTime",value:"",editValue:null},endTimeData:{name:"endTime",value:"",editValue:null}})},deleteRow:function(e,t){var a=this;this.$confirm("确定要删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){a.editVal.tableData.splice(t,1)})).catch((function(){}))},changeIndicator:function(e){this.editVal.tableData.push(e)},getInstanceIds:function(){return this.editVal.tableData.map((function(e){return e.id})).join(",")},getFilterUrl:function(){var e=this.editVal.filterItems,t="";return e.forEach((function(e,a){e.name&&(t+="".concat(a?", ":"").concat(e.name," ").concat(e.logicExp," ").concat(e.value))})),t},handleInsertId:function(){this.$refs.selectIndicatorId.dialogVisible=!0},onInstanceIdChange:function(e,t){this.editVal.objectType=e?t.objectType:""},handleSelectorTableBeforeClose:function(){this.$refs.selectorTable&&this.$refs.selectorTable.$refs.filter&&this.$refs.selectorTable.$refs.filter.handleFilterReset()},changeVariable:function(e,t){var a,i="collectTime"===t?this.editVal.variableEditData[t+"Data"]:null,n="static"===(null==i||null===(a=i.editValue)||void 0===a?void 0:a.type)?+new Date(e):e;this.editVal.requestPayload[t]=isNaN(n)?e:n},handleSwitchViewMode:function(e){this.viewMode=e,2===e&&(this.jsonValue=Object(o.b)(this.editVal))},codeEditorBlur:function(e){this.codeValue=e,this.editVal.requestPayload=Object(o.j)(e)},codeEditorJSONBlur:function(e){this.editVal=Object(o.j)(e),this.codeValue=Object(o.b)(this.editVal.requestPayload)},handleSelectorFocus:function(e){this.$refs[e]&&this.$refs[e].onPopoverHide&&this.$refs[e].onPopoverHide()},initData:function(){this.commonInitData("device")},resetData:function(){this.showVal="",this.editVal={rtDataType:1,accessType:"rtdata",linkType:this.linkType,url:"/api/realtimedata/multi-snapshot",method:"post",contentType:"application/json",fields:"",dataType:"Complex[*]",requestPayload:{instanceId:"",instanceIds:"",queryDirection:1,querySize:10,$orderBy:"collectTime asc",collectTime:"",queryMode:1,$filter:"",objectType:"",queryType:1,beginTime:"",endTime:"",recordType:1},variableEditData:{instanceIdData:{name:"instanceId",value:"",editValue:null},collectTimeData:{name:"collectTime",value:"",editValue:null},beginTimeData:{name:"beginTime",value:"",editValue:null},endTimeData:{name:"endTime",value:"",editValue:null}},responseSchema:{},exceptionStrategy:"throw"},this.codeValue="{}",this.jsonValue="{}",this.commonResetData()},focusCodeEditor:function(){this.$refs.codeEditor&&this.$refs.codeEditor.setMethod("focus")},handleIconClick:function(){this.open()},open:function(){this.$setAttr(this.data,"editorDialogVisible",!0),this.dialogVisible=!0},close:function(){this.closeHandler("device")},clear:function(){this.clearByType("device")},cancel:function(){this.close()},handleCurrentChange:function(e){this.currentRow=e,this.editVal.url=e.id},getShowVal:function(){return Object(o.b)(this.editVal)},clickSure:function(){var e=this;this.$refs.form.validate((function(t){if(t){var a=e.editVal,i=a.rtDataType,n=a.requestPayload;if(!e.editVal.tableData.length)return void e.$message({type:"error",message:"请选择设备测点"});if(2===i&&4===n.queryType){if(!e.editVal.requestPayload.beginTime)return void e.$message({type:"error",message:"请填写开始时间"});if(!e.editVal.requestPayload.endTime)return void e.$message({type:"error",message:"请填写结束时间"});if("number"==typeof e.editVal.requestPayload.endTime&&"number"==typeof e.editVal.requestPayload.beginTime&&e.editVal.requestPayload.endTime<e.editVal.requestPayload.beginTime)return void e.$message({type:"error",message:"开始时间需要早于结束时间"})}e.refreshData(),e.commonSureHandler("device")}}))},getHandlerEditVal:function(){var e=Object(o.e)(this.editVal);e.responseSchema||(e.responseSchema={});var t=e.requestPayload;t.queryMode=1,1===e.rtDataType?(e.url="/api/realtimedata/multi-snapshot",e.method="post"):(e.url="/api/realtimedata/records?",e.method="get");var a=Object.keys(t),i=a.length;return"get"===e.method&&a.forEach((function(a,n){e.url+=n!==i-1?"".concat(a,"=").concat(t[a],"&"):"".concat(a,"=").concat(t[a])})),e.variables=this.getVariables(e),e},getVariables:function(e){var t=this.getVariableNames(e.url),a=this.getVariableNames(e.requestPayload),n=this.getVariableNames(e.responseSchema);return this.formatVariables([].concat(Object(i.a)(t),Object(i.a)(a),Object(i.a)(n)))},validate:function(){return!0}}},m=(a("bed3"),Object(u.a)(f,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"rtdata-link-editor"},[e.showInput?t("el-input",{staticClass:"editor-input",attrs:{placeholder:e.placeholder,value:e.showVal,readonly:"",size:"mini",clearable:""},nativeOn:{click:function(t){return e.handleIconClick.apply(null,arguments)}}},[t("i",{staticClass:"el-input__icon array-editor-icon",class:e.iconClass,attrs:{slot:"suffix"},slot:"suffix"})]):e._e(),t("el-dialog",{staticClass:"rtdata-link-editor-dialog",attrs:{visible:e.dialogVisible,"close-on-click-modal":!1,title:"设备测点关联配置",width:"900px","append-to-body":!0},on:{close:e.close}},[t("div",{staticClass:"hc-view-switch-content"},[t("el-form",{ref:"form",attrs:{"label-width":"150px",model:e.editVal,rules:e.rules}},[t("el-form-item",{attrs:{label:"数据类型："}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},on:{change:e.handleTypeChange},model:{value:e.editVal.rtDataType,callback:function(t){e.$set(e.editVal,"rtDataType",t)},expression:"editVal.rtDataType"}},e._l(e.rtDataTypes,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),2===e.editVal.rtDataType?t("el-form-item",{attrs:{label:"查询类型："}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.editVal.requestPayload.queryType,callback:function(t){e.$set(e.editVal.requestPayload,"queryType",t)},expression:"editVal.requestPayload.queryType"}},e._l(e.queryTypes,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1):e._e(),2===e.editVal.rtDataType?t("el-form-item",{attrs:{label:"记录类型："}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},on:{change:e.changeRecordType},model:{value:e.editVal.requestPayload.recordType,callback:function(t){e.$set(e.editVal.requestPayload,"recordType",t)},expression:"editVal.requestPayload.recordType"}},e._l(e.recordTypes,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1):e._e(),2===e.editVal.rtDataType&&4!==e.editVal.requestPayload.queryType?t("div",[t("el-form-item",{attrs:{label:"查询范围："}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.editVal.requestPayload.queryDirection,callback:function(t){e.$set(e.editVal.requestPayload,"queryDirection",t)},expression:"editVal.requestPayload.queryDirection"}},e._l(e.queryDirections,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"查询条数："}},[t("el-input-number",{attrs:{size:"mini",min:1,max:1e3,step:1,"step-strictly":""},on:{blur:e.onQuerySizeBlur},model:{value:e.editVal.requestPayload.querySize,callback:function(t){e.$set(e.editVal.requestPayload,"querySize",t)},expression:"editVal.requestPayload.querySize"}})],1),t("el-form-item",{attrs:{label:"排序："}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.editVal.requestPayload.$orderBy,callback:function(t){e.$set(e.editVal.requestPayload,"$orderBy",t)},expression:"editVal.requestPayload.$orderBy"}},e._l(e.orders,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1):e._e(),2===e.editVal.rtDataType&&4!==e.editVal.requestPayload.queryType?t("div",[t("el-form-item",{attrs:{label:"".concat(1===e.editVal.requestPayload.queryType?"采集":"归档","时间："),prop:"requestPayload.collectTime"}},[t("variable-editor-components",{key:"collectTime",attrs:{compoundItem:e.compoundItem,"value-format":"timestamp",data:e.editVal.variableEditData.collectTimeData},on:{change:function(t){return e.changeVariable(t,"collectTime")}}})],1)],1):e._e(),2===e.editVal.rtDataType&&4===e.editVal.requestPayload.queryType?t("div",[t("el-form-item",{attrs:{label:"开始时间：",prop:"requestPayload.beginTime"}},[t("variable-editor-components",{key:"beginTime",attrs:{compoundItem:e.compoundItem,"value-format":"timestamp",data:e.editVal.variableEditData.beginTimeData},on:{change:function(t){return e.changeVariable(t,"beginTime")}}})],1),t("el-form-item",{attrs:{label:"结束时间：",prop:"requestPayload.endTime"}},[t("variable-editor-components",{key:"endTime",attrs:{compoundItem:e.compoundItem,"value-format":"timestamp",data:e.editVal.variableEditData.endTimeData},on:{change:function(t){return e.changeVariable(t,"endTime")}}})],1)],1):e._e(),e.editVal.showIdTable?t("div",[t("el-form-item",{attrs:{label:"设备测点："}},[t("el-button",{staticStyle:{float:"right"},attrs:{type:"primary"},on:{click:e.handleInsertId}},[e._v("添加设备测点")]),t("el-table",{ref:"multipleTable",staticStyle:{width:"100%","max-height":"300px","overflow-y":"auto"},attrs:{data:e.editVal.tableData,"tooltip-effect":"dark","highlight-current-row":!0}},[t("el-table-column",{attrs:{prop:"identifier",label:"标识"}}),t("el-table-column",{attrs:{prop:"name",width:"150",label:"名称"}}),t("el-table-column",{attrs:{label:"操作",width:"100"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){return e.deleteRow(a.row,a.$index)}}},[e._v("删除")])]}}],null,!1,4076837784)})],1)],1)],1):t("div",[t("el-form-item",{attrs:{label:"objectType："}},[t("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.editVal.requestPayload.objectType,callback:function(t){e.$set(e.editVal.requestPayload,"objectType",t)},expression:"editVal.requestPayload.objectType"}})],1),t("el-form-item",{attrs:{label:"筛选项："}},[t("api-filters-select",{model:{value:e.editVal.filterItems,callback:function(t){e.$set(e.editVal,"filterItems",t)},expression:"editVal.filterItems"}})],1)],1),t("exception-strategy",{model:{value:e.editVal.exceptionStrategy,callback:function(t){e.$set(e.editVal,"exceptionStrategy",t)},expression:"editVal.exceptionStrategy"}}),t("response-schema",{attrs:{visible:e.dialogVisible,value:e.responseSchema},on:{blur:e.responseSchemaBlur}}),t("common-link-set",{attrs:{config:e.commonLinkSet,data:e.data,defaultLoad:e.defaultLoad,hiddenConfig:{pagination:!0}}})],1),2===e.viewMode?t("div",{staticClass:"hc-view-switch-json"},[e.dialogVisible?t("base-code-editor",{ref:"codeEditorJSON",attrs:{params:e.codeJSONOptions,value:e.jsonValue,height:420},on:{blur:e.codeEditorJSONBlur}}):e._e()],1):e._e()],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"danger"},on:{click:e.clear}},[e._v("清 空")]),t("el-button",{on:{click:e.cancel}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.clickSure}},[e._v("确 定")])],1)]),t("select-indicator-id",{ref:"selectIndicatorId",on:{changeCurrent:e.changeIndicator}})],1)}),[],!1,null,null,null));t.default=m.exports},fceb:function(e,t,a){},fe08:function(e,t,a){"use strict";a("446e")},fe2b:function(e,t,a){"use strict";a("e289")},fe88:function(e,t,a){var i={"./alarm-link-editor/index.vue":"904a","./api-link-editor/index.vue":"66b3","./assets-link-editor/index.vue":"6834","./device-variable-link-editor/index.vue":"fcc0","./indicator-link-editor-old/index.vue":"5c9f","./indicator-link-editor/index.vue":"36ad","./object-link-editor-old/index.vue":"93c5","./object-link-editor/index.vue":"3c0c","./rtdata-link-editor/index.vue":"0456","./script-link-editor/index.vue":"020a","./sql-link-editor/index.vue":"7fc2","./temp-variable-link-editor/index.vue":"31cd","./template-link-editor/index.vue":"7bec","./variable-link-editor/index.vue":"44cb"};function n(e){var t=r(e);return a(t)}function r(e){if(!a.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}n.keys=function(){return Object.keys(i)},n.resolve=r,e.exports=n,n.id="fe88"},ff36:function(e,t,a){"use strict";a("bc7a")},ff5b:function(e,t,a){}});